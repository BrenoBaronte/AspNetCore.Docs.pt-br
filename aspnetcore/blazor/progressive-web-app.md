---
title: Crie aplicativos Web progressivos com ASP.NET Core Blazor WebAssembly
author: guardrex
description: Saiba como criar um Blazor aplicativo Web progressivo baseado em um (PWA) que usa recursos de navegador modernos para se comportar como um aplicativo de desktop.
monikerRange: '>= aspnetcore-3.1'
ms.author: riande
ms.custom: mvc
ms.date: 01/11/2020
no-loc:
- appsettings.json
- ASP.NET Core Identity
- cookie
- Cookie
- Blazor
- Blazor Server
- Blazor WebAssembly
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: blazor/progressive-web-app
ms.openlocfilehash: 196e19528341e98ac06cefb08ba92f9e47d265ea
ms.sourcegitcommit: 063a06b644d3ade3c15ce00e72a758ec1187dd06
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/16/2021
ms.locfileid: "98252468"
---
# <a name="build-progressive-web-applications-with-aspnet-core-no-locblazor-webassembly"></a><span data-ttu-id="bfec6-103">Crie aplicativos Web progressivos com ASP.NET Core Blazor WebAssembly</span><span class="sxs-lookup"><span data-stu-id="bfec6-103">Build Progressive Web Applications with ASP.NET Core Blazor WebAssembly</span></span>

<span data-ttu-id="bfec6-104">Por [Steve Sanderson](https://github.com/SteveSandersonMS)</span><span class="sxs-lookup"><span data-stu-id="bfec6-104">By [Steve Sanderson](https://github.com/SteveSandersonMS)</span></span>

<span data-ttu-id="bfec6-105">Um aplicativo Web progressivo (PWA) geralmente é um aplicativo de página única (SPA) que usa APIs de navegador e recursos modernos para se comportar como um aplicativo de desktop.</span><span class="sxs-lookup"><span data-stu-id="bfec6-105">A Progressive Web Application (PWA) is usually a Single Page Application (SPA) that uses modern browser APIs and capabilities to behave like a desktop app.</span></span> <span data-ttu-id="bfec6-106">Blazor WebAssembly é uma plataforma de aplicativo Web do lado do cliente baseada em padrões, portanto, ela pode usar qualquer API do navegador, incluindo as APIs do PWA necessárias para os seguintes recursos:</span><span class="sxs-lookup"><span data-stu-id="bfec6-106">Blazor WebAssembly is a standards-based client-side web app platform, so it can use any browser API, including PWA APIs required for the following capabilities:</span></span>

* <span data-ttu-id="bfec6-107">Trabalhar offline e carregar instantaneamente, independentemente da velocidade da rede.</span><span class="sxs-lookup"><span data-stu-id="bfec6-107">Working offline and loading instantly, independent of network speed.</span></span>
* <span data-ttu-id="bfec6-108">Em execução em sua própria janela de aplicativo, não apenas em uma janela de navegador.</span><span class="sxs-lookup"><span data-stu-id="bfec6-108">Running in its own app window, not just a browser window.</span></span>
* <span data-ttu-id="bfec6-109">Sendo iniciado no menu Iniciar, no Dock ou na tela inicial do sistema operacional do host.</span><span class="sxs-lookup"><span data-stu-id="bfec6-109">Being launched from the host's operating system start menu, dock, or home screen.</span></span>
* <span data-ttu-id="bfec6-110">Receber notificações por push de um servidor de back-end, mesmo que o usuário não esteja usando o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="bfec6-110">Receiving push notifications from a backend server, even while the user isn't using the app.</span></span>
* <span data-ttu-id="bfec6-111">Atualizando automaticamente em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="bfec6-111">Automatically updating in the background.</span></span>

<span data-ttu-id="bfec6-112">A palavra *progressiva* é usada para descrever tais aplicativos porque:</span><span class="sxs-lookup"><span data-stu-id="bfec6-112">The word *progressive* is used to describe such apps because:</span></span>

* <span data-ttu-id="bfec6-113">Um usuário pode primeiro descobrir e usar o aplicativo no navegador da Web, como qualquer outro SPA.</span><span class="sxs-lookup"><span data-stu-id="bfec6-113">A user might first discover and use the app within their web browser like any other SPA.</span></span>
* <span data-ttu-id="bfec6-114">Posteriormente, o usuário progride para instalá-lo em seu sistema operacional e habilitar notificações por push.</span><span class="sxs-lookup"><span data-stu-id="bfec6-114">Later, the user progresses to installing it in their OS and enabling push notifications.</span></span>

## <a name="create-a-project-from-the-pwa-template"></a><span data-ttu-id="bfec6-115">Criar um projeto do modelo do PWA</span><span class="sxs-lookup"><span data-stu-id="bfec6-115">Create a project from the PWA template</span></span>

# <a name="visual-studio"></a>[<span data-ttu-id="bfec6-116">Visual Studio</span><span class="sxs-lookup"><span data-stu-id="bfec6-116">Visual Studio</span></span>](#tab/visual-studio)

<span data-ttu-id="bfec6-117">Ao criar um novo **Blazor WebAssembly aplicativo** no diálogo **criar um novo projeto** , marque a caixa de seleção **aplicativo Web progressivo** :</span><span class="sxs-lookup"><span data-stu-id="bfec6-117">When creating a new **Blazor WebAssembly App** in the **Create a New Project** dialog, select the **Progressive Web Application** check box:</span></span>

![A caixa de seleção ' aplicativo Web progressivo ' é marcada na diálogo novo projeto do Visual Studio.](progressive-web-app/_static/image1.png)

<!--

# [Visual Studio for Mac](#tab/visual-studio-mac)

-->

# <a name="visual-studio-code--net-core-cli"></a>[<span data-ttu-id="bfec6-119">Visual Studio Code/CLI do .NET Core</span><span class="sxs-lookup"><span data-stu-id="bfec6-119">Visual Studio Code / .NET Core CLI</span></span>](#tab/visual-studio-code+netcore-cli)

<span data-ttu-id="bfec6-120">Use o seguinte comando para criar um projeto do PWA em um shell de comando com a `--pwa` opção:</span><span class="sxs-lookup"><span data-stu-id="bfec6-120">Use the following command to create a PWA project in a command shell with the `--pwa` switch:</span></span>

```dotnetcli
dotnet new blazorwasm -o MyBlazorPwa --pwa
```

<span data-ttu-id="bfec6-121">No comando anterior, a `-o|--output` opção cria uma nova pasta para o aplicativo chamado `MyBlazorPwa` .</span><span class="sxs-lookup"><span data-stu-id="bfec6-121">In the preceding command, the `-o|--output` option creates a new folder for the app named `MyBlazorPwa`.</span></span>

---

<span data-ttu-id="bfec6-122">Opcionalmente, o PWA pode ser configurado para um aplicativo criado a partir do modelo hospedado ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="bfec6-122">Optionally, PWA can be configured for an app created from the ASP.NET Core Hosted template.</span></span> <span data-ttu-id="bfec6-123">O cenário do PWA é independente do modelo de hospedagem.</span><span class="sxs-lookup"><span data-stu-id="bfec6-123">The PWA scenario is independent of the hosting model.</span></span>

## <a name="convert-an-existing-no-locblazor-webassembly-app-into-a-pwa"></a><span data-ttu-id="bfec6-124">Converter um Blazor WebAssembly aplicativo existente em um PWA</span><span class="sxs-lookup"><span data-stu-id="bfec6-124">Convert an existing Blazor WebAssembly app into a PWA</span></span>

<span data-ttu-id="bfec6-125">Converta um Blazor WebAssembly aplicativo existente em um PWA seguindo as orientações nesta seção.</span><span class="sxs-lookup"><span data-stu-id="bfec6-125">Convert an existing Blazor WebAssembly app into a PWA following the guidance in this section.</span></span>

<span data-ttu-id="bfec6-126">No arquivo de projeto do aplicativo:</span><span class="sxs-lookup"><span data-stu-id="bfec6-126">In the app's project file:</span></span>

* <span data-ttu-id="bfec6-127">Adicione a seguinte `ServiceWorkerAssetsManifest` Propriedade a `PropertyGroup` :</span><span class="sxs-lookup"><span data-stu-id="bfec6-127">Add the following `ServiceWorkerAssetsManifest` property to a `PropertyGroup`:</span></span>

  ```xml
    ...
    <ServiceWorkerAssetsManifest>service-worker-assets.js</ServiceWorkerAssetsManifest>
  </PropertyGroup>
   ```

* <span data-ttu-id="bfec6-128">Adicione o seguinte `ServiceWorker` item a um `ItemGroup` :</span><span class="sxs-lookup"><span data-stu-id="bfec6-128">Add the following `ServiceWorker` item to an `ItemGroup`:</span></span>

  ```xml
  <ItemGroup>
    <ServiceWorker Include="wwwroot\service-worker.js" 
      PublishedContent="wwwroot\service-worker.published.js" />
  </ItemGroup>
  ```

<span data-ttu-id="bfec6-129">Para obter ativos estáticos, use **uma** das seguintes abordagens:</span><span class="sxs-lookup"><span data-stu-id="bfec6-129">To obtain static assets, use **one** of the following approaches:</span></span>

::: moniker range=">= aspnetcore-5.0"

* <span data-ttu-id="bfec6-130">Crie um novo projeto do PWA separado com o [`dotnet new`](/dotnet/core/tools/dotnet-new) comando em um shell de comando:</span><span class="sxs-lookup"><span data-stu-id="bfec6-130">Create a separate, new PWA project with the [`dotnet new`](/dotnet/core/tools/dotnet-new) command in a command shell:</span></span>

  ```dotnetcli
  dotnet new blazorwasm -o MyBlazorPwa --pwa
  ```
  
  <span data-ttu-id="bfec6-131">No comando anterior, a `-o|--output` opção cria uma nova pasta para o aplicativo chamado `MyBlazorPwa` .</span><span class="sxs-lookup"><span data-stu-id="bfec6-131">In the preceding command, the `-o|--output` option creates a new folder for the app named `MyBlazorPwa`.</span></span>
  
  <span data-ttu-id="bfec6-132">Se você não estiver convertendo um aplicativo para a versão mais recente, passe a `-f|--framework` opção.</span><span class="sxs-lookup"><span data-stu-id="bfec6-132">If you aren't converting an app for the latest release, pass the `-f|--framework` option.</span></span> <span data-ttu-id="bfec6-133">O exemplo a seguir cria o aplicativo para ASP.NET Core versão 3,1:</span><span class="sxs-lookup"><span data-stu-id="bfec6-133">The following example creates the app for ASP.NET Core version 3.1:</span></span>
  
  ```dotnetcli
  dotnet new blazorwasm -o MyBlazorPwa --pwa -f netcoreapp3.1
  ```

* <span data-ttu-id="bfec6-134">Navegue até o ASP.NET Core repositório GitHub na seguinte URL, que tem como link a fonte de referência da versão 5,0 e os ativos.</span><span class="sxs-lookup"><span data-stu-id="bfec6-134">Navigate to the ASP.NET Core GitHub repository at the following URL, which links to 5.0 release reference source and assets.</span></span> <span data-ttu-id="bfec6-135">Se você não estiver convertendo um aplicativo para a versão 5,0, selecione a versão com a qual você está trabalhando na lista suspensa **branches de switch ou marcas** que se aplica ao seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="bfec6-135">If you aren't converting an app for the 5.0 release, select the release that you're working with from the **Switch branches or tags** drop-down list that applies to your app.</span></span>

  [<span data-ttu-id="bfec6-136">dotnet/aspnetcore (versão 5,0) Blazor WebAssembly pasta de modelo de projeto `wwwroot`</span><span class="sxs-lookup"><span data-stu-id="bfec6-136">dotnet/aspnetcore (release 5.0) Blazor WebAssembly project template `wwwroot` folder</span></span>](https://github.com/dotnet/aspnetcore/tree/release/5.0/src/ProjectTemplates/Web.ProjectTemplates/content/ComponentsWebAssembly-CSharp/Client/wwwroot)

::: moniker-end

::: moniker range="< aspnetcore-5.0"

* <span data-ttu-id="bfec6-137">Crie um novo projeto do PWA separado com o [`dotnet new`](/dotnet/core/tools/dotnet-new) comando em um shell de comando.</span><span class="sxs-lookup"><span data-stu-id="bfec6-137">Create a separate, new PWA project with the [`dotnet new`](/dotnet/core/tools/dotnet-new) command in a command shell.</span></span> <span data-ttu-id="bfec6-138">Passe a `-f|--framework` opção para selecionar a versão.</span><span class="sxs-lookup"><span data-stu-id="bfec6-138">Pass the `-f|--framework` option to select the version.</span></span> <span data-ttu-id="bfec6-139">O exemplo a seguir cria o aplicativo para ASP.NET Core versão 3,1:</span><span class="sxs-lookup"><span data-stu-id="bfec6-139">The following example creates the app for ASP.NET Core version 3.1:</span></span>
  
  ```dotnetcli
  dotnet new blazorwasm -o MyBlazorPwa --pwa -f netcoreapp3.1
  ```
  
  <span data-ttu-id="bfec6-140">No comando anterior, a `-o|--output` opção cria uma nova pasta para o aplicativo chamado `MyBlazorPwa` .</span><span class="sxs-lookup"><span data-stu-id="bfec6-140">In the preceding command, the `-o|--output` option creates a new folder for the app named `MyBlazorPwa`.</span></span>

* <span data-ttu-id="bfec6-141">Navegue até o ASP.NET Core repositório GitHub na seguinte URL, que tem como link a fonte de referência da versão 3,1 e os ativos:</span><span class="sxs-lookup"><span data-stu-id="bfec6-141">Navigate to the ASP.NET Core GitHub repository at the following URL, which links to 3.1 release reference source and assets:</span></span>

  [<span data-ttu-id="bfec6-142">dotnet/aspnetcore (versão 3,1) Blazor WebAssembly pasta de modelo de projeto `wwwroot`</span><span class="sxs-lookup"><span data-stu-id="bfec6-142">dotnet/aspnetcore (release 3.1) Blazor WebAssembly project template `wwwroot` folder</span></span>](https://github.com/dotnet/aspnetcore/tree/release/3.1/src/ProjectTemplates/ComponentsWebAssembly.ProjectTemplates/content/ComponentsWebAssembly-CSharp/Client/wwwroot)

  > [!NOTE]
  > <span data-ttu-id="bfec6-143">A URL do Blazor WebAssembly modelo de projeto foi alterada após o lançamento do ASP.NET Core 3,1.</span><span class="sxs-lookup"><span data-stu-id="bfec6-143">The URL for Blazor WebAssembly project template changed after the release of ASP.NET Core 3.1.</span></span> <span data-ttu-id="bfec6-144">Os ativos de referência para o 5,0 ou posterior estão disponíveis na seguinte URL:</span><span class="sxs-lookup"><span data-stu-id="bfec6-144">Reference assets for 5.0 or later are available at the following URL:</span></span>
  >
  > [<span data-ttu-id="bfec6-145">dotnet/aspnetcore (versão 5,0) Blazor WebAssembly pasta de modelo de projeto `wwwroot`</span><span class="sxs-lookup"><span data-stu-id="bfec6-145">dotnet/aspnetcore (release 5.0) Blazor WebAssembly project template `wwwroot` folder</span></span>](https://github.com/dotnet/aspnetcore/tree/release/5.0/src/ProjectTemplates/Web.ProjectTemplates/content/ComponentsWebAssembly-CSharp/Client/wwwroot)

::: moniker-end

<span data-ttu-id="bfec6-146">Na pasta de origem `wwwroot` no aplicativo que você criou ou dos ativos de referência no `dotnet/aspnetcore` repositório do GitHub, copie os seguintes arquivos na pasta do aplicativo `wwwroot` :</span><span class="sxs-lookup"><span data-stu-id="bfec6-146">From the source `wwwroot` folder either in the app that you created or from the reference assets in the `dotnet/aspnetcore` GitHub repository, copy the following files into the app's `wwwroot` folder:</span></span>

* `icon-512.png`
* `manifest.json`
* `service-worker.js`
* `service-worker.published.js`

<span data-ttu-id="bfec6-147">No arquivo do aplicativo `wwwroot/index.html` :</span><span class="sxs-lookup"><span data-stu-id="bfec6-147">In the app's `wwwroot/index.html` file:</span></span>

* <span data-ttu-id="bfec6-148">Adicione `<link>` elementos para o manifesto e o ícone do aplicativo:</span><span class="sxs-lookup"><span data-stu-id="bfec6-148">Add `<link>` elements for the manifest and app icon:</span></span>

  ```html
  <link href="manifest.json" rel="manifest" />
  <link rel="apple-touch-icon" sizes="512x512" href="icon-512.png" />
  ```

* <span data-ttu-id="bfec6-149">Adicione a seguinte `<script>` marcação dentro da marca de fechamento `</body>` imediatamente após a `blazor.webassembly.js` marca do script:</span><span class="sxs-lookup"><span data-stu-id="bfec6-149">Add the following `<script>` tag inside the closing `</body>` tag immediately after the `blazor.webassembly.js` script tag:</span></span>

  ```html
      ...
      <script>navigator.serviceWorker.register('service-worker.js');</script>
  </body>
  ```

## <a name="installation-and-app-manifest"></a><span data-ttu-id="bfec6-150">Instalação e manifesto do aplicativo</span><span class="sxs-lookup"><span data-stu-id="bfec6-150">Installation and app manifest</span></span>

<span data-ttu-id="bfec6-151">Ao visitar um aplicativo criado usando o modelo do PWA, os usuários têm a opção de instalar o aplicativo no menu Iniciar, no Dock ou na tela inicial do sistema operacional.</span><span class="sxs-lookup"><span data-stu-id="bfec6-151">When visiting an app created using the PWA template, users have the option of installing the app into their OS's start menu, dock, or home screen.</span></span> <span data-ttu-id="bfec6-152">A maneira como essa opção é apresentada depende do navegador do usuário.</span><span class="sxs-lookup"><span data-stu-id="bfec6-152">The way this option is presented depends on the user's browser.</span></span> <span data-ttu-id="bfec6-153">Ao usar navegadores baseados em desktop Chromium, como Edge ou Chrome, um botão **Adicionar** é exibido na barra de URL.</span><span class="sxs-lookup"><span data-stu-id="bfec6-153">When using desktop Chromium-based browsers, such as Edge or Chrome, an **Add** button appears within the URL bar.</span></span> <span data-ttu-id="bfec6-154">Depois que o usuário selecionar o botão **Adicionar** , ele receberá uma caixa de diálogo de confirmação:</span><span class="sxs-lookup"><span data-stu-id="bfec6-154">After the user selects the **Add** button, they receive a confirmation dialog:</span></span>

![A caixa de diálogo de confirmação no Google Chrome apresenta um botão de instalação ao usuário para o aplicativo ' My::: no-Loc (mais alto):::P wa '.](progressive-web-app/_static/image2.png)

<span data-ttu-id="bfec6-156">No iOS, os visitantes podem instalar o PWA usando o botão **compartilhar** do Safari e sua opção **Adicionar à homescreen** .</span><span class="sxs-lookup"><span data-stu-id="bfec6-156">On iOS, visitors can install the PWA using Safari's **Share** button and its **Add to Homescreen** option.</span></span> <span data-ttu-id="bfec6-157">No Chrome para Android, os usuários devem selecionar o botão de **menu** no canto superior direito, seguido por **Adicionar à tela inicial**.</span><span class="sxs-lookup"><span data-stu-id="bfec6-157">On Chrome for Android, users should select the **Menu** button in the upper-right corner, followed by **Add to Home screen**.</span></span>

<span data-ttu-id="bfec6-158">Uma vez instalado, o aplicativo aparece em sua própria janela sem uma barra de endereços:</span><span class="sxs-lookup"><span data-stu-id="bfec6-158">Once installed, the app appears in its own window without an address bar:</span></span>

![O aplicativo ' My::: no-Loc (mais incrivelmente):::P wa ' é executado no Google Chrome sem uma barra de endereços.](progressive-web-app/_static/image3.png)

<span data-ttu-id="bfec6-160">Para personalizar o título, o esquema de cores, o ícone ou outros detalhes da janela, consulte o `manifest.json` arquivo no diretório do projeto `wwwroot` .</span><span class="sxs-lookup"><span data-stu-id="bfec6-160">To customize the window's title, color scheme, icon, or other details, see the `manifest.json` file in the project's `wwwroot` directory.</span></span> <span data-ttu-id="bfec6-161">O esquema desse arquivo é definido por padrões da Web.</span><span class="sxs-lookup"><span data-stu-id="bfec6-161">The schema of this file is defined by web standards.</span></span> <span data-ttu-id="bfec6-162">Para obter mais informações, consulte [MDN Web docs: manifesto do aplicativo Web](https://developer.mozilla.org/docs/Web/Manifest).</span><span class="sxs-lookup"><span data-stu-id="bfec6-162">For more information, see [MDN web docs: Web App Manifest](https://developer.mozilla.org/docs/Web/Manifest).</span></span>

## <a name="offline-support"></a><span data-ttu-id="bfec6-163">Suporte offline</span><span class="sxs-lookup"><span data-stu-id="bfec6-163">Offline support</span></span>

<span data-ttu-id="bfec6-164">Por padrão, os aplicativos criados usando a opção de modelo do PWA têm suporte para execução offline.</span><span class="sxs-lookup"><span data-stu-id="bfec6-164">By default, apps created using the PWA template option have support for running offline.</span></span> <span data-ttu-id="bfec6-165">Um usuário deve primeiro visitar o aplicativo enquanto estiver online.</span><span class="sxs-lookup"><span data-stu-id="bfec6-165">A user must first visit the app while they're online.</span></span> <span data-ttu-id="bfec6-166">O navegador baixa e armazena em cache automaticamente todos os recursos necessários para operar offline.</span><span class="sxs-lookup"><span data-stu-id="bfec6-166">The browser automatically downloads and caches all of the resources required to operate offline.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="bfec6-167">O suporte ao desenvolvimento interferiria com o ciclo de desenvolvimento normal de fazer alterações e testá-las.</span><span class="sxs-lookup"><span data-stu-id="bfec6-167">Development support would interfere with the usual development cycle of making changes and testing them.</span></span> <span data-ttu-id="bfec6-168">Portanto, o suporte offline só é habilitado para aplicativos *publicados* .</span><span class="sxs-lookup"><span data-stu-id="bfec6-168">Therefore, offline support is only enabled for *published* apps.</span></span> 

> [!WARNING]
> <span data-ttu-id="bfec6-169">Se você pretende distribuir um PWA habilitado para offline, há [vários avisos e advertências importantes](#caveats-for-offline-pwas).</span><span class="sxs-lookup"><span data-stu-id="bfec6-169">If you intend to distribute an offline-enabled PWA, there are [several important warnings and caveats](#caveats-for-offline-pwas).</span></span> <span data-ttu-id="bfec6-170">Esses cenários são inerentes a PWAs offline e não específicos do Blazor .</span><span class="sxs-lookup"><span data-stu-id="bfec6-170">These scenarios are inherent to offline PWAs and not specific to Blazor.</span></span> <span data-ttu-id="bfec6-171">Certifique-se de ler e entender essas advertências antes de fazer suposições sobre como seu aplicativo habilitado para offline funcionará.</span><span class="sxs-lookup"><span data-stu-id="bfec6-171">Be sure to read and understand these caveats before making assumptions about how your offline-enabled app will work.</span></span>

<span data-ttu-id="bfec6-172">Para ver como funciona o suporte offline:</span><span class="sxs-lookup"><span data-stu-id="bfec6-172">To see how offline support works:</span></span>

1. <span data-ttu-id="bfec6-173">Publique o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="bfec6-173">Publish the app.</span></span> <span data-ttu-id="bfec6-174">Para obter mais informações, consulte <xref:blazor/host-and-deploy/index#publish-the-app>.</span><span class="sxs-lookup"><span data-stu-id="bfec6-174">For more information, see <xref:blazor/host-and-deploy/index#publish-the-app>.</span></span>
1. <span data-ttu-id="bfec6-175">Implante o aplicativo em um servidor que dê suporte a HTTPS e acesse o aplicativo em um navegador em seu endereço HTTPS seguro.</span><span class="sxs-lookup"><span data-stu-id="bfec6-175">Deploy the app to a server that supports HTTPS, and access the app in a browser at its secure HTTPS address.</span></span>
1. <span data-ttu-id="bfec6-176">Abra as ferramentas de desenvolvimento do navegador e verifique se um *trabalhador de serviço* está registrado para o host na guia **aplicativo** :</span><span class="sxs-lookup"><span data-stu-id="bfec6-176">Open the browser's dev tools and verify that a *Service Worker* is registered for the host on the **Application** tab:</span></span>

   ![A guia ' aplicativo ' das ferramentas de desenvolvedor do Google Chrome mostra um trabalho de serviço ativado e em execução.](progressive-web-app/_static/image4.png)

1. <span data-ttu-id="bfec6-178">Recarregue a página e examine a guia **rede** . o **trabalho de serviço** ou o cache de **memória** são listados como fontes para todos os ativos da página:</span><span class="sxs-lookup"><span data-stu-id="bfec6-178">Reload the page and examine the **Network** tab. **Service Worker** or **memory cache** are listed as the sources for all of the page's assets:</span></span>

   ![Guia ' rede ' das ferramentas de desenvolvedor do Google Chrome mostrando fontes para todos os ativos da página.](progressive-web-app/_static/image5.png)

1. <span data-ttu-id="bfec6-180">Para verificar se o navegador não depende do acesso à rede para carregar o aplicativo, seja:</span><span class="sxs-lookup"><span data-stu-id="bfec6-180">To verify that the browser isn't dependent on network access to load the app, either:</span></span>

   * <span data-ttu-id="bfec6-181">Desligue o servidor Web e veja como o aplicativo continua a funcionar normalmente, o que inclui recargas de página.</span><span class="sxs-lookup"><span data-stu-id="bfec6-181">Shut down the web server and see how the app continues to function normally, which includes page reloads.</span></span> <span data-ttu-id="bfec6-182">Da mesma forma, o aplicativo continua a funcionar normalmente quando há uma conexão de rede lenta.</span><span class="sxs-lookup"><span data-stu-id="bfec6-182">Likewise, the app continues to function normally when there's a slow network connection.</span></span>
   * <span data-ttu-id="bfec6-183">Instrua o navegador a simular o modo offline na guia **rede** :</span><span class="sxs-lookup"><span data-stu-id="bfec6-183">Instruct the browser to simulate offline mode in the **Network** tab:</span></span>

   ![Guia ' rede ' das ferramentas de desenvolvedor do Google Chrome com a lista suspensa do modo navegador sendo alterada de ' online ' para ' offline '.](progressive-web-app/_static/image6.png)

<span data-ttu-id="bfec6-185">O suporte offline usando um operador de serviço é um padrão da Web, não específico do Blazor .</span><span class="sxs-lookup"><span data-stu-id="bfec6-185">Offline support using a service worker is a web standard, not specific to Blazor.</span></span> <span data-ttu-id="bfec6-186">Para obter mais informações sobre os operadores de serviço, consulte [MDN Web docs: Service Worker API](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span><span class="sxs-lookup"><span data-stu-id="bfec6-186">For more information on service workers, see [MDN web docs: Service Worker API](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span></span> <span data-ttu-id="bfec6-187">Para saber mais sobre os padrões de uso comuns para trabalhadores de serviço, consulte [Google Web: o ciclo de vida do trabalho do serviço](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle).</span><span class="sxs-lookup"><span data-stu-id="bfec6-187">To learn more about common usage patterns for service workers, see [Google Web: The Service Worker Lifecycle](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle).</span></span>

<span data-ttu-id="bfec6-188">Blazoro modelo do PWA produz dois arquivos de trabalho de serviço:</span><span class="sxs-lookup"><span data-stu-id="bfec6-188">Blazor's PWA template produces two service worker files:</span></span>

* <span data-ttu-id="bfec6-189">`wwwroot/service-worker.js`, que é usado durante o desenvolvimento.</span><span class="sxs-lookup"><span data-stu-id="bfec6-189">`wwwroot/service-worker.js`, which is used during development.</span></span>
* <span data-ttu-id="bfec6-190">`wwwroot/service-worker.published.js`, que é usado depois que o aplicativo é publicado.</span><span class="sxs-lookup"><span data-stu-id="bfec6-190">`wwwroot/service-worker.published.js`, which is used after the app is published.</span></span>

<span data-ttu-id="bfec6-191">Para compartilhar a lógica entre os dois arquivos de trabalho do serviço, considere a seguinte abordagem:</span><span class="sxs-lookup"><span data-stu-id="bfec6-191">To share logic between the two service worker files, consider the following approach:</span></span>

* <span data-ttu-id="bfec6-192">Adicione um terceiro arquivo JavaScript para manter a lógica comum.</span><span class="sxs-lookup"><span data-stu-id="bfec6-192">Add a third JavaScript file to hold the common logic.</span></span>
* <span data-ttu-id="bfec6-193">Use [`self.importScripts`](https://developer.mozilla.org/docs/Web/API/WorkerGlobalScope/importScripts) para carregar a lógica comum em ambos os arquivos de trabalho do serviço.</span><span class="sxs-lookup"><span data-stu-id="bfec6-193">Use [`self.importScripts`](https://developer.mozilla.org/docs/Web/API/WorkerGlobalScope/importScripts) to load the common logic into both service worker files.</span></span>

### <a name="cache-first-fetch-strategy"></a><span data-ttu-id="bfec6-194">Estratégia de busca de cache-primeiro</span><span class="sxs-lookup"><span data-stu-id="bfec6-194">Cache-first fetch strategy</span></span>

<span data-ttu-id="bfec6-195">O `service-worker.published.js` trabalho de serviço interno resolve solicitações usando uma estratégia *de cache-First* .</span><span class="sxs-lookup"><span data-stu-id="bfec6-195">The built-in `service-worker.published.js` service worker resolves requests using a *cache-first* strategy.</span></span> <span data-ttu-id="bfec6-196">Isso significa que o operador de serviço prefere retornar o conteúdo armazenado em cache, independentemente de o usuário ter acesso à rede ou conteúdo mais recente estar disponível no servidor.</span><span class="sxs-lookup"><span data-stu-id="bfec6-196">This means that the service worker prefers to return cached content, regardless of whether the user has network access or newer content is available on the server.</span></span>

<span data-ttu-id="bfec6-197">A estratégia de cache-First é valiosa porque:</span><span class="sxs-lookup"><span data-stu-id="bfec6-197">The cache-first strategy is valuable because:</span></span>

* <span data-ttu-id="bfec6-198">**Ele garante a confiabilidade.**</span><span class="sxs-lookup"><span data-stu-id="bfec6-198">**It ensures reliability.**</span></span> <span data-ttu-id="bfec6-199">O acesso à rede não é um estado booliano.</span><span class="sxs-lookup"><span data-stu-id="bfec6-199">Network access isn't a boolean state.</span></span> <span data-ttu-id="bfec6-200">Um usuário não está simplesmente online ou offline:</span><span class="sxs-lookup"><span data-stu-id="bfec6-200">A user isn't simply online or offline:</span></span>

  * <span data-ttu-id="bfec6-201">O dispositivo do usuário pode pressupor que está online, mas a rede pode ser tão lenta quanto ser impraticável de esperar.</span><span class="sxs-lookup"><span data-stu-id="bfec6-201">The user's device may assume it's online, but the network might be so slow as to be impractical to wait for.</span></span>
  * <span data-ttu-id="bfec6-202">A rede pode retornar resultados inválidos para determinadas URLs, como quando há um portal WIFI cativo que está bloqueando ou redirecionando determinadas solicitações.</span><span class="sxs-lookup"><span data-stu-id="bfec6-202">The network might return invalid results for certain URLs, such as when there's a captive WIFI portal that's currently blocking or redirecting certain requests.</span></span>
  
  <span data-ttu-id="bfec6-203">É por isso que a API do navegador `navigator.onLine` não é confiável e não deve ser dependente.</span><span class="sxs-lookup"><span data-stu-id="bfec6-203">This is why the browser's `navigator.onLine` API isn't reliable and shouldn't be depended upon.</span></span>

* <span data-ttu-id="bfec6-204">**Ele garante a exatidão.**</span><span class="sxs-lookup"><span data-stu-id="bfec6-204">**It ensures correctness.**</span></span> <span data-ttu-id="bfec6-205">Ao criar um cache de recursos offline, o trabalho de serviço usa o hash de conteúdo para garantir que ele tenha buscado um instantâneo completo e autoconsistente de recursos em um único instante no tempo.</span><span class="sxs-lookup"><span data-stu-id="bfec6-205">When building a cache of offline resources, the service worker uses content hashing to guarantee it has fetched a complete and self-consistent snapshot of resources at a single instant in time.</span></span> <span data-ttu-id="bfec6-206">Esse cache é usado como uma unidade atômica.</span><span class="sxs-lookup"><span data-stu-id="bfec6-206">This cache is then used as an atomic unit.</span></span> <span data-ttu-id="bfec6-207">Não há nenhum ponto perguntando à rede os recursos mais recentes, pois as únicas versões necessárias são as já armazenadas em cache.</span><span class="sxs-lookup"><span data-stu-id="bfec6-207">There's no point asking the network for newer resources, since the only versions required are the ones already cached.</span></span> <span data-ttu-id="bfec6-208">Qualquer outra coisa afeta a inconsistência e a incompatibilidade (por exemplo, tentar usar versões de assemblies do .NET que não foram compiladas juntas).</span><span class="sxs-lookup"><span data-stu-id="bfec6-208">Anything else risks inconsistency and incompatibility (for example, trying to use versions of .NET assemblies that weren't compiled together).</span></span>

### <a name="background-updates"></a><span data-ttu-id="bfec6-209">Atualizações em segundo plano</span><span class="sxs-lookup"><span data-stu-id="bfec6-209">Background updates</span></span>

<span data-ttu-id="bfec6-210">Como um modelo mental, você pode considerar um PWA offline como se comportando como um aplicativo móvel que pode ser instalado.</span><span class="sxs-lookup"><span data-stu-id="bfec6-210">As a mental model, you can think of an offline-first PWA as behaving like a mobile app that can be installed.</span></span> <span data-ttu-id="bfec6-211">O aplicativo é iniciado imediatamente, independentemente da conectividade de rede, mas a lógica do aplicativo instalado vem de um instantâneo pontual que pode não ser a versão mais recente.</span><span class="sxs-lookup"><span data-stu-id="bfec6-211">The app starts up immediately regardless of network connectivity, but the installed app logic comes from a point-in-time snapshot that might not be the latest version.</span></span>

<span data-ttu-id="bfec6-212">O Blazor modelo do PWA produz aplicativos que tentam se atualizar automaticamente em segundo plano sempre que o usuário visita e tem uma conexão de rede em funcionamento.</span><span class="sxs-lookup"><span data-stu-id="bfec6-212">The Blazor PWA template produces apps that automatically try to update themselves in the background whenever the user visits and has a working network connection.</span></span> <span data-ttu-id="bfec6-213">A maneira como isso funciona é a seguinte:</span><span class="sxs-lookup"><span data-stu-id="bfec6-213">The way this works is as follows:</span></span>

* <span data-ttu-id="bfec6-214">Durante a compilação, o projeto gera um *manifesto de ativos de trabalho de serviço*.</span><span class="sxs-lookup"><span data-stu-id="bfec6-214">During compilation, the project generates a *service worker assets manifest*.</span></span> <span data-ttu-id="bfec6-215">Por padrão, isso é chamado `service-worker-assets.js` .</span><span class="sxs-lookup"><span data-stu-id="bfec6-215">By default, this is called `service-worker-assets.js`.</span></span> <span data-ttu-id="bfec6-216">O manifesto lista todos os recursos estáticos que o aplicativo requer para funcionar offline, como assemblies .NET, arquivos JavaScript e CSS, incluindo seus hashes de conteúdo.</span><span class="sxs-lookup"><span data-stu-id="bfec6-216">The manifest lists all the static resources that the app requires to function offline, such as .NET assemblies, JavaScript files, and CSS, including their content hashes.</span></span> <span data-ttu-id="bfec6-217">A lista de recursos é carregada pelo trabalhador do serviço para que ele saiba quais recursos armazenar em cache.</span><span class="sxs-lookup"><span data-stu-id="bfec6-217">The resource list is loaded by the service worker so that it knows which resources to cache.</span></span>
* <span data-ttu-id="bfec6-218">Cada vez que o usuário visita o aplicativo, o navegador solicita novamente `service-worker.js` e `service-worker-assets.js` em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="bfec6-218">Each time the user visits the app, the browser re-requests `service-worker.js` and `service-worker-assets.js` in the background.</span></span> <span data-ttu-id="bfec6-219">Os arquivos são comparados byte por byte com o trabalho de serviço instalado existente.</span><span class="sxs-lookup"><span data-stu-id="bfec6-219">The files are compared byte-for-byte with the existing installed service worker.</span></span> <span data-ttu-id="bfec6-220">Se o servidor retornar o conteúdo alterado para qualquer um desses arquivos, o trabalho de serviço tentará instalar uma nova versão de si mesmo.</span><span class="sxs-lookup"><span data-stu-id="bfec6-220">If the server returns changed content for either of these files, the service worker attempts to install a new version of itself.</span></span>
* <span data-ttu-id="bfec6-221">Ao instalar uma nova versão de si mesma, o trabalho de serviço cria um novo cache separado para recursos offline e começa a popular o cache com os recursos listados em `service-worker-assets.js` .</span><span class="sxs-lookup"><span data-stu-id="bfec6-221">When installing a new version of itself, the service worker creates a new, separate cache for offline resources and starts populating the cache with resources listed in `service-worker-assets.js`.</span></span> <span data-ttu-id="bfec6-222">Essa lógica é implementada na `onInstall` função dentro do `service-worker.published.js` .</span><span class="sxs-lookup"><span data-stu-id="bfec6-222">This logic is implemented in the `onInstall` function inside `service-worker.published.js`.</span></span>
* <span data-ttu-id="bfec6-223">O processo é concluído com êxito quando todos os recursos são carregados sem erros e todos os hashes de conteúdo correspondem.</span><span class="sxs-lookup"><span data-stu-id="bfec6-223">The process completes successfully when all of the resources are loaded without error and all content hashes match.</span></span> <span data-ttu-id="bfec6-224">Se for bem-sucedido, o novo trabalho de serviço entrará *em aguardando o estado de ativação* .</span><span class="sxs-lookup"><span data-stu-id="bfec6-224">If successful, the new service worker enters a *waiting for activation* state.</span></span> <span data-ttu-id="bfec6-225">Assim que o usuário fecha o aplicativo (não há guias de aplicativo restantes ou janelas), o novo trabalho de serviço torna-se *ativo* e é usado para visitas de aplicativos subsequentes.</span><span class="sxs-lookup"><span data-stu-id="bfec6-225">As soon as the user closes the app (no remaining app tabs or windows), the new service worker becomes *active* and is used for subsequent app visits.</span></span> <span data-ttu-id="bfec6-226">O antigo trabalho de serviço e seu cache são excluídos.</span><span class="sxs-lookup"><span data-stu-id="bfec6-226">The old service worker and its cache are deleted.</span></span>
* <span data-ttu-id="bfec6-227">Se o processo não for concluído com êxito, a nova instância de trabalho do serviço será descartada.</span><span class="sxs-lookup"><span data-stu-id="bfec6-227">If the process doesn't complete successfully, the new service worker instance is discarded.</span></span> <span data-ttu-id="bfec6-228">O processo de atualização foi tentado novamente na próxima visita do usuário, quando espero que o cliente tenha uma conexão de rede melhor que possa concluir as solicitações.</span><span class="sxs-lookup"><span data-stu-id="bfec6-228">The update process is attempted again on the user's next visit, when hopefully the client has a better network connection that can complete the requests.</span></span>

<span data-ttu-id="bfec6-229">Personalize esse processo editando a lógica de trabalho do serviço.</span><span class="sxs-lookup"><span data-stu-id="bfec6-229">Customize this process by editing the service worker logic.</span></span> <span data-ttu-id="bfec6-230">Nenhum dos comportamentos anteriores é específico Blazor do, mas é meramente a experiência padrão fornecida pela opção de modelo do PWA.</span><span class="sxs-lookup"><span data-stu-id="bfec6-230">None of the preceding behavior is specific to Blazor but is merely the default experience provided by the PWA template option.</span></span> <span data-ttu-id="bfec6-231">Para obter mais informações, consulte [MDN Web docs: Service Worker API](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span><span class="sxs-lookup"><span data-stu-id="bfec6-231">For more information, see [MDN web docs: Service Worker API](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span></span>

### <a name="how-requests-are-resolved"></a><span data-ttu-id="bfec6-232">Como as solicitações são resolvidas</span><span class="sxs-lookup"><span data-stu-id="bfec6-232">How requests are resolved</span></span>

<span data-ttu-id="bfec6-233">Conforme descrito na seção de [estratégia de busca em cache – primeiro](#cache-first-fetch-strategy) , o operador de serviço padrão usa uma estratégia de *cache-First* , o que significa que ele tenta fornecer conteúdo em cache quando disponível.</span><span class="sxs-lookup"><span data-stu-id="bfec6-233">As described in the [Cache-first fetch strategy](#cache-first-fetch-strategy) section, the default service worker uses a *cache-first* strategy, meaning that it tries to serve cached content when available.</span></span> <span data-ttu-id="bfec6-234">Se não houver nenhum conteúdo armazenado em cache para uma determinada URL, por exemplo, ao solicitar dados de uma API de back-end, o trabalho de serviço retornará uma solicitação de rede regular.</span><span class="sxs-lookup"><span data-stu-id="bfec6-234">If there is no content cached for a certain URL, for example when requesting data from a backend API, the service worker falls back on a regular network request.</span></span> <span data-ttu-id="bfec6-235">A solicitação de rede terá sucesso se o servidor estiver acessível.</span><span class="sxs-lookup"><span data-stu-id="bfec6-235">The network request succeeds if the server is reachable.</span></span> <span data-ttu-id="bfec6-236">Essa lógica é implementada dentro `onFetch` da função dentro do `service-worker.published.js` .</span><span class="sxs-lookup"><span data-stu-id="bfec6-236">This logic is implemented inside `onFetch` function within `service-worker.published.js`.</span></span>

<span data-ttu-id="bfec6-237">Se os componentes do aplicativo Razor dependem da solicitação de dados de APIs de back-end e você deseja fornecer uma experiência de usuário amigável para solicitações com falha devido à indisponibilidade da rede, implemente a lógica nos componentes do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="bfec6-237">If the app's Razor components rely on requesting data from backend APIs and you want to provide a friendly user experience for failed requests due to network unavailability, implement logic within the app's components.</span></span> <span data-ttu-id="bfec6-238">Por exemplo, use `try/catch` solicitações ao contrário <xref:System.Net.Http.HttpClient> .</span><span class="sxs-lookup"><span data-stu-id="bfec6-238">For example, use `try/catch` around <xref:System.Net.Http.HttpClient> requests.</span></span>

### <a name="support-server-rendered-pages"></a><span data-ttu-id="bfec6-239">Suporte a páginas renderizadas pelo servidor</span><span class="sxs-lookup"><span data-stu-id="bfec6-239">Support server-rendered pages</span></span>

<span data-ttu-id="bfec6-240">Considere o que acontece quando o usuário navega pela primeira vez para uma URL, como `/counter` ou qualquer outro link profundo no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="bfec6-240">Consider what happens when the user first navigates to a URL such as `/counter` or any other deep link in the app.</span></span> <span data-ttu-id="bfec6-241">Nesses casos, você não deseja retornar o conteúdo armazenado em cache como `/counter` , mas, em vez disso, precisa do navegador para carregar o conteúdo armazenado em cache como `/index.html` para iniciar seu Blazor WebAssembly aplicativo.</span><span class="sxs-lookup"><span data-stu-id="bfec6-241">In these cases, you don't want to return content cached as `/counter`, but instead need the browser to load the content cached as `/index.html` to start up your Blazor WebAssembly app.</span></span> <span data-ttu-id="bfec6-242">Essas solicitações iniciais são conhecidas como solicitações de *navegação* , em oposição a:</span><span class="sxs-lookup"><span data-stu-id="bfec6-242">These initial requests are known as *navigation* requests, as opposed to:</span></span>

* <span data-ttu-id="bfec6-243">`subresource` solicitações de imagens, folhas de estilos ou outros arquivos.</span><span class="sxs-lookup"><span data-stu-id="bfec6-243">`subresource` requests for images, stylesheets, or other files.</span></span>
* <span data-ttu-id="bfec6-244">`fetch/XHR` solicitações de dados de API.</span><span class="sxs-lookup"><span data-stu-id="bfec6-244">`fetch/XHR` requests for API data.</span></span>

<span data-ttu-id="bfec6-245">O operador de serviço padrão contém uma lógica de caso especial para solicitações de navegação.</span><span class="sxs-lookup"><span data-stu-id="bfec6-245">The default service worker contains special-case logic for navigation requests.</span></span> <span data-ttu-id="bfec6-246">O trabalho de serviço resolve as solicitações retornando o conteúdo armazenado em cache para `/index.html` , independentemente da URL solicitada.</span><span class="sxs-lookup"><span data-stu-id="bfec6-246">The service worker resolves the requests by returning the cached content for `/index.html`, regardless of the requested URL.</span></span> <span data-ttu-id="bfec6-247">Essa lógica é implementada na `onFetch` função dentro do `service-worker.published.js` .</span><span class="sxs-lookup"><span data-stu-id="bfec6-247">This logic is implemented in the `onFetch` function inside `service-worker.published.js`.</span></span>

<span data-ttu-id="bfec6-248">Se seu aplicativo tiver determinadas URLs que devem retornar o HTML renderizado pelo servidor e não atender `/index.html` do cache, você precisará editar a lógica em seu trabalho de serviço.</span><span class="sxs-lookup"><span data-stu-id="bfec6-248">If your app has certain URLs that must return server-rendered HTML, and not serve `/index.html` from the cache, then you need to edit the logic in your service worker.</span></span> <span data-ttu-id="bfec6-249">Se todas as URLs que contêm `/Identity/` precisam ser tratadas como solicitações regulares somente online para o servidor, modifique a `service-worker.published.js` `onFetch` lógica.</span><span class="sxs-lookup"><span data-stu-id="bfec6-249">If all URLs containing `/Identity/` need to be handled as regular online-only requests to the server, then modify `service-worker.published.js` `onFetch` logic.</span></span> <span data-ttu-id="bfec6-250">Localize o código a seguir:</span><span class="sxs-lookup"><span data-stu-id="bfec6-250">Locate the following code:</span></span>

```javascript
const shouldServeIndexHtml = event.request.mode === 'navigate';
```

<span data-ttu-id="bfec6-251">Altere o código para o seguinte:</span><span class="sxs-lookup"><span data-stu-id="bfec6-251">Change the code to the following:</span></span>

```javascript
const shouldServeIndexHtml = event.request.mode === 'navigate'
    && !event.request.url.includes('/Identity/');
```

<span data-ttu-id="bfec6-252">Se você não fizer isso, independentemente da conectividade de rede, o trabalho de serviço interceptará as solicitações para essas URLs e as resolverá usando `/index.html` .</span><span class="sxs-lookup"><span data-stu-id="bfec6-252">If you don't do this, then regardless of network connectivity, the service worker intercepts requests for such URLs and resolves them using `/index.html`.</span></span>

### <a name="control-asset-caching"></a><span data-ttu-id="bfec6-253">Controlar o cache de ativos</span><span class="sxs-lookup"><span data-stu-id="bfec6-253">Control asset caching</span></span>

<span data-ttu-id="bfec6-254">Se o projeto definir a `ServiceWorkerAssetsManifest` Propriedade do MSBuild, as Blazor ferramentas de compilação geram um manifesto de ativos de trabalho de serviço com o nome especificado.</span><span class="sxs-lookup"><span data-stu-id="bfec6-254">If your project defines the `ServiceWorkerAssetsManifest` MSBuild property, Blazor's build tooling generates a service worker assets manifest with the specified name.</span></span> <span data-ttu-id="bfec6-255">O modelo do PWA padrão produz um arquivo de projeto que contém a seguinte propriedade:</span><span class="sxs-lookup"><span data-stu-id="bfec6-255">The default PWA template produces a project file containing the following property:</span></span>

```xml
<ServiceWorkerAssetsManifest>service-worker-assets.js</ServiceWorkerAssetsManifest>
```

<span data-ttu-id="bfec6-256">O arquivo é colocado no `wwwroot` diretório de saída, portanto, o navegador pode recuperar esse arquivo solicitando `/service-worker-assets.js` .</span><span class="sxs-lookup"><span data-stu-id="bfec6-256">The file is placed in the `wwwroot` output directory, so the browser can retrieve this file by requesting `/service-worker-assets.js`.</span></span> <span data-ttu-id="bfec6-257">Para ver o conteúdo desse arquivo, abra `/bin/Debug/{TARGET FRAMEWORK}/wwwroot/service-worker-assets.js` em um editor de texto.</span><span class="sxs-lookup"><span data-stu-id="bfec6-257">To see the contents of this file, open `/bin/Debug/{TARGET FRAMEWORK}/wwwroot/service-worker-assets.js` in a text editor.</span></span> <span data-ttu-id="bfec6-258">No entanto, não edite o arquivo, pois ele é regenerado em cada compilação.</span><span class="sxs-lookup"><span data-stu-id="bfec6-258">However, don't edit the file, as it's regenerated on each build.</span></span>

<span data-ttu-id="bfec6-259">Por padrão, este manifesto lista:</span><span class="sxs-lookup"><span data-stu-id="bfec6-259">By default, this manifest lists:</span></span>

* <span data-ttu-id="bfec6-260">Todos os Blazor recursos gerenciados, como assemblies .net e os arquivos de tempo de execução .net Webassembly necessários para funcionar offline.</span><span class="sxs-lookup"><span data-stu-id="bfec6-260">Any Blazor-managed resources, such as .NET assemblies and the .NET WebAssembly runtime files required to function offline.</span></span>
* <span data-ttu-id="bfec6-261">Todos os recursos para publicação no diretório do aplicativo `wwwroot` , como imagens, folhas de estilos e arquivos JavaScript, incluindo ativos estáticos da Web fornecidos por projetos externos e pacotes NuGet.</span><span class="sxs-lookup"><span data-stu-id="bfec6-261">All resources for publishing to the app's `wwwroot` directory, such as images, stylesheets, and JavaScript files, including static web assets supplied by external projects and NuGet packages.</span></span>

<span data-ttu-id="bfec6-262">Você pode controlar quais desses recursos são buscados e armazenados em cache pelo trabalhador do serviço editando a lógica no `onInstall` no `service-worker.published.js` .</span><span class="sxs-lookup"><span data-stu-id="bfec6-262">You can control which of these resources are fetched and cached by the service worker by editing the logic in `onInstall` in `service-worker.published.js`.</span></span> <span data-ttu-id="bfec6-263">Por padrão, o trabalho de serviço busca e armazena em cache os arquivos que correspondem às extensões de nome de arquivo da Web típicas, como `.html` ,, `.css` `.js` e `.wasm` , além dos tipos de arquivos específicos para Blazor WebAssembly ( `.dll` , `.pdb` ).</span><span class="sxs-lookup"><span data-stu-id="bfec6-263">By default, the service worker fetches and caches files matching typical web filename extensions such as `.html`, `.css`, `.js`, and `.wasm`, plus file types specific to Blazor WebAssembly (`.dll`, `.pdb`).</span></span>

<span data-ttu-id="bfec6-264">Para incluir recursos adicionais que não estão presentes no diretório do aplicativo `wwwroot` , defina entradas adicionais do MSBuild `ItemGroup` , conforme mostrado no exemplo a seguir:</span><span class="sxs-lookup"><span data-stu-id="bfec6-264">To include additional resources that aren't present in the app's `wwwroot` directory, define extra MSBuild `ItemGroup` entries, as shown in the following example:</span></span>

```xml
<ItemGroup>
  <ServiceWorkerAssetsManifestItem Include="MyDirectory\AnotherFile.json"
    RelativePath="MyDirectory\AnotherFile.json" AssetUrl="files/AnotherFile.json" />
</ItemGroup>
```

<span data-ttu-id="bfec6-265">Os `AssetUrl` metadados especificam a URL relativa à base que o navegador deve usar ao buscar o recurso para armazenar em cache.</span><span class="sxs-lookup"><span data-stu-id="bfec6-265">The `AssetUrl` metadata specifies the base-relative URL that the browser should use when fetching the resource to cache.</span></span> <span data-ttu-id="bfec6-266">Isso pode ser independente de seu nome de arquivo de origem original no disco.</span><span class="sxs-lookup"><span data-stu-id="bfec6-266">This can be independent of its original source file name on disk.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="bfec6-267">A adição de um `ServiceWorkerAssetsManifestItem` não faz com que o arquivo seja publicado no `wwwroot` diretório do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="bfec6-267">Adding a `ServiceWorkerAssetsManifestItem` doesn't cause the file to be published in the app's `wwwroot` directory.</span></span> <span data-ttu-id="bfec6-268">A saída de publicação deve ser controlada separadamente.</span><span class="sxs-lookup"><span data-stu-id="bfec6-268">The publish output must be controlled separately.</span></span> <span data-ttu-id="bfec6-269">O `ServiceWorkerAssetsManifestItem` só faz com que uma entrada adicional apareça no manifesto de ativos de trabalho do serviço.</span><span class="sxs-lookup"><span data-stu-id="bfec6-269">The `ServiceWorkerAssetsManifestItem` only causes an additional entry to appear in the service worker assets manifest.</span></span>

## <a name="push-notifications"></a><span data-ttu-id="bfec6-270">Notificações por push</span><span class="sxs-lookup"><span data-stu-id="bfec6-270">Push notifications</span></span>

<span data-ttu-id="bfec6-271">Como qualquer outro PWA, um Blazor WebAssembly PWA pode receber notificações por push de um servidor de back-end.</span><span class="sxs-lookup"><span data-stu-id="bfec6-271">Like any other PWA, a Blazor WebAssembly PWA can receive push notifications from a backend server.</span></span> <span data-ttu-id="bfec6-272">O servidor pode enviar notificações por push a qualquer momento, mesmo quando o usuário não está usando o aplicativo ativamente.</span><span class="sxs-lookup"><span data-stu-id="bfec6-272">The server can send push notifications at any time, even when the user isn't actively using the app.</span></span> <span data-ttu-id="bfec6-273">Por exemplo, notificações por push podem ser enviadas quando um usuário diferente executa uma ação relevante.</span><span class="sxs-lookup"><span data-stu-id="bfec6-273">For example, push notifications can be sent when a different user performs a relevant action.</span></span>

<span data-ttu-id="bfec6-274">O mecanismo para enviar uma notificação por push é totalmente independente do Blazor WebAssembly , pois é implementado pelo servidor back-end que pode usar qualquer tecnologia.</span><span class="sxs-lookup"><span data-stu-id="bfec6-274">The mechanism for sending a push notification is entirely independent of Blazor WebAssembly, since it's implemented by the backend server which can use any technology.</span></span> <span data-ttu-id="bfec6-275">Se você quiser enviar notificações por push de um servidor de ASP.NET Core, considere [usar uma técnica semelhante à abordagem adotada no workshop de pizza incrivelmente](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#sending-push-notifications).</span><span class="sxs-lookup"><span data-stu-id="bfec6-275">If you want to send push notifications from an ASP.NET Core server, consider [using a technique similar to the approach taken in the Blazing Pizza workshop](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#sending-push-notifications).</span></span>

<span data-ttu-id="bfec6-276">O mecanismo para receber e exibir uma notificação por push no cliente também é independente do Blazor WebAssembly , pois ele é implementado no arquivo JavaScript de trabalho do serviço.</span><span class="sxs-lookup"><span data-stu-id="bfec6-276">The mechanism for receiving and displaying a push notification on the client is also independent of Blazor WebAssembly, since it's implemented in the service worker JavaScript file.</span></span> <span data-ttu-id="bfec6-277">Para obter um exemplo, consulte [a abordagem usada no workshop de pizza incrivelmente](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#displaying-notifications).</span><span class="sxs-lookup"><span data-stu-id="bfec6-277">For an example, see [the approach used in the Blazing Pizza workshop](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#displaying-notifications).</span></span>

## <a name="caveats-for-offline-pwas"></a><span data-ttu-id="bfec6-278">Advertências para PWAs offline</span><span class="sxs-lookup"><span data-stu-id="bfec6-278">Caveats for offline PWAs</span></span>

<span data-ttu-id="bfec6-279">Nem todos os aplicativos devem tentar dar suporte ao uso offline.</span><span class="sxs-lookup"><span data-stu-id="bfec6-279">Not all apps should attempt to support offline use.</span></span> <span data-ttu-id="bfec6-280">O suporte offline adiciona uma complexidade significativa, embora nem sempre seja relevante para os casos de uso necessários.</span><span class="sxs-lookup"><span data-stu-id="bfec6-280">Offline support adds significant complexity, while not always being relevant for the use cases required.</span></span>

<span data-ttu-id="bfec6-281">O suporte offline geralmente é relevante apenas:</span><span class="sxs-lookup"><span data-stu-id="bfec6-281">Offline support is usually relevant only:</span></span>

* <span data-ttu-id="bfec6-282">Se o repositório de dados primário for local para o navegador.</span><span class="sxs-lookup"><span data-stu-id="bfec6-282">If the primary data store is local to the browser.</span></span> <span data-ttu-id="bfec6-283">Por exemplo, a abordagem é relevante em um aplicativo com uma interface do usuário para um dispositivo [IOT](https://en.wikipedia.org/wiki/Internet_of_things) que armazena dados no `localStorage` ou [IndexedDB](https://developer.mozilla.org/docs/Web/API/IndexedDB_API).</span><span class="sxs-lookup"><span data-stu-id="bfec6-283">For example, the approach is relevant in an app with a UI for an [IoT](https://en.wikipedia.org/wiki/Internet_of_things) device that stores data in `localStorage` or [IndexedDB](https://developer.mozilla.org/docs/Web/API/IndexedDB_API).</span></span>
* <span data-ttu-id="bfec6-284">Se o aplicativo executar uma quantidade significativa de trabalho para buscar e armazenar em cache os dados de API de back-end relevantes para cada usuário para que eles possam navegar pelos dados offline.</span><span class="sxs-lookup"><span data-stu-id="bfec6-284">If the app performs a significant amount of work to fetch and cache the backend API data relevant to each user so that they can navigate through the data offline.</span></span> <span data-ttu-id="bfec6-285">Se o aplicativo precisar dar suporte à edição, um sistema para controlar as alterações e sincronizar dados com o back-end deve ser criado.</span><span class="sxs-lookup"><span data-stu-id="bfec6-285">If the app must support editing, a system for tracking changes and synchronizing data with the backend must be built.</span></span>
* <span data-ttu-id="bfec6-286">Se o objetivo é garantir que o aplicativo seja carregado imediatamente, independentemente das condições de rede.</span><span class="sxs-lookup"><span data-stu-id="bfec6-286">If the goal is to guarantee that the app loads immediately regardless of network conditions.</span></span> <span data-ttu-id="bfec6-287">Implemente uma experiência de usuário adequada em relação a solicitações de API de back-end para mostrar o progresso das solicitações e se comportar normalmente quando as solicitações falharem devido à indisponibilidade da rede</span><span class="sxs-lookup"><span data-stu-id="bfec6-287">Implement a suitable user experience around backend API requests to show the progress of requests and behave gracefully when requests fail due to network unavailability.</span></span>

<span data-ttu-id="bfec6-288">Além disso, o PWAs com capacidade offline deve lidar com uma variedade de complicações adicionais.</span><span class="sxs-lookup"><span data-stu-id="bfec6-288">Additionally, offline-capable PWAs must deal with a range of additional complications.</span></span> <span data-ttu-id="bfec6-289">Os desenvolvedores devem se familiarizar cuidadosamente com as advertências nas seções a seguir.</span><span class="sxs-lookup"><span data-stu-id="bfec6-289">Developers should carefully familiarize themselves with the caveats in the following sections.</span></span>

### <a name="offline-support-only-when-published"></a><span data-ttu-id="bfec6-290">Suporte offline somente quando publicado</span><span class="sxs-lookup"><span data-stu-id="bfec6-290">Offline support only when published</span></span>

<span data-ttu-id="bfec6-291">Durante o desenvolvimento, normalmente você desejará ver cada alteração refletida imediatamente no navegador sem passar por um processo de atualização em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="bfec6-291">During development you typically want to see each change reflected immediately in the browser without going through a background update process.</span></span> <span data-ttu-id="bfec6-292">Portanto, o Blazor modelo do PWA permite o suporte offline somente quando publicado.</span><span class="sxs-lookup"><span data-stu-id="bfec6-292">Therefore, Blazor's PWA template enables offline support only when published.</span></span>

<span data-ttu-id="bfec6-293">Ao criar um aplicativo com capacidade offline, não é suficiente testar o aplicativo no ambiente de desenvolvimento.</span><span class="sxs-lookup"><span data-stu-id="bfec6-293">When building an offline-capable app, it's not enough to test the app in the Development environment.</span></span> <span data-ttu-id="bfec6-294">Você deve testar o aplicativo em seu estado publicado para entender como ele responde a condições de rede diferentes.</span><span class="sxs-lookup"><span data-stu-id="bfec6-294">You must test the app in its published state to understand how it responds to different network conditions.</span></span>

### <a name="update-completion-after-user-navigation-away-from-app"></a><span data-ttu-id="bfec6-295">Atualizar a conclusão após a navegação do usuário para fora do aplicativo</span><span class="sxs-lookup"><span data-stu-id="bfec6-295">Update completion after user navigation away from app</span></span>

<span data-ttu-id="bfec6-296">As atualizações não são concluídas até que o usuário navegue para fora do aplicativo em todas as guias.</span><span class="sxs-lookup"><span data-stu-id="bfec6-296">Updates don't complete until the user has navigated away from the app in all tabs.</span></span> <span data-ttu-id="bfec6-297">Conforme explicado na seção [atualizações em segundo plano](#background-updates) , depois de implantar uma atualização para o aplicativo, o navegador busca os arquivos de trabalho do serviço atualizados para iniciar o processo de atualização.</span><span class="sxs-lookup"><span data-stu-id="bfec6-297">As explained in the [Background updates](#background-updates) section, after you deploy an update to the app, the browser fetches the updated service worker files to begin the update process.</span></span>

<span data-ttu-id="bfec6-298">O que surpreende muitos desenvolvedores é que, mesmo quando essa atualização é concluída, ela **não** tem efeito até que o usuário tenha navegado para fora em todas as guias.</span><span class="sxs-lookup"><span data-stu-id="bfec6-298">What surprises many developers is that, even when this update completes, it does **not** take effect until the user has navigated away in all tabs.</span></span> <span data-ttu-id="bfec6-299">**Não** é suficiente atualizar a guia exibindo o aplicativo, mesmo se for a única guia que exibe o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="bfec6-299">It is **not** sufficient to refresh the tab displaying the app, even if it's the only tab displaying the app.</span></span> <span data-ttu-id="bfec6-300">Até que seu aplicativo seja completamente fechado, o novo trabalho de serviço permanecerá no status *aguardando para ativar* .</span><span class="sxs-lookup"><span data-stu-id="bfec6-300">Until your app is completely closed, the new service worker remains in the *waiting to activate* status.</span></span> <span data-ttu-id="bfec6-301">**Isso não é específico do Blazor , mas sim um comportamento de plataforma da Web padrão.**</span><span class="sxs-lookup"><span data-stu-id="bfec6-301">**This is not specific to Blazor, but rather is a standard web platform behavior.**</span></span>

<span data-ttu-id="bfec6-302">Isso normalmente problemas os desenvolvedores que estão tentando testar atualizações para seu trabalho de serviço ou recursos armazenados em cache offline.</span><span class="sxs-lookup"><span data-stu-id="bfec6-302">This commonly troubles developers who are trying to test updates to their service worker or offline cached resources.</span></span> <span data-ttu-id="bfec6-303">Se você fizer check-in das ferramentas de desenvolvedor do navegador, poderá ver algo semelhante ao seguinte:</span><span class="sxs-lookup"><span data-stu-id="bfec6-303">If you check in the browser's developer tools, you may see something like the following:</span></span>

![A guia "aplicativo" do Google Chrome mostra que o trabalho do serviço do aplicativo é "aguardando para ativar".](progressive-web-app/_static/image7.png)

<span data-ttu-id="bfec6-305">Enquanto a lista de "clientes", que são guias ou janelas que exibem seu aplicativo, não está vazia, o trabalho continua aguardando.</span><span class="sxs-lookup"><span data-stu-id="bfec6-305">For as long as the list of "clients," which are tabs or windows displaying your app, is nonempty, the worker continues waiting.</span></span> <span data-ttu-id="bfec6-306">O motivo pelo qual os trabalhadores de serviço fazem isso é garantir a consistência.</span><span class="sxs-lookup"><span data-stu-id="bfec6-306">The reason service workers do this is to guarantee consistency.</span></span> <span data-ttu-id="bfec6-307">Consistência significa que todos os recursos são buscados do mesmo cache atômico.</span><span class="sxs-lookup"><span data-stu-id="bfec6-307">Consistency means that all resources are fetched from the same atomic cache.</span></span>

<span data-ttu-id="bfec6-308">Ao testar alterações, talvez seja conveniente clicar no link "skipWaiting", conforme mostrado na captura de tela anterior, e recarregar a página.</span><span class="sxs-lookup"><span data-stu-id="bfec6-308">When testing changes, you may find it convenient to click the "skipWaiting" link as shown in the preceding screenshot, then reload the page.</span></span> <span data-ttu-id="bfec6-309">Você pode automatizar isso para todos os usuários codificando seu operador de serviço para [ignorar a fase de "espera" e ativá-la imediatamente na atualização](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#skip_the_waiting_phase).</span><span class="sxs-lookup"><span data-stu-id="bfec6-309">You can automate this for all users by coding your service worker to [skip the "waiting" phase and immediately activate on update](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#skip_the_waiting_phase).</span></span> <span data-ttu-id="bfec6-310">Se você ignorar a fase de espera, estará fazendo a garantia de que os recursos são sempre buscados consistentemente da mesma instância de cache.</span><span class="sxs-lookup"><span data-stu-id="bfec6-310">If you skip the waiting phase, you're giving up the guarantee that resources are always fetched consistently from the same cache instance.</span></span>

### <a name="users-may-run-any-historical-version-of-the-app"></a><span data-ttu-id="bfec6-311">Os usuários podem executar qualquer versão histórica do aplicativo</span><span class="sxs-lookup"><span data-stu-id="bfec6-311">Users may run any historical version of the app</span></span>

<span data-ttu-id="bfec6-312">Os desenvolvedores da Web recompensadores esperam que os usuários executem apenas a versão mais recente implantada de seu aplicativo Web, pois isso é normal no modelo de distribuição da Web tradicional.</span><span class="sxs-lookup"><span data-stu-id="bfec6-312">Web developers habitually expect that users only run the latest deployed version of their web app, since that's normal within the traditional web distribution model.</span></span> <span data-ttu-id="bfec6-313">No entanto, um PWA offline primeiro é mais semelhante a um aplicativo móvel nativo, onde os usuários não estão necessariamente executando a versão mais recente.</span><span class="sxs-lookup"><span data-stu-id="bfec6-313">However, an offline-first PWA is more akin to a native mobile app, where users aren't necessarily running the latest version.</span></span>

<span data-ttu-id="bfec6-314">Conforme explicado na seção [atualizações em segundo plano](#background-updates) , depois de implantar uma atualização em seu aplicativo, **cada usuário existente continua a usar uma versão anterior para pelo menos uma visita adicional** , pois a atualização ocorre em segundo plano e não é ativada até que o usuário saia de fora.</span><span class="sxs-lookup"><span data-stu-id="bfec6-314">As explained in the [Background updates](#background-updates) section, after you deploy an update to your app, **each existing user continues to use a previous version for at least one further visit** because the update occurs in the background and isn't activated until the user thereafter navigates away.</span></span> <span data-ttu-id="bfec6-315">Além disso, a versão anterior que está sendo usada não é necessariamente a anterior que você implantou.</span><span class="sxs-lookup"><span data-stu-id="bfec6-315">Plus, the previous version being used isn't necessarily the previous one you deployed.</span></span> <span data-ttu-id="bfec6-316">A versão anterior pode ser *qualquer* versão histórica, dependendo de quando o usuário concluiu a última vez uma atualização.</span><span class="sxs-lookup"><span data-stu-id="bfec6-316">The previous version can be *any* historical version, depending on when the user last completed an update.</span></span>

<span data-ttu-id="bfec6-317">Isso pode ser um problema se as partes de frontend e back-end do seu aplicativo exigirem contrato sobre o esquema para solicitações de API.</span><span class="sxs-lookup"><span data-stu-id="bfec6-317">This can be an issue if the frontend and backend parts of your app require agreement about the schema for API requests.</span></span> <span data-ttu-id="bfec6-318">Você não deve implantar alterações de esquema de API incompatíveis com versões anteriores até que possa ter certeza de que todos os usuários foram atualizados.</span><span class="sxs-lookup"><span data-stu-id="bfec6-318">You must not deploy backward-incompatible API schema changes until you can be sure that all users have upgraded.</span></span> <span data-ttu-id="bfec6-319">Como alternativa, bloqueie os usuários de usar versões mais antigas incompatíveis do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="bfec6-319">Alternatively, block users from using incompatible older versions of the app.</span></span> <span data-ttu-id="bfec6-320">Esse requisito de cenário é o mesmo para aplicativos móveis nativos.</span><span class="sxs-lookup"><span data-stu-id="bfec6-320">This scenario requirement is the same as for native mobile apps.</span></span> <span data-ttu-id="bfec6-321">Se você implantar uma alteração significativa nas APIs do servidor, o aplicativo cliente será interrompido para os usuários que ainda não foram atualizados.</span><span class="sxs-lookup"><span data-stu-id="bfec6-321">If you deploy a breaking change in server APIs, the client app is broken for users who haven't yet updated.</span></span>

<span data-ttu-id="bfec6-322">Se possível, não implante alterações significativas em suas APIs de back-end.</span><span class="sxs-lookup"><span data-stu-id="bfec6-322">If possible, don't deploy breaking changes to your backend APIs.</span></span> <span data-ttu-id="bfec6-323">Se você precisar fazer isso, considere o uso de [APIs de trabalho de serviço padrão](https://developer.mozilla.org/docs/Web/API/ServiceWorkerRegistration) , como ServiceWorkerRegistration, para determinar se o aplicativo está atualizado e, se não, para evitar o uso.</span><span class="sxs-lookup"><span data-stu-id="bfec6-323">If you must do so, consider using [standard Service Worker APIs such as ServiceWorkerRegistration](https://developer.mozilla.org/docs/Web/API/ServiceWorkerRegistration) to determine whether the app is up-to-date, and if not, to prevent usage.</span></span>

### <a name="interference-with-server-rendered-pages"></a><span data-ttu-id="bfec6-324">Interferência com páginas renderizadas pelo servidor</span><span class="sxs-lookup"><span data-stu-id="bfec6-324">Interference with server-rendered pages</span></span>

<span data-ttu-id="bfec6-325">Conforme descrito na seção [support Server-](#support-server-rendered-pages) requested pages, se você quiser ignorar o comportamento do trabalhador de serviço de retornar o `/index.html` conteúdo para todas as solicitações de navegação, edite a lógica em seu trabalho de serviço.</span><span class="sxs-lookup"><span data-stu-id="bfec6-325">As described in the [Support server-rendered pages](#support-server-rendered-pages) section, if you want to bypass the service worker's behavior of returning `/index.html` contents for all navigation requests, edit the logic in your service worker.</span></span>

### <a name="all-service-worker-asset-manifest-contents-are-cached-by-default"></a><span data-ttu-id="bfec6-326">Todos os conteúdos do manifesto de ativos de trabalho de serviço são armazenados em cache por padrão</span><span class="sxs-lookup"><span data-stu-id="bfec6-326">All service worker asset manifest contents are cached by default</span></span>

<span data-ttu-id="bfec6-327">Conforme descrito na seção [controlar ativo Caching](#control-asset-caching) , o arquivo `service-worker-assets.js` é gerado durante a compilação e lista todos os ativos que o trabalho de serviço deve buscar e armazenar em cache.</span><span class="sxs-lookup"><span data-stu-id="bfec6-327">As described in the [Control asset caching](#control-asset-caching) section, the file `service-worker-assets.js` is generated during build and lists all assets the service worker should fetch and cache.</span></span>

<span data-ttu-id="bfec6-328">Como essa lista, por padrão, inclui tudo emitido para o `wwwroot` , incluindo o conteúdo fornecido por pacotes e projetos externos, você deve ter cuidado para não colocar muito conteúdo lá.</span><span class="sxs-lookup"><span data-stu-id="bfec6-328">Since this list by default includes everything emitted to `wwwroot`, including content supplied by external packages and projects, you must be careful not to put too much content there.</span></span> <span data-ttu-id="bfec6-329">Se o `wwwroot` diretório contiver milhões de imagens, o trabalho de serviço tentará buscar e armazenar em cache todas elas, consumindo largura de banda excessiva e provavelmente não será concluído com êxito.</span><span class="sxs-lookup"><span data-stu-id="bfec6-329">If the `wwwroot` directory contains millions of images, the service worker tries to fetch and cache them all, consuming excessive bandwidth and most likely not completing successfully.</span></span>

<span data-ttu-id="bfec6-330">Implemente uma lógica arbitrária para controlar qual subconjunto do conteúdo do manifesto deve ser buscado e armazenado em cache editando a `onInstall` função no `service-worker.published.js` .</span><span class="sxs-lookup"><span data-stu-id="bfec6-330">Implement arbitrary logic to control which subset of the manifest's contents should be fetched and cached by editing the `onInstall` function in `service-worker.published.js`.</span></span>

### <a name="interaction-with-authentication"></a><span data-ttu-id="bfec6-331">Interação com autenticação</span><span class="sxs-lookup"><span data-stu-id="bfec6-331">Interaction with authentication</span></span>

<span data-ttu-id="bfec6-332">O modelo do PWA pode ser usado em conjunto com a autenticação do.</span><span class="sxs-lookup"><span data-stu-id="bfec6-332">The PWA template can be used in conjunction with authentication.</span></span> <span data-ttu-id="bfec6-333">Um PWA compatível com offline também pode dar suporte à autenticação quando o usuário tem conectividade de rede inicial.</span><span class="sxs-lookup"><span data-stu-id="bfec6-333">An offline-capable PWA can also support authentication when the user has initial network connectivity.</span></span>

<span data-ttu-id="bfec6-334">Quando um usuário não tem conectividade de rede, ele não pode autenticar ou obter tokens de acesso.</span><span class="sxs-lookup"><span data-stu-id="bfec6-334">When a user doesn't have network connectivity, they can't authenticate or obtain access tokens.</span></span> <span data-ttu-id="bfec6-335">Por padrão, a tentativa de visitar a página de logon sem acesso à rede resulta em uma mensagem de "erro de rede".</span><span class="sxs-lookup"><span data-stu-id="bfec6-335">By default, attempting to visit the login page without network access results in a "network error" message.</span></span> <span data-ttu-id="bfec6-336">Você deve criar um fluxo de interface do usuário que permita ao usuário executar tarefas úteis enquanto estiver offline sem tentar autenticar o usuário ou obter tokens de acesso.</span><span class="sxs-lookup"><span data-stu-id="bfec6-336">You must design a UI flow that allows the user perform useful tasks while offline without attempting to authenticate the user or obtain access tokens.</span></span> <span data-ttu-id="bfec6-337">Como alternativa, você pode criar o aplicativo para falhar normalmente quando a rede não estiver disponível.</span><span class="sxs-lookup"><span data-stu-id="bfec6-337">Alternatively, you can design the app to gracefully fail when the network isn't available.</span></span> <span data-ttu-id="bfec6-338">Se o aplicativo não puder ser criado para lidar com esses cenários, talvez você não queira habilitar o suporte offline.</span><span class="sxs-lookup"><span data-stu-id="bfec6-338">If the app can't be designed to handle these scenarios, you might not want to enable offline support.</span></span>

<span data-ttu-id="bfec6-339">Quando um aplicativo que é projetado para uso online e offline está online novamente:</span><span class="sxs-lookup"><span data-stu-id="bfec6-339">When an app that's designed for online and offline use is online again:</span></span>

* <span data-ttu-id="bfec6-340">O aplicativo pode precisar provisionar um novo token de acesso.</span><span class="sxs-lookup"><span data-stu-id="bfec6-340">The app might need to provision a new access token.</span></span>
* <span data-ttu-id="bfec6-341">O aplicativo deve detectar se um usuário diferente está conectado ao serviço para que ele possa aplicar operações à conta do usuário que foram feitas enquanto estavam offline.</span><span class="sxs-lookup"><span data-stu-id="bfec6-341">The app must detect if a different user is signed into the service so that it can apply operations to the user's account that were made while they were offline.</span></span>

<span data-ttu-id="bfec6-342">Para criar um aplicativo do PWA offline que interaja com a autenticação:</span><span class="sxs-lookup"><span data-stu-id="bfec6-342">To create an offline PWA app that interacts with authentication:</span></span>

* <span data-ttu-id="bfec6-343">Substitua o <xref:Microsoft.AspNetCore.Components.WebAssembly.Authentication.AccountClaimsPrincipalFactory%601> por uma fábrica que armazena o último usuário conectado e use o usuário armazenado quando o aplicativo estiver offline.</span><span class="sxs-lookup"><span data-stu-id="bfec6-343">Replace the <xref:Microsoft.AspNetCore.Components.WebAssembly.Authentication.AccountClaimsPrincipalFactory%601> with a factory that stores the last signed-in user and uses the stored user when the app is offline.</span></span>
* <span data-ttu-id="bfec6-344">Enfileirar operações enquanto o aplicativo estiver offline e aplicá-las quando o aplicativo retornar online.</span><span class="sxs-lookup"><span data-stu-id="bfec6-344">Queue operations while the app is offline and apply them when the app returns online.</span></span>
* <span data-ttu-id="bfec6-345">Durante a saída, limpe o usuário armazenado.</span><span class="sxs-lookup"><span data-stu-id="bfec6-345">During sign out, clear the stored user.</span></span>

<span data-ttu-id="bfec6-346">O [`CarChecker`](https://github.com/SteveSandersonMS/CarChecker) aplicativo de exemplo demonstra as abordagens anteriores.</span><span class="sxs-lookup"><span data-stu-id="bfec6-346">The [`CarChecker`](https://github.com/SteveSandersonMS/CarChecker) sample app demonstrates the preceding approaches.</span></span> <span data-ttu-id="bfec6-347">Consulte as seguintes partes do aplicativo:</span><span class="sxs-lookup"><span data-stu-id="bfec6-347">See the following parts of the app:</span></span>

* <span data-ttu-id="bfec6-348">`OfflineAccountClaimsPrincipalFactory` (`Client/Data/OfflineAccountClaimsPrincipalFactory.cs`)</span><span class="sxs-lookup"><span data-stu-id="bfec6-348">`OfflineAccountClaimsPrincipalFactory` (`Client/Data/OfflineAccountClaimsPrincipalFactory.cs`)</span></span>
* <span data-ttu-id="bfec6-349">`LocalVehiclesStore` (`Client/Data/LocalVehiclesStore.cs`)</span><span class="sxs-lookup"><span data-stu-id="bfec6-349">`LocalVehiclesStore` (`Client/Data/LocalVehiclesStore.cs`)</span></span>
* <span data-ttu-id="bfec6-350">`LoginStatus` componente ( `Client/Shared/LoginStatus.razor` )</span><span class="sxs-lookup"><span data-stu-id="bfec6-350">`LoginStatus` component (`Client/Shared/LoginStatus.razor`)</span></span>

## <a name="additional-resources"></a><span data-ttu-id="bfec6-351">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="bfec6-351">Additional resources</span></span>

* [<span data-ttu-id="bfec6-352">Solucionar problemas de script do PowerShell de integridade</span><span class="sxs-lookup"><span data-stu-id="bfec6-352">Troubleshoot integrity PowerShell script</span></span>](xref:blazor/host-and-deploy/webassembly#troubleshoot-integrity-powershell-script)
* [<span data-ttu-id="bfec6-353">SignalR negociação entre origens para autenticação</span><span class="sxs-lookup"><span data-stu-id="bfec6-353">SignalR cross-origin negotiation for authentication</span></span>](xref:blazor/fundamentals/additional-scenarios#signalr-cross-origin-negotiation-for-authentication)
