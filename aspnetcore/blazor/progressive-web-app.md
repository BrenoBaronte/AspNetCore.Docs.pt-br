---
title: Construa aplicativos web progressivos com ASP.NET WebAssembly principal Blazor
author: guardrex
description: Aprenda a criar Blazorum PWA (Progressive Web Application) baseado em base sinuosa que usa recursos modernos do navegador para se comportar como um aplicativo de desktop.
monikerRange: '>= aspnetcore-3.1'
ms.author: riande
ms.custom: mvc
ms.date: 03/23/2020
no-loc:
- Blazor
- SignalR
uid: blazor/progressive-web-app
ms.openlocfilehash: fe69e51aefae9c80e5bb4b78151d384ce25d41a7
ms.sourcegitcommit: f7886fd2e219db9d7ce27b16c0dc5901e658d64e
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/06/2020
ms.locfileid: "80218941"
---
# <a name="build-progressive-web-applications-with-aspnet-core-blazor-webassembly"></a><span data-ttu-id="08f7d-103">Construa aplicações web progressivas com ASP.NET Core Blazor WebAssembly</span><span class="sxs-lookup"><span data-stu-id="08f7d-103">Build Progressive Web Applications with ASP.NET Core Blazor WebAssembly</span></span>

<span data-ttu-id="08f7d-104">Por [Steve Sanderson](https://github.com/SteveSandersonMS)</span><span class="sxs-lookup"><span data-stu-id="08f7d-104">By [Steve Sanderson](https://github.com/SteveSandersonMS)</span></span>

[!INCLUDE[](~/includes/blazorwasm-preview-notice.md)]

[!INCLUDE[](~/includes/blazorwasm-3.2-template-article-notice.md)]

<span data-ttu-id="08f7d-105">Um Progressive Web Application (PWA) é um Aplicativo de Página Única (SPA) que usa APIs e recursos modernos do navegador para se comportar como um aplicativo de desktop.</span><span class="sxs-lookup"><span data-stu-id="08f7d-105">A Progressive Web Application (PWA) is a Single Page Application (SPA) that uses modern browser APIs and capabilities to behave like a desktop app.</span></span> <span data-ttu-id="08f7d-106">O Blazor WebAssembly é uma plataforma de aplicativos web baseada em padrões baseado em padrões, por isso pode usar qualquer API do navegador, incluindo APIs PWA necessárias para os seguintes recursos:</span><span class="sxs-lookup"><span data-stu-id="08f7d-106">Blazor WebAssembly is a standards-based client-side web app platform, so it can use any browser API, including PWA APIs required for the following capabilities:</span></span>

* <span data-ttu-id="08f7d-107">Trabalhando offline e carregando instantaneamente, independente da velocidade da rede.</span><span class="sxs-lookup"><span data-stu-id="08f7d-107">Working offline and loading instantly, independent of network speed.</span></span>
* <span data-ttu-id="08f7d-108">Executando em sua própria janela de aplicativo, não apenas uma janela do navegador.</span><span class="sxs-lookup"><span data-stu-id="08f7d-108">Running in its own app window, not just a browser window.</span></span>
* <span data-ttu-id="08f7d-109">Sendo lançado a partir do menu inicial do sistema operacional do host, dock ou tela inicial.</span><span class="sxs-lookup"><span data-stu-id="08f7d-109">Being launched from the host's operating system start menu, dock, or home screen.</span></span>
* <span data-ttu-id="08f7d-110">Receber notificações push de um servidor backend, mesmo enquanto o usuário não estiver usando o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="08f7d-110">Receiving push notifications from a backend server, even while the user isn't using the app.</span></span>
* <span data-ttu-id="08f7d-111">Atualização automática em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="08f7d-111">Automatically updating in the background.</span></span>

<span data-ttu-id="08f7d-112">A palavra *progressiva* é usada para descrever tais aplicativos porque:</span><span class="sxs-lookup"><span data-stu-id="08f7d-112">The word *progressive* is used to describe such apps because:</span></span>

* <span data-ttu-id="08f7d-113">Um usuário pode primeiro descobrir e usar o aplicativo dentro de seu navegador como qualquer outro SPA.</span><span class="sxs-lookup"><span data-stu-id="08f7d-113">A user might first discover and use the app within their web browser like any other SPA.</span></span>
* <span data-ttu-id="08f7d-114">Mais tarde, o usuário avança para instalá-lo em seu Sistema Operacional e habilitar notificações push.</span><span class="sxs-lookup"><span data-stu-id="08f7d-114">Later, the user progresses to installing it in their OS and enabling push notifications.</span></span>

## <a name="create-a-project-from-the-pwa-template"></a><span data-ttu-id="08f7d-115">Crie um projeto a partir do modelo PWA</span><span class="sxs-lookup"><span data-stu-id="08f7d-115">Create a project from the PWA template</span></span>

# <a name="visual-studio"></a>[<span data-ttu-id="08f7d-116">Visual Studio</span><span class="sxs-lookup"><span data-stu-id="08f7d-116">Visual Studio</span></span>](#tab/visual-studio)

<span data-ttu-id="08f7d-117">Ao criar um novo **aplicativo Blazor WebAssembly** na caixa de diálogo **Criar um novo projeto,** selecione a caixa de seleção **do Aplicativo Da Web Progresso:**</span><span class="sxs-lookup"><span data-stu-id="08f7d-117">When creating a new **Blazor WebAssembly App** in the **Create a New Project** dialog, select the **Progress Web Application** check box:</span></span>

![A caixa de seleção 'Aplicativo Web Progressivo' é selecionada na caixa de diálogo do novo projeto do Visual Studio.](progressive-web-app/_static/image1.png)

<!--

# [Visual Studio for Mac](#tab/visual-studio-mac)

-->

# <a name="visual-studio-code--net-core-cli"></a>[<span data-ttu-id="08f7d-119">Visual Studio Code/CLI do .NET Core</span><span class="sxs-lookup"><span data-stu-id="08f7d-119">Visual Studio Code / .NET Core CLI</span></span>](#tab/visual-studio-code+netcore-cli)

<span data-ttu-id="08f7d-120">Crie um projeto PWA em `--pwa` um shell de comando com o switch:</span><span class="sxs-lookup"><span data-stu-id="08f7d-120">Create a PWA project in a command shell with the `--pwa` switch:</span></span>

```dotnetcli
dotnet new blazorwasm -o MyNewProject --pwa
```

---

<span data-ttu-id="08f7d-121">Opcionalmente, o PWA pode ser configurado para um aplicativo criado a partir do modelo ASP.NET Core Hosted.</span><span class="sxs-lookup"><span data-stu-id="08f7d-121">Optionally, PWA can be configured for an app created from the ASP.NET Core Hosted template.</span></span> <span data-ttu-id="08f7d-122">O cenário PWA é independente do modelo de hospedagem.</span><span class="sxs-lookup"><span data-stu-id="08f7d-122">The PWA scenario is independent of the hosting model.</span></span>

## <a name="installation-and-app-manifest"></a><span data-ttu-id="08f7d-123">Instalação e manifesto de aplicativos</span><span class="sxs-lookup"><span data-stu-id="08f7d-123">Installation and app manifest</span></span>

<span data-ttu-id="08f7d-124">Ao visitar um aplicativo criado usando o modelo PWA, os usuários têm a opção de instalar o aplicativo no menu inicial do sistema operacional, dock ou tela inicial.</span><span class="sxs-lookup"><span data-stu-id="08f7d-124">When visiting an app created using the PWA template, users have the option of installing the app into their OS's start menu, dock, or home screen.</span></span> <span data-ttu-id="08f7d-125">A forma como essa opção é apresentada depende do navegador do usuário.</span><span class="sxs-lookup"><span data-stu-id="08f7d-125">The way this option is presented depends on the user's browser.</span></span> <span data-ttu-id="08f7d-126">Ao usar navegadores baseados em Chromium de desktop, como Edge ou Chrome, um botão **Adicionar** aparece na barra de URL.</span><span class="sxs-lookup"><span data-stu-id="08f7d-126">When using desktop Chromium-based browsers, such as Edge or Chrome, an **Add** button appears within the URL bar.</span></span> <span data-ttu-id="08f7d-127">Depois que o usuário seleciona o botão **Adicionar,** ele recebe uma caixa de diálogo de confirmação:</span><span class="sxs-lookup"><span data-stu-id="08f7d-127">After the user selects the **Add** button, they receive a confirmation dialog:</span></span>

![O diaglog de confirmação no Google Chrome apresenta um botão Instalar ao usuário para o aplicativo 'MyBlazorPwa'.](progressive-web-app/_static/image2.png)

<span data-ttu-id="08f7d-129">No iOS, os visitantes podem instalar o PWA usando o botão **Compartilhar** do Safari e sua opção **Adicionar à tela inicial.**</span><span class="sxs-lookup"><span data-stu-id="08f7d-129">On iOS, visitors can install the PWA using Safari's **Share** button and its **Add to Homescreen** option.</span></span> <span data-ttu-id="08f7d-130">No Chrome para Android, os usuários devem selecionar o botão **Menu** no canto superior direito, seguido por **Adicionar à tela inicial**.</span><span class="sxs-lookup"><span data-stu-id="08f7d-130">On Chrome for Android, users should select the **Menu** button in the upper-right corner, followed by **Add to Home screen**.</span></span>

<span data-ttu-id="08f7d-131">Uma vez instalado, o aplicativo aparece em sua própria janela sem uma barra de endereços:</span><span class="sxs-lookup"><span data-stu-id="08f7d-131">Once installed, the app appears in its own window without an address bar:</span></span>

![O aplicativo 'MyBlazorPwa' é executado no Google Chrome sem uma barra de endereços.](progressive-web-app/_static/image3.png)

<span data-ttu-id="08f7d-133">Para personalizar o título da janela, o esquema de cores, o ícone ou outros detalhes, consulte o arquivo *manifest.json* no diretório *wwwroot* do projeto.</span><span class="sxs-lookup"><span data-stu-id="08f7d-133">To customize the window's title, color scheme, icon, or other details, see the *manifest.json* file in the project's *wwwroot* directory.</span></span> <span data-ttu-id="08f7d-134">O esquema deste arquivo é definido por padrões da Web.</span><span class="sxs-lookup"><span data-stu-id="08f7d-134">The schema of this file is defined by web standards.</span></span> <span data-ttu-id="08f7d-135">Para obter mais informações, consulte [os web docs da MDN: Web App Manifest](https://developer.mozilla.org/docs/Web/Manifest).</span><span class="sxs-lookup"><span data-stu-id="08f7d-135">For more information, see [MDN web docs: Web App Manifest](https://developer.mozilla.org/docs/Web/Manifest).</span></span>

## <a name="offline-support"></a><span data-ttu-id="08f7d-136">Suporte offline</span><span class="sxs-lookup"><span data-stu-id="08f7d-136">Offline support</span></span>

<span data-ttu-id="08f7d-137">Por padrão, os aplicativos criados usando a opção de modelo PWA têm suporte para executar off-line.</span><span class="sxs-lookup"><span data-stu-id="08f7d-137">By default, apps created using the PWA template option have support for running offline.</span></span> <span data-ttu-id="08f7d-138">Um usuário deve primeiro visitar o aplicativo enquanto estiver online.</span><span class="sxs-lookup"><span data-stu-id="08f7d-138">A user must first visit the app while they're online.</span></span> <span data-ttu-id="08f7d-139">O navegador baixa e armazena automaticamente todos os recursos necessários para operar off-line.</span><span class="sxs-lookup"><span data-stu-id="08f7d-139">The browser automatically downloads and caches all of the resources required to operate offline.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="08f7d-140">O apoio ao desenvolvimento interferiria no ciclo usual de desenvolvimento de fazer mudanças e testá-las.</span><span class="sxs-lookup"><span data-stu-id="08f7d-140">Development support would interfere with the usual development cycle of making changes and testing them.</span></span> <span data-ttu-id="08f7d-141">Portanto, o suporte off-line só é habilitado para aplicativos *publicados.*</span><span class="sxs-lookup"><span data-stu-id="08f7d-141">Therefore, offline support is only enabled for *published* apps.</span></span> 

> [!WARNING]
> <span data-ttu-id="08f7d-142">Se você pretende distribuir um PWA habilitado para offline, existem [vários avisos e ressalvas importantes](#caveats-for-offline-pwas).</span><span class="sxs-lookup"><span data-stu-id="08f7d-142">If you intend to distribute an offline-enabled PWA, there are [several important warnings and caveats](#caveats-for-offline-pwas).</span></span> <span data-ttu-id="08f7d-143">Esses cenários são inerentes a BlazorPWAs offline e não específicos para .</span><span class="sxs-lookup"><span data-stu-id="08f7d-143">These scenarios are inherent to offline PWAs and not specific to Blazor.</span></span> <span data-ttu-id="08f7d-144">Certifique-se de ler e entender essas ressalvas antes de fazer suposições sobre como seu aplicativo habilitado para offline funcionará.</span><span class="sxs-lookup"><span data-stu-id="08f7d-144">Be sure to read and understand these caveats before making assumptions about how your offline-enabled app will work.</span></span>

<span data-ttu-id="08f7d-145">Para ver como funciona o suporte offline:</span><span class="sxs-lookup"><span data-stu-id="08f7d-145">To see how offline support works:</span></span>

1. <span data-ttu-id="08f7d-146">Publique o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="08f7d-146">Publish the app.</span></span> <span data-ttu-id="08f7d-147">Para obter mais informações, consulte <xref:host-and-deploy/blazor/index#publish-the-app>.</span><span class="sxs-lookup"><span data-stu-id="08f7d-147">For more information, see <xref:host-and-deploy/blazor/index#publish-the-app>.</span></span>
1. <span data-ttu-id="08f7d-148">Implante o aplicativo em um servidor que suporta HTTPS e acesse o aplicativo em um navegador em seu endereço HTTPS seguro.</span><span class="sxs-lookup"><span data-stu-id="08f7d-148">Deploy the app to a server that supports HTTPS, and access the app in a browser at its secure HTTPS address.</span></span>
1. <span data-ttu-id="08f7d-149">Abra as ferramentas de desenvolvimento do navegador e verifique se um *Trabalhador de Serviço* está registrado para o host na guia **Aplicativo:**</span><span class="sxs-lookup"><span data-stu-id="08f7d-149">Open the browser's dev tools and verify that a *Service Worker* is registered for the host on the **Application** tab:</span></span>

   ![A guia 'Aplicativo' de ferramentas de desenvolvedor esnobar do Google Chrome mostra um Trabalhador de Serviço ativado e em execução.](progressive-web-app/_static/image4.png)

1. <span data-ttu-id="08f7d-151">Recarregue a página e examine a guia **Rede.** **O trabalhador de serviço** ou o cache de **memória** estão listados como as fontes de todos os ativos da página:</span><span class="sxs-lookup"><span data-stu-id="08f7d-151">Reload the page and examine the **Network** tab. **Service Worker** or **memory cache** are listed as the sources for all of the page's assets:</span></span>

   ![As ferramentas de desenvolvedor do Google Chrome 'Rede' mostram fontes para todos os ativos da página.](progressive-web-app/_static/image5.png)

1. <span data-ttu-id="08f7d-153">Para verificar se o navegador não depende do acesso à rede para carregar o aplicativo, também:</span><span class="sxs-lookup"><span data-stu-id="08f7d-153">To verify that the browser isn't dependent on network access to load the app, either:</span></span>

   * <span data-ttu-id="08f7d-154">Desligue o servidor web e veja como o aplicativo continua funcionando normalmente, o que inclui recargas de página.</span><span class="sxs-lookup"><span data-stu-id="08f7d-154">Shut down the web server and see how the app continues to function normally, which includes page reloads.</span></span> <span data-ttu-id="08f7d-155">Da mesma forma, o aplicativo continua funcionando normalmente quando há uma conexão de rede lenta.</span><span class="sxs-lookup"><span data-stu-id="08f7d-155">Likewise, the app continues to function normally when there's a slow network connection.</span></span>
   * <span data-ttu-id="08f7d-156">Instruir o navegador a simular o modo offline na guia **Rede:**</span><span class="sxs-lookup"><span data-stu-id="08f7d-156">Instruct the browser to simulate offline mode in the **Network** tab:</span></span>

   ![As ferramentas de desenvolvedor do Google Chrome 'Rede' com o modo navegador foram alteradas de 'Online' para 'Offline'.](progressive-web-app/_static/image6.png)

<span data-ttu-id="08f7d-158">O suporte off-line usando um trabalhador Blazorde serviço é um padrão web, não específico para .</span><span class="sxs-lookup"><span data-stu-id="08f7d-158">Offline support using a service worker is a web standard, not specific to Blazor.</span></span> <span data-ttu-id="08f7d-159">Para obter mais informações sobre os trabalhadores do serviço, consulte [os docs web da MDN: API do trabalhador de serviço](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span><span class="sxs-lookup"><span data-stu-id="08f7d-159">For more information on service workers, see [MDN web docs: Service Worker API](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span></span> <span data-ttu-id="08f7d-160">Para saber mais sobre padrões de uso comuns para os trabalhadores do serviço, consulte [o Google Web: O ciclo de vida do trabalhador de serviço](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle).</span><span class="sxs-lookup"><span data-stu-id="08f7d-160">To learn more about common usage patterns for service workers, see [Google Web: The Service Worker Lifecycle](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle).</span></span>

Blazor<span data-ttu-id="08f7d-161">O modelo PWA produz dois arquivos de trabalhadores de serviço:</span><span class="sxs-lookup"><span data-stu-id="08f7d-161">'s PWA template produces two service worker files:</span></span>

* <span data-ttu-id="08f7d-162">*wwwroot/service-worker.js*, que é usado durante o desenvolvimento.</span><span class="sxs-lookup"><span data-stu-id="08f7d-162">*wwwroot/service-worker.js*, which is used during development.</span></span>
* <span data-ttu-id="08f7d-163">*wwwroot/service-worker.published.js*, que é usado após a publicação do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="08f7d-163">*wwwroot/service-worker.published.js*, which is used after the app is published.</span></span>

<span data-ttu-id="08f7d-164">Para compartilhar a lógica entre os dois arquivos do trabalhador de serviço, considere a seguinte abordagem:</span><span class="sxs-lookup"><span data-stu-id="08f7d-164">To share logic between the two service worker files, consider the following approach:</span></span>

* <span data-ttu-id="08f7d-165">Adicione um terceiro arquivo JavaScript para manter a lógica comum.</span><span class="sxs-lookup"><span data-stu-id="08f7d-165">Add a third JavaScript file to hold the common logic.</span></span>
* <span data-ttu-id="08f7d-166">Use [self.importScripts](https://developer.mozilla.org/docs/Web/API/WorkerGlobalScope/importScripts) para carregar a lógica comum em ambos os arquivos do trabalhador de serviço.</span><span class="sxs-lookup"><span data-stu-id="08f7d-166">Use [self.importScripts](https://developer.mozilla.org/docs/Web/API/WorkerGlobalScope/importScripts) to load the common logic into both service worker files.</span></span>

### <a name="cache-first-fetch-strategy"></a><span data-ttu-id="08f7d-167">Estratégia de busca em cache-first</span><span class="sxs-lookup"><span data-stu-id="08f7d-167">Cache-first fetch strategy</span></span>

<span data-ttu-id="08f7d-168">O trabalhador *de serviço incorporado.published.js* service worker resolve solicitações usando uma estratégia *de cache-first.*</span><span class="sxs-lookup"><span data-stu-id="08f7d-168">The built-in *service-worker.published.js* service worker resolves requests using a *cache-first* strategy.</span></span> <span data-ttu-id="08f7d-169">Isso significa que o trabalhador do serviço prefere retornar conteúdo em cache, independentemente de o usuário ter acesso à rede ou conteúdo mais novo estar disponível no servidor.</span><span class="sxs-lookup"><span data-stu-id="08f7d-169">This means that the service worker prefers to return cached content, regardless of whether the user has network access or newer content is available on the server.</span></span>

<span data-ttu-id="08f7d-170">A estratégia cache-first é valiosa porque:</span><span class="sxs-lookup"><span data-stu-id="08f7d-170">The cache-first strategy is valuable because:</span></span>

* <span data-ttu-id="08f7d-171">**Garante confiabilidade.**</span><span class="sxs-lookup"><span data-stu-id="08f7d-171">**It ensures reliability.**</span></span> <span data-ttu-id="08f7d-172">&ndash;O acesso à rede não é um estado booleano.</span><span class="sxs-lookup"><span data-stu-id="08f7d-172">&ndash; Network access isn't a boolean state.</span></span> <span data-ttu-id="08f7d-173">Um usuário não está simplesmente on-line ou off-line:</span><span class="sxs-lookup"><span data-stu-id="08f7d-173">A user isn't simply online or offline:</span></span>

  * <span data-ttu-id="08f7d-174">O dispositivo do usuário pode assumir que está online, mas a rede pode ser tão lenta que é impraticável esperar.</span><span class="sxs-lookup"><span data-stu-id="08f7d-174">The user's device may assume it's online, but the network might be so slow as to be impractical to wait for.</span></span>
  * <span data-ttu-id="08f7d-175">A rede pode retornar resultados inválidos para certos URLs, como quando há um portal WIFI cativo que está bloqueando ou redirecionando determinadas solicitações.</span><span class="sxs-lookup"><span data-stu-id="08f7d-175">The network might return invalid results for certain URLs, such as when there's a captive WIFI portal that's currently blocking or redirecting certain requests.</span></span>
  
  <span data-ttu-id="08f7d-176">É por isso que `navigator.onLine` a API do navegador não é confiável e não deve ser dependente.</span><span class="sxs-lookup"><span data-stu-id="08f7d-176">This is why the browser's `navigator.onLine` API isn't reliable and shouldn't be depended upon.</span></span>

* <span data-ttu-id="08f7d-177">**Garante a correção.**</span><span class="sxs-lookup"><span data-stu-id="08f7d-177">**It ensures correctness.**</span></span> <span data-ttu-id="08f7d-178">&ndash;Ao construir um cache de recursos offline, o trabalhador de serviço usa hashing de conteúdo para garantir que ele tenha buscado um instantâneo completo e auto-consistente de recursos em um único instante no tempo.</span><span class="sxs-lookup"><span data-stu-id="08f7d-178">&ndash; When building a cache of offline resources, the service worker uses content hashing to guarantee it has fetched a complete and self-consistent snapshot of resources at a single instant in time.</span></span> <span data-ttu-id="08f7d-179">Este cache é então usado como uma unidade atômica.</span><span class="sxs-lookup"><span data-stu-id="08f7d-179">This cache is then used as an atomic unit.</span></span> <span data-ttu-id="08f7d-180">Não adianta pedir recursos mais novos à rede, já que as únicas versões necessárias são as já armazenadas em cache.</span><span class="sxs-lookup"><span data-stu-id="08f7d-180">There's no point asking the network for newer resources, since the only versions required are the ones already cached.</span></span> <span data-ttu-id="08f7d-181">Qualquer outra coisa corre o risco de inconsistência e incompatibilidade (por exemplo, tentar usar versões de conjuntos .NET que não foram compilados juntos).</span><span class="sxs-lookup"><span data-stu-id="08f7d-181">Anything else risks inconsistency and incompatibility (for example, trying to use versions of .NET assemblies that weren't compiled together).</span></span>

### <a name="background-updates"></a><span data-ttu-id="08f7d-182">Atualizações em segundo plano</span><span class="sxs-lookup"><span data-stu-id="08f7d-182">Background updates</span></span>

<span data-ttu-id="08f7d-183">Como um modelo mental, você pode pensar em um PWA offline-first como se comportando como um aplicativo móvel que pode ser instalado.</span><span class="sxs-lookup"><span data-stu-id="08f7d-183">As a mental model, you can think of an offline-first PWA as behaving like a mobile app that can be installed.</span></span> <span data-ttu-id="08f7d-184">O aplicativo é iniciado imediatamente independentemente da conectividade da rede, mas a lógica do aplicativo instalado vem de um instantâneo point-in-time que pode não ser a versão mais recente.</span><span class="sxs-lookup"><span data-stu-id="08f7d-184">The app starts up immediately regardless of network connectivity, but the installed app logic comes from a point-in-time snapshot that might not be the latest version.</span></span>

<span data-ttu-id="08f7d-185">O Blazor modelo PWA produz aplicativos que tentam se atualizar automaticamente em segundo plano sempre que o usuário visita e tem uma conexão de rede em funcionamento.</span><span class="sxs-lookup"><span data-stu-id="08f7d-185">The Blazor PWA template produces apps that automatically try to update themselves in the background whenever the user visits and has a working network connection.</span></span> <span data-ttu-id="08f7d-186">A maneira como isso funciona é a seguinte:</span><span class="sxs-lookup"><span data-stu-id="08f7d-186">The way this works is as follows:</span></span>

* <span data-ttu-id="08f7d-187">Durante a compilação, o projeto gera um *manifesto de ativos dos trabalhadores de serviços.*</span><span class="sxs-lookup"><span data-stu-id="08f7d-187">During compilation, the project generates a *service worker assets manifest*.</span></span> <span data-ttu-id="08f7d-188">Por padrão, isso é chamado *de service-worker-assets.js*.</span><span class="sxs-lookup"><span data-stu-id="08f7d-188">By default, this is called *service-worker-assets.js*.</span></span> <span data-ttu-id="08f7d-189">O manifesto lista todos os recursos estáticos que o aplicativo requer para funcionar offline, como conjuntos .NET, arquivos JavaScript e CSS, incluindo seus hashes de conteúdo.</span><span class="sxs-lookup"><span data-stu-id="08f7d-189">The manifest lists all the static resources that the app requires to function offline, such as .NET assemblies, JavaScript files, and CSS, including their content hashes.</span></span> <span data-ttu-id="08f7d-190">A lista de recursos é carregada pelo trabalhador do serviço para que ele saiba quais recursos armazenar.</span><span class="sxs-lookup"><span data-stu-id="08f7d-190">The resource list is loaded by the service worker so that it knows which resources to cache.</span></span>
* <span data-ttu-id="08f7d-191">Cada vez que o usuário visita o aplicativo, o navegador resolicita *o service-worker.js* e *o service-worker-assets.js* em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="08f7d-191">Each time the user visits the app, the browser re-requests *service-worker.js* and *service-worker-assets.js* in the background.</span></span> <span data-ttu-id="08f7d-192">Os arquivos são comparados byte-for-byte com o trabalhador de serviço instalado existente.</span><span class="sxs-lookup"><span data-stu-id="08f7d-192">The files are compared byte-for-byte with the existing installed service worker.</span></span> <span data-ttu-id="08f7d-193">Se o servidor devolver o conteúdo alterado para qualquer um desses arquivos, o funcionário do serviço tentará instalar uma nova versão de si mesmo.</span><span class="sxs-lookup"><span data-stu-id="08f7d-193">If the server returns changed content for either of these files, the service worker attempts to install a new version of itself.</span></span>
* <span data-ttu-id="08f7d-194">Ao instalar uma nova versão de si mesmo, o trabalhador de serviço cria um cache novo e separado para recursos offline e começa a preencher o cache com recursos listados em *service-worker-assets.js*.</span><span class="sxs-lookup"><span data-stu-id="08f7d-194">When installing a new version of itself, the service worker creates a new, separate cache for offline resources and starts populating the cache with resources listed in *service-worker-assets.js*.</span></span> <span data-ttu-id="08f7d-195">Essa lógica é `onInstall` implementada na função dentro do *serviço-trabalhador.published.js*.</span><span class="sxs-lookup"><span data-stu-id="08f7d-195">This logic is implemented in the `onInstall` function inside *service-worker.published.js*.</span></span>
* <span data-ttu-id="08f7d-196">O processo é concluído com sucesso quando todos os recursos são carregados sem erro e todos os hashes de conteúdo correspondem.</span><span class="sxs-lookup"><span data-stu-id="08f7d-196">The process completes successfully when all of the resources are loaded without error and all content hashes match.</span></span> <span data-ttu-id="08f7d-197">Se for bem-sucedido, o novo trabalhador entra em estado *de espera para ativação.*</span><span class="sxs-lookup"><span data-stu-id="08f7d-197">If successful, the new service worker enters a *waiting for activation* state.</span></span> <span data-ttu-id="08f7d-198">Assim que o usuário fecha o aplicativo (sem guias ou janelas de aplicativos restantes), o novo funcionário do serviço se torna *ativo* e é usado para visitas subsequentes do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="08f7d-198">As soon as the user closes the app (no remaining app tabs or windows), the new service worker becomes *active* and is used for subsequent app visits.</span></span> <span data-ttu-id="08f7d-199">O antigo funcionário do serviço e seu cache são excluídos.</span><span class="sxs-lookup"><span data-stu-id="08f7d-199">The old service worker and its cache are deleted.</span></span>
* <span data-ttu-id="08f7d-200">Se o processo não for concluído com sucesso, a nova instância do trabalhador de serviço será descartada.</span><span class="sxs-lookup"><span data-stu-id="08f7d-200">If the process doesn't complete successfully, the new service worker instance is discarded.</span></span> <span data-ttu-id="08f7d-201">O processo de atualização é tentado novamente na próxima visita do usuário, quando esperamos que o cliente tenha uma melhor conexão de rede que possa concluir as solicitações.</span><span class="sxs-lookup"><span data-stu-id="08f7d-201">The update process is attempted again on the user's next visit, when hopefully the client has a better network connection that can complete the requests.</span></span>

<span data-ttu-id="08f7d-202">Personalize esse processo editando a lógica do trabalhador de serviços.</span><span class="sxs-lookup"><span data-stu-id="08f7d-202">Customize this process by editing the service worker logic.</span></span> <span data-ttu-id="08f7d-203">Nenhum dos comportamentos anteriores Blazor é específico, mas é apenas a experiência padrão fornecida pela opção de modelo PWA.</span><span class="sxs-lookup"><span data-stu-id="08f7d-203">None of the preceding behavior is specific to Blazor but is merely the default experience provided by the PWA template option.</span></span> <span data-ttu-id="08f7d-204">Para obter mais informações, consulte [os docs web do MDN: Service Worker API](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span><span class="sxs-lookup"><span data-stu-id="08f7d-204">For more information, see [MDN web docs: Service Worker API](https://developer.mozilla.org/docs/Web/API/Service_Worker_API).</span></span>

### <a name="how-requests-are-resolved"></a><span data-ttu-id="08f7d-205">Como os pedidos são resolvidos</span><span class="sxs-lookup"><span data-stu-id="08f7d-205">How requests are resolved</span></span>

<span data-ttu-id="08f7d-206">Como descrito na seção [De estratégia de busca em cache- primeiro,](#cache-first-fetch-strategy) o funcionário de serviço padrão usa uma estratégia de *cache-first,* o que significa que ele tenta servir conteúdo em cache quando disponível.</span><span class="sxs-lookup"><span data-stu-id="08f7d-206">As described in the [Cache-first fetch strategy](#cache-first-fetch-strategy) section, the default service worker uses a *cache-first* strategy, meaning that it tries to serve cached content when available.</span></span> <span data-ttu-id="08f7d-207">Se não houver conteúdo armazenado em cache para uma determinada URL, por exemplo, ao solicitar dados de uma API backend, o funcionário do serviço recua em uma solicitação de rede regular.</span><span class="sxs-lookup"><span data-stu-id="08f7d-207">If there is no content cached for a certain URL, for example when requesting data from a backend API, the service worker falls back on a regular network request.</span></span> <span data-ttu-id="08f7d-208">A solicitação de rede é bem-sucedida se o servidor estiver acessível.</span><span class="sxs-lookup"><span data-stu-id="08f7d-208">The network request succeeds if the server is reachable.</span></span> <span data-ttu-id="08f7d-209">Essa lógica é `onFetch` implementada dentro da função dentro *do service-worker.published.js*.</span><span class="sxs-lookup"><span data-stu-id="08f7d-209">This logic is implemented inside `onFetch` function within *service-worker.published.js*.</span></span>

<span data-ttu-id="08f7d-210">Se os componentes razor do aplicativo dependerem da solicitação de dados das APIs de backend e você quiser fornecer uma experiência de usuário amigável para solicitações com falha devido à indisponibilidade da rede, implemente a lógica dentro dos componentes do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="08f7d-210">If the app's Razor components rely on requesting data from backend APIs and you want to provide a friendly user experience for failed requests due to network unavailability, implement logic within the app's components.</span></span> <span data-ttu-id="08f7d-211">Por exemplo, `try/catch` `HttpClient` use em torno de pedidos.</span><span class="sxs-lookup"><span data-stu-id="08f7d-211">For example, use `try/catch` around `HttpClient` requests.</span></span>

### <a name="support-server-rendered-pages"></a><span data-ttu-id="08f7d-212">Suporte a páginas renderizadas pelo servidor</span><span class="sxs-lookup"><span data-stu-id="08f7d-212">Support server-rendered pages</span></span>

<span data-ttu-id="08f7d-213">Considere o que acontece quando o usuário `/counter` navega pela primeira vez para uma URL como ou qualquer outro link profundo no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="08f7d-213">Consider what happens when the user first navigates to a URL such as `/counter` or any other deep link in the app.</span></span> <span data-ttu-id="08f7d-214">Nesses casos, você não deseja retornar o `/counter`conteúdo armazenado em cache como , mas, em vez disso, precisa que o navegador carregue o conteúdo armazenado em cache para `/index.html` iniciar seu Blazor aplicativo WebAssembly.</span><span class="sxs-lookup"><span data-stu-id="08f7d-214">In these cases, you don't want to return content cached as `/counter`, but instead need the browser to load the content cached as `/index.html` to start up your Blazor WebAssembly app.</span></span> <span data-ttu-id="08f7d-215">Essas solicitações iniciais são conhecidas como solicitações *de navegação,* em oposição a:</span><span class="sxs-lookup"><span data-stu-id="08f7d-215">These initial requests are known as *navigation* requests, as opposed to:</span></span>

* <span data-ttu-id="08f7d-216">*solicitações de subrecursos* para imagens, folhas de estilo ou outros arquivos.</span><span class="sxs-lookup"><span data-stu-id="08f7d-216">*subresource* requests for images, stylesheets, or other files.</span></span>
* <span data-ttu-id="08f7d-217">*buscar/solicitações xhr* para dados de API.</span><span class="sxs-lookup"><span data-stu-id="08f7d-217">*fetch/XHR* requests for API data.</span></span>

<span data-ttu-id="08f7d-218">O trabalhador de serviço padrão contém lógica de caso especial para solicitações de navegação.</span><span class="sxs-lookup"><span data-stu-id="08f7d-218">The default service worker contains special-case logic for navigation requests.</span></span> <span data-ttu-id="08f7d-219">O trabalhador do serviço resolve as solicitações `/index.html`retornando o conteúdo armazenado em cache para, independentemente da URL solicitada.</span><span class="sxs-lookup"><span data-stu-id="08f7d-219">The service worker resolves the requests by returning the cached content for `/index.html`, regardless of the requested URL.</span></span> <span data-ttu-id="08f7d-220">Essa lógica é `onFetch` implementada na função dentro do *serviço-trabalhador.published.js*.</span><span class="sxs-lookup"><span data-stu-id="08f7d-220">This logic is implemented in the `onFetch` function inside *service-worker.published.js*.</span></span>

<span data-ttu-id="08f7d-221">Se o seu aplicativo tiver certos URLs que devem `/index.html` retornar HTML renderizado pelo servidor e não servir a partir do cache, então você precisa editar a lógica em seu funcionário de serviço.</span><span class="sxs-lookup"><span data-stu-id="08f7d-221">If your app has certain URLs that must return server-rendered HTML, and not serve `/index.html` from the cache, then you need to edit the logic in your service worker.</span></span> <span data-ttu-id="08f7d-222">Se todas as URLs que contiverem `/Identity/` precisarm ser tratadas como solicitações regulares somente on-line para o servidor, então modifique a lógica *service-worker.published.js.* `onFetch`</span><span class="sxs-lookup"><span data-stu-id="08f7d-222">If all URLs containing `/Identity/` need to be handled as regular online-only requests to the server, then modify *service-worker.published.js* `onFetch` logic.</span></span> <span data-ttu-id="08f7d-223">Localize o código a seguir:</span><span class="sxs-lookup"><span data-stu-id="08f7d-223">Locate the following code:</span></span>

```javascript
const shouldServeIndexHtml = event.request.mode === 'navigate';
```

<span data-ttu-id="08f7d-224">Alterar o código para o seguinte:</span><span class="sxs-lookup"><span data-stu-id="08f7d-224">Change the code to the following:</span></span>

```javascript
const shouldServeIndexHtml = event.request.mode === 'navigate'
    && !event.request.url.includes('/Identity/');
```

<span data-ttu-id="08f7d-225">Se você não fizer isso, então, independentemente da conectividade da rede, o funcionário do `/index.html`serviço intercepta solicitações para tais URLs e as resolve usando .</span><span class="sxs-lookup"><span data-stu-id="08f7d-225">If you don't do this, then regardless of network connectivity, the service worker intercepts requests for such URLs and resolves them using `/index.html`.</span></span>

### <a name="control-asset-caching"></a><span data-ttu-id="08f7d-226">Cache de ativos de controle</span><span class="sxs-lookup"><span data-stu-id="08f7d-226">Control asset caching</span></span>

<span data-ttu-id="08f7d-227">Se o seu `ServiceWorkerAssetsManifest` projeto definir a Blazorpropriedade MSBuild, a ferramenta de construção gerará um manifesto de ativos do trabalhador de serviço com o nome especificado.</span><span class="sxs-lookup"><span data-stu-id="08f7d-227">If your project defines the `ServiceWorkerAssetsManifest` MSBuild property, Blazor's build tooling generates a service worker assets manifest with the specified name.</span></span> <span data-ttu-id="08f7d-228">O modelo PWA padrão produz um arquivo de projeto contendo a seguinte propriedade:</span><span class="sxs-lookup"><span data-stu-id="08f7d-228">The default PWA template produces a project file containing the following property:</span></span>

```xml
<ServiceWorkerAssetsManifest>service-worker-assets.js</ServiceWorkerAssetsManifest>
```

<span data-ttu-id="08f7d-229">O arquivo é colocado no diretório de saída *wwwroot,* para que `/service-worker-assets.js`o navegador possa recuperar este arquivo solicitando .</span><span class="sxs-lookup"><span data-stu-id="08f7d-229">The file is placed in the *wwwroot* output directory, so the browser can retrieve this file by requesting `/service-worker-assets.js`.</span></span> <span data-ttu-id="08f7d-230">Para ver o conteúdo deste arquivo, abra */bin/Debug/{TARGET FRAMEWORK}/wwwroot/service-worker-assets.js* em um editor de texto.</span><span class="sxs-lookup"><span data-stu-id="08f7d-230">To see the contents of this file, open */bin/Debug/{TARGET FRAMEWORK}/wwwroot/service-worker-assets.js* in a text editor.</span></span> <span data-ttu-id="08f7d-231">No entanto, não edite o arquivo, pois ele é regenerado em cada compilação.</span><span class="sxs-lookup"><span data-stu-id="08f7d-231">However, don't edit the file, as it's regenerated on each build.</span></span>

<span data-ttu-id="08f7d-232">Por padrão, este manifesto lista:</span><span class="sxs-lookup"><span data-stu-id="08f7d-232">By default, this manifest lists:</span></span>

* <span data-ttu-id="08f7d-233">Quaisquer Blazorrecursos gerenciados, como conjuntos .NET e os arquivos de tempo de execução .NET WebAssembly necessários para funcionar offline.</span><span class="sxs-lookup"><span data-stu-id="08f7d-233">Any Blazor-managed resources, such as .NET assemblies and the .NET WebAssembly runtime files required to function offline.</span></span>
* <span data-ttu-id="08f7d-234">Todos os recursos para publicação no diretório *wwwroot* do aplicativo, como imagens, folhas de estilo e arquivos JavaScript, incluindo ativos web estáticos fornecidos por projetos externos e pacotes NuGet.</span><span class="sxs-lookup"><span data-stu-id="08f7d-234">All resources for publishing to the app's *wwwroot* directory, such as images, stylesheets, and JavaScript files, including static web assets supplied by external projects and NuGet packages.</span></span>

<span data-ttu-id="08f7d-235">Você pode controlar quais desses recursos são buscados e armazenados em `onInstall` cache pelo trabalhador de serviço editando a lógica em *serviço-trabalhador.published.js*.</span><span class="sxs-lookup"><span data-stu-id="08f7d-235">You can control which of these resources are fetched and cached by the service worker by editing the logic in `onInstall` in *service-worker.published.js*.</span></span> <span data-ttu-id="08f7d-236">Por padrão, o trabalhador de serviço busca e armazena arquivos que correspondem a extensões típicas de nome de arquivo da Blazor Web, tais como *.html*, *.css,* *.js*e *.wasm*, mais tipos de arquivos específicos para WebAssembly (*.dll*, *.pdb*).</span><span class="sxs-lookup"><span data-stu-id="08f7d-236">By default, the service worker fetches and caches files matching typical web filename extensions such as *.html*, *.css*, *.js*, and *.wasm*, plus file types specific to Blazor WebAssembly (*.dll*, *.pdb*).</span></span>

<span data-ttu-id="08f7d-237">Para incluir recursos adicionais que não estão presentes no diretório *wwwroot* `ItemGroup` do aplicativo, defina entradas extras do MSBuild, como mostrado no exemplo a seguir:</span><span class="sxs-lookup"><span data-stu-id="08f7d-237">To include additional resources that aren't present in the app's *wwwroot* directory, define extra MSBuild `ItemGroup` entries, as shown in the following example:</span></span>

```xml
<ItemGroup>
  <ServiceWorkerAssetsManifestItem Include="MyDirectory\AnotherFile.json"
    RelativePath="MyDirectory\AnotherFile.json" AssetUrl="files/AnotherFile.json" />
</ItemGroup>
```

<span data-ttu-id="08f7d-238">Os `AssetUrl` metadados especificam a URL relativa à base que o navegador deve usar ao buscar o recurso para cache.</span><span class="sxs-lookup"><span data-stu-id="08f7d-238">The `AssetUrl` metadata specifies the base-relative URL that the browser should use when fetching the resource to cache.</span></span> <span data-ttu-id="08f7d-239">Isso pode ser independente do nome do arquivo de origem original no disco.</span><span class="sxs-lookup"><span data-stu-id="08f7d-239">This can be independent of its original source file name on disk.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="08f7d-240">Adicionar `ServiceWorkerAssetsManifestItem` a não faz com que o arquivo seja publicado no diretório *wwwroot* do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="08f7d-240">Adding a `ServiceWorkerAssetsManifestItem` doesn't cause the file to be published in the app's *wwwroot* directory.</span></span> <span data-ttu-id="08f7d-241">A saída de publicação deve ser controlada separadamente.</span><span class="sxs-lookup"><span data-stu-id="08f7d-241">The publish output must be controlled separately.</span></span> <span data-ttu-id="08f7d-242">A `ServiceWorkerAssetsManifestItem` única causa uma entrada adicional para aparecer no manifesto de ativos do trabalhador do serviço.</span><span class="sxs-lookup"><span data-stu-id="08f7d-242">The `ServiceWorkerAssetsManifestItem` only causes an additional entry to appear in the service worker assets manifest.</span></span>

## <a name="push-notifications"></a><span data-ttu-id="08f7d-243">Notificações por push</span><span class="sxs-lookup"><span data-stu-id="08f7d-243">Push notifications</span></span>

<span data-ttu-id="08f7d-244">Como qualquer outro PWA, um Blazor WebAssembly PWA pode receber notificações push de um servidor backend.</span><span class="sxs-lookup"><span data-stu-id="08f7d-244">Like any other PWA, a Blazor WebAssembly PWA can receive push notifications from a backend server.</span></span> <span data-ttu-id="08f7d-245">O servidor pode enviar notificações push a qualquer momento, mesmo quando o usuário não está usando ativamente o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="08f7d-245">The server can send push notifications at any time, even when the user isn't actively using the app.</span></span> <span data-ttu-id="08f7d-246">Por exemplo, notificações push podem ser enviadas quando um usuário diferente executa uma ação relevante.</span><span class="sxs-lookup"><span data-stu-id="08f7d-246">For example, push notifications can be sent when a different user performs a relevant action.</span></span>

<span data-ttu-id="08f7d-247">O mecanismo para enviar uma notificação Blazor push é totalmente independente do WebAssembly, uma vez que é implementado pelo servidor backend que pode usar qualquer tecnologia.</span><span class="sxs-lookup"><span data-stu-id="08f7d-247">The mechanism for sending a push notification is entirely independent of Blazor WebAssembly, since it's implemented by the backend server which can use any technology.</span></span> <span data-ttu-id="08f7d-248">Se você quiser enviar notificações push de um servidor ASP.NET Core, considere [usar uma técnica semelhante à abordagem tomada na oficina De Pizza Blazing](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#sending-push-notifications).</span><span class="sxs-lookup"><span data-stu-id="08f7d-248">If you want to send push notifications from an ASP.NET Core server, consider [using a technique similar to the approach taken in the Blazing Pizza workshop](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#sending-push-notifications).</span></span>

<span data-ttu-id="08f7d-249">O mecanismo para receber e exibir uma notificação push Blazor no cliente também é independente do WebAssembly, uma vez que é implementado no arquivo JavaScript do trabalhador de serviço.</span><span class="sxs-lookup"><span data-stu-id="08f7d-249">The mechanism for receiving and displaying a push notification on the client is also independent of Blazor WebAssembly, since it's implemented in the service worker JavaScript file.</span></span> <span data-ttu-id="08f7d-250">Por exemplo, veja [a abordagem utilizada na oficina de Pizza Blazing.](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#displaying-notifications)</span><span class="sxs-lookup"><span data-stu-id="08f7d-250">For an example, see [the approach used in the Blazing Pizza workshop](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#displaying-notifications).</span></span>

## <a name="caveats-for-offline-pwas"></a><span data-ttu-id="08f7d-251">Ressalvas para PWAs offline</span><span class="sxs-lookup"><span data-stu-id="08f7d-251">Caveats for offline PWAs</span></span>

<span data-ttu-id="08f7d-252">Nem todos os aplicativos devem tentar suportar o uso offline.</span><span class="sxs-lookup"><span data-stu-id="08f7d-252">Not all apps should attempt to support offline use.</span></span> <span data-ttu-id="08f7d-253">O suporte offline adiciona uma complexidade significativa, embora nem sempre seja relevante para os casos de uso necessários.</span><span class="sxs-lookup"><span data-stu-id="08f7d-253">Offline support adds significant complexity, while not always being relevant for the use cases required.</span></span>

<span data-ttu-id="08f7d-254">O suporte offline geralmente é apenas relevante:</span><span class="sxs-lookup"><span data-stu-id="08f7d-254">Offline support is usually relevant only:</span></span>

* <span data-ttu-id="08f7d-255">Se o armazenamento de dados principal for local para o navegador.</span><span class="sxs-lookup"><span data-stu-id="08f7d-255">If the primary data store is local to the browser.</span></span> <span data-ttu-id="08f7d-256">Por exemplo, a abordagem é relevante em um aplicativo com uma `localStorage` ui para um dispositivo [IoT](https://en.wikipedia.org/wiki/Internet_of_things) que armazena dados ou [IndexedDB](https://developer.mozilla.org/docs/Web/API/IndexedDB_API).</span><span class="sxs-lookup"><span data-stu-id="08f7d-256">For example, the approach is relevant in an app with a UI for an [IoT](https://en.wikipedia.org/wiki/Internet_of_things) device that stores data in `localStorage` or [IndexedDB](https://developer.mozilla.org/docs/Web/API/IndexedDB_API).</span></span>
* <span data-ttu-id="08f7d-257">Se o aplicativo realizar uma quantidade significativa de trabalho para buscar e armazenar os dados da API de backend relevantes para cada usuário, para que eles possam navegar através dos dados off-line.</span><span class="sxs-lookup"><span data-stu-id="08f7d-257">If the app performs a significant amount of work to fetch and cache the backend API data relevant to each user so that they can navigate through the data offline.</span></span> <span data-ttu-id="08f7d-258">Se o aplicativo tiver suporte à edição, um sistema para rastrear alterações e sincronizar dados com o backend deve ser construído.</span><span class="sxs-lookup"><span data-stu-id="08f7d-258">If the app must support editing, a system for tracking changes and synchronizing data with the backend must be built.</span></span>
* <span data-ttu-id="08f7d-259">Se o objetivo é garantir que o aplicativo seja carregado imediatamente, independentemente das condições da rede.</span><span class="sxs-lookup"><span data-stu-id="08f7d-259">If the goal is to guarantee that the app loads immediately regardless of network conditions.</span></span> <span data-ttu-id="08f7d-260">Implemente uma experiência de usuário adequada em torno de solicitações de API backend para mostrar o progresso das solicitações e se comportar graciosamente quando as solicitações falharem devido à indisponibilidade da rede.</span><span class="sxs-lookup"><span data-stu-id="08f7d-260">Implement a suitable user experience around backend API requests to show the progress of requests and behave gracefully when requests fail due to network unavailability.</span></span>

<span data-ttu-id="08f7d-261">Além disso, os PWAs com capacidade off-line devem lidar com uma série de complicações adicionais.</span><span class="sxs-lookup"><span data-stu-id="08f7d-261">Additionally, offline-capable PWAs must deal with a range of additional complications.</span></span> <span data-ttu-id="08f7d-262">Os desenvolvedores devem se familiarizar cuidadosamente com as ressalvas nas seguintes seções.</span><span class="sxs-lookup"><span data-stu-id="08f7d-262">Developers should carefully familiarize themselves with the caveats in the following sections.</span></span>

### <a name="offline-support-only-when-published"></a><span data-ttu-id="08f7d-263">Suporte offline somente quando publicado</span><span class="sxs-lookup"><span data-stu-id="08f7d-263">Offline support only when published</span></span>

<span data-ttu-id="08f7d-264">Durante o desenvolvimento, você normalmente deseja ver cada alteração refletida imediatamente no navegador sem passar por um processo de atualização em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="08f7d-264">During development you typically want to see each change reflected immediately in the browser without going through a background update process.</span></span> <span data-ttu-id="08f7d-265">Portanto, Blazoro modelo PWA habilita o suporte off-line somente quando publicado.</span><span class="sxs-lookup"><span data-stu-id="08f7d-265">Therefore, Blazor's PWA template enables offline support only when published.</span></span>

<span data-ttu-id="08f7d-266">Ao criar um aplicativo offline, não basta testar o aplicativo no ambiente Dedesenvolvimento.</span><span class="sxs-lookup"><span data-stu-id="08f7d-266">When building an offline-capable app, it's not enough to test the app in the Development environment.</span></span> <span data-ttu-id="08f7d-267">Você deve testar o aplicativo em seu estado publicado para entender como ele responde a diferentes condições de rede.</span><span class="sxs-lookup"><span data-stu-id="08f7d-267">You must test the app in its published state to understand how it responds to different network conditions.</span></span>

### <a name="update-completion-after-user-navigation-away-from-app"></a><span data-ttu-id="08f7d-268">Atualize a conclusão após a navegação do usuário longe do aplicativo</span><span class="sxs-lookup"><span data-stu-id="08f7d-268">Update completion after user navigation away from app</span></span>

<span data-ttu-id="08f7d-269">As atualizações não são concluídas até que o usuário tenha navegado para longe do aplicativo em todas as guias.</span><span class="sxs-lookup"><span data-stu-id="08f7d-269">Updates don't complete until the user has navigated away from the app in all tabs.</span></span> <span data-ttu-id="08f7d-270">Como explicado na seção De verção de atualizações em [segundo plano,](#background-updates) depois de implantar uma atualização no aplicativo, o navegador busca os arquivos atualizados do trabalhador do serviço para iniciar o processo de atualização.</span><span class="sxs-lookup"><span data-stu-id="08f7d-270">As explained in the [Background updates](#background-updates) section, after you deploy an update to the app, the browser fetches the updated service worker files to begin the update process.</span></span>

<span data-ttu-id="08f7d-271">O que surpreende muitos desenvolvedores é que, mesmo quando esta atualização é concluída, ela **não** faz efeito até que o usuário tenha navegado em todas as guias.</span><span class="sxs-lookup"><span data-stu-id="08f7d-271">What surprises many developers is that, even when this update completes, it does **not** take effect until the user has navigated away in all tabs.</span></span> <span data-ttu-id="08f7d-272">**Não** basta atualizar a guia exibindo o aplicativo, mesmo que seja a única guia exibindo o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="08f7d-272">It is **not** sufficient to refresh the tab displaying the app, even if it's the only tab displaying the app.</span></span> <span data-ttu-id="08f7d-273">Até que seu aplicativo esteja completamente fechado, o novo funcionário permanece na *espera para ativar* o status.</span><span class="sxs-lookup"><span data-stu-id="08f7d-273">Until your app is completely closed, the new service worker remains in the *waiting to activate* status.</span></span> <span data-ttu-id="08f7d-274">**Isso não é Blazorespecífico, mas sim um comportamento padrão da plataforma web.**</span><span class="sxs-lookup"><span data-stu-id="08f7d-274">**This is not specific to Blazor, but rather is a standard web platform behavior.**</span></span>

<span data-ttu-id="08f7d-275">Isso geralmente incomoda os desenvolvedores que estão tentando testar atualizações para seu funcionário de serviço ou recursos armazenados em cache off-line.</span><span class="sxs-lookup"><span data-stu-id="08f7d-275">This commonly troubles developers who are trying to test updates to their service worker or offline cached resources.</span></span> <span data-ttu-id="08f7d-276">Se você verificar as ferramentas de desenvolvedor do navegador, você pode ver algo como o seguinte:</span><span class="sxs-lookup"><span data-stu-id="08f7d-276">If you check in the browser's developer tools, you may see something like the following:</span></span>

![A guia 'Aplicativo' do Google Chrome mostra que o Trabalhador de Serviço do aplicativo está 'esperando para ativar'.](progressive-web-app/_static/image7.png)

<span data-ttu-id="08f7d-278">Enquanto a lista de "clientes", que são guias ou janelas exibindo seu aplicativo, não estiver vazia, o trabalhador continuará esperando.</span><span class="sxs-lookup"><span data-stu-id="08f7d-278">For as long as the list of "clients," which are tabs or windows displaying your app, is nonempty, the worker continues waiting.</span></span> <span data-ttu-id="08f7d-279">A razão pela qual os trabalhadores do serviço fazem isso é para garantir a consistência.</span><span class="sxs-lookup"><span data-stu-id="08f7d-279">The reason service workers do this is to guarantee consistency.</span></span> <span data-ttu-id="08f7d-280">Consistência significa que todos os recursos são obtidos do mesmo cache atômico.</span><span class="sxs-lookup"><span data-stu-id="08f7d-280">Consistency means that all resources are fetched from the same atomic cache.</span></span>

<span data-ttu-id="08f7d-281">Ao testar alterações, você pode achar conveniente clicar no link "skipWaiting", como mostrado na captura de tela anterior, e depois recarregar a página.</span><span class="sxs-lookup"><span data-stu-id="08f7d-281">When testing changes, you may find it convenient to click the "skipWaiting" link as shown in the preceding screenshot, then reload the page.</span></span> <span data-ttu-id="08f7d-282">Você pode automatizar isso para todos os usuários codificando seu funcionário de serviço para [pular a fase de "espera" e ativar imediatamente na atualização](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#skip_the_waiting_phase).</span><span class="sxs-lookup"><span data-stu-id="08f7d-282">You can automate this for all users by coding your service worker to [skip the "waiting" phase and immediately activate on update](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#skip_the_waiting_phase).</span></span> <span data-ttu-id="08f7d-283">Se você pular a fase de espera, você está abrindo mão da garantia de que os recursos são sempre obtidos consistentemente a partir da mesma instância de cache.</span><span class="sxs-lookup"><span data-stu-id="08f7d-283">If you skip the waiting phase, you're giving up the guarantee that resources are always fetched consistently from the same cache instance.</span></span>

### <a name="users-may-run-any-historical-version-of-the-app"></a><span data-ttu-id="08f7d-284">Os usuários podem executar qualquer versão histórica do aplicativo</span><span class="sxs-lookup"><span data-stu-id="08f7d-284">Users may run any historical version of the app</span></span>

<span data-ttu-id="08f7d-285">Os desenvolvedores da Web normalmente esperam que os usuários executem apenas a versão mais recente implantada de seu aplicativo web, já que isso é normal dentro do modelo tradicional de distribuição web.</span><span class="sxs-lookup"><span data-stu-id="08f7d-285">Web developers habitually expect that users only run the latest deployed version of their web app, since that's normal within the traditional web distribution model.</span></span> <span data-ttu-id="08f7d-286">No entanto, um PWA off-line é mais parecido com um aplicativo móvel nativo, onde os usuários não estão necessariamente executando a versão mais recente.</span><span class="sxs-lookup"><span data-stu-id="08f7d-286">However, an offline-first PWA is more akin to a native mobile app, where users aren't necessarily running the latest version.</span></span>

<span data-ttu-id="08f7d-287">Como explicado na seção [De verção](#background-updates) de atualizações em segundo plano, depois de implantar uma atualização no seu aplicativo, cada usuário existente continua a usar uma versão anterior para pelo menos mais uma **visita,** porque a atualização ocorre em segundo plano e não é ativada até que o usuário navegue posteriormente.</span><span class="sxs-lookup"><span data-stu-id="08f7d-287">As explained in the [Background updates](#background-updates) section, after you deploy an update to your app, **each existing user continues to use a previous version for at least one further visit** because the update occurs in the background and isn't activated until the user thereafter navigates away.</span></span> <span data-ttu-id="08f7d-288">Além disso, a versão anterior que está sendo usada não é necessariamente a anterior que você implantou.</span><span class="sxs-lookup"><span data-stu-id="08f7d-288">Plus, the previous version being used isn't necessarily the previous one you deployed.</span></span> <span data-ttu-id="08f7d-289">A versão anterior pode ser *qualquer* versão histórica, dependendo de quando o usuário completou uma atualização pela última vez.</span><span class="sxs-lookup"><span data-stu-id="08f7d-289">The previous version can be *any* historical version, depending on when the user last completed an update.</span></span>

<span data-ttu-id="08f7d-290">Isso pode ser um problema se as partes frontend e backend do seu aplicativo exigirem acordo sobre o esquema para solicitações de API.</span><span class="sxs-lookup"><span data-stu-id="08f7d-290">This can be an issue if the frontend and backend parts of your app require agreement about the schema for API requests.</span></span> <span data-ttu-id="08f7d-291">Você não deve implantar alterações de esquema de API incompatíveis para trás até ter certeza de que todos os usuários foram atualizados.</span><span class="sxs-lookup"><span data-stu-id="08f7d-291">You must not deploy backward-incompatible API schema changes until you can be sure that all users have upgraded.</span></span> <span data-ttu-id="08f7d-292">Alternativamente, bloqueie os usuários de usar versões mais antigas incompatíveis do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="08f7d-292">Alternatively, block users from using incompatible older versions of the app.</span></span> <span data-ttu-id="08f7d-293">Esse requisito de cenário é o mesmo que para aplicativos móveis nativos.</span><span class="sxs-lookup"><span data-stu-id="08f7d-293">This scenario requirement is the same as for native mobile apps.</span></span> <span data-ttu-id="08f7d-294">Se você implantar uma mudança de quebra nas APIs do servidor, o aplicativo cliente será quebrado para usuários que ainda não atualizaram.</span><span class="sxs-lookup"><span data-stu-id="08f7d-294">If you deploy a breaking change in server APIs, the client app is broken for users who haven't yet updated.</span></span>

<span data-ttu-id="08f7d-295">Se possível, não implante alterações de quebra em suas APIs backend.</span><span class="sxs-lookup"><span data-stu-id="08f7d-295">If possible, don't deploy breaking changes to your backend APIs.</span></span> <span data-ttu-id="08f7d-296">Se você deve fazê-lo, considere usar [APIs padrão do Trabalhador de Serviço, como ServiceWorkerRegistration,](https://developer.mozilla.org/docs/Web/API/ServiceWorkerRegistration) para determinar se o aplicativo está atualizado e, se não, para evitar o uso.</span><span class="sxs-lookup"><span data-stu-id="08f7d-296">If you must do so, consider using [standard Service Worker APIs such as ServiceWorkerRegistration](https://developer.mozilla.org/docs/Web/API/ServiceWorkerRegistration) to determine whether the app is up-to-date, and if not, to prevent usage.</span></span>

### <a name="interference-with-server-rendered-pages"></a><span data-ttu-id="08f7d-297">Interferência com páginas renderizadas pelo servidor</span><span class="sxs-lookup"><span data-stu-id="08f7d-297">Interference with server-rendered pages</span></span>

<span data-ttu-id="08f7d-298">Conforme descrito na seção ['Enviar páginas renderizadas pelo servidor',](#support-server-rendered-pages) se você `/index.html` quiser ignorar o comportamento do trabalhador de serviço de devolver conteúdo para todas as solicitações de navegação, edite a lógica em seu trabalhador de serviço.</span><span class="sxs-lookup"><span data-stu-id="08f7d-298">As described in the [Support server-rendered pages](#support-server-rendered-pages) section, if you want to bypass the service worker's behavior of returning `/index.html` contents for all navigation requests, edit the logic in your service worker.</span></span>

### <a name="all-service-worker-asset-manifest-contents-are-cached-by-default"></a><span data-ttu-id="08f7d-299">Todo o conteúdo do manifesto de ativos do trabalhador de serviço é armazenado em cache por padrão</span><span class="sxs-lookup"><span data-stu-id="08f7d-299">All service worker asset manifest contents are cached by default</span></span>

<span data-ttu-id="08f7d-300">Conforme descrito na seção [Decache de ativos de Controle,](#control-asset-caching) o *arquivo serviço-trabalhador-assets.js* é gerado durante a compilação e lista todos os ativos que o trabalhador do serviço deve buscar e cache.</span><span class="sxs-lookup"><span data-stu-id="08f7d-300">As described in the [Control asset caching](#control-asset-caching) section, the file *service-worker-assets.js* is generated during build and lists all assets the service worker should fetch and cache.</span></span>

<span data-ttu-id="08f7d-301">Uma vez que esta lista por padrão inclui tudo o que é emitido para *wwwroot*, incluindo conteúdo fornecido por pacotes e projetos externos, você deve ter cuidado para não colocar muito conteúdo lá.</span><span class="sxs-lookup"><span data-stu-id="08f7d-301">Since this list by default includes everything emitted to *wwwroot*, including content supplied by external packages and projects, you must be careful not to put too much content there.</span></span> <span data-ttu-id="08f7d-302">Se o diretório *wwwroot* contiver milhões de imagens, o funcionário do serviço tentará buscar e cacheá-las todas, consumindo largura de banda excessiva e provavelmente não completando com sucesso.</span><span class="sxs-lookup"><span data-stu-id="08f7d-302">If the *wwwroot* directory contains millions of images, the service worker tries to fetch and cache them all, consuming excessive bandwidth and most likely not completing successfully.</span></span>

<span data-ttu-id="08f7d-303">Implementar lógica arbitrária para controlar qual subconjunto do conteúdo do manifesto deve ser `onInstall` buscado e armazenado em cache editando a função no *service-worker.published.js*.</span><span class="sxs-lookup"><span data-stu-id="08f7d-303">Implement arbitrary logic to control which subset of the manifest's contents should be fetched and cached by editing the `onInstall` function in *service-worker.published.js*.</span></span>

### <a name="interaction-with-authentication"></a><span data-ttu-id="08f7d-304">Interação com autenticação</span><span class="sxs-lookup"><span data-stu-id="08f7d-304">Interaction with authentication</span></span>

<span data-ttu-id="08f7d-305">É possível usar a opção de modelo PWA em conjunto com as opções de autenticação.</span><span class="sxs-lookup"><span data-stu-id="08f7d-305">It's possible to use the PWA template option in conjunction with the authentication options.</span></span> <span data-ttu-id="08f7d-306">Um PWA com capacidade offline também pode suportar autenticação quando o usuário tem conectividade de rede.</span><span class="sxs-lookup"><span data-stu-id="08f7d-306">An offline-capable PWA can also support authentication when the user has network connectivity.</span></span>

<span data-ttu-id="08f7d-307">Quando um usuário não tem conectividade de rede, ele não pode autenticar ou obter tokens de acesso.</span><span class="sxs-lookup"><span data-stu-id="08f7d-307">When a user doesn't have network connectivity, they can't authenticate or obtain access tokens.</span></span> <span data-ttu-id="08f7d-308">Por padrão, tentar visitar a página de login sem acesso à rede resulta em uma mensagem de "erro de rede".</span><span class="sxs-lookup"><span data-stu-id="08f7d-308">By default, attempting to visit the login page without network access results in a "network error" message.</span></span>

<span data-ttu-id="08f7d-309">Você deve projetar um fluxo de iu que permite que o usuário faça coisas úteis enquanto estiver offline sem tentar autenticar ou obter tokens de acesso.</span><span class="sxs-lookup"><span data-stu-id="08f7d-309">You must design a UI flow that lets the user do useful things while offline without attempting to authenticate or obtain access tokens.</span></span> <span data-ttu-id="08f7d-310">Alternativamente, você pode projetar o aplicativo para falhar de forma graciosa quando a rede não está disponível.</span><span class="sxs-lookup"><span data-stu-id="08f7d-310">Alternatively, you can design the app to fail in a graceful way when the network isn't available.</span></span> <span data-ttu-id="08f7d-311">Se isso não for possível em seu aplicativo, talvez você não queira ativar o suporte off-line.</span><span class="sxs-lookup"><span data-stu-id="08f7d-311">If this isn't possible in your app, you might not want to enable offline support.</span></span>
