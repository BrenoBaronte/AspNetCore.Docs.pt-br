---
title: Crie aplicativos Web progressivos com ASP.NET Core Blazor Webassembly
author: guardrex
description: Saiba como criar PWAs (aplicativos Web progressivos) baseados em Blazor, aplicativos Web que usam recursos de navegador modernos para se comportarem como aplicativos da área de trabalho.
monikerRange: '>= aspnetcore-3.1'
ms.author: riande
ms.custom: mvc
ms.date: 03/09/2020
no-loc:
- Blazor
- SignalR
uid: blazor/progressive-web-app
ms.openlocfilehash: f1c1ce50f20bf579e67e1d4eb02cc7d9d681e354
ms.sourcegitcommit: 98bcf5fe210931e3eb70f82fd675d8679b33f5d6
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 03/11/2020
ms.locfileid: "79083716"
---
# <a name="build-progressive-web-applications-with-aspnet-core-opno-locblazor-webassembly"></a><span data-ttu-id="ddc93-103">Crie aplicativos Web progressivos com ASP.NET Core Blazor Webassembly</span><span class="sxs-lookup"><span data-stu-id="ddc93-103">Build Progressive Web Applications with ASP.NET Core Blazor WebAssembly</span></span>

<span data-ttu-id="ddc93-104">Por [Steve Sanderson](https://github.com/SteveSandersonMS)</span><span class="sxs-lookup"><span data-stu-id="ddc93-104">By [Steve Sanderson](https://github.com/SteveSandersonMS)</span></span>

[!INCLUDE[](~/includes/blazorwasm-preview-notice.md)]

[!INCLUDE[](~/includes/blazorwasm-3.2-template-article-notice.md)]

<span data-ttu-id="ddc93-105">Um aplicativo Web progressivo (PWA) é um aplicativo baseado na Web que usa APIs e recursos modernos de navegador para se comportar como um aplicativo de área de trabalho.</span><span class="sxs-lookup"><span data-stu-id="ddc93-105">A Progressive Web Application (PWA) is a web-based application that uses modern browser APIs and capabilities to behave like a desktop application.</span></span> <span data-ttu-id="ddc93-106">Esses recursos podem incluir:</span><span class="sxs-lookup"><span data-stu-id="ddc93-106">These capabilities can include:</span></span>

* <span data-ttu-id="ddc93-107">Trabalhando offline e sempre carregando instantaneamente, independentemente da velocidade da rede</span><span class="sxs-lookup"><span data-stu-id="ddc93-107">Working offline and always loading instantly, independently of network speed</span></span>
* <span data-ttu-id="ddc93-108">Ser capaz de executar em sua própria janela de aplicativo, não apenas em uma janela de navegador</span><span class="sxs-lookup"><span data-stu-id="ddc93-108">Being able to run in its own application window, not just a browser window</span></span>
* <span data-ttu-id="ddc93-109">Sendo iniciado no menu Iniciar do sistema operacional do host (SO), no Dock ou na tela inicial</span><span class="sxs-lookup"><span data-stu-id="ddc93-109">Being launched from the host operating system (OS) start menu, dock, or home screen</span></span>
* <span data-ttu-id="ddc93-110">Receber notificações por push de um servidor de back-end, mesmo que o usuário não esteja usando o aplicativo</span><span class="sxs-lookup"><span data-stu-id="ddc93-110">Receiving push notifications from a backend server, even while the user is not using the application</span></span>
* <span data-ttu-id="ddc93-111">Atualizando automaticamente em segundo plano</span><span class="sxs-lookup"><span data-stu-id="ddc93-111">Automatically updating in the background</span></span>

<span data-ttu-id="ddc93-112">Um usuário pode primeiro descobrir e usar o aplicativo em seu navegador da Web, como qualquer outro aplicativo de página única (SPA), depois progredir posteriormente para instalá-lo em seu sistema operacional e habilitar notificações por push.</span><span class="sxs-lookup"><span data-stu-id="ddc93-112">A user might first discover and use the application within their web browser like any other single-page application (SPA), then later progress to installing it in their OS and enabling push notifications.</span></span> <span data-ttu-id="ddc93-113">É por isso que usamos o termo *progressivo*.</span><span class="sxs-lookup"><span data-stu-id="ddc93-113">That's why we use the term *progressive*.</span></span>

Blazor<span data-ttu-id="ddc93-114"> Webassembly é uma plataforma de aplicativo Web baseada em padrões verdadeira, para que possa usar qualquer API de navegador, incluindo as APIs do PWA necessárias para os recursos listados acima.</span><span class="sxs-lookup"><span data-stu-id="ddc93-114"> WebAssembly is a true standards-based client-side web application platform, so it can use any browser API, including PWA APIs needed for the capabilities listed above.</span></span> <span data-ttu-id="ddc93-115">Ele pode trabalhar offline, assim como qualquer outra tecnologia da Web do lado do cliente.</span><span class="sxs-lookup"><span data-stu-id="ddc93-115">It can work offline just like any other client-side web technology.</span></span>

## <a name="pwa-template"></a><span data-ttu-id="ddc93-116">Modelo do PWA</span><span class="sxs-lookup"><span data-stu-id="ddc93-116">PWA template</span></span>

<span data-ttu-id="ddc93-117">Ao criar um novo aplicativo Webassembly Blazor, você terá a opção de adicionar recursos do PWA.</span><span class="sxs-lookup"><span data-stu-id="ddc93-117">When creating a new Blazor WebAssembly application, you are offered the option to add PWA features.</span></span> <span data-ttu-id="ddc93-118">No Visual Studio, a opção é fornecida como uma caixa de seleção na caixa de diálogo criação do projeto:</span><span class="sxs-lookup"><span data-stu-id="ddc93-118">In Visual Studio, the option is given as a checkbox in the project creation dialog:</span></span>

![image](https://user-images.githubusercontent.com/1101362/76207411-a6b54200-61f5-11ea-9dfc-6acd87a91428.png)

<span data-ttu-id="ddc93-120">Se você estiver criando o projeto na linha de comando, poderá usar o sinalizador `--pwa`.</span><span class="sxs-lookup"><span data-stu-id="ddc93-120">If you're creating the project on the command line, you can use the `--pwa` flag.</span></span> <span data-ttu-id="ddc93-121">Por exemplo,</span><span class="sxs-lookup"><span data-stu-id="ddc93-121">For example,</span></span>

```dotnetcli
dotnet new blazorwasm --pwa -o MyNewProject
```

<span data-ttu-id="ddc93-122">Em ambos os casos, você está livre para combinar isso com a opção "ASP.NET Core hospedado", se desejar, mas não precisa fazer isso.</span><span class="sxs-lookup"><span data-stu-id="ddc93-122">In both cases, you're free to combine this with the "ASP.NET Core hosted" option if you wish, but don't have to do so.</span></span> <span data-ttu-id="ddc93-123">Os recursos do PWA são independentes do modelo de hospedagem.</span><span class="sxs-lookup"><span data-stu-id="ddc93-123">PWA features are independent of the hosting model.</span></span>

## <a name="installation-and-app-manifest"></a><span data-ttu-id="ddc93-124">Instalação e manifesto do aplicativo</span><span class="sxs-lookup"><span data-stu-id="ddc93-124">Installation and app manifest</span></span>

<span data-ttu-id="ddc93-125">Ao visitar um aplicativo criado usando a opção de modelo do PWA, os usuários têm a opção de instalar o aplicativo no menu Iniciar, no Dock ou na tela inicial do sistema operacional.</span><span class="sxs-lookup"><span data-stu-id="ddc93-125">When visiting an application created using the PWA template option, users have the option to install the application into their OS's start menu, dock, or home screen.</span></span>

<span data-ttu-id="ddc93-126">A maneira como essa opção é apresentada depende do navegador do usuário.</span><span class="sxs-lookup"><span data-stu-id="ddc93-126">The way this option is presented depends on the user's browser.</span></span> <span data-ttu-id="ddc93-127">Por exemplo, ao usar navegadores baseados em desktop Chromium, como Edge ou Chrome, um botão *Adicionar* aparece na barra de URL:</span><span class="sxs-lookup"><span data-stu-id="ddc93-127">For example, when using desktop Chromium-based browsers such as Edge or Chrome, an *Add* button appears within the URL bar:</span></span>

![image](https://user-images.githubusercontent.com/1101362/76208127-f7796a80-61f6-11ea-8aea-7fba704be787.png)

<span data-ttu-id="ddc93-129">No iOS, os visitantes podem instalar o PWA usando o botão *compartilhar* do Safari e sua opção *Adicionar à homescreen* .</span><span class="sxs-lookup"><span data-stu-id="ddc93-129">On iOS, visitors can install the PWA using Safari's *Share* button and its *Add to Homescreen* option.</span></span> <span data-ttu-id="ddc93-130">No Chrome para Android, os usuários devem tocar no botão de *menu* no canto superior direito e, em seguida, escolher *Adicionar à tela inicial*.</span><span class="sxs-lookup"><span data-stu-id="ddc93-130">On Chrome for Android, users should tap the *Menu* button in the upper-right corner, then choose *Add to Home screen*.</span></span>

<span data-ttu-id="ddc93-131">Uma vez instalado, o aplicativo aparece em sua própria janela, sem nenhuma barra de endereço.</span><span class="sxs-lookup"><span data-stu-id="ddc93-131">Once installed, the application appears in its own window, without any address bar.</span></span>

![image](https://user-images.githubusercontent.com/1101362/76208588-e2e9a200-61f7-11ea-85e1-8c3fc849b252.png)

<span data-ttu-id="ddc93-133">Para personalizar o título, o esquema de cores, o ícone ou outros detalhes da janela, consulte o arquivo `manifest.json` no diretório *wwwroot* do seu projeto.</span><span class="sxs-lookup"><span data-stu-id="ddc93-133">To customize the window's title, color scheme, icon, or other details, see the file `manifest.json` in your project's *wwwroot* directory.</span></span> <span data-ttu-id="ddc93-134">O esquema desse arquivo é definido por padrões da Web.</span><span class="sxs-lookup"><span data-stu-id="ddc93-134">The schema of this file is defined by web standards.</span></span> <span data-ttu-id="ddc93-135">Para obter a documentação detalhada, consulte https://developer.mozilla.org/docs/Web/Manifest.</span><span class="sxs-lookup"><span data-stu-id="ddc93-135">For detailed documentation, see https://developer.mozilla.org/docs/Web/Manifest.</span></span>

## <a name="offline-support"></a><span data-ttu-id="ddc93-136">Suporte offline</span><span class="sxs-lookup"><span data-stu-id="ddc93-136">Offline support</span></span>

<span data-ttu-id="ddc93-137">Por padrão, os aplicativos criados usando a opção de modelo do PWA têm suporte para execução offline.</span><span class="sxs-lookup"><span data-stu-id="ddc93-137">By default, applications created using the PWA template option have support for running offline.</span></span> <span data-ttu-id="ddc93-138">Um usuário deve primeiro visitar o aplicativo enquanto estiver online, então o navegador baixará automaticamente e armazenará em cache todos os recursos necessários para operar offline.</span><span class="sxs-lookup"><span data-stu-id="ddc93-138">A user must first visit the application while they are online, then the browser will automatically download and cache all the resources needed to operate offline.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="ddc93-139">O suporte offline só está habilitado para aplicativos *publicados* .</span><span class="sxs-lookup"><span data-stu-id="ddc93-139">Offline support is only enabled for *published* applications.</span></span> <span data-ttu-id="ddc93-140">Ele não é habilitado durante o desenvolvimento.</span><span class="sxs-lookup"><span data-stu-id="ddc93-140">It is not enabled during development.</span></span> <span data-ttu-id="ddc93-141">Isso ocorre porque ele interferiria com o ciclo de desenvolvimento normal de fazer alterações e testá-las.</span><span class="sxs-lookup"><span data-stu-id="ddc93-141">This is because it would interfere with the usual development cycle of making changes and testing them.</span></span>

> [!WARNING]
> <span data-ttu-id="ddc93-142">Se você pretende enviar um PWA habilitado para offline, há [vários avisos e advertências importantes](#caveats-for-offline-pwas) que você precisa entender.</span><span class="sxs-lookup"><span data-stu-id="ddc93-142">If you intend to ship an offline-enabled PWA, there are [several important warnings and caveats](#caveats-for-offline-pwas) you need to understand.</span></span> <span data-ttu-id="ddc93-143">Elas são inerentes a PWAs offline e não específicas a Blazor.</span><span class="sxs-lookup"><span data-stu-id="ddc93-143">These are inherent to offline PWAs, and not specific to Blazor.</span></span> <span data-ttu-id="ddc93-144">Certifique-se de ler e entender essas advertências antes de fazer suposições sobre como seu aplicativo habilitado para offline funcionará.</span><span class="sxs-lookup"><span data-stu-id="ddc93-144">Be sure to read and understand these caveats before making assumptions about how your offline-enabled application will work.</span></span>

<span data-ttu-id="ddc93-145">Para ver como o suporte offline funciona, primeiro [Publique seu aplicativo](https://docs.microsoft.com/aspnet/core/host-and-deploy/blazor/?view=aspnetcore-3.1&tabs=visual-studio#publish-the-app)e hospede-o em um servidor com suporte para https.</span><span class="sxs-lookup"><span data-stu-id="ddc93-145">To see how offline support works, first [publish your application](https://docs.microsoft.com/aspnet/core/host-and-deploy/blazor/?view=aspnetcore-3.1&tabs=visual-studio#publish-the-app), and host it on a server supporting HTTPS.</span></span> <span data-ttu-id="ddc93-146">Ao visitar o aplicativo, você poderá abrir as ferramentas de desenvolvimento do navegador e verificar se um *trabalhador de serviço* está registrado para o host:</span><span class="sxs-lookup"><span data-stu-id="ddc93-146">When you visit the application, you should be able to open the browser's dev tools and verify that a *Service Worker* is registered for your host:</span></span>

![image](https://user-images.githubusercontent.com/1101362/76210294-bd5e9780-61fb-11ea-9869-65c55c62803d.png)

<span data-ttu-id="ddc93-148">Além disso, se você recarregar a página, na guia *rede* , você verá que todos os recursos necessários para carregar sua página estão sendo recuperados do *trabalho de serviço* ou do *cache de memória*:</span><span class="sxs-lookup"><span data-stu-id="ddc93-148">Additionally, if you reload the page, then on the *Network* tab you should see that all resources needed to load your page are being retrieved from the *Service Worker* or *Memory Cache*:</span></span>

![image](https://user-images.githubusercontent.com/1101362/76210472-1d553e00-61fc-11ea-84c6-291644df709e.png)

<span data-ttu-id="ddc93-150">Isso mostra que o navegador não depende do acesso à rede para carregar seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ddc93-150">This shows that the browser is not dependent on network access to load your application.</span></span> <span data-ttu-id="ddc93-151">Para verificar isso, você pode desligar o servidor Web ou instruir o navegador para simular o modo offline:</span><span class="sxs-lookup"><span data-stu-id="ddc93-151">To verify this, you can either shut down your web server, or instruct the browser to simulate offline mode:</span></span>

![image](https://user-images.githubusercontent.com/1101362/76210556-47a6fb80-61fc-11ea-9d12-20a8f6528744.png)

<span data-ttu-id="ddc93-153">Agora, mesmo sem acesso ao seu servidor Web, você deve ser capaz de recarregar a página e ver que seu aplicativo ainda é carregado e executado.</span><span class="sxs-lookup"><span data-stu-id="ddc93-153">Now, even without access to your web server, you should be able to reload the page and see that your application still loads and runs.</span></span> <span data-ttu-id="ddc93-154">Da mesma forma, mesmo se você simular uma conexão de rede muito lenta, sua página ainda será carregada imediatamente, pois é carregada independentemente da rede.</span><span class="sxs-lookup"><span data-stu-id="ddc93-154">Likewise, even if you simulate a very slow network connection, your page will still load immediately since it is loaded independently of the network.</span></span>

### <a name="service-worker"></a><span data-ttu-id="ddc93-155">Trabalhador do serviço</span><span class="sxs-lookup"><span data-stu-id="ddc93-155">Service worker</span></span>

<span data-ttu-id="ddc93-156">O suporte offline é obtido usando um trabalhador de serviço.</span><span class="sxs-lookup"><span data-stu-id="ddc93-156">Offline support is achieved using a service worker.</span></span> <span data-ttu-id="ddc93-157">Este é um padrão da Web, não específico para Blazor.</span><span class="sxs-lookup"><span data-stu-id="ddc93-157">This is a web standard, not specific to Blazor.</span></span> <span data-ttu-id="ddc93-158">Para obter a documentação sobre trabalhadores de serviço, consulte https://developer.mozilla.org/docs/Web/API/Service_Worker_API.</span><span class="sxs-lookup"><span data-stu-id="ddc93-158">For documentation about service workers, see https://developer.mozilla.org/docs/Web/API/Service_Worker_API.</span></span> <span data-ttu-id="ddc93-159">Para saber mais sobre padrões de uso comuns para trabalhadores de serviço, confira o artigo excelente [do ciclo de vida do trabalho do serviço](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle).</span><span class="sxs-lookup"><span data-stu-id="ddc93-159">To learn more about common usage patterns for service workers, see the excellent article [The Service Worker Lifecycle](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle).</span></span>

<span data-ttu-id="ddc93-160">o modelo do PWA do Blazorproduz dois arquivos de trabalho do serviço:</span><span class="sxs-lookup"><span data-stu-id="ddc93-160">Blazor's PWA template produces two service worker files:</span></span>

* <span data-ttu-id="ddc93-161">*wwwroot/Service-Worker. js*, que é usado durante o desenvolvimento</span><span class="sxs-lookup"><span data-stu-id="ddc93-161">*wwwroot/service-worker.js*, which is used during development</span></span>
* <span data-ttu-id="ddc93-162">*wwwroot/Service-Worker. published. js*, que é usado quando o aplicativo é publicado</span><span class="sxs-lookup"><span data-stu-id="ddc93-162">*wwwroot/service-worker.published.js*, which is used once your application is published</span></span>

<span data-ttu-id="ddc93-163">Se você quiser compartilhar lógica entre esses dois arquivos, considere adicionar um terceiro arquivo JavaScript para manter a lógica comum e usar [`self.importScripts`](https://developer.mozilla.org/docs/Web/API/WorkerGlobalScope/importScripts) para carregar essa lógica em ambos os arquivos.</span><span class="sxs-lookup"><span data-stu-id="ddc93-163">If you want to share logic between these two files, consider adding a third JavaScript file to hold the common logic, and use [`self.importScripts`](https://developer.mozilla.org/docs/Web/API/WorkerGlobalScope/importScripts) to load that logic into both files.</span></span>

#### <a name="cache-first-fetch-strategy"></a><span data-ttu-id="ddc93-164">Estratégia de busca de cache-primeiro</span><span class="sxs-lookup"><span data-stu-id="ddc93-164">Cache-first fetch strategy</span></span>

<span data-ttu-id="ddc93-165">O trabalho de serviço interno *Service-Worker. published. js* resolve solicitações usando uma estratégia *de cache-First* .</span><span class="sxs-lookup"><span data-stu-id="ddc93-165">The built-in *service-worker.published.js* service worker resolves requests using a *cache-first* strategy.</span></span> <span data-ttu-id="ddc93-166">Isso significa que ele sempre prefere retornar o conteúdo armazenado em cache, se disponível, independentemente de o usuário ter acesso à rede ou se o conteúdo mais recente está disponível no servidor.</span><span class="sxs-lookup"><span data-stu-id="ddc93-166">This means it always prefers to return cached content if available, regardless of whether the user has network access or whether newer content is available on the server.</span></span>

<span data-ttu-id="ddc93-167">Há dois motivos para isso ser valioso:</span><span class="sxs-lookup"><span data-stu-id="ddc93-167">There are two reasons why this is valuable:</span></span>

* <span data-ttu-id="ddc93-168">**Ele garante a confiabilidade.**</span><span class="sxs-lookup"><span data-stu-id="ddc93-168">**It ensures reliability.**</span></span> <span data-ttu-id="ddc93-169">O acesso à rede não é um estado booliano.</span><span class="sxs-lookup"><span data-stu-id="ddc93-169">Network access is not a boolean state.</span></span> <span data-ttu-id="ddc93-170">Um usuário não está simplesmente "online" ou "offline".</span><span class="sxs-lookup"><span data-stu-id="ddc93-170">A user is not simply "online" or "offline".</span></span> <span data-ttu-id="ddc93-171">Na realidade, o dispositivo do usuário pode acreditar que está online, mas a rede pode ser tão lenta quanto ser impraticável de esperar.</span><span class="sxs-lookup"><span data-stu-id="ddc93-171">In reality, the user's device may believe it is online, but the network may be so slow as to be impractical to wait for.</span></span> <span data-ttu-id="ddc93-172">Ou a rede pode estar retornando resultados inválidos para determinadas URLs, como quando há um portal WIFI cativo que está atualmente bloqueando ou redirecionando determinadas solicitações.</span><span class="sxs-lookup"><span data-stu-id="ddc93-172">Or the network might be returning invalid results for certain URLs, such as when there is a captive WIFI portal that is currently blocking or redirecting certain requests.</span></span> <span data-ttu-id="ddc93-173">É por isso que a API de `navigator.onLine` do navegador não é confiável e não deve ser dependente.</span><span class="sxs-lookup"><span data-stu-id="ddc93-173">This is why the browser's `navigator.onLine` API is not reliable and should not be depended upon.</span></span>
* <span data-ttu-id="ddc93-174">**Ele garante a exatidão.**</span><span class="sxs-lookup"><span data-stu-id="ddc93-174">**It ensures correctness.**</span></span> <span data-ttu-id="ddc93-175">Ao criar um cache de recursos offline, o trabalho de serviço usa o hash de conteúdo para garantir que ele tenha buscado um instantâneo completo e autoconsistente de recursos em um único instante no tempo.</span><span class="sxs-lookup"><span data-stu-id="ddc93-175">When building a cache of offline resources, the service worker uses content hashing to guarantee it has fetched a complete and self-consistent snapshot of resources at a single instant in time.</span></span> <span data-ttu-id="ddc93-176">Esse cache é usado como uma unidade atômica.</span><span class="sxs-lookup"><span data-stu-id="ddc93-176">This cache is then used as an atomic unit.</span></span> <span data-ttu-id="ddc93-177">Considerando isso, não há nenhum ponto de solicitar aos recursos mais recentes da rede, pois as únicas versões que você deseja são aquelas que você já armazenou em cache.</span><span class="sxs-lookup"><span data-stu-id="ddc93-177">Given this, there is no point asking the network for newer resources, since the only versions you want are the ones you've already cached.</span></span> <span data-ttu-id="ddc93-178">Qualquer outro risco de inconsistência e incompatibilidade (por exemplo, tentar usar versões de assemblies do .NET que não foram compiladas juntas).</span><span class="sxs-lookup"><span data-stu-id="ddc93-178">Anything else risks inconsistency and incompatibility (for example, trying to use versions of .NET assemblies that were not compiled together).</span></span>

#### <a name="background-updates"></a><span data-ttu-id="ddc93-179">Atualizações em segundo plano</span><span class="sxs-lookup"><span data-stu-id="ddc93-179">Background updates</span></span>

<span data-ttu-id="ddc93-180">Como um modelo mental, você pode considerar um PWA offline como se comportando como um aplicativo móvel que pode ser instalado.</span><span class="sxs-lookup"><span data-stu-id="ddc93-180">As a mental model, you can think of an offline-first PWA as behaving like an mobile app that can be installed.</span></span> <span data-ttu-id="ddc93-181">Ele sempre é iniciado imediatamente, independentemente da conectividade de rede, mas a lógica do aplicativo instalado vem de um instantâneo pontual que pode não ser a versão mais recente.</span><span class="sxs-lookup"><span data-stu-id="ddc93-181">It always starts up immediately regardless of network connectivity, but the installed application logic comes from a point-in-time snapshot that might not be the latest version.</span></span>

<span data-ttu-id="ddc93-182">O modelo do Blazor PWA produz aplicativos que tentam se atualizar automaticamente em segundo plano sempre que o usuário visita e tem uma conexão de rede em funcionamento.</span><span class="sxs-lookup"><span data-stu-id="ddc93-182">The Blazor PWA template produces applications that automatically try to update themselves in the background whenever the user visits and has a working network connection.</span></span> <span data-ttu-id="ddc93-183">A maneira como isso funciona é a seguinte:</span><span class="sxs-lookup"><span data-stu-id="ddc93-183">The way this works is as follows:</span></span>

* <span data-ttu-id="ddc93-184">Durante a compilação, seu projeto gera um *manifesto de ativos de trabalho de serviço*.</span><span class="sxs-lookup"><span data-stu-id="ddc93-184">During compilation, your project generates a *service worker assets manifest*.</span></span> <span data-ttu-id="ddc93-185">Por padrão, isso é chamado de *Service-Worker-assets. js*.</span><span class="sxs-lookup"><span data-stu-id="ddc93-185">By default this is called *service-worker-assets.js*.</span></span> <span data-ttu-id="ddc93-186">Isso lista todos os recursos estáticos que seu aplicativo precisa para funcionar offline, como assemblies .NET, arquivos JavaScript, CSS, etc., incluindo seus hashes de conteúdo.</span><span class="sxs-lookup"><span data-stu-id="ddc93-186">This lists all the static resources your application needs to function offline, such as .NET assemblies, JavaScript files, CSS, etc., including their content hashes.</span></span> <span data-ttu-id="ddc93-187">Essa lista é carregada pelo seu trabalhador de serviço para que ele saiba quais recursos armazenar em cache.</span><span class="sxs-lookup"><span data-stu-id="ddc93-187">This list is loaded by your service worker so that it knows which resources to cache.</span></span>
* <span data-ttu-id="ddc93-188">Cada vez que o usuário visita seu aplicativo, o navegador solicita novamente *Service-Worker. js* e *Service-Worker-assets. js* em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="ddc93-188">Each time the user visits your application, the browser re-requests *service-worker.js* and *service-worker-assets.js* in the background.</span></span> <span data-ttu-id="ddc93-189">Se o servidor retornar o conteúdo alterado para qualquer um desses arquivos (comparado byte a byte com o trabalho do serviço instalado existente), o trabalho do serviço tentará instalar uma nova versão de si mesmo.</span><span class="sxs-lookup"><span data-stu-id="ddc93-189">If the server returns changed content for either of these files (compared byte-for-byte with the existing installed service worker), the service worker tries to install a new version of itself.</span></span>
* <span data-ttu-id="ddc93-190">Ao instalar uma nova versão de si mesma, o trabalho de serviço cria um novo cache separado para recursos offline e começa a preenchê-lo com os recursos listados em *Service-Worker-assets. js*.</span><span class="sxs-lookup"><span data-stu-id="ddc93-190">When installing a new version of itself, the service worker creates a new, separate cache for offline resources, and starts populating it with resources listed in *service-worker-assets.js*.</span></span> <span data-ttu-id="ddc93-191">Essa lógica é implementada na função `onInstall` dentro de *Service-Worker. published. js*.</span><span class="sxs-lookup"><span data-stu-id="ddc93-191">This logic is implemented in the `onInstall` function inside *service-worker.published.js*.</span></span>
* <span data-ttu-id="ddc93-192">Se o processo for concluído com êxito (ou seja, todos os recursos forem carregados sem erros e todos os hashes de conteúdo corresponderem), o novo trabalho de serviço entrará em um estado "aguardando ativação".</span><span class="sxs-lookup"><span data-stu-id="ddc93-192">If the process completes successfully (i.e., all the resources are loaded without error, and all content hashes match), then the new service worker enters a "waiting for activation" state.</span></span> <span data-ttu-id="ddc93-193">Assim que o usuário fecha seu aplicativo (ou seja, não há guias restantes ou janelas exibindo seu aplicativo), o novo trabalho de serviço se torna "ativo" e será usado para visitas subsequentes ao seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ddc93-193">As soon as the user closes your application (i.e., there are no remaining tabs or windows displaying your application), the new service worker becomes "active" and will be used for subsequent visits to your application.</span></span> <span data-ttu-id="ddc93-194">O antigo trabalho de serviço e seu cache são excluídos.</span><span class="sxs-lookup"><span data-stu-id="ddc93-194">The old service worker and its cache are deleted.</span></span>
* <span data-ttu-id="ddc93-195">Se o processo não for concluído com êxito, a nova instância de trabalho do serviço será descartada.</span><span class="sxs-lookup"><span data-stu-id="ddc93-195">If the process does not complete successfully, the new service worker instance is discarded.</span></span> <span data-ttu-id="ddc93-196">O processo de atualização será tentado novamente na próxima visita do usuário, quando espero que eles tenham uma conexão de rede melhor que possa concluir as solicitações.</span><span class="sxs-lookup"><span data-stu-id="ddc93-196">The update process will be attempted again on the user's next visit, when hopefully they have a better network connection that can complete the requests.</span></span>

<span data-ttu-id="ddc93-197">Você pode personalizar qualquer aspecto desse processo editando a lógica de trabalho do serviço.</span><span class="sxs-lookup"><span data-stu-id="ddc93-197">You can customize any aspect of this process by editing the service worker logic.</span></span> <span data-ttu-id="ddc93-198">Nenhuma das opções acima é específica para Blazor, mas é meramente uma sugestão fornecida pela opção de modelo do PWA.</span><span class="sxs-lookup"><span data-stu-id="ddc93-198">None of the above is specific to Blazor, but is merely a suggestion provided by the PWA template option.</span></span> <span data-ttu-id="ddc93-199">Consulte a [documentação do trabalhador do serviço](https://developer.mozilla.org/docs/Web/API/Service_Worker_API.) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="ddc93-199">See [service worker documentation](https://developer.mozilla.org/docs/Web/API/Service_Worker_API.) for more information.</span></span>

#### <a name="how-requests-are-resolved"></a><span data-ttu-id="ddc93-200">Como as solicitações são resolvidas</span><span class="sxs-lookup"><span data-stu-id="ddc93-200">How requests are resolved</span></span>

<span data-ttu-id="ddc93-201">Conforme descrito acima, o operador de serviço padrão usa uma estratégia de *cache-First* , o que significa que ele tenta fornecer conteúdo em cache quando disponível.</span><span class="sxs-lookup"><span data-stu-id="ddc93-201">As described above, the default service worker uses a *cache-first* strategy, meaning that it tries to serve cached content when available.</span></span> <span data-ttu-id="ddc93-202">Se não houver nenhum conteúdo armazenado em cache para uma determinada URL, por exemplo, ao solicitar dados de uma API de back-end, o trabalho do serviço voltará a uma solicitação de rede regular que só poderá ser realizada se o servidor estiver acessível.</span><span class="sxs-lookup"><span data-stu-id="ddc93-202">If there is no content cached for a certain URL, for example when requesting data from a backend API, the service worker falls back on a regular network request which can only succeed if the server is reachable.</span></span> <span data-ttu-id="ddc93-203">Essa lógica é implementada dentro de `onFetch` em *Service-Worker. published. js*.</span><span class="sxs-lookup"><span data-stu-id="ddc93-203">This logic is implemented inside `onFetch` within *service-worker.published.js*.</span></span>

<span data-ttu-id="ddc93-204">Se seus componentes de Blazor dependem da solicitação de dados de APIs de back-end e você deseja fornecer uma experiência de usuário amigável no caso em que tais solicitações falham devido à indisponibilidade da rede, você precisa implementar a lógica em seus componentes.</span><span class="sxs-lookup"><span data-stu-id="ddc93-204">If your Blazor components rely on requesting data from backend APIs, and you want to provide a friendly user experience in the case where such requests fail due to network unavailability, then you need to implement logic within your components.</span></span> <span data-ttu-id="ddc93-205">Por exemplo, use `try/catch` em `HttpClient` solicitações.</span><span class="sxs-lookup"><span data-stu-id="ddc93-205">For example, use `try/catch` around `HttpClient` requests.</span></span>

#### <a name="support-server-rendered-pages"></a><span data-ttu-id="ddc93-206">Suporte a páginas renderizadas pelo servidor</span><span class="sxs-lookup"><span data-stu-id="ddc93-206">Support server-rendered pages</span></span>

<span data-ttu-id="ddc93-207">Considere o que acontece quando o usuário navega pela primeira vez para uma URL como `/counter` ou qualquer outro link profundo em seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ddc93-207">Consider what happens when the user first navigates to a URL such as `/counter` or any other deep link into your application.</span></span> <span data-ttu-id="ddc93-208">Nesses casos, você não deseja retornar o conteúdo armazenado em cache como `/counter`, mas, em vez disso, precisa do navegador para carregar o conteúdo armazenado em cache como `/index.html` para iniciar seu aplicativo Webassembly Blazor.</span><span class="sxs-lookup"><span data-stu-id="ddc93-208">In these cases, you don't want to return content cached as `/counter`, but instead need the browser to load the content cached as `/index.html` to start up your Blazor WebAssembly application.</span></span> <span data-ttu-id="ddc93-209">Essas solicitações iniciais são conhecidas como solicitações de *navegação* (em oposição às solicitações de *subrecurso* para imagens/CSS/etc, ou solicitações de *busca/XHR* para dados de API).</span><span class="sxs-lookup"><span data-stu-id="ddc93-209">These initial requests are known as *navigation* requests (as opposed to *subresource* requests for images/CSS/etc, or *fetch/XHR* requests for API data).</span></span>

<span data-ttu-id="ddc93-210">O operador de serviço padrão contém uma lógica de caso especial para solicitações de navegação.</span><span class="sxs-lookup"><span data-stu-id="ddc93-210">The default service worker contains special-case logic for navigation requests.</span></span> <span data-ttu-id="ddc93-211">Ele os resolve retornando o conteúdo armazenado em cache para `/index.html`, independentemente da URL solicitada.</span><span class="sxs-lookup"><span data-stu-id="ddc93-211">It resolves them by returning the cached content for `/index.html`, regardless of the requested URL.</span></span> <span data-ttu-id="ddc93-212">Essa lógica é implementada na função `onFetch` dentro de *Service-Worker. published. js*.</span><span class="sxs-lookup"><span data-stu-id="ddc93-212">This logic is implemented in the `onFetch` function inside *service-worker.published.js*.</span></span>

<span data-ttu-id="ddc93-213">Se seu aplicativo tiver determinadas URLs que devem retornar o HTML renderizado pelo servidor (e não atender `/index.html` do cache), você precisará editar a lógica em seu trabalho de serviço.</span><span class="sxs-lookup"><span data-stu-id="ddc93-213">If your application has certain URLs that must return server-rendered HTML (and not serve `/index.html` from the cache), then you need to edit the logic in your service worker.</span></span> <span data-ttu-id="ddc93-214">Por exemplo, se todas as URLs que contêm `/Identity/` precisam ser tratadas como solicitações regulares somente online para o servidor, modifique a lógica de `onFetch` *Service-Worker. published. js* .</span><span class="sxs-lookup"><span data-stu-id="ddc93-214">For example, if all URLs containing `/Identity/` need to be handled as regular online-only requests to the server, then modify *service-worker.published.js* `onFetch` logic.</span></span> <span data-ttu-id="ddc93-215">Localize o código a seguir:</span><span class="sxs-lookup"><span data-stu-id="ddc93-215">Locate the following code:</span></span>

```javascript
const shouldServeIndexHtml = event.request.mode === 'navigate';
```

<span data-ttu-id="ddc93-216">Altere o código para o seguinte:</span><span class="sxs-lookup"><span data-stu-id="ddc93-216">Change the code to the following:</span></span>

```javascript
const shouldServeIndexHtml = event.request.mode === 'navigate'
    && !event.request.url.includes('/Identity/');
```

<span data-ttu-id="ddc93-217">Se você não fizer isso, independentemente da conectividade de rede, o trabalhador do serviço interceptará solicitações para essas URLs e as resolverá usando `/index.html`.</span><span class="sxs-lookup"><span data-stu-id="ddc93-217">If you don't do this, then regardless of network connectivity, the service worker will intercept requests for such URLs and will resolve them using `/index.html`.</span></span>

#### <a name="control-asset-caching"></a><span data-ttu-id="ddc93-218">Controlar o cache de ativos</span><span class="sxs-lookup"><span data-stu-id="ddc93-218">Control asset caching</span></span>

<span data-ttu-id="ddc93-219">Se o projeto definir uma propriedade do MSBuild chamada `ServiceWorkerAssetsManifest`, as ferramentas de compilação de Blazorgerarão um manifesto de ativos de trabalho do serviço com o nome especificado.</span><span class="sxs-lookup"><span data-stu-id="ddc93-219">If your project defines an MSBuild property called `ServiceWorkerAssetsManifest`, then Blazor's build tooling will generate a service worker assets manifest with the specified name.</span></span> <span data-ttu-id="ddc93-220">O modelo do PWA padrão produz um arquivo de projeto que contém o seguinte:</span><span class="sxs-lookup"><span data-stu-id="ddc93-220">The default PWA template produces a project file containing the following:</span></span>

```xml
<ServiceWorkerAssetsManifest>service-worker-assets.js</ServiceWorkerAssetsManifest>
```

<span data-ttu-id="ddc93-221">O arquivo é colocado no diretório de saída *wwwroot* , para que o navegador possa recuperar esse arquivo solicitando `/service-worker-assets.js`.</span><span class="sxs-lookup"><span data-stu-id="ddc93-221">The file is placed in the *wwwroot* output directory, so the browser can retrieve this file by requesting `/service-worker-assets.js`.</span></span> <span data-ttu-id="ddc93-222">Para ver o conteúdo, abra *YourProject\bin\Debug\netstandard2.1\wwwroot\service-Worker-assets.js* em um editor de texto.</span><span class="sxs-lookup"><span data-stu-id="ddc93-222">To see the contents, open *YourProject\bin\Debug\netstandard2.1\wwwroot\service-worker-assets.js* in a text editor.</span></span> <span data-ttu-id="ddc93-223">No entanto, não edite o arquivo, pois ele será gerado novamente em cada compilação.</span><span class="sxs-lookup"><span data-stu-id="ddc93-223">However, don't edit the file, as it will be regenerated on each build.</span></span>

<span data-ttu-id="ddc93-224">Por padrão, este manifesto lista:</span><span class="sxs-lookup"><span data-stu-id="ddc93-224">By default, this manifest lists:</span></span>

* <span data-ttu-id="ddc93-225">Todos os recursos gerenciados pelo Blazor, como assemblies .NET e os arquivos de tempo de execução do .NET Webassembly necessários para funcionar offline</span><span class="sxs-lookup"><span data-stu-id="ddc93-225">Any Blazor-managed resources such as .NET assemblies and the .NET WebAssembly runtime files needed to function offline</span></span>
* <span data-ttu-id="ddc93-226">Todos os recursos que serão publicados no diretório *wwwroot* , como imagens, arquivos CSS e arquivos JavaScript.</span><span class="sxs-lookup"><span data-stu-id="ddc93-226">All resources that will be published in your *wwwroot* directory, such as images, CSS files, and JavaScript files.</span></span> <span data-ttu-id="ddc93-227">Isso inclui ativos da Web estáticos fornecidos por projetos externos e pacotes NuGet.</span><span class="sxs-lookup"><span data-stu-id="ddc93-227">This includes static web assets supplied by external projects and NuGet packages.</span></span>

<span data-ttu-id="ddc93-228">Você pode controlar quais desses recursos serão buscados e armazenados em cache pelo trabalhador do serviço editando a lógica em `onInstall` em *Service-Worker. published. js*.</span><span class="sxs-lookup"><span data-stu-id="ddc93-228">You can control which of these resources will be fetched and cached by the service worker by editing the logic in `onInstall` in *service-worker.published.js*.</span></span> <span data-ttu-id="ddc93-229">Por padrão, ele buscará e armazenará em cache os arquivos que correspondem às extensões de nome de arquivo da Web típicas, como *. html*, *. css*, *. js*, *. WASM*e outros, além de tipos de arquivo específicos para Blazor Webassembly ( *. dll*, *. pdb*).</span><span class="sxs-lookup"><span data-stu-id="ddc93-229">By default, it will fetch and cache files matching typical web filename extensions such as *.html*, *.css*, *.js*, *.wasm*, and others, plus file types specific to Blazor WebAssembly (*.dll*, *.pdb*).</span></span>

<span data-ttu-id="ddc93-230">Se você quiser incluir recursos adicionais que não estão presentes no diretório *wwwroot* , poderá fazer isso definindo entradas extras do grupo de itens do MSBuild.</span><span class="sxs-lookup"><span data-stu-id="ddc93-230">If you want to include additional resources that aren't present in your *wwwroot* directory, you can do so by defining extra MSBuild itemgroup entries.</span></span> <span data-ttu-id="ddc93-231">Por exemplo, em seu arquivo de projeto, adicione:</span><span class="sxs-lookup"><span data-stu-id="ddc93-231">For example, in your project file, add:</span></span>

```xml
<ItemGroup>
    <ServiceWorkerAssetsManifestItem
        Include="MyDirectory\AnotherFile.json"
        RelativePath="MyDirectory\AnotherFile.json"
        AssetUrl="files/AnotherFile.json" />
</ItemGroup>
```

<span data-ttu-id="ddc93-232">O `AssetUrl` metadados especifica a URL relativa à base que o navegador deve usar ao buscar o recurso para armazenar em cache.</span><span class="sxs-lookup"><span data-stu-id="ddc93-232">The `AssetUrl` metadata specifies the base-relative URL that the browser should use when fetching the resource to cache.</span></span> <span data-ttu-id="ddc93-233">Isso pode ser independente de seu nome de arquivo de origem original no disco.</span><span class="sxs-lookup"><span data-stu-id="ddc93-233">This can be independent of its original source file name on disk.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="ddc93-234">Adicionar um `ServiceWorkerAssetsManifestItem` não faz com que o arquivo seja publicado no diretório *wwwroot* .</span><span class="sxs-lookup"><span data-stu-id="ddc93-234">Adding a `ServiceWorkerAssetsManifestItem` does not cause the file to be published in your *wwwroot* directory.</span></span> <span data-ttu-id="ddc93-235">Até você controlar sua saída de publicação separadamente.</span><span class="sxs-lookup"><span data-stu-id="ddc93-235">It up to you to control your publish output separately.</span></span> <span data-ttu-id="ddc93-236">A `ServiceWorkerAssetsManifestItem` apenas faz com que uma entrada adicional apareça no manifesto de ativos de trabalho do serviço.</span><span class="sxs-lookup"><span data-stu-id="ddc93-236">The `ServiceWorkerAssetsManifestItem` only causes an additional entry to appear in the service worker assets manifest.</span></span>

## <a name="push-notifications"></a><span data-ttu-id="ddc93-237">Notificações por push</span><span class="sxs-lookup"><span data-stu-id="ddc93-237">Push notifications</span></span>

<span data-ttu-id="ddc93-238">Como qualquer outro PWA, um Blazor Webassembly PWA pode receber notificações por push de um servidor de back-end.</span><span class="sxs-lookup"><span data-stu-id="ddc93-238">Like any other PWA, a Blazor WebAssembly PWA can receive push notifications from a backend server.</span></span> <span data-ttu-id="ddc93-239">O servidor pode enviá-los a qualquer momento, mesmo quando o usuário não estiver usando seu aplicativo ativamente (por exemplo, quando um usuário diferente executa uma ação que pode ser relevante).</span><span class="sxs-lookup"><span data-stu-id="ddc93-239">Your server can send these at any time, even when the user is not actively using your application (for example, when a different user performs an action that may be relevant).</span></span>

<span data-ttu-id="ddc93-240">O mecanismo para enviar uma notificação por push é totalmente independente do Blazor Webassembly, pois ele é implementado pelo servidor de back-end que pode usar qualquer tecnologia.</span><span class="sxs-lookup"><span data-stu-id="ddc93-240">The mechanism for sending a push notification is entirely independent of Blazor WebAssembly, since it's implemented by the backend server which can use any technology.</span></span> <span data-ttu-id="ddc93-241">Se você quiser enviar notificações por push de um servidor de ASP.NET Core, considere [usar uma técnica semelhante àquela no workshop de pizza incrivelmente](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#sending-push-notifications).</span><span class="sxs-lookup"><span data-stu-id="ddc93-241">If you want to send push notifications from an ASP.NET Core server, consider [using a technique similar to that in the Blazing Pizza workshop](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#sending-push-notifications).</span></span>

<span data-ttu-id="ddc93-242">O mecanismo para receber e exibir uma notificação por push no cliente também é independente do Webassembly Blazor, já que ele é implementado no trabalhador do serviço, que é um arquivo JavaScript.</span><span class="sxs-lookup"><span data-stu-id="ddc93-242">The mechanism for receiving and displaying a push notification on the client is also independent of Blazor WebAssembly, since it's implemented in the service worker, which is a JavaScript file.</span></span> <span data-ttu-id="ddc93-243">Como exemplo, você pode ver novamente [a abordagem usada no workshop de pizza incrivelmente](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#displaying-notifications).</span><span class="sxs-lookup"><span data-stu-id="ddc93-243">As an example, you can again see [the approach used in the Blazing Pizza workshop](https://github.com/dotnet-presentations/blazor-workshop/blob/master/docs/09-progressive-web-app.md#displaying-notifications).</span></span>

## <a name="caveats-for-offline-pwas"></a><span data-ttu-id="ddc93-244">Advertências para PWAs offline</span><span class="sxs-lookup"><span data-stu-id="ddc93-244">Caveats for offline PWAs</span></span>

<span data-ttu-id="ddc93-245">Nem todos os aplicativos devem tentar dar suporte ao uso offline.</span><span class="sxs-lookup"><span data-stu-id="ddc93-245">Not all applications should attempt to support offline use.</span></span> <span data-ttu-id="ddc93-246">Ele adiciona uma complexidade significativa, embora nem sempre seja relevante.</span><span class="sxs-lookup"><span data-stu-id="ddc93-246">It adds significant complexity, while not always being relevant.</span></span>

<span data-ttu-id="ddc93-247">O suporte offline geralmente é relevante apenas:</span><span class="sxs-lookup"><span data-stu-id="ddc93-247">Offline support is usually relevant only:</span></span>

* <span data-ttu-id="ddc93-248">Se o armazenamento de dados primário for local para o navegador.</span><span class="sxs-lookup"><span data-stu-id="ddc93-248">If your primary data store is local to the browser.</span></span> <span data-ttu-id="ddc93-249">Por exemplo, ao criar uma interface do usuário para um dispositivo [IOT](https://en.wikipedia.org/wiki/Internet_of_things) que armazena dados em `localStorage` ou [IndexedDB](https://developer.mozilla.org/docs/Web/API/IndexedDB_API).</span><span class="sxs-lookup"><span data-stu-id="ddc93-249">For example, when building a UI for an [IoT](https://en.wikipedia.org/wiki/Internet_of_things) device that stores data in `localStorage` or [IndexedDB](https://developer.mozilla.org/docs/Web/API/IndexedDB_API).</span></span>

* <span data-ttu-id="ddc93-250">Se você fizer um trabalho significativo para buscar e armazenar em cache os dados de API de back-end relevantes para cada usuário, eles poderão navegar por ele offline.</span><span class="sxs-lookup"><span data-stu-id="ddc93-250">If you do significant work to fetch and cache the backend API data relevant to each user, so they can navigate through it offline.</span></span> <span data-ttu-id="ddc93-251">Se você der suporte à edição, também precisará criar um sistema para controlar as alterações e sincronizá-las com o back-end.</span><span class="sxs-lookup"><span data-stu-id="ddc93-251">If you support editing, you will also need to build a system for tracking changes and synchronizing them with the backend.</span></span>

* <span data-ttu-id="ddc93-252">Se seu objetivo é garantir que o aplicativo seja carregado imediatamente, independentemente das condições de rede.</span><span class="sxs-lookup"><span data-stu-id="ddc93-252">If your goal is to guarantee the application loads immediately regardless of network conditions.</span></span> <span data-ttu-id="ddc93-253">Em seguida, você precisará implementar uma experiência de usuário adequada em relação às solicitações da API de back-end para mostrar o progresso das solicitações e se comportar normalmente quando elas falharem devido à indisponibilidade da rede.</span><span class="sxs-lookup"><span data-stu-id="ddc93-253">You will then need to implement a suitable user experience around backend API requests to show the progress of requests and behave gracefully when they fail due to network unavailability.</span></span>

<span data-ttu-id="ddc93-254">Além disso, o PWAs com capacidade offline precisa lidar com uma variedade de complicações extras.</span><span class="sxs-lookup"><span data-stu-id="ddc93-254">Additionally, offline-capable PWAs need to deal with a range of extra complications.</span></span> <span data-ttu-id="ddc93-255">Os desenvolvedores devem se familiarizar com cuidado com as seguintes advertências.</span><span class="sxs-lookup"><span data-stu-id="ddc93-255">Developers should carefully familiarize themselves with the following caveats.</span></span>

### <a name="offline-support-only-when-published"></a><span data-ttu-id="ddc93-256">Suporte offline somente quando publicado</span><span class="sxs-lookup"><span data-stu-id="ddc93-256">Offline support only when published</span></span>

<span data-ttu-id="ddc93-257">o modelo do PWA do Blazorhabilita o suporte offline somente quando publicado.</span><span class="sxs-lookup"><span data-stu-id="ddc93-257">Blazor's PWA template enables offline support only when published.</span></span> <span data-ttu-id="ddc93-258">Isso ocorre porque, durante o desenvolvimento, você normalmente deseja ver cada alteração refletida imediatamente no navegador, sem passar por um processo de atualização em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="ddc93-258">This is because, during development, you typically want to see each change reflected immediately in the browser, without going through a background update process.</span></span>

<span data-ttu-id="ddc93-259">Portanto, ao criar um aplicativo com capacidade offline, não é suficiente testar seu aplicativo no modo de desenvolvimento.</span><span class="sxs-lookup"><span data-stu-id="ddc93-259">Therefore when building an offline-capable application, it's not enough to test your application in development mode.</span></span> <span data-ttu-id="ddc93-260">Você deve testar seu aplicativo em seu estado publicado para entender como ele responderá a diferentes condições de rede.</span><span class="sxs-lookup"><span data-stu-id="ddc93-260">You must test your application in its published state to understand how it will respond to differing network conditions.</span></span>

### <a name="update-completion-after-user-navigation-away-from-app"></a><span data-ttu-id="ddc93-261">Atualizar a conclusão após a navegação do usuário para fora do aplicativo</span><span class="sxs-lookup"><span data-stu-id="ddc93-261">Update completion after user navigation away from app</span></span>

<span data-ttu-id="ddc93-262">As atualizações não são concluídas até que o usuário saia do seu aplicativo em todas as guias.</span><span class="sxs-lookup"><span data-stu-id="ddc93-262">Updates don't complete until the user has navigated away from your application in all tabs.</span></span> <span data-ttu-id="ddc93-263">Conforme explicado em [atualizações em segundo plano](#background-updates), depois de implantar uma atualização em seu aplicativo, o navegador buscará os arquivos de trabalho do serviço atualizados e iniciará um processo de atualização.</span><span class="sxs-lookup"><span data-stu-id="ddc93-263">As explained in [Background updates](#background-updates), after you deploy an update to your application, the browser will fetch the updated service worker files and begin an update process.</span></span>

<span data-ttu-id="ddc93-264">O que surpreende muitos desenvolvedores é que, mesmo quando essa atualização é concluída, ela **não** tem efeito até que o usuário tenha navegado para fora em todas as guias.</span><span class="sxs-lookup"><span data-stu-id="ddc93-264">What surprises many developers is that, even when this update completes, it does **not** take effect until the user has navigated away in all tabs.</span></span> <span data-ttu-id="ddc93-265">**Não** é suficiente atualizar a guia que exibe seu aplicativo, mesmo se for a única guia que exibe seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ddc93-265">It is **not** sufficient to refresh the tab displaying your application, even if it's the only tab displaying your application.</span></span> <span data-ttu-id="ddc93-266">Até que seu aplicativo seja completamente fechado, o novo trabalhador de serviço permanecerá em um status de "aguardando ativação".</span><span class="sxs-lookup"><span data-stu-id="ddc93-266">Until your application is completely closed, the new service worker will remain in a "waiting to activate" status.</span></span> <span data-ttu-id="ddc93-267">**Isso não é específico para Blazor, mas sim um comportamento de plataforma da Web padrão.**</span><span class="sxs-lookup"><span data-stu-id="ddc93-267">**This is not specific to Blazor, but rather is a standard web platform behavior.**</span></span>

<span data-ttu-id="ddc93-268">Isso normalmente problemas os desenvolvedores que estão tentando testar atualizações para seu trabalho de serviço ou recursos armazenados em cache offline.</span><span class="sxs-lookup"><span data-stu-id="ddc93-268">This commonly troubles developers who are trying to test updates to their service worker or offline cached resources.</span></span> <span data-ttu-id="ddc93-269">Se você fizer check-in das ferramentas de desenvolvimento do navegador, poderá ver algo semelhante ao seguinte:</span><span class="sxs-lookup"><span data-stu-id="ddc93-269">If you check in the browser's dev tools, you may see something like the following:</span></span>

![image](https://user-images.githubusercontent.com/1101362/76226394-b93f7380-6215-11ea-8572-7d52afee2dd8.png)

<span data-ttu-id="ddc93-271">Desde que a lista de "clientes" (ou seja, tabulações ou janelas exibindo seu aplicativo) não esteja vazia, o trabalho continuará aguardando.</span><span class="sxs-lookup"><span data-stu-id="ddc93-271">For as long as the list of "clients" (i.e., tabs or windows displaying your application) is nonempty, the worker will continue waiting.</span></span> <span data-ttu-id="ddc93-272">O motivo pelo qual os trabalhadores de serviço fazem isso é garantir a consistência, ou seja, que todos os recursos sejam buscados do mesmo cache atômico.</span><span class="sxs-lookup"><span data-stu-id="ddc93-272">The reason service workers do this is to guarantee consistency, i.e., that all resources are fetched from the same atomic cache.</span></span>

<span data-ttu-id="ddc93-273">Ao testar alterações, talvez seja conveniente clicar no link "skipWaiting", conforme mostrado na captura de tela acima, e recarregar a página.</span><span class="sxs-lookup"><span data-stu-id="ddc93-273">When testing changes, you may find it convenient to click the "skipWaiting" link as shown in the screenshot above, then reload the page.</span></span> <span data-ttu-id="ddc93-274">Se desejar, você pode automatizar isso para todos os usuários codificando seu operador de serviço para [ignorar a fase de "espera" e ativá-la imediatamente na atualização](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#skip_the_waiting_phase).</span><span class="sxs-lookup"><span data-stu-id="ddc93-274">If you want, you can automate this for all users by coding your service worker to [skip the "waiting" phase and immediately activate on update](https://developers.google.com/web/fundamentals/primers/service-workers/lifecycle#skip_the_waiting_phase).</span></span> <span data-ttu-id="ddc93-275">No entanto, se você fizer isso, estará fazendo a garantia de que os recursos são sempre buscados consistentemente da mesma instância de cache.</span><span class="sxs-lookup"><span data-stu-id="ddc93-275">However if you do this, you are giving up the guarantee that resources are always fetched consistently from the same cache instance.</span></span>

### <a name="users-may-run-any-historical-version-of-the-app"></a><span data-ttu-id="ddc93-276">Os usuários podem executar qualquer versão histórica do aplicativo</span><span class="sxs-lookup"><span data-stu-id="ddc93-276">Users may run any historical version of the app</span></span>

<span data-ttu-id="ddc93-277">Os desenvolvedores da Web recompensadores esperam que os usuários executem apenas a versão mais recente implantada de seu aplicativo Web, pois isso é normal no modelo de distribuição da Web tradicional.</span><span class="sxs-lookup"><span data-stu-id="ddc93-277">Web developers habitually expect that users will only run the latest deployed version of their web application, since that's normal within the traditional web distribution model.</span></span> <span data-ttu-id="ddc93-278">No entanto, um PWA offline primeiro é mais semelhante a um aplicativo móvel nativo, no qual os usuários não estão necessariamente executando a versão mais recente.</span><span class="sxs-lookup"><span data-stu-id="ddc93-278">However, an offline-first PWA is more akin to a native mobile app, where users are not necessarily running the latest version.</span></span>

<span data-ttu-id="ddc93-279">Conforme explicado em [atualizações em segundo plano](#background-updates), depois de implantar uma atualização em seu aplicativo, **cada usuário existente continuará a usar uma versão anterior para pelo menos uma visita adicional** (porque a atualização ocorre em segundo plano e não é ativada até que o usuário navegue para fora).</span><span class="sxs-lookup"><span data-stu-id="ddc93-279">As explained in [Background updates](#background-updates), after you deploy an update to your application, **each existing user will continue to use a previous version for at least one further visit** (because the update occurs in the background and isn't activated until the user then navigates away).</span></span> <span data-ttu-id="ddc93-280">Além disso, a versão anterior que está sendo usada não é necessariamente a anterior que você implantou-pode ser *qualquer* versão histórica, dependendo de quando o usuário concluiu a última vez uma atualização.</span><span class="sxs-lookup"><span data-stu-id="ddc93-280">Plus, the previous version being used isn't necessarily the previous one you deployed - it can be *any* historical version, depending on when the user last completed an update.</span></span>

<span data-ttu-id="ddc93-281">Isso pode ser um problema se as partes de frontend e back-end do seu aplicativo exigirem contrato sobre o esquema para solicitações de API.</span><span class="sxs-lookup"><span data-stu-id="ddc93-281">This can be an issue if the frontend and backend parts of your application require agreement about the schema for API requests.</span></span> <span data-ttu-id="ddc93-282">Você não deve implantar alterações de esquema de API incompatíveis com versões anteriores até ter certeza de que todos os usuários tenham atualizado ou, pelo menos, impedir que os usuários usem versões mais antigas e incompatíveis do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="ddc93-282">You must not deploy backward-incompatible API schema changes until you can be sure that all users have upgraded, or at least block users from using incompatible older versions of the app.</span></span> <span data-ttu-id="ddc93-283">Isso é exatamente como um aplicativo móvel nativo.</span><span class="sxs-lookup"><span data-stu-id="ddc93-283">This is just like a native mobile app.</span></span> <span data-ttu-id="ddc93-284">Se você implantar uma alteração significativa nas APIs do servidor, o aplicativo cliente será interrompido para pessoas que ainda não foram atualizadas.</span><span class="sxs-lookup"><span data-stu-id="ddc93-284">If you deploy a breaking change in server APIs, the client app will be broken for people who haven't yet updated.</span></span>

<span data-ttu-id="ddc93-285">Se possível, não implante alterações significativas em suas APIs de back-end.</span><span class="sxs-lookup"><span data-stu-id="ddc93-285">If possible, don't deploy breaking changes to your backend APIs.</span></span> <span data-ttu-id="ddc93-286">Mas se você precisar fazer isso, considere o uso de [APIs de trabalho de serviço padrão](https://developer.mozilla.org/docs/Web/API/ServiceWorkerRegistration) , como `ServiceWorkerRegistration`para determinar se o aplicativo está atualizado e, se não, para evitar o uso.</span><span class="sxs-lookup"><span data-stu-id="ddc93-286">But if you must do so, consider using [standard Service Worker APIs such as `ServiceWorkerRegistration`](https://developer.mozilla.org/docs/Web/API/ServiceWorkerRegistration) to determine whether the application is up-to-date, and if not, to prevent usage.</span></span>

### <a name="interference-with-server-rendered-pages"></a><span data-ttu-id="ddc93-287">Interferência com páginas renderizadas pelo servidor</span><span class="sxs-lookup"><span data-stu-id="ddc93-287">Interference with server-rendered pages</span></span>

<span data-ttu-id="ddc93-288">[Conforme descrito acima](#support-server-rendered-pages), se você quiser ignorar o comportamento do trabalhador de serviço de retornar `/index.html` conteúdo para todas as solicitações de navegação, você precisará editar a lógica em seu operador de serviço.</span><span class="sxs-lookup"><span data-stu-id="ddc93-288">[As described above](#support-server-rendered-pages), if you want to bypass the service worker's behavior of returning `/index.html` contents for all navigation requests, you need to edit the logic in your service worker.</span></span>

### <a name="all-service-worker-asset-manifest-contents-are-cached-by-default"></a><span data-ttu-id="ddc93-289">Todos os conteúdos do manifesto de ativos de trabalho de serviço são armazenados em cache por padrão</span><span class="sxs-lookup"><span data-stu-id="ddc93-289">All service worker asset manifest contents are cached by default</span></span>

<span data-ttu-id="ddc93-290">[Conforme descrito acima](#control-asset-caching), o arquivo *Service-Worker-assets. js* é gerado durante a compilação e lista todos os ativos que o trabalho de serviço deve buscar e armazenar em cache.</span><span class="sxs-lookup"><span data-stu-id="ddc93-290">[As described above](#control-asset-caching), the file *service-worker-assets.js* is generated during build and lists all assets the service worker should fetch and cache.</span></span>

<span data-ttu-id="ddc93-291">Como essa lista, por padrão, inclui tudo emitido para *wwwroot* (incluindo o conteúdo fornecido por pacotes e projetos externos), você deve ter cuidado para não colocar muito conteúdo lá.</span><span class="sxs-lookup"><span data-stu-id="ddc93-291">Since this list by default includes everything emitted to *wwwroot* (including content supplied by external packages and projects), you must be careful not to put too much content there.</span></span> <span data-ttu-id="ddc93-292">Se, por exemplo, seu diretório *wwwroot* contiver milhões de imagens, o trabalho de serviço tentará buscar e armazenar em cache todas elas, consumindo largura de banda excessiva e provavelmente não será concluído com êxito.</span><span class="sxs-lookup"><span data-stu-id="ddc93-292">If for example your *wwwroot* directory contains millions of images, the service worker would try to fetch and cache them all, consuming excessive bandwidth and most likely not completing successfully.</span></span>

<span data-ttu-id="ddc93-293">Você pode implementar uma lógica arbitrária para controlar qual subconjunto do conteúdo do manifesto deve ser buscado e armazenado em cache editando a função `onInstall` em *Service-Worker. published. js*.</span><span class="sxs-lookup"><span data-stu-id="ddc93-293">You can implement arbitrary logic to control which subset of the manifest's contents should be fetched and cached by editing the `onInstall` function in *service-worker.published.js*.</span></span>

### <a name="interaction-with-authentication"></a><span data-ttu-id="ddc93-294">Interação com autenticação</span><span class="sxs-lookup"><span data-stu-id="ddc93-294">Interaction with authentication</span></span>

<span data-ttu-id="ddc93-295">É possível usar a opção de modelo do PWA em conjunto com as opções de autenticação.</span><span class="sxs-lookup"><span data-stu-id="ddc93-295">It's possible to use the PWA template option in conjunction with the authentication options.</span></span> <span data-ttu-id="ddc93-296">Um PWA compatível com offline também pode dar suporte à autenticação quando o usuário tem conectividade de rede.</span><span class="sxs-lookup"><span data-stu-id="ddc93-296">An offline-capable PWA can also support authentication when the user has network connectivity.</span></span>

<span data-ttu-id="ddc93-297">No entanto, quando um usuário não tem conectividade de rede, ele não será capaz de autenticar ou obter tokens de acesso.</span><span class="sxs-lookup"><span data-stu-id="ddc93-297">However, when a user does not have network connectivity, they will not be able to authenticate or obtain access tokens.</span></span> <span data-ttu-id="ddc93-298">A tentativa de visitar a página "logon" exibirá, por padrão, uma mensagem dizendo "erro de rede".</span><span class="sxs-lookup"><span data-stu-id="ddc93-298">Attempting to visit the "login" page will by default display a message saying "network error".</span></span>

<span data-ttu-id="ddc93-299">Dessa forma, seu trabalho é criar um fluxo de interface do usuário que permite que ele faça coisas úteis enquanto estiver offline, sem tentar autenticar ou obter tokens de acesso ou, pelo menos, falhar de forma normal nesses casos.</span><span class="sxs-lookup"><span data-stu-id="ddc93-299">As such it's your job to design a UI flow that lets the user do useful things while offline without attempting to authenticate or obtain access tokens, or at least failing in a graceful way in those cases.</span></span> <span data-ttu-id="ddc93-300">Se isso não for possível em seu aplicativo, talvez você não queira habilitar o suporte offline.</span><span class="sxs-lookup"><span data-stu-id="ddc93-300">If this isn't possible in your application, you might not want to enable offline support.</span></span>
