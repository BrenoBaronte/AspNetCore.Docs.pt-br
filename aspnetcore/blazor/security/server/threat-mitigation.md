---
title: Diretrizes de mitigação de ameaças para o ASP.NET Core Blazor Server
author: guardrex
description: Saiba como mitigar ameaças de segurança para Blazor aplicativos de servidor.
monikerRange: '>= aspnetcore-3.1'
ms.author: riande
ms.custom: mvc
ms.date: 05/05/2020
no-loc:
- Blazor
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: blazor/security/server/threat-mitigation
ms.openlocfilehash: a94dcd818c3f4e19ace57fad6390a84e704192bd
ms.sourcegitcommit: 066d66ea150f8aab63f9e0e0668b06c9426296fd
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 06/23/2020
ms.locfileid: "85242960"
---
# <a name="threat-mitigation-guidance-for-aspnet-core-blazor-server"></a><span data-ttu-id="a8869-103">Diretrizes de mitigação de ameaças para o ASP.NET Core Blazor Server</span><span class="sxs-lookup"><span data-stu-id="a8869-103">Threat mitigation guidance for ASP.NET Core Blazor Server</span></span>

<span data-ttu-id="a8869-104">Por [Javier Calvarro Nelson](https://github.com/javiercn)</span><span class="sxs-lookup"><span data-stu-id="a8869-104">By [Javier Calvarro Nelson](https://github.com/javiercn)</span></span>

Blazor<span data-ttu-id="a8869-105">Os aplicativos de servidor adotam um modelo de processamento de dados com *estado* , onde o servidor e o cliente mantêm uma relação de vida longa.</span><span class="sxs-lookup"><span data-stu-id="a8869-105"> Server apps adopt a *stateful* data processing model, where the server and client maintain a long-lived relationship.</span></span> <span data-ttu-id="a8869-106">O estado persistente é mantido por um [circuito](xref:blazor/state-management), que pode abranger conexões que também são potencialmente de longa duração.</span><span class="sxs-lookup"><span data-stu-id="a8869-106">The persistent state is maintained by a [circuit](xref:blazor/state-management), which can span connections that are also potentially long-lived.</span></span>

<span data-ttu-id="a8869-107">Quando um usuário visita um Blazor site do servidor, o servidor cria um circuito na memória do servidor.</span><span class="sxs-lookup"><span data-stu-id="a8869-107">When a user visits a Blazor Server site, the server creates a circuit in the server's memory.</span></span> <span data-ttu-id="a8869-108">O circuito indica ao navegador qual conteúdo renderizar e responde a eventos, como quando o usuário seleciona um botão na interface do usuário.</span><span class="sxs-lookup"><span data-stu-id="a8869-108">The circuit indicates to the browser what content to render and responds to events, such as when the user selects a button in the UI.</span></span> <span data-ttu-id="a8869-109">Para executar essas ações, um circuito invoca funções JavaScript no navegador do usuário e nos métodos do .NET no servidor.</span><span class="sxs-lookup"><span data-stu-id="a8869-109">To perform these actions, a circuit invokes JavaScript functions in the user's browser and .NET methods on the server.</span></span> <span data-ttu-id="a8869-110">Essa interação baseada em JavaScript bidirecional é conhecida como interoperabilidade [JavaScript (JS Interop)](xref:blazor/call-javascript-from-dotnet).</span><span class="sxs-lookup"><span data-stu-id="a8869-110">This two-way JavaScript-based interaction is referred to as [JavaScript interop (JS interop)](xref:blazor/call-javascript-from-dotnet).</span></span>

<span data-ttu-id="a8869-111">Como a interoperabilidade do JS ocorre pela Internet e o cliente usa um navegador remoto, os Blazor aplicativos de servidor compartilham a maioria das questões de segurança do aplicativo Web.</span><span class="sxs-lookup"><span data-stu-id="a8869-111">Because JS interop occurs over the Internet and the client uses a remote browser, Blazor Server apps share most web app security concerns.</span></span> <span data-ttu-id="a8869-112">Este tópico descreve ameaças comuns a Blazor aplicativos de servidor e fornece diretrizes de mitigação de ameaças voltadas para aplicativos voltados para a Internet.</span><span class="sxs-lookup"><span data-stu-id="a8869-112">This topic describes common threats to Blazor Server apps and provides threat mitigation guidance focused on Internet-facing apps.</span></span>

<span data-ttu-id="a8869-113">Em ambientes restritos, como dentro de redes corporativas ou intranets, algumas das diretrizes de mitigação:</span><span class="sxs-lookup"><span data-stu-id="a8869-113">In constrained environments, such as inside corporate networks or intranets, some of the mitigation guidance either:</span></span>

* <span data-ttu-id="a8869-114">Não se aplica ao ambiente restrito.</span><span class="sxs-lookup"><span data-stu-id="a8869-114">Doesn't apply in the constrained environment.</span></span>
* <span data-ttu-id="a8869-115">Não vale o custo para implementar porque o risco de segurança está baixo em um ambiente restrito.</span><span class="sxs-lookup"><span data-stu-id="a8869-115">Isn't worth the cost to implement because the security risk is low in a constrained environment.</span></span>

## <a name="blazor-and-shared-state"></a>Blazor<span data-ttu-id="a8869-116">e estado compartilhado</span><span class="sxs-lookup"><span data-stu-id="a8869-116"> and shared state</span></span>

[!INCLUDE[](~/includes/blazor-security/blazor-shared-state.md)]

## <a name="resource-exhaustion"></a><span data-ttu-id="a8869-117">Esgotamento de recursos</span><span class="sxs-lookup"><span data-stu-id="a8869-117">Resource exhaustion</span></span>

<span data-ttu-id="a8869-118">O esgotamento de recursos pode ocorrer quando um cliente interage com o servidor e faz com que o servidor consuma recursos excessivos.</span><span class="sxs-lookup"><span data-stu-id="a8869-118">Resource exhaustion can occur when a client interacts with the server and causes the server to consume excessive resources.</span></span> <span data-ttu-id="a8869-119">O consumo excessivo de recursos afeta principalmente:</span><span class="sxs-lookup"><span data-stu-id="a8869-119">Excessive resource consumption primarily affects:</span></span>

* [<span data-ttu-id="a8869-120">CPU</span><span class="sxs-lookup"><span data-stu-id="a8869-120">CPU</span></span>](#cpu)
* [<span data-ttu-id="a8869-121">Memória</span><span class="sxs-lookup"><span data-stu-id="a8869-121">Memory</span></span>](#memory)
* [<span data-ttu-id="a8869-122">Conexões de cliente</span><span class="sxs-lookup"><span data-stu-id="a8869-122">Client connections</span></span>](#client-connections)

<span data-ttu-id="a8869-123">Ataques de DoS (negação de serviço) geralmente buscam esgotar os recursos de um aplicativo ou servidor.</span><span class="sxs-lookup"><span data-stu-id="a8869-123">Denial of service (DoS) attacks usually seek to exhaust an app or server's resources.</span></span> <span data-ttu-id="a8869-124">No entanto, o esgotamento de recursos não é necessariamente o resultado de um ataque no sistema.</span><span class="sxs-lookup"><span data-stu-id="a8869-124">However, resource exhaustion isn't necessarily the result of an attack on the system.</span></span> <span data-ttu-id="a8869-125">Por exemplo, recursos finitos podem ser esgotados devido à alta demanda do usuário.</span><span class="sxs-lookup"><span data-stu-id="a8869-125">For example, finite resources can be exhausted due to high user demand.</span></span> <span data-ttu-id="a8869-126">O DoS é abordado mais detalhadamente na seção [ataques dos (negação de serviço)](#denial-of-service-dos-attacks) .</span><span class="sxs-lookup"><span data-stu-id="a8869-126">DoS is covered further in the [Denial of service (DoS) attacks](#denial-of-service-dos-attacks) section.</span></span>

<span data-ttu-id="a8869-127">Recursos externos à Blazor estrutura, como bancos de dados e identificadores de arquivo (usados para ler e gravar arquivos), também podem ter esgotamento de recursos.</span><span class="sxs-lookup"><span data-stu-id="a8869-127">Resources external to the Blazor framework, such as databases and file handles (used to read and write files), may also experience resource exhaustion.</span></span> <span data-ttu-id="a8869-128">Para obter mais informações, consulte <xref:performance/performance-best-practices>.</span><span class="sxs-lookup"><span data-stu-id="a8869-128">For more information, see <xref:performance/performance-best-practices>.</span></span>

### <a name="cpu"></a><span data-ttu-id="a8869-129">CPU</span><span class="sxs-lookup"><span data-stu-id="a8869-129">CPU</span></span>

<span data-ttu-id="a8869-130">O esgotamento de CPU pode ocorrer quando um ou mais clientes forçam o servidor a executar um trabalho intensivo de CPU.</span><span class="sxs-lookup"><span data-stu-id="a8869-130">CPU exhaustion can occur when one or more clients force the server to perform intensive CPU work.</span></span>

<span data-ttu-id="a8869-131">Por exemplo, considere um Blazor aplicativo de servidor que calcula um *número Fibonnacci*.</span><span class="sxs-lookup"><span data-stu-id="a8869-131">For example, consider a Blazor Server app that calculates a *Fibonnacci number*.</span></span> <span data-ttu-id="a8869-132">Um número Fibonnacci é produzido de uma sequência Fibonnacci, em que cada número na sequência é a soma dos dois números anteriores.</span><span class="sxs-lookup"><span data-stu-id="a8869-132">A Fibonnacci number is produced from a Fibonnacci sequence, where each number in the sequence is the sum of the two preceding numbers.</span></span> <span data-ttu-id="a8869-133">A quantidade de trabalho necessária para alcançar a resposta depende do comprimento da sequência e do tamanho do valor inicial.</span><span class="sxs-lookup"><span data-stu-id="a8869-133">The amount of work required to reach the answer depends on the length of the sequence and the size of the initial value.</span></span> <span data-ttu-id="a8869-134">Se o aplicativo não coloca limites na solicitação de um cliente, os cálculos com uso intensivo de CPU podem dominar o tempo da CPU e diminuir o desempenho de outras tarefas.</span><span class="sxs-lookup"><span data-stu-id="a8869-134">If the app doesn't place limits on a client's request, the CPU-intensive calculations may dominate the CPU's time and diminish the performance of other tasks.</span></span> <span data-ttu-id="a8869-135">O consumo excessivo de recursos é uma preocupação de segurança que afeta a disponibilidade.</span><span class="sxs-lookup"><span data-stu-id="a8869-135">Excessive resource consumption is a security concern impacting availability.</span></span>

<span data-ttu-id="a8869-136">O esgotamento da CPU é uma preocupação para todos os aplicativos voltados ao público.</span><span class="sxs-lookup"><span data-stu-id="a8869-136">CPU exhaustion is a concern for all public-facing apps.</span></span> <span data-ttu-id="a8869-137">Em aplicativos Web regulares, solicitações e conexões atingiram o tempo limite como uma proteção, mas Blazor os aplicativos de servidor não fornecem as mesmas proteções.</span><span class="sxs-lookup"><span data-stu-id="a8869-137">In regular web apps, requests and connections time out as a safeguard, but Blazor Server apps don't provide the same safeguards.</span></span> Blazor<span data-ttu-id="a8869-138">Aplicativos de servidor devem incluir verificações e limites apropriados antes de executar um trabalho potencialmente intensivo de CPU.</span><span class="sxs-lookup"><span data-stu-id="a8869-138"> Server apps must include appropriate checks and limits before performing potentially CPU-intensive work.</span></span>

### <a name="memory"></a><span data-ttu-id="a8869-139">Memória</span><span class="sxs-lookup"><span data-stu-id="a8869-139">Memory</span></span>

<span data-ttu-id="a8869-140">O esgotamento de memória pode ocorrer quando um ou mais clientes forçam o servidor a consumir uma grande quantidade de memória.</span><span class="sxs-lookup"><span data-stu-id="a8869-140">Memory exhaustion can occur when one or more clients force the server to consume a large amount of memory.</span></span>

<span data-ttu-id="a8869-141">Por exemplo, considere um Blazor aplicativo do lado do servidor com um componente que aceita e exibe uma lista de itens.</span><span class="sxs-lookup"><span data-stu-id="a8869-141">For example, consider a Blazor-server side app with a component that accepts and displays a list of items.</span></span> <span data-ttu-id="a8869-142">Se o Blazor aplicativo não coloca limites no número de itens permitidos ou no número de itens processados de volta para o cliente, o processamento e a renderização com uso intensivo de memória podem dominar a memória do servidor para o ponto em que o desempenho do servidor sofre.</span><span class="sxs-lookup"><span data-stu-id="a8869-142">If the Blazor app doesn't place limits on the number of items allowed or the number of items rendered back to the client, the memory-intensive processing and rendering may dominate the server's memory to the point where performance of the server suffers.</span></span> <span data-ttu-id="a8869-143">O servidor pode falhar ou ficar lento até o ponto em que parece ter falhado.</span><span class="sxs-lookup"><span data-stu-id="a8869-143">The server may crash or slow to the point that it appears to have crashed.</span></span>

<span data-ttu-id="a8869-144">Considere o cenário a seguir para manter e exibir uma lista de itens que pertencem a um possível cenário de esgotamento de memória no servidor:</span><span class="sxs-lookup"><span data-stu-id="a8869-144">Consider the following scenario for maintaining and displaying a list of items that pertain to a potential memory exhaustion scenario on the server:</span></span>

* <span data-ttu-id="a8869-145">Os itens em uma `List<MyItem>` propriedade ou campo usam a memória do servidor.</span><span class="sxs-lookup"><span data-stu-id="a8869-145">The items in a `List<MyItem>` property or field use the server's memory.</span></span> <span data-ttu-id="a8869-146">Se o aplicativo permitir que a lista de itens cresça sem limites, haverá um risco de que o servidor fique com memória insuficiente.</span><span class="sxs-lookup"><span data-stu-id="a8869-146">If the app allows the list of items to grow unbounded, there's a risk of the server running out of memory.</span></span> <span data-ttu-id="a8869-147">A execução de memória insuficiente faz com que a sessão atual seja encerrada (falha) e todas as sessões simultâneas nessa instância do servidor recebam uma exceção de memória insuficiente.</span><span class="sxs-lookup"><span data-stu-id="a8869-147">Running out of memory causes the current session to end (crash) and all of the concurrent sessions in that server instance receive an out-of-memory exception.</span></span> <span data-ttu-id="a8869-148">Para evitar que esse cenário ocorra, o aplicativo deve usar uma estrutura de dados que impõe um limite de item em usuários simultâneos.</span><span class="sxs-lookup"><span data-stu-id="a8869-148">To prevent this scenario from occurring, the app must use a data structure that imposes an item limit on concurrent users.</span></span>
* <span data-ttu-id="a8869-149">Se um esquema de paginação não for usado para renderização, o servidor usará memória adicional para objetos que não estão visíveis na interface do usuário.</span><span class="sxs-lookup"><span data-stu-id="a8869-149">If a paging scheme isn't used for rendering, the server uses additional memory for objects that aren't visible in the UI.</span></span> <span data-ttu-id="a8869-150">Sem um limite para o número de itens, as demandas de memória podem esgotar a memória disponível do servidor.</span><span class="sxs-lookup"><span data-stu-id="a8869-150">Without a limit on the number of items, memory demands may exhaust the available server memory.</span></span> <span data-ttu-id="a8869-151">Para evitar esse cenário, use uma das seguintes abordagens:</span><span class="sxs-lookup"><span data-stu-id="a8869-151">To prevent this scenario, use one of the following approaches:</span></span>
  * <span data-ttu-id="a8869-152">Use listas paginadas ao renderizar.</span><span class="sxs-lookup"><span data-stu-id="a8869-152">Use paginated lists when rendering.</span></span>
  * <span data-ttu-id="a8869-153">Exiba apenas os primeiros 100 a 1.000 itens e exija que o usuário insira critérios de pesquisa para localizar itens além dos itens exibidos.</span><span class="sxs-lookup"><span data-stu-id="a8869-153">Only display the first 100 to 1,000 items and require the user to enter search criteria to find items beyond the items displayed.</span></span>
  * <span data-ttu-id="a8869-154">Para um cenário de renderização mais avançado, implemente listas ou grades que dão suporte à *virtualização*.</span><span class="sxs-lookup"><span data-stu-id="a8869-154">For a more advanced rendering scenario, implement lists or grids that support *virtualization*.</span></span> <span data-ttu-id="a8869-155">Usando a virtualização, as listas só renderizam um subconjunto de itens visíveis no momento para o usuário.</span><span class="sxs-lookup"><span data-stu-id="a8869-155">Using virtualization, lists only render a subset of items currently visible to the user.</span></span> <span data-ttu-id="a8869-156">Quando o usuário interage com a barra de rolagem na interface do usuário, o componente renderiza somente os itens necessários para exibição.</span><span class="sxs-lookup"><span data-stu-id="a8869-156">When the user interacts with the scrollbar in the UI, the component renders only those items required for display.</span></span> <span data-ttu-id="a8869-157">Os itens que atualmente não são necessários para exibição podem ser mantidos no armazenamento secundário, que é a abordagem ideal.</span><span class="sxs-lookup"><span data-stu-id="a8869-157">The items that aren't currently required for display can be held in secondary storage, which is the ideal approach.</span></span> <span data-ttu-id="a8869-158">Itens não exibidos também podem ser mantidos na memória, o que é menos ideal.</span><span class="sxs-lookup"><span data-stu-id="a8869-158">Undisplayed items can also be held in memory, which is less ideal.</span></span>

Blazor<span data-ttu-id="a8869-159">Os aplicativos de servidor oferecem um modelo de programação semelhante a outras estruturas de interface do usuário para aplicativos com estado, como WPF, Windows Forms ou Blazor Webassembly.</span><span class="sxs-lookup"><span data-stu-id="a8869-159"> Server apps offer a similar programming model to other UI frameworks for stateful apps, such as WPF, Windows Forms, or Blazor WebAssembly.</span></span> <span data-ttu-id="a8869-160">A principal diferença é que, em várias das estruturas da interface do usuário, a memória consumida pelo aplicativo pertence ao cliente e afeta apenas esse cliente individual.</span><span class="sxs-lookup"><span data-stu-id="a8869-160">The main difference is that in several of the UI frameworks the memory consumed by the app belongs to the client and only affects that individual client.</span></span> <span data-ttu-id="a8869-161">Por exemplo, um Blazor aplicativo Webassembly é executado inteiramente no cliente e usa apenas recursos de memória do cliente.</span><span class="sxs-lookup"><span data-stu-id="a8869-161">For example, a Blazor WebAssembly app runs entirely on the client and only uses client memory resources.</span></span> <span data-ttu-id="a8869-162">No Blazor cenário do servidor, a memória consumida pelo aplicativo pertence ao servidor e é compartilhada entre clientes na instância do servidor.</span><span class="sxs-lookup"><span data-stu-id="a8869-162">In the Blazor Server scenario, the memory consumed by the app belongs to the server and is shared among clients on the server instance.</span></span>

<span data-ttu-id="a8869-163">As demandas de memória do lado do servidor são uma consideração para todos os Blazor aplicativos de servidor.</span><span class="sxs-lookup"><span data-stu-id="a8869-163">Server-side memory demands are a consideration for all Blazor Server apps.</span></span> <span data-ttu-id="a8869-164">No entanto, a maioria dos aplicativos Web não tem estado e a memória usada durante o processamento de uma solicitação é liberada quando a resposta é retornada.</span><span class="sxs-lookup"><span data-stu-id="a8869-164">However, most web apps are stateless, and the memory used while processing a request is released when the response is returned.</span></span> <span data-ttu-id="a8869-165">Como recomendação geral, não permita que os clientes aloquem uma quantidade não associada de memória como em qualquer outro aplicativo do lado do servidor que persista as conexões do cliente.</span><span class="sxs-lookup"><span data-stu-id="a8869-165">As a general recommendation, don't permit clients to allocate an unbound amount of memory as in any other server-side app that persists client connections.</span></span> <span data-ttu-id="a8869-166">A memória consumida por um Blazor aplicativo de servidor persiste por mais tempo do que uma única solicitação.</span><span class="sxs-lookup"><span data-stu-id="a8869-166">The memory consumed by a Blazor Server app persists for a longer time than a single request.</span></span>

> [!NOTE]
> <span data-ttu-id="a8869-167">Durante o desenvolvimento, um criador de perfil pode ser usado ou um rastreamento capturado para avaliar as demandas de memória dos clientes.</span><span class="sxs-lookup"><span data-stu-id="a8869-167">During development, a profiler can be used or a trace captured to assess memory demands of clients.</span></span> <span data-ttu-id="a8869-168">Um criador de perfil ou rastreamento não capturará a memória alocada para um cliente específico.</span><span class="sxs-lookup"><span data-stu-id="a8869-168">A profiler or trace won't capture the memory allocated to a specific client.</span></span> <span data-ttu-id="a8869-169">Para capturar o uso de memória de um cliente específico durante o desenvolvimento, Capture um despejo e examine a demanda de memória de todos os objetos com raiz no circuito do usuário.</span><span class="sxs-lookup"><span data-stu-id="a8869-169">To capture the memory use of a specific client during development, capture a dump and examine the memory demand of all the objects rooted at a user's circuit.</span></span>

### <a name="client-connections"></a><span data-ttu-id="a8869-170">Conexões de cliente</span><span class="sxs-lookup"><span data-stu-id="a8869-170">Client connections</span></span>

<span data-ttu-id="a8869-171">O esgotamento de conexão pode ocorrer quando um ou mais clientes abrem muitas conexões simultâneas com o servidor, impedindo que outros clientes estabeleçam novas conexões.</span><span class="sxs-lookup"><span data-stu-id="a8869-171">Connection exhaustion can occur when one or more clients open too many concurrent connections to the server, preventing other clients from establishing new connections.</span></span>

Blazor<span data-ttu-id="a8869-172">Os clientes estabelecem uma única conexão por sessão e mantêm a conexão aberta enquanto a janela do navegador está aberta.</span><span class="sxs-lookup"><span data-stu-id="a8869-172"> clients establish a single connection per session and keep the connection open for as long as the browser window is open.</span></span> <span data-ttu-id="a8869-173">As demandas no servidor de manutenção de todas as conexões não são específicas para os Blazor aplicativos.</span><span class="sxs-lookup"><span data-stu-id="a8869-173">The demands on the server of maintaining all of the connections isn't specific to Blazor apps.</span></span> <span data-ttu-id="a8869-174">Considerando a natureza persistente das conexões e a natureza com estado dos Blazor aplicativos de servidor, o esgotamento de conexão é um risco maior à disponibilidade do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="a8869-174">Given the persistent nature of the connections and the stateful nature of Blazor Server apps, connection exhaustion is a greater risk to availability of the app.</span></span>

<span data-ttu-id="a8869-175">Por padrão, não há limite para o número de conexões por usuário para um Blazor aplicativo de servidor.</span><span class="sxs-lookup"><span data-stu-id="a8869-175">By default, there's no limit on the number of connections per user for a Blazor Server app.</span></span> <span data-ttu-id="a8869-176">Se o aplicativo exigir um limite de conexão, execute uma ou mais das seguintes abordagens:</span><span class="sxs-lookup"><span data-stu-id="a8869-176">If the app requires a connection limit, take one or more of the following approaches:</span></span>

* <span data-ttu-id="a8869-177">Exigir autenticação, o que limita naturalmente a capacidade de usuários não autorizados se conectarem ao aplicativo.</span><span class="sxs-lookup"><span data-stu-id="a8869-177">Require authentication, which naturally limits the ability of unauthorized users to connect to the app.</span></span> <span data-ttu-id="a8869-178">Para que esse cenário seja eficaz, os usuários devem ser impedidos de provisionar novos usuários no.</span><span class="sxs-lookup"><span data-stu-id="a8869-178">For this scenario to be effective, users must be prevented from provisioning new users at will.</span></span>
* <span data-ttu-id="a8869-179">Limite o número de conexões por usuário.</span><span class="sxs-lookup"><span data-stu-id="a8869-179">Limit the number of connections per user.</span></span> <span data-ttu-id="a8869-180">A limitação de conexões pode ser realizada por meio das abordagens a seguir.</span><span class="sxs-lookup"><span data-stu-id="a8869-180">Limiting connections can be accomplished via the following approaches.</span></span> <span data-ttu-id="a8869-181">Tome cuidado para permitir que usuários legítimos acessem o aplicativo (por exemplo, quando um limite de conexão é estabelecido com base no endereço IP do cliente).</span><span class="sxs-lookup"><span data-stu-id="a8869-181">Exercise care to allow legitimate users to access the app (for example, when a connection limit is established based on the client's IP address).</span></span>
  * <span data-ttu-id="a8869-182">No nível do aplicativo:</span><span class="sxs-lookup"><span data-stu-id="a8869-182">At the app level:</span></span>
    * <span data-ttu-id="a8869-183">Extensibilidade de roteamento de ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="a8869-183">Endpoint routing extensibility.</span></span>
    * <span data-ttu-id="a8869-184">Exigir autenticação para se conectar ao aplicativo e controlar as sessões ativas por usuário.</span><span class="sxs-lookup"><span data-stu-id="a8869-184">Require authentication to connect to the app and keep track of the active sessions per user.</span></span>
    * <span data-ttu-id="a8869-185">Rejeite novas sessões após atingir um limite.</span><span class="sxs-lookup"><span data-stu-id="a8869-185">Reject new sessions upon reaching a limit.</span></span>
    * <span data-ttu-id="a8869-186">Conexões de WebSocket de proxy para um aplicativo por meio do uso de um proxy, como o [ SignalR serviço do Azure](/azure/azure-signalr/signalr-overview) que multiplexa conexões de clientes para um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="a8869-186">Proxy WebSocket connections to an app through the use of a proxy, such as the [Azure SignalR Service](/azure/azure-signalr/signalr-overview) that multiplexes connections from clients to an app.</span></span> <span data-ttu-id="a8869-187">Isso fornece um aplicativo com maior capacidade de conexão do que um único cliente pode estabelecer, impedindo que um cliente esgotasse as conexões com o servidor.</span><span class="sxs-lookup"><span data-stu-id="a8869-187">This provides an app with greater connection capacity than a single client can establish, preventing a client from exhausting the connections to the server.</span></span>
  * <span data-ttu-id="a8869-188">No nível do servidor: Use um proxy/gateway na frente do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="a8869-188">At the server level: Use a proxy/gateway in front of the app.</span></span> <span data-ttu-id="a8869-189">Por exemplo, a [porta frontal do Azure](/azure/frontdoor/front-door-overview) permite que você defina, gerencie e monitore o roteamento global do tráfego da Web para um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="a8869-189">For example, [Azure Front Door](/azure/frontdoor/front-door-overview) enables you to define, manage, and monitor the global routing of web traffic to an app.</span></span>

## <a name="denial-of-service-dos-attacks"></a><span data-ttu-id="a8869-190">Ataques de negação de serviço (DoS)</span><span class="sxs-lookup"><span data-stu-id="a8869-190">Denial of service (DoS) attacks</span></span>

<span data-ttu-id="a8869-191">Ataques de DoS (negação de serviço) envolvem um cliente que está fazendo com que o servidor esgotasse um ou mais de seus recursos, tornando o aplicativo indisponível.</span><span class="sxs-lookup"><span data-stu-id="a8869-191">Denial of service (DoS) attacks involve a client causing the server to exhaust one or more of its resources making the app unavailable.</span></span> Blazor<span data-ttu-id="a8869-192">Os aplicativos de servidor incluem alguns limites padrão e contam com outros ASP.NET Core e SignalR limites para proteger contra ataques de dos que estão definidos no <xref:Microsoft.AspNetCore.Components.Server.CircuitOptions> .</span><span class="sxs-lookup"><span data-stu-id="a8869-192"> Server apps include some default limits and rely on other ASP.NET Core and SignalR limits to protect against DoS attacks that are set on <xref:Microsoft.AspNetCore.Components.Server.CircuitOptions>.</span></span>

| Blazor<span data-ttu-id="a8869-193">Limite de aplicativo do servidor</span><span class="sxs-lookup"><span data-stu-id="a8869-193"> Server app limit</span></span> | <span data-ttu-id="a8869-194">Descrição</span><span class="sxs-lookup"><span data-stu-id="a8869-194">Description</span></span> | <span data-ttu-id="a8869-195">Padrão</span><span class="sxs-lookup"><span data-stu-id="a8869-195">Default</span></span> |
| --- | --- | --- |
| <xref:Microsoft.AspNetCore.Components.Server.CircuitOptions.DisconnectedCircuitMaxRetained> | <span data-ttu-id="a8869-196">Número máximo de circuitos desconectados que um determinado servidor mantém na memória por vez.</span><span class="sxs-lookup"><span data-stu-id="a8869-196">Maximum number of disconnected circuits that a given server holds in memory at a time.</span></span> | <span data-ttu-id="a8869-197">100</span><span class="sxs-lookup"><span data-stu-id="a8869-197">100</span></span> |
| <xref:Microsoft.AspNetCore.Components.Server.CircuitOptions.DisconnectedCircuitRetentionPeriod> | <span data-ttu-id="a8869-198">Quantidade máxima de tempo que um circuito desconectado é mantido na memória antes de ser interrompido.</span><span class="sxs-lookup"><span data-stu-id="a8869-198">Maximum amount of time a disconnected circuit is held in memory before being torn down.</span></span> | <span data-ttu-id="a8869-199">3 minutos</span><span class="sxs-lookup"><span data-stu-id="a8869-199">3 minutes</span></span> |
| <xref:Microsoft.AspNetCore.Components.Server.CircuitOptions.JSInteropDefaultCallTimeout> | <span data-ttu-id="a8869-200">Quantidade máxima de tempo que o servidor espera antes de atingir o tempo limite de uma invocação de função JavaScript assíncrona.</span><span class="sxs-lookup"><span data-stu-id="a8869-200">Maximum amount of time the server waits before timing out an asynchronous JavaScript function invocation.</span></span> | <span data-ttu-id="a8869-201">1 minuto</span><span class="sxs-lookup"><span data-stu-id="a8869-201">1 minute</span></span> |
| <xref:Microsoft.AspNetCore.Components.Server.CircuitOptions.MaxBufferedUnacknowledgedRenderBatches> | <span data-ttu-id="a8869-202">Número máximo de lotes de renderização não confirmados que o servidor mantém na memória por circuito em um determinado momento para dar suporte à reconexão robusta.</span><span class="sxs-lookup"><span data-stu-id="a8869-202">Maximum number of unacknowledged render batches the server keeps in memory per circuit at a given time to support robust reconnection.</span></span> <span data-ttu-id="a8869-203">Depois de atingir o limite, o servidor para de produzir novos lotes de renderização até que um ou mais lotes tenham sido confirmados pelo cliente.</span><span class="sxs-lookup"><span data-stu-id="a8869-203">After reaching the limit, the server stops producing new render batches until one or more batches have been acknowledged by the client.</span></span> | <span data-ttu-id="a8869-204">10</span><span class="sxs-lookup"><span data-stu-id="a8869-204">10</span></span> |

<span data-ttu-id="a8869-205">Defina o tamanho máximo da mensagem de uma única mensagem de Hub de entrada com <xref:Microsoft.AspNetCore.SignalR.HubConnectionContextOptions> .</span><span class="sxs-lookup"><span data-stu-id="a8869-205">Set the maximum message size of a single incoming hub message with <xref:Microsoft.AspNetCore.SignalR.HubConnectionContextOptions>.</span></span>

| SignalR<span data-ttu-id="a8869-206">e ASP.NET Core limite</span><span class="sxs-lookup"><span data-stu-id="a8869-206"> and ASP.NET Core limit</span></span> | <span data-ttu-id="a8869-207">Descrição</span><span class="sxs-lookup"><span data-stu-id="a8869-207">Description</span></span> | <span data-ttu-id="a8869-208">Padrão</span><span class="sxs-lookup"><span data-stu-id="a8869-208">Default</span></span> |
| --- | --- | --- |
| <xref:Microsoft.AspNetCore.SignalR.HubConnectionContextOptions.MaximumReceiveMessageSize?displayProperty=nameWithType> | <span data-ttu-id="a8869-209">Tamanho da mensagem para uma mensagem individual.</span><span class="sxs-lookup"><span data-stu-id="a8869-209">Message size for an individual message.</span></span> | <span data-ttu-id="a8869-210">32 KB</span><span class="sxs-lookup"><span data-stu-id="a8869-210">32 KB</span></span> |

## <a name="interactions-with-the-browser-client"></a><span data-ttu-id="a8869-211">Interações com o navegador (cliente)</span><span class="sxs-lookup"><span data-stu-id="a8869-211">Interactions with the browser (client)</span></span>

<span data-ttu-id="a8869-212">Um cliente interage com o servidor por meio de expedição de evento de interoperabilidade do JS e conclusão do processamento.</span><span class="sxs-lookup"><span data-stu-id="a8869-212">A client interacts with the server through JS interop event dispatching and render completion.</span></span> <span data-ttu-id="a8869-213">A comunicação de interoperabilidade do JS é de ambas as maneiras entre JavaScript e .NET:</span><span class="sxs-lookup"><span data-stu-id="a8869-213">JS interop communication goes both ways between JavaScript and .NET:</span></span>

* <span data-ttu-id="a8869-214">Os eventos de navegador são expedidos do cliente para o servidor de maneira assíncrona.</span><span class="sxs-lookup"><span data-stu-id="a8869-214">Browser events are dispatched from the client to the server in an asynchronous fashion.</span></span>
* <span data-ttu-id="a8869-215">O servidor responde de forma assíncrona reprocessando a interface do usuário conforme necessário.</span><span class="sxs-lookup"><span data-stu-id="a8869-215">The server responds asynchronously rerendering the UI as necessary.</span></span>

### <a name="javascript-functions-invoked-from-net"></a><span data-ttu-id="a8869-216">Funções JavaScript invocadas do .NET</span><span class="sxs-lookup"><span data-stu-id="a8869-216">JavaScript functions invoked from .NET</span></span>

<span data-ttu-id="a8869-217">Para chamadas de métodos .NET para JavaScript:</span><span class="sxs-lookup"><span data-stu-id="a8869-217">For calls from .NET methods to JavaScript:</span></span>

* <span data-ttu-id="a8869-218">Todas as invocações têm um tempo limite configurável após o qual falham, retornando um <xref:System.OperationCanceledException> para o chamador.</span><span class="sxs-lookup"><span data-stu-id="a8869-218">All invocations have a configurable timeout after which they fail, returning a <xref:System.OperationCanceledException> to the caller.</span></span>
  * <span data-ttu-id="a8869-219">Há um tempo limite padrão para as chamadas ( <xref:Microsoft.AspNetCore.Components.Server.CircuitOptions.JSInteropDefaultCallTimeout?displayProperty=nameWithType> ) de um minuto.</span><span class="sxs-lookup"><span data-stu-id="a8869-219">There's a default timeout for the calls (<xref:Microsoft.AspNetCore.Components.Server.CircuitOptions.JSInteropDefaultCallTimeout?displayProperty=nameWithType>) of one minute.</span></span> <span data-ttu-id="a8869-220">Para configurar esse limite, consulte <xref:blazor/call-javascript-from-dotnet#harden-js-interop-calls> .</span><span class="sxs-lookup"><span data-stu-id="a8869-220">To configure this limit, see <xref:blazor/call-javascript-from-dotnet#harden-js-interop-calls>.</span></span>
  * <span data-ttu-id="a8869-221">Um token de cancelamento pode ser fornecido para controlar o cancelamento em uma base por chamada.</span><span class="sxs-lookup"><span data-stu-id="a8869-221">A cancellation token can be provided to control the cancellation on a per-call basis.</span></span> <span data-ttu-id="a8869-222">Conte com o tempo limite de chamada padrão quando possível e Associação de tempo qualquer chamada ao cliente se um token de cancelamento for fornecido.</span><span class="sxs-lookup"><span data-stu-id="a8869-222">Rely on the default call timeout where possible and time-bound any call to the client if a cancellation token is provided.</span></span>
* <span data-ttu-id="a8869-223">O resultado de uma chamada JavaScript não pode ser confiável.</span><span class="sxs-lookup"><span data-stu-id="a8869-223">The result of a JavaScript call can't be trusted.</span></span> <span data-ttu-id="a8869-224">O Blazor cliente de aplicativo em execução no navegador pesquisa a função JavaScript a ser invocada.</span><span class="sxs-lookup"><span data-stu-id="a8869-224">The Blazor app client running in the browser searches for the JavaScript function to invoke.</span></span> <span data-ttu-id="a8869-225">A função é invocada e o resultado ou um erro é produzido.</span><span class="sxs-lookup"><span data-stu-id="a8869-225">The function is invoked, and either the result or an error is produced.</span></span> <span data-ttu-id="a8869-226">Um cliente mal-intencionado pode tentar:</span><span class="sxs-lookup"><span data-stu-id="a8869-226">A malicious client can attempt to:</span></span>
  * <span data-ttu-id="a8869-227">Causar um problema no aplicativo retornando um erro da função JavaScript.</span><span class="sxs-lookup"><span data-stu-id="a8869-227">Cause an issue in the app by returning an error from the JavaScript function.</span></span>
  * <span data-ttu-id="a8869-228">Induzir um comportamento indesejado no servidor retornando um resultado inesperado da função JavaScript.</span><span class="sxs-lookup"><span data-stu-id="a8869-228">Induce an unintended behavior on the server by returning an unexpected result from the JavaScript function.</span></span>

<span data-ttu-id="a8869-229">Tome as seguintes precauções para proteger contra os cenários anteriores:</span><span class="sxs-lookup"><span data-stu-id="a8869-229">Take the following precautions to guard against the preceding scenarios:</span></span>

* <span data-ttu-id="a8869-230">Encapsular chamadas de interoperabilidade JS dentro de [`try-catch`](/dotnet/csharp/language-reference/keywords/try-catch) instruções para considerar erros que podem ocorrer durante as invocações.</span><span class="sxs-lookup"><span data-stu-id="a8869-230">Wrap JS interop calls within [`try-catch`](/dotnet/csharp/language-reference/keywords/try-catch) statements to account for errors that might occur during the invocations.</span></span> <span data-ttu-id="a8869-231">Para obter mais informações, consulte <xref:blazor/fundamentals/handle-errors#javascript-interop>.</span><span class="sxs-lookup"><span data-stu-id="a8869-231">For more information, see <xref:blazor/fundamentals/handle-errors#javascript-interop>.</span></span>
* <span data-ttu-id="a8869-232">Valide os dados retornados das invocações de interoperabilidade do JS, incluindo mensagens de erro, antes de realizar qualquer ação.</span><span class="sxs-lookup"><span data-stu-id="a8869-232">Validate data returned from JS interop invocations, including error messages, before taking any action.</span></span>

### <a name="net-methods-invoked-from-the-browser"></a><span data-ttu-id="a8869-233">Métodos .NET invocados no navegador</span><span class="sxs-lookup"><span data-stu-id="a8869-233">.NET methods invoked from the browser</span></span>

<span data-ttu-id="a8869-234">Não confie em chamadas de JavaScript para métodos .NET.</span><span class="sxs-lookup"><span data-stu-id="a8869-234">Don't trust calls from JavaScript to .NET methods.</span></span> <span data-ttu-id="a8869-235">Quando um método .NET é exposto ao JavaScript, considere como o método .NET é invocado:</span><span class="sxs-lookup"><span data-stu-id="a8869-235">When a .NET method is exposed to JavaScript, consider how the .NET method is invoked:</span></span>

* <span data-ttu-id="a8869-236">Trate qualquer método .NET exposto ao JavaScript como você faria com um ponto de extremidade público para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="a8869-236">Treat any .NET method exposed to JavaScript as you would a public endpoint to the app.</span></span>
  * <span data-ttu-id="a8869-237">Validar entrada.</span><span class="sxs-lookup"><span data-stu-id="a8869-237">Validate input.</span></span>
    * <span data-ttu-id="a8869-238">Verifique se os valores estão dentro dos intervalos esperados.</span><span class="sxs-lookup"><span data-stu-id="a8869-238">Ensure that values are within expected ranges.</span></span>
    * <span data-ttu-id="a8869-239">Verifique se o usuário tem permissão para executar a ação solicitada.</span><span class="sxs-lookup"><span data-stu-id="a8869-239">Ensure that the user has permission to perform the action requested.</span></span>
  * <span data-ttu-id="a8869-240">Não aloque uma quantidade excessiva de recursos como parte da invocação do método .NET.</span><span class="sxs-lookup"><span data-stu-id="a8869-240">Don't allocate an excessive quantity of resources as part of the .NET method invocation.</span></span> <span data-ttu-id="a8869-241">Por exemplo, execute verificações e coloque limites no uso de CPU e memória.</span><span class="sxs-lookup"><span data-stu-id="a8869-241">For example, perform checks and place limits on CPU and memory use.</span></span>
  * <span data-ttu-id="a8869-242">Leve em consideração que os métodos estáticos e de instância podem ser expostos a clientes JavaScript.</span><span class="sxs-lookup"><span data-stu-id="a8869-242">Take into account that static and instance methods can be exposed to JavaScript clients.</span></span> <span data-ttu-id="a8869-243">Evite compartilhar o estado entre as sessões, a menos que o design chame o estado de compartilhamento com as restrições apropriadas.</span><span class="sxs-lookup"><span data-stu-id="a8869-243">Avoid sharing state across sessions unless the design calls for sharing state with appropriate constraints.</span></span>
    * <span data-ttu-id="a8869-244">Para métodos de instância expostos por meio `DotNetReference` de objetos criados originalmente por injeção de dependência (di), os objetos devem ser registrados como objetos com escopo.</span><span class="sxs-lookup"><span data-stu-id="a8869-244">For instance methods exposed through `DotNetReference` objects that are originally created through dependency injection (DI), the objects should be registered as scoped objects.</span></span> <span data-ttu-id="a8869-245">Isso se aplica a qualquer serviço de DI que o Blazor aplicativo do servidor usa.</span><span class="sxs-lookup"><span data-stu-id="a8869-245">This applies to any DI service that the Blazor Server app uses.</span></span>
    * <span data-ttu-id="a8869-246">Para métodos estáticos, evite estabelecer o estado que não pode ser definido como escopo para o cliente, a menos que o aplicativo esteja explicitamente compartilhando o estado por design em todos os usuários em uma instância de servidor.</span><span class="sxs-lookup"><span data-stu-id="a8869-246">For static methods, avoid establishing state that can't be scoped to the client unless the app is explicitly sharing state by-design across all users on a server instance.</span></span>
  * <span data-ttu-id="a8869-247">Evite passar dados fornecidos pelo usuário em parâmetros para chamadas JavaScript.</span><span class="sxs-lookup"><span data-stu-id="a8869-247">Avoid passing user-supplied data in parameters to JavaScript calls.</span></span> <span data-ttu-id="a8869-248">Se a passagem de dados em parâmetros for absolutamente necessária, verifique se o código JavaScript lida com a passagem dos dados sem introduzir vulnerabilidades de [XSS (script entre sites)](#cross-site-scripting-xss) .</span><span class="sxs-lookup"><span data-stu-id="a8869-248">If passing data in parameters is absolutely required, ensure that the JavaScript code handles passing the data without introducing [Cross-site scripting (XSS)](#cross-site-scripting-xss) vulnerabilities.</span></span> <span data-ttu-id="a8869-249">Por exemplo, não grave dados fornecidos pelo usuário no Modelo de Objeto do Documento (DOM) definindo a `innerHTML` propriedade de um elemento.</span><span class="sxs-lookup"><span data-stu-id="a8869-249">For example, don't write user-supplied data to the Document Object Model (DOM) by setting the `innerHTML` property of an element.</span></span> <span data-ttu-id="a8869-250">Considere o uso da [política de segurança de conteúdo (CSP)](https://developer.mozilla.org/docs/Web/HTTP/CSP) para desabilitar `eval` e outros primitivos JavaScript não seguros.</span><span class="sxs-lookup"><span data-stu-id="a8869-250">Consider using [Content Security Policy (CSP)](https://developer.mozilla.org/docs/Web/HTTP/CSP) to disable `eval` and other unsafe JavaScript primitives.</span></span>
* <span data-ttu-id="a8869-251">Evite implementar a expedição personalizada de invocações do .NET sobre a implementação de expedição da estrutura.</span><span class="sxs-lookup"><span data-stu-id="a8869-251">Avoid implementing custom dispatching of .NET invocations on top of the framework's dispatching implementation.</span></span> <span data-ttu-id="a8869-252">Expor métodos .NET ao navegador é um cenário avançado, não recomendado para Blazor desenvolvimento geral.</span><span class="sxs-lookup"><span data-stu-id="a8869-252">Exposing .NET methods to the browser is an advanced scenario, not recommended for general Blazor development.</span></span>

### <a name="events"></a><span data-ttu-id="a8869-253">Eventos</span><span class="sxs-lookup"><span data-stu-id="a8869-253">Events</span></span>

<span data-ttu-id="a8869-254">Os eventos fornecem um ponto de entrada para um Blazor aplicativo de servidor.</span><span class="sxs-lookup"><span data-stu-id="a8869-254">Events provide an entry point to a Blazor Server app.</span></span> <span data-ttu-id="a8869-255">As mesmas regras para proteger pontos de extremidade em aplicativos Web se aplicam à manipulação de eventos em Blazor aplicativos de servidor.</span><span class="sxs-lookup"><span data-stu-id="a8869-255">The same rules for safeguarding endpoints in web apps apply to event handling in Blazor Server apps.</span></span> <span data-ttu-id="a8869-256">Um cliente mal-intencionado pode enviar todos os dados que deseja enviar como a carga de um evento.</span><span class="sxs-lookup"><span data-stu-id="a8869-256">A malicious client can send any data it wishes to send as the payload for an event.</span></span>

<span data-ttu-id="a8869-257">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="a8869-257">For example:</span></span>

* <span data-ttu-id="a8869-258">Um evento de alteração para um `<select>` pode enviar um valor que não está dentro das opções que o aplicativo apresentou ao cliente.</span><span class="sxs-lookup"><span data-stu-id="a8869-258">A change event for a `<select>` could send a value that isn't within the options that the app presented to the client.</span></span>
* <span data-ttu-id="a8869-259">Um `<input>` pode enviar qualquer dado de texto para o servidor, ignorando a validação do lado do cliente.</span><span class="sxs-lookup"><span data-stu-id="a8869-259">An `<input>` could send any text data to the server, bypassing client-side validation.</span></span>

<span data-ttu-id="a8869-260">O aplicativo deve validar os dados para qualquer evento que o aplicativo manipular.</span><span class="sxs-lookup"><span data-stu-id="a8869-260">The app must validate the data for any event that the app handles.</span></span> <span data-ttu-id="a8869-261">Os Blazor [componentes de formulários](xref:blazor/forms-validation) de estrutura executam validações básicas.</span><span class="sxs-lookup"><span data-stu-id="a8869-261">The Blazor framework [forms components](xref:blazor/forms-validation) perform basic validations.</span></span> <span data-ttu-id="a8869-262">Se o aplicativo usar componentes de formulários personalizados, o código personalizado deverá ser escrito para validar os dados de evento conforme apropriado.</span><span class="sxs-lookup"><span data-stu-id="a8869-262">If the app uses custom forms components, custom code must be written to validate event data as appropriate.</span></span>

Blazor<span data-ttu-id="a8869-263">Os eventos de servidor são assíncronos, de modo que vários eventos podem ser expedidos para o servidor antes que o aplicativo tenha tempo de reagir, produzindo um novo processamento.</span><span class="sxs-lookup"><span data-stu-id="a8869-263"> Server events are asynchronous, so multiple events can be dispatched to the server before the app has time to react by producing a new render.</span></span> <span data-ttu-id="a8869-264">Isso tem algumas implicações de segurança a serem consideradas.</span><span class="sxs-lookup"><span data-stu-id="a8869-264">This has some security implications to consider.</span></span> <span data-ttu-id="a8869-265">A limitação de ações do cliente no aplicativo deve ser executada dentro de manipuladores de eventos e não depende do estado atual da exibição renderizada.</span><span class="sxs-lookup"><span data-stu-id="a8869-265">Limiting client actions in the app must be performed inside event handlers and not depend on the current rendered view state.</span></span>

<span data-ttu-id="a8869-266">Considere um componente de contador que deve permitir que um usuário aumente um contador no máximo três vezes.</span><span class="sxs-lookup"><span data-stu-id="a8869-266">Consider a counter component that should allow a user to increment a counter a maximum of three times.</span></span> <span data-ttu-id="a8869-267">O botão para incrementar o contador é condicionalmente baseado no valor de `count` :</span><span class="sxs-lookup"><span data-stu-id="a8869-267">The button to increment the counter is conditionally based on the value of `count`:</span></span>

```razor
<p>Count: @count<p>

@if (count < 3)
{
    <button @onclick="IncrementCount" value="Increment count" />
}

@code 
{
    private int count = 0;

    private void IncrementCount()
    {
        count++;
    }
}
```

<span data-ttu-id="a8869-268">Um cliente pode enviar um ou mais eventos de incremento antes que a estrutura produza um novo processamento desse componente.</span><span class="sxs-lookup"><span data-stu-id="a8869-268">A client can dispatch one or more increment events before the framework produces a new render of this component.</span></span> <span data-ttu-id="a8869-269">O resultado é que o `count` pode ser incrementado *três vezes* pelo usuário, pois o botão não é removido pela interface de usuário com rapidez suficiente.</span><span class="sxs-lookup"><span data-stu-id="a8869-269">The result is that the `count` can be incremented *over three times* by the user because the button isn't removed by the UI quickly enough.</span></span> <span data-ttu-id="a8869-270">A maneira correta de atingir o limite de três `count` incrementos é mostrada no exemplo a seguir:</span><span class="sxs-lookup"><span data-stu-id="a8869-270">The correct way to achieve the limit of three `count` increments is shown in the following example:</span></span>

```razor
<p>Count: @count<p>

@if (count < 3)
{
    <button @onclick="IncrementCount" value="Increment count" />
}

@code 
{
    private int count = 0;

    private void IncrementCount()
    {
        if (count < 3)
        {
            count++;
        }
    }
}
```

<span data-ttu-id="a8869-271">Ao adicionar a `if (count < 3) { ... }` verificação dentro do manipulador, a decisão de incrementar `count` é baseada no estado atual do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="a8869-271">By adding the `if (count < 3) { ... }` check inside the handler, the decision to increment `count` is based on the current app state.</span></span> <span data-ttu-id="a8869-272">A decisão não se baseia no estado da interface do usuário como estava no exemplo anterior, que pode estar temporariamente obsoleta.</span><span class="sxs-lookup"><span data-stu-id="a8869-272">The decision isn't based on the state of the UI as it was in the previous example, which might be temporarily stale.</span></span>

### <a name="guard-against-multiple-dispatches"></a><span data-ttu-id="a8869-273">Proteção contra vários despachos</span><span class="sxs-lookup"><span data-stu-id="a8869-273">Guard against multiple dispatches</span></span>

<span data-ttu-id="a8869-274">Se um retorno de chamada de evento invocar uma operação de execução longa de forma assíncrona, como a busca de dados de um serviço externo ou banco de dado, considere o uso de uma proteção.</span><span class="sxs-lookup"><span data-stu-id="a8869-274">If an event callback invokes a long running operation asynchronously, such as fetching data from an external service or database, consider using a guard.</span></span> <span data-ttu-id="a8869-275">A proteção pode impedir que o usuário enfileirar várias operações enquanto a operação está em andamento com comentários visuais.</span><span class="sxs-lookup"><span data-stu-id="a8869-275">The guard can prevent the user from queueing up multiple operations while the operation is in progress with visual feedback.</span></span> <span data-ttu-id="a8869-276">O código de componente a seguir define `isLoading` `true` enquanto `GetForecastAsync` obtém dados do servidor.</span><span class="sxs-lookup"><span data-stu-id="a8869-276">The following component code sets `isLoading` to `true` while `GetForecastAsync` obtains data from the server.</span></span> <span data-ttu-id="a8869-277">Enquanto `isLoading` estiver `true` , o botão será desabilitado na interface do usuário:</span><span class="sxs-lookup"><span data-stu-id="a8869-277">While `isLoading` is `true`, the button is disabled in the UI:</span></span>

```razor
@page "/fetchdata"
@using BlazorServerSample.Data
@inject WeatherForecastService ForecastService

<button disabled="@isLoading" @onclick="UpdateForecasts">Update</button>

@code {
    private bool isLoading;
    private WeatherForecast[] forecasts;

    private async Task UpdateForecasts()
    {
        if (!isLoading)
        {
            isLoading = true;
            forecasts = await ForecastService.GetForecastAsync(DateTime.Now);
            isLoading = false;
        }
    }
}
```

<span data-ttu-id="a8869-278">O padrão de proteção demonstrado no exemplo anterior funcionará se a operação em segundo plano for executada de forma assíncrona com o `async` - `await` padrão.</span><span class="sxs-lookup"><span data-stu-id="a8869-278">The guard pattern demonstrated in the preceding example works if the background operation is executed asynchronously with the `async`-`await` pattern.</span></span>

### <a name="cancel-early-and-avoid-use-after-dispose"></a><span data-ttu-id="a8869-279">Cancelar antes e evitar usar-After-Dispose</span><span class="sxs-lookup"><span data-stu-id="a8869-279">Cancel early and avoid use-after-dispose</span></span>

<span data-ttu-id="a8869-280">Além de usar uma proteção conforme descrito na seção [proteção contra vários despachos](#guard-against-multiple-dispatches) , considere usar um <xref:System.Threading.CancellationToken> para cancelar operações de longa execução quando o componente for descartado.</span><span class="sxs-lookup"><span data-stu-id="a8869-280">In addition to using a guard as described in the [Guard against multiple dispatches](#guard-against-multiple-dispatches) section, consider using a <xref:System.Threading.CancellationToken> to cancel long-running operations when the component is disposed.</span></span> <span data-ttu-id="a8869-281">Essa abordagem tem o benefício adicional de evitar o *uso-After-Dispose* nos componentes:</span><span class="sxs-lookup"><span data-stu-id="a8869-281">This approach has the added benefit of avoiding *use-after-dispose* in components:</span></span>

```razor
@implements IDisposable

...

@code {
    private readonly CancellationTokenSource TokenSource = 
        new CancellationTokenSource();

    private async Task UpdateForecasts()
    {
        ...

        forecasts = await ForecastService.GetForecastAsync(DateTime.Now, 
            TokenSource.Token);

        if (TokenSource.Token.IsCancellationRequested)
        {
           return;
        }

        ...
    }

    public void Dispose()
    {
        TokenSource.Cancel();
    }
}
```

### <a name="avoid-events-that-produce-large-amounts-of-data"></a><span data-ttu-id="a8869-282">Evitar eventos que produzem grandes quantidades de dados</span><span class="sxs-lookup"><span data-stu-id="a8869-282">Avoid events that produce large amounts of data</span></span>

<span data-ttu-id="a8869-283">Alguns eventos DOM, como `oninput` ou `onscroll` , podem produzir uma grande quantidade de dados.</span><span class="sxs-lookup"><span data-stu-id="a8869-283">Some DOM events, such as `oninput` or `onscroll`, can produce a large amount of data.</span></span> <span data-ttu-id="a8869-284">Evite usar esses eventos em Blazor aplicativos de servidor.</span><span class="sxs-lookup"><span data-stu-id="a8869-284">Avoid using these events in Blazor server apps.</span></span>

## <a name="additional-security-guidance"></a><span data-ttu-id="a8869-285">Diretrizes de segurança adicionais</span><span class="sxs-lookup"><span data-stu-id="a8869-285">Additional security guidance</span></span>

<span data-ttu-id="a8869-286">As diretrizes para proteger aplicativos ASP.NET Core se aplicam a Blazor aplicativos de servidor e são abordadas nas seguintes seções:</span><span class="sxs-lookup"><span data-stu-id="a8869-286">The guidance for securing ASP.NET Core apps apply to Blazor Server apps and are covered in the following sections:</span></span>

* [<span data-ttu-id="a8869-287">Registro em log e dados confidenciais</span><span class="sxs-lookup"><span data-stu-id="a8869-287">Logging and sensitive data</span></span>](#logging-and-sensitive-data)
* [<span data-ttu-id="a8869-288">Proteger informações em trânsito com HTTPS</span><span class="sxs-lookup"><span data-stu-id="a8869-288">Protect information in transit with HTTPS</span></span>](#protect-information-in-transit-with-https)
* [<span data-ttu-id="a8869-289">Scripts entre sites (XSS)</span><span class="sxs-lookup"><span data-stu-id="a8869-289">Cross-site scripting (XSS)</span></span>](#cross-site-scripting-xss)
* [<span data-ttu-id="a8869-290">Proteção entre origens</span><span class="sxs-lookup"><span data-stu-id="a8869-290">Cross-origin protection</span></span>](#cross-origin-protection)
* [<span data-ttu-id="a8869-291">Sensor de clique</span><span class="sxs-lookup"><span data-stu-id="a8869-291">Click-jacking</span></span>](#click-jacking)
* [<span data-ttu-id="a8869-292">Redirecionamentos abertos</span><span class="sxs-lookup"><span data-stu-id="a8869-292">Open redirects</span></span>](#open-redirects)

### <a name="logging-and-sensitive-data"></a><span data-ttu-id="a8869-293">Registro em log e dados confidenciais</span><span class="sxs-lookup"><span data-stu-id="a8869-293">Logging and sensitive data</span></span>

<span data-ttu-id="a8869-294">As interações de interoperabilidade do JS entre o cliente e o servidor são registradas nos logs do servidor com <xref:Microsoft.Extensions.Logging.ILogger> instâncias.</span><span class="sxs-lookup"><span data-stu-id="a8869-294">JS interop interactions between the client and server are recorded in the server's logs with <xref:Microsoft.Extensions.Logging.ILogger> instances.</span></span> Blazor<span data-ttu-id="a8869-295">evita informações confidenciais de log, como eventos reais ou entradas e saídas de interoperabilidade do JS.</span><span class="sxs-lookup"><span data-stu-id="a8869-295"> avoids logging sensitive information, such as actual events or JS interop inputs and outputs.</span></span>

<span data-ttu-id="a8869-296">Quando ocorre um erro no servidor, a estrutura notifica o cliente e destrói a sessão.</span><span class="sxs-lookup"><span data-stu-id="a8869-296">When an error occurs on the server, the framework notifies the client and tears down the session.</span></span> <span data-ttu-id="a8869-297">Por padrão, o cliente recebe uma mensagem de erro genérica que pode ser vista nas ferramentas de desenvolvedor do navegador.</span><span class="sxs-lookup"><span data-stu-id="a8869-297">By default, the client receives a generic error message that can be seen in the browser's developer tools.</span></span>

<span data-ttu-id="a8869-298">O erro do lado do cliente não inclui a pilha de chamadas e não fornece detalhes sobre a causa do erro, mas os logs do servidor contêm essas informações.</span><span class="sxs-lookup"><span data-stu-id="a8869-298">The client-side error doesn't include the callstack and doesn't provide detail on the cause of the error, but server logs do contain such information.</span></span> <span data-ttu-id="a8869-299">Para fins de desenvolvimento, informações de erro confidenciais podem ser disponibilizadas para o cliente habilitando erros detalhados.</span><span class="sxs-lookup"><span data-stu-id="a8869-299">For development purposes, sensitive error information can be made available to the client by enabling detailed errors.</span></span>

<span data-ttu-id="a8869-300">Habilitar erros detalhados em JavaScript com:</span><span class="sxs-lookup"><span data-stu-id="a8869-300">Enable detailed errors in JavaScript with:</span></span>

* <span data-ttu-id="a8869-301"><xref:Microsoft.AspNetCore.Components.Server.CircuitOptions.DetailedErrors?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="a8869-301"><xref:Microsoft.AspNetCore.Components.Server.CircuitOptions.DetailedErrors?displayProperty=nameWithType>.</span></span>
* <span data-ttu-id="a8869-302">A `DetailedErrors` chave de configuração definida como `true` , que pode ser definida no arquivo de configurações do aplicativo ( `appsettings.json` ).</span><span class="sxs-lookup"><span data-stu-id="a8869-302">The `DetailedErrors` configuration key set to `true`, which can be set in the app settings file (`appsettings.json`).</span></span> <span data-ttu-id="a8869-303">A chave também pode ser definida usando a `ASPNETCORE_DETAILEDERRORS` variável de ambiente com um valor de `true` .</span><span class="sxs-lookup"><span data-stu-id="a8869-303">The key can also be set using the `ASPNETCORE_DETAILEDERRORS` environment variable with a value of `true`.</span></span>

> [!WARNING]
> <span data-ttu-id="a8869-304">Expor informações de erro aos clientes na Internet é um risco de segurança que sempre deve ser evitado.</span><span class="sxs-lookup"><span data-stu-id="a8869-304">Exposing error information to clients on the Internet is a security risk that should always be avoided.</span></span>

### <a name="protect-information-in-transit-with-https"></a><span data-ttu-id="a8869-305">Proteger informações em trânsito com HTTPS</span><span class="sxs-lookup"><span data-stu-id="a8869-305">Protect information in transit with HTTPS</span></span>

Blazor<span data-ttu-id="a8869-306">O servidor usa SignalR para a comunicação entre o cliente e o servidor.</span><span class="sxs-lookup"><span data-stu-id="a8869-306"> Server uses SignalR for communication between the client and the server.</span></span> Blazor<span data-ttu-id="a8869-307">O servidor normalmente usa o transporte que SignalR negocia, que normalmente é WebSockets.</span><span class="sxs-lookup"><span data-stu-id="a8869-307"> Server normally uses the transport that SignalR negotiates, which is typically WebSockets.</span></span>

Blazor<span data-ttu-id="a8869-308">O servidor não garante a integridade e a confidencialidade dos dados enviados entre o servidor e o cliente.</span><span class="sxs-lookup"><span data-stu-id="a8869-308"> Server doesn't ensure the integrity and confidentiality of the data sent between the server and the client.</span></span> <span data-ttu-id="a8869-309">Sempre use HTTPS.</span><span class="sxs-lookup"><span data-stu-id="a8869-309">Always use HTTPS.</span></span>

### <a name="cross-site-scripting-xss"></a><span data-ttu-id="a8869-310">Scripts entre sites (XSS)</span><span class="sxs-lookup"><span data-stu-id="a8869-310">Cross-site scripting (XSS)</span></span>

<span data-ttu-id="a8869-311">O XSS (script entre sites) permite que uma parte não autorizada execute lógica arbitrária no contexto do navegador.</span><span class="sxs-lookup"><span data-stu-id="a8869-311">Cross-site scripting (XSS) allows an unauthorized party to execute arbitrary logic in the context of the browser.</span></span> <span data-ttu-id="a8869-312">Um aplicativo comprometido poderia potencialmente executar código arbitrário no cliente.</span><span class="sxs-lookup"><span data-stu-id="a8869-312">A compromised app could potentially run arbitrary code on the client.</span></span> <span data-ttu-id="a8869-313">A vulnerabilidade pode ser usada para potencialmente executar várias ações mal-intencionadas no servidor:</span><span class="sxs-lookup"><span data-stu-id="a8869-313">The vulnerability could be used to potentially perform a number of malicious actions against the server:</span></span>

* <span data-ttu-id="a8869-314">Despache eventos falsos/inválidos para o servidor.</span><span class="sxs-lookup"><span data-stu-id="a8869-314">Dispatch fake/invalid events to the server.</span></span>
* <span data-ttu-id="a8869-315">Falha de expedição/conclusões de renderização inválidas.</span><span class="sxs-lookup"><span data-stu-id="a8869-315">Dispatch fail/invalid render completions.</span></span>
* <span data-ttu-id="a8869-316">Evite a expedição de conclusões de renderização.</span><span class="sxs-lookup"><span data-stu-id="a8869-316">Avoid dispatching render completions.</span></span>
* <span data-ttu-id="a8869-317">Despache chamadas de interoperabilidade do JavaScript para o .NET.</span><span class="sxs-lookup"><span data-stu-id="a8869-317">Dispatch interop calls from JavaScript to .NET.</span></span>
* <span data-ttu-id="a8869-318">Modifique a resposta das chamadas de interoperabilidade do .NET para o JavaScript.</span><span class="sxs-lookup"><span data-stu-id="a8869-318">Modify the response of interop calls from .NET to JavaScript.</span></span>
* <span data-ttu-id="a8869-319">Evite distribuir resultados de interoperabilidade do .NET para JS.</span><span class="sxs-lookup"><span data-stu-id="a8869-319">Avoid dispatching .NET to JS interop results.</span></span>

<span data-ttu-id="a8869-320">A Blazor estrutura do servidor executa as etapas para proteger contra algumas das ameaças anteriores:</span><span class="sxs-lookup"><span data-stu-id="a8869-320">The Blazor Server framework takes steps to protect against some of the preceding threats:</span></span>

* <span data-ttu-id="a8869-321">Interromperá a produção de novas atualizações de interface do usuário se o cliente não estiver confirmando lotes de renderização.</span><span class="sxs-lookup"><span data-stu-id="a8869-321">Stops producing new UI updates if the client isn't acknowledging render batches.</span></span> <span data-ttu-id="a8869-322">Configurado com <xref:Microsoft.AspNetCore.Components.Server.CircuitOptions.MaxBufferedUnacknowledgedRenderBatches?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="a8869-322">Configured with <xref:Microsoft.AspNetCore.Components.Server.CircuitOptions.MaxBufferedUnacknowledgedRenderBatches?displayProperty=nameWithType>.</span></span>
* <span data-ttu-id="a8869-323">O tempo limite de qualquer chamada .NET para JavaScript após um minuto sem receber uma resposta do cliente.</span><span class="sxs-lookup"><span data-stu-id="a8869-323">Times out any .NET to JavaScript call after one minute without receiving a response from the client.</span></span> <span data-ttu-id="a8869-324">Configurado com <xref:Microsoft.AspNetCore.Components.Server.CircuitOptions.JSInteropDefaultCallTimeout?displayProperty=nameWithType> .</span><span class="sxs-lookup"><span data-stu-id="a8869-324">Configured with <xref:Microsoft.AspNetCore.Components.Server.CircuitOptions.JSInteropDefaultCallTimeout?displayProperty=nameWithType>.</span></span>
* <span data-ttu-id="a8869-325">Executa a validação básica em todas as entradas provenientes do navegador durante a interoperabilidade do JS:</span><span class="sxs-lookup"><span data-stu-id="a8869-325">Performs basic validation on all input coming from the browser during JS interop:</span></span>
  * <span data-ttu-id="a8869-326">As referências do .NET são válidas e do tipo esperado pelo método .NET.</span><span class="sxs-lookup"><span data-stu-id="a8869-326">.NET references are valid and of the type expected by the .NET method.</span></span>
  * <span data-ttu-id="a8869-327">Os dados não estão malformados.</span><span class="sxs-lookup"><span data-stu-id="a8869-327">The data isn't malformed.</span></span>
  * <span data-ttu-id="a8869-328">O número correto de argumentos para o método está presente na carga.</span><span class="sxs-lookup"><span data-stu-id="a8869-328">The correct number of arguments for the method are present in the payload.</span></span>
  * <span data-ttu-id="a8869-329">Os argumentos ou o resultado podem ser desserializados corretamente antes de invocar o método.</span><span class="sxs-lookup"><span data-stu-id="a8869-329">The arguments or result can be deserialized correctly before invoking the method.</span></span>
* <span data-ttu-id="a8869-330">Executa a validação básica em todas as entradas provenientes do navegador de eventos expedidos:</span><span class="sxs-lookup"><span data-stu-id="a8869-330">Performs basic validation in all input coming from the browser from dispatched events:</span></span>
  * <span data-ttu-id="a8869-331">O evento tem um tipo válido.</span><span class="sxs-lookup"><span data-stu-id="a8869-331">The event has a valid type.</span></span>
  * <span data-ttu-id="a8869-332">Os dados do evento podem ser desserializados.</span><span class="sxs-lookup"><span data-stu-id="a8869-332">The data for the event can be deserialized.</span></span>
  * <span data-ttu-id="a8869-333">Há um manipulador de eventos associado ao evento.</span><span class="sxs-lookup"><span data-stu-id="a8869-333">There's an event handler associated with the event.</span></span>

<span data-ttu-id="a8869-334">Além das proteções que a estrutura implementa, o aplicativo deve ser codificado pelo desenvolvedor para proteger contra ameaças e tomar as medidas apropriadas:</span><span class="sxs-lookup"><span data-stu-id="a8869-334">In addition to the safeguards that the framework implements, the app must be coded by the developer to safeguard against threats and take appropriate actions:</span></span>

* <span data-ttu-id="a8869-335">Sempre validar dados ao manipular eventos.</span><span class="sxs-lookup"><span data-stu-id="a8869-335">Always validate data when handling events.</span></span>
* <span data-ttu-id="a8869-336">Execute a ação apropriada ao receber dados inválidos:</span><span class="sxs-lookup"><span data-stu-id="a8869-336">Take appropriate action upon receiving invalid data:</span></span>
  * <span data-ttu-id="a8869-337">Ignorar os dados e retornar.</span><span class="sxs-lookup"><span data-stu-id="a8869-337">Ignore the data and return.</span></span> <span data-ttu-id="a8869-338">Isso permite que o aplicativo continue processando solicitações.</span><span class="sxs-lookup"><span data-stu-id="a8869-338">This allows the app to continue processing requests.</span></span>
  * <span data-ttu-id="a8869-339">Se o aplicativo determinar que a entrada é ilegítimo e não pôde ser produzida pelo cliente legítimo, acione uma exceção.</span><span class="sxs-lookup"><span data-stu-id="a8869-339">If the app determines that the input is illegitimate and couldn't be produced by legitimate client, throw an exception.</span></span> <span data-ttu-id="a8869-340">Lançar uma exceção destrói o circuito e encerra a sessão.</span><span class="sxs-lookup"><span data-stu-id="a8869-340">Throwing an exception tears down the circuit and ends the session.</span></span>
* <span data-ttu-id="a8869-341">Não confie na mensagem de erro fornecida por conclusões de lote de renderização incluídas nos logs.</span><span class="sxs-lookup"><span data-stu-id="a8869-341">Don't trust the error message provided by render batch completions included in the logs.</span></span> <span data-ttu-id="a8869-342">O erro é fornecido pelo cliente e, em geral, não pode ser confiável, pois o cliente pode estar comprometido.</span><span class="sxs-lookup"><span data-stu-id="a8869-342">The error is provided by the client and can't generally be trusted, as the client might be compromised.</span></span>
* <span data-ttu-id="a8869-343">Não confie na entrada em chamadas de interoperabilidade JS em qualquer direção entre os métodos JavaScript e .NET.</span><span class="sxs-lookup"><span data-stu-id="a8869-343">Don't trust the input on JS interop calls in either direction between JavaScript and .NET methods.</span></span>
* <span data-ttu-id="a8869-344">O aplicativo é responsável por validar que o conteúdo dos argumentos e dos resultados é válido, mesmo que os argumentos ou os resultados sejam desserializados corretamente.</span><span class="sxs-lookup"><span data-stu-id="a8869-344">The app is responsible for validating that the content of arguments and results are valid, even if the arguments or results are correctly deserialized.</span></span>

<span data-ttu-id="a8869-345">Para que uma vulnerabilidade de XSS exista, o aplicativo deve incorporar a entrada do usuário na página renderizada.</span><span class="sxs-lookup"><span data-stu-id="a8869-345">For a XSS vulnerability to exist, the app must incorporate user input in the rendered page.</span></span> Blazor<span data-ttu-id="a8869-346">Os componentes de servidor executam uma etapa de tempo de compilação em que a marcação em um `.razor` arquivo é transformada em lógica C# de procedimento.</span><span class="sxs-lookup"><span data-stu-id="a8869-346"> Server components execute a compile-time step where the markup in a `.razor` file is transformed into procedural C# logic.</span></span> <span data-ttu-id="a8869-347">Em tempo de execução, a lógica do C# cria uma *árvore de renderização* que descreve os elementos, o texto e os componentes filho.</span><span class="sxs-lookup"><span data-stu-id="a8869-347">At runtime, the C# logic builds a *render tree* describing the elements, text, and child components.</span></span> <span data-ttu-id="a8869-348">Isso é aplicado ao DOM do navegador por meio de uma sequência de instruções de JavaScript (ou é serializado para HTML no caso de pré-processamento):</span><span class="sxs-lookup"><span data-stu-id="a8869-348">This is applied to the browser's DOM via a sequence of JavaScript instructions (or is serialized to HTML in the case of prerendering):</span></span>

* <span data-ttu-id="a8869-349">A entrada do usuário renderizada por meio Razor da sintaxe normal (por exemplo, `@someStringValue` ) não expõe uma vulnerabilidade de XSS porque a Razor sintaxe é adicionada ao dom por meio de comandos que só podem gravar texto.</span><span class="sxs-lookup"><span data-stu-id="a8869-349">User input rendered via normal Razor syntax (for example, `@someStringValue`) doesn't expose a XSS vulnerability because the Razor syntax is added to the DOM via commands that can only write text.</span></span> <span data-ttu-id="a8869-350">Mesmo se o valor incluir marcação HTML, o valor será exibido como texto estático.</span><span class="sxs-lookup"><span data-stu-id="a8869-350">Even if the value includes HTML markup, the value is displayed as static text.</span></span> <span data-ttu-id="a8869-351">Ao renderizar, a saída é codificada em HTML, que também exibe o conteúdo como texto estático.</span><span class="sxs-lookup"><span data-stu-id="a8869-351">When prerendering, the output is HTML-encoded, which also displays the content as static text.</span></span>
* <span data-ttu-id="a8869-352">Marcas de script não são permitidas e não devem ser incluídas na árvore de renderização de componente do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="a8869-352">Script tags aren't allowed and shouldn't be included in the app's component render tree.</span></span> <span data-ttu-id="a8869-353">Se uma marca de script for incluída na marcação de um componente, um erro de tempo de compilação será gerado.</span><span class="sxs-lookup"><span data-stu-id="a8869-353">If a script tag is included in a component's markup, a compile-time error is generated.</span></span>
* <span data-ttu-id="a8869-354">Os autores de componentes podem criar componentes em C# sem usar o Razor .</span><span class="sxs-lookup"><span data-stu-id="a8869-354">Component authors can author components in C# without using Razor.</span></span> <span data-ttu-id="a8869-355">O autor do componente é responsável por usar as APIs corretas ao emitir a saída.</span><span class="sxs-lookup"><span data-stu-id="a8869-355">The component author is responsible for using the correct APIs when emitting output.</span></span> <span data-ttu-id="a8869-356">Por exemplo, use `builder.AddContent(0, someUserSuppliedString)` e *not* `builder.AddMarkupContent(0, someUserSuppliedString)` , pois o último pode criar uma vulnerabilidade de XSS.</span><span class="sxs-lookup"><span data-stu-id="a8869-356">For example, use `builder.AddContent(0, someUserSuppliedString)` and *not* `builder.AddMarkupContent(0, someUserSuppliedString)`, as the latter could create a XSS vulnerability.</span></span>

<span data-ttu-id="a8869-357">Como parte da proteção contra ataques XSS, considere a implementação de mitigações XSS, como a [política de segurança de conteúdo (CSP)](https://developer.mozilla.org/docs/Web/HTTP/CSP).</span><span class="sxs-lookup"><span data-stu-id="a8869-357">As part of protecting against XSS attacks, consider implementing XSS mitigations, such as [Content Security Policy (CSP)](https://developer.mozilla.org/docs/Web/HTTP/CSP).</span></span>

<span data-ttu-id="a8869-358">Para obter mais informações, consulte <xref:security/cross-site-scripting>.</span><span class="sxs-lookup"><span data-stu-id="a8869-358">For more information, see <xref:security/cross-site-scripting>.</span></span>

### <a name="cross-origin-protection"></a><span data-ttu-id="a8869-359">Proteção entre origens</span><span class="sxs-lookup"><span data-stu-id="a8869-359">Cross-origin protection</span></span>

<span data-ttu-id="a8869-360">Os ataques entre origens envolvem um cliente de uma origem diferente executando uma ação no servidor.</span><span class="sxs-lookup"><span data-stu-id="a8869-360">Cross-origin attacks involve a client from a different origin performing an action against the server.</span></span> <span data-ttu-id="a8869-361">A ação mal-intencionada é normalmente uma solicitação GET ou uma POSTAgem de formulário (solicitação entre sites forjada, CSRF), mas também é possível abrir um WebSocket mal-intencionado.</span><span class="sxs-lookup"><span data-stu-id="a8869-361">The malicious action is typically a GET request or a form POST (Cross-Site Request Forgery, CSRF), but opening a malicious WebSocket is also possible.</span></span> Blazor<span data-ttu-id="a8869-362">Os aplicativos de servidor oferecem [as mesmas garantias de que qualquer outro SignalR aplicativo usando a oferta de protocolo de Hub](xref:signalr/security):</span><span class="sxs-lookup"><span data-stu-id="a8869-362"> Server apps offer [the same guarantees that any other SignalR app using the hub protocol offer](xref:signalr/security):</span></span>

* Blazor<span data-ttu-id="a8869-363">Os aplicativos de servidor podem ser acessados entre origens, a menos que sejam tomadas medidas adicionais para impedi-lo.</span><span class="sxs-lookup"><span data-stu-id="a8869-363"> Server apps can be accessed cross-origin unless additional measures are taken to prevent it.</span></span> <span data-ttu-id="a8869-364">Para desabilitar o acesso entre origens, desabilite o CORS no ponto de extremidade adicionando o middleware do CORS ao pipeline e adicionando o <xref:Microsoft.AspNetCore.Cors.DisableCorsAttribute> aos Blazor metadados do ponto de extremidade ou limite o conjunto de origens permitidas [Configurando SignalR para compartilhamento de recursos entre origens](xref:signalr/security#cross-origin-resource-sharing).</span><span class="sxs-lookup"><span data-stu-id="a8869-364">To disable cross-origin access, either disable CORS in the endpoint by adding the CORS middleware to the pipeline and adding the <xref:Microsoft.AspNetCore.Cors.DisableCorsAttribute> to the Blazor endpoint metadata or limit the set of allowed origins by [configuring SignalR for cross-origin resource sharing](xref:signalr/security#cross-origin-resource-sharing).</span></span>
* <span data-ttu-id="a8869-365">Se o CORS estiver habilitado, etapas adicionais poderão ser necessárias para proteger o aplicativo dependendo da configuração do CORS.</span><span class="sxs-lookup"><span data-stu-id="a8869-365">If CORS is enabled, extra steps might be required to protect the app depending on the CORS configuration.</span></span> <span data-ttu-id="a8869-366">Se o CORS for habilitado globalmente, o CORS poderá ser desabilitado para o Blazor Hub de servidor adicionando os <xref:Microsoft.AspNetCore.Cors.DisableCorsAttribute> metadados aos metadados do ponto de extremidade após <xref:Microsoft.AspNetCore.Builder.ComponentEndpointRouteBuilderExtensions.MapBlazorHub%2A> a chamada no construtor de rotas do ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="a8869-366">If CORS is globally enabled, CORS can be disabled for the Blazor Server hub by adding the <xref:Microsoft.AspNetCore.Cors.DisableCorsAttribute> metadata to the endpoint metadata after calling <xref:Microsoft.AspNetCore.Builder.ComponentEndpointRouteBuilderExtensions.MapBlazorHub%2A> on the endpoint route builder.</span></span>

<span data-ttu-id="a8869-367">Para obter mais informações, consulte <xref:security/anti-request-forgery>.</span><span class="sxs-lookup"><span data-stu-id="a8869-367">For more information, see <xref:security/anti-request-forgery>.</span></span>

### <a name="click-jacking"></a><span data-ttu-id="a8869-368">Sensor de clique</span><span class="sxs-lookup"><span data-stu-id="a8869-368">Click-jacking</span></span>

<span data-ttu-id="a8869-369">A tomada de clique envolve a renderização de um site como um `<iframe>` dentro de um site de uma origem diferente para induzir o usuário a executar ações no site sob ataque.</span><span class="sxs-lookup"><span data-stu-id="a8869-369">Click-jacking involves rendering a site as an `<iframe>` inside a site from a different origin in order to trick the user into performing actions on the site under attack.</span></span>

<span data-ttu-id="a8869-370">Para proteger um aplicativo contra a renderização dentro de um `<iframe>` , use o [CSP (política de segurança de conteúdo)](https://developer.mozilla.org/docs/Web/HTTP/CSP) e o `X-Frame-Options` cabeçalho.</span><span class="sxs-lookup"><span data-stu-id="a8869-370">To protect an app from rendering inside of an `<iframe>`, use [Content Security Policy (CSP)](https://developer.mozilla.org/docs/Web/HTTP/CSP) and the `X-Frame-Options` header.</span></span> <span data-ttu-id="a8869-371">Para obter mais informações, consulte [MDN Web docs: X-Frame-Options](https://developer.mozilla.org/docs/Web/HTTP/Headers/X-Frame-Options).</span><span class="sxs-lookup"><span data-stu-id="a8869-371">For more information, see [MDN web docs: X-Frame-Options](https://developer.mozilla.org/docs/Web/HTTP/Headers/X-Frame-Options).</span></span>

### <a name="open-redirects"></a><span data-ttu-id="a8869-372">Redirecionamentos abertos</span><span class="sxs-lookup"><span data-stu-id="a8869-372">Open redirects</span></span>

<span data-ttu-id="a8869-373">Quando uma Blazor sessão de aplicativo de servidor é iniciada, o servidor executa a validação básica das URLs enviadas como parte do início da sessão.</span><span class="sxs-lookup"><span data-stu-id="a8869-373">When a Blazor Server app session starts, the server performs basic validation of the URLs sent as part of starting the session.</span></span> <span data-ttu-id="a8869-374">A estrutura verifica se a URL base é um pai da URL atual antes de estabelecer o circuito.</span><span class="sxs-lookup"><span data-stu-id="a8869-374">The framework checks that the base URL is a parent of the current URL before establishing the circuit.</span></span> <span data-ttu-id="a8869-375">Nenhuma verificação adicional é executada pela estrutura.</span><span class="sxs-lookup"><span data-stu-id="a8869-375">No additional checks are performed by the framework.</span></span>

<span data-ttu-id="a8869-376">Quando um usuário seleciona um link no cliente, a URL do link é enviada para o servidor, que determina a ação a ser tomada.</span><span class="sxs-lookup"><span data-stu-id="a8869-376">When a user selects a link on the client, the URL for the link is sent to the server, which determines what action to take.</span></span> <span data-ttu-id="a8869-377">Por exemplo, o aplicativo pode executar uma navegação no lado do cliente ou indicar ao navegador para ir para o novo local.</span><span class="sxs-lookup"><span data-stu-id="a8869-377">For example, the app may perform a client-side navigation or indicate to the browser to go to the new location.</span></span>

<span data-ttu-id="a8869-378">Os componentes também podem disparar solicitações de navegação programaticamente por meio do uso do <xref:Microsoft.AspNetCore.Components.NavigationManager> .</span><span class="sxs-lookup"><span data-stu-id="a8869-378">Components can also trigger navigation requests programatically through the use of <xref:Microsoft.AspNetCore.Components.NavigationManager>.</span></span> <span data-ttu-id="a8869-379">Nesses cenários, o aplicativo pode executar uma navegação no lado do cliente ou indicar ao navegador para ir para o novo local.</span><span class="sxs-lookup"><span data-stu-id="a8869-379">In such scenarios, the app might perform a client-side navigation or indicate to the browser to go to the new location.</span></span>

<span data-ttu-id="a8869-380">Os componentes devem:</span><span class="sxs-lookup"><span data-stu-id="a8869-380">Components must:</span></span>

* <span data-ttu-id="a8869-381">Evite usar a entrada do usuário como parte dos argumentos de chamada de navegação.</span><span class="sxs-lookup"><span data-stu-id="a8869-381">Avoid using user input as part of the navigation call arguments.</span></span>
* <span data-ttu-id="a8869-382">Valide os argumentos para garantir que o destino seja permitido pelo aplicativo.</span><span class="sxs-lookup"><span data-stu-id="a8869-382">Validate arguments to ensure that the target is allowed by the app.</span></span>

<span data-ttu-id="a8869-383">Caso contrário, um usuário mal-intencionado pode forçar o navegador a ir para um site controlado pelo invasor.</span><span class="sxs-lookup"><span data-stu-id="a8869-383">Otherwise, a malicious user can force the browser to go to an attacker-controlled site.</span></span> <span data-ttu-id="a8869-384">Nesse cenário, o invasor vaza o aplicativo para usar alguma entrada do usuário como parte da invocação do <xref:Microsoft.AspNetCore.Components.NavigationManager.NavigateTo%2A?displayProperty=nameWithType> método.</span><span class="sxs-lookup"><span data-stu-id="a8869-384">In this scenario, the attacker tricks the app into using some user input as part of the invocation of the <xref:Microsoft.AspNetCore.Components.NavigationManager.NavigateTo%2A?displayProperty=nameWithType> method.</span></span>

<span data-ttu-id="a8869-385">Esse aviso também se aplica ao renderizar links como parte do aplicativo:</span><span class="sxs-lookup"><span data-stu-id="a8869-385">This advice also applies when rendering links as part of the app:</span></span>

* <span data-ttu-id="a8869-386">Se possível, use links relativos.</span><span class="sxs-lookup"><span data-stu-id="a8869-386">If possible, use relative links.</span></span>
* <span data-ttu-id="a8869-387">Valide se os destinos de link absoluto são válidos antes de incluí-los em uma página.</span><span class="sxs-lookup"><span data-stu-id="a8869-387">Validate that absolute link destinations are valid before including them in a page.</span></span>

<span data-ttu-id="a8869-388">Para obter mais informações, consulte <xref:security/preventing-open-redirects>.</span><span class="sxs-lookup"><span data-stu-id="a8869-388">For more information, see <xref:security/preventing-open-redirects>.</span></span>

## <a name="security-checklist"></a><span data-ttu-id="a8869-389">Lista de verificação de segurança</span><span class="sxs-lookup"><span data-stu-id="a8869-389">Security checklist</span></span>

<span data-ttu-id="a8869-390">A seguinte lista de considerações de segurança não é abrangente:</span><span class="sxs-lookup"><span data-stu-id="a8869-390">The following list of security considerations isn't comprehensive:</span></span>

* <span data-ttu-id="a8869-391">Validar argumentos de eventos.</span><span class="sxs-lookup"><span data-stu-id="a8869-391">Validate arguments from events.</span></span>
* <span data-ttu-id="a8869-392">Validar entradas e resultados de chamadas de interoperabilidade JS.</span><span class="sxs-lookup"><span data-stu-id="a8869-392">Validate inputs and results from JS interop calls.</span></span>
* <span data-ttu-id="a8869-393">Evite usar (ou validar com antecedência) a entrada do usuário para chamadas de interoperabilidade .NET para JS.</span><span class="sxs-lookup"><span data-stu-id="a8869-393">Avoid using (or validate beforehand) user input for .NET to JS interop calls.</span></span>
* <span data-ttu-id="a8869-394">Impedir que o cliente aloque uma quantidade desassociada de memória.</span><span class="sxs-lookup"><span data-stu-id="a8869-394">Prevent the client from allocating an unbound amount of memory.</span></span>
  * <span data-ttu-id="a8869-395">Dados dentro do componente.</span><span class="sxs-lookup"><span data-stu-id="a8869-395">Data within the component.</span></span>
  * <span data-ttu-id="a8869-396">`DotNetObject`referências retornadas ao cliente.</span><span class="sxs-lookup"><span data-stu-id="a8869-396">`DotNetObject` references returned to the client.</span></span>
* <span data-ttu-id="a8869-397">Proteção contra vários despachos.</span><span class="sxs-lookup"><span data-stu-id="a8869-397">Guard against multiple dispatches.</span></span>
* <span data-ttu-id="a8869-398">Cancelar operações de execução longa quando o componente for descartado.</span><span class="sxs-lookup"><span data-stu-id="a8869-398">Cancel long-running operations when the component is disposed.</span></span>
* <span data-ttu-id="a8869-399">Evite eventos que produzem grandes quantidades de dados.</span><span class="sxs-lookup"><span data-stu-id="a8869-399">Avoid events that produce large amounts of data.</span></span>
* <span data-ttu-id="a8869-400">Evite usar a entrada do usuário como parte das chamadas para <xref:Microsoft.AspNetCore.Components.NavigationManager.NavigateTo%2A?displayProperty=nameWithType> e validar a entrada do usuário para URLs em um conjunto de origens permitidas primeiro se for inevitável.</span><span class="sxs-lookup"><span data-stu-id="a8869-400">Avoid using user input as part of calls to <xref:Microsoft.AspNetCore.Components.NavigationManager.NavigateTo%2A?displayProperty=nameWithType> and validate user input for URLs against a set of allowed origins first if unavoidable.</span></span>
* <span data-ttu-id="a8869-401">Não tome decisões de autorização com base no estado da interface do usuário, mas somente no estado do componente.</span><span class="sxs-lookup"><span data-stu-id="a8869-401">Don't make authorization decisions based on the state of the UI but only from component state.</span></span>
* <span data-ttu-id="a8869-402">Considere o uso da [CSP (política de segurança de conteúdo)](https://developer.mozilla.org/docs/Web/HTTP/CSP) para proteger contra ataques de XSS.</span><span class="sxs-lookup"><span data-stu-id="a8869-402">Consider using [Content Security Policy (CSP)](https://developer.mozilla.org/docs/Web/HTTP/CSP) to protect against XSS attacks.</span></span>
* <span data-ttu-id="a8869-403">Considere usar o CSP e [as opções X-frame](https://developer.mozilla.org/docs/Web/HTTP/Headers/X-Frame-Options) para proteger contra o clique.</span><span class="sxs-lookup"><span data-stu-id="a8869-403">Consider using CSP and [X-Frame-Options](https://developer.mozilla.org/docs/Web/HTTP/Headers/X-Frame-Options) to protect against click-jacking.</span></span>
* <span data-ttu-id="a8869-404">Verifique se as configurações de CORS são apropriadas ao habilitar o CORS ou desabilitar explicitamente o CORS para Blazor aplicativos.</span><span class="sxs-lookup"><span data-stu-id="a8869-404">Ensure CORS settings are appropriate when enabling CORS or explicitly disable CORS for Blazor apps.</span></span>
* <span data-ttu-id="a8869-405">Teste para garantir que os limites do lado do servidor para o Blazor aplicativo forneçam uma experiência de usuário aceitável sem níveis inaceitáveis de risco.</span><span class="sxs-lookup"><span data-stu-id="a8869-405">Test to ensure that the server-side limits for the Blazor app provide an acceptable user experience without unacceptable levels of risk.</span></span>
