# <a name="upload-files-sample-app"></a><span data-ttu-id="c43f7-101">Aplicativo de exemplo de upload de arquivos</span><span class="sxs-lookup"><span data-stu-id="c43f7-101">Upload Files Sample App</span></span>

<span data-ttu-id="c43f7-102">Este aplicativo de exemplo demonstra os conceitos descritos no tópico [carregar arquivos no ASP.NET Core](https://docs.microsoft.com/aspnet/core/mvc/models/file-uploads) .</span><span class="sxs-lookup"><span data-stu-id="c43f7-102">This sample app demonstrates concepts described in the [Upload files in ASP.NET Core](https://docs.microsoft.com/aspnet/core/mvc/models/file-uploads) topic.</span></span>

## <a name="security-considerations"></a><span data-ttu-id="c43f7-103">Considerações sobre segurança</span><span class="sxs-lookup"><span data-stu-id="c43f7-103">Security considerations</span></span>

<span data-ttu-id="c43f7-104">Tome cuidado ao fornecer aos usuários a capacidade de carregar arquivos em um servidor.</span><span class="sxs-lookup"><span data-stu-id="c43f7-104">Use caution when providing users with the ability to upload files to a server.</span></span> <span data-ttu-id="c43f7-105">Os invasores podem executar ataques [de negação de serviço](/windows-hardware/drivers/ifs/denial-of-service) , tentar carregar vírus ou malware ou tentar comprometer redes e servidores de outras maneiras.</span><span class="sxs-lookup"><span data-stu-id="c43f7-105">Attackers may execute [denial of service](/windows-hardware/drivers/ifs/denial-of-service) attacks, attempt to upload viruses or malware, or attempt to compromise networks and servers in other ways.</span></span>

<span data-ttu-id="c43f7-106">As etapas de segurança que reduzem a probabilidade de um ataque bem-sucedido são:</span><span class="sxs-lookup"><span data-stu-id="c43f7-106">Security steps that reduce the likelihood of a successful attack are:</span></span>

* <span data-ttu-id="c43f7-107">Carregue arquivos em uma área de carregamento de arquivo dedicada no sistema, preferencialmente para uma unidade que não seja do sistema.</span><span class="sxs-lookup"><span data-stu-id="c43f7-107">Upload files to a dedicated file upload area on the system, preferably to a non-system drive.</span></span> <span data-ttu-id="c43f7-108">O uso de um local dedicado torna mais fácil impor medidas de segurança em arquivos carregados.</span><span class="sxs-lookup"><span data-stu-id="c43f7-108">Use of a dedicated location makes it easier to impose security measures on uploaded files.</span></span> <span data-ttu-id="c43f7-109">Desabilite as permissões de execução no local de carregamento do arquivo. &dagger;</span><span class="sxs-lookup"><span data-stu-id="c43f7-109">Disable execute permissions on the file upload location.&dagger;</span></span>
* <span data-ttu-id="c43f7-110">Nunca persista arquivos carregados na mesma árvore de diretório que o aplicativo. &dagger;</span><span class="sxs-lookup"><span data-stu-id="c43f7-110">Never persist uploaded files in the same directory tree as the app.&dagger;</span></span>
* <span data-ttu-id="c43f7-111">Use um nome de arquivo seguro determinado pelo aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c43f7-111">Use a safe file name determined by the app.</span></span> <span data-ttu-id="c43f7-112">Não use um nome de arquivo fornecido pela entrada do usuário ou o nome de arquivo não confiável do arquivo carregado. &dagger;</span><span class="sxs-lookup"><span data-stu-id="c43f7-112">Don't use a file name provided by user input or the untrusted file name of the uploaded file.&dagger;</span></span>
* <span data-ttu-id="c43f7-113">Permitir apenas um conjunto específico de extensões de arquivo aprovadas. &dagger;</span><span class="sxs-lookup"><span data-stu-id="c43f7-113">Only allow a specific set of approved file extensions.&dagger;</span></span>
* <span data-ttu-id="c43f7-114">Verifique a assinatura de formato de arquivo para impedir que um usuário carregue um arquivo mascarado (por exemplo, carregando um arquivo *. exe* com uma extensão *. txt* ). &dagger;</span><span class="sxs-lookup"><span data-stu-id="c43f7-114">Check the file format signature to prevent a user from uploading a masqueraded file (for example, uploading an *.exe* file with a *.txt* extension).&dagger;</span></span>
* <span data-ttu-id="c43f7-115">Verifique se as verificações do lado do cliente também são executadas no servidor.</span><span class="sxs-lookup"><span data-stu-id="c43f7-115">Verify that client-side checks are also performed on the server.</span></span> <span data-ttu-id="c43f7-116">Verificações no lado do cliente são fáceis de evitar. &dagger;</span><span class="sxs-lookup"><span data-stu-id="c43f7-116">Client-side checks are easy to circumvent.&dagger;</span></span>
* <span data-ttu-id="c43f7-117">Verifique o tamanho do upload e evite carregamentos maiores que o esperado. &dagger;</span><span class="sxs-lookup"><span data-stu-id="c43f7-117">Check the size of the upload and prevent uploads that are larger than expected.&dagger;</span></span>
* <span data-ttu-id="c43f7-118">Quando os arquivos não devem ser substituídos por um arquivo carregado com o mesmo nome, verifique o nome do arquivo no banco de dados ou no armazenamento físico antes de carregar o arquivo.</span><span class="sxs-lookup"><span data-stu-id="c43f7-118">When files shouldn't be overwritten by an uploaded file with the same name, check the file name against the database or physical storage before uploading the file.</span></span>
* <span data-ttu-id="c43f7-119">**Execute um scanner de vírus/malware no conteúdo carregado antes de o arquivo ser armazenado.**</span><span class="sxs-lookup"><span data-stu-id="c43f7-119">**Run a virus/malware scanner on uploaded content before the file is stored.**</span></span>

<span data-ttu-id="c43f7-120">o aplicativo de exemplo &dagger;The demonstra uma abordagem que atende aos critérios.</span><span class="sxs-lookup"><span data-stu-id="c43f7-120">&dagger;The sample app demonstrates an approach that meets the criteria.</span></span>

> [!WARNING]
> <span data-ttu-id="c43f7-121">Carregar códigos mal-intencionados em um sistema é frequentemente a primeira etapa para executar o código que pode:</span><span class="sxs-lookup"><span data-stu-id="c43f7-121">Uploading malicious code to a system is frequently the first step to executing code that can:</span></span>
>
> * <span data-ttu-id="c43f7-122">Tomar o controle total de um sistema.</span><span class="sxs-lookup"><span data-stu-id="c43f7-122">Completely takeover a system.</span></span>
> * <span data-ttu-id="c43f7-123">Sobrecarregar um sistema com o resultado que o sistema falha.</span><span class="sxs-lookup"><span data-stu-id="c43f7-123">Overload a system with the result that the system crashes.</span></span>
> * <span data-ttu-id="c43f7-124">Comprometer dados do sistema ou de usuários.</span><span class="sxs-lookup"><span data-stu-id="c43f7-124">Compromise user or system data.</span></span>
> * <span data-ttu-id="c43f7-125">Aplique graffiti a uma interface do usuário pública.</span><span class="sxs-lookup"><span data-stu-id="c43f7-125">Apply graffiti to a public UI.</span></span>
>
> <span data-ttu-id="c43f7-126">Para obter informações de como reduzir a área da superfície de ataque ao aceitar arquivos de usuários, confira os seguintes recursos:</span><span class="sxs-lookup"><span data-stu-id="c43f7-126">For information on reducing the attack surface area when accepting files from users, see the following resources:</span></span>
>
> * <span data-ttu-id="c43f7-127">[Unrestricted File Upload](https://www.owasp.org/index.php/Unrestricted_File_Upload) (Carregamento de arquivo irrestrito)</span><span class="sxs-lookup"><span data-stu-id="c43f7-127">[Unrestricted File Upload](https://www.owasp.org/index.php/Unrestricted_File_Upload)</span></span>
> * <span data-ttu-id="c43f7-128">Segurança de @no__t 0Azure: Verifique se os controles apropriados estão em vigor ao aceitar arquivos de usuários @ no__t-0</span><span class="sxs-lookup"><span data-stu-id="c43f7-128">[Azure Security: Ensure appropriate controls are in place when accepting files from users](/azure/security/azure-security-threat-modeling-tool-input-validation#controls-users)</span></span>

<span data-ttu-id="c43f7-129">Para obter informações adicionais, consulte [carregar arquivos em ASP.NET Core](https://docs.microsoft.com/aspnet/core/mvc/models/file-uploads).</span><span class="sxs-lookup"><span data-stu-id="c43f7-129">For additional information, see [Upload files in ASP.NET Core](https://docs.microsoft.com/aspnet/core/mvc/models/file-uploads).</span></span>

## <a name="how-to-use-the-sample"></a><span data-ttu-id="c43f7-130">Como usar o exemplo</span><span class="sxs-lookup"><span data-stu-id="c43f7-130">How to use the sample</span></span>

<span data-ttu-id="c43f7-131">No arquivo *appSettings. JSON* :</span><span class="sxs-lookup"><span data-stu-id="c43f7-131">In the *appsettings.json* file:</span></span>

1. <span data-ttu-id="c43f7-132">Defina o caminho para arquivos armazenados (`StoredFilesPath`).</span><span class="sxs-lookup"><span data-stu-id="c43f7-132">Set the path for stored files (`StoredFilesPath`).</span></span>

   * <span data-ttu-id="c43f7-133">O aplicativo de exemplo define o valor como `c:\\files`, o que pressupõe que uma pasta chamada *files* existe na raiz da unidade C: do sistema.</span><span class="sxs-lookup"><span data-stu-id="c43f7-133">The sample app sets the value to `c:\\files`, which assumes that a folder named *files* exists at the system's C: drive root.</span></span>
   * <span data-ttu-id="c43f7-134">O caminho deve existir.</span><span class="sxs-lookup"><span data-stu-id="c43f7-134">The path must exist.</span></span> <span data-ttu-id="c43f7-135">Crie uma pasta *files* na unidade C: do sistema ou defina o caminho para um local adequado.</span><span class="sxs-lookup"><span data-stu-id="c43f7-135">Create a *files* folder on the system's C: drive or set the path to a suitable location.</span></span>
   * <span data-ttu-id="c43f7-136">O processo do aplicativo requer permissões de leitura/gravação para o caminho.</span><span class="sxs-lookup"><span data-stu-id="c43f7-136">The app's process requires read/write permissions to the path.</span></span>
   * <span data-ttu-id="c43f7-137">**FUNDAMENTAL!**</span><span class="sxs-lookup"><span data-stu-id="c43f7-137">**IMPORTANT!**</span></span> <span data-ttu-id="c43f7-138">Desabilite as permissões de execução para todos os usuários no caminho.</span><span class="sxs-lookup"><span data-stu-id="c43f7-138">Disable execute permissions for all users at the path.</span></span>

1. <span data-ttu-id="c43f7-139">Defina o limite de tamanho do arquivo (`FileSizeLimit`) em bytes.</span><span class="sxs-lookup"><span data-stu-id="c43f7-139">Set the file size limit (`FileSizeLimit`) in bytes.</span></span> <span data-ttu-id="c43f7-140">O valor padrão do aplicativo de exemplo de `2097152` (2.097.152 bytes) permite carregamentos de arquivo de até 2 MB.</span><span class="sxs-lookup"><span data-stu-id="c43f7-140">The sample app's default value of `2097152` (2,097,152 bytes) permits file uploads up to 2 MB.</span></span>
