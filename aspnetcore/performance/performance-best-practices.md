---
title: Práticas recomendadas de desempenho do ASP.NET Core
author: mjrousos
description: Dicas para aumentar o desempenho em aplicativos ASP.NET Core e evitar problemas comuns de desempenho.
monikerRange: '>= aspnetcore-2.1'
ms.author: riande
ms.date: 04/13/2019
uid: performance/performance-best-practices
ms.openlocfilehash: 28dc7fb40c1b60f643108dcb44593a08942a1650
ms.sourcegitcommit: dd9c73db7853d87b566eef136d2162f648a43b85
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 05/06/2019
ms.locfileid: "65087493"
---
# <a name="aspnet-core-performance-best-practices"></a><span data-ttu-id="7aa9e-103">Práticas recomendadas de desempenho do ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="7aa9e-103">ASP.NET Core Performance Best Practices</span></span>

<span data-ttu-id="7aa9e-104">Por [Mike Rousos](https://github.com/mjrousos)</span><span class="sxs-lookup"><span data-stu-id="7aa9e-104">By [Mike Rousos](https://github.com/mjrousos)</span></span>

<span data-ttu-id="7aa9e-105">Este tópico fornece diretrizes para desempenho, as práticas recomendadas com o ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-105">This topic provides guidelines for performance best practices with ASP.NET Core.</span></span>

<a name="hot"></a>

<span data-ttu-id="7aa9e-106">Neste documento, uma *caminho de código a quente* é definido como um caminho de código que é chamado com frequência e em que grande parte do tempo de execução ocorre.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-106">In this document, a *hot code path* is defined as a code path that is frequently called and where much of the execution time occurs.</span></span> <span data-ttu-id="7aa9e-107">Caminhos de código ativo normalmente limitam a expansão de aplicativo e o desempenho.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-107">Hot code paths typically limit app scale-out and performance.</span></span>

## <a name="cache-aggressively"></a><span data-ttu-id="7aa9e-108">Armazenar em cache agressivamente</span><span class="sxs-lookup"><span data-stu-id="7aa9e-108">Cache aggressively</span></span>

<span data-ttu-id="7aa9e-109">Armazenamento em cache é discutido em várias partes deste documento.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-109">Caching is discussed in several parts of this document.</span></span> <span data-ttu-id="7aa9e-110">Para obter mais informações, consulte <xref:performance/caching/response>.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-110">For more information, see <xref:performance/caching/response>.</span></span>

## <a name="avoid-blocking-calls"></a><span data-ttu-id="7aa9e-111">Evitar chamadas de bloqueio</span><span class="sxs-lookup"><span data-stu-id="7aa9e-111">Avoid blocking calls</span></span>

<span data-ttu-id="7aa9e-112">Aplicativos ASP.NET Core devem ser projetados para processar muitas solicitações simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-112">ASP.NET Core apps should be designed to process many requests simultaneously.</span></span> <span data-ttu-id="7aa9e-113">APIs assíncronas permitem que um pequeno pool de threads para lidar com milhares de solicitações simultâneas por não aguardando chamadas de bloqueio.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-113">Asynchronous APIs allow a small pool of threads to handle thousands of concurrent requests by not waiting on blocking calls.</span></span> <span data-ttu-id="7aa9e-114">Em vez de esperar em uma tarefa de longa execução síncrona para ser concluída, o thread pode trabalhar em outra solicitação.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-114">Rather than waiting on a long-running synchronous task to complete, the thread can work on another request.</span></span>

<span data-ttu-id="7aa9e-115">Um problema de desempenho comuns em aplicativos ASP.NET Core está bloqueando chamadas que poderiam ser assíncronas.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-115">A common performance problem in ASP.NET Core apps is blocking calls that could be asynchronous.</span></span> <span data-ttu-id="7aa9e-116">Gerar muitas chamadas de bloqueio síncronas [privação de Pool de threads](https://blogs.msdn.microsoft.com/vancem/2018/10/16/diagnosing-net-core-threadpool-starvation-with-perfview-why-my-service-is-not-saturating-all-cores-or-seems-to-stall/) e degradação de tempos de resposta.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-116">Many synchronous blocking calls lead to [Thread Pool starvation](https://blogs.msdn.microsoft.com/vancem/2018/10/16/diagnosing-net-core-threadpool-starvation-with-perfview-why-my-service-is-not-saturating-all-cores-or-seems-to-stall/) and degraded response times.</span></span>

<span data-ttu-id="7aa9e-117">**Não**:</span><span class="sxs-lookup"><span data-stu-id="7aa9e-117">**Do not**:</span></span>

* <span data-ttu-id="7aa9e-118">Bloquear a execução assíncrona chamando [Task. wait](/dotnet/api/system.threading.tasks.task.wait) ou [Task. Result](/dotnet/api/system.threading.tasks.task-1.result).</span><span class="sxs-lookup"><span data-stu-id="7aa9e-118">Block asynchronous execution by calling [Task.Wait](/dotnet/api/system.threading.tasks.task.wait) or [Task.Result](/dotnet/api/system.threading.tasks.task-1.result).</span></span>
* <span data-ttu-id="7aa9e-119">Adquira bloqueios em caminhos de código comum.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-119">Acquire locks in common code paths.</span></span> <span data-ttu-id="7aa9e-120">Aplicativos ASP.NET Core são mais eficazes quando projetado para executar código em paralelo.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-120">ASP.NET Core apps are most performant when architected to run code in parallel.</span></span>

<span data-ttu-id="7aa9e-121">**Fazer**:</span><span class="sxs-lookup"><span data-stu-id="7aa9e-121">**Do**:</span></span>

* <span data-ttu-id="7aa9e-122">Tornar [hot caminhos de código](#hot) assíncrona.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-122">Make [hot code paths](#hot) asynchronous.</span></span>
* <span data-ttu-id="7aa9e-123">Chame APIs de operações de longa execução e de acesso a dados de forma assíncrona.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-123">Call data access and long-running operations APIs asynchronously.</span></span>
* <span data-ttu-id="7aa9e-124">Tornar o controlador/Razor ações de página assíncrono.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-124">Make controller/Razor Page actions asynchronous.</span></span> <span data-ttu-id="7aa9e-125">A pilha de chamadas inteira é assíncrona para se beneficiar da [async/await](/dotnet/csharp/programming-guide/concepts/async/) padrões.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-125">The entire call stack is asynchronous in order to benefit from [async/await](/dotnet/csharp/programming-guide/concepts/async/) patterns.</span></span>

<span data-ttu-id="7aa9e-126">Um criador de perfil, como [PerfView](https://github.com/Microsoft/perfview), pode ser usado para localizar segmentos adicionados com frequência para o [Pool de threads](/windows/desktop/procthread/thread-pools).</span><span class="sxs-lookup"><span data-stu-id="7aa9e-126">A profiler, such as [PerfView](https://github.com/Microsoft/perfview), can be used to find threads frequently added to the [Thread Pool](/windows/desktop/procthread/thread-pools).</span></span> <span data-ttu-id="7aa9e-127">O `Microsoft-Windows-DotNETRuntime/ThreadPoolWorkerThread/Start` evento indica que um thread adicionado ao pool de threads.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-127">The `Microsoft-Windows-DotNETRuntime/ThreadPoolWorkerThread/Start` event indicates a thread added to the thread pool.</span></span> <!--  For more information, see [async guidance docs](TBD-Link_To_Davifowl_Doc  -->

## <a name="minimize-large-object-allocations"></a><span data-ttu-id="7aa9e-128">Minimizar as alocações de objeto grande</span><span class="sxs-lookup"><span data-stu-id="7aa9e-128">Minimize large object allocations</span></span>

<!-- TODO review Bill - replaced original .NET language below with .NET Core since this targets .NET Core -->
<span data-ttu-id="7aa9e-129">O [coletor de lixo do .NET Core](/dotnet/standard/garbage-collection/) gerencia a alocação e liberação de memória automaticamente em aplicativos ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-129">The [.NET Core garbage collector](/dotnet/standard/garbage-collection/) manages allocation and release of memory automatically in ASP.NET Core apps.</span></span> <span data-ttu-id="7aa9e-130">Coleta de lixo automática geralmente significa que os desenvolvedores não precisam se preocupar sobre como ou quando a memória é liberada.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-130">Automatic garbage collection generally means that developers don't need to worry about how or when memory is freed.</span></span> <span data-ttu-id="7aa9e-131">No entanto, limpeza de objetos não referenciados leva tempo de CPU, portanto, os desenvolvedores devem minimizar alocando objetos no [hot caminhos de código](#hot).</span><span class="sxs-lookup"><span data-stu-id="7aa9e-131">However, cleaning up unreferenced objects takes CPU time, so developers should minimize allocating objects in [hot code paths](#hot).</span></span> <span data-ttu-id="7aa9e-132">Coleta de lixo é especialmente dispendiosa em objetos grandes (> 85 mil bytes).</span><span class="sxs-lookup"><span data-stu-id="7aa9e-132">Garbage collection is especially expensive on large objects (> 85 K bytes).</span></span> <span data-ttu-id="7aa9e-133">Objetos grandes são armazenados na [heap de objeto grande](/dotnet/standard/garbage-collection/large-object-heap) e exigem uma completa (geração 2) a coleta de lixo para limpar.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-133">Large objects are stored on the [large object heap](/dotnet/standard/garbage-collection/large-object-heap) and require a full (generation 2) garbage collection to clean up.</span></span> <span data-ttu-id="7aa9e-134">Ao contrário de geração 0 e coletas da geração 1, uma coleta de geração 2 requer uma suspensão temporária da execução do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-134">Unlike generation 0 and generation 1 collections, a generation 2 collection requires a temporary suspension of app execution.</span></span> <span data-ttu-id="7aa9e-135">Frequente alocação e desalocação de objetos grandes podem causar inconsistência do desempenho.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-135">Frequent allocation and de-allocation of large objects can cause inconsistent performance.</span></span>

<span data-ttu-id="7aa9e-136">Recomendações:</span><span class="sxs-lookup"><span data-stu-id="7aa9e-136">Recommendations:</span></span>

* <span data-ttu-id="7aa9e-137">**Fazer** armazenar em cache os objetos grandes que são usados com frequência.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-137">**Do** consider caching large objects that are frequently used.</span></span> <span data-ttu-id="7aa9e-138">O cache de objetos grandes evita alocações caras.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-138">Caching large objects prevents expensive allocations.</span></span>
* <span data-ttu-id="7aa9e-139">**Fazer** pool de buffers usando um [ `ArrayPool<T>` ](/dotnet/api/system.buffers.arraypool-1) para armazenar as matrizes grandes.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-139">**Do** pool buffers by using an [`ArrayPool<T>`](/dotnet/api/system.buffers.arraypool-1) to store large arrays.</span></span>
* <span data-ttu-id="7aa9e-140">**Não o fazem** alocar curta duração, muitos objetos grandes na [hot caminhos de código](#hot).</span><span class="sxs-lookup"><span data-stu-id="7aa9e-140">**Do not** allocate many, short-lived large objects on [hot code paths](#hot).</span></span>

<span data-ttu-id="7aa9e-141">Problemas de memória, como descrito acima, podem ser diagnosticados ao examinar estatísticas de (GC) coleta de lixo na [PerfView](https://github.com/Microsoft/perfview) e examinando:</span><span class="sxs-lookup"><span data-stu-id="7aa9e-141">Memory issues, such as the preceding, can be diagnosed by reviewing garbage collection (GC) stats in [PerfView](https://github.com/Microsoft/perfview) and examining:</span></span>

* <span data-ttu-id="7aa9e-142">Tempo de pausa da coleta de lixo.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-142">Garbage collection pause time.</span></span>
* <span data-ttu-id="7aa9e-143">Qual é a porcentagem do tempo do processador é gasto na coleta de lixo.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-143">What percentage of the processor time is spent in garbage collection.</span></span>
* <span data-ttu-id="7aa9e-144">Quantas coletas de lixo são a geração 0, 1 e 2.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-144">How many garbage collections are generation 0, 1, and 2.</span></span>

<span data-ttu-id="7aa9e-145">Para obter mais informações, consulte [coleta de lixo e desempenho](/dotnet/standard/garbage-collection/performance).</span><span class="sxs-lookup"><span data-stu-id="7aa9e-145">For more information, see [Garbage Collection and Performance](/dotnet/standard/garbage-collection/performance).</span></span>

## <a name="optimize-data-access"></a><span data-ttu-id="7aa9e-146">Otimizar o acesso a dados</span><span class="sxs-lookup"><span data-stu-id="7aa9e-146">Optimize Data Access</span></span>

<span data-ttu-id="7aa9e-147">Interações com um armazenamento de dados e outros serviços remotos geralmente são as partes mais lentas de um aplicativo ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-147">Interactions with a data store and other remote services are often the slowest parts of an ASP.NET Core app.</span></span> <span data-ttu-id="7aa9e-148">Ler e gravar dados com eficiência é essencial para um bom desempenho.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-148">Reading and writing data efficiently is critical for good performance.</span></span>

<span data-ttu-id="7aa9e-149">Recomendações:</span><span class="sxs-lookup"><span data-stu-id="7aa9e-149">Recommendations:</span></span>

* <span data-ttu-id="7aa9e-150">**Fazer** chamar APIs de acesso a todos os dados de forma assíncrona.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-150">**Do** call all data access APIs asynchronously.</span></span>
* <span data-ttu-id="7aa9e-151">**Não** recuperar mais dados do que é necessário.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-151">**Do not** retrieve more data than is necessary.</span></span> <span data-ttu-id="7aa9e-152">Escreva consultas para retornar apenas os dados que é necessários para a solicitação HTTP atual.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-152">Write queries to return just the data that's necessary for the current HTTP request.</span></span>
* <span data-ttu-id="7aa9e-153">**Fazer** considerar o cache frequente acessados os dados recuperados do banco de dados ou serviço remoto se um pouco desatualizados dados forem aceitáveis.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-153">**Do** consider caching frequently accessed data retrieved from a database or remote service if slightly out-of-date data is acceptable.</span></span> <span data-ttu-id="7aa9e-154">Dependendo do cenário, use uma [MemoryCache](xref:performance/caching/memory) ou um [DistributedCache](xref:performance/caching/distributed).</span><span class="sxs-lookup"><span data-stu-id="7aa9e-154">Depending on the scenario, use a [MemoryCache](xref:performance/caching/memory) or a [DistributedCache](xref:performance/caching/distributed).</span></span> <span data-ttu-id="7aa9e-155">Para obter mais informações, consulte <xref:performance/caching/response>.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-155">For more information, see <xref:performance/caching/response>.</span></span>
* <span data-ttu-id="7aa9e-156">**Fazer** minimizar viagens de ida e volta de rede.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-156">**Do** minimize network round trips.</span></span> <span data-ttu-id="7aa9e-157">O objetivo é recuperar os dados necessários em uma única chamada em vez de várias chamadas.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-157">The goal is to retrieve the required data in a single call rather than several calls.</span></span>
* <span data-ttu-id="7aa9e-158">**Fazer** usar [consultas sem controle](/ef/core/querying/tracking#no-tracking-queries) no Entity Framework Core ao acessar dados para propósitos de somente leitura.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-158">**Do** use [no-tracking queries](/ef/core/querying/tracking#no-tracking-queries) in Entity Framework Core when accessing data for read-only purposes.</span></span> <span data-ttu-id="7aa9e-159">O EF Core pode retornar os resultados de consultas sem controle com mais eficiência.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-159">EF Core can return the results of no-tracking queries more efficiently.</span></span>
* <span data-ttu-id="7aa9e-160">**Fazer** filtro e consultas de agregação LINQ (com `.Where`, `.Select`, ou `.Sum` instruções, por exemplo) para que a filtragem é executada pelo banco de dados.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-160">**Do** filter and aggregate LINQ queries (with `.Where`, `.Select`, or `.Sum` statements, for example) so that the filtering is performed by the database.</span></span>
* <span data-ttu-id="7aa9e-161">**Fazer** considerar que o EF Core resolve alguns operadores de consulta no cliente, que pode levar à execução de consulta ineficiente.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-161">**Do** consider that EF Core resolves some query operators on the client, which may lead to inefficient query execution.</span></span> <span data-ttu-id="7aa9e-162">Para obter mais informações, consulte [problemas de desempenho de avaliação do cliente](/ef/core/querying/client-eval#client-evaluation-performance-issues).</span><span class="sxs-lookup"><span data-stu-id="7aa9e-162">For more information, see [Client evaluation performance issues](/ef/core/querying/client-eval#client-evaluation-performance-issues).</span></span>
* <span data-ttu-id="7aa9e-163">**Não** usar consultas de projeção em coleções, que podem resultar na execução de "N + 1" consultas SQL.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-163">**Do not** use projection queries on collections, which can result in executing "N + 1" SQL queries.</span></span> <span data-ttu-id="7aa9e-164">Para obter mais informações, consulte [otimização de subconsultas correlacionadas](/ef/core/what-is-new/ef-core-2.1#optimization-of-correlated-subqueries).</span><span class="sxs-lookup"><span data-stu-id="7aa9e-164">For more information, see [Optimization of correlated subqueries](/ef/core/what-is-new/ef-core-2.1#optimization-of-correlated-subqueries).</span></span>

<span data-ttu-id="7aa9e-165">Ver [EF alto desempenho](/ef/core/what-is-new/ef-core-2.0#explicitly-compiled-queries) para abordagens que podem melhorar o desempenho em aplicativos de alta escala:</span><span class="sxs-lookup"><span data-stu-id="7aa9e-165">See [EF High Performance](/ef/core/what-is-new/ef-core-2.0#explicitly-compiled-queries) for approaches that may improve performance in high-scale apps:</span></span>

* [<span data-ttu-id="7aa9e-166">Pool de DbContext</span><span class="sxs-lookup"><span data-stu-id="7aa9e-166">DbContext pooling</span></span>](/ef/core/what-is-new/ef-core-2.0#dbcontext-pooling)
* [<span data-ttu-id="7aa9e-167">Consultas explicitamente compiladas</span><span class="sxs-lookup"><span data-stu-id="7aa9e-167">Explicitly compiled queries</span></span>](/ef/core/what-is-new/ef-core-2.0#explicitly-compiled-queries)

<span data-ttu-id="7aa9e-168">É recomendável medindo o impacto das abordagens de alto desempenho anteriores antes de confirmar a base de código.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-168">We recommend measuring the impact of the preceding high-performance approaches before committing the code base.</span></span> <span data-ttu-id="7aa9e-169">A complexidade adicional de consultas compiladas pode não justificar a melhoria de desempenho.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-169">The additional complexity of compiled queries may not justify the performance improvement.</span></span>

<span data-ttu-id="7aa9e-170">Consulta problemas podem ser detectados, examinando o tempo gasto acesso a dados com [Application Insights](/azure/application-insights/app-insights-overview) ou com ferramentas de criação de perfil.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-170">Query issues can be detected by reviewing the time spent accessing data with [Application Insights](/azure/application-insights/app-insights-overview) or with profiling tools.</span></span> <span data-ttu-id="7aa9e-171">A maioria dos bancos de dados também disponibilizar as estatísticas relacionadas a consultas executadas com frequência.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-171">Most databases also make statistics available concerning frequently executed queries.</span></span>

## <a name="pool-http-connections-with-httpclientfactory"></a><span data-ttu-id="7aa9e-172">HTTP do pool de conexões com HttpClientFactory</span><span class="sxs-lookup"><span data-stu-id="7aa9e-172">Pool HTTP connections with HttpClientFactory</span></span>

<span data-ttu-id="7aa9e-173">Embora [HttpClient](/dotnet/api/system.net.http.httpclient) implementa o `IDisposable` interface, ele é projetado para reutilização.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-173">Although [HttpClient](/dotnet/api/system.net.http.httpclient) implements the `IDisposable` interface, it's designed for reuse.</span></span> <span data-ttu-id="7aa9e-174">Fechado `HttpClient` instâncias deixe soquetes abertos no `TIME_WAIT` estado por um curto período de tempo.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-174">Closed `HttpClient` instances leave sockets open in the `TIME_WAIT` state for a short period of time.</span></span> <span data-ttu-id="7aa9e-175">Se um caminho de código que cria e descarta `HttpClient` objetos é usado com frequência, o aplicativo pode esgotar soquetes disponíveis.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-175">If a code path that creates and disposes of `HttpClient` objects is frequently used, the app may exhaust available sockets.</span></span> <span data-ttu-id="7aa9e-176">[HttpClientFactory](/dotnet/standard/microservices-architecture/implement-resilient-applications/use-httpclientfactory-to-implement-resilient-http-requests) foi introduzido no ASP.NET Core 2.1 como uma solução para esse problema.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-176">[HttpClientFactory](/dotnet/standard/microservices-architecture/implement-resilient-applications/use-httpclientfactory-to-implement-resilient-http-requests) was introduced in ASP.NET Core 2.1 as a solution to this problem.</span></span> <span data-ttu-id="7aa9e-177">Ele lida com o pooling de conexões de HTTP para otimizar o desempenho e confiabilidade.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-177">It handles pooling HTTP connections to optimize performance and reliability.</span></span>

<span data-ttu-id="7aa9e-178">Recomendações:</span><span class="sxs-lookup"><span data-stu-id="7aa9e-178">Recommendations:</span></span>

* <span data-ttu-id="7aa9e-179">**Não o fazem** criar e descartar `HttpClient` instâncias diretamente.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-179">**Do not** create and dispose of `HttpClient` instances directly.</span></span>
* <span data-ttu-id="7aa9e-180">**Fazer** usar [HttpClientFactory](/dotnet/standard/microservices-architecture/implement-resilient-applications/use-httpclientfactory-to-implement-resilient-http-requests) recuperar `HttpClient` instâncias.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-180">**Do** use [HttpClientFactory](/dotnet/standard/microservices-architecture/implement-resilient-applications/use-httpclientfactory-to-implement-resilient-http-requests) to retrieve `HttpClient` instances.</span></span> <span data-ttu-id="7aa9e-181">Para obter mais informações, consulte [HttpClientFactory de uso para implementar as solicitações HTTP resilientes](/dotnet/standard/microservices-architecture/implement-resilient-applications/use-httpclientfactory-to-implement-resilient-http-requests).</span><span class="sxs-lookup"><span data-stu-id="7aa9e-181">For more information, see [Use HttpClientFactory to implement resilient HTTP requests](/dotnet/standard/microservices-architecture/implement-resilient-applications/use-httpclientfactory-to-implement-resilient-http-requests).</span></span>

## <a name="keep-common-code-paths-fast"></a><span data-ttu-id="7aa9e-182">Manter os caminhos de código comuns rápidos</span><span class="sxs-lookup"><span data-stu-id="7aa9e-182">Keep common code paths fast</span></span>

<span data-ttu-id="7aa9e-183">Você deseja que todos os seus códigos a ser rápido, com frequência chamado caminhos de código são mais importantes para otimizar:</span><span class="sxs-lookup"><span data-stu-id="7aa9e-183">You want all of your code to be fast, frequently called code paths are the most critical to optimize:</span></span>

* <span data-ttu-id="7aa9e-184">Componentes de middleware no pipeline de processamento de solicitação do aplicativo, especialmente middleware executado no início do pipeline.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-184">Middleware components in the app's request processing pipeline, especially middleware run early in the pipeline.</span></span> <span data-ttu-id="7aa9e-185">Esses componentes têm um grande impacto no desempenho.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-185">These components have a large impact on performance.</span></span>
* <span data-ttu-id="7aa9e-186">Código que é executado para cada solicitação ou várias vezes por solicitação.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-186">Code that's executed for every request or multiple times per request.</span></span> <span data-ttu-id="7aa9e-187">Por exemplo, registro em log personalizado, manipuladores de autorização ou inicialização de serviços temporários.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-187">For example, custom logging, authorization handlers, or initialization of transient services.</span></span>

<span data-ttu-id="7aa9e-188">Recomendações:</span><span class="sxs-lookup"><span data-stu-id="7aa9e-188">Recommendations:</span></span>

* <span data-ttu-id="7aa9e-189">**Não** usar componentes de middleware personalizado com tarefas de longa execução.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-189">**Do not** use custom middleware components with long-running tasks.</span></span>
* <span data-ttu-id="7aa9e-190">**Fazer** usar ferramentas de criação de perfil, como de desempenho [ferramentas de diagnóstico Visual Studio](/visualstudio/profiling/profiling-feature-tour) ou [PerfView](https://github.com/Microsoft/perfview)), para identificar [hot caminhos de código](#hot).</span><span class="sxs-lookup"><span data-stu-id="7aa9e-190">**Do** use performance profiling tools, such as [Visual Studio Diagnostic Tools](/visualstudio/profiling/profiling-feature-tour) or [PerfView](https://github.com/Microsoft/perfview)), to identify [hot code paths](#hot).</span></span>

## <a name="complete-long-running-tasks-outside-of-http-requests"></a><span data-ttu-id="7aa9e-191">Concluir tarefas de execução longa fora de solicitações HTTP</span><span class="sxs-lookup"><span data-stu-id="7aa9e-191">Complete long-running Tasks outside of HTTP requests</span></span>

<span data-ttu-id="7aa9e-192">A maioria das solicitações para um aplicativo ASP.NET Core podem ser tratadas por um controlador ou o modelo de página chamando serviços necessários e retornando uma resposta HTTP.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-192">Most requests to an ASP.NET Core app can be handled by a controller or page model calling necessary services and returning an HTTP response.</span></span> <span data-ttu-id="7aa9e-193">Para algumas solicitações que envolvem tarefas de longa execução, é melhor tornar o processo de solicitação-resposta inteira assíncrona.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-193">For some requests that involve long-running tasks, it's better to make the entire request-response process asynchronous.</span></span>

<span data-ttu-id="7aa9e-194">Recomendações:</span><span class="sxs-lookup"><span data-stu-id="7aa9e-194">Recommendations:</span></span>

* <span data-ttu-id="7aa9e-195">**Não** Aguarde até que as tarefas de longa execução ser concluída como parte do processamento de solicitação HTTP comuns.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-195">**Do not** wait for long-running tasks to complete as part of ordinary HTTP request processing.</span></span>
* <span data-ttu-id="7aa9e-196">**Fazer** considere a manipulação de solicitações de execução longa com [serviços em segundo plano](xref:fundamentals/host/hosted-services) ou fora do processo com um [Azure Function](/azure/azure-functions/).</span><span class="sxs-lookup"><span data-stu-id="7aa9e-196">**Do** consider handling long-running requests with [background services](xref:fundamentals/host/hosted-services) or out of process with an [Azure Function](/azure/azure-functions/).</span></span> <span data-ttu-id="7aa9e-197">A conclusão do trabalho fora do processo é especialmente útil para tarefas de uso intensivo de CPU.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-197">Completing work out-of-process is especially beneficial for CPU-intensive tasks.</span></span>
* <span data-ttu-id="7aa9e-198">**Fazer** usar opções de comunicação em tempo real, como [SignalR](xref:signalr/introduction), para se comunicar com clientes de forma assíncrona.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-198">**Do** use real-time communication options, such as [SignalR](xref:signalr/introduction), to communicate with clients asynchronously.</span></span>

## <a name="minify-client-assets"></a><span data-ttu-id="7aa9e-199">Minificar ativos do cliente</span><span class="sxs-lookup"><span data-stu-id="7aa9e-199">Minify client assets</span></span>

<span data-ttu-id="7aa9e-200">Aplicativos ASP.NET Core com front-ends complexos com frequência servem muitos JavaScript, CSS ou arquivos de imagem.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-200">ASP.NET Core apps with complex front-ends frequently serve many JavaScript, CSS, or image files.</span></span> <span data-ttu-id="7aa9e-201">Desempenho de solicitações de carga inicial pode ser melhorado por:</span><span class="sxs-lookup"><span data-stu-id="7aa9e-201">Performance of initial load requests can be improved by:</span></span>

* <span data-ttu-id="7aa9e-202">O agrupamento, que combina vários arquivos em um.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-202">Bundling, which combines multiple files into one.</span></span>
* <span data-ttu-id="7aa9e-203">Minificação, que reduz o tamanho dos arquivos, removendo o espaço em branco e comentários.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-203">Minifying, which reduces the size of files by removing whitespace and comments.</span></span>

<span data-ttu-id="7aa9e-204">Recomendações:</span><span class="sxs-lookup"><span data-stu-id="7aa9e-204">Recommendations:</span></span>

* <span data-ttu-id="7aa9e-205">**Fazer** usar o ASP.NET Core [suporte interno](xref:client-side/bundling-and-minification) para agrupamento e minificação de ativos de cliente.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-205">**Do** use ASP.NET Core's [built-in support](xref:client-side/bundling-and-minification) for bundling and minifying client assets.</span></span>
* <span data-ttu-id="7aa9e-206">**Fazer** considerar outras ferramentas de terceiros, como [Gulp](xref:client-side/using-gulp) ou [Webpack](https://webpack.js.org/) para gerenciamento de ativos de cliente complexo.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-206">**Do** consider other third-party tools, such as [Gulp](xref:client-side/using-gulp) or [Webpack](https://webpack.js.org/) for complex client asset management.</span></span>

## <a name="compress-responses"></a><span data-ttu-id="7aa9e-207">Compactar respostas</span><span class="sxs-lookup"><span data-stu-id="7aa9e-207">Compress responses</span></span>

 <span data-ttu-id="7aa9e-208">Reduzindo o tamanho da resposta geralmente aumenta a capacidade de resposta de um aplicativo, muitas vezes drasticamente.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-208">Reducing the size of the response usually increases the responsiveness of an app, often dramatically.</span></span> <span data-ttu-id="7aa9e-209">É uma maneira de reduzir os tamanhos do conteúdo compactar respostas do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-209">One way to reduce payload sizes is to compress an app's responses.</span></span> <span data-ttu-id="7aa9e-210">Para obter mais informações, consulte [compactação de resposta](xref:performance/response-compression).</span><span class="sxs-lookup"><span data-stu-id="7aa9e-210">For more information, see [Response compression](xref:performance/response-compression).</span></span>

## <a name="use-the-latest-aspnet-core-release"></a><span data-ttu-id="7aa9e-211">Use a versão mais recente do ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="7aa9e-211">Use the latest ASP.NET Core release</span></span>

<span data-ttu-id="7aa9e-212">Cada nova versão do ASP.NET Core inclui aprimoramentos de desempenho.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-212">Each new release of ASP.NET Core includes performance improvements.</span></span> <span data-ttu-id="7aa9e-213">Otimizações no .NET Core e ASP.NET Core significam que versões mais recentes geralmente superam as versões mais antigas.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-213">Optimizations in .NET Core and ASP.NET Core mean that newer versions generally outperform older versions.</span></span> <span data-ttu-id="7aa9e-214">Por exemplo, o .NET Core 2.1 adicionado suporte para expressões regulares compiladas e se beneficiaram [ `Span<T>` ](https://msdn.microsoft.com/magazine/mt814808.aspx).</span><span class="sxs-lookup"><span data-stu-id="7aa9e-214">For example, .NET Core 2.1 added support for compiled regular expressions and benefitted from [`Span<T>`](https://msdn.microsoft.com/magazine/mt814808.aspx).</span></span> <span data-ttu-id="7aa9e-215">Suporte do ASP.NET Core 2.2 adicionado para HTTP/2.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-215">ASP.NET Core 2.2 added support for HTTP/2.</span></span> <span data-ttu-id="7aa9e-216">Se o desempenho for uma prioridade, considere atualizar para a versão atual do ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-216">If performance is a priority, consider upgrading to the current version of ASP.NET Core.</span></span>

<!-- TODO review link and taking advantage of new [performance features](#TBD)
Maybe skip this TBD link as each version will have perf improvements -->

## <a name="minimize-exceptions"></a><span data-ttu-id="7aa9e-217">Minimizar as exceções</span><span class="sxs-lookup"><span data-stu-id="7aa9e-217">Minimize exceptions</span></span>

<span data-ttu-id="7aa9e-218">As exceções devem ser raras.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-218">Exceptions should be rare.</span></span> <span data-ttu-id="7aa9e-219">Lançar e capturar exceções são lento em relação a outros padrões de fluxo de código.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-219">Throwing and catching exceptions is slow relative to other code flow patterns.</span></span> <span data-ttu-id="7aa9e-220">Por isso, as exceções não devem ser usadas para controlar o fluxo normal do programa.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-220">Because of this, exceptions shouldn't be used to control normal program flow.</span></span>

<span data-ttu-id="7aa9e-221">Recomendações:</span><span class="sxs-lookup"><span data-stu-id="7aa9e-221">Recommendations:</span></span>

* <span data-ttu-id="7aa9e-222">**Não o fazem** uso gerar ou capturar exceções como um meio de fluxo normal do programa, especialmente em [hot caminhos de código](#hot).</span><span class="sxs-lookup"><span data-stu-id="7aa9e-222">**Do not** use throwing or catching exceptions as a means of normal program flow, especially in [hot code paths](#hot).</span></span>
* <span data-ttu-id="7aa9e-223">**Fazer** incluir lógica no aplicativo para detectar e lidar com condições que poderiam causar uma exceção.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-223">**Do** include logic in the app to detect and handle conditions that would cause an exception.</span></span>
* <span data-ttu-id="7aa9e-224">**Fazer** lançar ou capturar exceções para condições incomuns ou inesperadas.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-224">**Do** throw or catch exceptions for unusual or unexpected conditions.</span></span>

<span data-ttu-id="7aa9e-225">Ferramentas de diagnóstico do aplicativo, como o Application Insights podem ajudar a identificar exceções comuns em um aplicativo que pode afetar o desempenho.</span><span class="sxs-lookup"><span data-stu-id="7aa9e-225">App diagnostic tools, such as Application Insights, can help to identify common exceptions in an app that may affect performance.</span></span>
