---
title: Middleware de Reconfiguração de URL no ASP.NET Core
author: rick-anderson
description: Saiba mais sobre a reconfiguração de URL e o redirecionamento com o Middleware de Reconfiguração de URL em aplicativos ASP.NET Core.
monikerRange: '>= aspnetcore-2.1'
ms.author: riande
ms.custom: mvc
ms.date: 08/16/2019
no-loc:
- Blazor
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: fundamentals/url-rewriting
ms.openlocfilehash: 9e12831f57af02cd427d2a66d9d4c4d654905106
ms.sourcegitcommit: 70e5f982c218db82aa54aa8b8d96b377cfc7283f
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 05/04/2020
ms.locfileid: "82774854"
---
# <a name="url-rewriting-middleware-in-aspnet-core"></a><span data-ttu-id="bb0c3-103">Middleware de Reconfiguração de URL no ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="bb0c3-103">URL Rewriting Middleware in ASP.NET Core</span></span>

<span data-ttu-id="bb0c3-104">Por [Mikael Mengistu](https://github.com/mikaelm12)</span><span class="sxs-lookup"><span data-stu-id="bb0c3-104">By [Mikael Mengistu](https://github.com/mikaelm12)</span></span>

::: moniker range=">= aspnetcore-3.0"

<span data-ttu-id="bb0c3-105">Este documento apresenta a reconfiguração de URL com instruções sobre como usar o Middleware de Reconfiguração de URL em aplicativos ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-105">This document introduces URL rewriting with instructions on how to use URL Rewriting Middleware in ASP.NET Core apps.</span></span>

<span data-ttu-id="bb0c3-106">A reconfiguração de URL é o ato de modificar URLs de solicitação com base em uma ou mais regras predefinidas.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-106">URL rewriting is the act of modifying request URLs based on one or more predefined rules.</span></span> <span data-ttu-id="bb0c3-107">A reconfiguração de URL cria uma abstração entre locais de recursos e seus endereços, de forma que os locais e os endereços não estejam totalmente vinculados.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-107">URL rewriting creates an abstraction between resource locations and their addresses so that the locations and addresses aren't tightly linked.</span></span> <span data-ttu-id="bb0c3-108">A reconfiguração de URL é útil em vários cenários para:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-108">URL rewriting is valuable in several scenarios to:</span></span>

* <span data-ttu-id="bb0c3-109">Mover ou substituir recursos de servidor temporária ou permanentemente e manter localizadores estáveis para esses recursos.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-109">Move or replace server resources temporarily or permanently and maintain stable locators for those resources.</span></span>
* <span data-ttu-id="bb0c3-110">Dividir o processamento de solicitação entre diferentes aplicativos ou áreas de um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-110">Split request processing across different apps or across areas of one app.</span></span>
* <span data-ttu-id="bb0c3-111">Remover, adicionar ou reorganizar segmentos de URL em solicitações de entrada.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-111">Remove, add, or reorganize URL segments on incoming requests.</span></span>
* <span data-ttu-id="bb0c3-112">Otimizar URLs públicas para SEO (Otimização do Mecanismo de Pesquisa).</span><span class="sxs-lookup"><span data-stu-id="bb0c3-112">Optimize public URLs for Search Engine Optimization (SEO).</span></span>
* <span data-ttu-id="bb0c3-113">Permitir o uso de URLs públicas amigáveis para ajudar os visitantes a prever o conteúdo retornado ao solicitar um recurso.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-113">Permit the use of friendly public URLs to help visitors predict the content returned by requesting a resource.</span></span>
* <span data-ttu-id="bb0c3-114">Redirecionar solicitações não seguras para pontos de extremidade seguros.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-114">Redirect insecure requests to secure endpoints.</span></span>
* <span data-ttu-id="bb0c3-115">Impedir o hotlink, em que um site externo usa um ativo estático hospedado em outro site vinculando o ativo ao seu próprio conteúdo.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-115">Prevent hotlinking, where an external site uses a hosted static asset on another site by linking the asset into its own content.</span></span>

> [!NOTE]
> <span data-ttu-id="bb0c3-116">A reconfiguração de URL pode reduzir o desempenho de um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-116">URL rewriting can reduce the performance of an app.</span></span> <span data-ttu-id="bb0c3-117">Sempre que possível, limite o número e a complexidade das regras.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-117">Where feasible, limit the number and complexity of rules.</span></span>

<span data-ttu-id="bb0c3-118">[Exibir ou baixar código de exemplo](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/) ([como baixar](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="bb0c3-118">[View or download sample code](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="url-redirect-and-url-rewrite"></a><span data-ttu-id="bb0c3-119">Redirecionamento e reconfiguração de URL</span><span class="sxs-lookup"><span data-stu-id="bb0c3-119">URL redirect and URL rewrite</span></span>

<span data-ttu-id="bb0c3-120">A diferença entre os termos *redirecionamento de URL* e *reconfiguração de URL* é sutil, mas tem implicações importantes no fornecimento de recursos aos clientes.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-120">The difference in wording between *URL redirect* and *URL rewrite* is subtle but has important implications for providing resources to clients.</span></span> <span data-ttu-id="bb0c3-121">O Middleware de Reconfiguração de URL do ASP.NET Core pode atender às necessidades de ambos.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-121">ASP.NET Core's URL Rewriting Middleware is capable of meeting the need for both.</span></span>

<span data-ttu-id="bb0c3-122">Um *redirecionamento de URL* envolve uma operação do lado do cliente, em que o cliente é instruído a acessar um recurso em um endereço diferente do que ele solicitou originalmente.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-122">A *URL redirect* involves a client-side operation, where the client is instructed to access a resource at a different address than the client originally requested.</span></span> <span data-ttu-id="bb0c3-123">Isso exige uma viagem de ida e volta para o servidor.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-123">This requires a round trip to the server.</span></span> <span data-ttu-id="bb0c3-124">A URL de redirecionamento retornada para o cliente é exibida na barra de endereços do navegador quando o cliente faz uma nova solicitação para o recurso.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-124">The redirect URL returned to the client appears in the browser's address bar when the client makes a new request for the resource.</span></span>

<span data-ttu-id="bb0c3-125">Se `/resource` é *redirecionado* para `/different-resource`, o servidor responde que o cliente deve obter o recurso em `/different-resource` com um código de status indicando que o redirecionamento é temporário ou permanente.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-125">If `/resource` is *redirected* to `/different-resource`, the server responds that the client should obtain the resource at `/different-resource` with a status code indicating that the redirect is either temporary or permanent.</span></span>

![Um ponto de extremidade de serviço WebAPI foi alterado temporariamente da versão 1 (v1) para a versão 2 (v2) no servidor.](url-rewriting/_static/url_redirect.png)

<span data-ttu-id="bb0c3-131">Ao redirecionar solicitações para uma URL diferente, indique se o redirecionamento é permanente ou temporário especificando o código de status com a resposta:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-131">When redirecting requests to a different URL, indicate whether the redirect is permanent or temporary by specifying the status code with the response:</span></span>

* <span data-ttu-id="bb0c3-132">O código de status *301 – Movido Permanentemente* é usado quando o recurso tem uma nova URL permanente e você deseja instruir o cliente que todas as solicitações futuras para o recurso devem usar a nova URL.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-132">The *301 - Moved Permanently* status code is used where the resource has a new, permanent URL and you wish to instruct the client that all future requests for the resource should use the new URL.</span></span> <span data-ttu-id="bb0c3-133">*O cliente pode armazenar a resposta em cache e reutilizá-la quando um código de status 301 é recebido.*</span><span class="sxs-lookup"><span data-stu-id="bb0c3-133">*The client may cache and reuse the response when a 301 status code is received.*</span></span>

* <span data-ttu-id="bb0c3-134">O código de status *302 – Encontrado* é usado quando o redirecionamento é temporário ou está geralmente sujeito a alterações.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-134">The *302 - Found* status code is used where the redirection is temporary or generally subject to change.</span></span> <span data-ttu-id="bb0c3-135">O código de status 302 indica para o cliente não armazenar a URL e usá-la no futuro.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-135">The 302 status code indicates to the client not to store the URL and use it in the future.</span></span>

<span data-ttu-id="bb0c3-136">Para obter mais informações sobre códigos de status, confira [RFC 2616: definições de código de status](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html).</span><span class="sxs-lookup"><span data-stu-id="bb0c3-136">For more information on status codes, see [RFC 2616: Status Code Definitions](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html).</span></span>

<span data-ttu-id="bb0c3-137">Uma *reconfiguração de URL* é uma operação do servidor que fornece um recurso de um endereço de recurso diferente do que o solicitado pelo cliente.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-137">A *URL rewrite* is a server-side operation that provides a resource from a different resource address than the client requested.</span></span> <span data-ttu-id="bb0c3-138">A reconfiguração de uma URL não exige uma viagem de ida e volta para o servidor.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-138">Rewriting a URL doesn't require a round trip to the server.</span></span> <span data-ttu-id="bb0c3-139">A URL reconfigurada não é retornada para o cliente e não é exibida na barra de endereços do navegador.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-139">The rewritten URL isn't returned to the client and doesn't appear in the browser's address bar.</span></span>

<span data-ttu-id="bb0c3-140">Se `/resource` é *reconfigurado* como `/different-resource`, o servidor efetua fetch *internamente* e retorna o recurso em `/different-resource`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-140">If `/resource` is *rewritten* to `/different-resource`, the server *internally* fetches and returns the resource at `/different-resource`.</span></span>

<span data-ttu-id="bb0c3-141">Embora o cliente possa ter a capacidade de recuperar o recurso na URL reconfigurada, ele não é informado de que o recurso existe na URL reconfigurada ao fazer a solicitação e receber a resposta.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-141">Although the client might be able to retrieve the resource at the rewritten URL, the client isn't informed that the resource exists at the rewritten URL when it makes its request and receives the response.</span></span>

![Um ponto de extremidade de serviço WebAPI foi alterado da versão 1 (v1) para a versão 2 (v2) no servidor.](url-rewriting/_static/url_rewrite.png)

## <a name="url-rewriting-sample-app"></a><span data-ttu-id="bb0c3-146">Aplicativo de exemplo de reconfiguração de URL</span><span class="sxs-lookup"><span data-stu-id="bb0c3-146">URL rewriting sample app</span></span>

<span data-ttu-id="bb0c3-147">Explore as funcionalidades do Middleware de Reconfiguração de URL com o [aplicativo de exemplo](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/).</span><span class="sxs-lookup"><span data-stu-id="bb0c3-147">You can explore the features of the URL Rewriting Middleware with the [sample app](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/).</span></span> <span data-ttu-id="bb0c3-148">O aplicativo aplica as regras de redirecionamento e reconfiguração e mostra a URL redirecionada ou reconfigurada para vários cenários.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-148">The app applies redirect and rewrite rules and shows the redirected or rewritten URL for several scenarios.</span></span>

## <a name="when-to-use-url-rewriting-middleware"></a><span data-ttu-id="bb0c3-149">Quando usar o Middleware de Reconfiguração de URL</span><span class="sxs-lookup"><span data-stu-id="bb0c3-149">When to use URL Rewriting Middleware</span></span>

<span data-ttu-id="bb0c3-150">Use o Middleware de Reconfiguração de URL quando não for possível usar as seguintes abordagens:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-150">Use URL Rewriting Middleware when you're unable to use the following approaches:</span></span>

* [<span data-ttu-id="bb0c3-151">Módulo de Reconfiguração de URL com o IIS no Windows Server</span><span class="sxs-lookup"><span data-stu-id="bb0c3-151">URL Rewrite module with IIS on Windows Server</span></span>](https://www.iis.net/downloads/microsoft/url-rewrite)
* [<span data-ttu-id="bb0c3-152">Módulo mod_rewrite do Apache no Apache Server</span><span class="sxs-lookup"><span data-stu-id="bb0c3-152">Apache mod_rewrite module on Apache Server</span></span>](https://httpd.apache.org/docs/2.4/rewrite/)
* [<span data-ttu-id="bb0c3-153">Reconfiguração de URL no Nginx</span><span class="sxs-lookup"><span data-stu-id="bb0c3-153">URL rewriting on Nginx</span></span>](https://www.nginx.com/blog/creating-nginx-rewrite-rules/)

<span data-ttu-id="bb0c3-154">Além disso, use o middleware quando o aplicativo estiver hospedado no [servidor HTTP.sys](xref:fundamentals/servers/httpsys) (anteriormente chamado WebListener).</span><span class="sxs-lookup"><span data-stu-id="bb0c3-154">Also, use the middleware when the app is hosted on [HTTP.sys server](xref:fundamentals/servers/httpsys) (formerly called WebListener).</span></span>

<span data-ttu-id="bb0c3-155">As principais razões para usar as tecnologias de reconfiguração de URL baseada em servidor no IIS, no Apache e no Nginx são:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-155">The main reasons to use the server-based URL rewriting technologies in IIS, Apache, and Nginx are:</span></span>

* <span data-ttu-id="bb0c3-156">O middleware não dá suporte às funcionalidades completas desses módulos.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-156">The middleware doesn't support the full features of these modules.</span></span>

  <span data-ttu-id="bb0c3-157">Algumas funcionalidades dos módulos de servidor não funcionam com projetos ASP.NET Core, como as restrições `IsFile` e `IsDirectory` do módulo de Reconfiguração do IIS.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-157">Some of the features of the server modules don't work with ASP.NET Core projects, such as the `IsFile` and `IsDirectory` constraints of the IIS Rewrite module.</span></span> <span data-ttu-id="bb0c3-158">Nesses cenários, use o middleware.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-158">In these scenarios, use the middleware instead.</span></span>
* <span data-ttu-id="bb0c3-159">O desempenho do middleware provavelmente não corresponde ao desempenho dos módulos.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-159">The performance of the middleware probably doesn't match that of the modules.</span></span>

  <span data-ttu-id="bb0c3-160">Os parâmetros de comparação são a única maneira de saber com certeza qual abordagem degrada mais o desempenho ou se a degradação de desempenho é insignificante.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-160">Benchmarking is the only way to know for sure which approach degrades performance the most or if degraded performance is negligible.</span></span>

## <a name="package"></a><span data-ttu-id="bb0c3-161">Pacote</span><span class="sxs-lookup"><span data-stu-id="bb0c3-161">Package</span></span>

<span data-ttu-id="bb0c3-162">O Middleware de Reconfiguração de URL é fornecido pelo pacote [Microsoft.AspNetCore.Rewrite](https://www.nuget.org/packages/Microsoft.AspNetCore.Rewrite), que é incluído implicitamente em aplicativos ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-162">URL Rewriting Middleware is provided by the [Microsoft.AspNetCore.Rewrite](https://www.nuget.org/packages/Microsoft.AspNetCore.Rewrite) package, which is implicitly included in ASP.NET Core apps.</span></span>

## <a name="extension-and-options"></a><span data-ttu-id="bb0c3-163">Extensão e opções</span><span class="sxs-lookup"><span data-stu-id="bb0c3-163">Extension and options</span></span>

<span data-ttu-id="bb0c3-164">Estabeleça regras de reconfiguração e redirecionamento de URL criando uma instância da classe [RewriteOptions](xref:Microsoft.AspNetCore.Rewrite.RewriteOptions) com métodos de extensão para cada uma das regras de reconfiguração.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-164">Establish URL rewrite and redirect rules by creating an instance of the [RewriteOptions](xref:Microsoft.AspNetCore.Rewrite.RewriteOptions) class with extension methods for each of your rewrite rules.</span></span> <span data-ttu-id="bb0c3-165">Encadeie várias regras na ordem em que deseja que sejam processadas.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-165">Chain multiple rules in the order that you would like them processed.</span></span> <span data-ttu-id="bb0c3-166">As `RewriteOptions` são passadas para o Middleware de Reconfiguração de URL, conforme ele é adicionado ao pipeline de solicitação com <xref:Microsoft.AspNetCore.Builder.RewriteBuilderExtensions.UseRewriter*>:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-166">The `RewriteOptions` are passed into the URL Rewriting Middleware as it's added to the request pipeline with <xref:Microsoft.AspNetCore.Builder.RewriteBuilderExtensions.UseRewriter*>:</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1)]

### <a name="redirect-non-www-to-www"></a><span data-ttu-id="bb0c3-167">Redirecionar não www para www</span><span class="sxs-lookup"><span data-stu-id="bb0c3-167">Redirect non-www to www</span></span>

<span data-ttu-id="bb0c3-168">Três opções permitem que o aplicativo redirecione solicitações não `www`para `www`:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-168">Three options permit the app to redirect non-`www` requests to `www`:</span></span>

* <span data-ttu-id="bb0c3-169"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWwwPermanent*>&ndash; Redirecione permanentemente a solicitação para `www` o subdomínio se a solicitação for não`www`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-169"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWwwPermanent*> &ndash; Permanently redirect the request to the `www` subdomain if the request is non-`www`.</span></span> <span data-ttu-id="bb0c3-170">Redireciona com um código de status [Status308PermanentRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status308PermanentRedirect).</span><span class="sxs-lookup"><span data-stu-id="bb0c3-170">Redirects with a [Status308PermanentRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status308PermanentRedirect) status code.</span></span>

* <span data-ttu-id="bb0c3-171"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWww*>&ndash; Redirecione a solicitação para `www` o subdomínio se a solicitação de entrada for`www`não.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-171"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWww*> &ndash; Redirect the request to the `www` subdomain if the incoming request is non-`www`.</span></span> <span data-ttu-id="bb0c3-172">Redireciona com um código de status [Status307TemporaryRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status307TemporaryRedirect).</span><span class="sxs-lookup"><span data-stu-id="bb0c3-172">Redirects with a [Status307TemporaryRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status307TemporaryRedirect) status code.</span></span> <span data-ttu-id="bb0c3-173">Uma sobrecarga permite que você forneça o código de status para a resposta.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-173">An overload permits you to provide the status code for the response.</span></span> <span data-ttu-id="bb0c3-174">Use um campo da classe <xref:Microsoft.AspNetCore.Http.StatusCodes> para uma atribuição de código de status.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-174">Use a field of the <xref:Microsoft.AspNetCore.Http.StatusCodes> class for a status code assignment.</span></span>

### <a name="url-redirect"></a><span data-ttu-id="bb0c3-175">Redirecionamento de URL</span><span class="sxs-lookup"><span data-stu-id="bb0c3-175">URL redirect</span></span>

<span data-ttu-id="bb0c3-176">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirect*> para redirecionar as solicitações.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-176">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirect*> to redirect requests.</span></span> <span data-ttu-id="bb0c3-177">O primeiro parâmetro contém o regex para correspondência no caminho da URL de entrada.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-177">The first parameter contains your regex for matching on the path of the incoming URL.</span></span> <span data-ttu-id="bb0c3-178">O segundo parâmetro é a cadeia de caracteres de substituição.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-178">The second parameter is the replacement string.</span></span> <span data-ttu-id="bb0c3-179">O terceiro parâmetro, se presente, especifica o código de status.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-179">The third parameter, if present, specifies the status code.</span></span> <span data-ttu-id="bb0c3-180">Se você não especificar o código de status, ele usará como padrão *302 – Encontrado*, que indica que o recurso foi substituído ou movido temporariamente.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-180">If you don't specify the status code, the status code defaults to *302 - Found*, which indicates that the resource is temporarily moved or replaced.</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=9)]

<span data-ttu-id="bb0c3-181">Em um navegador com as ferramentas para desenvolvedores habilitadas, faça uma solicitação para o aplicativo de exemplo com o caminho `/redirect-rule/1234/5678`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-181">In a browser with developer tools enabled, make a request to the sample app with the path `/redirect-rule/1234/5678`.</span></span> <span data-ttu-id="bb0c3-182">O regex corresponde ao caminho de solicitação em `redirect-rule/(.*)` e o caminho é substituído por `/redirected/1234/5678`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-182">The regex matches the request path on `redirect-rule/(.*)`, and the path is replaced with `/redirected/1234/5678`.</span></span> <span data-ttu-id="bb0c3-183">A URL de redirecionamento é enviada novamente ao cliente com um código de status *302 – Encontrado*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-183">The redirect URL is sent back to the client with a *302 - Found* status code.</span></span> <span data-ttu-id="bb0c3-184">O navegador faz uma nova solicitação na URL de redirecionamento, que é exibida na barra de endereços do navegador.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-184">The browser makes a new request at the redirect URL, which appears in the browser's address bar.</span></span> <span data-ttu-id="bb0c3-185">Como não há nenhuma correspondência de regras no aplicativo de exemplo na URL de redirecionamento:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-185">Since no rules in the sample app match on the redirect URL:</span></span>

* <span data-ttu-id="bb0c3-186">A segunda solicitação recebe uma resposta *200 – OK* do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-186">The second request receives a *200 - OK* response from the app.</span></span>
* <span data-ttu-id="bb0c3-187">O corpo da resposta mostra a URL de redirecionamento.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-187">The body of the response shows the redirect URL.</span></span>

<span data-ttu-id="bb0c3-188">Uma viagem de ida e volta é feita para o servidor quando uma URL é *redirecionada*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-188">A round trip is made to the server when a URL is *redirected*.</span></span>

> [!WARNING]
> <span data-ttu-id="bb0c3-189">Tenha cuidado ao estabelecer regras de redirecionamento.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-189">Be cautious when establishing redirect rules.</span></span> <span data-ttu-id="bb0c3-190">As regras de redirecionamento são avaliadas em cada solicitação para o aplicativo, incluindo após um redirecionamento.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-190">Redirect rules are evaluated on every request to the app, including after a redirect.</span></span> <span data-ttu-id="bb0c3-191">É fácil criar acidentalmente um *loop de redirecionamentos infinitos*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-191">It's easy to accidentally create a *loop of infinite redirects*.</span></span>

<span data-ttu-id="bb0c3-192">Solicitação original: `/redirect-rule/1234/5678`</span><span class="sxs-lookup"><span data-stu-id="bb0c3-192">Original Request: `/redirect-rule/1234/5678`</span></span>

![Janela do navegador com as Ferramentas para Desenvolvedores acompanhando as solicitações e respostas](url-rewriting/_static/add_redirect.png)

<span data-ttu-id="bb0c3-194">A parte da expressão contida nos parênteses é chamada um *grupo de captura*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-194">The part of the expression contained within parentheses is called a *capture group*.</span></span> <span data-ttu-id="bb0c3-195">O ponto (`.`) da expressão significa *corresponder a qualquer caractere*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-195">The dot (`.`) of the expression means *match any character*.</span></span> <span data-ttu-id="bb0c3-196">O asterisco (`*`) indica *corresponder ao caractere zero precedente ou mais vezes*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-196">The asterisk (`*`) indicates *match the preceding character zero or more times*.</span></span> <span data-ttu-id="bb0c3-197">Portanto, os dois últimos segmentos de caminho da URL, `1234/5678`, são capturados pelo grupo de captura `(.*)`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-197">Therefore, the last two path segments of the URL, `1234/5678`, are captured by capture group `(.*)`.</span></span> <span data-ttu-id="bb0c3-198">Qualquer valor que você fornecer na URL de solicitação após `redirect-rule/` é capturado por esse único grupo de captura.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-198">Any value you provide in the request URL after `redirect-rule/` is captured by this single capture group.</span></span>

<span data-ttu-id="bb0c3-199">Na cadeia de caracteres de substituição, os grupos capturados são injetados na cadeia de caracteres com o cifrão (`$`) seguido do número de sequência da captura.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-199">In the replacement string, captured groups are injected into the string with the dollar sign (`$`) followed by the sequence number of the capture.</span></span> <span data-ttu-id="bb0c3-200">O primeiro valor de grupo de captura é obtido com `$1`, o segundo com `$2` e eles continuam em sequência para os grupos de captura no regex.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-200">The first capture group value is obtained with `$1`, the second with `$2`, and they continue in sequence for the capture groups in your regex.</span></span> <span data-ttu-id="bb0c3-201">Há apenas um grupo capturado no regex da regra de redirecionamento no aplicativo de exemplo, para que haja apenas um grupo injetado na cadeia de caracteres de substituição, que é `$1`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-201">There's only one captured group in the redirect rule regex in the sample app, so there's only one injected group in the replacement string, which is `$1`.</span></span> <span data-ttu-id="bb0c3-202">Quando a regra é aplicada, a URL se torna `/redirected/1234/5678`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-202">When the rule is applied, the URL becomes `/redirected/1234/5678`.</span></span>

### <a name="url-redirect-to-a-secure-endpoint"></a><span data-ttu-id="bb0c3-203">Redirecionamento de URL para um ponto de extremidade seguro</span><span class="sxs-lookup"><span data-stu-id="bb0c3-203">URL redirect to a secure endpoint</span></span>

<span data-ttu-id="bb0c3-204">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttps*> para redirecionar solicitações HTTP para o mesmo host e caminho usando o protocolo HTTPS.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-204">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttps*> to redirect HTTP requests to the same host and path using the HTTPS protocol.</span></span> <span data-ttu-id="bb0c3-205">Se o código de status não for fornecido, o middleware usará como padrão *302 – Encontrado*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-205">If the status code isn't supplied, the middleware defaults to *302 - Found*.</span></span> <span data-ttu-id="bb0c3-206">Se a porta não for fornecida:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-206">If the port isn't supplied:</span></span>

* <span data-ttu-id="bb0c3-207">O middleware usará como padrão `null`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-207">The middleware defaults to `null`.</span></span>
* <span data-ttu-id="bb0c3-208">O esquema será alterado para `https` (protocolo HTTPS), e o cliente acessará o recurso na porta 443.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-208">The scheme changes to `https` (HTTPS protocol), and the client accesses the resource on port 443.</span></span>

<span data-ttu-id="bb0c3-209">O exemplo a seguir mostra como definir o código de status como *301 –Movido Permanentemente* e alterar a porta para 5001.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-209">The following example shows how to set the status code to *301 - Moved Permanently* and change the port to 5001.</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    var options = new RewriteOptions()
        .AddRedirectToHttps(301, 5001);

    app.UseRewriter(options);
}
```

<span data-ttu-id="bb0c3-210">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttpsPermanent*> para redirecionar solicitações não seguras para o mesmo host e caminho com o protocolo HTTPS seguro na porta 443.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-210">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttpsPermanent*> to redirect insecure requests to the same host and path with secure HTTPS protocol on port 443.</span></span> <span data-ttu-id="bb0c3-211">O middleware define o código de status como *301 – Movido Permanentemente*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-211">The middleware sets the status code to *301 - Moved Permanently*.</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    var options = new RewriteOptions()
        .AddRedirectToHttpsPermanent();

    app.UseRewriter(options);
}
```

> [!NOTE]
> <span data-ttu-id="bb0c3-212">Ao redirecionar para um ponto de extremidade seguro sem a necessidade de regras de redirecionamento adicionais, recomendamos o uso do Middleware de Redirecionamento HTTPS.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-212">When redirecting to a secure endpoint without the requirement for additional redirect rules, we recommend using HTTPS Redirection Middleware.</span></span> <span data-ttu-id="bb0c3-213">Para obter mais informações, veja o tópico [Impor HTTPS](xref:security/enforcing-ssl#require-https).</span><span class="sxs-lookup"><span data-stu-id="bb0c3-213">For more information, see the [Enforce HTTPS](xref:security/enforcing-ssl#require-https) topic.</span></span>

<span data-ttu-id="bb0c3-214">O aplicativo de exemplo pode demonstrar como usar `AddRedirectToHttps` ou `AddRedirectToHttpsPermanent`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-214">The sample app is capable of demonstrating how to use `AddRedirectToHttps` or `AddRedirectToHttpsPermanent`.</span></span> <span data-ttu-id="bb0c3-215">Adicione o método de extensão às `RewriteOptions`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-215">Add the extension method to the `RewriteOptions`.</span></span> <span data-ttu-id="bb0c3-216">Faça uma solicitação não segura para o aplicativo em qualquer URL.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-216">Make an insecure request to the app at any URL.</span></span> <span data-ttu-id="bb0c3-217">Ignore o aviso de segurança do navegador de que o certificado autoassinado não é confiável ou crie uma exceção para confiar no certificado.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-217">Dismiss the browser security warning that the self-signed certificate is untrusted or create an exception to trust the certificate.</span></span>

<span data-ttu-id="bb0c3-218">Solicitação original usando `AddRedirectToHttps(301, 5001)`: `http://localhost:5000/secure`</span><span class="sxs-lookup"><span data-stu-id="bb0c3-218">Original Request using `AddRedirectToHttps(301, 5001)`: `http://localhost:5000/secure`</span></span>

![Janela do navegador com as Ferramentas para Desenvolvedores acompanhando as solicitações e respostas](url-rewriting/_static/add_redirect_to_https.png)

<span data-ttu-id="bb0c3-220">Solicitação original usando `AddRedirectToHttpsPermanent`: `http://localhost:5000/secure`</span><span class="sxs-lookup"><span data-stu-id="bb0c3-220">Original Request using `AddRedirectToHttpsPermanent`: `http://localhost:5000/secure`</span></span>

![Janela do navegador com as Ferramentas para Desenvolvedores acompanhando as solicitações e respostas](url-rewriting/_static/add_redirect_to_https_permanent.png)

### <a name="url-rewrite"></a><span data-ttu-id="bb0c3-222">Reconfiguração de URL</span><span class="sxs-lookup"><span data-stu-id="bb0c3-222">URL rewrite</span></span>

<span data-ttu-id="bb0c3-223">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRewrite*> para criar uma regra para a reconfiguração de URLs.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-223">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRewrite*> to create a rule for rewriting URLs.</span></span> <span data-ttu-id="bb0c3-224">O primeiro parâmetro contém o regex para correspondência no caminho da URL de entrada.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-224">The first parameter contains the regex for matching on the incoming URL path.</span></span> <span data-ttu-id="bb0c3-225">O segundo parâmetro é a cadeia de caracteres de substituição.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-225">The second parameter is the replacement string.</span></span> <span data-ttu-id="bb0c3-226">O terceiro parâmetro, `skipRemainingRules: {true|false}`, indica para o middleware se ele deve ou não ignorar regras de reconfiguração adicionais se a regra atual é aplicada.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-226">The third parameter, `skipRemainingRules: {true|false}`, indicates to the middleware whether or not to skip additional rewrite rules if the current rule is applied.</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=10-11)]

<span data-ttu-id="bb0c3-227">Solicitação original: `/rewrite-rule/1234/5678`</span><span class="sxs-lookup"><span data-stu-id="bb0c3-227">Original Request: `/rewrite-rule/1234/5678`</span></span>

![Janela do navegador com as Ferramentas para Desenvolvedores acompanhando a solicitação e resposta](url-rewriting/_static/add_rewrite.png)

<span data-ttu-id="bb0c3-229">O acento circunflexo (`^`) no início da expressão significa que a correspondência começa no início do caminho da URL.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-229">The carat (`^`) at the beginning of the expression means that matching starts at the beginning of the URL path.</span></span>

<span data-ttu-id="bb0c3-230">No exemplo anterior com a regra de redirecionamento, `redirect-rule/(.*)`, não há nenhum acento circunflexo (`^`) no início do regex.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-230">In the earlier example with the redirect rule, `redirect-rule/(.*)`, there's no carat (`^`) at the start of the regex.</span></span> <span data-ttu-id="bb0c3-231">Portanto, qualquer caractere pode preceder `redirect-rule/` no caminho para uma correspondência com êxito.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-231">Therefore, any characters may precede `redirect-rule/` in the path for a successful match.</span></span>

| <span data-ttu-id="bb0c3-232">Caminho</span><span class="sxs-lookup"><span data-stu-id="bb0c3-232">Path</span></span>                               | <span data-ttu-id="bb0c3-233">Correspondência</span><span class="sxs-lookup"><span data-stu-id="bb0c3-233">Match</span></span> |
| ---------------------------------- | :---: |
| `/redirect-rule/1234/5678`         | <span data-ttu-id="bb0c3-234">Sim</span><span class="sxs-lookup"><span data-stu-id="bb0c3-234">Yes</span></span>   |
| `/my-cool-redirect-rule/1234/5678` | <span data-ttu-id="bb0c3-235">Sim</span><span class="sxs-lookup"><span data-stu-id="bb0c3-235">Yes</span></span>   |
| `/anotherredirect-rule/1234/5678`  | <span data-ttu-id="bb0c3-236">Sim</span><span class="sxs-lookup"><span data-stu-id="bb0c3-236">Yes</span></span>   |

<span data-ttu-id="bb0c3-237">A regra de reconfiguração, `^rewrite-rule/(\d+)/(\d+)`, corresponde apenas a caminhos se eles são iniciados com `rewrite-rule/`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-237">The rewrite rule, `^rewrite-rule/(\d+)/(\d+)`, only matches paths if they start with `rewrite-rule/`.</span></span> <span data-ttu-id="bb0c3-238">Na tabela a seguir, observe a diferença na correspondência.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-238">In the following table, note the difference in matching.</span></span>

| <span data-ttu-id="bb0c3-239">Caminho</span><span class="sxs-lookup"><span data-stu-id="bb0c3-239">Path</span></span>                              | <span data-ttu-id="bb0c3-240">Correspondência</span><span class="sxs-lookup"><span data-stu-id="bb0c3-240">Match</span></span> |
| --------------------------------- | :---: |
| `/rewrite-rule/1234/5678`         | <span data-ttu-id="bb0c3-241">Sim</span><span class="sxs-lookup"><span data-stu-id="bb0c3-241">Yes</span></span>   |
| `/my-cool-rewrite-rule/1234/5678` | <span data-ttu-id="bb0c3-242">Não</span><span class="sxs-lookup"><span data-stu-id="bb0c3-242">No</span></span>    |
| `/anotherrewrite-rule/1234/5678`  | <span data-ttu-id="bb0c3-243">Não</span><span class="sxs-lookup"><span data-stu-id="bb0c3-243">No</span></span>    |

<span data-ttu-id="bb0c3-244">Após a parte `^rewrite-rule/` da expressão, há dois grupos de captura, `(\d+)/(\d+)`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-244">Following the `^rewrite-rule/` portion of the expression, there are two capture groups, `(\d+)/(\d+)`.</span></span> <span data-ttu-id="bb0c3-245">O `\d` significa *corresponder a um dígito (número)*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-245">The `\d` signifies *match a digit (number)*.</span></span> <span data-ttu-id="bb0c3-246">O sinal de adição (`+`) significa *corresponder a um ou mais caracteres anteriores*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-246">The plus sign (`+`) means *match one or more of the preceding character*.</span></span> <span data-ttu-id="bb0c3-247">Portanto, a URL precisa conter um número seguido de uma barra "/" seguida de outro número.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-247">Therefore, the URL must contain a number followed by a forward-slash followed by another number.</span></span> <span data-ttu-id="bb0c3-248">Esses grupos de captura são injetados na URL reconfigurada como `$1` e `$2`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-248">These capture groups are injected into the rewritten URL as `$1` and `$2`.</span></span> <span data-ttu-id="bb0c3-249">A cadeia de caracteres de substituição da regra de reconfiguração coloca os grupos capturados na cadeia de consulta.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-249">The rewrite rule replacement string places the captured groups into the query string.</span></span> <span data-ttu-id="bb0c3-250">O caminho solicitado de `/rewrite-rule/1234/5678` foi reconfigurado para obter o recurso em `/rewritten?var1=1234&var2=5678`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-250">The requested path of `/rewrite-rule/1234/5678` is rewritten to obtain the resource at `/rewritten?var1=1234&var2=5678`.</span></span> <span data-ttu-id="bb0c3-251">Se uma cadeia de consulta estiver presente na solicitação original, ela será preservada quando a URL for reconfigurada.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-251">If a query string is present on the original request, it's preserved when the URL is rewritten.</span></span>

<span data-ttu-id="bb0c3-252">Não há nenhuma viagem de ida e volta para o servidor para obtenção do recurso.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-252">There's no round trip to the server to obtain the resource.</span></span> <span data-ttu-id="bb0c3-253">Se o recurso existir, ele será buscado e retornado para o cliente com um código de status *200 – OK*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-253">If the resource exists, it's fetched and returned to the client with a *200 - OK* status code.</span></span> <span data-ttu-id="bb0c3-254">Como o cliente não é redirecionado, a URL na barra de endereços do navegador não é alterada.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-254">Because the client isn't redirected, the URL in the browser's address bar doesn't change.</span></span> <span data-ttu-id="bb0c3-255">Os clientes não conseguem detectar que uma operação de reconfiguração de URL ocorreu no servidor.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-255">Clients can't detect that a URL rewrite operation occurred on the server.</span></span>

> [!NOTE]
> <span data-ttu-id="bb0c3-256">Use `skipRemainingRules: true` sempre que possível, porque as regras de correspondência são computacionalmente caras e aumentam o tempo de resposta do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-256">Use `skipRemainingRules: true` whenever possible because matching rules is computationally expensive and increases app response time.</span></span> <span data-ttu-id="bb0c3-257">Para a resposta mais rápida do aplicativo:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-257">For the fastest app response:</span></span>
>
> * <span data-ttu-id="bb0c3-258">Ordene as regras de reconfiguração da regra com correspondência mais frequente para a regra com correspondência menos frequente.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-258">Order rewrite rules from the most frequently matched rule to the least frequently matched rule.</span></span>
> * <span data-ttu-id="bb0c3-259">Ignore o processamento das regras restantes quando ocorrer uma correspondência e nenhum processamento de regra adicional for necessário.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-259">Skip the processing of the remaining rules when a match occurs and no additional rule processing is required.</span></span>

### <a name="apache-mod_rewrite"></a><span data-ttu-id="bb0c3-260">mod_rewrite do Apache</span><span class="sxs-lookup"><span data-stu-id="bb0c3-260">Apache mod_rewrite</span></span>

<span data-ttu-id="bb0c3-261">Aplique as regras do mod_rewrite do Apache com <xref:Microsoft.AspNetCore.Rewrite.ApacheModRewriteOptionsExtensions.AddApacheModRewrite*>.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-261">Apply Apache mod_rewrite rules with <xref:Microsoft.AspNetCore.Rewrite.ApacheModRewriteOptionsExtensions.AddApacheModRewrite*>.</span></span> <span data-ttu-id="bb0c3-262">Verifique se o arquivo de regras foi implantado com o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-262">Make sure that the rules file is deployed with the app.</span></span> <span data-ttu-id="bb0c3-263">Para obter mais informações e exemplos de regras de mod_rewrite, consulte [mod_rewrite do Apache](https://httpd.apache.org/docs/2.4/rewrite/).</span><span class="sxs-lookup"><span data-stu-id="bb0c3-263">For more information and examples of mod_rewrite rules, see [Apache mod_rewrite](https://httpd.apache.org/docs/2.4/rewrite/).</span></span>

<span data-ttu-id="bb0c3-264">Um <xref:System.IO.StreamReader> é usado para ler as regras do arquivo de regras *ApacheModRewrite.txt*:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-264">A <xref:System.IO.StreamReader> is used to read the rules from the *ApacheModRewrite.txt* rules file:</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=3-4,12)]

<span data-ttu-id="bb0c3-265">O aplicativo de exemplo redireciona solicitações de `/apache-mod-rules-redirect/(.\*)` para `/redirected?id=$1`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-265">The sample app redirects requests from `/apache-mod-rules-redirect/(.\*)` to `/redirected?id=$1`.</span></span> <span data-ttu-id="bb0c3-266">O código de status da resposta é *302 – Encontrado*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-266">The response status code is *302 - Found*.</span></span>

[!code[](url-rewriting/samples/3.x/SampleApp/ApacheModRewrite.txt)]

<span data-ttu-id="bb0c3-267">Solicitação original: `/apache-mod-rules-redirect/1234`</span><span class="sxs-lookup"><span data-stu-id="bb0c3-267">Original Request: `/apache-mod-rules-redirect/1234`</span></span>

![Janela do navegador com as Ferramentas para Desenvolvedores acompanhando as solicitações e respostas](url-rewriting/_static/add_apache_mod_redirect.png)

<span data-ttu-id="bb0c3-269">O middleware dá suporte às seguintes variáveis de servidor do mod_rewrite do Apache:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-269">The middleware supports the following Apache mod_rewrite server variables:</span></span>

* <span data-ttu-id="bb0c3-270">CONN_REMOTE_ADDR</span><span class="sxs-lookup"><span data-stu-id="bb0c3-270">CONN_REMOTE_ADDR</span></span>
* <span data-ttu-id="bb0c3-271">HTTP_ACCEPT</span><span class="sxs-lookup"><span data-stu-id="bb0c3-271">HTTP_ACCEPT</span></span>
* <span data-ttu-id="bb0c3-272">HTTP_CONNECTION</span><span class="sxs-lookup"><span data-stu-id="bb0c3-272">HTTP_CONNECTION</span></span>
* <span data-ttu-id="bb0c3-273">HTTP_COOKIE</span><span class="sxs-lookup"><span data-stu-id="bb0c3-273">HTTP_COOKIE</span></span>
* <span data-ttu-id="bb0c3-274">HTTP_FORWARDED</span><span class="sxs-lookup"><span data-stu-id="bb0c3-274">HTTP_FORWARDED</span></span>
* <span data-ttu-id="bb0c3-275">HTTP_HOST</span><span class="sxs-lookup"><span data-stu-id="bb0c3-275">HTTP_HOST</span></span>
* <span data-ttu-id="bb0c3-276">HTTP_REFERER</span><span class="sxs-lookup"><span data-stu-id="bb0c3-276">HTTP_REFERER</span></span>
* <span data-ttu-id="bb0c3-277">HTTP_USER_AGENT</span><span class="sxs-lookup"><span data-stu-id="bb0c3-277">HTTP_USER_AGENT</span></span>
* <span data-ttu-id="bb0c3-278">HTTPS</span><span class="sxs-lookup"><span data-stu-id="bb0c3-278">HTTPS</span></span>
* <span data-ttu-id="bb0c3-279">IPV6</span><span class="sxs-lookup"><span data-stu-id="bb0c3-279">IPV6</span></span>
* <span data-ttu-id="bb0c3-280">QUERY_STRING</span><span class="sxs-lookup"><span data-stu-id="bb0c3-280">QUERY_STRING</span></span>
* <span data-ttu-id="bb0c3-281">REMOTE_ADDR</span><span class="sxs-lookup"><span data-stu-id="bb0c3-281">REMOTE_ADDR</span></span>
* <span data-ttu-id="bb0c3-282">REMOTE_PORT</span><span class="sxs-lookup"><span data-stu-id="bb0c3-282">REMOTE_PORT</span></span>
* <span data-ttu-id="bb0c3-283">REQUEST_FILENAME</span><span class="sxs-lookup"><span data-stu-id="bb0c3-283">REQUEST_FILENAME</span></span>
* <span data-ttu-id="bb0c3-284">REQUEST_METHOD</span><span class="sxs-lookup"><span data-stu-id="bb0c3-284">REQUEST_METHOD</span></span>
* <span data-ttu-id="bb0c3-285">REQUEST_SCHEME</span><span class="sxs-lookup"><span data-stu-id="bb0c3-285">REQUEST_SCHEME</span></span>
* <span data-ttu-id="bb0c3-286">REQUEST_URI</span><span class="sxs-lookup"><span data-stu-id="bb0c3-286">REQUEST_URI</span></span>
* <span data-ttu-id="bb0c3-287">SCRIPT_FILENAME</span><span class="sxs-lookup"><span data-stu-id="bb0c3-287">SCRIPT_FILENAME</span></span>
* <span data-ttu-id="bb0c3-288">SERVER_ADDR</span><span class="sxs-lookup"><span data-stu-id="bb0c3-288">SERVER_ADDR</span></span>
* <span data-ttu-id="bb0c3-289">SERVER_PORT</span><span class="sxs-lookup"><span data-stu-id="bb0c3-289">SERVER_PORT</span></span>
* <span data-ttu-id="bb0c3-290">SERVER_PROTOCOL</span><span class="sxs-lookup"><span data-stu-id="bb0c3-290">SERVER_PROTOCOL</span></span>
* <span data-ttu-id="bb0c3-291">TIME</span><span class="sxs-lookup"><span data-stu-id="bb0c3-291">TIME</span></span>
* <span data-ttu-id="bb0c3-292">TIME_DAY</span><span class="sxs-lookup"><span data-stu-id="bb0c3-292">TIME_DAY</span></span>
* <span data-ttu-id="bb0c3-293">TIME_HOUR</span><span class="sxs-lookup"><span data-stu-id="bb0c3-293">TIME_HOUR</span></span>
* <span data-ttu-id="bb0c3-294">TIME_MIN</span><span class="sxs-lookup"><span data-stu-id="bb0c3-294">TIME_MIN</span></span>
* <span data-ttu-id="bb0c3-295">TIME_MON</span><span class="sxs-lookup"><span data-stu-id="bb0c3-295">TIME_MON</span></span>
* <span data-ttu-id="bb0c3-296">TIME_SEC</span><span class="sxs-lookup"><span data-stu-id="bb0c3-296">TIME_SEC</span></span>
* <span data-ttu-id="bb0c3-297">TIME_WDAY</span><span class="sxs-lookup"><span data-stu-id="bb0c3-297">TIME_WDAY</span></span>
* <span data-ttu-id="bb0c3-298">TIME_YEAR</span><span class="sxs-lookup"><span data-stu-id="bb0c3-298">TIME_YEAR</span></span>

### <a name="iis-url-rewrite-module-rules"></a><span data-ttu-id="bb0c3-299">Regras do Módulo de Reconfiguração de URL do IIS</span><span class="sxs-lookup"><span data-stu-id="bb0c3-299">IIS URL Rewrite Module rules</span></span>

<span data-ttu-id="bb0c3-300">Para usar o mesmo conjunto de regras que se aplica ao Módulo de Reconfiguração de URL do IIS, use <xref:Microsoft.AspNetCore.Rewrite.IISUrlRewriteOptionsExtensions.AddIISUrlRewrite*>.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-300">To use the same rule set that applies to the IIS URL Rewrite Module, use <xref:Microsoft.AspNetCore.Rewrite.IISUrlRewriteOptionsExtensions.AddIISUrlRewrite*>.</span></span> <span data-ttu-id="bb0c3-301">Verifique se o arquivo de regras foi implantado com o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-301">Make sure that the rules file is deployed with the app.</span></span> <span data-ttu-id="bb0c3-302">Não instrua o middleware a usar o arquivo *web.config* do aplicativo quando ele estiver em execução no IIS do Windows Server.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-302">Don't direct the middleware to use the app's *web.config* file when running on Windows Server IIS.</span></span> <span data-ttu-id="bb0c3-303">Com o IIS, essas regras devem ser armazenadas fora do arquivo *web.config* do aplicativo para evitar conflitos com o módulo de Reconfiguração do IIS.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-303">With IIS, these rules should be stored outside of the app's *web.config* file in order to avoid conflicts with the IIS Rewrite module.</span></span> <span data-ttu-id="bb0c3-304">Para obter mais informações e exemplos de regras do Módulo de Reconfiguração de URL do IIS, consulte [Usando o Módulo de Reconfiguração de URL 2.0](/iis/extensions/url-rewrite-module/using-url-rewrite-module-20) e [Referência de configuração do Módulo de Reconfiguração de URL](/iis/extensions/url-rewrite-module/url-rewrite-module-configuration-reference).</span><span class="sxs-lookup"><span data-stu-id="bb0c3-304">For more information and examples of IIS URL Rewrite Module rules, see [Using Url Rewrite Module 2.0](/iis/extensions/url-rewrite-module/using-url-rewrite-module-20) and [URL Rewrite Module Configuration Reference](/iis/extensions/url-rewrite-module/url-rewrite-module-configuration-reference).</span></span>

<span data-ttu-id="bb0c3-305">Um <xref:System.IO.StreamReader> é usado para ler as regras do arquivo de regras *IISUrlRewrite.xml*:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-305">A <xref:System.IO.StreamReader> is used to read the rules from the *IISUrlRewrite.xml* rules file:</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=5-6,13)]

<span data-ttu-id="bb0c3-306">O aplicativo de exemplo reconfigura as solicitações de `/iis-rules-rewrite/(.*)` para `/rewritten?id=$1`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-306">The sample app rewrites requests from `/iis-rules-rewrite/(.*)` to `/rewritten?id=$1`.</span></span> <span data-ttu-id="bb0c3-307">A resposta é enviada ao cliente com um código de status *200 – OK*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-307">The response is sent to the client with a *200 - OK* status code.</span></span>

[!code-xml[](url-rewriting/samples/3.x/SampleApp/IISUrlRewrite.xml)]

<span data-ttu-id="bb0c3-308">Solicitação original: `/iis-rules-rewrite/1234`</span><span class="sxs-lookup"><span data-stu-id="bb0c3-308">Original Request: `/iis-rules-rewrite/1234`</span></span>

![Janela do navegador com as Ferramentas para Desenvolvedores acompanhando a solicitação e resposta](url-rewriting/_static/add_iis_url_rewrite.png)

<span data-ttu-id="bb0c3-310">Caso você tenha um Módulo de Reconfiguração do IIS ativo com regras no nível do servidor configuradas que poderiam afetar o aplicativo de maneiras indesejadas, desabilite o Módulo de Reconfiguração do IIS em um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-310">If you have an active IIS Rewrite Module with server-level rules configured that would impact your app in undesirable ways, you can disable the IIS Rewrite Module for an app.</span></span> <span data-ttu-id="bb0c3-311">Para obter mais informações, consulte [Desabilitando módulos do IIS](xref:host-and-deploy/iis/modules#disabling-iis-modules).</span><span class="sxs-lookup"><span data-stu-id="bb0c3-311">For more information, see [Disabling IIS modules](xref:host-and-deploy/iis/modules#disabling-iis-modules).</span></span>

#### <a name="unsupported-features"></a><span data-ttu-id="bb0c3-312">Recursos sem suporte</span><span class="sxs-lookup"><span data-stu-id="bb0c3-312">Unsupported features</span></span>

<span data-ttu-id="bb0c3-313">O middleware liberado com o ASP.NET Core 2.x não dá suporte aos seguintes recursos do Módulo de Reconfiguração de URL do IIS:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-313">The middleware released with ASP.NET Core 2.x doesn't support the following IIS URL Rewrite Module features:</span></span>

* <span data-ttu-id="bb0c3-314">Regras de saída</span><span class="sxs-lookup"><span data-stu-id="bb0c3-314">Outbound Rules</span></span>
* <span data-ttu-id="bb0c3-315">Variáveis de servidor personalizadas</span><span class="sxs-lookup"><span data-stu-id="bb0c3-315">Custom Server Variables</span></span>
* <span data-ttu-id="bb0c3-316">Curingas</span><span class="sxs-lookup"><span data-stu-id="bb0c3-316">Wildcards</span></span>
* <span data-ttu-id="bb0c3-317">LogRewrittenUrl</span><span class="sxs-lookup"><span data-stu-id="bb0c3-317">LogRewrittenUrl</span></span>

#### <a name="supported-server-variables"></a><span data-ttu-id="bb0c3-318">Variáveis de servidor compatíveis</span><span class="sxs-lookup"><span data-stu-id="bb0c3-318">Supported server variables</span></span>

<span data-ttu-id="bb0c3-319">O middleware dá suporte às seguintes variáveis de servidor do Módulo de Reconfiguração de URL do IIS:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-319">The middleware supports the following IIS URL Rewrite Module server variables:</span></span>

* <span data-ttu-id="bb0c3-320">CONTENT_LENGTH</span><span class="sxs-lookup"><span data-stu-id="bb0c3-320">CONTENT_LENGTH</span></span>
* <span data-ttu-id="bb0c3-321">CONTENT_TYPE</span><span class="sxs-lookup"><span data-stu-id="bb0c3-321">CONTENT_TYPE</span></span>
* <span data-ttu-id="bb0c3-322">HTTP_ACCEPT</span><span class="sxs-lookup"><span data-stu-id="bb0c3-322">HTTP_ACCEPT</span></span>
* <span data-ttu-id="bb0c3-323">HTTP_CONNECTION</span><span class="sxs-lookup"><span data-stu-id="bb0c3-323">HTTP_CONNECTION</span></span>
* <span data-ttu-id="bb0c3-324">HTTP_COOKIE</span><span class="sxs-lookup"><span data-stu-id="bb0c3-324">HTTP_COOKIE</span></span>
* <span data-ttu-id="bb0c3-325">HTTP_HOST</span><span class="sxs-lookup"><span data-stu-id="bb0c3-325">HTTP_HOST</span></span>
* <span data-ttu-id="bb0c3-326">HTTP_REFERER</span><span class="sxs-lookup"><span data-stu-id="bb0c3-326">HTTP_REFERER</span></span>
* <span data-ttu-id="bb0c3-327">HTTP_URL</span><span class="sxs-lookup"><span data-stu-id="bb0c3-327">HTTP_URL</span></span>
* <span data-ttu-id="bb0c3-328">HTTP_USER_AGENT</span><span class="sxs-lookup"><span data-stu-id="bb0c3-328">HTTP_USER_AGENT</span></span>
* <span data-ttu-id="bb0c3-329">HTTPS</span><span class="sxs-lookup"><span data-stu-id="bb0c3-329">HTTPS</span></span>
* <span data-ttu-id="bb0c3-330">LOCAL_ADDR</span><span class="sxs-lookup"><span data-stu-id="bb0c3-330">LOCAL_ADDR</span></span>
* <span data-ttu-id="bb0c3-331">QUERY_STRING</span><span class="sxs-lookup"><span data-stu-id="bb0c3-331">QUERY_STRING</span></span>
* <span data-ttu-id="bb0c3-332">REMOTE_ADDR</span><span class="sxs-lookup"><span data-stu-id="bb0c3-332">REMOTE_ADDR</span></span>
* <span data-ttu-id="bb0c3-333">REMOTE_PORT</span><span class="sxs-lookup"><span data-stu-id="bb0c3-333">REMOTE_PORT</span></span>
* <span data-ttu-id="bb0c3-334">REQUEST_FILENAME</span><span class="sxs-lookup"><span data-stu-id="bb0c3-334">REQUEST_FILENAME</span></span>
* <span data-ttu-id="bb0c3-335">REQUEST_URI</span><span class="sxs-lookup"><span data-stu-id="bb0c3-335">REQUEST_URI</span></span>

> [!NOTE]
> <span data-ttu-id="bb0c3-336">Também obtenha um <xref:Microsoft.Extensions.FileProviders.IFileProvider> por meio de um <xref:Microsoft.Extensions.FileProviders.PhysicalFileProvider>.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-336">You can also obtain an <xref:Microsoft.Extensions.FileProviders.IFileProvider> via a <xref:Microsoft.Extensions.FileProviders.PhysicalFileProvider>.</span></span> <span data-ttu-id="bb0c3-337">Essa abordagem pode fornecer maior flexibilidade para o local dos arquivos de regras de reconfiguração.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-337">This approach may provide greater flexibility for the location of your rewrite rules files.</span></span> <span data-ttu-id="bb0c3-338">Verifique se os arquivos de regras de reconfiguração são implantados no servidor no caminho fornecido.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-338">Make sure that your rewrite rules files are deployed to the server at the path you provide.</span></span>
>
> ```csharp
> PhysicalFileProvider fileProvider = new PhysicalFileProvider(Directory.GetCurrentDirectory());
> ```

### <a name="method-based-rule"></a><span data-ttu-id="bb0c3-339">Regra baseada em método</span><span class="sxs-lookup"><span data-stu-id="bb0c3-339">Method-based rule</span></span>

<span data-ttu-id="bb0c3-340">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> para implementar sua própria lógica de regra em um método.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-340">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> to implement your own rule logic in a method.</span></span> <span data-ttu-id="bb0c3-341">`Add` expõe o <xref:Microsoft.AspNetCore.Rewrite.RewriteContext>, que disponibiliza o <xref:Microsoft.AspNetCore.Http.HttpContext> para uso no método.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-341">`Add` exposes the <xref:Microsoft.AspNetCore.Rewrite.RewriteContext>, which makes available the <xref:Microsoft.AspNetCore.Http.HttpContext> for use in your method.</span></span> <span data-ttu-id="bb0c3-342">O [RewriteContext.Result](xref:Microsoft.AspNetCore.Rewrite.RewriteContext.Result*) determina como o processamento adicional de pipeline é feito.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-342">The [RewriteContext.Result](xref:Microsoft.AspNetCore.Rewrite.RewriteContext.Result*) determines how additional pipeline processing is handled.</span></span> <span data-ttu-id="bb0c3-343">Defina o valor como um dos campos <xref:Microsoft.AspNetCore.Rewrite.RuleResult> descritos na tabela a seguir.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-343">Set the value to one of the <xref:Microsoft.AspNetCore.Rewrite.RuleResult> fields described in the following table.</span></span>

| `RewriteContext.Result`              | <span data-ttu-id="bb0c3-344">Ação</span><span class="sxs-lookup"><span data-stu-id="bb0c3-344">Action</span></span>                                                           |
| ------------------------------------ | ---------------------------------------------------------------- |
| <span data-ttu-id="bb0c3-345">`RuleResult.ContinueRules` (padrão)</span><span class="sxs-lookup"><span data-stu-id="bb0c3-345">`RuleResult.ContinueRules` (default)</span></span> | <span data-ttu-id="bb0c3-346">Continuar aplicando regras.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-346">Continue applying rules.</span></span>                                         |
| `RuleResult.EndResponse`             | <span data-ttu-id="bb0c3-347">Parar de aplicar regras e enviar a resposta.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-347">Stop applying rules and send the response.</span></span>                       |
| `RuleResult.SkipRemainingRules`      | <span data-ttu-id="bb0c3-348">Parar de aplicar regras e enviar o contexto para o próximo middleware.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-348">Stop applying rules and send the context to the next middleware.</span></span> |

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=14)]

<span data-ttu-id="bb0c3-349">O aplicativo de exemplo demonstra um método que redireciona as solicitações para caminhos que terminam com *.xml*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-349">The sample app demonstrates a method that redirects requests for paths that end with *.xml*.</span></span> <span data-ttu-id="bb0c3-350">Se uma solicitação for feita para `/file.xml`, ela será redirecionada para `/xmlfiles/file.xml`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-350">If a request is made for `/file.xml`, the request is redirected to `/xmlfiles/file.xml`.</span></span> <span data-ttu-id="bb0c3-351">O código de status é definido como *301 – Movido Permanentemente*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-351">The status code is set to *301 - Moved Permanently*.</span></span> <span data-ttu-id="bb0c3-352">Quando o navegador faz uma nova solicitação para */xmlfiles/file.xml*, o Middleware de Arquivo Estático fornece o arquivo para o cliente por meio da pasta *wwwroot/xmlfiles*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-352">When the browser makes a new request for */xmlfiles/file.xml*, Static File Middleware serves the file to the client from the *wwwroot/xmlfiles* folder.</span></span> <span data-ttu-id="bb0c3-353">Para um redirecionamento, defina explicitamente o código de status da resposta.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-353">For a redirect, explicitly set the status code of the response.</span></span> <span data-ttu-id="bb0c3-354">Caso contrário, um código de status *200 – OK* será retornado e o redirecionamento não ocorrerá no cliente.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-354">Otherwise, a *200 - OK* status code is returned, and the redirect doesn't occur on the client.</span></span>

<span data-ttu-id="bb0c3-355">*RewriteRules.cs*:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-355">*RewriteRules.cs*:</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/RewriteRules.cs?name=snippet_RedirectXmlFileRequests&highlight=14-18)]

<span data-ttu-id="bb0c3-356">Essa abordagem também pode reconfigurar as solicitações.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-356">This approach can also rewrite requests.</span></span> <span data-ttu-id="bb0c3-357">O aplicativo de exemplo demonstra a reconfiguração do caminho de qualquer solicitação de arquivo de texto para fornecer o arquivo de texto *file.txt* por meio da pasta *wwwroot*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-357">The sample app demonstrates rewriting the path for any text file request to serve the *file.txt* text file from the *wwwroot* folder.</span></span> <span data-ttu-id="bb0c3-358">O Middleware de Arquivo Estático fornece o arquivo com base no caminho de solicitação atualizado:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-358">Static File Middleware serves the file based on the updated request path:</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=15,22)]

<span data-ttu-id="bb0c3-359">*RewriteRules.cs*:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-359">*RewriteRules.cs*:</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/RewriteRules.cs?name=snippet_RewriteTextFileRequests&highlight=7-8)]

### <a name="irule-based-rule"></a><span data-ttu-id="bb0c3-360">Regra baseada em IRule</span><span class="sxs-lookup"><span data-stu-id="bb0c3-360">IRule-based rule</span></span>

<span data-ttu-id="bb0c3-361">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> para usar a lógica de regra em uma classe que implementa a interface <xref:Microsoft.AspNetCore.Rewrite.IRule>.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-361">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> to use rule logic in a class that implements the <xref:Microsoft.AspNetCore.Rewrite.IRule> interface.</span></span> <span data-ttu-id="bb0c3-362">`IRule` fornece maior flexibilidade em comparação ao uso da abordagem de regra baseada em método.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-362">`IRule` provides greater flexibility over using the method-based rule approach.</span></span> <span data-ttu-id="bb0c3-363">A classe de implementação pode incluir um construtor, que permite passar parâmetros para o método <xref:Microsoft.AspNetCore.Rewrite.IRule.ApplyRule*>.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-363">Your implementation class may include a constructor that allows you can pass in parameters for the <xref:Microsoft.AspNetCore.Rewrite.IRule.ApplyRule*> method.</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/Startup.cs?name=snippet1&highlight=16-17)]

<span data-ttu-id="bb0c3-364">Os valores dos parâmetros no aplicativo de exemplo para a `extension` e o `newPath` são verificados para atender a várias condições.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-364">The values of the parameters in the sample app for the `extension` and the `newPath` are checked to meet several conditions.</span></span> <span data-ttu-id="bb0c3-365">A `extension` precisa conter um valor que precisa ser *.png*, *.jpg* ou *.gif*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-365">The `extension` must contain a value, and the value must be *.png*, *.jpg*, or *.gif*.</span></span> <span data-ttu-id="bb0c3-366">Se o `newPath` não é válido, uma <xref:System.ArgumentException> é gerada.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-366">If the `newPath` isn't valid, an <xref:System.ArgumentException> is thrown.</span></span> <span data-ttu-id="bb0c3-367">Se uma solicitação é feita para *image.png*, a solicitação é redirecionada para `/png-images/image.png`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-367">If a request is made for *image.png*, the request is redirected to `/png-images/image.png`.</span></span> <span data-ttu-id="bb0c3-368">Se uma solicitação é feita para *image.jpg*, a solicitação é redirecionada para `/jpg-images/image.jpg`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-368">If a request is made for *image.jpg*, the request is redirected to `/jpg-images/image.jpg`.</span></span> <span data-ttu-id="bb0c3-369">O código de status é definido como *301 – Movido Permanentemente* e o `context.Result` é definida para parar o processamento de regras e enviar a resposta.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-369">The status code is set to *301 - Moved Permanently*, and the `context.Result` is set to stop processing rules and send the response.</span></span>

[!code-csharp[](url-rewriting/samples/3.x/SampleApp/RewriteRules.cs?name=snippet_RedirectImageRequests)]

<span data-ttu-id="bb0c3-370">Solicitação original: `/image.png`</span><span class="sxs-lookup"><span data-stu-id="bb0c3-370">Original Request: `/image.png`</span></span>

![Janela do navegador com as Ferramentas para Desenvolvedores acompanhando as solicitações e respostas para image.png](url-rewriting/_static/add_redirect_png_requests.png)

<span data-ttu-id="bb0c3-372">Solicitação original: `/image.jpg`</span><span class="sxs-lookup"><span data-stu-id="bb0c3-372">Original Request: `/image.jpg`</span></span>

![Janela do navegador com as Ferramentas para Desenvolvedores acompanhando as solicitações e respostas para image.jpg](url-rewriting/_static/add_redirect_jpg_requests.png)

## <a name="regex-examples"></a><span data-ttu-id="bb0c3-374">Exemplos do regex</span><span class="sxs-lookup"><span data-stu-id="bb0c3-374">Regex examples</span></span>

| <span data-ttu-id="bb0c3-375">Goal</span><span class="sxs-lookup"><span data-stu-id="bb0c3-375">Goal</span></span> | <span data-ttu-id="bb0c3-376">Cadeia de caracteres do regex &</span><span class="sxs-lookup"><span data-stu-id="bb0c3-376">Regex String &</span></span><br><span data-ttu-id="bb0c3-377">Exemplo de correspondência</span><span class="sxs-lookup"><span data-stu-id="bb0c3-377">Match Example</span></span> | <span data-ttu-id="bb0c3-378">Cadeia de caracteres de substituição &</span><span class="sxs-lookup"><span data-stu-id="bb0c3-378">Replacement String &</span></span><br><span data-ttu-id="bb0c3-379">Exemplo de saída</span><span class="sxs-lookup"><span data-stu-id="bb0c3-379">Output Example</span></span> |
| ---- | ------------------------------- | -------------------------------------- |
| <span data-ttu-id="bb0c3-380">Reconfigurar o caminho na cadeia de consulta</span><span class="sxs-lookup"><span data-stu-id="bb0c3-380">Rewrite path into querystring</span></span> | `^path/(.*)/(.*)`<br>`/path/abc/123` | `path?var1=$1&var2=$2`<br>`/path?var1=abc&var2=123` |
| <span data-ttu-id="bb0c3-381">Barra "/" à direita da faixa</span><span class="sxs-lookup"><span data-stu-id="bb0c3-381">Strip trailing slash</span></span> | `(.*)/$`<br>`/path/` | `$1`<br>`/path` |
| <span data-ttu-id="bb0c3-382">Impor barra "/" à direita</span><span class="sxs-lookup"><span data-stu-id="bb0c3-382">Enforce trailing slash</span></span> | `(.*[^/])$`<br>`/path` | `$1/`<br>`/path/` |
| <span data-ttu-id="bb0c3-383">Evitar a reconfiguração de solicitações específicas</span><span class="sxs-lookup"><span data-stu-id="bb0c3-383">Avoid rewriting specific requests</span></span> | <span data-ttu-id="bb0c3-384">`^(.*)(?<!\.axd)$` ou `^(?!.*\.axd$)(.*)$`</span><span class="sxs-lookup"><span data-stu-id="bb0c3-384">`^(.*)(?<!\.axd)$` or `^(?!.*\.axd$)(.*)$`</span></span><br><span data-ttu-id="bb0c3-385">Sim: `/resource.htm`</span><span class="sxs-lookup"><span data-stu-id="bb0c3-385">Yes: `/resource.htm`</span></span><br><span data-ttu-id="bb0c3-386">Não: `/resource.axd`</span><span class="sxs-lookup"><span data-stu-id="bb0c3-386">No: `/resource.axd`</span></span> | `rewritten/$1`<br>`/rewritten/resource.htm`<br>`/resource.axd` |
| <span data-ttu-id="bb0c3-387">Reorganizar segmentos de URL</span><span class="sxs-lookup"><span data-stu-id="bb0c3-387">Rearrange URL segments</span></span> | `path/(.*)/(.*)/(.*)`<br>`path/1/2/3` | `path/$3/$2/$1`<br>`path/3/2/1` |
| <span data-ttu-id="bb0c3-388">Substituir um segmento de URL</span><span class="sxs-lookup"><span data-stu-id="bb0c3-388">Replace a URL segment</span></span> | `^(.*)/segment2/(.*)`<br>`/segment1/segment2/segment3` | `$1/replaced/$2`<br>`/segment1/replaced/segment3` |

::: moniker-end

::: moniker range="< aspnetcore-3.0"

<span data-ttu-id="bb0c3-389">Este documento apresenta a reconfiguração de URL com instruções sobre como usar o Middleware de Reconfiguração de URL em aplicativos ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-389">This document introduces URL rewriting with instructions on how to use URL Rewriting Middleware in ASP.NET Core apps.</span></span>

<span data-ttu-id="bb0c3-390">A reconfiguração de URL é o ato de modificar URLs de solicitação com base em uma ou mais regras predefinidas.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-390">URL rewriting is the act of modifying request URLs based on one or more predefined rules.</span></span> <span data-ttu-id="bb0c3-391">A reconfiguração de URL cria uma abstração entre locais de recursos e seus endereços, de forma que os locais e os endereços não estejam totalmente vinculados.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-391">URL rewriting creates an abstraction between resource locations and their addresses so that the locations and addresses aren't tightly linked.</span></span> <span data-ttu-id="bb0c3-392">A reconfiguração de URL é útil em vários cenários para:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-392">URL rewriting is valuable in several scenarios to:</span></span>

* <span data-ttu-id="bb0c3-393">Mover ou substituir recursos de servidor temporária ou permanentemente e manter localizadores estáveis para esses recursos.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-393">Move or replace server resources temporarily or permanently and maintain stable locators for those resources.</span></span>
* <span data-ttu-id="bb0c3-394">Dividir o processamento de solicitação entre diferentes aplicativos ou áreas de um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-394">Split request processing across different apps or across areas of one app.</span></span>
* <span data-ttu-id="bb0c3-395">Remover, adicionar ou reorganizar segmentos de URL em solicitações de entrada.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-395">Remove, add, or reorganize URL segments on incoming requests.</span></span>
* <span data-ttu-id="bb0c3-396">Otimizar URLs públicas para SEO (Otimização do Mecanismo de Pesquisa).</span><span class="sxs-lookup"><span data-stu-id="bb0c3-396">Optimize public URLs for Search Engine Optimization (SEO).</span></span>
* <span data-ttu-id="bb0c3-397">Permitir o uso de URLs públicas amigáveis para ajudar os visitantes a prever o conteúdo retornado ao solicitar um recurso.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-397">Permit the use of friendly public URLs to help visitors predict the content returned by requesting a resource.</span></span>
* <span data-ttu-id="bb0c3-398">Redirecionar solicitações não seguras para pontos de extremidade seguros.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-398">Redirect insecure requests to secure endpoints.</span></span>
* <span data-ttu-id="bb0c3-399">Impedir o hotlink, em que um site externo usa um ativo estático hospedado em outro site vinculando o ativo ao seu próprio conteúdo.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-399">Prevent hotlinking, where an external site uses a hosted static asset on another site by linking the asset into its own content.</span></span>

> [!NOTE]
> <span data-ttu-id="bb0c3-400">A reconfiguração de URL pode reduzir o desempenho de um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-400">URL rewriting can reduce the performance of an app.</span></span> <span data-ttu-id="bb0c3-401">Sempre que possível, limite o número e a complexidade das regras.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-401">Where feasible, limit the number and complexity of rules.</span></span>

<span data-ttu-id="bb0c3-402">[Exibir ou baixar código de exemplo](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/) ([como baixar](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="bb0c3-402">[View or download sample code](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="url-redirect-and-url-rewrite"></a><span data-ttu-id="bb0c3-403">Redirecionamento e reconfiguração de URL</span><span class="sxs-lookup"><span data-stu-id="bb0c3-403">URL redirect and URL rewrite</span></span>

<span data-ttu-id="bb0c3-404">A diferença entre os termos *redirecionamento de URL* e *reconfiguração de URL* é sutil, mas tem implicações importantes no fornecimento de recursos aos clientes.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-404">The difference in wording between *URL redirect* and *URL rewrite* is subtle but has important implications for providing resources to clients.</span></span> <span data-ttu-id="bb0c3-405">O Middleware de Reconfiguração de URL do ASP.NET Core pode atender às necessidades de ambos.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-405">ASP.NET Core's URL Rewriting Middleware is capable of meeting the need for both.</span></span>

<span data-ttu-id="bb0c3-406">Um *redirecionamento de URL* envolve uma operação do lado do cliente, em que o cliente é instruído a acessar um recurso em um endereço diferente do que ele solicitou originalmente.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-406">A *URL redirect* involves a client-side operation, where the client is instructed to access a resource at a different address than the client originally requested.</span></span> <span data-ttu-id="bb0c3-407">Isso exige uma viagem de ida e volta para o servidor.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-407">This requires a round trip to the server.</span></span> <span data-ttu-id="bb0c3-408">A URL de redirecionamento retornada para o cliente é exibida na barra de endereços do navegador quando o cliente faz uma nova solicitação para o recurso.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-408">The redirect URL returned to the client appears in the browser's address bar when the client makes a new request for the resource.</span></span>

<span data-ttu-id="bb0c3-409">Se `/resource` é *redirecionado* para `/different-resource`, o servidor responde que o cliente deve obter o recurso em `/different-resource` com um código de status indicando que o redirecionamento é temporário ou permanente.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-409">If `/resource` is *redirected* to `/different-resource`, the server responds that the client should obtain the resource at `/different-resource` with a status code indicating that the redirect is either temporary or permanent.</span></span>

![Um ponto de extremidade de serviço WebAPI foi alterado temporariamente da versão 1 (v1) para a versão 2 (v2) no servidor.](url-rewriting/_static/url_redirect.png)

<span data-ttu-id="bb0c3-415">Ao redirecionar solicitações para uma URL diferente, indique se o redirecionamento é permanente ou temporário especificando o código de status com a resposta:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-415">When redirecting requests to a different URL, indicate whether the redirect is permanent or temporary by specifying the status code with the response:</span></span>

* <span data-ttu-id="bb0c3-416">O código de status *301 – Movido Permanentemente* é usado quando o recurso tem uma nova URL permanente e você deseja instruir o cliente que todas as solicitações futuras para o recurso devem usar a nova URL.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-416">The *301 - Moved Permanently* status code is used where the resource has a new, permanent URL and you wish to instruct the client that all future requests for the resource should use the new URL.</span></span> <span data-ttu-id="bb0c3-417">*O cliente pode armazenar a resposta em cache e reutilizá-la quando um código de status 301 é recebido.*</span><span class="sxs-lookup"><span data-stu-id="bb0c3-417">*The client may cache and reuse the response when a 301 status code is received.*</span></span>

* <span data-ttu-id="bb0c3-418">O código de status *302 – Encontrado* é usado quando o redirecionamento é temporário ou está geralmente sujeito a alterações.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-418">The *302 - Found* status code is used where the redirection is temporary or generally subject to change.</span></span> <span data-ttu-id="bb0c3-419">O código de status 302 indica para o cliente não armazenar a URL e usá-la no futuro.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-419">The 302 status code indicates to the client not to store the URL and use it in the future.</span></span>

<span data-ttu-id="bb0c3-420">Para obter mais informações sobre códigos de status, confira [RFC 2616: definições de código de status](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html).</span><span class="sxs-lookup"><span data-stu-id="bb0c3-420">For more information on status codes, see [RFC 2616: Status Code Definitions](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html).</span></span>

<span data-ttu-id="bb0c3-421">Uma *reconfiguração de URL* é uma operação do servidor que fornece um recurso de um endereço de recurso diferente do que o solicitado pelo cliente.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-421">A *URL rewrite* is a server-side operation that provides a resource from a different resource address than the client requested.</span></span> <span data-ttu-id="bb0c3-422">A reconfiguração de uma URL não exige uma viagem de ida e volta para o servidor.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-422">Rewriting a URL doesn't require a round trip to the server.</span></span> <span data-ttu-id="bb0c3-423">A URL reconfigurada não é retornada para o cliente e não é exibida na barra de endereços do navegador.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-423">The rewritten URL isn't returned to the client and doesn't appear in the browser's address bar.</span></span>

<span data-ttu-id="bb0c3-424">Se `/resource` é *reconfigurado* como `/different-resource`, o servidor efetua fetch *internamente* e retorna o recurso em `/different-resource`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-424">If `/resource` is *rewritten* to `/different-resource`, the server *internally* fetches and returns the resource at `/different-resource`.</span></span>

<span data-ttu-id="bb0c3-425">Embora o cliente possa ter a capacidade de recuperar o recurso na URL reconfigurada, ele não é informado de que o recurso existe na URL reconfigurada ao fazer a solicitação e receber a resposta.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-425">Although the client might be able to retrieve the resource at the rewritten URL, the client isn't informed that the resource exists at the rewritten URL when it makes its request and receives the response.</span></span>

![Um ponto de extremidade de serviço WebAPI foi alterado da versão 1 (v1) para a versão 2 (v2) no servidor.](url-rewriting/_static/url_rewrite.png)

## <a name="url-rewriting-sample-app"></a><span data-ttu-id="bb0c3-430">Aplicativo de exemplo de reconfiguração de URL</span><span class="sxs-lookup"><span data-stu-id="bb0c3-430">URL rewriting sample app</span></span>

<span data-ttu-id="bb0c3-431">Explore as funcionalidades do Middleware de Reconfiguração de URL com o [aplicativo de exemplo](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/).</span><span class="sxs-lookup"><span data-stu-id="bb0c3-431">You can explore the features of the URL Rewriting Middleware with the [sample app](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/).</span></span> <span data-ttu-id="bb0c3-432">O aplicativo aplica as regras de redirecionamento e reconfiguração e mostra a URL redirecionada ou reconfigurada para vários cenários.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-432">The app applies redirect and rewrite rules and shows the redirected or rewritten URL for several scenarios.</span></span>

## <a name="when-to-use-url-rewriting-middleware"></a><span data-ttu-id="bb0c3-433">Quando usar o Middleware de Reconfiguração de URL</span><span class="sxs-lookup"><span data-stu-id="bb0c3-433">When to use URL Rewriting Middleware</span></span>

<span data-ttu-id="bb0c3-434">Use o Middleware de Reconfiguração de URL quando não for possível usar as seguintes abordagens:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-434">Use URL Rewriting Middleware when you're unable to use the following approaches:</span></span>

* [<span data-ttu-id="bb0c3-435">Módulo de Reconfiguração de URL com o IIS no Windows Server</span><span class="sxs-lookup"><span data-stu-id="bb0c3-435">URL Rewrite module with IIS on Windows Server</span></span>](https://www.iis.net/downloads/microsoft/url-rewrite)
* [<span data-ttu-id="bb0c3-436">Módulo mod_rewrite do Apache no Apache Server</span><span class="sxs-lookup"><span data-stu-id="bb0c3-436">Apache mod_rewrite module on Apache Server</span></span>](https://httpd.apache.org/docs/2.4/rewrite/)
* [<span data-ttu-id="bb0c3-437">Reconfiguração de URL no Nginx</span><span class="sxs-lookup"><span data-stu-id="bb0c3-437">URL rewriting on Nginx</span></span>](https://www.nginx.com/blog/creating-nginx-rewrite-rules/)

<span data-ttu-id="bb0c3-438">Além disso, use o middleware quando o aplicativo estiver hospedado no [servidor HTTP.sys](xref:fundamentals/servers/httpsys) (anteriormente chamado WebListener).</span><span class="sxs-lookup"><span data-stu-id="bb0c3-438">Also, use the middleware when the app is hosted on [HTTP.sys server](xref:fundamentals/servers/httpsys) (formerly called WebListener).</span></span>

<span data-ttu-id="bb0c3-439">As principais razões para usar as tecnologias de reconfiguração de URL baseada em servidor no IIS, no Apache e no Nginx são:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-439">The main reasons to use the server-based URL rewriting technologies in IIS, Apache, and Nginx are:</span></span>

* <span data-ttu-id="bb0c3-440">O middleware não dá suporte às funcionalidades completas desses módulos.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-440">The middleware doesn't support the full features of these modules.</span></span>

  <span data-ttu-id="bb0c3-441">Algumas funcionalidades dos módulos de servidor não funcionam com projetos ASP.NET Core, como as restrições `IsFile` e `IsDirectory` do módulo de Reconfiguração do IIS.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-441">Some of the features of the server modules don't work with ASP.NET Core projects, such as the `IsFile` and `IsDirectory` constraints of the IIS Rewrite module.</span></span> <span data-ttu-id="bb0c3-442">Nesses cenários, use o middleware.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-442">In these scenarios, use the middleware instead.</span></span>
* <span data-ttu-id="bb0c3-443">O desempenho do middleware provavelmente não corresponde ao desempenho dos módulos.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-443">The performance of the middleware probably doesn't match that of the modules.</span></span>

  <span data-ttu-id="bb0c3-444">Os parâmetros de comparação são a única maneira de saber com certeza qual abordagem degrada mais o desempenho ou se a degradação de desempenho é insignificante.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-444">Benchmarking is the only way to know for sure which approach degrades performance the most or if degraded performance is negligible.</span></span>

## <a name="package"></a><span data-ttu-id="bb0c3-445">Pacote</span><span class="sxs-lookup"><span data-stu-id="bb0c3-445">Package</span></span>

<span data-ttu-id="bb0c3-446">Para incluir o middleware em seu projeto, adicione uma referência de pacote ao [metapacote Microsoft.AspNetCore.App](xref:fundamentals/metapackage-app) no arquivo de projeto, que contém o pacote [Microsoft.AspNetCore.Rewrite](https://www.nuget.org/packages/Microsoft.AspNetCore.Rewrite).</span><span class="sxs-lookup"><span data-stu-id="bb0c3-446">To include the middleware in your project, add a package reference to the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app) in the project file, which contains the [Microsoft.AspNetCore.Rewrite](https://www.nuget.org/packages/Microsoft.AspNetCore.Rewrite) package.</span></span>

<span data-ttu-id="bb0c3-447">Quando não estiver usando o metapacote `Microsoft.AspNetCore.App`, adicione uma referência de projeto ao pacote `Microsoft.AspNetCore.Rewrite`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-447">When not using the `Microsoft.AspNetCore.App` metapackage, add a project reference to the `Microsoft.AspNetCore.Rewrite` package.</span></span>

## <a name="extension-and-options"></a><span data-ttu-id="bb0c3-448">Extensão e opções</span><span class="sxs-lookup"><span data-stu-id="bb0c3-448">Extension and options</span></span>

<span data-ttu-id="bb0c3-449">Estabeleça regras de reconfiguração e redirecionamento de URL criando uma instância da classe [RewriteOptions](xref:Microsoft.AspNetCore.Rewrite.RewriteOptions) com métodos de extensão para cada uma das regras de reconfiguração.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-449">Establish URL rewrite and redirect rules by creating an instance of the [RewriteOptions](xref:Microsoft.AspNetCore.Rewrite.RewriteOptions) class with extension methods for each of your rewrite rules.</span></span> <span data-ttu-id="bb0c3-450">Encadeie várias regras na ordem em que deseja que sejam processadas.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-450">Chain multiple rules in the order that you would like them processed.</span></span> <span data-ttu-id="bb0c3-451">As `RewriteOptions` são passadas para o Middleware de Reconfiguração de URL, conforme ele é adicionado ao pipeline de solicitação com <xref:Microsoft.AspNetCore.Builder.RewriteBuilderExtensions.UseRewriter*>:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-451">The `RewriteOptions` are passed into the URL Rewriting Middleware as it's added to the request pipeline with <xref:Microsoft.AspNetCore.Builder.RewriteBuilderExtensions.UseRewriter*>:</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1)]

### <a name="redirect-non-www-to-www"></a><span data-ttu-id="bb0c3-452">Redirecionar não www para www</span><span class="sxs-lookup"><span data-stu-id="bb0c3-452">Redirect non-www to www</span></span>

<span data-ttu-id="bb0c3-453">Três opções permitem que o aplicativo redirecione solicitações não `www`para `www`:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-453">Three options permit the app to redirect non-`www` requests to `www`:</span></span>

* <span data-ttu-id="bb0c3-454"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWwwPermanent*>&ndash; Redirecione permanentemente a solicitação para `www` o subdomínio se a solicitação for não`www`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-454"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWwwPermanent*> &ndash; Permanently redirect the request to the `www` subdomain if the request is non-`www`.</span></span> <span data-ttu-id="bb0c3-455">Redireciona com um código de status [Status308PermanentRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status308PermanentRedirect).</span><span class="sxs-lookup"><span data-stu-id="bb0c3-455">Redirects with a [Status308PermanentRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status308PermanentRedirect) status code.</span></span>

* <span data-ttu-id="bb0c3-456"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWww*>&ndash; Redirecione a solicitação para `www` o subdomínio se a solicitação de entrada for`www`não.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-456"><xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToWww*> &ndash; Redirect the request to the `www` subdomain if the incoming request is non-`www`.</span></span> <span data-ttu-id="bb0c3-457">Redireciona com um código de status [Status307TemporaryRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status307TemporaryRedirect).</span><span class="sxs-lookup"><span data-stu-id="bb0c3-457">Redirects with a [Status307TemporaryRedirect](xref:Microsoft.AspNetCore.Http.StatusCodes.Status307TemporaryRedirect) status code.</span></span> <span data-ttu-id="bb0c3-458">Uma sobrecarga permite que você forneça o código de status para a resposta.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-458">An overload permits you to provide the status code for the response.</span></span> <span data-ttu-id="bb0c3-459">Use um campo da classe <xref:Microsoft.AspNetCore.Http.StatusCodes> para uma atribuição de código de status.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-459">Use a field of the <xref:Microsoft.AspNetCore.Http.StatusCodes> class for a status code assignment.</span></span>

### <a name="url-redirect"></a><span data-ttu-id="bb0c3-460">Redirecionamento de URL</span><span class="sxs-lookup"><span data-stu-id="bb0c3-460">URL redirect</span></span>

<span data-ttu-id="bb0c3-461">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirect*> para redirecionar as solicitações.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-461">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirect*> to redirect requests.</span></span> <span data-ttu-id="bb0c3-462">O primeiro parâmetro contém o regex para correspondência no caminho da URL de entrada.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-462">The first parameter contains your regex for matching on the path of the incoming URL.</span></span> <span data-ttu-id="bb0c3-463">O segundo parâmetro é a cadeia de caracteres de substituição.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-463">The second parameter is the replacement string.</span></span> <span data-ttu-id="bb0c3-464">O terceiro parâmetro, se presente, especifica o código de status.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-464">The third parameter, if present, specifies the status code.</span></span> <span data-ttu-id="bb0c3-465">Se você não especificar o código de status, ele usará como padrão *302 – Encontrado*, que indica que o recurso foi substituído ou movido temporariamente.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-465">If you don't specify the status code, the status code defaults to *302 - Found*, which indicates that the resource is temporarily moved or replaced.</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=9)]

<span data-ttu-id="bb0c3-466">Em um navegador com as ferramentas para desenvolvedores habilitadas, faça uma solicitação para o aplicativo de exemplo com o caminho `/redirect-rule/1234/5678`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-466">In a browser with developer tools enabled, make a request to the sample app with the path `/redirect-rule/1234/5678`.</span></span> <span data-ttu-id="bb0c3-467">O regex corresponde ao caminho de solicitação em `redirect-rule/(.*)` e o caminho é substituído por `/redirected/1234/5678`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-467">The regex matches the request path on `redirect-rule/(.*)`, and the path is replaced with `/redirected/1234/5678`.</span></span> <span data-ttu-id="bb0c3-468">A URL de redirecionamento é enviada novamente ao cliente com um código de status *302 – Encontrado*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-468">The redirect URL is sent back to the client with a *302 - Found* status code.</span></span> <span data-ttu-id="bb0c3-469">O navegador faz uma nova solicitação na URL de redirecionamento, que é exibida na barra de endereços do navegador.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-469">The browser makes a new request at the redirect URL, which appears in the browser's address bar.</span></span> <span data-ttu-id="bb0c3-470">Como não há nenhuma correspondência de regras no aplicativo de exemplo na URL de redirecionamento:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-470">Since no rules in the sample app match on the redirect URL:</span></span>

* <span data-ttu-id="bb0c3-471">A segunda solicitação recebe uma resposta *200 – OK* do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-471">The second request receives a *200 - OK* response from the app.</span></span>
* <span data-ttu-id="bb0c3-472">O corpo da resposta mostra a URL de redirecionamento.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-472">The body of the response shows the redirect URL.</span></span>

<span data-ttu-id="bb0c3-473">Uma viagem de ida e volta é feita para o servidor quando uma URL é *redirecionada*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-473">A round trip is made to the server when a URL is *redirected*.</span></span>

> [!WARNING]
> <span data-ttu-id="bb0c3-474">Tenha cuidado ao estabelecer regras de redirecionamento.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-474">Be cautious when establishing redirect rules.</span></span> <span data-ttu-id="bb0c3-475">As regras de redirecionamento são avaliadas em cada solicitação para o aplicativo, incluindo após um redirecionamento.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-475">Redirect rules are evaluated on every request to the app, including after a redirect.</span></span> <span data-ttu-id="bb0c3-476">É fácil criar acidentalmente um *loop de redirecionamentos infinitos*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-476">It's easy to accidentally create a *loop of infinite redirects*.</span></span>

<span data-ttu-id="bb0c3-477">Solicitação original: `/redirect-rule/1234/5678`</span><span class="sxs-lookup"><span data-stu-id="bb0c3-477">Original Request: `/redirect-rule/1234/5678`</span></span>

![Janela do navegador com as Ferramentas para Desenvolvedores acompanhando as solicitações e respostas](url-rewriting/_static/add_redirect.png)

<span data-ttu-id="bb0c3-479">A parte da expressão contida nos parênteses é chamada um *grupo de captura*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-479">The part of the expression contained within parentheses is called a *capture group*.</span></span> <span data-ttu-id="bb0c3-480">O ponto (`.`) da expressão significa *corresponder a qualquer caractere*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-480">The dot (`.`) of the expression means *match any character*.</span></span> <span data-ttu-id="bb0c3-481">O asterisco (`*`) indica *corresponder ao caractere zero precedente ou mais vezes*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-481">The asterisk (`*`) indicates *match the preceding character zero or more times*.</span></span> <span data-ttu-id="bb0c3-482">Portanto, os dois últimos segmentos de caminho da URL, `1234/5678`, são capturados pelo grupo de captura `(.*)`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-482">Therefore, the last two path segments of the URL, `1234/5678`, are captured by capture group `(.*)`.</span></span> <span data-ttu-id="bb0c3-483">Qualquer valor que você fornecer na URL de solicitação após `redirect-rule/` é capturado por esse único grupo de captura.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-483">Any value you provide in the request URL after `redirect-rule/` is captured by this single capture group.</span></span>

<span data-ttu-id="bb0c3-484">Na cadeia de caracteres de substituição, os grupos capturados são injetados na cadeia de caracteres com o cifrão (`$`) seguido do número de sequência da captura.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-484">In the replacement string, captured groups are injected into the string with the dollar sign (`$`) followed by the sequence number of the capture.</span></span> <span data-ttu-id="bb0c3-485">O primeiro valor de grupo de captura é obtido com `$1`, o segundo com `$2` e eles continuam em sequência para os grupos de captura no regex.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-485">The first capture group value is obtained with `$1`, the second with `$2`, and they continue in sequence for the capture groups in your regex.</span></span> <span data-ttu-id="bb0c3-486">Há apenas um grupo capturado no regex da regra de redirecionamento no aplicativo de exemplo, para que haja apenas um grupo injetado na cadeia de caracteres de substituição, que é `$1`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-486">There's only one captured group in the redirect rule regex in the sample app, so there's only one injected group in the replacement string, which is `$1`.</span></span> <span data-ttu-id="bb0c3-487">Quando a regra é aplicada, a URL se torna `/redirected/1234/5678`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-487">When the rule is applied, the URL becomes `/redirected/1234/5678`.</span></span>

### <a name="url-redirect-to-a-secure-endpoint"></a><span data-ttu-id="bb0c3-488">Redirecionamento de URL para um ponto de extremidade seguro</span><span class="sxs-lookup"><span data-stu-id="bb0c3-488">URL redirect to a secure endpoint</span></span>

<span data-ttu-id="bb0c3-489">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttps*> para redirecionar solicitações HTTP para o mesmo host e caminho usando o protocolo HTTPS.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-489">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttps*> to redirect HTTP requests to the same host and path using the HTTPS protocol.</span></span> <span data-ttu-id="bb0c3-490">Se o código de status não for fornecido, o middleware usará como padrão *302 – Encontrado*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-490">If the status code isn't supplied, the middleware defaults to *302 - Found*.</span></span> <span data-ttu-id="bb0c3-491">Se a porta não for fornecida:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-491">If the port isn't supplied:</span></span>

* <span data-ttu-id="bb0c3-492">O middleware usará como padrão `null`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-492">The middleware defaults to `null`.</span></span>
* <span data-ttu-id="bb0c3-493">O esquema será alterado para `https` (protocolo HTTPS), e o cliente acessará o recurso na porta 443.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-493">The scheme changes to `https` (HTTPS protocol), and the client accesses the resource on port 443.</span></span>

<span data-ttu-id="bb0c3-494">O exemplo a seguir mostra como definir o código de status como *301 –Movido Permanentemente* e alterar a porta para 5001.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-494">The following example shows how to set the status code to *301 - Moved Permanently* and change the port to 5001.</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    var options = new RewriteOptions()
        .AddRedirectToHttps(301, 5001);

    app.UseRewriter(options);
}
```

<span data-ttu-id="bb0c3-495">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttpsPermanent*> para redirecionar solicitações não seguras para o mesmo host e caminho com o protocolo HTTPS seguro na porta 443.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-495">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRedirectToHttpsPermanent*> to redirect insecure requests to the same host and path with secure HTTPS protocol on port 443.</span></span> <span data-ttu-id="bb0c3-496">O middleware define o código de status como *301 – Movido Permanentemente*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-496">The middleware sets the status code to *301 - Moved Permanently*.</span></span>

```csharp
public void Configure(IApplicationBuilder app)
{
    var options = new RewriteOptions()
        .AddRedirectToHttpsPermanent();

    app.UseRewriter(options);
}
```

> [!NOTE]
> <span data-ttu-id="bb0c3-497">Ao redirecionar para um ponto de extremidade seguro sem a necessidade de regras de redirecionamento adicionais, recomendamos o uso do Middleware de Redirecionamento HTTPS.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-497">When redirecting to a secure endpoint without the requirement for additional redirect rules, we recommend using HTTPS Redirection Middleware.</span></span> <span data-ttu-id="bb0c3-498">Para obter mais informações, veja o tópico [Impor HTTPS](xref:security/enforcing-ssl#require-https).</span><span class="sxs-lookup"><span data-stu-id="bb0c3-498">For more information, see the [Enforce HTTPS](xref:security/enforcing-ssl#require-https) topic.</span></span>

<span data-ttu-id="bb0c3-499">O aplicativo de exemplo pode demonstrar como usar `AddRedirectToHttps` ou `AddRedirectToHttpsPermanent`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-499">The sample app is capable of demonstrating how to use `AddRedirectToHttps` or `AddRedirectToHttpsPermanent`.</span></span> <span data-ttu-id="bb0c3-500">Adicione o método de extensão às `RewriteOptions`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-500">Add the extension method to the `RewriteOptions`.</span></span> <span data-ttu-id="bb0c3-501">Faça uma solicitação não segura para o aplicativo em qualquer URL.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-501">Make an insecure request to the app at any URL.</span></span> <span data-ttu-id="bb0c3-502">Ignore o aviso de segurança do navegador de que o certificado autoassinado não é confiável ou crie uma exceção para confiar no certificado.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-502">Dismiss the browser security warning that the self-signed certificate is untrusted or create an exception to trust the certificate.</span></span>

<span data-ttu-id="bb0c3-503">Solicitação original usando `AddRedirectToHttps(301, 5001)`: `http://localhost:5000/secure`</span><span class="sxs-lookup"><span data-stu-id="bb0c3-503">Original Request using `AddRedirectToHttps(301, 5001)`: `http://localhost:5000/secure`</span></span>

![Janela do navegador com as Ferramentas para Desenvolvedores acompanhando as solicitações e respostas](url-rewriting/_static/add_redirect_to_https.png)

<span data-ttu-id="bb0c3-505">Solicitação original usando `AddRedirectToHttpsPermanent`: `http://localhost:5000/secure`</span><span class="sxs-lookup"><span data-stu-id="bb0c3-505">Original Request using `AddRedirectToHttpsPermanent`: `http://localhost:5000/secure`</span></span>

![Janela do navegador com as Ferramentas para Desenvolvedores acompanhando as solicitações e respostas](url-rewriting/_static/add_redirect_to_https_permanent.png)

### <a name="url-rewrite"></a><span data-ttu-id="bb0c3-507">Reconfiguração de URL</span><span class="sxs-lookup"><span data-stu-id="bb0c3-507">URL rewrite</span></span>

<span data-ttu-id="bb0c3-508">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRewrite*> para criar uma regra para a reconfiguração de URLs.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-508">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.AddRewrite*> to create a rule for rewriting URLs.</span></span> <span data-ttu-id="bb0c3-509">O primeiro parâmetro contém o regex para correspondência no caminho da URL de entrada.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-509">The first parameter contains the regex for matching on the incoming URL path.</span></span> <span data-ttu-id="bb0c3-510">O segundo parâmetro é a cadeia de caracteres de substituição.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-510">The second parameter is the replacement string.</span></span> <span data-ttu-id="bb0c3-511">O terceiro parâmetro, `skipRemainingRules: {true|false}`, indica para o middleware se ele deve ou não ignorar regras de reconfiguração adicionais se a regra atual é aplicada.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-511">The third parameter, `skipRemainingRules: {true|false}`, indicates to the middleware whether or not to skip additional rewrite rules if the current rule is applied.</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=10-11)]

<span data-ttu-id="bb0c3-512">Solicitação original: `/rewrite-rule/1234/5678`</span><span class="sxs-lookup"><span data-stu-id="bb0c3-512">Original Request: `/rewrite-rule/1234/5678`</span></span>

![Janela do navegador com as Ferramentas para Desenvolvedores acompanhando a solicitação e resposta](url-rewriting/_static/add_rewrite.png)

<span data-ttu-id="bb0c3-514">O acento circunflexo (`^`) no início da expressão significa que a correspondência começa no início do caminho da URL.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-514">The carat (`^`) at the beginning of the expression means that matching starts at the beginning of the URL path.</span></span>

<span data-ttu-id="bb0c3-515">No exemplo anterior com a regra de redirecionamento, `redirect-rule/(.*)`, não há nenhum acento circunflexo (`^`) no início do regex.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-515">In the earlier example with the redirect rule, `redirect-rule/(.*)`, there's no carat (`^`) at the start of the regex.</span></span> <span data-ttu-id="bb0c3-516">Portanto, qualquer caractere pode preceder `redirect-rule/` no caminho para uma correspondência com êxito.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-516">Therefore, any characters may precede `redirect-rule/` in the path for a successful match.</span></span>

| <span data-ttu-id="bb0c3-517">Caminho</span><span class="sxs-lookup"><span data-stu-id="bb0c3-517">Path</span></span>                               | <span data-ttu-id="bb0c3-518">Correspondência</span><span class="sxs-lookup"><span data-stu-id="bb0c3-518">Match</span></span> |
| ---------------------------------- | :---: |
| `/redirect-rule/1234/5678`         | <span data-ttu-id="bb0c3-519">Sim</span><span class="sxs-lookup"><span data-stu-id="bb0c3-519">Yes</span></span>   |
| `/my-cool-redirect-rule/1234/5678` | <span data-ttu-id="bb0c3-520">Sim</span><span class="sxs-lookup"><span data-stu-id="bb0c3-520">Yes</span></span>   |
| `/anotherredirect-rule/1234/5678`  | <span data-ttu-id="bb0c3-521">Sim</span><span class="sxs-lookup"><span data-stu-id="bb0c3-521">Yes</span></span>   |

<span data-ttu-id="bb0c3-522">A regra de reconfiguração, `^rewrite-rule/(\d+)/(\d+)`, corresponde apenas a caminhos se eles são iniciados com `rewrite-rule/`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-522">The rewrite rule, `^rewrite-rule/(\d+)/(\d+)`, only matches paths if they start with `rewrite-rule/`.</span></span> <span data-ttu-id="bb0c3-523">Na tabela a seguir, observe a diferença na correspondência.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-523">In the following table, note the difference in matching.</span></span>

| <span data-ttu-id="bb0c3-524">Caminho</span><span class="sxs-lookup"><span data-stu-id="bb0c3-524">Path</span></span>                              | <span data-ttu-id="bb0c3-525">Correspondência</span><span class="sxs-lookup"><span data-stu-id="bb0c3-525">Match</span></span> |
| --------------------------------- | :---: |
| `/rewrite-rule/1234/5678`         | <span data-ttu-id="bb0c3-526">Sim</span><span class="sxs-lookup"><span data-stu-id="bb0c3-526">Yes</span></span>   |
| `/my-cool-rewrite-rule/1234/5678` | <span data-ttu-id="bb0c3-527">Não</span><span class="sxs-lookup"><span data-stu-id="bb0c3-527">No</span></span>    |
| `/anotherrewrite-rule/1234/5678`  | <span data-ttu-id="bb0c3-528">Não</span><span class="sxs-lookup"><span data-stu-id="bb0c3-528">No</span></span>    |

<span data-ttu-id="bb0c3-529">Após a parte `^rewrite-rule/` da expressão, há dois grupos de captura, `(\d+)/(\d+)`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-529">Following the `^rewrite-rule/` portion of the expression, there are two capture groups, `(\d+)/(\d+)`.</span></span> <span data-ttu-id="bb0c3-530">O `\d` significa *corresponder a um dígito (número)*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-530">The `\d` signifies *match a digit (number)*.</span></span> <span data-ttu-id="bb0c3-531">O sinal de adição (`+`) significa *corresponder a um ou mais caracteres anteriores*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-531">The plus sign (`+`) means *match one or more of the preceding character*.</span></span> <span data-ttu-id="bb0c3-532">Portanto, a URL precisa conter um número seguido de uma barra "/" seguida de outro número.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-532">Therefore, the URL must contain a number followed by a forward-slash followed by another number.</span></span> <span data-ttu-id="bb0c3-533">Esses grupos de captura são injetados na URL reconfigurada como `$1` e `$2`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-533">These capture groups are injected into the rewritten URL as `$1` and `$2`.</span></span> <span data-ttu-id="bb0c3-534">A cadeia de caracteres de substituição da regra de reconfiguração coloca os grupos capturados na cadeia de consulta.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-534">The rewrite rule replacement string places the captured groups into the query string.</span></span> <span data-ttu-id="bb0c3-535">O caminho solicitado de `/rewrite-rule/1234/5678` foi reconfigurado para obter o recurso em `/rewritten?var1=1234&var2=5678`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-535">The requested path of `/rewrite-rule/1234/5678` is rewritten to obtain the resource at `/rewritten?var1=1234&var2=5678`.</span></span> <span data-ttu-id="bb0c3-536">Se uma cadeia de consulta estiver presente na solicitação original, ela será preservada quando a URL for reconfigurada.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-536">If a query string is present on the original request, it's preserved when the URL is rewritten.</span></span>

<span data-ttu-id="bb0c3-537">Não há nenhuma viagem de ida e volta para o servidor para obtenção do recurso.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-537">There's no round trip to the server to obtain the resource.</span></span> <span data-ttu-id="bb0c3-538">Se o recurso existir, ele será buscado e retornado para o cliente com um código de status *200 – OK*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-538">If the resource exists, it's fetched and returned to the client with a *200 - OK* status code.</span></span> <span data-ttu-id="bb0c3-539">Como o cliente não é redirecionado, a URL na barra de endereços do navegador não é alterada.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-539">Because the client isn't redirected, the URL in the browser's address bar doesn't change.</span></span> <span data-ttu-id="bb0c3-540">Os clientes não conseguem detectar que uma operação de reconfiguração de URL ocorreu no servidor.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-540">Clients can't detect that a URL rewrite operation occurred on the server.</span></span>

> [!NOTE]
> <span data-ttu-id="bb0c3-541">Use `skipRemainingRules: true` sempre que possível, porque as regras de correspondência são computacionalmente caras e aumentam o tempo de resposta do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-541">Use `skipRemainingRules: true` whenever possible because matching rules is computationally expensive and increases app response time.</span></span> <span data-ttu-id="bb0c3-542">Para a resposta mais rápida do aplicativo:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-542">For the fastest app response:</span></span>
>
> * <span data-ttu-id="bb0c3-543">Ordene as regras de reconfiguração da regra com correspondência mais frequente para a regra com correspondência menos frequente.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-543">Order rewrite rules from the most frequently matched rule to the least frequently matched rule.</span></span>
> * <span data-ttu-id="bb0c3-544">Ignore o processamento das regras restantes quando ocorrer uma correspondência e nenhum processamento de regra adicional for necessário.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-544">Skip the processing of the remaining rules when a match occurs and no additional rule processing is required.</span></span>

### <a name="apache-mod_rewrite"></a><span data-ttu-id="bb0c3-545">mod_rewrite do Apache</span><span class="sxs-lookup"><span data-stu-id="bb0c3-545">Apache mod_rewrite</span></span>

<span data-ttu-id="bb0c3-546">Aplique as regras do mod_rewrite do Apache com <xref:Microsoft.AspNetCore.Rewrite.ApacheModRewriteOptionsExtensions.AddApacheModRewrite*>.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-546">Apply Apache mod_rewrite rules with <xref:Microsoft.AspNetCore.Rewrite.ApacheModRewriteOptionsExtensions.AddApacheModRewrite*>.</span></span> <span data-ttu-id="bb0c3-547">Verifique se o arquivo de regras foi implantado com o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-547">Make sure that the rules file is deployed with the app.</span></span> <span data-ttu-id="bb0c3-548">Para obter mais informações e exemplos de regras de mod_rewrite, consulte [mod_rewrite do Apache](https://httpd.apache.org/docs/2.4/rewrite/).</span><span class="sxs-lookup"><span data-stu-id="bb0c3-548">For more information and examples of mod_rewrite rules, see [Apache mod_rewrite](https://httpd.apache.org/docs/2.4/rewrite/).</span></span>

<span data-ttu-id="bb0c3-549">Um <xref:System.IO.StreamReader> é usado para ler as regras do arquivo de regras *ApacheModRewrite.txt*:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-549">A <xref:System.IO.StreamReader> is used to read the rules from the *ApacheModRewrite.txt* rules file:</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=3-4,12)]

<span data-ttu-id="bb0c3-550">O aplicativo de exemplo redireciona solicitações de `/apache-mod-rules-redirect/(.\*)` para `/redirected?id=$1`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-550">The sample app redirects requests from `/apache-mod-rules-redirect/(.\*)` to `/redirected?id=$1`.</span></span> <span data-ttu-id="bb0c3-551">O código de status da resposta é *302 – Encontrado*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-551">The response status code is *302 - Found*.</span></span>

[!code[](url-rewriting/samples/2.x/SampleApp/ApacheModRewrite.txt)]

<span data-ttu-id="bb0c3-552">Solicitação original: `/apache-mod-rules-redirect/1234`</span><span class="sxs-lookup"><span data-stu-id="bb0c3-552">Original Request: `/apache-mod-rules-redirect/1234`</span></span>

![Janela do navegador com as Ferramentas para Desenvolvedores acompanhando as solicitações e respostas](url-rewriting/_static/add_apache_mod_redirect.png)

<span data-ttu-id="bb0c3-554">O middleware dá suporte às seguintes variáveis de servidor do mod_rewrite do Apache:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-554">The middleware supports the following Apache mod_rewrite server variables:</span></span>

* <span data-ttu-id="bb0c3-555">CONN_REMOTE_ADDR</span><span class="sxs-lookup"><span data-stu-id="bb0c3-555">CONN_REMOTE_ADDR</span></span>
* <span data-ttu-id="bb0c3-556">HTTP_ACCEPT</span><span class="sxs-lookup"><span data-stu-id="bb0c3-556">HTTP_ACCEPT</span></span>
* <span data-ttu-id="bb0c3-557">HTTP_CONNECTION</span><span class="sxs-lookup"><span data-stu-id="bb0c3-557">HTTP_CONNECTION</span></span>
* <span data-ttu-id="bb0c3-558">HTTP_COOKIE</span><span class="sxs-lookup"><span data-stu-id="bb0c3-558">HTTP_COOKIE</span></span>
* <span data-ttu-id="bb0c3-559">HTTP_FORWARDED</span><span class="sxs-lookup"><span data-stu-id="bb0c3-559">HTTP_FORWARDED</span></span>
* <span data-ttu-id="bb0c3-560">HTTP_HOST</span><span class="sxs-lookup"><span data-stu-id="bb0c3-560">HTTP_HOST</span></span>
* <span data-ttu-id="bb0c3-561">HTTP_REFERER</span><span class="sxs-lookup"><span data-stu-id="bb0c3-561">HTTP_REFERER</span></span>
* <span data-ttu-id="bb0c3-562">HTTP_USER_AGENT</span><span class="sxs-lookup"><span data-stu-id="bb0c3-562">HTTP_USER_AGENT</span></span>
* <span data-ttu-id="bb0c3-563">HTTPS</span><span class="sxs-lookup"><span data-stu-id="bb0c3-563">HTTPS</span></span>
* <span data-ttu-id="bb0c3-564">IPV6</span><span class="sxs-lookup"><span data-stu-id="bb0c3-564">IPV6</span></span>
* <span data-ttu-id="bb0c3-565">QUERY_STRING</span><span class="sxs-lookup"><span data-stu-id="bb0c3-565">QUERY_STRING</span></span>
* <span data-ttu-id="bb0c3-566">REMOTE_ADDR</span><span class="sxs-lookup"><span data-stu-id="bb0c3-566">REMOTE_ADDR</span></span>
* <span data-ttu-id="bb0c3-567">REMOTE_PORT</span><span class="sxs-lookup"><span data-stu-id="bb0c3-567">REMOTE_PORT</span></span>
* <span data-ttu-id="bb0c3-568">REQUEST_FILENAME</span><span class="sxs-lookup"><span data-stu-id="bb0c3-568">REQUEST_FILENAME</span></span>
* <span data-ttu-id="bb0c3-569">REQUEST_METHOD</span><span class="sxs-lookup"><span data-stu-id="bb0c3-569">REQUEST_METHOD</span></span>
* <span data-ttu-id="bb0c3-570">REQUEST_SCHEME</span><span class="sxs-lookup"><span data-stu-id="bb0c3-570">REQUEST_SCHEME</span></span>
* <span data-ttu-id="bb0c3-571">REQUEST_URI</span><span class="sxs-lookup"><span data-stu-id="bb0c3-571">REQUEST_URI</span></span>
* <span data-ttu-id="bb0c3-572">SCRIPT_FILENAME</span><span class="sxs-lookup"><span data-stu-id="bb0c3-572">SCRIPT_FILENAME</span></span>
* <span data-ttu-id="bb0c3-573">SERVER_ADDR</span><span class="sxs-lookup"><span data-stu-id="bb0c3-573">SERVER_ADDR</span></span>
* <span data-ttu-id="bb0c3-574">SERVER_PORT</span><span class="sxs-lookup"><span data-stu-id="bb0c3-574">SERVER_PORT</span></span>
* <span data-ttu-id="bb0c3-575">SERVER_PROTOCOL</span><span class="sxs-lookup"><span data-stu-id="bb0c3-575">SERVER_PROTOCOL</span></span>
* <span data-ttu-id="bb0c3-576">TIME</span><span class="sxs-lookup"><span data-stu-id="bb0c3-576">TIME</span></span>
* <span data-ttu-id="bb0c3-577">TIME_DAY</span><span class="sxs-lookup"><span data-stu-id="bb0c3-577">TIME_DAY</span></span>
* <span data-ttu-id="bb0c3-578">TIME_HOUR</span><span class="sxs-lookup"><span data-stu-id="bb0c3-578">TIME_HOUR</span></span>
* <span data-ttu-id="bb0c3-579">TIME_MIN</span><span class="sxs-lookup"><span data-stu-id="bb0c3-579">TIME_MIN</span></span>
* <span data-ttu-id="bb0c3-580">TIME_MON</span><span class="sxs-lookup"><span data-stu-id="bb0c3-580">TIME_MON</span></span>
* <span data-ttu-id="bb0c3-581">TIME_SEC</span><span class="sxs-lookup"><span data-stu-id="bb0c3-581">TIME_SEC</span></span>
* <span data-ttu-id="bb0c3-582">TIME_WDAY</span><span class="sxs-lookup"><span data-stu-id="bb0c3-582">TIME_WDAY</span></span>
* <span data-ttu-id="bb0c3-583">TIME_YEAR</span><span class="sxs-lookup"><span data-stu-id="bb0c3-583">TIME_YEAR</span></span>

### <a name="iis-url-rewrite-module-rules"></a><span data-ttu-id="bb0c3-584">Regras do Módulo de Reconfiguração de URL do IIS</span><span class="sxs-lookup"><span data-stu-id="bb0c3-584">IIS URL Rewrite Module rules</span></span>

<span data-ttu-id="bb0c3-585">Para usar o mesmo conjunto de regras que se aplica ao Módulo de Reconfiguração de URL do IIS, use <xref:Microsoft.AspNetCore.Rewrite.IISUrlRewriteOptionsExtensions.AddIISUrlRewrite*>.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-585">To use the same rule set that applies to the IIS URL Rewrite Module, use <xref:Microsoft.AspNetCore.Rewrite.IISUrlRewriteOptionsExtensions.AddIISUrlRewrite*>.</span></span> <span data-ttu-id="bb0c3-586">Verifique se o arquivo de regras foi implantado com o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-586">Make sure that the rules file is deployed with the app.</span></span> <span data-ttu-id="bb0c3-587">Não instrua o middleware a usar o arquivo *web.config* do aplicativo quando ele estiver em execução no IIS do Windows Server.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-587">Don't direct the middleware to use the app's *web.config* file when running on Windows Server IIS.</span></span> <span data-ttu-id="bb0c3-588">Com o IIS, essas regras devem ser armazenadas fora do arquivo *web.config* do aplicativo para evitar conflitos com o módulo de Reconfiguração do IIS.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-588">With IIS, these rules should be stored outside of the app's *web.config* file in order to avoid conflicts with the IIS Rewrite module.</span></span> <span data-ttu-id="bb0c3-589">Para obter mais informações e exemplos de regras do Módulo de Reconfiguração de URL do IIS, consulte [Usando o Módulo de Reconfiguração de URL 2.0](/iis/extensions/url-rewrite-module/using-url-rewrite-module-20) e [Referência de configuração do Módulo de Reconfiguração de URL](/iis/extensions/url-rewrite-module/url-rewrite-module-configuration-reference).</span><span class="sxs-lookup"><span data-stu-id="bb0c3-589">For more information and examples of IIS URL Rewrite Module rules, see [Using Url Rewrite Module 2.0](/iis/extensions/url-rewrite-module/using-url-rewrite-module-20) and [URL Rewrite Module Configuration Reference](/iis/extensions/url-rewrite-module/url-rewrite-module-configuration-reference).</span></span>

<span data-ttu-id="bb0c3-590">Um <xref:System.IO.StreamReader> é usado para ler as regras do arquivo de regras *IISUrlRewrite.xml*:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-590">A <xref:System.IO.StreamReader> is used to read the rules from the *IISUrlRewrite.xml* rules file:</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=5-6,13)]

<span data-ttu-id="bb0c3-591">O aplicativo de exemplo reconfigura as solicitações de `/iis-rules-rewrite/(.*)` para `/rewritten?id=$1`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-591">The sample app rewrites requests from `/iis-rules-rewrite/(.*)` to `/rewritten?id=$1`.</span></span> <span data-ttu-id="bb0c3-592">A resposta é enviada ao cliente com um código de status *200 – OK*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-592">The response is sent to the client with a *200 - OK* status code.</span></span>

[!code-xml[](url-rewriting/samples/2.x/SampleApp/IISUrlRewrite.xml)]

<span data-ttu-id="bb0c3-593">Solicitação original: `/iis-rules-rewrite/1234`</span><span class="sxs-lookup"><span data-stu-id="bb0c3-593">Original Request: `/iis-rules-rewrite/1234`</span></span>

![Janela do navegador com as Ferramentas para Desenvolvedores acompanhando a solicitação e resposta](url-rewriting/_static/add_iis_url_rewrite.png)

<span data-ttu-id="bb0c3-595">Caso você tenha um Módulo de Reconfiguração do IIS ativo com regras no nível do servidor configuradas que poderiam afetar o aplicativo de maneiras indesejadas, desabilite o Módulo de Reconfiguração do IIS em um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-595">If you have an active IIS Rewrite Module with server-level rules configured that would impact your app in undesirable ways, you can disable the IIS Rewrite Module for an app.</span></span> <span data-ttu-id="bb0c3-596">Para obter mais informações, consulte [Desabilitando módulos do IIS](xref:host-and-deploy/iis/modules#disabling-iis-modules).</span><span class="sxs-lookup"><span data-stu-id="bb0c3-596">For more information, see [Disabling IIS modules](xref:host-and-deploy/iis/modules#disabling-iis-modules).</span></span>

#### <a name="unsupported-features"></a><span data-ttu-id="bb0c3-597">Recursos sem suporte</span><span class="sxs-lookup"><span data-stu-id="bb0c3-597">Unsupported features</span></span>

<span data-ttu-id="bb0c3-598">O middleware liberado com o ASP.NET Core 2.x não dá suporte aos seguintes recursos do Módulo de Reconfiguração de URL do IIS:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-598">The middleware released with ASP.NET Core 2.x doesn't support the following IIS URL Rewrite Module features:</span></span>

* <span data-ttu-id="bb0c3-599">Regras de saída</span><span class="sxs-lookup"><span data-stu-id="bb0c3-599">Outbound Rules</span></span>
* <span data-ttu-id="bb0c3-600">Variáveis de servidor personalizadas</span><span class="sxs-lookup"><span data-stu-id="bb0c3-600">Custom Server Variables</span></span>
* <span data-ttu-id="bb0c3-601">Curingas</span><span class="sxs-lookup"><span data-stu-id="bb0c3-601">Wildcards</span></span>
* <span data-ttu-id="bb0c3-602">LogRewrittenUrl</span><span class="sxs-lookup"><span data-stu-id="bb0c3-602">LogRewrittenUrl</span></span>

#### <a name="supported-server-variables"></a><span data-ttu-id="bb0c3-603">Variáveis de servidor compatíveis</span><span class="sxs-lookup"><span data-stu-id="bb0c3-603">Supported server variables</span></span>

<span data-ttu-id="bb0c3-604">O middleware dá suporte às seguintes variáveis de servidor do Módulo de Reconfiguração de URL do IIS:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-604">The middleware supports the following IIS URL Rewrite Module server variables:</span></span>

* <span data-ttu-id="bb0c3-605">CONTENT_LENGTH</span><span class="sxs-lookup"><span data-stu-id="bb0c3-605">CONTENT_LENGTH</span></span>
* <span data-ttu-id="bb0c3-606">CONTENT_TYPE</span><span class="sxs-lookup"><span data-stu-id="bb0c3-606">CONTENT_TYPE</span></span>
* <span data-ttu-id="bb0c3-607">HTTP_ACCEPT</span><span class="sxs-lookup"><span data-stu-id="bb0c3-607">HTTP_ACCEPT</span></span>
* <span data-ttu-id="bb0c3-608">HTTP_CONNECTION</span><span class="sxs-lookup"><span data-stu-id="bb0c3-608">HTTP_CONNECTION</span></span>
* <span data-ttu-id="bb0c3-609">HTTP_COOKIE</span><span class="sxs-lookup"><span data-stu-id="bb0c3-609">HTTP_COOKIE</span></span>
* <span data-ttu-id="bb0c3-610">HTTP_HOST</span><span class="sxs-lookup"><span data-stu-id="bb0c3-610">HTTP_HOST</span></span>
* <span data-ttu-id="bb0c3-611">HTTP_REFERER</span><span class="sxs-lookup"><span data-stu-id="bb0c3-611">HTTP_REFERER</span></span>
* <span data-ttu-id="bb0c3-612">HTTP_URL</span><span class="sxs-lookup"><span data-stu-id="bb0c3-612">HTTP_URL</span></span>
* <span data-ttu-id="bb0c3-613">HTTP_USER_AGENT</span><span class="sxs-lookup"><span data-stu-id="bb0c3-613">HTTP_USER_AGENT</span></span>
* <span data-ttu-id="bb0c3-614">HTTPS</span><span class="sxs-lookup"><span data-stu-id="bb0c3-614">HTTPS</span></span>
* <span data-ttu-id="bb0c3-615">LOCAL_ADDR</span><span class="sxs-lookup"><span data-stu-id="bb0c3-615">LOCAL_ADDR</span></span>
* <span data-ttu-id="bb0c3-616">QUERY_STRING</span><span class="sxs-lookup"><span data-stu-id="bb0c3-616">QUERY_STRING</span></span>
* <span data-ttu-id="bb0c3-617">REMOTE_ADDR</span><span class="sxs-lookup"><span data-stu-id="bb0c3-617">REMOTE_ADDR</span></span>
* <span data-ttu-id="bb0c3-618">REMOTE_PORT</span><span class="sxs-lookup"><span data-stu-id="bb0c3-618">REMOTE_PORT</span></span>
* <span data-ttu-id="bb0c3-619">REQUEST_FILENAME</span><span class="sxs-lookup"><span data-stu-id="bb0c3-619">REQUEST_FILENAME</span></span>
* <span data-ttu-id="bb0c3-620">REQUEST_URI</span><span class="sxs-lookup"><span data-stu-id="bb0c3-620">REQUEST_URI</span></span>

> [!NOTE]
> <span data-ttu-id="bb0c3-621">Também obtenha um <xref:Microsoft.Extensions.FileProviders.IFileProvider> por meio de um <xref:Microsoft.Extensions.FileProviders.PhysicalFileProvider>.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-621">You can also obtain an <xref:Microsoft.Extensions.FileProviders.IFileProvider> via a <xref:Microsoft.Extensions.FileProviders.PhysicalFileProvider>.</span></span> <span data-ttu-id="bb0c3-622">Essa abordagem pode fornecer maior flexibilidade para o local dos arquivos de regras de reconfiguração.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-622">This approach may provide greater flexibility for the location of your rewrite rules files.</span></span> <span data-ttu-id="bb0c3-623">Verifique se os arquivos de regras de reconfiguração são implantados no servidor no caminho fornecido.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-623">Make sure that your rewrite rules files are deployed to the server at the path you provide.</span></span>
>
> ```csharp
> PhysicalFileProvider fileProvider = new PhysicalFileProvider(Directory.GetCurrentDirectory());
> ```

### <a name="method-based-rule"></a><span data-ttu-id="bb0c3-624">Regra baseada em método</span><span class="sxs-lookup"><span data-stu-id="bb0c3-624">Method-based rule</span></span>

<span data-ttu-id="bb0c3-625">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> para implementar sua própria lógica de regra em um método.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-625">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> to implement your own rule logic in a method.</span></span> <span data-ttu-id="bb0c3-626">`Add` expõe o <xref:Microsoft.AspNetCore.Rewrite.RewriteContext>, que disponibiliza o <xref:Microsoft.AspNetCore.Http.HttpContext> para uso no método.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-626">`Add` exposes the <xref:Microsoft.AspNetCore.Rewrite.RewriteContext>, which makes available the <xref:Microsoft.AspNetCore.Http.HttpContext> for use in your method.</span></span> <span data-ttu-id="bb0c3-627">O [RewriteContext.Result](xref:Microsoft.AspNetCore.Rewrite.RewriteContext.Result*) determina como o processamento adicional de pipeline é feito.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-627">The [RewriteContext.Result](xref:Microsoft.AspNetCore.Rewrite.RewriteContext.Result*) determines how additional pipeline processing is handled.</span></span> <span data-ttu-id="bb0c3-628">Defina o valor como um dos campos <xref:Microsoft.AspNetCore.Rewrite.RuleResult> descritos na tabela a seguir.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-628">Set the value to one of the <xref:Microsoft.AspNetCore.Rewrite.RuleResult> fields described in the following table.</span></span>

| `RewriteContext.Result`              | <span data-ttu-id="bb0c3-629">Ação</span><span class="sxs-lookup"><span data-stu-id="bb0c3-629">Action</span></span>                                                           |
| ------------------------------------ | ---------------------------------------------------------------- |
| <span data-ttu-id="bb0c3-630">`RuleResult.ContinueRules` (padrão)</span><span class="sxs-lookup"><span data-stu-id="bb0c3-630">`RuleResult.ContinueRules` (default)</span></span> | <span data-ttu-id="bb0c3-631">Continuar aplicando regras.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-631">Continue applying rules.</span></span>                                         |
| `RuleResult.EndResponse`             | <span data-ttu-id="bb0c3-632">Parar de aplicar regras e enviar a resposta.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-632">Stop applying rules and send the response.</span></span>                       |
| `RuleResult.SkipRemainingRules`      | <span data-ttu-id="bb0c3-633">Parar de aplicar regras e enviar o contexto para o próximo middleware.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-633">Stop applying rules and send the context to the next middleware.</span></span> |

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=14)]

<span data-ttu-id="bb0c3-634">O aplicativo de exemplo demonstra um método que redireciona as solicitações para caminhos que terminam com *.xml*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-634">The sample app demonstrates a method that redirects requests for paths that end with *.xml*.</span></span> <span data-ttu-id="bb0c3-635">Se uma solicitação for feita para `/file.xml`, ela será redirecionada para `/xmlfiles/file.xml`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-635">If a request is made for `/file.xml`, the request is redirected to `/xmlfiles/file.xml`.</span></span> <span data-ttu-id="bb0c3-636">O código de status é definido como *301 – Movido Permanentemente*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-636">The status code is set to *301 - Moved Permanently*.</span></span> <span data-ttu-id="bb0c3-637">Quando o navegador faz uma nova solicitação para */xmlfiles/file.xml*, o Middleware de Arquivo Estático fornece o arquivo para o cliente por meio da pasta *wwwroot/xmlfiles*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-637">When the browser makes a new request for */xmlfiles/file.xml*, Static File Middleware serves the file to the client from the *wwwroot/xmlfiles* folder.</span></span> <span data-ttu-id="bb0c3-638">Para um redirecionamento, defina explicitamente o código de status da resposta.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-638">For a redirect, explicitly set the status code of the response.</span></span> <span data-ttu-id="bb0c3-639">Caso contrário, um código de status *200 – OK* será retornado e o redirecionamento não ocorrerá no cliente.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-639">Otherwise, a *200 - OK* status code is returned, and the redirect doesn't occur on the client.</span></span>

<span data-ttu-id="bb0c3-640">*RewriteRules.cs*:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-640">*RewriteRules.cs*:</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/RewriteRules.cs?name=snippet_RedirectXmlFileRequests&highlight=14-18)]

<span data-ttu-id="bb0c3-641">Essa abordagem também pode reconfigurar as solicitações.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-641">This approach can also rewrite requests.</span></span> <span data-ttu-id="bb0c3-642">O aplicativo de exemplo demonstra a reconfiguração do caminho de qualquer solicitação de arquivo de texto para fornecer o arquivo de texto *file.txt* por meio da pasta *wwwroot*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-642">The sample app demonstrates rewriting the path for any text file request to serve the *file.txt* text file from the *wwwroot* folder.</span></span> <span data-ttu-id="bb0c3-643">O Middleware de Arquivo Estático fornece o arquivo com base no caminho de solicitação atualizado:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-643">Static File Middleware serves the file based on the updated request path:</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=15,22)]

<span data-ttu-id="bb0c3-644">*RewriteRules.cs*:</span><span class="sxs-lookup"><span data-stu-id="bb0c3-644">*RewriteRules.cs*:</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/RewriteRules.cs?name=snippet_RewriteTextFileRequests&highlight=7-8)]

### <a name="irule-based-rule"></a><span data-ttu-id="bb0c3-645">Regra baseada em IRule</span><span class="sxs-lookup"><span data-stu-id="bb0c3-645">IRule-based rule</span></span>

<span data-ttu-id="bb0c3-646">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> para usar a lógica de regra em uma classe que implementa a interface <xref:Microsoft.AspNetCore.Rewrite.IRule>.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-646">Use <xref:Microsoft.AspNetCore.Rewrite.RewriteOptionsExtensions.Add*> to use rule logic in a class that implements the <xref:Microsoft.AspNetCore.Rewrite.IRule> interface.</span></span> <span data-ttu-id="bb0c3-647">`IRule` fornece maior flexibilidade em comparação ao uso da abordagem de regra baseada em método.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-647">`IRule` provides greater flexibility over using the method-based rule approach.</span></span> <span data-ttu-id="bb0c3-648">A classe de implementação pode incluir um construtor, que permite passar parâmetros para o método <xref:Microsoft.AspNetCore.Rewrite.IRule.ApplyRule*>.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-648">Your implementation class may include a constructor that allows you can pass in parameters for the <xref:Microsoft.AspNetCore.Rewrite.IRule.ApplyRule*> method.</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/Startup.cs?name=snippet1&highlight=16-17)]

<span data-ttu-id="bb0c3-649">Os valores dos parâmetros no aplicativo de exemplo para a `extension` e o `newPath` são verificados para atender a várias condições.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-649">The values of the parameters in the sample app for the `extension` and the `newPath` are checked to meet several conditions.</span></span> <span data-ttu-id="bb0c3-650">A `extension` precisa conter um valor que precisa ser *.png*, *.jpg* ou *.gif*.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-650">The `extension` must contain a value, and the value must be *.png*, *.jpg*, or *.gif*.</span></span> <span data-ttu-id="bb0c3-651">Se o `newPath` não é válido, uma <xref:System.ArgumentException> é gerada.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-651">If the `newPath` isn't valid, an <xref:System.ArgumentException> is thrown.</span></span> <span data-ttu-id="bb0c3-652">Se uma solicitação é feita para *image.png*, a solicitação é redirecionada para `/png-images/image.png`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-652">If a request is made for *image.png*, the request is redirected to `/png-images/image.png`.</span></span> <span data-ttu-id="bb0c3-653">Se uma solicitação é feita para *image.jpg*, a solicitação é redirecionada para `/jpg-images/image.jpg`.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-653">If a request is made for *image.jpg*, the request is redirected to `/jpg-images/image.jpg`.</span></span> <span data-ttu-id="bb0c3-654">O código de status é definido como *301 – Movido Permanentemente* e o `context.Result` é definida para parar o processamento de regras e enviar a resposta.</span><span class="sxs-lookup"><span data-stu-id="bb0c3-654">The status code is set to *301 - Moved Permanently*, and the `context.Result` is set to stop processing rules and send the response.</span></span>

[!code-csharp[](url-rewriting/samples/2.x/SampleApp/RewriteRules.cs?name=snippet_RedirectImageRequests)]

<span data-ttu-id="bb0c3-655">Solicitação original: `/image.png`</span><span class="sxs-lookup"><span data-stu-id="bb0c3-655">Original Request: `/image.png`</span></span>

![Janela do navegador com as Ferramentas para Desenvolvedores acompanhando as solicitações e respostas para image.png](url-rewriting/_static/add_redirect_png_requests.png)

<span data-ttu-id="bb0c3-657">Solicitação original: `/image.jpg`</span><span class="sxs-lookup"><span data-stu-id="bb0c3-657">Original Request: `/image.jpg`</span></span>

![Janela do navegador com as Ferramentas para Desenvolvedores acompanhando as solicitações e respostas para image.jpg](url-rewriting/_static/add_redirect_jpg_requests.png)

## <a name="regex-examples"></a><span data-ttu-id="bb0c3-659">Exemplos do regex</span><span class="sxs-lookup"><span data-stu-id="bb0c3-659">Regex examples</span></span>

| <span data-ttu-id="bb0c3-660">Goal</span><span class="sxs-lookup"><span data-stu-id="bb0c3-660">Goal</span></span> | <span data-ttu-id="bb0c3-661">Cadeia de caracteres do regex &</span><span class="sxs-lookup"><span data-stu-id="bb0c3-661">Regex String &</span></span><br><span data-ttu-id="bb0c3-662">Exemplo de correspondência</span><span class="sxs-lookup"><span data-stu-id="bb0c3-662">Match Example</span></span> | <span data-ttu-id="bb0c3-663">Cadeia de caracteres de substituição &</span><span class="sxs-lookup"><span data-stu-id="bb0c3-663">Replacement String &</span></span><br><span data-ttu-id="bb0c3-664">Exemplo de saída</span><span class="sxs-lookup"><span data-stu-id="bb0c3-664">Output Example</span></span> |
| ---- | ------------------------------- | -------------------------------------- |
| <span data-ttu-id="bb0c3-665">Reconfigurar o caminho na cadeia de consulta</span><span class="sxs-lookup"><span data-stu-id="bb0c3-665">Rewrite path into querystring</span></span> | `^path/(.*)/(.*)`<br>`/path/abc/123` | `path?var1=$1&var2=$2`<br>`/path?var1=abc&var2=123` |
| <span data-ttu-id="bb0c3-666">Barra "/" à direita da faixa</span><span class="sxs-lookup"><span data-stu-id="bb0c3-666">Strip trailing slash</span></span> | `(.*)/$`<br>`/path/` | `$1`<br>`/path` |
| <span data-ttu-id="bb0c3-667">Impor barra "/" à direita</span><span class="sxs-lookup"><span data-stu-id="bb0c3-667">Enforce trailing slash</span></span> | `(.*[^/])$`<br>`/path` | `$1/`<br>`/path/` |
| <span data-ttu-id="bb0c3-668">Evitar a reconfiguração de solicitações específicas</span><span class="sxs-lookup"><span data-stu-id="bb0c3-668">Avoid rewriting specific requests</span></span> | <span data-ttu-id="bb0c3-669">`^(.*)(?<!\.axd)$` ou `^(?!.*\.axd$)(.*)$`</span><span class="sxs-lookup"><span data-stu-id="bb0c3-669">`^(.*)(?<!\.axd)$` or `^(?!.*\.axd$)(.*)$`</span></span><br><span data-ttu-id="bb0c3-670">Sim: `/resource.htm`</span><span class="sxs-lookup"><span data-stu-id="bb0c3-670">Yes: `/resource.htm`</span></span><br><span data-ttu-id="bb0c3-671">Não: `/resource.axd`</span><span class="sxs-lookup"><span data-stu-id="bb0c3-671">No: `/resource.axd`</span></span> | `rewritten/$1`<br>`/rewritten/resource.htm`<br>`/resource.axd` |
| <span data-ttu-id="bb0c3-672">Reorganizar segmentos de URL</span><span class="sxs-lookup"><span data-stu-id="bb0c3-672">Rearrange URL segments</span></span> | `path/(.*)/(.*)/(.*)`<br>`path/1/2/3` | `path/$3/$2/$1`<br>`path/3/2/1` |
| <span data-ttu-id="bb0c3-673">Substituir um segmento de URL</span><span class="sxs-lookup"><span data-stu-id="bb0c3-673">Replace a URL segment</span></span> | `^(.*)/segment2/(.*)`<br>`/segment1/segment2/segment3` | `$1/replaced/$2`<br>`/segment1/replaced/segment3` |

::: moniker-end

## <a name="additional-resources"></a><span data-ttu-id="bb0c3-674">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="bb0c3-674">Additional resources</span></span>

* <xref:fundamentals/startup>
* <xref:fundamentals/middleware/index>
* [<span data-ttu-id="bb0c3-675">Expressões regulares no .NET</span><span class="sxs-lookup"><span data-stu-id="bb0c3-675">Regular expressions in .NET</span></span>](/dotnet/articles/standard/base-types/regular-expressions)
* [<span data-ttu-id="bb0c3-676">Linguagem de expressão regular-referência rápida</span><span class="sxs-lookup"><span data-stu-id="bb0c3-676">Regular expression language - quick reference</span></span>](/dotnet/articles/standard/base-types/quick-ref)
* [<span data-ttu-id="bb0c3-677">mod_rewrite do Apache</span><span class="sxs-lookup"><span data-stu-id="bb0c3-677">Apache mod_rewrite</span></span>](https://httpd.apache.org/docs/2.4/rewrite/)
* [<span data-ttu-id="bb0c3-678">Usando o Módulo de Reconfiguração de URL 2.0 (para IIS)</span><span class="sxs-lookup"><span data-stu-id="bb0c3-678">Using Url Rewrite Module 2.0 (for IIS)</span></span>](/iis/extensions/url-rewrite-module/using-url-rewrite-module-20)
* [<span data-ttu-id="bb0c3-679">Referência de configuração do Módulo de Reconfiguração de URL</span><span class="sxs-lookup"><span data-stu-id="bb0c3-679">URL Rewrite Module Configuration Reference</span></span>](/iis/extensions/url-rewrite-module/url-rewrite-module-configuration-reference)
* [<span data-ttu-id="bb0c3-680">Fórum do Módulo de Reconfiguração de URL do IIS</span><span class="sxs-lookup"><span data-stu-id="bb0c3-680">IIS URL Rewrite Module Forum</span></span>](https://forums.iis.net/1152.aspx)
* [<span data-ttu-id="bb0c3-681">Manter uma estrutura de URL simples</span><span class="sxs-lookup"><span data-stu-id="bb0c3-681">Keep a simple URL structure</span></span>](https://support.google.com/webmasters/answer/76329?hl=en)
* [<span data-ttu-id="bb0c3-682">10 dicas e truques de reconfiguração de URL</span><span class="sxs-lookup"><span data-stu-id="bb0c3-682">10 URL Rewriting Tips and Tricks</span></span>](https://ruslany.net/2009/04/10-url-rewriting-tips-and-tricks/)
* [<span data-ttu-id="bb0c3-683">Inserir ou não inserir uma barra "/"</span><span class="sxs-lookup"><span data-stu-id="bb0c3-683">To slash or not to slash</span></span>](https://webmasters.googleblog.com/2010/04/to-slash-or-not-to-slash.html)
