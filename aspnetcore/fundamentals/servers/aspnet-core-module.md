---
title: "Módulo do ASP.NET Core"
author: tdykstra
description: "Apresenta o ANCM (Módulo do ASP.NET Core), um módulo do IIS que permite que o servidor Web Kestrel use o IIS ou IIS Express como um servidor proxy reverso."
manager: wpickett
ms.author: tdykstra
ms.custom: H1Hack27Feb2017
ms.date: 08/03/2017
ms.prod: asp.net-core
ms.technology: aspnet
ms.topic: article
uid: fundamentals/servers/aspnet-core-module
ms.openlocfilehash: 4337bc42c5454d6a9634a396d9c89f3518af148b
ms.sourcegitcommit: a510f38930abc84c4b302029d019a34dfe76823b
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/30/2018
---
# <a name="introduction-to-aspnet-core-module"></a><span data-ttu-id="d80e3-103">Introdução ao Módulo do ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="d80e3-103">Introduction to ASP.NET Core Module</span></span>

<span data-ttu-id="d80e3-104">Por [Tom Dykstra](https://github.com/tdykstra), [Rick Strahl](https://github.com/RickStrahl) e [Chris Ross](https://github.com/Tratcher)</span><span class="sxs-lookup"><span data-stu-id="d80e3-104">By [Tom Dykstra](https://github.com/tdykstra), [Rick Strahl](https://github.com/RickStrahl), and [Chris Ross](https://github.com/Tratcher)</span></span> 

<span data-ttu-id="d80e3-105">O ANCM (Módulo do ASP.NET Core) permite que você execute aplicativos ASP.NET Core protegidos pelo IIS, usando o IIS para o que ele é bom (segurança, capacidade de gerenciamento e muito mais) e usando o [Kestrel](kestrel.md) para o que ele é bom (ser realmente rápido) e obtenha os benefícios de ambas as tecnologias ao mesmo tempo.</span><span class="sxs-lookup"><span data-stu-id="d80e3-105">ASP.NET Core Module (ANCM) lets you run ASP.NET Core applications behind IIS, using IIS for what it's good at (security, manageability, and lots more) and using [Kestrel](kestrel.md) for what it's good at (being really fast), and getting the benefits from both technologies at once.</span></span> <span data-ttu-id="d80e3-106">**O ANCM funciona apenas com o Kestrel; não é compatível com o WebListener (no ASP.NET Core 1.x) ou HTTP.sys (no 2.x).**</span><span class="sxs-lookup"><span data-stu-id="d80e3-106">**ANCM works only with Kestrel; it isn't compatible with WebListener (in ASP.NET Core 1.x) or HTTP.sys (in 2.x).**</span></span> 

<span data-ttu-id="d80e3-107">Versões do Windows compatíveis:</span><span class="sxs-lookup"><span data-stu-id="d80e3-107">Supported Windows versions:</span></span>

* <span data-ttu-id="d80e3-108">Windows 7 e Windows Server 2008 R2 e posterior</span><span class="sxs-lookup"><span data-stu-id="d80e3-108">Windows 7 and Windows Server 2008 R2 and later</span></span>

<span data-ttu-id="d80e3-109">[Exibir ou baixar código de exemplo](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/servers/aspnet-core-module/sample) ([como baixar](xref:tutorials/index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="d80e3-109">[View or download sample code](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/servers/aspnet-core-module/sample) ([how to download](xref:tutorials/index#how-to-download-a-sample))</span></span>

## <a name="what-aspnet-core-module-does"></a><span data-ttu-id="d80e3-110">O que o Módulo do ASP.NET Core faz</span><span class="sxs-lookup"><span data-stu-id="d80e3-110">What ASP.NET Core Module does</span></span>

<span data-ttu-id="d80e3-111">O ANCM é um módulo nativo do IIS que é vinculado ao pipeline do IIS e redireciona o tráfego para o aplicativo ASP.NET Core back-end.</span><span class="sxs-lookup"><span data-stu-id="d80e3-111">ANCM is a native IIS module that hooks into the IIS pipeline and redirects traffic to the backend ASP.NET Core application.</span></span> <span data-ttu-id="d80e3-112">A maioria dos outros módulos, como a autenticação do Windows, ainda obtém uma oportunidade de ser executada.</span><span class="sxs-lookup"><span data-stu-id="d80e3-112">Most other modules, such as windows authentication, still get a chance to run.</span></span> <span data-ttu-id="d80e3-113">O ANCM apenas assume o controle quando um manipulador é selecionado para a solicitação e o mapeamento de manipulador é definido no arquivo *web.config* do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d80e3-113">ANCM only takes control when a handler is selected for the request, and handler mapping is defined in the application *web.config* file.</span></span>

<span data-ttu-id="d80e3-114">Como os aplicativos ASP.NET Core são executados em um processo separado do processo de trabalho do IIS, o ANCM também realiza o gerenciamento de processos.</span><span class="sxs-lookup"><span data-stu-id="d80e3-114">Because ASP.NET Core applications run in a process separate from the IIS worker process, ANCM also does process management.</span></span> <span data-ttu-id="d80e3-115">O ANCM inicia o processo para o aplicativo ASP.NET Core quando a primeira solicitação é recebida e reinicia-o quando ele falha.</span><span class="sxs-lookup"><span data-stu-id="d80e3-115">ANCM starts the process for the ASP.NET Core application when the first request comes in and restarts it when it crashes.</span></span> <span data-ttu-id="d80e3-116">Basicamente, esse é o mesmo comportamento dos aplicativos ASP.NET clássicos executados em processo no IIS e gerenciados pelo WAS (Serviço de Ativação do Windows).</span><span class="sxs-lookup"><span data-stu-id="d80e3-116">This is essentially the same behavior as classic ASP.NET applications that run in-process in IIS and are managed by WAS (Windows Activation Service).</span></span>

<span data-ttu-id="d80e3-117">Veja a seguir um diagrama que ilustra a relação entre o IIS, o ANCM e aplicativos ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="d80e3-117">Here's a diagram that illustrates the relationship between IIS, ANCM, and ASP.NET Core applications.</span></span>

![Módulo do ASP.NET Core](aspnet-core-module/_static/ancm.png)

<span data-ttu-id="d80e3-119">As solicitações são recebidas da Web e chegam ao driver Http.Sys de modo kernel, que encaminha-as para o IIS na porta primária (80) ou porta SSL (443).</span><span class="sxs-lookup"><span data-stu-id="d80e3-119">Requests come in from the Web and hit the kernel mode Http.Sys driver which routes them into IIS on the primary port (80) or SSL port (443).</span></span> <span data-ttu-id="d80e3-120">O ANCM encaminha as solicitações para o aplicativo ASP.NET Core na porta HTTP configurada para o aplicativo, que não é a porta 80/443.</span><span class="sxs-lookup"><span data-stu-id="d80e3-120">ANCM forwards the requests to the ASP.NET Core application on the HTTP port configured for the application, which isn't port 80/443.</span></span>

<span data-ttu-id="d80e3-121">O Kestrel ouve o tráfego proveniente do ANCM.</span><span class="sxs-lookup"><span data-stu-id="d80e3-121">Kestrel listens for traffic coming from ANCM.</span></span>  <span data-ttu-id="d80e3-122">O ANCM especifica a porta por meio da variável de ambiente na inicialização e o método [UseIISIntegration](#call-useiisintegration) configura o servidor para escutar em `http://localhost:{port}`.</span><span class="sxs-lookup"><span data-stu-id="d80e3-122">ANCM specifies the port via environment variable at startup, and the [UseIISIntegration](#call-useiisintegration) method configures the server to listen on `http://localhost:{port}`.</span></span> <span data-ttu-id="d80e3-123">Existem verificações adicionais para rejeitar as solicitações não provenientes do ANCM.</span><span class="sxs-lookup"><span data-stu-id="d80e3-123">There are additional checks to reject requests not from ANCM.</span></span> <span data-ttu-id="d80e3-124">(O ANCM não dá suporte ao encaminhamento de HTTPS e, portanto, as solicitações são encaminhadas por HTTP, mesmo se forem recebidas pelo IIS por HTTPS.)</span><span class="sxs-lookup"><span data-stu-id="d80e3-124">(ANCM doesn't support HTTPS forwarding, so requests are forwarded over HTTP even if received by IIS over HTTPS.)</span></span>

<span data-ttu-id="d80e3-125">O Kestrel coleta solicitações do ANCM e envia-as por push para o pipeline de middleware do ASP.NET Core, que as manipula e as passa como instâncias `HttpContext` para a lógica do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d80e3-125">Kestrel picks up requests from ANCM and pushes them into the ASP.NET Core middleware pipeline, which then handles them and passes them on as `HttpContext` instances to application logic.</span></span> <span data-ttu-id="d80e3-126">As respostas do aplicativo são passadas novamente para o IIS, que as envia novamente para o cliente HTTP que iniciou as solicitações.</span><span class="sxs-lookup"><span data-stu-id="d80e3-126">The application's responses are then passed back to IIS, which pushes them back out to the HTTP client that initiated the requests.</span></span>

<span data-ttu-id="d80e3-127">O ANCM também tem algumas outras funções:</span><span class="sxs-lookup"><span data-stu-id="d80e3-127">ANCM has a few other functions as well:</span></span>

* <span data-ttu-id="d80e3-128">Define as variáveis de ambiente.</span><span class="sxs-lookup"><span data-stu-id="d80e3-128">Sets environment variables.</span></span>
* <span data-ttu-id="d80e3-129">Registra em log a saída `stdout` no armazenamento de arquivos.</span><span class="sxs-lookup"><span data-stu-id="d80e3-129">Logs `stdout` output to file storage.</span></span>
* <span data-ttu-id="d80e3-130">Encaminha tokens de autenticação do Windows.</span><span class="sxs-lookup"><span data-stu-id="d80e3-130">Forwards Windows authentication tokens.</span></span>

## <a name="how-to-use-ancm-in-aspnet-core-apps"></a><span data-ttu-id="d80e3-131">Como usar o ANCM em aplicativos ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="d80e3-131">How to use ANCM in ASP.NET Core apps</span></span>

<span data-ttu-id="d80e3-132">Esta seção fornece uma visão geral do processo para configurar um servidor IIS e um aplicativo ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="d80e3-132">This section provides an overview of the process for setting up an IIS server and ASP.NET Core application.</span></span> <span data-ttu-id="d80e3-133">Para obter instruções detalhadas, consulte [Hospedar no Windows com o IIS](xref:host-and-deploy/iis/index).</span><span class="sxs-lookup"><span data-stu-id="d80e3-133">For detailed instructions, see [Host on Windows with IIS](xref:host-and-deploy/iis/index).</span></span>

### <a name="install-ancm"></a><span data-ttu-id="d80e3-134">Instalar o ANCM</span><span class="sxs-lookup"><span data-stu-id="d80e3-134">Install ANCM</span></span>


<span data-ttu-id="d80e3-135">O Módulo do ASP.NET Core precisa ser instalado no IIS nos servidores e no IIS Express nos computadores de desenvolvimento.</span><span class="sxs-lookup"><span data-stu-id="d80e3-135">The ASP.NET Core Module has to be installed in IIS on your servers and in IIS Express on your development machines.</span></span> <span data-ttu-id="d80e3-136">Para servidores, o ANCM está incluído no [pacote de Hospedagem do Windows Server do .NET Core](https://aka.ms/dotnetcore-2-windowshosting).</span><span class="sxs-lookup"><span data-stu-id="d80e3-136">For servers, ANCM is included in the [.NET Core Windows Server Hosting bundle](https://aka.ms/dotnetcore-2-windowshosting).</span></span> <span data-ttu-id="d80e3-137">Para computadores de desenvolvimento, o Visual Studio instala o ANCM automaticamente no IIS Express e no IIS, caso ele já esteja instalado no computador.</span><span class="sxs-lookup"><span data-stu-id="d80e3-137">For development machines, Visual Studio automatically installs ANCM in IIS Express, and in IIS if it's already installed on the machine.</span></span>

### <a name="install-the-iisintegration-nuget-package"></a><span data-ttu-id="d80e3-138">Instalar o pacote NuGet IISIntegration</span><span class="sxs-lookup"><span data-stu-id="d80e3-138">Install the IISIntegration NuGet package</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="d80e3-139">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="d80e3-139">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

<span data-ttu-id="d80e3-140">O pacote [Microsoft.AspNetCore.Server.IISIntegration](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.IISIntegration/) está incluído nos metapacotes do ASP.NET Core ([Microsoft.AspNetCore](https://www.nuget.org/packages/Microsoft.AspNetCore/) e [Microsoft.AspNetCore.All](xref:fundamentals/metapackage)).</span><span class="sxs-lookup"><span data-stu-id="d80e3-140">The [Microsoft.AspNetCore.Server.IISIntegration](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.IISIntegration/) package is included in the ASP.NET Core metapackages ([Microsoft.AspNetCore](https://www.nuget.org/packages/Microsoft.AspNetCore/) and [Microsoft.AspNetCore.All](xref:fundamentals/metapackage)).</span></span> <span data-ttu-id="d80e3-141">Caso não use um dos metapacotes, instale `Microsoft.AspNetCore.Server.IISIntegration` separadamente.</span><span class="sxs-lookup"><span data-stu-id="d80e3-141">If you don't use one of the metapackages, install `Microsoft.AspNetCore.Server.IISIntegration` separately.</span></span> <span data-ttu-id="d80e3-142">O pacote `IISIntegration` é um pacote de interoperabilidade que lê as variáveis de ambiente difundidas pelo ANCM para configurar seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d80e3-142">The `IISIntegration` package is an interoperability pack that reads environment variables broadcast by ANCM to set up your app.</span></span> <span data-ttu-id="d80e3-143">As variáveis de ambiente fornecem informações de configuração, como a porta na qual escutar.</span><span class="sxs-lookup"><span data-stu-id="d80e3-143">The environment variables provide configuration information, such as the port to listen on.</span></span> 

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="d80e3-144">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="d80e3-144">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

<span data-ttu-id="d80e3-145">No aplicativo, instale [Microsoft.AspNetCore.Server.IISIntegration](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.IISIntegration/).</span><span class="sxs-lookup"><span data-stu-id="d80e3-145">In your application, install [Microsoft.AspNetCore.Server.IISIntegration](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.IISIntegration/).</span></span> <span data-ttu-id="d80e3-146">O pacote `IISIntegration` é um pacote de interoperabilidade que lê as variáveis de ambiente difundidas pelo ANCM para configurar seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d80e3-146">The `IISIntegration` package  is an interoperability pack that reads environment variables broadcast by ANCM to set up your app.</span></span> <span data-ttu-id="d80e3-147">As variáveis de ambiente fornecem informações de configuração, como a porta na qual escutar.</span><span class="sxs-lookup"><span data-stu-id="d80e3-147">The environment variables provide configuration information, such as the port to listen on.</span></span> 

---

### <a name="call-useiisintegration"></a><span data-ttu-id="d80e3-148">Chamar UseIISIntegration</span><span class="sxs-lookup"><span data-stu-id="d80e3-148">Call UseIISIntegration</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="d80e3-149">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="d80e3-149">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

<span data-ttu-id="d80e3-150">O método de extensão `UseIISIntegration` no [`WebHostBuilder`](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.webhostbuilder) é chamado automaticamente quando você executa com o IIS.</span><span class="sxs-lookup"><span data-stu-id="d80e3-150">The `UseIISIntegration` extension method on [`WebHostBuilder`](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.webhostbuilder) is called automatically when you run with IIS.</span></span>

<span data-ttu-id="d80e3-151">Caso não esteja usando um dos metapacotes do ASP.NET Core e não tenha instalado o pacote `Microsoft.AspNetCore.Server.IISIntegration`, você obterá um erro de tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="d80e3-151">If you aren't using one of the ASP.NET Core metapackages and haven't installed the  `Microsoft.AspNetCore.Server.IISIntegration` package, you get a runtime error.</span></span> <span data-ttu-id="d80e3-152">Se você chamar `UseIISIntegration` de forma explícita, receberá um erro de tempo de compilação se o pacote não estiver instalado.</span><span class="sxs-lookup"><span data-stu-id="d80e3-152">If you call `UseIISIntegration` explicitly, you get a compile time error if the package isn't installed.</span></span>

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="d80e3-153">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="d80e3-153">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

<span data-ttu-id="d80e3-154">No método `Main` do aplicativo, chame o método de extensão `UseIISIntegration` no [`WebHostBuilder`](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.webhostbuilder).</span><span class="sxs-lookup"><span data-stu-id="d80e3-154">In your application's `Main` method, call the `UseIISIntegration` extension method on [`WebHostBuilder`](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.webhostbuilder).</span></span> 

[!code-csharp[](aspnet-core-module/sample/Program.cs?name=snippet_Main&highlight=12)]

---

<span data-ttu-id="d80e3-155">O método `UseIISIntegration` procura as variáveis de ambiente definidas pelo ANCM e fica inoperante caso elas não sejam encontradas.</span><span class="sxs-lookup"><span data-stu-id="d80e3-155">The `UseIISIntegration` method looks for environment variables that ANCM sets, and it no-ops if they aren't found.</span></span> <span data-ttu-id="d80e3-156">Esse comportamento facilita cenários como o desenvolvimento e teste no macOS ou Linux e a implantação em um servidor que executa o IIS.</span><span class="sxs-lookup"><span data-stu-id="d80e3-156">This behavior facilitates scenarios like developing and testing on macOS or Linux and deploying to a server that runs IIS.</span></span> <span data-ttu-id="d80e3-157">Durante a execução no macOS ou Linux, o Kestrel atua como o servidor Web; mas quando o aplicativo é implantado no ambiente do IIS, ele usa o ANCM e o IIS automaticamente.</span><span class="sxs-lookup"><span data-stu-id="d80e3-157">While running on macOS or Linux, Kestrel acts as the web server; but when the app is deployed to the IIS environment, it automatically uses ANCM and IIS.</span></span>

### <a name="ancm-port-binding-overrides-other-port-bindings"></a><span data-ttu-id="d80e3-158">A associação de porta do ANCM substitui outras associações de porta</span><span class="sxs-lookup"><span data-stu-id="d80e3-158">ANCM port binding overrides other port bindings</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="d80e3-159">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="d80e3-159">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

<span data-ttu-id="d80e3-160">O ANCM gera uma porta dinâmica a ser atribuída ao processo de back-end.</span><span class="sxs-lookup"><span data-stu-id="d80e3-160">ANCM generates a dynamic port to assign to the back-end process.</span></span> <span data-ttu-id="d80e3-161">O método `UseIISIntegration` seleciona essa porta dinâmica e configura o Kestrel para escutar em `http://locahost:{dynamicPort}/`.</span><span class="sxs-lookup"><span data-stu-id="d80e3-161">The `UseIISIntegration` method picks up this dynamic port and configures Kestrel to listen on `http://locahost:{dynamicPort}/`.</span></span> <span data-ttu-id="d80e3-162">Isso substitui outras configurações de URL, como chamadas a `UseUrls` ou à [API de Escuta do Kestrel](xref:fundamentals/servers/kestrel?tabs=aspnetcore2x#endpoint-configuration).</span><span class="sxs-lookup"><span data-stu-id="d80e3-162">This overrides other URL configurations, such as calls to `UseUrls` or [Kestrel's Listen API](xref:fundamentals/servers/kestrel?tabs=aspnetcore2x#endpoint-configuration).</span></span> <span data-ttu-id="d80e3-163">Portanto, não é necessário chamar `UseUrls` ou a API `Listen` do Kestrel quando você usar o ANCM.</span><span class="sxs-lookup"><span data-stu-id="d80e3-163">Therefore, you don't need to call `UseUrls` or Kestrel's `Listen` API when you use ANCM.</span></span> <span data-ttu-id="d80e3-164">Se você chamar `UseUrls` ou `Listen`, o Kestrel escutará na porta especificada quando você executar o aplicativo sem o IIS.</span><span class="sxs-lookup"><span data-stu-id="d80e3-164">If you do call `UseUrls` or `Listen`, Kestrel listens on the port you specify when you run the app without IIS.</span></span>

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="d80e3-165">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="d80e3-165">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

<span data-ttu-id="d80e3-166">O ANCM gera uma porta dinâmica a ser atribuída ao processo de back-end.</span><span class="sxs-lookup"><span data-stu-id="d80e3-166">ANCM generates a dynamic port to assign to the back-end process.</span></span> <span data-ttu-id="d80e3-167">O método `UseIISIntegration` seleciona essa porta dinâmica e configura o Kestrel para escutar em `http://locahost:{dynamicPort}/`.</span><span class="sxs-lookup"><span data-stu-id="d80e3-167">The `UseIISIntegration` method picks up this dynamic port and configures Kestrel to listen on `http://locahost:{dynamicPort}/`.</span></span> <span data-ttu-id="d80e3-168">Isso substitui outras configurações de URL, como chamadas a `UseUrls`.</span><span class="sxs-lookup"><span data-stu-id="d80e3-168">This overrides other URL configurations, such as calls to `UseUrls`.</span></span> <span data-ttu-id="d80e3-169">Portanto, não é necessário chamar `UseUrls` quando usar o ANCM.</span><span class="sxs-lookup"><span data-stu-id="d80e3-169">Therefore, you don't need to call `UseUrls` when you use ANCM.</span></span> <span data-ttu-id="d80e3-170">Se você chamar `UseUrls`, o Kestrel escutará na porta especificada quando você executar o aplicativo sem o IIS.</span><span class="sxs-lookup"><span data-stu-id="d80e3-170">If you do call `UseUrls`, Kestrel listens on the port you specify when you run the app without IIS.</span></span>

<span data-ttu-id="d80e3-171">No ASP.NET Core 1.0, se você chamar `UseUrls`, chame-o **antes** de chamar `UseIISIntegration`, de modo que a porta configurada pelo ANCM não seja substituída.</span><span class="sxs-lookup"><span data-stu-id="d80e3-171">In ASP.NET Core 1.0, if you call `UseUrls`, call it **before** you call `UseIISIntegration` so that the ANCM-configured port doesn't get overwritten.</span></span> <span data-ttu-id="d80e3-172">Essa ordem de chamada não é necessária no ASP.NET Core 1.1, porque a configuração do ANCM substitui `UseUrls`.</span><span class="sxs-lookup"><span data-stu-id="d80e3-172">This calling order isn't required in ASP.NET Core 1.1, because the ANCM setting overrides `UseUrls`.</span></span>

---

### <a name="configure-ancm-options-in-webconfig"></a><span data-ttu-id="d80e3-173">Configurar opções do ANCM em Web.config</span><span class="sxs-lookup"><span data-stu-id="d80e3-173">Configure ANCM options in Web.config</span></span>

<span data-ttu-id="d80e3-174">A configuração do Módulo do ASP.NET Core é armazenada no arquivo *web.config* localizado na pasta raiz do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d80e3-174">Configuration for the ASP.NET Core Module is stored in the *web.config* file that's located in the application's root folder.</span></span> <span data-ttu-id="d80e3-175">As configurações desse arquivo apontam para o comando de inicialização e os argumentos que iniciam o aplicativo ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="d80e3-175">Settings in this file point to the startup command and arguments that start your ASP.NET Core app.</span></span> <span data-ttu-id="d80e3-176">Para obter um código de exemplo de *web.config* e diretrizes sobre opções de configuração, consulte [Referência de configuração do Módulo do ASP.NET Core](xref:host-and-deploy/aspnet-core-module).</span><span class="sxs-lookup"><span data-stu-id="d80e3-176">For sample *web.config* code and guidance on configuration options, see [ASP.NET Core Module Configuration Reference](xref:host-and-deploy/aspnet-core-module).</span></span>

### <a name="run-with-iis-express-in-development"></a><span data-ttu-id="d80e3-177">Executar com o IIS Express em desenvolvimento</span><span class="sxs-lookup"><span data-stu-id="d80e3-177">Run with IIS Express in development</span></span>

<span data-ttu-id="d80e3-178">O IIS Express pode ser iniciado pelo Visual Studio usando o perfil padrão definido pelos modelos do ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="d80e3-178">IIS Express can be launched by Visual Studio using the default profile defined by the ASP.NET Core templates.</span></span>

## <a name="proxy-configuration-uses-http-protocol-and-a-pairing-token"></a><span data-ttu-id="d80e3-179">A configuração de proxy usa o protocolo HTTP e um token de emparelhamento</span><span class="sxs-lookup"><span data-stu-id="d80e3-179">Proxy configuration uses HTTP protocol and a pairing token</span></span>

<span data-ttu-id="d80e3-180">O proxy criado entre o ANCM e o Kestrel usa o protocolo HTTP.</span><span class="sxs-lookup"><span data-stu-id="d80e3-180">The proxy created between the ANCM and Kestrel uses the HTTP protocol.</span></span> <span data-ttu-id="d80e3-181">O uso de HTTP é uma otimização de desempenho na qual o tráfego entre o ANCM e o Kestrel ocorre em um endereço de loopback fora do adaptador de rede.</span><span class="sxs-lookup"><span data-stu-id="d80e3-181">Using HTTP is a performance optimization where the traffic between the ANCM and Kestrel takes place on a loopback address off of the network interface.</span></span> <span data-ttu-id="d80e3-182">Não há nenhum risco de interceptação do tráfego entre o ANCM e o Kestrel em um local fora do servidor.</span><span class="sxs-lookup"><span data-stu-id="d80e3-182">There's no risk of eavesdropping the traffic between the ANCM and Kestrel from a location off of the server.</span></span>

<span data-ttu-id="d80e3-183">Um token de emparelhamento é usado para assegurar que as solicitações recebidas pelo Kestrel foram transmitidas por proxy pelo IIS e que não são provenientes de outra origem.</span><span class="sxs-lookup"><span data-stu-id="d80e3-183">A pairing token is used to guarantee that the requests received by Kestrel were proxied by IIS and didn't come from some other source.</span></span> <span data-ttu-id="d80e3-184">O token de emparelhamento é criado e definido em uma variável de ambiente (`ASPNETCORE_TOKEN`) pelo ANCM.</span><span class="sxs-lookup"><span data-stu-id="d80e3-184">The pairing token is created and set into an environment variable (`ASPNETCORE_TOKEN`) by the ANCM.</span></span> <span data-ttu-id="d80e3-185">O token de emparelhamento também é definido em um cabeçalho (`MSAspNetCoreToken`) em cada solicitação com proxy.</span><span class="sxs-lookup"><span data-stu-id="d80e3-185">The pairing token is also set into a header (`MSAspNetCoreToken`) on every proxied request.</span></span> <span data-ttu-id="d80e3-186">O Middleware do IIS verifica cada solicitação recebida para confirmar se o valor de cabeçalho do token de emparelhamento corresponde ao valor da variável de ambiente.</span><span class="sxs-lookup"><span data-stu-id="d80e3-186">IIS Middleware checks each request it receives to confirm that the pairing token header value matches the environment variable value.</span></span> <span data-ttu-id="d80e3-187">Se os valores do token forem incompatíveis, a solicitação será registrada em log e rejeitada.</span><span class="sxs-lookup"><span data-stu-id="d80e3-187">If the token values are mismatched, the request is logged and rejected.</span></span> <span data-ttu-id="d80e3-188">A variável de ambiente do token de emparelhamento e o tráfego entre o ANCM e o Kestrel não são acessíveis em um local fora do servidor.</span><span class="sxs-lookup"><span data-stu-id="d80e3-188">The pairing token environment variable and the traffic between the ANCM and Kestrel aren't accessible from a location off of the server.</span></span> <span data-ttu-id="d80e3-189">Sem saber o valor do token de emparelhamento, um invasor não pode enviar solicitações que ignoram a verificação no Middleware do IIS.</span><span class="sxs-lookup"><span data-stu-id="d80e3-189">Without knowing the pairing token value, an attacker can't submit requests that bypass the check in the IIS Middleware.</span></span>

## <a name="next-steps"></a><span data-ttu-id="d80e3-190">Próximas etapas</span><span class="sxs-lookup"><span data-stu-id="d80e3-190">Next steps</span></span>

<span data-ttu-id="d80e3-191">Para obter mais informações, consulte os seguintes recursos:</span><span class="sxs-lookup"><span data-stu-id="d80e3-191">For more information, see the following resources:</span></span>

* [<span data-ttu-id="d80e3-192">Aplicativo de exemplo para este artigo</span><span class="sxs-lookup"><span data-stu-id="d80e3-192">Sample app for this article</span></span>](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/servers/aspnet-core-module/sample)
* [<span data-ttu-id="d80e3-193">Código-fonte do Módulo do ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="d80e3-193">ASP.NET Core Module source code</span></span>](https://github.com/aspnet/AspNetCoreModule)
* [<span data-ttu-id="d80e3-194">Referência de configuração do módulo do ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="d80e3-194">ASP.NET Core Module Configuration Reference</span></span>](xref:host-and-deploy/aspnet-core-module)
* [<span data-ttu-id="d80e3-195">Hospedar no Windows com o IIS</span><span class="sxs-lookup"><span data-stu-id="d80e3-195">Host on Windows with IIS</span></span>](xref:host-and-deploy/iis/index)
