---
title: Injeção de dependência no ASP.NET Core
author: ardalis
description: Saiba como o ASP.NET Core implementa a injeção de dependência e como usá-la.
manager: wpickett
ms.author: riande
ms.custom: H1Hack27Feb2017
ms.date: 10/14/2016
ms.prod: asp.net-core
ms.technology: aspnet
ms.topic: article
uid: fundamentals/dependency-injection
ms.openlocfilehash: 8a105f835dddfcd0e9f32059e644f60dc1fdbbe1
ms.sourcegitcommit: 5130b3034165f5cf49d829fe7475a84aa33d2693
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 05/03/2018
---
# <a name="dependency-injection-in-aspnet-core"></a><span data-ttu-id="e0ac6-103">Injeção de dependência no ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="e0ac6-103">Dependency injection in ASP.NET Core</span></span>

<a name="fundamentals-dependency-injection"></a>

<span data-ttu-id="e0ac6-104">Por [Steve Smith](https://ardalis.com/) e [Scott Addie](https://scottaddie.com)</span><span class="sxs-lookup"><span data-stu-id="e0ac6-104">By [Steve Smith](https://ardalis.com/) and [Scott Addie](https://scottaddie.com)</span></span>

<span data-ttu-id="e0ac6-105">O ASP.NET Core foi projetado desde o início para dar suporte e utilizar a injeção de dependência.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-105">ASP.NET Core is designed from the ground up to support and leverage dependency injection.</span></span> <span data-ttu-id="e0ac6-106">Os aplicativos ASP.NET Core podem utilizar os serviços de estrutura interna mantendo-os injetados em métodos na classe Startup e os Serviços de Aplicativos também podem ser configurados para injeção.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-106">ASP.NET Core applications can leverage built-in framework services by having them injected into methods in the Startup class, and application services can be configured for injection as well.</span></span> <span data-ttu-id="e0ac6-107">O contêiner de serviços padrão fornecido pelo ASP.NET Core fornece um conjunto de recursos mínimos e não se destina a substituir outros contêineres.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-107">The default services container provided by ASP.NET Core provides a minimal feature set and isn't intended to replace other containers.</span></span>

<span data-ttu-id="e0ac6-108">[Exibir ou baixar código de exemplo](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/dependency-injection/sample) ([como baixar](xref:tutorials/index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="e0ac6-108">[View or download sample code](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/dependency-injection/sample) ([how to download](xref:tutorials/index#how-to-download-a-sample))</span></span>

## <a name="what-is-dependency-injection"></a><span data-ttu-id="e0ac6-109">O que é injeção de dependência?</span><span class="sxs-lookup"><span data-stu-id="e0ac6-109">What is dependency injection?</span></span>

<span data-ttu-id="e0ac6-110">A DI (injeção de dependência) é uma técnica para obter um acoplamento flexível entre objetos e seus colaboradores, ou dependências.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-110">Dependency injection (DI) is a technique for achieving loose coupling between objects and their collaborators, or dependencies.</span></span> <span data-ttu-id="e0ac6-111">Em vez de criar uma instância de colaboradores diretamente, ou usar referências estáticas, os objetos de que uma classe precisa para realizar suas ações são fornecidos para a classe de alguma forma.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-111">Rather than directly instantiating collaborators, or using static references, the objects a class needs in order to perform its actions are provided to the class in some fashion.</span></span> <span data-ttu-id="e0ac6-112">Geralmente, as classes declararão suas dependências por meio de seu construtor, possibilitando que elas sigam o [Princípio de Dependências Explícitas](http://deviq.com/explicit-dependencies-principle/).</span><span class="sxs-lookup"><span data-stu-id="e0ac6-112">Most often, classes will declare their dependencies via their constructor, allowing them to follow the [Explicit Dependencies Principle](http://deviq.com/explicit-dependencies-principle/).</span></span> <span data-ttu-id="e0ac6-113">Essa abordagem é conhecida como "injeção de construtor".</span><span class="sxs-lookup"><span data-stu-id="e0ac6-113">This approach is known as "constructor injection".</span></span>

<span data-ttu-id="e0ac6-114">Quando as classes são criadas com a DI em mente, elas têm um acoplamento mais flexível porque não têm dependências diretas e embutidas em código em seus colaboradores.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-114">When classes are designed with DI in mind, they're more loosely coupled because they don't have direct, hard-coded dependencies on their collaborators.</span></span> <span data-ttu-id="e0ac6-115">Isso segue o [Princípio de Inversão de Dependência](http://deviq.com/dependency-inversion-principle/), que indica que *"módulos de nível alto não devem depender de módulos de nível baixo; ambos devem depender de abstrações".*</span><span class="sxs-lookup"><span data-stu-id="e0ac6-115">This follows the [Dependency Inversion Principle](http://deviq.com/dependency-inversion-principle/), which states that *"high level modules shouldn't depend on low level modules; both should depend on abstractions."*</span></span> <span data-ttu-id="e0ac6-116">Em vez de referenciar implementações específicas, as classes solicitam abstrações (geralmente, `interfaces`) que são fornecidas a elas quando a classe é construída.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-116">Instead of referencing specific implementations, classes request abstractions (typically `interfaces`) which are provided to them when the class is constructed.</span></span> <span data-ttu-id="e0ac6-117">A extração de dependências em interfaces e fornecimento de implementações dessas interfaces como parâmetros também é um exemplo do [Padrão de design de estratégia](http://deviq.com/strategy-design-pattern/).</span><span class="sxs-lookup"><span data-stu-id="e0ac6-117">Extracting dependencies into interfaces and providing implementations of these interfaces as parameters is also an example of the [Strategy design pattern](http://deviq.com/strategy-design-pattern/).</span></span>

<span data-ttu-id="e0ac6-118">Quando um sistema é projetado para usar a DI, com muitas classes solicitando suas dependências por meio de seu construtor (ou propriedades), é útil ter uma classe dedicada à criação dessas classes com suas dependências associadas.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-118">When a system is designed to use DI, with many classes requesting their dependencies via their constructor (or properties), it's helpful to have a class dedicated to creating these classes with their associated dependencies.</span></span> <span data-ttu-id="e0ac6-119">Essas classes são chamadas de *contêineres* ou mais especificamente, contêineres [IoC (Inversão de Controle)](http://deviq.com/inversion-of-control/) ou contêineres DI (Injeção de Dependência).</span><span class="sxs-lookup"><span data-stu-id="e0ac6-119">These classes are referred to as *containers*, or more specifically, [Inversion of Control (IoC)](http://deviq.com/inversion-of-control/) containers or Dependency Injection (DI) containers.</span></span> <span data-ttu-id="e0ac6-120">Basicamente, um contêiner é um alocador responsável por fornecer instâncias dos tipos solicitados dele.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-120">A container is essentially a factory that's responsible for providing instances of types that are requested from it.</span></span> <span data-ttu-id="e0ac6-121">Se determinado tipo declarou que tem dependências e o contêiner foi configurado para fornecer os tipos de dependência, ele criará as dependências como parte da criação da instância solicitada.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-121">If a given type has declared that it has dependencies, and the container has been configured to provide the dependency types, it will create the dependencies as part of creating the requested instance.</span></span> <span data-ttu-id="e0ac6-122">Dessa forma, grafos de dependência complexos podem ser fornecidos para classes sem a necessidade de uma construção de objeto embutida em código.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-122">In this way, complex dependency graphs can be provided to classes without the need for any hard-coded object construction.</span></span> <span data-ttu-id="e0ac6-123">Além de criar objetos com suas dependências, os contêineres normalmente gerenciam tempos de vida de objeto no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-123">In addition to creating objects with their dependencies, containers typically manage object lifetimes within the application.</span></span>

<span data-ttu-id="e0ac6-124">O ASP.NET Core inclui um contêiner interno simples (representado pela interface `IServiceProvider`) que dá suporte à injeção de construtor por padrão e o ASP.NET disponibiliza alguns serviços por meio da DI.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-124">ASP.NET Core includes a simple built-in container (represented by the `IServiceProvider` interface) that supports constructor injection by default, and ASP.NET makes certain services available through DI.</span></span> <span data-ttu-id="e0ac6-125">O contêiner do ASP.NET refere-se aos tipos que ele gerencia como *serviços*.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-125">ASP.NET's container refers to the types it manages as *services*.</span></span> <span data-ttu-id="e0ac6-126">No restante deste artigo, *serviços* se referirão aos tipos que são gerenciados pelo contêiner IoC do ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-126">Throughout the rest of this article, *services* will refer to types that are managed by ASP.NET Core's IoC container.</span></span> <span data-ttu-id="e0ac6-127">Configure os serviços do contêiner interno no método `ConfigureServices` na classe `Startup` do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-127">You configure the built-in container's services in the `ConfigureServices` method in your application's `Startup` class.</span></span>

> [!NOTE]
> <span data-ttu-id="e0ac6-128">Martin Fowler escreveu um artigo abrangente sobre [Contêineres de Inversão de Controle e o padrão de injeção de dependência](https://www.martinfowler.com/articles/injection.html).</span><span class="sxs-lookup"><span data-stu-id="e0ac6-128">Martin Fowler has written an extensive article on [Inversion of Control Containers and the Dependency Injection Pattern](https://www.martinfowler.com/articles/injection.html).</span></span> <span data-ttu-id="e0ac6-129">O grupo Padrões e Práticas Microsoft também tem uma ótima descrição sobre a [Injeção de Dependência](https://msdn.microsoft.com/library/hh323705.aspx).</span><span class="sxs-lookup"><span data-stu-id="e0ac6-129">Microsoft Patterns and Practices also has a great description of [Dependency Injection](https://msdn.microsoft.com/library/hh323705.aspx).</span></span>

> [!NOTE]
> <span data-ttu-id="e0ac6-130">Este artigo aborda a Injeção de Dependência aplicável a todos os aplicativos ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-130">This article covers Dependency Injection as it applies to all ASP.NET applications.</span></span> <span data-ttu-id="e0ac6-131">A Injeção de Dependência em controladores MVC é abordada em [Injeção de Dependência e controladores](../mvc/controllers/dependency-injection.md).</span><span class="sxs-lookup"><span data-stu-id="e0ac6-131">Dependency Injection within MVC controllers is covered in [Dependency Injection and Controllers](../mvc/controllers/dependency-injection.md).</span></span>

### <a name="constructor-injection-behavior"></a><span data-ttu-id="e0ac6-132">Comportamento da injeção de construtor</span><span class="sxs-lookup"><span data-stu-id="e0ac6-132">Constructor injection behavior</span></span>

<span data-ttu-id="e0ac6-133">A injeção de construtor exige que o construtor em questão seja *público*.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-133">Constructor injection requires that the constructor in question be *public*.</span></span> <span data-ttu-id="e0ac6-134">Caso contrário, o aplicativo gerará uma `InvalidOperationException`:</span><span class="sxs-lookup"><span data-stu-id="e0ac6-134">Otherwise, your app will throw an `InvalidOperationException`:</span></span>

> <span data-ttu-id="e0ac6-135">Um construtor adequado para o tipo 'YourType' não pôde ser localizado.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-135">A suitable constructor for type 'YourType' couldn't be located.</span></span> <span data-ttu-id="e0ac6-136">Verifique se o tipo é concreto e se os serviços estão registrados para todos os parâmetros de um construtor público.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-136">Ensure the type is concrete and services are registered for all parameters of a public constructor.</span></span>

<span data-ttu-id="e0ac6-137">A injeção de construtor exige apenas a existência de um construtor aplicável.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-137">Constructor injection requires that only one applicable constructor exist.</span></span> <span data-ttu-id="e0ac6-138">Há suporte para sobrecargas de construtor, mas somente uma sobrecarga pode existir, cujos argumentos podem ser todos atendidos pela injeção de dependência.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-138">Constructor overloads are supported, but only one overload can exist whose arguments can all be fulfilled by dependency injection.</span></span> <span data-ttu-id="e0ac6-139">Se houver mais de um, o aplicativo gerará uma `InvalidOperationException`:</span><span class="sxs-lookup"><span data-stu-id="e0ac6-139">If more than one exists, your app will throw an `InvalidOperationException`:</span></span>

> <span data-ttu-id="e0ac6-140">Vários construtores que aceitam todos os tipos de argumento fornecidos foram encontrados no tipo 'YourType'.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-140">Multiple constructors accepting all given argument types have been found in type 'YourType'.</span></span> <span data-ttu-id="e0ac6-141">Deve haver apenas um construtor aplicável.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-141">There should only be one applicable constructor.</span></span>

<span data-ttu-id="e0ac6-142">Os construtores podem aceitar argumentos que não são fornecidos pela injeção de dependência, mas precisam dar suporte a valores padrão.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-142">Constructors can accept arguments that are not provided by dependency injection, but these must support default values.</span></span> <span data-ttu-id="e0ac6-143">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="e0ac6-143">For example:</span></span>

```csharp
// throws InvalidOperationException: Unable to resolve service for type 'System.String'...
public CharactersController(ICharacterRepository characterRepository, string title)
{
    _characterRepository = characterRepository;
    _title = title;
}

// runs without error
public CharactersController(ICharacterRepository characterRepository, string title = "Characters")
{
    _characterRepository = characterRepository;
    _title = title;
}
```

## <a name="using-framework-provided-services"></a><span data-ttu-id="e0ac6-144">Usando serviços fornecidos pela estrutura</span><span class="sxs-lookup"><span data-stu-id="e0ac6-144">Using framework-provided services</span></span>

<span data-ttu-id="e0ac6-145">O método `ConfigureServices` na classe `Startup` é responsável por definir os serviços que serão usados pelo aplicativo, incluindo recursos de plataforma como o Entity Framework Core e ASP.NET Core MVC.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-145">The `ConfigureServices` method in the `Startup` class is responsible for defining the services the application will use, including platform features like Entity Framework Core and ASP.NET Core MVC.</span></span> <span data-ttu-id="e0ac6-146">Inicialmente, a `IServiceCollection` fornecida ao `ConfigureServices` tem os seguintes serviços definidos (dependendo de [como o host foi configurado](xref:fundamentals/hosting)):</span><span class="sxs-lookup"><span data-stu-id="e0ac6-146">Initially, the `IServiceCollection` provided to `ConfigureServices` has the following services defined (depending on [how the host was configured](xref:fundamentals/hosting)):</span></span>

| <span data-ttu-id="e0ac6-147">Tipo de serviço</span><span class="sxs-lookup"><span data-stu-id="e0ac6-147">Service Type</span></span> | <span data-ttu-id="e0ac6-148">Tempo de vida</span><span class="sxs-lookup"><span data-stu-id="e0ac6-148">Lifetime</span></span> |
| ----- | ------- |
| [<span data-ttu-id="e0ac6-149">Microsoft.AspNetCore.Hosting.IHostingEnvironment</span><span class="sxs-lookup"><span data-stu-id="e0ac6-149">Microsoft.AspNetCore.Hosting.IHostingEnvironment</span></span>](/dotnet/api/microsoft.aspnetcore.hosting.ihostingenvironment) | <span data-ttu-id="e0ac6-150">Singleton</span><span class="sxs-lookup"><span data-stu-id="e0ac6-150">Singleton</span></span> |
| [<span data-ttu-id="e0ac6-151">Microsoft.Extensions.Logging.ILoggerFactory</span><span class="sxs-lookup"><span data-stu-id="e0ac6-151">Microsoft.Extensions.Logging.ILoggerFactory</span></span>](/dotnet/api/microsoft.extensions.logging.iloggerfactory) | <span data-ttu-id="e0ac6-152">Singleton</span><span class="sxs-lookup"><span data-stu-id="e0ac6-152">Singleton</span></span> |
| [<span data-ttu-id="e0ac6-153">Microsoft.Extensions.Logging.ILogger&lt;T&gt;</span><span class="sxs-lookup"><span data-stu-id="e0ac6-153">Microsoft.Extensions.Logging.ILogger&lt;T&gt;</span></span>](/dotnet/api/microsoft.extensions.logging.ilogger) | <span data-ttu-id="e0ac6-154">Singleton</span><span class="sxs-lookup"><span data-stu-id="e0ac6-154">Singleton</span></span> |
| [<span data-ttu-id="e0ac6-155">Microsoft.AspNetCore.Hosting.Builder.IApplicationBuilderFactory</span><span class="sxs-lookup"><span data-stu-id="e0ac6-155">Microsoft.AspNetCore.Hosting.Builder.IApplicationBuilderFactory</span></span>](/dotnet/api/microsoft.aspnetcore.hosting.builder.iapplicationbuilderfactory) | <span data-ttu-id="e0ac6-156">Transitório</span><span class="sxs-lookup"><span data-stu-id="e0ac6-156">Transient</span></span> |
| [<span data-ttu-id="e0ac6-157">Microsoft.AspNetCore.Http.IHttpContextFactory</span><span class="sxs-lookup"><span data-stu-id="e0ac6-157">Microsoft.AspNetCore.Http.IHttpContextFactory</span></span>](/dotnet/api/microsoft.aspnetcore.http.ihttpcontextfactory) | <span data-ttu-id="e0ac6-158">Transitório</span><span class="sxs-lookup"><span data-stu-id="e0ac6-158">Transient</span></span> |
| [<span data-ttu-id="e0ac6-159">Microsoft.Extensions.Options.IOptions&lt;T&gt;</span><span class="sxs-lookup"><span data-stu-id="e0ac6-159">Microsoft.Extensions.Options.IOptions&lt;T&gt;</span></span>](/dotnet/api/microsoft.extensions.options.ioptions-1) | <span data-ttu-id="e0ac6-160">Singleton</span><span class="sxs-lookup"><span data-stu-id="e0ac6-160">Singleton</span></span> |
| [<span data-ttu-id="e0ac6-161">System.Diagnostics.DiagnosticSource</span><span class="sxs-lookup"><span data-stu-id="e0ac6-161">System.Diagnostics.DiagnosticSource</span></span>](https://docs.microsoft.com/dotnet/core/api/system.diagnostics.diagnosticsource) | <span data-ttu-id="e0ac6-162">Singleton</span><span class="sxs-lookup"><span data-stu-id="e0ac6-162">Singleton</span></span> |
| [<span data-ttu-id="e0ac6-163">System.Diagnostics.DiagnosticListener</span><span class="sxs-lookup"><span data-stu-id="e0ac6-163">System.Diagnostics.DiagnosticListener</span></span>](https://docs.microsoft.com/dotnet/core/api/system.diagnostics.diagnosticlistener) | <span data-ttu-id="e0ac6-164">Singleton</span><span class="sxs-lookup"><span data-stu-id="e0ac6-164">Singleton</span></span> |
| [<span data-ttu-id="e0ac6-165">Microsoft.AspNetCore.Hosting.IStartupFilter</span><span class="sxs-lookup"><span data-stu-id="e0ac6-165">Microsoft.AspNetCore.Hosting.IStartupFilter</span></span>](/dotnet/api/microsoft.aspnetcore.hosting.istartupfilter) | <span data-ttu-id="e0ac6-166">Transitório</span><span class="sxs-lookup"><span data-stu-id="e0ac6-166">Transient</span></span> |
| [<span data-ttu-id="e0ac6-167">Microsoft.Extensions.ObjectPool.ObjectPoolProvider</span><span class="sxs-lookup"><span data-stu-id="e0ac6-167">Microsoft.Extensions.ObjectPool.ObjectPoolProvider</span></span>](/dotnet/api/microsoft.extensions.objectpool.objectpoolprovider) | <span data-ttu-id="e0ac6-168">Singleton</span><span class="sxs-lookup"><span data-stu-id="e0ac6-168">Singleton</span></span> |
| [<span data-ttu-id="e0ac6-169">Microsoft.Extensions.Options.IConfigureOptions&lt;T&gt;</span><span class="sxs-lookup"><span data-stu-id="e0ac6-169">Microsoft.Extensions.Options.IConfigureOptions&lt;T&gt;</span></span>](/dotnet/api/microsoft.extensions.options.iconfigureoptions-1) | <span data-ttu-id="e0ac6-170">Transitório</span><span class="sxs-lookup"><span data-stu-id="e0ac6-170">Transient</span></span> |
| [<span data-ttu-id="e0ac6-171">Microsoft.AspNetCore.Hosting.Server.IServer</span><span class="sxs-lookup"><span data-stu-id="e0ac6-171">Microsoft.AspNetCore.Hosting.Server.IServer</span></span>](/dotnet/api/microsoft.aspnetcore.hosting.server.iserver) | <span data-ttu-id="e0ac6-172">Singleton</span><span class="sxs-lookup"><span data-stu-id="e0ac6-172">Singleton</span></span> |
| [<span data-ttu-id="e0ac6-173">Microsoft.AspNetCore.Hosting.IStartup</span><span class="sxs-lookup"><span data-stu-id="e0ac6-173">Microsoft.AspNetCore.Hosting.IStartup</span></span>](/dotnet/api/microsoft.aspnetcore.hosting.istartup) | <span data-ttu-id="e0ac6-174">Singleton</span><span class="sxs-lookup"><span data-stu-id="e0ac6-174">Singleton</span></span> |
| [<span data-ttu-id="e0ac6-175">Microsoft.AspNetCore.Hosting.IApplicationLifetime</span><span class="sxs-lookup"><span data-stu-id="e0ac6-175">Microsoft.AspNetCore.Hosting.IApplicationLifetime</span></span>](/dotnet/api/microsoft.aspnetcore.hosting.iapplicationlifetime) | <span data-ttu-id="e0ac6-176">Singleton</span><span class="sxs-lookup"><span data-stu-id="e0ac6-176">Singleton</span></span> |

<span data-ttu-id="e0ac6-177">Veja abaixo um exemplo de como adicionar outros serviços ao contêiner usando vários métodos de extensão como `AddDbContext`, `AddIdentity` e `AddMvc`.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-177">Below is an example of how to add additional services to the container using a number of extension methods like `AddDbContext`, `AddIdentity`, and `AddMvc`.</span></span>

[!code-csharp[](../common/samples/WebApplication1/Startup.cs?highlight=5-6,8-10,12&range=39-56)]

<span data-ttu-id="e0ac6-178">Os recursos e o middleware fornecidos pelo ASP.NET, como o MVC, seguem uma convenção de uso de um único método de extensão Add*ServiceName* para registrar todos os serviços exigidos pelo recurso.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-178">The features and middleware provided by ASP.NET, such as MVC, follow a convention of using a single Add*ServiceName* extension method to register all of the services required by that feature.</span></span>

> [!TIP]
> <span data-ttu-id="e0ac6-179">Você pode solicitar alguns serviços fornecidos pela estrutura em métodos `Startup` por meio de suas listas de parâmetros – consulte [Inicialização do aplicativo](startup.md) para obter mais detalhes.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-179">You can request certain framework-provided services within `Startup` methods through their parameter lists - see [Application Startup](startup.md) for more details.</span></span>

## <a name="registering-services"></a><span data-ttu-id="e0ac6-180">Registrando serviços</span><span class="sxs-lookup"><span data-stu-id="e0ac6-180">Registering services</span></span>

<span data-ttu-id="e0ac6-181">Você pode registrar seus próprios Serviços de Aplicativos conforme mostrado a seguir.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-181">You can register your own application services as follows.</span></span> <span data-ttu-id="e0ac6-182">O primeiro tipo genérico representa o tipo (normalmente uma interface) que será solicitado do contêiner.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-182">The first generic type represents the type (typically an interface) that will be requested from the container.</span></span> <span data-ttu-id="e0ac6-183">O segundo tipo genérico representa o tipo concreto do qual será criada uma instância pelo contêiner e que será usado para atender a essas solicitações.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-183">The second generic type represents the concrete type that will be instantiated by the container and used to fulfill such requests.</span></span>

[!code-csharp[](../common/samples/WebApplication1/Startup.cs?range=53-54)]

> [!NOTE]
> <span data-ttu-id="e0ac6-184">Cada método de extensão `services.Add<ServiceName>` adiciona (e possivelmente configura) serviços.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-184">Each `services.Add<ServiceName>` extension method adds (and potentially configures) services.</span></span> <span data-ttu-id="e0ac6-185">Por exemplo, o `services.AddMvc()` adiciona os serviços exigidos pelo MVC.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-185">For example, `services.AddMvc()` adds the services MVC requires.</span></span> <span data-ttu-id="e0ac6-186">É recomendável que você siga essa convenção, colocando os métodos de extensão no namespace `Microsoft.Extensions.DependencyInjection`, para encapsular grupos de registros de serviço.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-186">It's recommended that you follow this convention, placing extension methods in the `Microsoft.Extensions.DependencyInjection` namespace, to encapsulate groups of service registrations.</span></span>

<span data-ttu-id="e0ac6-187">O método `AddTransient` é usado para mapear tipos abstratos para serviços concretos dos quais são criadas instâncias separadamente para cada objeto que exigir isso.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-187">The `AddTransient` method is used to map abstract types to concrete services that are instantiated separately for every object that requires it.</span></span> <span data-ttu-id="e0ac6-188">Isso é conhecido como o *tempo de vida* do serviço e opções de tempo de vida adicionais são descritas abaixo.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-188">This is known as the service's *lifetime*, and additional lifetime options are described below.</span></span> <span data-ttu-id="e0ac6-189">É importante escolher um tempo de vida apropriado para cada um dos serviços registrados.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-189">It's important to choose an appropriate lifetime for each of the services you register.</span></span> <span data-ttu-id="e0ac6-190">Uma nova instância do serviço deve ser fornecida para cada classe que a solicitar?</span><span class="sxs-lookup"><span data-stu-id="e0ac6-190">Should a new instance of the service be provided to each class that requests it?</span></span> <span data-ttu-id="e0ac6-191">Uma instância deve ser usada durante uma solicitação da Web especificada?</span><span class="sxs-lookup"><span data-stu-id="e0ac6-191">Should one instance be used throughout a given web request?</span></span> <span data-ttu-id="e0ac6-192">Ou uma única instância deve ser usada para o tempo de vida do aplicativo?</span><span class="sxs-lookup"><span data-stu-id="e0ac6-192">Or should a single instance be used for the lifetime of the application?</span></span>

<span data-ttu-id="e0ac6-193">Na amostra deste artigo, há um controlador simples que exibe os nomes de caracteres, chamado `CharactersController`.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-193">In the sample for this article, there's a simple controller that displays character names, called `CharactersController`.</span></span> <span data-ttu-id="e0ac6-194">Seu método `Index` exibe a lista atual de caracteres que foram armazenados no aplicativo e inicializa a coleção com uma série de caracteres, se não houver nenhum.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-194">Its `Index` method displays the current list of characters that have been stored in the application, and initializes the collection with a handful of characters if none exist.</span></span> <span data-ttu-id="e0ac6-195">Observe que, embora esse aplicativo use o Entity Framework Core e a classe `ApplicationDbContext` para sua persistência, nada disso é aparente no controlador.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-195">Note that although this application uses Entity Framework Core and the `ApplicationDbContext` class for its persistence, none of that's apparent in the controller.</span></span> <span data-ttu-id="e0ac6-196">Em vez disso, o mecanismo de acesso a dados específico foi abstraído por trás de uma interface `ICharacterRepository`, que segue o [padrão do repositório](http://deviq.com/repository-pattern/).</span><span class="sxs-lookup"><span data-stu-id="e0ac6-196">Instead, the specific data access mechanism has been abstracted behind an interface, `ICharacterRepository`, which follows the [repository pattern](http://deviq.com/repository-pattern/).</span></span> <span data-ttu-id="e0ac6-197">Uma instância de `ICharacterRepository` é solicitada por meio do construtor e atribuída a um campo particular, que é então usado para acessar caracteres, conforme necessário.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-197">An instance of `ICharacterRepository` is requested via the constructor and assigned to a private field, which is then used to access characters as necessary.</span></span>

[!code-csharp[](../fundamentals/dependency-injection/sample/DependencyInjectionSample/Controllers/CharactersController.cs?highlight=3,5,6,7,8,14,21-27&range=8-36)]

<span data-ttu-id="e0ac6-198">O `ICharacterRepository` define os dois métodos que o controlador precisa para trabalhar com instâncias `Character`.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-198">The `ICharacterRepository` defines the two methods the controller needs to work with `Character` instances.</span></span>

[!code-csharp[](../fundamentals/dependency-injection/sample/DependencyInjectionSample/Interfaces/ICharacterRepository.cs?highlight=8,9)]

<span data-ttu-id="e0ac6-199">Por sua vez, essa interface é implementada por um tipo concreto, `CharacterRepository`, que é usado em tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-199">This interface is in turn implemented by a concrete type, `CharacterRepository`, that's used at runtime.</span></span>

> [!NOTE]
> <span data-ttu-id="e0ac6-200">A maneira como a DI é usada com a classe `CharacterRepository` é um modelo geral que você pode seguir para todos os Serviços de Aplicativos, não apenas em "repositórios" ou classes de acesso a dados.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-200">The way DI is used with the `CharacterRepository` class is a general model you can follow for all of your application services, not just in "repositories" or data access classes.</span></span>

[!code-csharp[](../fundamentals/dependency-injection/sample/DependencyInjectionSample/Models/CharacterRepository.cs?highlight=9,11,12,13,14)]

<span data-ttu-id="e0ac6-201">Observe que `CharacterRepository` solicita um `ApplicationDbContext` em seu construtor.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-201">Note that `CharacterRepository` requests an `ApplicationDbContext` in its constructor.</span></span> <span data-ttu-id="e0ac6-202">Não é incomum que a injeção de dependência seja usada de maneira encadeada dessa forma, com cada dependência solicitada solicitando, por sua vez, suas próprias dependências.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-202">It's not unusual for dependency injection to be used in a chained fashion like this, with each requested dependency in turn requesting its own dependencies.</span></span> <span data-ttu-id="e0ac6-203">O contêiner é responsável por resolver todas as dependências no grafo e retornar o serviço totalmente resolvido.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-203">The container is responsible for resolving all of the dependencies in the graph and returning the fully resolved service.</span></span>

> [!NOTE]
> <span data-ttu-id="e0ac6-204">A criação do objeto solicitado e todos os objetos exigidos por ele, além de todos os objetos que esses outros exigem, é, às vezes, chamado de um *grafo de objeto*.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-204">Creating the requested object, and all of the objects it requires, and all of the objects those require, is sometimes referred to as an *object graph*.</span></span> <span data-ttu-id="e0ac6-205">Da mesma forma, o conjunto de dependências que precisa ser resolvido normalmente é chamado de uma *árvore de dependência* ou um *grafo de dependência*.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-205">Likewise, the collective set of dependencies that must be resolved is typically referred to as a *dependency tree* or *dependency graph*.</span></span>

<span data-ttu-id="e0ac6-206">Nesse caso, `ICharacterRepository` e, por sua vez, `ApplicationDbContext` precisam ser registrados no contêiner de serviços em `ConfigureServices` em `Startup`.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-206">In this case, both `ICharacterRepository` and in turn `ApplicationDbContext` must be registered with the services container in `ConfigureServices` in `Startup`.</span></span> <span data-ttu-id="e0ac6-207">`ApplicationDbContext` é configurado com a chamada ao método de extensão `AddDbContext<T>`.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-207">`ApplicationDbContext` is configured with the call to the extension method `AddDbContext<T>`.</span></span> <span data-ttu-id="e0ac6-208">O código a seguir mostra o registro do tipo `CharacterRepository`.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-208">The following code shows the registration of the `CharacterRepository` type.</span></span>

[!code-csharp[](dependency-injection/sample/DependencyInjectionSample/Startup.cs?highlight=3-5,11&range=16-32)]

<span data-ttu-id="e0ac6-209">Os contextos do Entity Framework devem ser adicionados ao contêiner de serviços com o tempo de vida `Scoped`.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-209">Entity Framework contexts should be added to the services container using the `Scoped` lifetime.</span></span> <span data-ttu-id="e0ac6-210">Isso será resolvido automaticamente se você usar os métodos auxiliares, conforme mostrado acima.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-210">This is taken care of automatically if you use the helper methods as shown above.</span></span> <span data-ttu-id="e0ac6-211">Os repositórios que farão uso do Entity Framework devem usar o mesmo tempo de vida.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-211">Repositories that will make use of Entity Framework should use the same lifetime.</span></span>

> [!WARNING]
> <span data-ttu-id="e0ac6-212">O principal perigo com o qual é necessário ter cautela é resolver um serviço `Scoped` em um singleton.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-212">The main danger to be wary of is resolving a `Scoped` service from a singleton.</span></span> <span data-ttu-id="e0ac6-213">É provável que, nesse caso, o serviço terá um estado incorreto durante o processamento das solicitações seguintes.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-213">It's likely in such a case that the service will have incorrect state when processing subsequent requests.</span></span>

<span data-ttu-id="e0ac6-214">Serviços que têm dependências devem registrá-las no contêiner.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-214">Services that have dependencies should register them in the container.</span></span> <span data-ttu-id="e0ac6-215">Se o construtor de um serviço exigir um primitivo, como uma `string`, isso poderá ser injetado com o uso da [configuração](xref:fundamentals/configuration/index) e do [padrão de opções](xref:fundamentals/configuration/options).</span><span class="sxs-lookup"><span data-stu-id="e0ac6-215">If a service's constructor requires a primitive, such as a `string`, this can be injected by using [configuration](xref:fundamentals/configuration/index) and the [options pattern](xref:fundamentals/configuration/options).</span></span>

## <a name="service-lifetimes-and-registration-options"></a><span data-ttu-id="e0ac6-216">Tempos de vida do serviço e opções de registro</span><span class="sxs-lookup"><span data-stu-id="e0ac6-216">Service lifetimes and registration options</span></span>

<span data-ttu-id="e0ac6-217">Os serviços do ASP.NET podem ser configurados com os seguintes tempos de vida:</span><span class="sxs-lookup"><span data-stu-id="e0ac6-217">ASP.NET services can be configured with the following lifetimes:</span></span>

<span data-ttu-id="e0ac6-218">**Transitório**</span><span class="sxs-lookup"><span data-stu-id="e0ac6-218">**Transient**</span></span>

<span data-ttu-id="e0ac6-219">Os serviços com tempo de vida transitório são criados sempre que são solicitados.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-219">Transient lifetime services are created each time they're requested.</span></span> <span data-ttu-id="e0ac6-220">Esse tempo de vida funciona melhor para serviços leves e sem estado.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-220">This lifetime works best for lightweight, stateless services.</span></span>

<span data-ttu-id="e0ac6-221">**Com escopo**</span><span class="sxs-lookup"><span data-stu-id="e0ac6-221">**Scoped**</span></span>

<span data-ttu-id="e0ac6-222">Os serviços com tempo de vida com escopo são criados uma vez por solicitação.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-222">Scoped lifetime services are created once per request.</span></span>

> [!WARNING]
> <span data-ttu-id="e0ac6-223">Se você estiver usando um serviço com escopo em um middleware, injete o serviço no método `Invoke` ou `InvokeAsync`.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-223">If you're using a scoped service in a middleware, inject the service into the `Invoke` or `InvokeAsync` method.</span></span> <span data-ttu-id="e0ac6-224">Não injete por meio de injeção de construtor porque isso força o serviço a se comportar como um singleton.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-224">Don't inject via constructor injection because it forces the service to behave like a singleton.</span></span>

<span data-ttu-id="e0ac6-225">**Singleton**</span><span class="sxs-lookup"><span data-stu-id="e0ac6-225">**Singleton**</span></span>

<span data-ttu-id="e0ac6-226">Os serviços com tempo de vida singleton são criados na primeira vez em que são solicitados (ou quando `ConfigureServices` for executado se você especificar uma instância nele) e, em seguida, todas as solicitações seguintes usarão a mesma instância.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-226">Singleton lifetime services are created the first time they're requested (or when `ConfigureServices` is run if you specify an instance there) and then every subsequent request will use the same instance.</span></span> <span data-ttu-id="e0ac6-227">Se o aplicativo exigir o comportamento singleton, é recomendado permitir que o contêiner de serviços gerencie o tempo de vida do serviço, em vez de implementar o padrão de design singleton e gerenciar o tempo de vida do objeto na classe por conta própria.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-227">If your application requires singleton behavior, allowing the services container to manage the service's lifetime is recommended instead of implementing the singleton design pattern and managing your object's lifetime in the class yourself.</span></span>

<span data-ttu-id="e0ac6-228">Os serviços podem ser registrados no contêiner de várias maneiras.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-228">Services can be registered with the container in several ways.</span></span> <span data-ttu-id="e0ac6-229">Já vimos como registrar uma implementação de serviço com um tipo fornecido, especificando o tipo concreto a ser usado.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-229">We have already seen how to register a service implementation with a given type by specifying the concrete type to use.</span></span> <span data-ttu-id="e0ac6-230">Além disso, um alocador pode ser especificado, que, em seguida, será usado para criar a instância sob demanda.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-230">In addition, a factory can be specified, which will then be used to create the instance on demand.</span></span> <span data-ttu-id="e0ac6-231">A terceira abordagem é especificar diretamente a instância do tipo a ser usada, nesse caso, o contêiner nunca tentará criar uma instância (nem descartará a instância).</span><span class="sxs-lookup"><span data-stu-id="e0ac6-231">The third approach is to directly specify the instance of the type to use, in which case the container will never attempt to create an instance (nor will it dispose of the instance).</span></span>

<span data-ttu-id="e0ac6-232">Para demonstrar a diferença entre essas opções de tempo de vida e registro, considere uma interface simples que representa uma ou mais tarefas como uma *operação* com um identificador exclusivo, `OperationId`.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-232">To demonstrate the difference between these lifetime and registration options, consider a simple interface that represents one or more tasks as an *operation* with a unique identifier, `OperationId`.</span></span> <span data-ttu-id="e0ac6-233">Dependendo de como configurarmos o tempo de vida para esse serviço, o contêiner fornecerá as mesmas instâncias ou instâncias diferentes do serviço para a classe solicitante.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-233">Depending on how we configure the lifetime for this service, the container will provide either the same or different instances of the service to the requesting class.</span></span> <span data-ttu-id="e0ac6-234">Para tornar claro qual tempo de vida está sendo solicitado, criaremos um tipo por opção de tempo de vida:</span><span class="sxs-lookup"><span data-stu-id="e0ac6-234">To make it clear which lifetime is being requested, we will create one type per lifetime option:</span></span>

[!code-csharp[](../fundamentals/dependency-injection/sample/DependencyInjectionSample/Interfaces/IOperation.cs?highlight=5-8)]

<span data-ttu-id="e0ac6-235">Implementamos essas interfaces usando uma única classe, `Operation`, que aceita um `Guid` em seu construtor, ou usa um novo `Guid`, se nenhum é fornecido.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-235">We implement these interfaces using a single class, `Operation`, that accepts a `Guid` in its constructor, or uses a new `Guid` if none is provided.</span></span>

<span data-ttu-id="e0ac6-236">Em seguida, em `ConfigureServices`, cada tipo é adicionado ao contêiner de acordo com seu tempo de vida nomeado:</span><span class="sxs-lookup"><span data-stu-id="e0ac6-236">Next, in `ConfigureServices`, each type is added to the container according to its named lifetime:</span></span>

[!code-csharp[](dependency-injection/sample/DependencyInjectionSample/Startup.cs?range=26-32)]

<span data-ttu-id="e0ac6-237">Observe que o serviço `IOperationSingletonInstance` usa uma instância específica com uma ID conhecida `Guid.Empty`, para que fique claro quando esse tipo está em uso (seu Guid serão todos zeros).</span><span class="sxs-lookup"><span data-stu-id="e0ac6-237">Note that the `IOperationSingletonInstance` service is using a specific instance with a known ID of `Guid.Empty` so it will be clear when this type is in use (its Guid will be all zeroes).</span></span> <span data-ttu-id="e0ac6-238">Também registramos um `OperationService` que depende de cada um dos outros tipos `Operation`, de modo que fique claro em uma solicitação se esse serviço está obtendo a mesma instância do controlador ou uma nova, para cada tipo de operação.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-238">We have also registered an `OperationService` that depends on each of the other `Operation` types, so that it will be clear within a request whether this service is getting the same instance as the controller, or a new one, for each operation type.</span></span> <span data-ttu-id="e0ac6-239">Tudo o que esse serviço faz é expor suas dependências como propriedades, para que possam ser mostradas no exibição.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-239">All this service does is expose its dependencies as properties, so they can be displayed in the view.</span></span>

[!code-csharp[](dependency-injection/sample/DependencyInjectionSample/Services/OperationService.cs)]

<span data-ttu-id="e0ac6-240">Para demonstrar os tempos de vida de objeto dentro e entre solicitações individuais separadas para o aplicativo, a amostra inclui um `OperationsController` que solicita cada tipo do tipo `IOperation`, bem como um `OperationService`.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-240">To demonstrate the object lifetimes within and between separate individual requests to the application, the sample includes an `OperationsController` that requests each kind of `IOperation` type as well as an `OperationService`.</span></span> <span data-ttu-id="e0ac6-241">A ação `Index` então exibe todos os valores `OperationId` do controlador e do serviço.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-241">The `Index` action then displays all of the controller's and service's `OperationId` values.</span></span>

[!code-csharp[](dependency-injection/sample/DependencyInjectionSample/Controllers/OperationsController.cs)]

<span data-ttu-id="e0ac6-242">Agora, duas solicitações separadas são feitas para esta ação do controlador:</span><span class="sxs-lookup"><span data-stu-id="e0ac6-242">Now two separate requests are made to this controller action:</span></span>

![A exibição Operações do aplicativo Web da Amostra de Injeção de Dependência em execução no Microsoft Edge mostrando valores de ID da Operação (GUIDs) para Transitório, Com Escopo, Singleton e Controlador da Instância e Operações de Serviço de Operação na primeira solicitação.](dependency-injection/_static/lifetimes_request1.png)

![A exibição de operações mostrando os valores de ID da Operação para uma segunda solicitação.](dependency-injection/_static/lifetimes_request2.png)

<span data-ttu-id="e0ac6-245">Observe qual dos valores `OperationId` varia em uma solicitação e entre as solicitações.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-245">Observe which of the `OperationId` values vary within a request, and between requests.</span></span>

* <span data-ttu-id="e0ac6-246">Objetos *transitórios* são sempre diferentes; uma nova instância é fornecida para cada controlador e serviço.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-246">*Transient* objects are always different; a new instance is provided to every controller and every service.</span></span>

* <span data-ttu-id="e0ac6-247">Objetos *com escopo* são os mesmos em uma solicitação, mas diferentes em diferentes solicitações</span><span class="sxs-lookup"><span data-stu-id="e0ac6-247">*Scoped* objects are the same within a request, but different across different requests</span></span>

* <span data-ttu-id="e0ac6-248">Objetos *singleton* são os mesmos para cada objeto e solicitação (independentemente de uma instância ser fornecida em `ConfigureServices`)</span><span class="sxs-lookup"><span data-stu-id="e0ac6-248">*Singleton* objects are the same for every object and every request (regardless of whether an instance is provided in `ConfigureServices`)</span></span>

## <a name="resolve-a-scoped-service-within-the-application-scope"></a><span data-ttu-id="e0ac6-249">Resolver um serviço com escopo dentro do escopo do aplicativo</span><span class="sxs-lookup"><span data-stu-id="e0ac6-249">Resolve a scoped service within the application scope</span></span>

<span data-ttu-id="e0ac6-250">Crie um [IServiceScope](/dotnet/api/microsoft.extensions.dependencyinjection.iservicescope) com [IServiceScopeFactory.CreateScope](/dotnet/api/microsoft.extensions.dependencyinjection.iservicescopefactory.createscope) para resolver um serviço com escopo dentro do escopo do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-250">Create an [IServiceScope](/dotnet/api/microsoft.extensions.dependencyinjection.iservicescope) with [IServiceScopeFactory.CreateScope](/dotnet/api/microsoft.extensions.dependencyinjection.iservicescopefactory.createscope) to resolve a scoped service within the app's scope.</span></span> <span data-ttu-id="e0ac6-251">Essa abordagem é útil para acessar um serviço com escopo durante a inicialização para executar tarefas de inicialização.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-251">This approach is useful to access a scoped service at startup to run initialization tasks.</span></span> <span data-ttu-id="e0ac6-252">O exemplo a seguir mostra como obter um contexto para o `MyScopedService` em `Program.Main`:</span><span class="sxs-lookup"><span data-stu-id="e0ac6-252">The following example shows how to obtain a context for the `MyScopedService` in `Program.Main`:</span></span>

```csharp
public static void Main(string[] args)
{
    var host = BuildWebHost(args);

    using (var serviceScope = host.Services.CreateScope())
    {
        var services = serviceScope.ServiceProvider;

        try
        {
            var serviceContext = services.GetRequiredService<MyScopedService>();
            // Use the context here
        }
        catch (Exception ex)
        {
            var logger = services.GetRequiredService<ILogger<Program>>();
            logger.LogError(ex, "An error occurred.");
        }
    }

    host.Run();
}
```

## <a name="scope-validation"></a><span data-ttu-id="e0ac6-253">Validação de escopo</span><span class="sxs-lookup"><span data-stu-id="e0ac6-253">Scope validation</span></span>

<span data-ttu-id="e0ac6-254">Quando o aplicativo é executado no ambiente de desenvolvimento no ASP.NET Core 2.0 ou posterior, o provedor de serviço padrão executa verificações para saber se:</span><span class="sxs-lookup"><span data-stu-id="e0ac6-254">When the app is running in the Development environment on ASP.NET Core 2.0 or later, the default service provider performs checks to verify that:</span></span>

* <span data-ttu-id="e0ac6-255">Os serviços com escopo não são resolvidos direta ou indiretamente pelo provedor de serviço raiz.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-255">Scoped services aren't directly or indirectly resolved from the root service provider.</span></span>
* <span data-ttu-id="e0ac6-256">Os serviços com escopo não são injetados direta ou indiretamente em singletons.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-256">Scoped services aren't directly or indirectly injected into singletons.</span></span>

<span data-ttu-id="e0ac6-257">O provedor de serviços raiz é criado quando [BuildServiceProvider](/dotnet/api/microsoft.extensions.dependencyinjection.servicecollectioncontainerbuilderextensions.buildserviceprovider) é chamado.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-257">The root service provider is created when [BuildServiceProvider](/dotnet/api/microsoft.extensions.dependencyinjection.servicecollectioncontainerbuilderextensions.buildserviceprovider) is called.</span></span> <span data-ttu-id="e0ac6-258">O tempo de vida do provedor de serviço raiz corresponde ao tempo de vida do aplicativo/servidor quando o provedor começa com o aplicativo e é descartado quando o aplicativo é desligado.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-258">The root service provider's lifetime corresponds to the app/server's lifetime when the provider starts with the app and is disposed when the app shuts down.</span></span>

<span data-ttu-id="e0ac6-259">Os serviços com escopo são descartados pelo contêiner que os criou.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-259">Scoped services are disposed by the container that created them.</span></span> <span data-ttu-id="e0ac6-260">Se um serviço com escopo é criado no contêiner raiz, o tempo de vida do serviço é promovido efetivamente para singleton, porque ele só é descartado pelo contêiner raiz quando o aplicativo/servidor é desligado.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-260">If a scoped service is created in the root container, the service's lifetime is effectively promoted to singleton because it's only disposed by the root container when app/server is shut down.</span></span> <span data-ttu-id="e0ac6-261">A validação dos escopos de serviço detecta essas situações quando `BuildServiceProvider` é chamado.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-261">Validating service scopes catches these situations when `BuildServiceProvider` is called.</span></span>

<span data-ttu-id="e0ac6-262">Para obter mais informações, confira [Validação de escopo no tópico Hospedagem](xref:fundamentals/hosting#scope-validation).</span><span class="sxs-lookup"><span data-stu-id="e0ac6-262">For more information, see [Scope validation in the Hosting topic](xref:fundamentals/hosting#scope-validation).</span></span>

## <a name="request-services"></a><span data-ttu-id="e0ac6-263">Serviços de solicitação</span><span class="sxs-lookup"><span data-stu-id="e0ac6-263">Request Services</span></span>

<span data-ttu-id="e0ac6-264">Os serviços disponíveis em uma solicitação do ASP.NET de `HttpContext` são expostos por meio da coleção `RequestServices`.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-264">The services available within an ASP.NET request from `HttpContext` are exposed through the `RequestServices` collection.</span></span>

![Caixa de diálogo contextual Serviços de Solicitação HttpContext do IntelliSense informando que os Serviços de Solicitação obtêm ou definem o IServiceProvider que fornece acesso ao contêiner de serviço da solicitação.](dependency-injection/_static/request-services.png)

<span data-ttu-id="e0ac6-266">Os Serviços de Solicitação representam os serviços configurados e solicitados como parte do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-266">Request Services represent the services you configure and request as part of your application.</span></span> <span data-ttu-id="e0ac6-267">Quando os objetos especificam dependências, elas são atendidas pelos tipos encontrados em `RequestServices`, não `ApplicationServices`.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-267">When your objects specify dependencies, these are satisfied by the types found in `RequestServices`, not `ApplicationServices`.</span></span>

<span data-ttu-id="e0ac6-268">Em geral, você não deve usar essas propriedades diretamente, preferindo solicitar os tipos exigidos pelas classes por meio do construtor da classe e permitindo que a estrutura injete essas dependências.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-268">Generally, you shouldn't use these properties directly, preferring instead to request the types your classes you require via your class's constructor, and letting the framework inject these dependencies.</span></span> <span data-ttu-id="e0ac6-269">Isso resulta em classes que são mais fáceis de testar (confira [Testar e depurar](../testing/index.md)) e são mais fracamente acopladas.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-269">This yields classes that are easier to test (see [Test and debug](../testing/index.md)) and are more loosely coupled.</span></span>

> [!NOTE]
> <span data-ttu-id="e0ac6-270">Prefira solicitar dependências como parâmetros de construtor para acessar a coleção `RequestServices`.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-270">Prefer requesting dependencies as constructor parameters to accessing the `RequestServices` collection.</span></span>

## <a name="designing-services-for-dependency-injection"></a><span data-ttu-id="e0ac6-271">Criando serviços para injeção de dependência</span><span class="sxs-lookup"><span data-stu-id="e0ac6-271">Designing services for dependency injection</span></span>

<span data-ttu-id="e0ac6-272">Você deve criar seus serviços para que usem a injeção de dependência para obter seus colaboradores.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-272">You should design your services to use dependency injection to get their collaborators.</span></span> <span data-ttu-id="e0ac6-273">Isso significa evitar o uso de chamadas de método estático com estado (que resultam em um "code smell" conhecido como [static cling](http://deviq.com/static-cling/)) e a criação direta de instâncias de classes dependentes em seus serviços.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-273">This means avoiding the use of stateful static method calls (which result in a code smell known as [static cling](http://deviq.com/static-cling/)) and the direct instantiation of dependent classes within your services.</span></span> <span data-ttu-id="e0ac6-274">Isso pode ajudar a lembrar a frase [New is Glue](https://ardalis.com/new-is-glue), ao escolher se deseja criar uma instância de um tipo ou solicitá-lo por meio da injeção de dependência.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-274">It may help to remember the phrase, [New is Glue](https://ardalis.com/new-is-glue), when choosing whether to instantiate a type or to request it via dependency injection.</span></span> <span data-ttu-id="e0ac6-275">Seguindo os [Princípios SOLID de Design Orientado a Objeto](http://deviq.com/solid/), as classes naturalmente tendem a ser pequenas, bem fatoradas e facilmente testadas.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-275">By following the [SOLID Principles of Object Oriented Design](http://deviq.com/solid/), your classes will naturally tend to be small, well-factored, and easily tested.</span></span>

<span data-ttu-id="e0ac6-276">E se você descobrir que as classes tendem a ter muitas dependências injetadas?</span><span class="sxs-lookup"><span data-stu-id="e0ac6-276">What if you find that your classes tend to have way too many dependencies being injected?</span></span> <span data-ttu-id="e0ac6-277">Isso geralmente é um sinal de que a classe está tentando fazer muito e, provavelmente, está violando o SRP – o [Princípio da Responsabilidade Única](http://deviq.com/single-responsibility-principle/).</span><span class="sxs-lookup"><span data-stu-id="e0ac6-277">This is generally a sign that your class is trying to do too much, and is probably violating SRP - the [Single Responsibility Principle](http://deviq.com/single-responsibility-principle/).</span></span> <span data-ttu-id="e0ac6-278">Veja se você pode refatorar a classe movendo algumas de suas responsabilidades para uma nova classe.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-278">See if you can refactor the class by moving some of its responsibilities into a new class.</span></span> <span data-ttu-id="e0ac6-279">Lembre-se de que as classes `Controller` devem se concentrar nos interesses da interface do usuário, de modo que os detalhes de implementação de acesso a dados e as regras de negócios devem ser mantidos em classes apropriadas a esses [interesses separados](http://deviq.com/separation-of-concerns/).</span><span class="sxs-lookup"><span data-stu-id="e0ac6-279">Keep in mind that your `Controller` classes should be focused on UI concerns, so business rules and data access implementation details should be kept in classes appropriate to these [separate concerns](http://deviq.com/separation-of-concerns/).</span></span>

<span data-ttu-id="e0ac6-280">Especificamente, com relação ao acesso a dados, você pode injetar o `DbContext` nos controladores (supondo que você adicionou o EF ao contêiner de serviços em `ConfigureServices`).</span><span class="sxs-lookup"><span data-stu-id="e0ac6-280">With regards to data access specifically, you can inject the `DbContext` into your controllers (assuming you've added EF to the services container in `ConfigureServices`).</span></span> <span data-ttu-id="e0ac6-281">Alguns desenvolvedores preferem usar uma interface de repositório para o banco de dados, em vez de injetar o `DbContext` diretamente.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-281">Some developers prefer to use a repository interface to the database rather than injecting the `DbContext` directly.</span></span> <span data-ttu-id="e0ac6-282">O uso de uma interface para encapsular a lógica de acesso a dados em um único local pode minimizar o número de locais que você precisará alterar quando o banco de dados for alterado.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-282">Using an interface to encapsulate the data access logic in one place can minimize how many places you will have to change when your database changes.</span></span>

### <a name="disposing-of-services"></a><span data-ttu-id="e0ac6-283">Descartando serviços</span><span class="sxs-lookup"><span data-stu-id="e0ac6-283">Disposing of services</span></span>

<span data-ttu-id="e0ac6-284">O contêiner chamará `Dispose` para os tipos `IDisposable` criados por ele.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-284">The container will call `Dispose` for `IDisposable` types it creates.</span></span> <span data-ttu-id="e0ac6-285">No entanto, se você adicionar uma instância ao contêiner por conta própria, ele não será descartado.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-285">However, if you add an instance to the container yourself, it will not be disposed.</span></span>

<span data-ttu-id="e0ac6-286">Exemplo:</span><span class="sxs-lookup"><span data-stu-id="e0ac6-286">Example:</span></span>

```csharp
// Services implement IDisposable:
public class Service1 : IDisposable {}
public class Service2 : IDisposable {}
public class Service3 : IDisposable {}

public interface ISomeService {}
public class SomeServiceImplementation : ISomeService, IDisposable {}


public void ConfigureServices(IServiceCollection services)
{
    // container will create the instance(s) of these types and will dispose them
    services.AddScoped<Service1>();
    services.AddSingleton<Service2>();
    services.AddSingleton<ISomeService>(sp => new SomeServiceImplementation());

    // container didn't create instance so it will NOT dispose it
    services.AddSingleton<Service3>(new Service3());
    services.AddSingleton(new Service3());
}
```

> [!NOTE]
> <span data-ttu-id="e0ac6-287">Na versão 1.0, o contêiner chamado descarta *todos* os objetos `IDisposable`, incluindo aqueles que ele não criou.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-287">In version 1.0, the container called dispose on *all* `IDisposable` objects, including those it didn't create.</span></span>

## <a name="replacing-the-default-services-container"></a><span data-ttu-id="e0ac6-288">Substituindo o contêiner de serviços padrão</span><span class="sxs-lookup"><span data-stu-id="e0ac6-288">Replacing the default services container</span></span>

<span data-ttu-id="e0ac6-289">O contêiner de serviços interno destina-se a atender às necessidades básicas da estrutura e a maioria dos aplicativos de consumidor criada nele.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-289">The built-in services container is meant to serve the basic needs of the framework and most consumer applications built on it.</span></span> <span data-ttu-id="e0ac6-290">No entanto, os desenvolvedores podem substituir o contêiner interno por seu contêiner preferencial.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-290">However, developers can replace the built-in container with their preferred container.</span></span> <span data-ttu-id="e0ac6-291">O método `ConfigureServices` normalmente retorna `void`, mas se sua assinatura for alterada para retornar `IServiceProvider`, um contêiner diferente poderá ser configurado e retornado.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-291">The `ConfigureServices` method typically returns `void`, but if its signature is changed to return `IServiceProvider`, a different container can be configured and returned.</span></span> <span data-ttu-id="e0ac6-292">Há vários contêineres IOC disponíveis para o .NET.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-292">There are many IOC containers available for .NET.</span></span> <span data-ttu-id="e0ac6-293">Neste exemplo, o pacote [Autofac](https://autofac.org/) é usado.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-293">In this example, the [Autofac](https://autofac.org/) package is used.</span></span>

<span data-ttu-id="e0ac6-294">Primeiro, instale os pacotes de contêiner apropriados:</span><span class="sxs-lookup"><span data-stu-id="e0ac6-294">First, install the appropriate container package(s):</span></span>

* `Autofac`
* `Autofac.Extensions.DependencyInjection`

<span data-ttu-id="e0ac6-295">Em seguida, configure o contêiner no `ConfigureServices` e retorne um `IServiceProvider`:</span><span class="sxs-lookup"><span data-stu-id="e0ac6-295">Next, configure the container in `ConfigureServices` and return an `IServiceProvider`:</span></span>

```csharp
public IServiceProvider ConfigureServices(IServiceCollection services)
{
    services.AddMvc();
    // Add other framework services

    // Add Autofac
    var containerBuilder = new ContainerBuilder();
    containerBuilder.RegisterModule<DefaultModule>();
    containerBuilder.Populate(services);
    var container = containerBuilder.Build();
    return new AutofacServiceProvider(container);
}
```

> [!NOTE]
> <span data-ttu-id="e0ac6-296">Ao usar um contêiner de DI de terceiros, é necessário alterar `ConfigureServices` para que ele retorne `IServiceProvider` em vez de `void`.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-296">When using a third-party DI container, you must change `ConfigureServices` so that it returns `IServiceProvider` instead of `void`.</span></span>

<span data-ttu-id="e0ac6-297">Finalmente, configure o Autofac normalmente em `DefaultModule`:</span><span class="sxs-lookup"><span data-stu-id="e0ac6-297">Finally, configure Autofac as normal in `DefaultModule`:</span></span>

```csharp
public class DefaultModule : Module
{
    protected override void Load(ContainerBuilder builder)
    {
        builder.RegisterType<CharacterRepository>().As<ICharacterRepository>();
    }
}
```

<span data-ttu-id="e0ac6-298">Em tempo de execução, o Autofac será usado para resolver tipos e injetar dependências.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-298">At runtime, Autofac will be used to resolve types and inject dependencies.</span></span> <span data-ttu-id="e0ac6-299">[Saiba mais sobre como usar o Autofac e o ASP.NET Core](http://docs.autofac.org/en/latest/integration/aspnetcore.html).</span><span class="sxs-lookup"><span data-stu-id="e0ac6-299">[Learn more about using Autofac and ASP.NET Core](http://docs.autofac.org/en/latest/integration/aspnetcore.html).</span></span>

### <a name="thread-safety"></a><span data-ttu-id="e0ac6-300">Acesso thread-safe</span><span class="sxs-lookup"><span data-stu-id="e0ac6-300">Thread safety</span></span>

<span data-ttu-id="e0ac6-301">Os serviços Singleton precisam ser thread-safe.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-301">Singleton services need to be thread safe.</span></span> <span data-ttu-id="e0ac6-302">Se um serviço singleton tiver uma dependência em um serviço transitório, o serviço transitório também precisará ser thread-safe, dependendo de como ele é usado pelo singleton.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-302">If a singleton service has a dependency on a transient service, the transient service may also need to be thread safe depending how it's used by the singleton.</span></span>

## <a name="recommendations"></a><span data-ttu-id="e0ac6-303">Recomendações</span><span class="sxs-lookup"><span data-stu-id="e0ac6-303">Recommendations</span></span>

<span data-ttu-id="e0ac6-304">Ao trabalhar com a injeção de dependência, lembre-se das seguintes recomendações:</span><span class="sxs-lookup"><span data-stu-id="e0ac6-304">When working with dependency injection, keep the following recommendations in mind:</span></span>

* <span data-ttu-id="e0ac6-305">A DI destina-se a objetos que têm dependências complexas.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-305">DI is for objects that have complex dependencies.</span></span> <span data-ttu-id="e0ac6-306">Controladores, serviços, adaptadores e repositórios são exemplos de objetos que podem ser adicionados à DI.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-306">Controllers, services, adapters, and repositories are all examples of objects that might be added to DI.</span></span>

* <span data-ttu-id="e0ac6-307">Evite armazenar dados e a configuração diretamente na DI.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-307">Avoid storing data and configuration directly in DI.</span></span> <span data-ttu-id="e0ac6-308">Por exemplo, o carrinho de compras de um usuário normalmente não deve ser adicionado ao contêiner de serviços.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-308">For example, a user's shopping cart shouldn't typically be added to the services container.</span></span> <span data-ttu-id="e0ac6-309">A configuração deve usar o [padrão de opções](xref:fundamentals/configuration/options).</span><span class="sxs-lookup"><span data-stu-id="e0ac6-309">Configuration should use the [options pattern](xref:fundamentals/configuration/options).</span></span> <span data-ttu-id="e0ac6-310">Da mesma forma, evite objetos de "suporte de dados" que existem somente para permitir o acesso a outro objeto.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-310">Similarly, avoid "data holder" objects that only exist to allow access to some other object.</span></span> <span data-ttu-id="e0ac6-311">É melhor solicitar o item real necessário por meio da DI, se possível.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-311">It's better to request the actual item needed via DI, if possible.</span></span>

* <span data-ttu-id="e0ac6-312">Evite o acesso estático aos serviços.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-312">Avoid static access to services.</span></span>

* <span data-ttu-id="e0ac6-313">Evite o local do serviço no código do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-313">Avoid service location in your application code.</span></span>

* <span data-ttu-id="e0ac6-314">Evite o acesso estático a `HttpContext`.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-314">Avoid static access to `HttpContext`.</span></span>

> [!NOTE]
> <span data-ttu-id="e0ac6-315">Como todos os conjuntos de recomendações, talvez você encontre situações em que é necessário ignorar um.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-315">Like all sets of recommendations, you may encounter situations where ignoring one is required.</span></span> <span data-ttu-id="e0ac6-316">Descobrimos que exceções são raras – a maioria, casos muito especiais dentro da própria estrutura.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-316">We have found exceptions to be rare -- mostly very special cases within the framework itself.</span></span>

<span data-ttu-id="e0ac6-317">Lembre-se de que a injeção de dependência é uma *alternativa* aos padrões de acesso a objeto estático/global.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-317">Remember, dependency injection is an *alternative* to static/global object access patterns.</span></span> <span data-ttu-id="e0ac6-318">Você não poderá obter os benefícios da DI se combiná-lo com o acesso a objeto estático.</span><span class="sxs-lookup"><span data-stu-id="e0ac6-318">You won't be able to realize the benefits of DI if you mix it with static object access.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="e0ac6-319">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="e0ac6-319">Additional resources</span></span>

* [<span data-ttu-id="e0ac6-320">Inicialização de aplicativos</span><span class="sxs-lookup"><span data-stu-id="e0ac6-320">Application Startup</span></span>](xref:fundamentals/startup)
* [<span data-ttu-id="e0ac6-321">Testar e depurar</span><span class="sxs-lookup"><span data-stu-id="e0ac6-321">Test and debug</span></span>](xref:testing/index)
* [<span data-ttu-id="e0ac6-322">Ativação de middleware de fábrica</span><span class="sxs-lookup"><span data-stu-id="e0ac6-322">Factory-based middleware activation</span></span>](xref:fundamentals/middleware/extensibility)
* [<span data-ttu-id="e0ac6-323">Como escrever um código limpo no ASP.NET Core com injeção de dependência (MSDN)</span><span class="sxs-lookup"><span data-stu-id="e0ac6-323">Writing Clean Code in ASP.NET Core with Dependency Injection (MSDN)</span></span>](https://msdn.microsoft.com/magazine/mt703433.aspx)
* [<span data-ttu-id="e0ac6-324">Design de aplicativo gerenciado por contêiner, prelúdio: a que local o contêiner pertence?</span><span class="sxs-lookup"><span data-stu-id="e0ac6-324">Container-Managed Application Design, Prelude: Where does the Container Belong?</span></span>](https://blogs.msdn.microsoft.com/nblumhardt/2008/12/26/container-managed-application-design-prelude-where-does-the-container-belong/)
* [<span data-ttu-id="e0ac6-325">Princípio de Dependências Explícitas</span><span class="sxs-lookup"><span data-stu-id="e0ac6-325">Explicit Dependencies Principle</span></span>](http://deviq.com/explicit-dependencies-principle/)
* <span data-ttu-id="e0ac6-326">[Contêineres de Inversão de Controle e o padrão de Injeção de Dependência](https://www.martinfowler.com/articles/injection.html) (Fowler)</span><span class="sxs-lookup"><span data-stu-id="e0ac6-326">[Inversion of Control Containers and the Dependency Injection Pattern](https://www.martinfowler.com/articles/injection.html) (Fowler)</span></span>
