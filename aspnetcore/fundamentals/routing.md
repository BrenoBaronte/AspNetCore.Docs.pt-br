---
title: Roteamento no ASP.NET Core
author: rick-anderson
description: Descubra como ASP.NET Core roteamento é responsável por correspondência de solicitações HTTP e expedição para pontos de extremidade executáveis.
monikerRange: '>= aspnetcore-2.1'
ms.author: riande
ms.custom: mvc
ms.date: 4/1/2020
no-loc:
- Blazor
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: fundamentals/routing
ms.openlocfilehash: 2dd44a561debddac13250174a8e74dd912302d60
ms.sourcegitcommit: 4a9321db7ca4e69074fa08a678dcc91e16215b1e
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 05/06/2020
ms.locfileid: "82850507"
---
# <a name="routing-in-aspnet-core"></a><span data-ttu-id="d5000-103">Roteamento no ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="d5000-103">Routing in ASP.NET Core</span></span>

<span data-ttu-id="d5000-104">Por [Ryan Nowak](https://github.com/rynowak), [Kirk Larkin](https://twitter.com/serpent5)e [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="d5000-104">By [Ryan Nowak](https://github.com/rynowak), [Kirk Larkin](https://twitter.com/serpent5), and [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

::: moniker range=">= aspnetcore-3.0"

<span data-ttu-id="d5000-105">O roteamento é responsável por corresponder as solicitações HTTP de entrada e expedir essas solicitações aos pontos de extremidade executáveis do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d5000-105">Routing is responsible for matching incoming HTTP requests and dispatching those requests to the app's executable endpoints.</span></span> <span data-ttu-id="d5000-106">Os [pontos de extremidade](#endpoint) são as unidades de código executável de processamento de solicitação do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d5000-106">[Endpoints](#endpoint) are the app's units of executable request-handling code.</span></span> <span data-ttu-id="d5000-107">Os pontos de extremidade são definidos no aplicativo e configurados quando o aplicativo é iniciado.</span><span class="sxs-lookup"><span data-stu-id="d5000-107">Endpoints are defined in the app and configured when the app starts.</span></span> <span data-ttu-id="d5000-108">O processo de correspondência de ponto de extremidade pode extrair valores da URL da solicitação e fornecer esses valores para o processamento da solicitação.</span><span class="sxs-lookup"><span data-stu-id="d5000-108">The endpoint matching process can extract values from the request's URL and provide those values for request processing.</span></span> <span data-ttu-id="d5000-109">Usando informações de ponto de extremidade do aplicativo, o roteamento também é capaz de gerar URLs que são mapeadas para pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="d5000-109">Using endpoint information from the app, routing is also able to generate URLs that map to endpoints.</span></span>

<span data-ttu-id="d5000-110">Os aplicativos podem configurar o roteamento usando:</span><span class="sxs-lookup"><span data-stu-id="d5000-110">Apps can configure routing using:</span></span>

- <span data-ttu-id="d5000-111">Controladores</span><span class="sxs-lookup"><span data-stu-id="d5000-111">Controllers</span></span>
- <span data-ttu-id="d5000-112">Páginas do Razor</span><span class="sxs-lookup"><span data-stu-id="d5000-112">Razor Pages</span></span>
- <span data-ttu-id="d5000-113">SignalR</span><span class="sxs-lookup"><span data-stu-id="d5000-113">SignalR</span></span>
- <span data-ttu-id="d5000-114">Serviços gRPCs</span><span class="sxs-lookup"><span data-stu-id="d5000-114">gRPC Services</span></span>
- <span data-ttu-id="d5000-115">[Middleware](xref:fundamentals/middleware/index) habilitado para ponto de extremidade, como [verificações de integridade](xref:host-and-deploy/health-checks).</span><span class="sxs-lookup"><span data-stu-id="d5000-115">Endpoint-enabled [middleware](xref:fundamentals/middleware/index) such as [Health Checks](xref:host-and-deploy/health-checks).</span></span>
- <span data-ttu-id="d5000-116">Delegados e lambdas registrados no roteamento.</span><span class="sxs-lookup"><span data-stu-id="d5000-116">Delegates and lambdas registered with routing.</span></span>

<span data-ttu-id="d5000-117">Este documento aborda os detalhes de baixo nível do roteamento de ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="d5000-117">This document covers low-level details of ASP.NET Core routing.</span></span> <span data-ttu-id="d5000-118">Para obter informações sobre como configurar o roteamento:</span><span class="sxs-lookup"><span data-stu-id="d5000-118">For information on configuring routing:</span></span>

* <span data-ttu-id="d5000-119">Para controladores, consulte <xref:mvc/controllers/routing>.</span><span class="sxs-lookup"><span data-stu-id="d5000-119">For controllers, see <xref:mvc/controllers/routing>.</span></span>
* <span data-ttu-id="d5000-120">Para obter Razor Pages convenções, <xref:razor-pages/razor-pages-conventions>consulte.</span><span class="sxs-lookup"><span data-stu-id="d5000-120">For Razor Pages conventions, see <xref:razor-pages/razor-pages-conventions>.</span></span>

<span data-ttu-id="d5000-121">O sistema de roteamento de ponto de extremidade descrito neste documento se aplica ao ASP.NET Core 3,0 e posterior.</span><span class="sxs-lookup"><span data-stu-id="d5000-121">The endpoint routing system described in this document applies to ASP.NET Core 3.0 and later.</span></span> <span data-ttu-id="d5000-122">Para obter informações sobre o sistema de roteamento anterior <xref:Microsoft.AspNetCore.Routing.IRouter>baseado em, selecione a versão ASP.NET Core 2,1 usando uma das seguintes abordagens:</span><span class="sxs-lookup"><span data-stu-id="d5000-122">For information on the previous routing system based on <xref:Microsoft.AspNetCore.Routing.IRouter>, select the ASP.NET Core 2.1 version using one of the following approaches:</span></span>

* <span data-ttu-id="d5000-123">O seletor de versão para uma versão anterior.</span><span class="sxs-lookup"><span data-stu-id="d5000-123">The version selector for a previous version.</span></span>
* <span data-ttu-id="d5000-124">Selecione [ASP.NET Core roteamento de 2,1](https://docs.microsoft.com/aspnet/core/fundamentals/routing?view=aspnetcore-2.1).</span><span class="sxs-lookup"><span data-stu-id="d5000-124">Select [ASP.NET Core 2.1 routing](https://docs.microsoft.com/aspnet/core/fundamentals/routing?view=aspnetcore-2.1).</span></span>

<span data-ttu-id="d5000-125">[Exibir ou baixar código de exemplo](https://github.com/aspnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/routing/samples/3.x) ([como baixar](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="d5000-125">[View or download sample code](https://github.com/aspnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/routing/samples/3.x) ([how to download](xref:index#how-to-download-a-sample))</span></span>

<span data-ttu-id="d5000-126">Os exemplos de download deste documento estão habilitados por uma `Startup` classe específica.</span><span class="sxs-lookup"><span data-stu-id="d5000-126">The download samples for this document are enabled by a specific `Startup` class.</span></span> <span data-ttu-id="d5000-127">Para executar um exemplo específico, modifique *Program.cs* para chamar a classe `Startup` desejada.</span><span class="sxs-lookup"><span data-stu-id="d5000-127">To run a specific sample, modify *Program.cs* to call the desired `Startup` class.</span></span>

## <a name="routing-basics"></a><span data-ttu-id="d5000-128">Conceitos básicos sobre roteamento</span><span class="sxs-lookup"><span data-stu-id="d5000-128">Routing basics</span></span>

<span data-ttu-id="d5000-129">Todos os modelos de ASP.NET Core incluem o roteamento no código gerado.</span><span class="sxs-lookup"><span data-stu-id="d5000-129">All ASP.NET Core templates include routing in the generated code.</span></span> <span data-ttu-id="d5000-130">O roteamento é registrado no pipeline de [middleware](xref:fundamentals/middleware/index) no `Startup.Configure`.</span><span class="sxs-lookup"><span data-stu-id="d5000-130">Routing is registered in the [middleware](xref:fundamentals/middleware/index) pipeline in `Startup.Configure`.</span></span>

<span data-ttu-id="d5000-131">O código a seguir mostra um exemplo básico de roteamento:</span><span class="sxs-lookup"><span data-stu-id="d5000-131">The following code shows a basic example of routing:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/Startup.cs?name=snippet&highlight=8,10)]

<span data-ttu-id="d5000-132">O roteamento usa um par de middleware, registrado por <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseRouting*> e <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*>:</span><span class="sxs-lookup"><span data-stu-id="d5000-132">Routing uses a pair of middleware, registered by <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseRouting*> and <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*>:</span></span>

* <span data-ttu-id="d5000-133">`UseRouting`Adiciona correspondência de rota ao pipeline de middleware.</span><span class="sxs-lookup"><span data-stu-id="d5000-133">`UseRouting` adds route matching to the middleware pipeline.</span></span> <span data-ttu-id="d5000-134">Esse middleware analisa o conjunto de pontos de extremidade definidos no aplicativo e seleciona a [melhor correspondência](#urlm) com base na solicitação.</span><span class="sxs-lookup"><span data-stu-id="d5000-134">This middleware looks at the set of endpoints defined in the app, and selects the [best match](#urlm) based on the request.</span></span>
* <span data-ttu-id="d5000-135">`UseEndpoints`Adiciona a execução de ponto de extremidade ao pipeline de middleware.</span><span class="sxs-lookup"><span data-stu-id="d5000-135">`UseEndpoints` adds endpoint execution to the middleware pipeline.</span></span> <span data-ttu-id="d5000-136">Ele executa o delegado associado ao ponto de extremidade selecionado.</span><span class="sxs-lookup"><span data-stu-id="d5000-136">It runs the delegate associated with the selected endpoint.</span></span>

<span data-ttu-id="d5000-137">O exemplo anterior inclui uma única *rota para* o ponto de extremidade de código usando o método [MapGet](xref:Microsoft.AspNetCore.Builder.EndpointRouteBuilderExtensions.MapGet*) :</span><span class="sxs-lookup"><span data-stu-id="d5000-137">The preceding example includes a single *route to code* endpoint using the [MapGet](xref:Microsoft.AspNetCore.Builder.EndpointRouteBuilderExtensions.MapGet*) method:</span></span>

* <span data-ttu-id="d5000-138">Quando uma solicitação `GET` http é enviada para a URL `/`raiz:</span><span class="sxs-lookup"><span data-stu-id="d5000-138">When an HTTP `GET` request is sent to the root URL `/`:</span></span>
  * <span data-ttu-id="d5000-139">O delegado de solicitação mostrado é executado.</span><span class="sxs-lookup"><span data-stu-id="d5000-139">The request delegate shown executes.</span></span>
  * <span data-ttu-id="d5000-140">`Hello World!`é gravado na resposta HTTP.</span><span class="sxs-lookup"><span data-stu-id="d5000-140">`Hello World!` is written to the HTTP response.</span></span> <span data-ttu-id="d5000-141">Por padrão, a URL `/` raiz é `https://localhost:5001/`.</span><span class="sxs-lookup"><span data-stu-id="d5000-141">By default, the root URL `/` is `https://localhost:5001/`.</span></span>
* <span data-ttu-id="d5000-142">Se o método de solicitação não `GET` for ou a URL raiz não `/`for, nenhuma correspondência de rota será retornada e um http 404 será retornado.</span><span class="sxs-lookup"><span data-stu-id="d5000-142">If the request method is not `GET` or the root URL is not `/`, no route matches and an HTTP 404 is returned.</span></span>

### <a name="endpoint"></a><span data-ttu-id="d5000-143">Ponto de extremidade</span><span class="sxs-lookup"><span data-stu-id="d5000-143">Endpoint</span></span>

<a name="endpoint"></a>

<span data-ttu-id="d5000-144">O `MapGet` método é usado para definir um **ponto de extremidade**.</span><span class="sxs-lookup"><span data-stu-id="d5000-144">The `MapGet` method is used to define an **endpoint**.</span></span> <span data-ttu-id="d5000-145">Um ponto de extremidade é algo que pode ser:</span><span class="sxs-lookup"><span data-stu-id="d5000-145">An endpoint is something that can be:</span></span>

* <span data-ttu-id="d5000-146">Selecionado, correspondendo à URL e ao método HTTP.</span><span class="sxs-lookup"><span data-stu-id="d5000-146">Selected, by matching the URL and HTTP method.</span></span>
* <span data-ttu-id="d5000-147">Executado, executando o delegado.</span><span class="sxs-lookup"><span data-stu-id="d5000-147">Executed, by running the delegate.</span></span>

<span data-ttu-id="d5000-148">Os pontos de extremidade que podem ser correspondidos e executados pelo aplicativo são `UseEndpoints`configurados no.</span><span class="sxs-lookup"><span data-stu-id="d5000-148">Endpoints that can be matched and executed by the app are configured in `UseEndpoints`.</span></span> <span data-ttu-id="d5000-149">Por exemplo, <xref:Microsoft.AspNetCore.Builder.EndpointRouteBuilderExtensions.MapGet*> <xref:Microsoft.AspNetCore.Builder.EndpointRouteBuilderExtensions.MapPost*>,, e [métodos semelhantes](xref:Microsoft.AspNetCore.Builder.EndpointRouteBuilderExtensions) conectam delegados de solicitação ao sistema de roteamento.</span><span class="sxs-lookup"><span data-stu-id="d5000-149">For example, <xref:Microsoft.AspNetCore.Builder.EndpointRouteBuilderExtensions.MapGet*>, <xref:Microsoft.AspNetCore.Builder.EndpointRouteBuilderExtensions.MapPost*>, and [similar methods](xref:Microsoft.AspNetCore.Builder.EndpointRouteBuilderExtensions) connect request delegates to the routing system.</span></span>
<span data-ttu-id="d5000-150">Métodos adicionais podem ser usados para conectar ASP.NET Core recursos do Framework ao sistema de roteamento:</span><span class="sxs-lookup"><span data-stu-id="d5000-150">Additional methods can be used to connect ASP.NET Core framework features to the routing system:</span></span>
- [<span data-ttu-id="d5000-151">MapRazorPages para Razor Pages</span><span class="sxs-lookup"><span data-stu-id="d5000-151">MapRazorPages for Razor Pages</span></span>](xref:Microsoft.AspNetCore.Builder.RazorPagesEndpointRouteBuilderExtensions.MapRazorPages*)
- [<span data-ttu-id="d5000-152">MapControllers para controladores</span><span class="sxs-lookup"><span data-stu-id="d5000-152">MapControllers for controllers</span></span>](xref:Microsoft.AspNetCore.Builder.ControllerEndpointRouteBuilderExtensions.MapControllers*)
- [<span data-ttu-id="d5000-153">MapHub\<THub> para signalr</span><span class="sxs-lookup"><span data-stu-id="d5000-153">MapHub\<THub> for SignalR</span></span>](xref:Microsoft.AspNetCore.SignalR.HubRouteBuilder.MapHub*) 
- [<span data-ttu-id="d5000-154">MapGrpcService\<TService> para gRPC</span><span class="sxs-lookup"><span data-stu-id="d5000-154">MapGrpcService\<TService> for gRPC</span></span>](xref:grpc/aspnetcore)

<span data-ttu-id="d5000-155">O exemplo a seguir mostra o roteamento com um modelo de rota mais sofisticado:</span><span class="sxs-lookup"><span data-stu-id="d5000-155">The following example shows routing with a more sophisticated route template:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/RouteTemplateStartup.cs?name=snippet)]

<span data-ttu-id="d5000-156">A cadeia `/hello/{name:alpha}` de caracteres é um **modelo de rota**.</span><span class="sxs-lookup"><span data-stu-id="d5000-156">The string `/hello/{name:alpha}` is a **route template**.</span></span> <span data-ttu-id="d5000-157">Ele é usado para configurar como o ponto de extremidade é correspondido.</span><span class="sxs-lookup"><span data-stu-id="d5000-157">It is used to configure how the endpoint is matched.</span></span> <span data-ttu-id="d5000-158">Nesse caso, o modelo corresponde a:</span><span class="sxs-lookup"><span data-stu-id="d5000-158">In this case, the template matches:</span></span>

* <span data-ttu-id="d5000-159">Uma URL como`/hello/Ryan`</span><span class="sxs-lookup"><span data-stu-id="d5000-159">A URL like `/hello/Ryan`</span></span>
* <span data-ttu-id="d5000-160">Qualquer caminho de URL que comece `/hello/` com seguido por uma sequência de caracteres alfabéticos.</span><span class="sxs-lookup"><span data-stu-id="d5000-160">Any URL path that begins with `/hello/` followed by a sequence of alphabetic characters.</span></span>  <span data-ttu-id="d5000-161">`:alpha`aplica uma restrição de rota que corresponde apenas a caracteres alfabéticos.</span><span class="sxs-lookup"><span data-stu-id="d5000-161">`:alpha` applies a route constraint that matches only alphabetic characters.</span></span> <span data-ttu-id="d5000-162">As [restrições de rota](#route-constraint-reference) são explicadas posteriormente neste documento.</span><span class="sxs-lookup"><span data-stu-id="d5000-162">[Route constraints](#route-constraint-reference) are explained later in this document.</span></span>

<span data-ttu-id="d5000-163">O segundo segmento do caminho da URL, `{name:alpha}`:</span><span class="sxs-lookup"><span data-stu-id="d5000-163">The second segment of the URL path, `{name:alpha}`:</span></span>

* <span data-ttu-id="d5000-164">Está associado ao `name` parâmetro.</span><span class="sxs-lookup"><span data-stu-id="d5000-164">Is bound to the `name` parameter.</span></span>
* <span data-ttu-id="d5000-165">É capturado e armazenado em [HttpRequest. RouteValues](xref:Microsoft.AspNetCore.Http.HttpRequest.RouteValues*).</span><span class="sxs-lookup"><span data-stu-id="d5000-165">Is captured and stored in [HttpRequest.RouteValues](xref:Microsoft.AspNetCore.Http.HttpRequest.RouteValues*).</span></span>

<span data-ttu-id="d5000-166">O sistema de roteamento de ponto de extremidade descrito neste documento é novo a partir de ASP.NET Core 3,0.</span><span class="sxs-lookup"><span data-stu-id="d5000-166">The endpoint routing system described in this document is new as of ASP.NET Core 3.0.</span></span> <span data-ttu-id="d5000-167">No entanto, todas as versões do ASP.NET Core dão suporte ao mesmo conjunto de recursos de modelo de rota e restrições de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-167">However, all versions of ASP.NET Core support the same set of route template features and route constraints.</span></span>

<span data-ttu-id="d5000-168">O exemplo a seguir mostra o roteamento com [verificações de integridade](xref:host-and-deploy/health-checks) e autorização:</span><span class="sxs-lookup"><span data-stu-id="d5000-168">The following example shows routing with [health checks](xref:host-and-deploy/health-checks) and authorization:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/AuthorizationStartup.cs?name=snippet)]

[!INCLUDE[request localized comments](~/includes/code-comments-loc.md)]

<span data-ttu-id="d5000-169">O exemplo anterior demonstra como:</span><span class="sxs-lookup"><span data-stu-id="d5000-169">The preceding example demonstrates how:</span></span>

* <span data-ttu-id="d5000-170">O middleware de autorização pode ser usado com o roteamento.</span><span class="sxs-lookup"><span data-stu-id="d5000-170">The authorization middleware can be used with routing.</span></span>
* <span data-ttu-id="d5000-171">Os pontos de extremidade podem ser usados para configurar o comportamento de autorização.</span><span class="sxs-lookup"><span data-stu-id="d5000-171">Endpoints can be used to configure authorization behavior.</span></span>

<span data-ttu-id="d5000-172">A <xref:Microsoft.AspNetCore.Builder.HealthCheckEndpointRouteBuilderExtensions.MapHealthChecks*> chamada adiciona um ponto de extremidade de verificação de integridade.</span><span class="sxs-lookup"><span data-stu-id="d5000-172">The <xref:Microsoft.AspNetCore.Builder.HealthCheckEndpointRouteBuilderExtensions.MapHealthChecks*> call adds a health check endpoint.</span></span> <span data-ttu-id="d5000-173"><xref:Microsoft.AspNetCore.Builder.AuthorizationEndpointConventionBuilderExtensions.RequireAuthorization*> O encadeamento para essa chamada anexa uma política de autorização ao ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="d5000-173">Chaining <xref:Microsoft.AspNetCore.Builder.AuthorizationEndpointConventionBuilderExtensions.RequireAuthorization*> on to this call attaches an authorization policy to the endpoint.</span></span>

<span data-ttu-id="d5000-174">Chamar <xref:Microsoft.AspNetCore.Builder.AuthAppBuilderExtensions.UseAuthentication*> e <xref:Microsoft.AspNetCore.Builder.AuthorizationAppBuilderExtensions.UseAuthorization*> adicionar o middleware de autenticação e autorização.</span><span class="sxs-lookup"><span data-stu-id="d5000-174">Calling <xref:Microsoft.AspNetCore.Builder.AuthAppBuilderExtensions.UseAuthentication*> and <xref:Microsoft.AspNetCore.Builder.AuthorizationAppBuilderExtensions.UseAuthorization*> adds the authentication and authorization middleware.</span></span> <span data-ttu-id="d5000-175">Esses middlewares são colocados entre <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseRouting*> e `UseEndpoints` para que eles possam:</span><span class="sxs-lookup"><span data-stu-id="d5000-175">These middleware are placed between <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseRouting*> and `UseEndpoints` so that they can:</span></span>

* <span data-ttu-id="d5000-176">Veja qual ponto de extremidade foi `UseRouting`selecionado por.</span><span class="sxs-lookup"><span data-stu-id="d5000-176">See which endpoint was selected by `UseRouting`.</span></span>
* <span data-ttu-id="d5000-177">Aplique uma política de autorização <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*> antes de expedir para o ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="d5000-177">Apply an authorization policy before <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*> dispatches to the endpoint.</span></span>

<a name="metadata"></a>

### <a name="endpoint-metadata"></a><span data-ttu-id="d5000-178">Metadados do ponto de extremidade</span><span class="sxs-lookup"><span data-stu-id="d5000-178">Endpoint metadata</span></span>

<span data-ttu-id="d5000-179">No exemplo anterior, há dois pontos de extremidade, mas somente o ponto de verificação de integridade tem uma política de autorização anexada.</span><span class="sxs-lookup"><span data-stu-id="d5000-179">In the preceding example, there are two endpoints, but only the health check endpoint has an authorization policy attached.</span></span> <span data-ttu-id="d5000-180">Se a solicitação corresponder ao ponto de extremidade de `/healthz`verificação de integridade, uma verificação de autorização será executada.</span><span class="sxs-lookup"><span data-stu-id="d5000-180">If the request matches the health check endpoint, `/healthz`, an authorization check is performed.</span></span> <span data-ttu-id="d5000-181">Isso demonstra que os pontos de extremidade podem ter dados adicionais anexados a eles.</span><span class="sxs-lookup"><span data-stu-id="d5000-181">This demonstrates that endpoints can have extra data attached to them.</span></span> <span data-ttu-id="d5000-182">Esses dados adicionais são chamados de **metadados**de ponto de extremidade:</span><span class="sxs-lookup"><span data-stu-id="d5000-182">This extra data is called endpoint **metadata**:</span></span>

* <span data-ttu-id="d5000-183">Os metadados podem ser processados pelo middleware com reconhecimento de roteamento.</span><span class="sxs-lookup"><span data-stu-id="d5000-183">The metadata can be processed by routing-aware middleware.</span></span>
* <span data-ttu-id="d5000-184">Os metadados podem ser de qualquer tipo .NET.</span><span class="sxs-lookup"><span data-stu-id="d5000-184">The metadata can be of any .NET type.</span></span>

## <a name="routing-concepts"></a><span data-ttu-id="d5000-185">Conceitos de roteamento</span><span class="sxs-lookup"><span data-stu-id="d5000-185">Routing concepts</span></span>

<span data-ttu-id="d5000-186">O sistema de roteamento baseia-se na parte superior do pipeline de middleware adicionando o poderoso conceito de **ponto de extremidade** .</span><span class="sxs-lookup"><span data-stu-id="d5000-186">The routing system builds on top of the middleware pipeline by adding the powerful **endpoint** concept.</span></span> <span data-ttu-id="d5000-187">Os pontos de extremidade representam unidades da funcionalidade do aplicativo que são diferentes entre si em termos de roteamento, autorização e qualquer número de sistemas de ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="d5000-187">Endpoints represent units of the app's functionality that are distinct from each other in terms of routing, authorization, and any number of ASP.NET Core's systems.</span></span>

<a name="endpoint"></a>

### <a name="aspnet-core-endpoint-definition"></a><span data-ttu-id="d5000-188">Definição de ponto de extremidade ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="d5000-188">ASP.NET Core endpoint definition</span></span>

<span data-ttu-id="d5000-189">Um ponto de extremidade ASP.NET Core é:</span><span class="sxs-lookup"><span data-stu-id="d5000-189">An ASP.NET Core endpoint is:</span></span>

* <span data-ttu-id="d5000-190">Executável: tem um <xref:Microsoft.AspNetCore.Http.Endpoint.RequestDelegate>.</span><span class="sxs-lookup"><span data-stu-id="d5000-190">Executable: Has a <xref:Microsoft.AspNetCore.Http.Endpoint.RequestDelegate>.</span></span>
* <span data-ttu-id="d5000-191">Extensível: tem uma coleção de [metadados](xref:Microsoft.AspNetCore.Http.Endpoint.Metadata*) .</span><span class="sxs-lookup"><span data-stu-id="d5000-191">Extensible: Has a [Metadata](xref:Microsoft.AspNetCore.Http.Endpoint.Metadata*) collection.</span></span>
* <span data-ttu-id="d5000-192">Selecionável: opcionalmente, tem [informações de roteamento](xref:Microsoft.AspNetCore.Routing.RouteEndpoint.RoutePattern*).</span><span class="sxs-lookup"><span data-stu-id="d5000-192">Selectable: Optionally, has [routing information](xref:Microsoft.AspNetCore.Routing.RouteEndpoint.RoutePattern*).</span></span>
* <span data-ttu-id="d5000-193">Enumerable: a coleção de pontos de extremidade pode ser listada recuperando o <xref:Microsoft.AspNetCore.Routing.EndpointDataSource> de [di](xref:fundamentals/dependency-injection).</span><span class="sxs-lookup"><span data-stu-id="d5000-193">Enumerable: The collection of endpoints can be listed by retrieving the <xref:Microsoft.AspNetCore.Routing.EndpointDataSource> from [DI](xref:fundamentals/dependency-injection).</span></span>

<span data-ttu-id="d5000-194">O código a seguir mostra como recuperar e inspecionar o ponto de extremidade que corresponde à solicitação atual:</span><span class="sxs-lookup"><span data-stu-id="d5000-194">The following code shows how to retrieve and inspect the endpoint matching the current request:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/EndpointInspectorStartup.cs?name=snippet)]

<span data-ttu-id="d5000-195">O ponto de extremidade, se selecionado, pode ser recuperado `HttpContext`do.</span><span class="sxs-lookup"><span data-stu-id="d5000-195">The endpoint, if selected, can be retrieved from the `HttpContext`.</span></span> <span data-ttu-id="d5000-196">Suas propriedades podem ser inspecionadas.</span><span class="sxs-lookup"><span data-stu-id="d5000-196">Its properties can be inspected.</span></span> <span data-ttu-id="d5000-197">Os objetos de ponto de extremidade são imutáveis e não podem ser modificados após a criação.</span><span class="sxs-lookup"><span data-stu-id="d5000-197">Endpoint objects are immutable and cannot be modified after creation.</span></span> <span data-ttu-id="d5000-198">O tipo de ponto de extremidade mais comum <xref:Microsoft.AspNetCore.Routing.RouteEndpoint>é um.</span><span class="sxs-lookup"><span data-stu-id="d5000-198">The most common type of endpoint is a <xref:Microsoft.AspNetCore.Routing.RouteEndpoint>.</span></span> <span data-ttu-id="d5000-199">`RouteEndpoint`inclui informações que permitem que ele seja selecionado pelo sistema de roteamento.</span><span class="sxs-lookup"><span data-stu-id="d5000-199">`RouteEndpoint` includes information that allows it to be to selected by the routing system.</span></span>

<span data-ttu-id="d5000-200">No código anterior, [aplicativo. Use](xref:Microsoft.AspNetCore.Builder.UseExtensions.Use*) configura um [middleware](xref:fundamentals/middleware/index)embutido.</span><span class="sxs-lookup"><span data-stu-id="d5000-200">In the preceding code, [app.Use](xref:Microsoft.AspNetCore.Builder.UseExtensions.Use*) configures an in-line [middleware](xref:fundamentals/middleware/index).</span></span>

<a name="mt"></a>

<span data-ttu-id="d5000-201">O código a seguir mostra que, dependendo de onde `app.Use` é chamado no pipeline, pode não haver um ponto de extremidade:</span><span class="sxs-lookup"><span data-stu-id="d5000-201">The following code shows that, depending on where `app.Use` is called in the pipeline, there may not be an endpoint:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/MiddlewareFlowStartup.cs?name=snippet)]

<span data-ttu-id="d5000-202">O exemplo anterior adiciona `Console.WriteLine` instruções que exibem se um ponto de extremidade foi selecionado ou não.</span><span class="sxs-lookup"><span data-stu-id="d5000-202">This preceding sample adds `Console.WriteLine` statements that display whether or not an endpoint has been selected.</span></span> <span data-ttu-id="d5000-203">Para maior clareza, o exemplo atribui um nome de exibição ao ponto de `/` extremidade fornecido.</span><span class="sxs-lookup"><span data-stu-id="d5000-203">For clarity, the sample assigns a display name to the provided `/` endpoint.</span></span>

<span data-ttu-id="d5000-204">Executar esse código com uma URL de `/` exibe:</span><span class="sxs-lookup"><span data-stu-id="d5000-204">Running this code with a URL of `/` displays:</span></span>

```txt
1. Endpoint: (null)
2. Endpoint: Hello
3. Endpoint: Hello
```

<span data-ttu-id="d5000-205">A execução desse código com qualquer outra URL é exibida:</span><span class="sxs-lookup"><span data-stu-id="d5000-205">Running this code with any other URL displays:</span></span>

```txt
1. Endpoint: (null)
2. Endpoint: (null)
4. Endpoint: (null)
```

<span data-ttu-id="d5000-206">Essa saída demonstra que:</span><span class="sxs-lookup"><span data-stu-id="d5000-206">This output demonstrates that:</span></span>

* <span data-ttu-id="d5000-207">O ponto de extremidade é sempre `UseRouting` nulo antes de ser chamado.</span><span class="sxs-lookup"><span data-stu-id="d5000-207">The endpoint is always null before `UseRouting` is called.</span></span>
* <span data-ttu-id="d5000-208">Se uma correspondência for encontrada, o ponto de extremidade será não nulo `UseRouting` entre <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*>e.</span><span class="sxs-lookup"><span data-stu-id="d5000-208">If a match is found, the endpoint is non-null between `UseRouting` and <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*>.</span></span>
* <span data-ttu-id="d5000-209">O `UseEndpoints` middleware é **terminal** quando uma correspondência é encontrada.</span><span class="sxs-lookup"><span data-stu-id="d5000-209">The `UseEndpoints` middleware is **terminal** when a match is found.</span></span> <span data-ttu-id="d5000-210">O [middleware de terminal](#tm) é definido mais adiante neste documento.</span><span class="sxs-lookup"><span data-stu-id="d5000-210">[Terminal middleware](#tm) is defined later in this document.</span></span>
* <span data-ttu-id="d5000-211">O middleware após `UseEndpoints` executar somente quando nenhuma correspondência for encontrada.</span><span class="sxs-lookup"><span data-stu-id="d5000-211">The middleware after `UseEndpoints` execute only when no match is found.</span></span>

<span data-ttu-id="d5000-212">O `UseRouting` middleware usa o método [SetEndPoint](xref:Microsoft.AspNetCore.Http.EndpointHttpContextExtensions.SetEndpoint*) para anexar o ponto de extremidade ao contexto atual.</span><span class="sxs-lookup"><span data-stu-id="d5000-212">The `UseRouting` middleware uses the [SetEndpoint](xref:Microsoft.AspNetCore.Http.EndpointHttpContextExtensions.SetEndpoint*) method to attach the endpoint to the current context.</span></span> <span data-ttu-id="d5000-213">É possível substituir o middleware por `UseRouting` uma lógica personalizada e ainda obter os benefícios de usar pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="d5000-213">It's possible to replace the `UseRouting` middleware with custom logic and still get the benefits of using endpoints.</span></span> <span data-ttu-id="d5000-214">Os pontos de extremidade são um primitivo de baixo nível, como middleware, e não são acoplados à implementação de roteamento.</span><span class="sxs-lookup"><span data-stu-id="d5000-214">Endpoints are a low-level primitive like middleware, and aren't coupled to the routing implementation.</span></span> <span data-ttu-id="d5000-215">A maioria dos aplicativos não precisa `UseRouting` substituir pela lógica personalizada.</span><span class="sxs-lookup"><span data-stu-id="d5000-215">Most apps don't need to replace `UseRouting` with custom logic.</span></span>

<span data-ttu-id="d5000-216">O `UseEndpoints` middleware foi projetado para ser usado em conjunto com o `UseRouting` middleware.</span><span class="sxs-lookup"><span data-stu-id="d5000-216">The `UseEndpoints` middleware is designed to be used in tandem with the `UseRouting` middleware.</span></span> <span data-ttu-id="d5000-217">A lógica principal para executar um ponto de extremidade não é complicada.</span><span class="sxs-lookup"><span data-stu-id="d5000-217">The core logic to execute an endpoint isn't complicated.</span></span> <span data-ttu-id="d5000-218">Use <xref:Microsoft.AspNetCore.Http.EndpointHttpContextExtensions.GetEndpoint*> para recuperar o ponto de extremidade e, em <xref:Microsoft.AspNetCore.Http.Endpoint.RequestDelegate> seguida, invoque sua propriedade.</span><span class="sxs-lookup"><span data-stu-id="d5000-218">Use <xref:Microsoft.AspNetCore.Http.EndpointHttpContextExtensions.GetEndpoint*> to retrieve the endpoint, and then invoke its <xref:Microsoft.AspNetCore.Http.Endpoint.RequestDelegate> property.</span></span>

<span data-ttu-id="d5000-219">O código a seguir demonstra como o middleware pode influenciar ou reagir ao roteamento:</span><span class="sxs-lookup"><span data-stu-id="d5000-219">The following code demonstrates how middleware can influence or react to routing:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/IntegratedMiddlewareStartup.cs?name=snippet)]

<span data-ttu-id="d5000-220">O exemplo anterior demonstra dois conceitos importantes:</span><span class="sxs-lookup"><span data-stu-id="d5000-220">The preceding example demonstrates two important concepts:</span></span>

* <span data-ttu-id="d5000-221">O middleware pode ser executado `UseRouting` antes de modificar os dados nos quais o roteamento Opera.</span><span class="sxs-lookup"><span data-stu-id="d5000-221">Middleware can run before `UseRouting` to modify the data that routing operates upon.</span></span>
    * <span data-ttu-id="d5000-222">Geralmente, o <xref:Microsoft.AspNetCore.Builder.RewriteBuilderExtensions.UseRewriter*>middleware que aparece antes do roteamento modifica alguma propriedade da solicitação, como, <xref:Microsoft.AspNetCore.Builder.HttpMethodOverrideExtensions.UseHttpMethodOverride*>ou. <xref:Microsoft.AspNetCore.Builder.UsePathBaseExtensions.UsePathBase*></span><span class="sxs-lookup"><span data-stu-id="d5000-222">Usually middleware that appears before routing modifies some property of the request, such as <xref:Microsoft.AspNetCore.Builder.RewriteBuilderExtensions.UseRewriter*>, <xref:Microsoft.AspNetCore.Builder.HttpMethodOverrideExtensions.UseHttpMethodOverride*>, or <xref:Microsoft.AspNetCore.Builder.UsePathBaseExtensions.UsePathBase*>.</span></span>
* <span data-ttu-id="d5000-223">O middleware pode ser executado `UseRouting` entre <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*> e para processar os resultados do roteamento antes da execução do ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="d5000-223">Middleware can run between `UseRouting` and <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*> to process the results of routing before the endpoint is executed.</span></span>
    * <span data-ttu-id="d5000-224">Middleware que é executado entre `UseRouting` e `UseEndpoints`:</span><span class="sxs-lookup"><span data-stu-id="d5000-224">Middleware that runs between `UseRouting` and `UseEndpoints`:</span></span>
      * <span data-ttu-id="d5000-225">Geralmente inspeciona os metadados para entender os pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="d5000-225">Usually inspects metadata to understand the endpoints.</span></span>
      * <span data-ttu-id="d5000-226">Geralmente toma decisões de segurança, como feito `UseAuthorization` pelo `UseCors`e pelo.</span><span class="sxs-lookup"><span data-stu-id="d5000-226">Often makes security decisions, as done by `UseAuthorization` and `UseCors`.</span></span>
    * <span data-ttu-id="d5000-227">A combinação de middleware e metadados permite configurar políticas por ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="d5000-227">The combination of middleware and metadata allows configuring policies per-endpoint.</span></span>

<span data-ttu-id="d5000-228">O código anterior mostra um exemplo de um middleware personalizado que dá suporte a políticas por ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="d5000-228">The preceding code shows an example of a custom middleware that supports per-endpoint policies.</span></span> <span data-ttu-id="d5000-229">O middleware grava um *log de auditoria* de acesso a dados confidenciais no console.</span><span class="sxs-lookup"><span data-stu-id="d5000-229">The middleware writes an *audit log* of access to sensitive data to the console.</span></span> <span data-ttu-id="d5000-230">O middleware pode ser configurado para *auditar* um ponto de extremidade `AuditPolicyAttribute` com os metadados.</span><span class="sxs-lookup"><span data-stu-id="d5000-230">The middleware can be configured to *audit* an endpoint with the `AuditPolicyAttribute` metadata.</span></span> <span data-ttu-id="d5000-231">Este exemplo demonstra um padrão *de aceitação* em que somente os pontos de extremidade marcados como confidenciais são auditados.</span><span class="sxs-lookup"><span data-stu-id="d5000-231">This sample demonstrates an *opt-in* pattern where only endpoints that are marked as sensitive are audited.</span></span> <span data-ttu-id="d5000-232">É possível definir essa lógica na ordem inversa, auditar tudo que não está marcado como seguro, por exemplo.</span><span class="sxs-lookup"><span data-stu-id="d5000-232">It's possible to define this logic in reverse, auditing everything that isn't marked as safe, for example.</span></span> <span data-ttu-id="d5000-233">O sistema de metadados do ponto de extremidade é flexível.</span><span class="sxs-lookup"><span data-stu-id="d5000-233">The endpoint metadata system is flexible.</span></span> <span data-ttu-id="d5000-234">Essa lógica poderia ser projetada de qualquer forma adequada ao caso de uso.</span><span class="sxs-lookup"><span data-stu-id="d5000-234">This logic could be designed in whatever way suits the use case.</span></span>

<span data-ttu-id="d5000-235">O código de exemplo anterior destina-se a demonstrar os conceitos básicos dos pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="d5000-235">The preceding sample code is intended to demonstrate the basic concepts of endpoints.</span></span> <span data-ttu-id="d5000-236">**O exemplo não se destina ao uso em produção**.</span><span class="sxs-lookup"><span data-stu-id="d5000-236">**The sample is not intended for production use**.</span></span> <span data-ttu-id="d5000-237">Uma versão mais completa de um middleware de *log de auditoria* seria:</span><span class="sxs-lookup"><span data-stu-id="d5000-237">A more complete version of an *audit log* middleware would:</span></span>

* <span data-ttu-id="d5000-238">Faça logon em um arquivo ou banco de dados.</span><span class="sxs-lookup"><span data-stu-id="d5000-238">Log to a file or database.</span></span>
* <span data-ttu-id="d5000-239">Inclua detalhes como o usuário, o endereço IP, o nome do ponto de extremidade confidencial e muito mais.</span><span class="sxs-lookup"><span data-stu-id="d5000-239">Include details such as the user, IP address, name of the sensitive endpoint, and more.</span></span>

<span data-ttu-id="d5000-240">Os metadados `AuditPolicyAttribute` da diretiva de auditoria são definidos `Attribute` como um para uso mais fácil com estruturas baseadas em classe, como controladores e signalr.</span><span class="sxs-lookup"><span data-stu-id="d5000-240">The audit policy metadata `AuditPolicyAttribute` is defined as an `Attribute` for easier use with class-based frameworks such as controllers and SignalR.</span></span> <span data-ttu-id="d5000-241">Ao usar *rota para código*:</span><span class="sxs-lookup"><span data-stu-id="d5000-241">When using *route to code*:</span></span>

* <span data-ttu-id="d5000-242">Os metadados são anexados a uma API do Builder.</span><span class="sxs-lookup"><span data-stu-id="d5000-242">Metadata is attached with a builder API.</span></span>
* <span data-ttu-id="d5000-243">As estruturas baseadas em classe incluem todos os atributos no método e na classe correspondentes ao criar pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="d5000-243">Class-based frameworks include all attributes on the corresponding method and class when creating endpoints.</span></span>

<span data-ttu-id="d5000-244">As práticas recomendadas para tipos de metadados são defini-las como interfaces ou atributos.</span><span class="sxs-lookup"><span data-stu-id="d5000-244">The best practices for metadata types are to define them either as interfaces or attributes.</span></span> <span data-ttu-id="d5000-245">Interfaces e atributos permitem reutilização de código.</span><span class="sxs-lookup"><span data-stu-id="d5000-245">Interfaces and attributes allow code reuse.</span></span> <span data-ttu-id="d5000-246">O sistema de metadados é flexível e não impõe nenhuma limitação.</span><span class="sxs-lookup"><span data-stu-id="d5000-246">The metadata system is flexible and doesn't impose any limitations.</span></span>

<a name="tm"></a>

### <a name="comparing-a-terminal-middleware-and-routing"></a><span data-ttu-id="d5000-247">Comparando um middleware e roteamento de terminal</span><span class="sxs-lookup"><span data-stu-id="d5000-247">Comparing a terminal middleware and routing</span></span>

<span data-ttu-id="d5000-248">O exemplo de código a seguir contrasta usando o middleware com o uso de roteamento:</span><span class="sxs-lookup"><span data-stu-id="d5000-248">The following code sample contrasts using middleware with using routing:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/TerminalMiddlewareStartup.cs?name=snippet)]

<span data-ttu-id="d5000-249">O estilo de middleware mostrado com o `Approach 1:` é **middleware de terminal**.</span><span class="sxs-lookup"><span data-stu-id="d5000-249">The style of middleware shown with `Approach 1:` is **terminal middleware**.</span></span> <span data-ttu-id="d5000-250">Ele é chamado de middleware de terminal porque faz uma operação de correspondência:</span><span class="sxs-lookup"><span data-stu-id="d5000-250">It's called terminal middleware because it does a matching operation:</span></span>

* <span data-ttu-id="d5000-251">A operação de correspondência no exemplo anterior é `Path == "/"` para o middleware e `Path == "/Movie"` para o roteamento.</span><span class="sxs-lookup"><span data-stu-id="d5000-251">The matching operation in the preceding sample is `Path == "/"` for the middleware and `Path == "/Movie"` for routing.</span></span>
* <span data-ttu-id="d5000-252">Quando uma correspondência é bem-sucedida, ela executa algumas funcionalidades e retorna, em vez de invocar o `next` middleware.</span><span class="sxs-lookup"><span data-stu-id="d5000-252">When a match is successful, it executes some functionality and returns, rather than invoking the `next` middleware.</span></span>

<span data-ttu-id="d5000-253">Ele é chamado de middleware de terminal porque encerra a pesquisa, executa algumas funcionalidades e, em seguida, retorna.</span><span class="sxs-lookup"><span data-stu-id="d5000-253">It's called terminal middleware because it terminates the search, executes some functionality, and then returns.</span></span>

<span data-ttu-id="d5000-254">Comparando um middleware e roteamento de terminal:</span><span class="sxs-lookup"><span data-stu-id="d5000-254">Comparing a terminal middleware and routing:</span></span>
* <span data-ttu-id="d5000-255">Ambas as abordagens permitem encerrar o pipeline de processamento:</span><span class="sxs-lookup"><span data-stu-id="d5000-255">Both approaches allow terminating the processing pipeline:</span></span>
    * <span data-ttu-id="d5000-256">O middleware encerra o pipeline retornando em vez de invocar `next`.</span><span class="sxs-lookup"><span data-stu-id="d5000-256">Middleware terminates the pipeline by returning rather than invoking `next`.</span></span>
    * <span data-ttu-id="d5000-257">Os pontos de extremidade são sempre terminal.</span><span class="sxs-lookup"><span data-stu-id="d5000-257">Endpoints are always terminal.</span></span>
* <span data-ttu-id="d5000-258">O middleware de terminal permite posicionar o middleware em um local arbitrário no pipeline:</span><span class="sxs-lookup"><span data-stu-id="d5000-258">Terminal middleware allows positioning the middleware at an arbitrary place in the pipeline:</span></span>
    * <span data-ttu-id="d5000-259">Os pontos de extremidade são executados na posição <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*>de.</span><span class="sxs-lookup"><span data-stu-id="d5000-259">Endpoints execute at the position of <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*>.</span></span>
* <span data-ttu-id="d5000-260">O middleware de terminal permite que um código arbitrário determine quando o middleware corresponde a:</span><span class="sxs-lookup"><span data-stu-id="d5000-260">Terminal middleware allows arbitrary code to determine when the middleware matches:</span></span>
    * <span data-ttu-id="d5000-261">O código de correspondência de rota personalizado pode ser detalhado e difícil de escrever corretamente.</span><span class="sxs-lookup"><span data-stu-id="d5000-261">Custom route matching code can be verbose and difficult to write correctly.</span></span>
    * <span data-ttu-id="d5000-262">O roteamento fornece soluções diretas para aplicativos típicos.</span><span class="sxs-lookup"><span data-stu-id="d5000-262">Routing provides straightforward solutions for typical apps.</span></span> <span data-ttu-id="d5000-263">A maioria dos aplicativos não requer código de correspondência de rota personalizado.</span><span class="sxs-lookup"><span data-stu-id="d5000-263">Most apps don't require custom route matching code.</span></span>
* <span data-ttu-id="d5000-264">Interface de pontos de extremidade com middleware, como `UseAuthorization` e `UseCors`.</span><span class="sxs-lookup"><span data-stu-id="d5000-264">Endpoints interface with middleware such as `UseAuthorization` and `UseCors`.</span></span>
    * <span data-ttu-id="d5000-265">Usar um middleware de terminal com `UseAuthorization` ou `UseCors` requer a interface manual com o sistema de autorização.</span><span class="sxs-lookup"><span data-stu-id="d5000-265">Using a terminal middleware with `UseAuthorization` or `UseCors` requires manual interfacing with the authorization system.</span></span>

<span data-ttu-id="d5000-266">Um [ponto de extremidade](#endpoint) define ambos:</span><span class="sxs-lookup"><span data-stu-id="d5000-266">An [endpoint](#endpoint) defines both:</span></span>

* <span data-ttu-id="d5000-267">Um delegado para processar solicitações.</span><span class="sxs-lookup"><span data-stu-id="d5000-267">A delegate to process requests.</span></span>
* <span data-ttu-id="d5000-268">Uma coleção de metadados arbitrários.</span><span class="sxs-lookup"><span data-stu-id="d5000-268">A collection of arbitrary metadata.</span></span> <span data-ttu-id="d5000-269">Os metadados são usados para implementar preocupações abrangentes com base em políticas e configurações anexadas a cada ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="d5000-269">The metadata is used to implement cross-cutting concerns based on policies and configuration attached to each endpoint.</span></span>

<span data-ttu-id="d5000-270">O middleware de terminal pode ser uma ferramenta eficaz, mas pode exigir:</span><span class="sxs-lookup"><span data-stu-id="d5000-270">Terminal middleware can be an effective tool, but can require:</span></span>

* <span data-ttu-id="d5000-271">Uma quantidade significativa de codificação e teste.</span><span class="sxs-lookup"><span data-stu-id="d5000-271">A significant amount of coding and testing.</span></span>
* <span data-ttu-id="d5000-272">Integração manual com outros sistemas para atingir o nível desejado de flexibilidade.</span><span class="sxs-lookup"><span data-stu-id="d5000-272">Manual integration with other systems to achieve the desired level of flexibility.</span></span>

<span data-ttu-id="d5000-273">Considere a integração com o roteamento antes de gravar um middleware de terminal.</span><span class="sxs-lookup"><span data-stu-id="d5000-273">Consider integrating with routing before writing a terminal middleware.</span></span>

<span data-ttu-id="d5000-274">Middleware de terminal existente que se integra ao [MAP](xref:fundamentals/middleware/index#branch-the-middleware-pipeline) ou <xref:Microsoft.AspNetCore.Builder.MapWhenExtensions.MapWhen*> que normalmente pode ser transformado em um ponto de extremidade com reconhecimento de roteamento.</span><span class="sxs-lookup"><span data-stu-id="d5000-274">Existing terminal middleware that integrates with [Map](xref:fundamentals/middleware/index#branch-the-middleware-pipeline) or <xref:Microsoft.AspNetCore.Builder.MapWhenExtensions.MapWhen*> can usually be turned into a routing aware endpoint.</span></span> <span data-ttu-id="d5000-275">[MapHealthChecks](https://github.com/aspnet/AspNetCore/blob/master/src/Middleware/HealthChecks/src/Builder/HealthCheckEndpointRouteBuilderExtensions.cs#L16) demonstra o padrão para o roteador-Ware:</span><span class="sxs-lookup"><span data-stu-id="d5000-275">[MapHealthChecks](https://github.com/aspnet/AspNetCore/blob/master/src/Middleware/HealthChecks/src/Builder/HealthCheckEndpointRouteBuilderExtensions.cs#L16) demonstrates the pattern for router-ware:</span></span>
* <span data-ttu-id="d5000-276">Escreva um método de extensão <xref:Microsoft.AspNetCore.Routing.IEndpointRouteBuilder>em.</span><span class="sxs-lookup"><span data-stu-id="d5000-276">Write an extension method on <xref:Microsoft.AspNetCore.Routing.IEndpointRouteBuilder>.</span></span>
* <span data-ttu-id="d5000-277">Crie um pipeline de middleware aninhado <xref:Microsoft.AspNetCore.Routing.IEndpointRouteBuilder.CreateApplicationBuilder*>usando.</span><span class="sxs-lookup"><span data-stu-id="d5000-277">Create a nested middleware pipeline using <xref:Microsoft.AspNetCore.Routing.IEndpointRouteBuilder.CreateApplicationBuilder*>.</span></span>
* <span data-ttu-id="d5000-278">Anexe o middleware ao novo pipeline.</span><span class="sxs-lookup"><span data-stu-id="d5000-278">Attach the middleware to the new pipeline.</span></span> <span data-ttu-id="d5000-279">Nesse caso, <xref:Microsoft.AspNetCore.Builder.HealthCheckApplicationBuilderExtensions.UseHealthChecks*>.</span><span class="sxs-lookup"><span data-stu-id="d5000-279">In this case, <xref:Microsoft.AspNetCore.Builder.HealthCheckApplicationBuilderExtensions.UseHealthChecks*>.</span></span>
* <span data-ttu-id="d5000-280"><xref:Microsoft.AspNetCore.Builder.IApplicationBuilder.Build*>o pipeline de middleware em um <xref:Microsoft.AspNetCore.Http.RequestDelegate>.</span><span class="sxs-lookup"><span data-stu-id="d5000-280"><xref:Microsoft.AspNetCore.Builder.IApplicationBuilder.Build*> the middleware pipeline into a <xref:Microsoft.AspNetCore.Http.RequestDelegate>.</span></span>
* <span data-ttu-id="d5000-281">Chame `Map` e forneça o novo pipeline de middleware.</span><span class="sxs-lookup"><span data-stu-id="d5000-281">Call `Map` and provide the new middleware pipeline.</span></span>
* <span data-ttu-id="d5000-282">Retornar o objeto Builder fornecido pelo `Map` método de extensão.</span><span class="sxs-lookup"><span data-stu-id="d5000-282">Return the builder object provided by `Map` from the extension method.</span></span>

<span data-ttu-id="d5000-283">O código a seguir mostra o uso de [MapHealthChecks](xref:host-and-deploy/health-checks):</span><span class="sxs-lookup"><span data-stu-id="d5000-283">The following code shows use of [MapHealthChecks](xref:host-and-deploy/health-checks):</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/AuthorizationStartup.cs?name=snippet)]

<span data-ttu-id="d5000-284">O exemplo anterior mostra por que retornar o objeto Builder é importante.</span><span class="sxs-lookup"><span data-stu-id="d5000-284">The preceding sample shows why returning the builder object is important.</span></span> <span data-ttu-id="d5000-285">Retornar o objeto Builder permite que o desenvolvedor do aplicativo Configure políticas como autorização para o ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="d5000-285">Returning the builder object allows the app developer to configure policies such as authorization for the endpoint.</span></span> <span data-ttu-id="d5000-286">Neste exemplo, o middleware de verificações de integridade não tem integração direta com o sistema de autorização.</span><span class="sxs-lookup"><span data-stu-id="d5000-286">In this example, the health checks middleware has no direct integration with the authorization system.</span></span>

<span data-ttu-id="d5000-287">O sistema de metadados foi criado em resposta aos problemas encontrados por autores de extensibilidade usando o middleware de terminal.</span><span class="sxs-lookup"><span data-stu-id="d5000-287">The metadata system was created in response to the problems encountered by extensibility authors using terminal middleware.</span></span> <span data-ttu-id="d5000-288">É problemático para cada middleware implementar sua própria integração com o sistema de autorização.</span><span class="sxs-lookup"><span data-stu-id="d5000-288">It's problematic for each middleware to implement its own integration with the authorization system.</span></span>

<a name="urlm"></a>

### <a name="url-matching"></a><span data-ttu-id="d5000-289">Correspondência de URL</span><span class="sxs-lookup"><span data-stu-id="d5000-289">URL matching</span></span>

* <span data-ttu-id="d5000-290">É o processo pelo qual o roteamento corresponde a uma solicitação de entrada para um [ponto de extremidade](#endpoint).</span><span class="sxs-lookup"><span data-stu-id="d5000-290">Is the process by which routing matches an incoming request to an [endpoint](#endpoint).</span></span>
* <span data-ttu-id="d5000-291">Baseia-se nos dados no caminho da URL e nos cabeçalhos.</span><span class="sxs-lookup"><span data-stu-id="d5000-291">Is based on data in the URL path and headers.</span></span>
* <span data-ttu-id="d5000-292">Pode ser estendido para considerar todos os dados na solicitação.</span><span class="sxs-lookup"><span data-stu-id="d5000-292">Can be extended to consider any data in the request.</span></span>

<span data-ttu-id="d5000-293">Quando um middleware de roteamento é executado, ele define um `Endpoint` e os valores de rota para um [recurso](xref:fundamentals/request-features) <xref:Microsoft.AspNetCore.Http.HttpContext> de solicitação no da solicitação atual:</span><span class="sxs-lookup"><span data-stu-id="d5000-293">When a routing middleware executes, it sets an `Endpoint` and route values to a [request feature](xref:fundamentals/request-features) on the <xref:Microsoft.AspNetCore.Http.HttpContext> from the current request:</span></span>

* <span data-ttu-id="d5000-294">Chamar [HttpContext. GetEndPoint](<xref:Microsoft.AspNetCore.Http.EndpointHttpContextExtensions.GetEndpoint*>) Obtém o ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="d5000-294">Calling [HttpContext.GetEndpoint](<xref:Microsoft.AspNetCore.Http.EndpointHttpContextExtensions.GetEndpoint*>) gets the endpoint.</span></span>
* <span data-ttu-id="d5000-295">`HttpRequest.RouteValues` obtém a coleção de valores de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-295">`HttpRequest.RouteValues` gets the collection of route values.</span></span>

<span data-ttu-id="d5000-296">O [middleware](xref:fundamentals/middleware/index) em execução após o middleware de roteamento pode inspecionar o ponto de extremidade e tomar medidas.</span><span class="sxs-lookup"><span data-stu-id="d5000-296">[Middleware](xref:fundamentals/middleware/index) running after the routing middleware can inspect the endpoint and take action.</span></span> <span data-ttu-id="d5000-297">Por exemplo, um middleware de autorização pode interrogar a coleção de metadados do ponto de extremidade para uma política de autorização.</span><span class="sxs-lookup"><span data-stu-id="d5000-297">For example, an authorization middleware can interrogate the endpoint's metadata collection for an authorization policy.</span></span> <span data-ttu-id="d5000-298">Depois que todos os middlewares no pipeline de processamento da solicitação forem executados, o representante do ponto de extremidade selecionado será invocado.</span><span class="sxs-lookup"><span data-stu-id="d5000-298">After all of the middleware in the request processing pipeline is executed, the selected endpoint's delegate is invoked.</span></span>

<span data-ttu-id="d5000-299">O sistema de roteamento no roteamento de ponto de extremidade é responsável por todas as decisões de expedição.</span><span class="sxs-lookup"><span data-stu-id="d5000-299">The routing system in endpoint routing is responsible for all dispatching decisions.</span></span> <span data-ttu-id="d5000-300">Como o middleware aplica políticas com base no ponto de extremidade selecionado, é importante que:</span><span class="sxs-lookup"><span data-stu-id="d5000-300">Because the middleware applies policies based on the selected endpoint, it's important that:</span></span>

* <span data-ttu-id="d5000-301">Qualquer decisão que possa afetar a expedição ou a aplicação de diretivas de segurança é feita dentro do sistema de roteamento.</span><span class="sxs-lookup"><span data-stu-id="d5000-301">Any decision that can affect dispatching or the application of security policies is made inside the routing system.</span></span>

> [!WARNING]
> <span data-ttu-id="d5000-302">Para compatibilidade com versões anteriores, quando um delegado de ponto de extremidade de controlador ou de Razor Pages é executado, as propriedades de [RouteContext. RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData) são definidas com os valores apropriados com base no processamento de solicitação realizado até o momento.</span><span class="sxs-lookup"><span data-stu-id="d5000-302">For backwards-compatibility, when a Controller or Razor Pages endpoint delegate is executed, the properties of [RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData) are set to appropriate values based on the request processing performed thus far.</span></span>
>
> <span data-ttu-id="d5000-303">O `RouteContext` tipo será marcado como obsoleto em uma versão futura:</span><span class="sxs-lookup"><span data-stu-id="d5000-303">The `RouteContext` type will be marked obsolete in a future release:</span></span>
>
> * <span data-ttu-id="d5000-304">`RouteData.Values` Migrar `HttpRequest.RouteValues`para o.</span><span class="sxs-lookup"><span data-stu-id="d5000-304">Migrate `RouteData.Values` to `HttpRequest.RouteValues`.</span></span>
> * <span data-ttu-id="d5000-305">Migre `RouteData.DataTokens` para recuperar [IDataTokensMetadata](xref:Microsoft.AspNetCore.Routing.IDataTokensMetadata) dos metadados do ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="d5000-305">Migrate `RouteData.DataTokens` to retrieve [IDataTokensMetadata](xref:Microsoft.AspNetCore.Routing.IDataTokensMetadata) from the endpoint metadata.</span></span>

<span data-ttu-id="d5000-306">A correspondência de URL opera em um conjunto configurável de fases.</span><span class="sxs-lookup"><span data-stu-id="d5000-306">URL matching operates in a configurable set of phases.</span></span> <span data-ttu-id="d5000-307">Em cada fase, a saída é um conjunto de correspondências.</span><span class="sxs-lookup"><span data-stu-id="d5000-307">In each phase, the output is a set of matches.</span></span> <span data-ttu-id="d5000-308">O conjunto de correspondências pode ser restringido ainda mais pela próxima fase.</span><span class="sxs-lookup"><span data-stu-id="d5000-308">The set of matches can be narrowed down further by the next phase.</span></span> <span data-ttu-id="d5000-309">A implementação de roteamento não garante uma ordem de processamento para pontos de extremidade correspondentes.</span><span class="sxs-lookup"><span data-stu-id="d5000-309">The routing implementation does not guarantee a processing order for matching endpoints.</span></span> <span data-ttu-id="d5000-310">**Todas as** possíveis correspondências são processadas de uma vez.</span><span class="sxs-lookup"><span data-stu-id="d5000-310">**All** possible matches are processed at once.</span></span> <span data-ttu-id="d5000-311">As fases de correspondência de URL ocorrem na seguinte ordem.</span><span class="sxs-lookup"><span data-stu-id="d5000-311">The URL matching phases occur in the following order.</span></span> <span data-ttu-id="d5000-312">ASP.NET Core:</span><span class="sxs-lookup"><span data-stu-id="d5000-312">ASP.NET Core:</span></span>

1. <span data-ttu-id="d5000-313">Processa o caminho da URL em relação ao conjunto de pontos de extremidade e seus modelos de rota, coletando **todas** as correspondências.</span><span class="sxs-lookup"><span data-stu-id="d5000-313">Processes the URL path against the set of endpoints and their route templates, collecting **all** of the matches.</span></span>
1. <span data-ttu-id="d5000-314">Usa a lista anterior e remove as correspondências que falham com as restrições de rota aplicadas.</span><span class="sxs-lookup"><span data-stu-id="d5000-314">Takes the preceding list and removes matches that fail with route constraints applied.</span></span>
1. <span data-ttu-id="d5000-315">Usa a lista anterior e remove as correspondências que falham no conjunto de instâncias de [MatcherPolicy](xref:Microsoft.AspNetCore.Routing.MatcherPolicy) .</span><span class="sxs-lookup"><span data-stu-id="d5000-315">Takes the preceding list and removes matches that fail the set of [MatcherPolicy](xref:Microsoft.AspNetCore.Routing.MatcherPolicy) instances.</span></span>
1. <span data-ttu-id="d5000-316">Usa o [EndpointSelector](xref:Microsoft.AspNetCore.Routing.Matching.EndpointSelector) para tomar uma decisão final da lista anterior.</span><span class="sxs-lookup"><span data-stu-id="d5000-316">Uses the [EndpointSelector](xref:Microsoft.AspNetCore.Routing.Matching.EndpointSelector) to make a final decision from the preceding list.</span></span>

<span data-ttu-id="d5000-317">A lista de pontos de extremidade é priorizada de acordo com:</span><span class="sxs-lookup"><span data-stu-id="d5000-317">The list of endpoints is prioritized according to:</span></span>

* <span data-ttu-id="d5000-318">O [RouteEndpoint. Order](xref:Microsoft.AspNetCore.Routing.RouteEndpoint.Order*)</span><span class="sxs-lookup"><span data-stu-id="d5000-318">The [RouteEndpoint.Order](xref:Microsoft.AspNetCore.Routing.RouteEndpoint.Order*)</span></span>
* <span data-ttu-id="d5000-319">A [precedência do modelo de rota](#rtp)</span><span class="sxs-lookup"><span data-stu-id="d5000-319">The [route template precedence](#rtp)</span></span>

<span data-ttu-id="d5000-320">Todos os pontos de extremidade correspondentes são processados em cada fase <xref:Microsoft.AspNetCore.Routing.Matching.EndpointSelector> até que o seja atingido.</span><span class="sxs-lookup"><span data-stu-id="d5000-320">All matching endpoints are processed in each phase until the <xref:Microsoft.AspNetCore.Routing.Matching.EndpointSelector> is reached.</span></span> <span data-ttu-id="d5000-321">A `EndpointSelector` é a fase final.</span><span class="sxs-lookup"><span data-stu-id="d5000-321">The `EndpointSelector` is the final phase.</span></span> <span data-ttu-id="d5000-322">Ele escolhe o ponto de extremidade de prioridade mais alta das correspondências como a melhor correspondência.</span><span class="sxs-lookup"><span data-stu-id="d5000-322">It chooses the highest priority endpoint from the matches as the best match.</span></span> <span data-ttu-id="d5000-323">Se houver outras correspondências com a mesma prioridade que a melhor correspondência, uma exceção de correspondência ambígua será gerada.</span><span class="sxs-lookup"><span data-stu-id="d5000-323">If there are other matches with the same priority as the best match, an ambiguous match exception is thrown.</span></span>

<span data-ttu-id="d5000-324">A precedência de rota é calculada com base em um modelo de rota **mais específico** que tem uma prioridade mais alta.</span><span class="sxs-lookup"><span data-stu-id="d5000-324">The route precedence is computed based on a **more specific** route template being given a higher priority.</span></span> <span data-ttu-id="d5000-325">Por exemplo, considere os modelos `/hello` e `/{message}`:</span><span class="sxs-lookup"><span data-stu-id="d5000-325">For example, consider the templates `/hello` and `/{message}`:</span></span>

* <span data-ttu-id="d5000-326">Ambos correspondem ao caminho `/hello`da URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-326">Both match the URL path `/hello`.</span></span>
* <span data-ttu-id="d5000-327">`/hello`é mais específico e, portanto, prioridade mais alta.</span><span class="sxs-lookup"><span data-stu-id="d5000-327">`/hello`  is more specific and therefore higher priority.</span></span>

<span data-ttu-id="d5000-328">Em geral, a precedência de rota faz um bom trabalho de escolher a melhor correspondência para os tipos de esquemas de URL usados na prática.</span><span class="sxs-lookup"><span data-stu-id="d5000-328">In general, route precedence does a good job of choosing the best match for the kinds of URL schemes used in practice.</span></span> <span data-ttu-id="d5000-329">Use <xref:Microsoft.AspNetCore.Routing.RouteEndpoint.Order> somente quando necessário para evitar uma ambiguidade.</span><span class="sxs-lookup"><span data-stu-id="d5000-329">Use <xref:Microsoft.AspNetCore.Routing.RouteEndpoint.Order> only when necessary to avoid an ambiguity.</span></span>

<span data-ttu-id="d5000-330">Devido aos tipos de extensibilidade fornecidos pelo roteamento, não é possível que o sistema de roteamento computar antecipadamente as rotas ambíguas.</span><span class="sxs-lookup"><span data-stu-id="d5000-330">Due to the kinds of extensibility provided by routing, it isn't possible for the routing system to compute ahead of time the ambiguous routes.</span></span> <span data-ttu-id="d5000-331">Considere um exemplo, como os modelos `/{message:alpha}` de rota `/{message:int}`e:</span><span class="sxs-lookup"><span data-stu-id="d5000-331">Consider an example such as the route templates `/{message:alpha}` and `/{message:int}`:</span></span>

* <span data-ttu-id="d5000-332">A `alpha` restrição corresponde apenas a caracteres alfabéticos.</span><span class="sxs-lookup"><span data-stu-id="d5000-332">The `alpha` constraint matches only alphabetic characters.</span></span>
* <span data-ttu-id="d5000-333">A `int` restrição corresponde apenas a números.</span><span class="sxs-lookup"><span data-stu-id="d5000-333">The `int` constraint matches only numbers.</span></span>
* <span data-ttu-id="d5000-334">Esses modelos têm a mesma precedência de rota, mas não há uma URL única que ambos correspondam.</span><span class="sxs-lookup"><span data-stu-id="d5000-334">These templates have the same route precedence, but there's no single URL they both match.</span></span>
* <span data-ttu-id="d5000-335">Se o sistema de roteamento relatou um erro de ambiguidade na inicialização, ele bloquearia esse caso de uso válido.</span><span class="sxs-lookup"><span data-stu-id="d5000-335">If the routing system reported an ambiguity error at startup, it would block this valid use case.</span></span>

> [!WARNING]
>
> <span data-ttu-id="d5000-336">A ordem das operações dentro <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*> não influencia o comportamento do roteamento, com uma exceção.</span><span class="sxs-lookup"><span data-stu-id="d5000-336">The order of operations inside <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*> doesn't influence the behavior of routing, with one exception.</span></span> <span data-ttu-id="d5000-337"><xref:Microsoft.AspNetCore.Builder.ControllerEndpointRouteBuilderExtensions.MapControllerRoute*>e <xref:Microsoft.AspNetCore.Builder.MvcAreaRouteBuilderExtensions.MapAreaRoute*> atribuir automaticamente um valor de pedido a seus pontos de extremidade com base na ordem em que são invocados.</span><span class="sxs-lookup"><span data-stu-id="d5000-337"><xref:Microsoft.AspNetCore.Builder.ControllerEndpointRouteBuilderExtensions.MapControllerRoute*> and <xref:Microsoft.AspNetCore.Builder.MvcAreaRouteBuilderExtensions.MapAreaRoute*> automatically assign an order value to their endpoints based on the order they are invoked.</span></span> <span data-ttu-id="d5000-338">Isso simula o comportamento a longo prazo de controladores sem o sistema de roteamento fornecendo as mesmas garantias que as implementações de roteamento mais antigas.</span><span class="sxs-lookup"><span data-stu-id="d5000-338">This simulates long-time behavior of controllers without the routing system providing the same guarantees as older routing implementations.</span></span>
>
> <span data-ttu-id="d5000-339">Na implementação herdada do roteamento, é possível implementar a extensibilidade de roteamento que tem uma dependência na ordem em que as rotas são processadas.</span><span class="sxs-lookup"><span data-stu-id="d5000-339">In the legacy implementation of routing, it's possible to implement routing extensibility that has a dependency on the order in which routes are processed.</span></span> <span data-ttu-id="d5000-340">Roteamento de ponto de extremidade no ASP.NET Core 3,0 e posterior:</span><span class="sxs-lookup"><span data-stu-id="d5000-340">Endpoint routing in ASP.NET Core 3.0 and later:</span></span>
> 
> * <span data-ttu-id="d5000-341">Não tem um conceito de rotas.</span><span class="sxs-lookup"><span data-stu-id="d5000-341">Doesn't have a concept of routes.</span></span>
> * <span data-ttu-id="d5000-342">Não fornece garantias de ordenação.</span><span class="sxs-lookup"><span data-stu-id="d5000-342">Doesn't provide ordering guarantees.</span></span> <span data-ttu-id="d5000-343">Todos os pontos de extremidade são processados de uma só vez.</span><span class="sxs-lookup"><span data-stu-id="d5000-343">All endpoints are processed at once.</span></span>
>
> <span data-ttu-id="d5000-344">Se isso significa que você está preso a usar o sistema de roteamento herdado, [abra um problema do GitHub para obter assistência](https://github.com/dotnet/aspnetcore/issues).</span><span class="sxs-lookup"><span data-stu-id="d5000-344">If this means you're stuck using the legacy routing system, [open a GitHub issue for assistance](https://github.com/dotnet/aspnetcore/issues).</span></span>

<a name="rtp"></a>

### <a name="route-template-precedence-and-endpoint-selection-order"></a><span data-ttu-id="d5000-345">Ordem de precedência do modelo de rota e seleção de ponto de extremidade</span><span class="sxs-lookup"><span data-stu-id="d5000-345">Route template precedence and endpoint selection order</span></span>

<span data-ttu-id="d5000-346">A [precedência de modelo de rota](https://github.com/dotnet/aspnetcore/blob/master/src/Http/Routing/src/Template/RoutePrecedence.cs#L16) é um sistema que atribui a cada modelo de rota um valor baseado em como ele é específico.</span><span class="sxs-lookup"><span data-stu-id="d5000-346">[Route template precedence](https://github.com/dotnet/aspnetcore/blob/master/src/Http/Routing/src/Template/RoutePrecedence.cs#L16) is a system that assigns each route template a value based on how specific it is.</span></span> <span data-ttu-id="d5000-347">Precedência do modelo de rota:</span><span class="sxs-lookup"><span data-stu-id="d5000-347">Route template precedence:</span></span>

* <span data-ttu-id="d5000-348">Evita a necessidade de ajustar a ordem dos pontos de extremidade em casos comuns.</span><span class="sxs-lookup"><span data-stu-id="d5000-348">Avoids the need to adjust the order of endpoints in common cases.</span></span>
* <span data-ttu-id="d5000-349">Tenta corresponder às expectativas de senso comum de comportamento de roteamento.</span><span class="sxs-lookup"><span data-stu-id="d5000-349">Attempts to match the common-sense expectations of routing behavior.</span></span>

<span data-ttu-id="d5000-350">Por exemplo, considere modelos `/Products/List` e `/Products/{id}`.</span><span class="sxs-lookup"><span data-stu-id="d5000-350">For example, consider templates `/Products/List` and `/Products/{id}`.</span></span> <span data-ttu-id="d5000-351">Seria razoável pressupor que `/Products/List` seja uma correspondência melhor do que `/Products/{id}` para o caminho `/Products/List`da URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-351">It would be reasonable to assume that `/Products/List` is a better match than `/Products/{id}` for the URL path `/Products/List`.</span></span> <span data-ttu-id="d5000-352">O funciona porque o segmento `/List` literal é considerado com precedência melhor do que o segmento `/{id}`de parâmetro.</span><span class="sxs-lookup"><span data-stu-id="d5000-352">The works because the literal segment `/List` is considered to have better precedence than the parameter segment `/{id}`.</span></span>

<span data-ttu-id="d5000-353">Os detalhes de como a precedência funcionam são acoplados a como os modelos de rota são definidos:</span><span class="sxs-lookup"><span data-stu-id="d5000-353">The details of how precedence works are coupled to how route templates are defined:</span></span>

* <span data-ttu-id="d5000-354">Modelos com mais segmentos são considerados mais específicos.</span><span class="sxs-lookup"><span data-stu-id="d5000-354">Templates with more segments are considered more specific.</span></span>
* <span data-ttu-id="d5000-355">Um segmento com texto literal é considerado mais específico do que um segmento de parâmetro.</span><span class="sxs-lookup"><span data-stu-id="d5000-355">A segment with literal text is considered more specific than a parameter segment.</span></span>
* <span data-ttu-id="d5000-356">Um segmento de parâmetro com uma restrição é considerado mais específico que um sem.</span><span class="sxs-lookup"><span data-stu-id="d5000-356">A parameter segment with a constraint is considered more specific than one without.</span></span>
* <span data-ttu-id="d5000-357">Um segmento complexo é considerado específico como um segmento de parâmetro com uma restrição.</span><span class="sxs-lookup"><span data-stu-id="d5000-357">A complex segment is considered as specific as a parameter segment with a constraint.</span></span>
* <span data-ttu-id="d5000-358">Catch-todos os parâmetros são os menos específicos.</span><span class="sxs-lookup"><span data-stu-id="d5000-358">Catch-all parameters are the least specific.</span></span> <span data-ttu-id="d5000-359">Consulte **catch-all** na [referência do modelo de rota](#rtr) para obter informações importantes sobre as rotas catch-all.</span><span class="sxs-lookup"><span data-stu-id="d5000-359">See **catch-all** in the [Route template reference](#rtr) for important information on catch-all routes.</span></span>

<span data-ttu-id="d5000-360">Consulte o [código-fonte no GitHub](https://github.com/dotnet/aspnetcore/blob/master/src/Http/Routing/src/Template/RoutePrecedence.cs#L189) para obter uma referência de valores exatos.</span><span class="sxs-lookup"><span data-stu-id="d5000-360">See the [source code on GitHub](https://github.com/dotnet/aspnetcore/blob/master/src/Http/Routing/src/Template/RoutePrecedence.cs#L189) for a reference of exact values.</span></span>

<a name="lg"></a>

### <a name="url-generation-concepts"></a><span data-ttu-id="d5000-361">Conceitos de geração de URL</span><span class="sxs-lookup"><span data-stu-id="d5000-361">URL generation concepts</span></span>

<span data-ttu-id="d5000-362">Geração de URL:</span><span class="sxs-lookup"><span data-stu-id="d5000-362">URL generation:</span></span>

* <span data-ttu-id="d5000-363">É o processo pelo qual o roteamento pode criar um caminho de URL com base em um conjunto de valores de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-363">Is the process by which routing can create a URL path based on a set of route values.</span></span>
* <span data-ttu-id="d5000-364">Permite uma separação lógica entre os pontos de extremidade e as URLs que os acessam.</span><span class="sxs-lookup"><span data-stu-id="d5000-364">Allows for a logical separation between endpoints and the URLs that access them.</span></span>

<span data-ttu-id="d5000-365">O roteamento de ponto <xref:Microsoft.AspNetCore.Routing.LinkGenerator> de extremidade inclui a API.</span><span class="sxs-lookup"><span data-stu-id="d5000-365">Endpoint routing includes the <xref:Microsoft.AspNetCore.Routing.LinkGenerator> API.</span></span> <span data-ttu-id="d5000-366">`LinkGenerator`é um serviço singleton disponível de [di](xref:fundamentals/dependency-injection).</span><span class="sxs-lookup"><span data-stu-id="d5000-366">`LinkGenerator` is a singleton service available from [DI](xref:fundamentals/dependency-injection).</span></span> <span data-ttu-id="d5000-367">A `LinkGenerator` API pode ser usada fora do contexto de uma solicitação em execução.</span><span class="sxs-lookup"><span data-stu-id="d5000-367">The `LinkGenerator` API can be used outside of the context of an executing request.</span></span> <span data-ttu-id="d5000-368">[MVC. IUrlHelper](xref:Microsoft.AspNetCore.Mvc.IUrlHelper) e cenários que <xref:Microsoft.AspNetCore.Mvc.IUrlHelper>dependem, como [auxiliares de marca](xref:mvc/views/tag-helpers/intro), auxiliares de HTML e resultados de [ação](xref:mvc/controllers/actions), usam a `LinkGenerator` API internamente para fornecer recursos de geração de link.</span><span class="sxs-lookup"><span data-stu-id="d5000-368">[Mvc.IUrlHelper](xref:Microsoft.AspNetCore.Mvc.IUrlHelper) and scenarios that rely on <xref:Microsoft.AspNetCore.Mvc.IUrlHelper>, such as [Tag Helpers](xref:mvc/views/tag-helpers/intro), HTML Helpers, and [Action Results](xref:mvc/controllers/actions), use the `LinkGenerator` API internally to provide link generating capabilities.</span></span>

<span data-ttu-id="d5000-369">O gerador de link é respaldado pelo conceito de um **endereço** e **esquemas de endereço**.</span><span class="sxs-lookup"><span data-stu-id="d5000-369">The link generator is backed by the concept of an **address** and **address schemes**.</span></span> <span data-ttu-id="d5000-370">Um esquema de endereço é uma maneira de determinar os pontos de extremidade que devem ser considerados para a geração de link.</span><span class="sxs-lookup"><span data-stu-id="d5000-370">An address scheme is a way of determining the endpoints that should be considered for link generation.</span></span> <span data-ttu-id="d5000-371">Por exemplo, os valores de rota e de nome da rota muitos usuários estão familiarizados com os controladores e Razor Pages são implementados como um esquema de endereço.</span><span class="sxs-lookup"><span data-stu-id="d5000-371">For example, the route name and route values scenarios many users are familiar with from controllers and Razor Pages are implemented as an address scheme.</span></span>

<span data-ttu-id="d5000-372">O gerador de link pode vincular a controladores e Razor Pages por meio dos seguintes métodos de extensão:</span><span class="sxs-lookup"><span data-stu-id="d5000-372">The link generator can link to controllers and Razor Pages via the following extension methods:</span></span>

* <xref:Microsoft.AspNetCore.Routing.ControllerLinkGeneratorExtensions.GetPathByAction*>
* <xref:Microsoft.AspNetCore.Routing.ControllerLinkGeneratorExtensions.GetUriByAction*>
* <xref:Microsoft.AspNetCore.Routing.PageLinkGeneratorExtensions.GetPathByPage*>
* <xref:Microsoft.AspNetCore.Routing.PageLinkGeneratorExtensions.GetUriByPage*>

<span data-ttu-id="d5000-373">Sobrecargas desses métodos aceitam argumentos que incluem o `HttpContext`.</span><span class="sxs-lookup"><span data-stu-id="d5000-373">Overloads of these methods accept arguments that include the `HttpContext`.</span></span> <span data-ttu-id="d5000-374">Esses métodos são funcionalmente equivalentes a [URL. Action](xref:System.Web.Mvc.UrlHelper.Action*) e [URL. Page](xref:Microsoft.AspNetCore.Mvc.UrlHelperExtensions.Page*), mas oferecem mais flexibilidade e opções.</span><span class="sxs-lookup"><span data-stu-id="d5000-374">These methods are functionally equivalent to [Url.Action](xref:System.Web.Mvc.UrlHelper.Action*) and [Url.Page](xref:Microsoft.AspNetCore.Mvc.UrlHelperExtensions.Page*), but offer additional flexibility and options.</span></span>

<span data-ttu-id="d5000-375">Os `GetPath*` métodos são mais semelhantes a `Url.Action` e `Url.Page`, no que geram um URI que contém um caminho absoluto.</span><span class="sxs-lookup"><span data-stu-id="d5000-375">The `GetPath*` methods are most similar to `Url.Action` and `Url.Page`, in that they generate a URI containing an absolute path.</span></span> <span data-ttu-id="d5000-376">Os métodos `GetUri*` sempre geram um URI absoluto que contém um esquema e um host.</span><span class="sxs-lookup"><span data-stu-id="d5000-376">The `GetUri*` methods always generate an absolute URI containing a scheme and host.</span></span> <span data-ttu-id="d5000-377">Os métodos que aceitam um `HttpContext` geram um URI no contexto da solicitação em execução.</span><span class="sxs-lookup"><span data-stu-id="d5000-377">The methods that accept an `HttpContext` generate a URI in the context of the executing request.</span></span> <span data-ttu-id="d5000-378">Os valores de rota de [ambiente](#ambient) , caminho base da URL, esquema e host da solicitação em execução são usados, a menos que sejam substituídos.</span><span class="sxs-lookup"><span data-stu-id="d5000-378">The [ambient](#ambient) route values, URL base path, scheme, and host from the executing request are used unless overridden.</span></span>

<span data-ttu-id="d5000-379"><xref:Microsoft.AspNetCore.Routing.LinkGenerator> é chamado com um endereço.</span><span class="sxs-lookup"><span data-stu-id="d5000-379"><xref:Microsoft.AspNetCore.Routing.LinkGenerator> is called with an address.</span></span> <span data-ttu-id="d5000-380">A geração de um URI ocorre em duas etapas:</span><span class="sxs-lookup"><span data-stu-id="d5000-380">Generating a URI occurs in two steps:</span></span>

1. <span data-ttu-id="d5000-381">Um endereço é associado a uma lista de pontos de extremidade que correspondem ao endereço.</span><span class="sxs-lookup"><span data-stu-id="d5000-381">An address is bound to a list of endpoints that match the address.</span></span>
1. <span data-ttu-id="d5000-382">O <xref:Microsoft.AspNetCore.Routing.RouteEndpoint.RoutePattern> de cada ponto de extremidade é avaliado até que seja encontrado um padrão de rota correspondente aos valores fornecidos.</span><span class="sxs-lookup"><span data-stu-id="d5000-382">Each endpoint's <xref:Microsoft.AspNetCore.Routing.RouteEndpoint.RoutePattern> is evaluated until a route pattern that matches the supplied values is found.</span></span> <span data-ttu-id="d5000-383">A saída resultante é combinada com as outras partes de URI fornecidas ao gerador de link e é retornada.</span><span class="sxs-lookup"><span data-stu-id="d5000-383">The resulting output is combined with the other URI parts supplied to the link generator and returned.</span></span>

<span data-ttu-id="d5000-384">Os métodos fornecidos pelo <xref:Microsoft.AspNetCore.Routing.LinkGenerator> dão suporte a funcionalidades de geração de link padrão para qualquer tipo de endereço.</span><span class="sxs-lookup"><span data-stu-id="d5000-384">The methods provided by <xref:Microsoft.AspNetCore.Routing.LinkGenerator> support standard link generation capabilities for any type of address.</span></span> <span data-ttu-id="d5000-385">A maneira mais conveniente de usar o link Generator é por meio de métodos de extensão que executam operações para um tipo de endereço específico:</span><span class="sxs-lookup"><span data-stu-id="d5000-385">The most convenient way to use the link generator is through extension methods that perform operations for a specific address type:</span></span>

| <span data-ttu-id="d5000-386">Método de extensão</span><span class="sxs-lookup"><span data-stu-id="d5000-386">Extension Method</span></span> | <span data-ttu-id="d5000-387">Descrição</span><span class="sxs-lookup"><span data-stu-id="d5000-387">Description</span></span> |
| ---------------- | ----------- |
| <xref:Microsoft.AspNetCore.Routing.LinkGenerator.GetPathByAddress*> | <span data-ttu-id="d5000-388">Gera um URI com um caminho absoluto com base nos valores fornecidos.</span><span class="sxs-lookup"><span data-stu-id="d5000-388">Generates a URI with an absolute path based on the provided values.</span></span> |
| <xref:Microsoft.AspNetCore.Routing.LinkGenerator.GetUriByAddress*> | <span data-ttu-id="d5000-389">Gera um URI absoluto com base nos valores fornecidos.</span><span class="sxs-lookup"><span data-stu-id="d5000-389">Generates an absolute URI based on the provided values.</span></span>             |

> [!WARNING]
> <span data-ttu-id="d5000-390">Preste atenção às seguintes implicações da chamada de métodos <xref:Microsoft.AspNetCore.Routing.LinkGenerator>:</span><span class="sxs-lookup"><span data-stu-id="d5000-390">Pay attention to the following implications of calling <xref:Microsoft.AspNetCore.Routing.LinkGenerator> methods:</span></span>
>
> * <span data-ttu-id="d5000-391">Use métodos de extensão de `GetUri*` com cuidado em uma configuração de aplicativo que não valide o cabeçalho `Host` das solicitações de entrada.</span><span class="sxs-lookup"><span data-stu-id="d5000-391">Use `GetUri*` extension methods with caution in an app configuration that doesn't validate the `Host` header of incoming requests.</span></span> <span data-ttu-id="d5000-392">Se o `Host` cabeçalho de solicitações de entrada não for validado, a entrada de solicitação não confiável poderá ser enviada de volta para o cliente em URIs em uma exibição ou página.</span><span class="sxs-lookup"><span data-stu-id="d5000-392">If the `Host` header of incoming requests isn't validated, untrusted request input can be sent back to the client in URIs in a view or page.</span></span> <span data-ttu-id="d5000-393">Recomendamos que todos os aplicativos de produção configurem seu servidor para validar o cabeçalho `Host` com os valores válidos conhecidos.</span><span class="sxs-lookup"><span data-stu-id="d5000-393">We recommend that all production apps configure their server to validate the `Host` header against known valid values.</span></span>
>
> * <span data-ttu-id="d5000-394">Use <xref:Microsoft.AspNetCore.Routing.LinkGenerator> com cuidado no middleware em combinação com `Map` ou `MapWhen`.</span><span class="sxs-lookup"><span data-stu-id="d5000-394">Use <xref:Microsoft.AspNetCore.Routing.LinkGenerator> with caution in middleware in combination with `Map` or `MapWhen`.</span></span> <span data-ttu-id="d5000-395">`Map*` altera o caminho base da solicitação em execução, o que afeta a saída da geração de link.</span><span class="sxs-lookup"><span data-stu-id="d5000-395">`Map*` changes the base path of the executing request, which affects the output of link generation.</span></span> <span data-ttu-id="d5000-396">Todas as APIs de <xref:Microsoft.AspNetCore.Routing.LinkGenerator> permitem a especificação de um caminho base.</span><span class="sxs-lookup"><span data-stu-id="d5000-396">All of the <xref:Microsoft.AspNetCore.Routing.LinkGenerator> APIs allow specifying a base path.</span></span> <span data-ttu-id="d5000-397">Especifique um caminho base vazio para desfazer o `Map*` efeito na geração de link.</span><span class="sxs-lookup"><span data-stu-id="d5000-397">Specify an empty base path to undo the `Map*` affect on link generation.</span></span>

### <a name="middleware-example"></a><span data-ttu-id="d5000-398">Exemplo de middleware</span><span class="sxs-lookup"><span data-stu-id="d5000-398">Middleware example</span></span>

<span data-ttu-id="d5000-399">No exemplo a seguir, um middleware usa a API <xref:Microsoft.AspNetCore.Routing.LinkGenerator> para criar um link para um método de ação que lista os produtos da loja.</span><span class="sxs-lookup"><span data-stu-id="d5000-399">In the following example, a middleware uses the <xref:Microsoft.AspNetCore.Routing.LinkGenerator> API to create a link to an action method that lists store products.</span></span> <span data-ttu-id="d5000-400">Usar o gerador de link injetando-o em uma classe e `GenerateLink` chamar está disponível para qualquer classe em um aplicativo:</span><span class="sxs-lookup"><span data-stu-id="d5000-400">Using the link generator by injecting it into a class and calling `GenerateLink` is available to any class in an app:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/Middleware/ProductsLinkMiddleware.cs?name=snippet)]

<a name="rtr"></a>

## <a name="route-template-reference"></a><span data-ttu-id="d5000-401">Referência de modelo de rota</span><span class="sxs-lookup"><span data-stu-id="d5000-401">Route template reference</span></span>

<span data-ttu-id="d5000-402">Tokens `{}` dentro de definir parâmetros de rota que são associados se a rota for correspondida.</span><span class="sxs-lookup"><span data-stu-id="d5000-402">Tokens within `{}` define route parameters that are bound if the route is matched.</span></span> <span data-ttu-id="d5000-403">Mais de um parâmetro de rota pode ser definido em um segmento de rota, mas os parâmetros de rota devem ser separados por um valor literal.</span><span class="sxs-lookup"><span data-stu-id="d5000-403">More than one route parameter can be defined in a route segment, but route parameters  must be separated by a literal value.</span></span> <span data-ttu-id="d5000-404">Por exemplo, `{controller=Home}{action=Index}` não é uma rota válida, já que não há nenhum valor literal entre `{controller}` e `{action}`.</span><span class="sxs-lookup"><span data-stu-id="d5000-404">For example, `{controller=Home}{action=Index}` isn't a valid route, since there's no literal value between `{controller}` and `{action}`.</span></span>  <span data-ttu-id="d5000-405">Os parâmetros de rota devem ter um nome e podem ter atributos adicionais especificados.</span><span class="sxs-lookup"><span data-stu-id="d5000-405">Route parameters must have a name and may have additional attributes specified.</span></span>

<span data-ttu-id="d5000-406">Um texto literal diferente dos parâmetros de rota (por exemplo, `{id}`) e do separador de caminho `/` precisa corresponder ao texto na URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-406">Literal text other than route parameters (for example, `{id}`) and the path separator `/` must match the text in the URL.</span></span> <span data-ttu-id="d5000-407">A correspondência de texto não diferencia maiúsculas de minúsculas e com base na representação decodificada do caminho da URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-407">Text matching is case-insensitive and based on the decoded representation of the URL's path.</span></span> <span data-ttu-id="d5000-408">Para corresponder a um delimitador `{` de `}`parâmetro de rota literal ou, escape o delimitador repetindo o caractere.</span><span class="sxs-lookup"><span data-stu-id="d5000-408">To match a literal route parameter delimiter `{` or `}`, escape the delimiter by repeating the character.</span></span> <span data-ttu-id="d5000-409">Por exemplo `{{` , `}}`ou.</span><span class="sxs-lookup"><span data-stu-id="d5000-409">For example `{{` or `}}`.</span></span>

<span data-ttu-id="d5000-410">Asterisco `*` ou asterisco `**`duplo:</span><span class="sxs-lookup"><span data-stu-id="d5000-410">Asterisk `*` or double asterisk `**`:</span></span>

* <span data-ttu-id="d5000-411">Pode ser usado como um prefixo para um parâmetro de rota para associar ao restante do URI.</span><span class="sxs-lookup"><span data-stu-id="d5000-411">Can be used as a prefix to a route parameter to bind to the rest of the URI.</span></span>
* <span data-ttu-id="d5000-412">São chamados de parâmetros **catch-all** .</span><span class="sxs-lookup"><span data-stu-id="d5000-412">Are called a **catch-all** parameters.</span></span> <span data-ttu-id="d5000-413">Por exemplo `blog/{**slug}`:</span><span class="sxs-lookup"><span data-stu-id="d5000-413">For example, `blog/{**slug}`:</span></span>
  * <span data-ttu-id="d5000-414">Corresponde a qualquer URI que comece `/blog` com e tenha qualquer valor após ele.</span><span class="sxs-lookup"><span data-stu-id="d5000-414">Matches any URI that starts with `/blog` and has any value following it.</span></span>
  * <span data-ttu-id="d5000-415">O valor a `/blog` seguir é atribuído ao valor de rota de [espaçador](https://developer.mozilla.org/docs/Glossary/Slug) .</span><span class="sxs-lookup"><span data-stu-id="d5000-415">The value following `/blog` is assigned to the [slug](https://developer.mozilla.org/docs/Glossary/Slug) route value.</span></span>

[!INCLUDE[](~/includes/catchall.md)]

<span data-ttu-id="d5000-416">Os parâmetros catch-all também podem corresponder à cadeia de caracteres vazia.</span><span class="sxs-lookup"><span data-stu-id="d5000-416">Catch-all parameters can also match the empty string.</span></span>

<span data-ttu-id="d5000-417">O parâmetro catch-all escapa os caracteres apropriados quando a rota é usada para gerar uma URL, incluindo caracteres separadores `/` de caminho.</span><span class="sxs-lookup"><span data-stu-id="d5000-417">The catch-all parameter escapes the appropriate characters when the route is used to generate a URL, including path separator `/` characters.</span></span> <span data-ttu-id="d5000-418">Por exemplo, a rota `foo/{*path}` com valores de rota `{ path = "my/path" }` gera `foo/my%2Fpath`.</span><span class="sxs-lookup"><span data-stu-id="d5000-418">For example, the route `foo/{*path}` with route values `{ path = "my/path" }` generates `foo/my%2Fpath`.</span></span> <span data-ttu-id="d5000-419">Observe o escape da barra invertida.</span><span class="sxs-lookup"><span data-stu-id="d5000-419">Note the escaped forward slash.</span></span> <span data-ttu-id="d5000-420">Para fazer a viagem de ida e volta dos caracteres separadores de caminho, use o prefixo do parâmetro da rota `**`.</span><span class="sxs-lookup"><span data-stu-id="d5000-420">To round-trip path separator characters, use the `**` route parameter prefix.</span></span> <span data-ttu-id="d5000-421">A rota `foo/{**path}` com `{ path = "my/path" }` gera `foo/my/path`.</span><span class="sxs-lookup"><span data-stu-id="d5000-421">The route `foo/{**path}` with `{ path = "my/path" }` generates `foo/my/path`.</span></span>

<span data-ttu-id="d5000-422">Padrões de URL que tentam capturar um nome de arquivo com uma extensão de arquivo opcional apresentam considerações adicionais.</span><span class="sxs-lookup"><span data-stu-id="d5000-422">URL patterns that attempt to capture a file name with an optional file extension have additional considerations.</span></span> <span data-ttu-id="d5000-423">Por exemplo, considere o modelo `files/{filename}.{ext?}`.</span><span class="sxs-lookup"><span data-stu-id="d5000-423">For example, consider the template `files/{filename}.{ext?}`.</span></span> <span data-ttu-id="d5000-424">Quando existem valores para `filename` e `ext`, ambos os valores são populados.</span><span class="sxs-lookup"><span data-stu-id="d5000-424">When values for both `filename` and `ext` exist, both values are populated.</span></span> <span data-ttu-id="d5000-425">Se apenas um valor para `filename` existir na URL, a rota `.` será correspondente porque a direita é opcional.</span><span class="sxs-lookup"><span data-stu-id="d5000-425">If only a value for `filename` exists in the URL, the route matches because the trailing `.` is  optional.</span></span> <span data-ttu-id="d5000-426">As URLs a seguir correspondem a essa rota:</span><span class="sxs-lookup"><span data-stu-id="d5000-426">The following URLs match this route:</span></span>

* `/files/myFile.txt`
* `/files/myFile`

<span data-ttu-id="d5000-427">Os parâmetros de rota podem ter **valores padrão**, designados pela especificação do valor padrão após o nome do parâmetro separado por um sinal de igual (`=`).</span><span class="sxs-lookup"><span data-stu-id="d5000-427">Route parameters may have **default values** designated by specifying the default value after the parameter name separated by an equals sign (`=`).</span></span> <span data-ttu-id="d5000-428">Por exemplo, `{controller=Home}` define `Home` como o valor padrão de `controller`.</span><span class="sxs-lookup"><span data-stu-id="d5000-428">For example, `{controller=Home}` defines `Home` as the default value for `controller`.</span></span> <span data-ttu-id="d5000-429">O valor padrão é usado se nenhum valor está presente na URL para o parâmetro.</span><span class="sxs-lookup"><span data-stu-id="d5000-429">The default value is used if no value is present in the URL for the parameter.</span></span> <span data-ttu-id="d5000-430">Os parâmetros de rota são tornados opcionais acrescentando um`?`ponto de interrogação () ao final do nome do parâmetro.</span><span class="sxs-lookup"><span data-stu-id="d5000-430">Route parameters are made optional by appending a question mark (`?`) to the end of the parameter name.</span></span> <span data-ttu-id="d5000-431">Por exemplo, `id?`.</span><span class="sxs-lookup"><span data-stu-id="d5000-431">For example, `id?`.</span></span> <span data-ttu-id="d5000-432">A diferença entre os valores opcionais e os parâmetros de rota padrão é:</span><span class="sxs-lookup"><span data-stu-id="d5000-432">The difference between optional values and default route parameters is:</span></span>

* <span data-ttu-id="d5000-433">Um parâmetro de rota com um valor padrão sempre produz um valor.</span><span class="sxs-lookup"><span data-stu-id="d5000-433">A route parameter with a default value always produces a value.</span></span>
* <span data-ttu-id="d5000-434">Um parâmetro opcional tem um valor somente quando um valor é fornecido pela URL de solicitação.</span><span class="sxs-lookup"><span data-stu-id="d5000-434">An optional parameter has a value only when a value is provided by the request URL.</span></span>

<span data-ttu-id="d5000-435">Os parâmetros de rota podem ter restrições que precisam corresponder ao valor de rota associado da URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-435">Route parameters may have constraints that must match the route value bound from the URL.</span></span> <span data-ttu-id="d5000-436">Adicionar `:` e nome de restrição após o nome do parâmetro de rota especifica uma restrição embutida em um parâmetro de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-436">Adding `:` and constraint name after the route parameter name specifies an inline constraint on a route parameter.</span></span> <span data-ttu-id="d5000-437">Se a restrição exigir argumentos, eles ficarão entre parênteses `(...)` após o nome da restrição.</span><span class="sxs-lookup"><span data-stu-id="d5000-437">If the constraint requires arguments, they're enclosed in parentheses `(...)` after the constraint name.</span></span> <span data-ttu-id="d5000-438">Várias *restrições embutidas* podem ser especificadas acrescentando outro `:` nome de restrição.</span><span class="sxs-lookup"><span data-stu-id="d5000-438">Multiple *inline constraints* can be specified by appending another `:` and constraint name.</span></span>

<span data-ttu-id="d5000-439">O nome da restrição e os argumentos são passados para o serviço <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> para criar uma instância de <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> a ser usada no processamento de URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-439">The constraint name and arguments are passed to the <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> service to create an instance of <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> to use in URL processing.</span></span> <span data-ttu-id="d5000-440">Por exemplo, o modelo de rota `blog/{article:minlength(10)}` especifica uma restrição `minlength` com o argumento `10`.</span><span class="sxs-lookup"><span data-stu-id="d5000-440">For example, the route template `blog/{article:minlength(10)}` specifies a `minlength` constraint with the argument `10`.</span></span> <span data-ttu-id="d5000-441">Para obter mais informações sobre as restrições de rota e uma lista das restrições fornecidas pela estrutura, confira a seção [Referência de restrição de rota](#route-constraint-reference).</span><span class="sxs-lookup"><span data-stu-id="d5000-441">For more information on route constraints and a list of the constraints provided by the framework, see the [Route constraint reference](#route-constraint-reference) section.</span></span>

<span data-ttu-id="d5000-442">Os parâmetros de rota também podem ter transformadores de parâmetro.</span><span class="sxs-lookup"><span data-stu-id="d5000-442">Route parameters may also have parameter transformers.</span></span> <span data-ttu-id="d5000-443">Os transformadores de parâmetro convertem o valor de um parâmetro ao gerar links e ações correspondentes e páginas para URLs.</span><span class="sxs-lookup"><span data-stu-id="d5000-443">Parameter transformers transform a parameter's value when generating links and matching actions and pages to URLs.</span></span> <span data-ttu-id="d5000-444">Assim como as restrições, os transformadores de parâmetros podem ser adicionados embutidos a um `:` parâmetro de rota adicionando um nome de transformador e após o nome do parâmetro de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-444">Like constraints, parameter transformers can be added inline to a route parameter by adding a `:` and transformer name after the route parameter name.</span></span> <span data-ttu-id="d5000-445">Por exemplo, o modelo de rota `blog/{article:slugify}` especifica um transformador `slugify`.</span><span class="sxs-lookup"><span data-stu-id="d5000-445">For example, the route template `blog/{article:slugify}` specifies a `slugify` transformer.</span></span> <span data-ttu-id="d5000-446">Para obter mais informações sobre transformadores de parâmetro, confira a seção [Referência de transformador de parâmetro](#parameter-transformer-reference).</span><span class="sxs-lookup"><span data-stu-id="d5000-446">For more information on parameter transformers, see the [Parameter transformer reference](#parameter-transformer-reference) section.</span></span>

<span data-ttu-id="d5000-447">A tabela a seguir demonstra os modelos de rota de exemplo e seu comportamento:</span><span class="sxs-lookup"><span data-stu-id="d5000-447">The following table demonstrates example route templates and their behavior:</span></span>

| <span data-ttu-id="d5000-448">Modelo de rota</span><span class="sxs-lookup"><span data-stu-id="d5000-448">Route Template</span></span>                           | <span data-ttu-id="d5000-449">URI de correspondência de exemplo</span><span class="sxs-lookup"><span data-stu-id="d5000-449">Example Matching URI</span></span>    | <span data-ttu-id="d5000-450">O URI de solicitação&hellip;</span><span class="sxs-lookup"><span data-stu-id="d5000-450">The request URI&hellip;</span></span>                                                    |
| ---------------------------------------- | ----------------------- | -------------------------------------------------------------------------- |
| `hello`                                  | `/hello`                | <span data-ttu-id="d5000-451">Somente corresponde ao caminho único `/hello`.</span><span class="sxs-lookup"><span data-stu-id="d5000-451">Only matches the single path `/hello`.</span></span>                                     |
| `{Page=Home}`                            | `/`                     | <span data-ttu-id="d5000-452">Faz a correspondência e define `Page` como `Home`.</span><span class="sxs-lookup"><span data-stu-id="d5000-452">Matches and sets `Page` to `Home`.</span></span>                                         |
| `{Page=Home}`                            | `/Contact`              | <span data-ttu-id="d5000-453">Faz a correspondência e define `Page` como `Contact`.</span><span class="sxs-lookup"><span data-stu-id="d5000-453">Matches and sets `Page` to `Contact`.</span></span>                                      |
| `{controller}/{action}/{id?}`            | `/Products/List`        | <span data-ttu-id="d5000-454">É mapeado para o controlador `Products` e a ação `List`.</span><span class="sxs-lookup"><span data-stu-id="d5000-454">Maps to the `Products` controller and `List` action.</span></span>                       |
| `{controller}/{action}/{id?}`            | `/Products/Details/123` | <span data-ttu-id="d5000-455">Mapeia para o `Products` controlador e `Details` a ação`id` com definido como 123.</span><span class="sxs-lookup"><span data-stu-id="d5000-455">Maps to the `Products` controller and  `Details` action with`id` set to 123.</span></span> |
| `{controller=Home}/{action=Index}/{id?}` | `/`                     | <span data-ttu-id="d5000-456">Mapeia para o `Home` controlador e `Index` o método.</span><span class="sxs-lookup"><span data-stu-id="d5000-456">Maps to the `Home` controller and `Index` method.</span></span> <span data-ttu-id="d5000-457">`id` é ignorado.</span><span class="sxs-lookup"><span data-stu-id="d5000-457">`id` is ignored.</span></span>        |
| `{controller=Home}/{action=Index}/{id?}` | `/Products`         | <span data-ttu-id="d5000-458">Mapeia para o `Products` controlador e `Index` o método.</span><span class="sxs-lookup"><span data-stu-id="d5000-458">Maps to the `Products` controller and `Index` method.</span></span> <span data-ttu-id="d5000-459">`id` é ignorado.</span><span class="sxs-lookup"><span data-stu-id="d5000-459">`id` is ignored.</span></span>        |

<span data-ttu-id="d5000-460">Em geral, o uso de um modelo é a abordagem mais simples para o roteamento.</span><span class="sxs-lookup"><span data-stu-id="d5000-460">Using a template is generally the simplest approach to routing.</span></span> <span data-ttu-id="d5000-461">Restrições e padrões também podem ser especificados fora do modelo de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-461">Constraints and defaults can also be specified outside the route template.</span></span>

### <a name="complex-segments"></a><span data-ttu-id="d5000-462">Segmentos complexos</span><span class="sxs-lookup"><span data-stu-id="d5000-462">Complex segments</span></span>

<span data-ttu-id="d5000-463">Segmentos complexos são processados por correspondência de delimitadores literais da direita para a esquerda de forma [não-](#greedy) adequada.</span><span class="sxs-lookup"><span data-stu-id="d5000-463">Complex segments are processed by matching up literal delimiters from right to left in a [non-greedy](#greedy) way.</span></span> <span data-ttu-id="d5000-464">Por exemplo, `[Route("/a{b}c{d}")]` é um segmento complexo.</span><span class="sxs-lookup"><span data-stu-id="d5000-464">For example, `[Route("/a{b}c{d}")]` is a complex segment.</span></span>
<span data-ttu-id="d5000-465">Segmentos complexos funcionam de uma maneira específica que devem ser compreendidos para usá-los com êxito.</span><span class="sxs-lookup"><span data-stu-id="d5000-465">Complex segments work in a particular way that must be understood to use them successfully.</span></span> <span data-ttu-id="d5000-466">O exemplo nesta seção demonstra por que os segmentos complexos só realmente funcionam bem quando o texto delimitador não aparece dentro dos valores de parâmetro.</span><span class="sxs-lookup"><span data-stu-id="d5000-466">The example in this section demonstrates why complex segments only really work well when the delimiter text doesn't appear inside the parameter values.</span></span> <span data-ttu-id="d5000-467">Usar um [Regex](/dotnet/standard/base-types/regular-expressions) e, em seguida, extrair manualmente os valores é necessário para casos mais complexos.</span><span class="sxs-lookup"><span data-stu-id="d5000-467">Using a [regex](/dotnet/standard/base-types/regular-expressions) and then manually extracting the values is needed for more complex cases.</span></span>

[!INCLUDE[](~/includes/regex.md)]

<span data-ttu-id="d5000-468">Este é um resumo das etapas que o roteamento executa com o modelo `/a{b}c{d}` e o caminho `/abcd`da URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-468">This is a summary of the steps that routing performs with the template `/a{b}c{d}` and the URL path `/abcd`.</span></span> <span data-ttu-id="d5000-469">O `|` é usado para ajudar a visualizar como o algoritmo funciona:</span><span class="sxs-lookup"><span data-stu-id="d5000-469">The `|` is used to help visualize how the algorithm works:</span></span>

* <span data-ttu-id="d5000-470">O primeiro literal, da direita para a esquerda `c`, é.</span><span class="sxs-lookup"><span data-stu-id="d5000-470">The first literal, right to left, is `c`.</span></span> <span data-ttu-id="d5000-471">Então `/abcd` , é pesquisado da direita `/ab|c|d`e encontra.</span><span class="sxs-lookup"><span data-stu-id="d5000-471">So `/abcd` is searched from right and finds `/ab|c|d`.</span></span>
* <span data-ttu-id="d5000-472">Tudo para a direita (`d`) agora é correspondido ao parâmetro `{d}`de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-472">Everything to the right (`d`) is now matched to the route parameter `{d}`.</span></span>
* <span data-ttu-id="d5000-473">O próximo literal, da direita para a esquerda `a`, é.</span><span class="sxs-lookup"><span data-stu-id="d5000-473">The next literal, right to left, is `a`.</span></span> <span data-ttu-id="d5000-474">Então `/ab|c|d` , é pesquisada a partir de onde parou `a` e, `/|a|b|c|d`em seguida, é encontrada.</span><span class="sxs-lookup"><span data-stu-id="d5000-474">So `/ab|c|d` is searched starting where we left off, then `a` is found `/|a|b|c|d`.</span></span>
* <span data-ttu-id="d5000-475">O valor à direita (`b`) agora é correspondido ao parâmetro `{b}`de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-475">The value to the right (`b`) is now matched to the route parameter `{b}`.</span></span>
* <span data-ttu-id="d5000-476">Não há nenhum texto restante e nenhum modelo de rota restante, portanto, essa é uma correspondência.</span><span class="sxs-lookup"><span data-stu-id="d5000-476">There is no remaining text and no remaining route template, so this is a match.</span></span>

<span data-ttu-id="d5000-477">Aqui está um exemplo de um caso negativo usando o mesmo modelo `/a{b}c{d}` e o caminho `/aabcd`da URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-477">Here's an example of a negative case using the same template `/a{b}c{d}` and the URL path `/aabcd`.</span></span> <span data-ttu-id="d5000-478">O `|` é usado para ajudar a visualizar como o algoritmo funciona.</span><span class="sxs-lookup"><span data-stu-id="d5000-478">The `|` is used to help visualize how the algorithm works.</span></span> <span data-ttu-id="d5000-479">Esse caso não é uma correspondência, que é explicada pelo mesmo algoritmo:</span><span class="sxs-lookup"><span data-stu-id="d5000-479">This case isn't a match, which is explained by the same algorithm:</span></span>
* <span data-ttu-id="d5000-480">O primeiro literal, da direita para a esquerda `c`, é.</span><span class="sxs-lookup"><span data-stu-id="d5000-480">The first literal, right to left, is `c`.</span></span> <span data-ttu-id="d5000-481">Então `/aabcd` , é pesquisado da direita `/aab|c|d`e encontra.</span><span class="sxs-lookup"><span data-stu-id="d5000-481">So `/aabcd` is searched from right and finds `/aab|c|d`.</span></span>
* <span data-ttu-id="d5000-482">Tudo para a direita (`d`) agora é correspondido ao parâmetro `{d}`de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-482">Everything to the right (`d`) is now matched to the route parameter `{d}`.</span></span>
* <span data-ttu-id="d5000-483">O próximo literal, da direita para a esquerda `a`, é.</span><span class="sxs-lookup"><span data-stu-id="d5000-483">The next literal, right to left, is `a`.</span></span> <span data-ttu-id="d5000-484">Então `/aab|c|d` , é pesquisada a partir de onde parou `a` e, `/a|a|b|c|d`em seguida, é encontrada.</span><span class="sxs-lookup"><span data-stu-id="d5000-484">So `/aab|c|d` is searched starting where we left off, then `a` is found `/a|a|b|c|d`.</span></span>
* <span data-ttu-id="d5000-485">O valor à direita (`b`) agora é correspondido ao parâmetro `{b}`de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-485">The value to the right (`b`) is now matched to the route parameter `{b}`.</span></span>
* <span data-ttu-id="d5000-486">Neste ponto, há um texto `a`restante, mas o algoritmo ficou sem o modelo de rota para analisar, portanto, isso não é uma correspondência.</span><span class="sxs-lookup"><span data-stu-id="d5000-486">At this point there is remaining text `a`, but the algorithm has run out of route template to parse, so this is not a match.</span></span>

<span data-ttu-id="d5000-487">Como o algoritmo de correspondência [não é ávido](#greedy):</span><span class="sxs-lookup"><span data-stu-id="d5000-487">Since the matching algorithm is [non-greedy](#greedy):</span></span>

* <span data-ttu-id="d5000-488">Ele corresponde à menor quantidade de texto possível em cada etapa.</span><span class="sxs-lookup"><span data-stu-id="d5000-488">It matches the smallest amount of text possible in each step.</span></span>
* <span data-ttu-id="d5000-489">Qualquer caso em que o valor do delimitador aparece dentro dos valores de parâmetro resulta em não correspondente.</span><span class="sxs-lookup"><span data-stu-id="d5000-489">Any case where the delimiter value appears inside the parameter values results in not matching.</span></span>

<span data-ttu-id="d5000-490">As expressões regulares fornecem muito mais controle sobre o comportamento correspondente.</span><span class="sxs-lookup"><span data-stu-id="d5000-490">Regular expressions provide much more control over their matching behavior.</span></span>

<a name="greedy"></a>

<span data-ttu-id="d5000-491">A correspondência de ávido, também conhecida como [correspondência lenta](https://wikipedia.org/wiki/Regular_expression#Lazy_matching), corresponde à maior cadeia de caracteres possível.</span><span class="sxs-lookup"><span data-stu-id="d5000-491">Greedy matching, also know as [lazy matching](https://wikipedia.org/wiki/Regular_expression#Lazy_matching), matches the largest possible string.</span></span> <span data-ttu-id="d5000-492">Non-ávido corresponde à menor Cadeia de caracteres possível.</span><span class="sxs-lookup"><span data-stu-id="d5000-492">Non-greedy matches the smallest possible string.</span></span>

## <a name="route-constraint-reference"></a><span data-ttu-id="d5000-493">Referência de restrição de rota</span><span class="sxs-lookup"><span data-stu-id="d5000-493">Route constraint reference</span></span>

<span data-ttu-id="d5000-494">As restrições de rota são executadas quando ocorre uma correspondência com a URL de entrada e é criado um token do caminho da URL em valores de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-494">Route constraints execute when a match has occurred to the incoming URL and the URL path is tokenized into route values.</span></span> <span data-ttu-id="d5000-495">Restrições de rota geralmente inspecionam o valor de rota associado por meio do modelo de rota e fazem uma decisão verdadeira ou falsa sobre se o valor é aceitável.</span><span class="sxs-lookup"><span data-stu-id="d5000-495">Route constraints generally inspect the route value associated via the route template and make a true or false decision about whether the value is acceptable.</span></span> <span data-ttu-id="d5000-496">Algumas restrições da rota usam dados fora do valor de rota para considerar se a solicitação pode ser encaminhada.</span><span class="sxs-lookup"><span data-stu-id="d5000-496">Some route constraints use data outside the route value to consider whether the request can be routed.</span></span> <span data-ttu-id="d5000-497">Por exemplo, a <xref:Microsoft.AspNetCore.Routing.Constraints.HttpMethodRouteConstraint> pode aceitar ou rejeitar uma solicitação de acordo com o verbo HTTP.</span><span class="sxs-lookup"><span data-stu-id="d5000-497">For example, the <xref:Microsoft.AspNetCore.Routing.Constraints.HttpMethodRouteConstraint> can accept or reject a request based on its HTTP verb.</span></span> <span data-ttu-id="d5000-498">As restrições são usadas em solicitações de roteamento e na geração de link.</span><span class="sxs-lookup"><span data-stu-id="d5000-498">Constraints are used in routing requests and link generation.</span></span>

> [!WARNING]
> <span data-ttu-id="d5000-499">Não use restrições para a validação de entrada.</span><span class="sxs-lookup"><span data-stu-id="d5000-499">Don't use constraints for input validation.</span></span> <span data-ttu-id="d5000-500">Se as restrições forem usadas para validação de entrada, a entrada inválida resultará em uma `404` resposta não encontrada.</span><span class="sxs-lookup"><span data-stu-id="d5000-500">If constraints are used for input validation, invalid input results in a `404` Not Found response.</span></span> <span data-ttu-id="d5000-501">A entrada inválida deve `400` produzir uma solicitação incorreta com uma mensagem de erro apropriada.</span><span class="sxs-lookup"><span data-stu-id="d5000-501">Invalid input should produce a `400` Bad Request with an appropriate error message.</span></span> <span data-ttu-id="d5000-502">As restrições de rota são usadas para desfazer a ambiguidade entre rotas semelhantes, não para validar as entradas de uma rota específica.</span><span class="sxs-lookup"><span data-stu-id="d5000-502">Route constraints are used to disambiguate similar routes, not to validate the inputs for a particular route.</span></span>

<span data-ttu-id="d5000-503">A tabela a seguir demonstra as restrições de rota de exemplo e seu comportamento esperado:</span><span class="sxs-lookup"><span data-stu-id="d5000-503">The following table demonstrates example route constraints and their expected behavior:</span></span>

| <span data-ttu-id="d5000-504">restrição</span><span class="sxs-lookup"><span data-stu-id="d5000-504">constraint</span></span> | <span data-ttu-id="d5000-505">Exemplo</span><span class="sxs-lookup"><span data-stu-id="d5000-505">Example</span></span> | <span data-ttu-id="d5000-506">Correspondências de exemplo</span><span class="sxs-lookup"><span data-stu-id="d5000-506">Example Matches</span></span> | <span data-ttu-id="d5000-507">Anotações</span><span class="sxs-lookup"><span data-stu-id="d5000-507">Notes</span></span> |
| ---------- | ------- | --------------- | ----- |
| `int` | `{id:int}` | <span data-ttu-id="d5000-508">`123456789`, `-123456789`</span><span class="sxs-lookup"><span data-stu-id="d5000-508">`123456789`, `-123456789`</span></span> | <span data-ttu-id="d5000-509">Corresponde a qualquer inteiro</span><span class="sxs-lookup"><span data-stu-id="d5000-509">Matches any integer</span></span> |
| `bool` | `{active:bool}` | <span data-ttu-id="d5000-510">`true`, `FALSE`</span><span class="sxs-lookup"><span data-stu-id="d5000-510">`true`, `FALSE`</span></span> | <span data-ttu-id="d5000-511">Corresponde `true` a `false`ou.</span><span class="sxs-lookup"><span data-stu-id="d5000-511">Matches `true` or `false`.</span></span> <span data-ttu-id="d5000-512">Não diferenciam maiúsculas de minúsculas</span><span class="sxs-lookup"><span data-stu-id="d5000-512">Case-insensitive</span></span> |
| `datetime` | `{dob:datetime}` | <span data-ttu-id="d5000-513">`2016-12-31`, `2016-12-31 7:32pm`</span><span class="sxs-lookup"><span data-stu-id="d5000-513">`2016-12-31`, `2016-12-31 7:32pm`</span></span> | <span data-ttu-id="d5000-514">Corresponde a um `DateTime` valor válido na cultura invariável.</span><span class="sxs-lookup"><span data-stu-id="d5000-514">Matches a valid `DateTime` value in the invariant culture.</span></span> <span data-ttu-id="d5000-515">Consulte o aviso anterior.</span><span class="sxs-lookup"><span data-stu-id="d5000-515">See preceding warning.</span></span> |
| `decimal` | `{price:decimal}` | <span data-ttu-id="d5000-516">`49.99`, `-1,000.01`</span><span class="sxs-lookup"><span data-stu-id="d5000-516">`49.99`, `-1,000.01`</span></span> | <span data-ttu-id="d5000-517">Corresponde a um `decimal` valor válido na cultura invariável.</span><span class="sxs-lookup"><span data-stu-id="d5000-517">Matches a valid `decimal` value in the invariant culture.</span></span> <span data-ttu-id="d5000-518">Consulte o aviso anterior.</span><span class="sxs-lookup"><span data-stu-id="d5000-518">See preceding warning.</span></span>|
| `double` | `{weight:double}` | <span data-ttu-id="d5000-519">`1.234`, `-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="d5000-519">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="d5000-520">Corresponde a um `double` valor válido na cultura invariável.</span><span class="sxs-lookup"><span data-stu-id="d5000-520">Matches a valid `double` value in the invariant culture.</span></span> <span data-ttu-id="d5000-521">Consulte o aviso anterior.</span><span class="sxs-lookup"><span data-stu-id="d5000-521">See preceding warning.</span></span>|
| `float` | `{weight:float}` | <span data-ttu-id="d5000-522">`1.234`, `-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="d5000-522">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="d5000-523">Corresponde a um `float` valor válido na cultura invariável.</span><span class="sxs-lookup"><span data-stu-id="d5000-523">Matches a valid `float` value in the invariant culture.</span></span> <span data-ttu-id="d5000-524">Consulte o aviso anterior.</span><span class="sxs-lookup"><span data-stu-id="d5000-524">See preceding warning.</span></span>|
| `guid` | `{id:guid}` | `CD2C1638-1638-72D5-1638-DEADBEEF1638` | <span data-ttu-id="d5000-525">Corresponde a um valor `Guid` válido</span><span class="sxs-lookup"><span data-stu-id="d5000-525">Matches a valid `Guid` value</span></span> |
| `long` | `{ticks:long}` | <span data-ttu-id="d5000-526">`123456789`, `-123456789`</span><span class="sxs-lookup"><span data-stu-id="d5000-526">`123456789`, `-123456789`</span></span> | <span data-ttu-id="d5000-527">Corresponde a um valor `long` válido</span><span class="sxs-lookup"><span data-stu-id="d5000-527">Matches a valid `long` value</span></span> |
| `minlength(value)` | `{username:minlength(4)}` | `Rick` | <span data-ttu-id="d5000-528">A cadeia de caracteres deve ter, no mínimo, 4 caracteres</span><span class="sxs-lookup"><span data-stu-id="d5000-528">String must be at least 4 characters</span></span> |
| `maxlength(value)` | `{filename:maxlength(8)}` | `MyFile` | <span data-ttu-id="d5000-529">A cadeia de caracteres não pode ser maior que 8 caracteres</span><span class="sxs-lookup"><span data-stu-id="d5000-529">String must be no more than 8 characters</span></span> |
| `length(length)` | `{filename:length(12)}` | `somefile.txt` | <span data-ttu-id="d5000-530">A cadeia de caracteres deve ter exatamente 12 caracteres</span><span class="sxs-lookup"><span data-stu-id="d5000-530">String must be exactly 12 characters long</span></span> |
| `length(min,max)` | `{filename:length(8,16)}` | `somefile.txt` | <span data-ttu-id="d5000-531">A cadeia de caracteres deve ter, pelo menos, 8 e não mais de 16 caracteres</span><span class="sxs-lookup"><span data-stu-id="d5000-531">String must be at least 8 and no more than 16 characters long</span></span> |
| `min(value)` | `{age:min(18)}` | `19` | <span data-ttu-id="d5000-532">O valor inteiro deve ser, pelo menos, 18</span><span class="sxs-lookup"><span data-stu-id="d5000-532">Integer value must be at least 18</span></span> |
| `max(value)` | `{age:max(120)}` | `91` | <span data-ttu-id="d5000-533">O valor inteiro não deve ser maior que 120</span><span class="sxs-lookup"><span data-stu-id="d5000-533">Integer value must be no more than 120</span></span> |
| `range(min,max)` | `{age:range(18,120)}` | `91` | <span data-ttu-id="d5000-534">O valor inteiro deve ser, pelo menos, 18, mas não maior que 120</span><span class="sxs-lookup"><span data-stu-id="d5000-534">Integer value must be at least 18 but no more than 120</span></span> |
| `alpha` | `{name:alpha}` | `Rick` | <span data-ttu-id="d5000-535">A cadeia de caracteres deve consistir em um ou mais `a` - `z` caracteres alfabéticos e não diferencia maiúsculas de minúsculas.</span><span class="sxs-lookup"><span data-stu-id="d5000-535">String must consist of one or more alphabetical characters, `a`-`z` and case-insensitive.</span></span> |
| `regex(expression)` | `{ssn:regex(^\\d{{3}}-\\d{{2}}-\\d{{4}}$)}` | `123-45-6789` | <span data-ttu-id="d5000-536">A cadeia de caracteres deve corresponder à expressão regular.</span><span class="sxs-lookup"><span data-stu-id="d5000-536">String must match the regular expression.</span></span> <span data-ttu-id="d5000-537">Confira dicas sobre como definir uma expressão regular.</span><span class="sxs-lookup"><span data-stu-id="d5000-537">See tips about defining a regular expression.</span></span> |
| `required` | `{name:required}` | `Rick` | <span data-ttu-id="d5000-538">Usado para impor que um valor não parâmetro está presente durante a geração de URL</span><span class="sxs-lookup"><span data-stu-id="d5000-538">Used to enforce that a non-parameter value is present during URL generation</span></span> |

[!INCLUDE[](~/includes/regex.md)]

<span data-ttu-id="d5000-539">Várias restrições delimitadas por dois-pontos podem ser aplicadas a um único parâmetro.</span><span class="sxs-lookup"><span data-stu-id="d5000-539">Multiple, colon delimited constraints can be applied to a single parameter.</span></span> <span data-ttu-id="d5000-540">Por exemplo, a restrição a seguir restringe um parâmetro para um valor inteiro de 1 ou maior:</span><span class="sxs-lookup"><span data-stu-id="d5000-540">For example, the following constraint restricts a parameter to an integer value of 1 or greater:</span></span>

```csharp
[Route("users/{id:int:min(1)}")]
public User GetUserById(int id) { }
```

> [!WARNING]
> <span data-ttu-id="d5000-541">As restrições de rota que verificam a URL e são convertidas em um tipo CLR sempre usam a cultura invariável.</span><span class="sxs-lookup"><span data-stu-id="d5000-541">Route constraints that verify the URL and are converted to a CLR type always use the invariant culture.</span></span> <span data-ttu-id="d5000-542">Por exemplo, conversão para o tipo `int` CLR ou `DateTime`.</span><span class="sxs-lookup"><span data-stu-id="d5000-542">For example, conversion to the CLR type `int` or `DateTime`.</span></span> <span data-ttu-id="d5000-543">Essas restrições pressupõem que a URL não é localizável.</span><span class="sxs-lookup"><span data-stu-id="d5000-543">These constraints assume that the URL is not localizable.</span></span> <span data-ttu-id="d5000-544">As restrições de rota fornecidas pela estrutura não modificam os valores armazenados nos valores de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-544">The framework-provided route constraints don't modify the values stored in route values.</span></span> <span data-ttu-id="d5000-545">Todos os valores de rota analisados com base na URL são armazenados como cadeias de caracteres.</span><span class="sxs-lookup"><span data-stu-id="d5000-545">All route values parsed from the URL are stored as strings.</span></span> <span data-ttu-id="d5000-546">Por exemplo, a restrição `float` tenta converter o valor de rota em um float, mas o valor convertido é usado somente para verificar se ele pode ser convertido em um float.</span><span class="sxs-lookup"><span data-stu-id="d5000-546">For example, the `float` constraint attempts to convert the route value to a float, but the converted value is used only to verify it can be converted to a float.</span></span>

### <a name="regular-expressions-in-constraints"></a><span data-ttu-id="d5000-547">Expressões regulares em restrições</span><span class="sxs-lookup"><span data-stu-id="d5000-547">Regular expressions in constraints</span></span>

[!INCLUDE[](~/includes/regex.md)]

<span data-ttu-id="d5000-548">As expressões regulares podem ser especificadas como restrições embutidas `regex(...)` usando a restrição de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-548">Regular expressions can be specified as inline constraints using the `regex(...)` route constraint.</span></span> <span data-ttu-id="d5000-549">Os <xref:Microsoft.AspNetCore.Builder.ControllerEndpointRouteBuilderExtensions.MapControllerRoute*> métodos na família também aceitam um literal de objeto de restrições.</span><span class="sxs-lookup"><span data-stu-id="d5000-549">Methods in the <xref:Microsoft.AspNetCore.Builder.ControllerEndpointRouteBuilderExtensions.MapControllerRoute*> family also accept an object literal of constraints.</span></span> <span data-ttu-id="d5000-550">Se esse formulário for usado, os valores de cadeia de caracteres serão interpretados como expressões regulares.</span><span class="sxs-lookup"><span data-stu-id="d5000-550">If that form is used, string values are interpreted as regular expressions.</span></span>

<span data-ttu-id="d5000-551">O código a seguir usa uma restrição Regex embutida:</span><span class="sxs-lookup"><span data-stu-id="d5000-551">The following code uses an inline regex constraint:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/StartupRegex.cs?name=snippet)]

<span data-ttu-id="d5000-552">O código a seguir usa um literal de objeto para especificar uma restrição Regex:</span><span class="sxs-lookup"><span data-stu-id="d5000-552">The following code uses an object literal to specify a regex constraint:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/StartupRegex2.cs?name=snippet)]

<span data-ttu-id="d5000-553">A estrutura do ASP.NET Core adiciona `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant` ao construtor de expressão regular.</span><span class="sxs-lookup"><span data-stu-id="d5000-553">The ASP.NET Core framework adds `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant` to the regular expression constructor.</span></span> <span data-ttu-id="d5000-554">Confira <xref:System.Text.RegularExpressions.RegexOptions> para obter uma descrição desses membros.</span><span class="sxs-lookup"><span data-stu-id="d5000-554">See <xref:System.Text.RegularExpressions.RegexOptions> for a description of these members.</span></span>

<span data-ttu-id="d5000-555">As expressões regulares usam delimitadores e tokens semelhantes aos usados pelo roteamento e pela linguagem C#.</span><span class="sxs-lookup"><span data-stu-id="d5000-555">Regular expressions use delimiters and tokens similar to those used by routing and the C# language.</span></span> <span data-ttu-id="d5000-556">Os tokens de expressão regular precisam ter escape.</span><span class="sxs-lookup"><span data-stu-id="d5000-556">Regular expression tokens must be escaped.</span></span> <span data-ttu-id="d5000-557">Para usar a expressão `^\d{3}-\d{2}-\d{4}$` regular em uma restrição embutida, use um dos seguintes:</span><span class="sxs-lookup"><span data-stu-id="d5000-557">To use the regular expression `^\d{3}-\d{2}-\d{4}$` in an inline constraint, use one of the following:</span></span>

* <span data-ttu-id="d5000-558">Substitua `\` os caracteres fornecidos na String como `\\` caracteres no arquivo de origem C# para escapar o caractere de `\` escape da cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="d5000-558">Replace `\` characters provided in the string as `\\` characters in the C# source file in order to escape the `\` string escape character.</span></span>
* <span data-ttu-id="d5000-559">[Literais de cadeia de caracteres textuais](/dotnet/csharp/language-reference/keywords/string).</span><span class="sxs-lookup"><span data-stu-id="d5000-559">[Verbatim string literals](/dotnet/csharp/language-reference/keywords/string).</span></span>

<span data-ttu-id="d5000-560">Para escapar os caracteres `{`delimitadores `}`de `[`parâmetro `]`de roteamento,,,, Double os caracteres na expressão `{{`, `}}`por `[[`exemplo `]]`,,,,.</span><span class="sxs-lookup"><span data-stu-id="d5000-560">To escape routing parameter delimiter characters `{`, `}`, `[`, `]`, double the characters in the expression, for example, `{{`, `}}`, `[[`, `]]`.</span></span> <span data-ttu-id="d5000-561">A tabela a seguir mostra uma expressão regular e sua versão de escape:</span><span class="sxs-lookup"><span data-stu-id="d5000-561">The following table shows a regular expression and its escaped version:</span></span>

| <span data-ttu-id="d5000-562">Expressão regular</span><span class="sxs-lookup"><span data-stu-id="d5000-562">Regular expression</span></span>    | <span data-ttu-id="d5000-563">Expressão regular com escape</span><span class="sxs-lookup"><span data-stu-id="d5000-563">Escaped regular expression</span></span>     |
| --------------------- | ------------------------------ |
| `^\d{3}-\d{2}-\d{4}$` | `^\\d{{3}}-\\d{{2}}-\\d{{4}}$` |
| `^[a-z]{2}$`          | `^[[a-z]]{{2}}$`               |

<span data-ttu-id="d5000-564">As expressões regulares usadas no roteamento geralmente começam com `^` o caractere e correspondem à posição inicial da cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="d5000-564">Regular expressions used in routing often start with the `^` character and match the starting position of the string.</span></span> <span data-ttu-id="d5000-565">As expressões geralmente terminam com `$` o caractere e correspondem ao final da cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="d5000-565">The expressions often end with the `$` character and match the end of the string.</span></span> <span data-ttu-id="d5000-566">Os `^` caracteres `$` e garantem que a expressão regular corresponda ao valor do parâmetro de rota inteiro.</span><span class="sxs-lookup"><span data-stu-id="d5000-566">The `^` and `$` characters ensure that the regular expression matches the entire route parameter value.</span></span> <span data-ttu-id="d5000-567">Sem os `^` caracteres `$` e, a expressão regular corresponde a qualquer subcadeia de caracteres dentro da cadeia de caracteres, o que geralmente é indesejável.</span><span class="sxs-lookup"><span data-stu-id="d5000-567">Without the `^` and `$` characters, the regular expression matches any substring within the string, which is often undesirable.</span></span> <span data-ttu-id="d5000-568">A tabela a seguir fornece exemplos e explica por que eles correspondem ou falham na correspondência:</span><span class="sxs-lookup"><span data-stu-id="d5000-568">The following table provides examples and explains why they match or fail to match:</span></span>

| <span data-ttu-id="d5000-569">Expression</span><span class="sxs-lookup"><span data-stu-id="d5000-569">Expression</span></span>   | <span data-ttu-id="d5000-570">Cadeia de caracteres</span><span class="sxs-lookup"><span data-stu-id="d5000-570">String</span></span>    | <span data-ttu-id="d5000-571">Correspondência</span><span class="sxs-lookup"><span data-stu-id="d5000-571">Match</span></span> | <span data-ttu-id="d5000-572">Comentário</span><span class="sxs-lookup"><span data-stu-id="d5000-572">Comment</span></span>               |
| ------------ | --------- | :---: |  -------------------- |
| `[a-z]{2}`   | <span data-ttu-id="d5000-573">hello</span><span class="sxs-lookup"><span data-stu-id="d5000-573">hello</span></span>     | <span data-ttu-id="d5000-574">Sim</span><span class="sxs-lookup"><span data-stu-id="d5000-574">Yes</span></span>   | <span data-ttu-id="d5000-575">A subcadeia de caracteres corresponde</span><span class="sxs-lookup"><span data-stu-id="d5000-575">Substring matches</span></span>     |
| `[a-z]{2}`   | <span data-ttu-id="d5000-576">123abc456</span><span class="sxs-lookup"><span data-stu-id="d5000-576">123abc456</span></span> | <span data-ttu-id="d5000-577">Sim</span><span class="sxs-lookup"><span data-stu-id="d5000-577">Yes</span></span>   | <span data-ttu-id="d5000-578">A subcadeia de caracteres corresponde</span><span class="sxs-lookup"><span data-stu-id="d5000-578">Substring matches</span></span>     |
| `[a-z]{2}`   | <span data-ttu-id="d5000-579">mz</span><span class="sxs-lookup"><span data-stu-id="d5000-579">mz</span></span>        | <span data-ttu-id="d5000-580">Sim</span><span class="sxs-lookup"><span data-stu-id="d5000-580">Yes</span></span>   | <span data-ttu-id="d5000-581">Corresponde à expressão</span><span class="sxs-lookup"><span data-stu-id="d5000-581">Matches expression</span></span>    |
| `[a-z]{2}`   | <span data-ttu-id="d5000-582">MZ</span><span class="sxs-lookup"><span data-stu-id="d5000-582">MZ</span></span>        | <span data-ttu-id="d5000-583">Sim</span><span class="sxs-lookup"><span data-stu-id="d5000-583">Yes</span></span>   | <span data-ttu-id="d5000-584">Não diferencia maiúsculas de minúsculas</span><span class="sxs-lookup"><span data-stu-id="d5000-584">Not case sensitive</span></span>    |
| `^[a-z]{2}$` | <span data-ttu-id="d5000-585">hello</span><span class="sxs-lookup"><span data-stu-id="d5000-585">hello</span></span>     | <span data-ttu-id="d5000-586">Não</span><span class="sxs-lookup"><span data-stu-id="d5000-586">No</span></span>    | <span data-ttu-id="d5000-587">Confira `^` e `$` acima</span><span class="sxs-lookup"><span data-stu-id="d5000-587">See `^` and `$` above</span></span> |
| `^[a-z]{2}$` | <span data-ttu-id="d5000-588">123abc456</span><span class="sxs-lookup"><span data-stu-id="d5000-588">123abc456</span></span> | <span data-ttu-id="d5000-589">Não</span><span class="sxs-lookup"><span data-stu-id="d5000-589">No</span></span>    | <span data-ttu-id="d5000-590">Confira `^` e `$` acima</span><span class="sxs-lookup"><span data-stu-id="d5000-590">See `^` and `$` above</span></span> |

<span data-ttu-id="d5000-591">Para saber mais sobre a sintaxe de expressões regulares, confira [Expressões regulares do .NET Framework](/dotnet/standard/base-types/regular-expression-language-quick-reference).</span><span class="sxs-lookup"><span data-stu-id="d5000-591">For more information on regular expression syntax, see [.NET Framework Regular Expressions](/dotnet/standard/base-types/regular-expression-language-quick-reference).</span></span>

<span data-ttu-id="d5000-592">Para restringir um parâmetro a um conjunto conhecido de valores possíveis, use uma expressão regular.</span><span class="sxs-lookup"><span data-stu-id="d5000-592">To constrain a parameter to a known set of possible values, use a regular expression.</span></span> <span data-ttu-id="d5000-593">Por exemplo, `{action:regex(^(list|get|create)$)}` apenas corresponde o valor da rota `action` a `list`, `get` ou `create`.</span><span class="sxs-lookup"><span data-stu-id="d5000-593">For example, `{action:regex(^(list|get|create)$)}` only matches the `action` route value to `list`, `get`, or `create`.</span></span> <span data-ttu-id="d5000-594">Se passada para o dicionário de restrições, a cadeia de caracteres `^(list|get|create)$` é equivalente.</span><span class="sxs-lookup"><span data-stu-id="d5000-594">If passed into the constraints dictionary, the string `^(list|get|create)$` is equivalent.</span></span> <span data-ttu-id="d5000-595">As restrições que são passadas no dicionário de restrições que não correspondem a uma das restrições conhecidas também são tratadas como expressões regulares.</span><span class="sxs-lookup"><span data-stu-id="d5000-595">Constraints that are passed in the constraints dictionary that don't match one of the known constraints are also treated as regular expressions.</span></span> <span data-ttu-id="d5000-596">As restrições que são passadas dentro de um modelo que não correspondem a uma das restrições conhecidas não são tratadas como expressões regulares.</span><span class="sxs-lookup"><span data-stu-id="d5000-596">Constraints that are passed  within a template that don't match one of the known constraints are not treated as regular expressions.</span></span>

### <a name="custom-route-constraints"></a><span data-ttu-id="d5000-597">Restrições de rotas personalizadas</span><span class="sxs-lookup"><span data-stu-id="d5000-597">Custom route constraints</span></span>

<span data-ttu-id="d5000-598">Restrições de rotas personalizadas podem ser criadas com a <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> implementação da interface.</span><span class="sxs-lookup"><span data-stu-id="d5000-598">Custom route constraints can be created by implementing the <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> interface.</span></span> <span data-ttu-id="d5000-599">A `IRouteConstraint` interface contém <xref:System.Web.Routing.IRouteConstraint.Match*>, que retorna `true` se a restrição é satisfeita e `false` , caso contrário,.</span><span class="sxs-lookup"><span data-stu-id="d5000-599">The `IRouteConstraint` interface contains <xref:System.Web.Routing.IRouteConstraint.Match*>, which returns `true` if the constraint is satisfied and `false` otherwise.</span></span>

<span data-ttu-id="d5000-600">As restrições de rotas personalizadas raramente são necessárias.</span><span class="sxs-lookup"><span data-stu-id="d5000-600">Custom route constraints are rarely needed.</span></span> <span data-ttu-id="d5000-601">Antes de implementar uma restrição de rota personalizada, considere alternativas, como associação de modelo.</span><span class="sxs-lookup"><span data-stu-id="d5000-601">Before implementing a custom route constraint, consider alternatives, such as model binding.</span></span>

<span data-ttu-id="d5000-602">A pasta [restrições](https://github.com/dotnet/aspnetcore/tree/master/src/Http/Routing/src/Constraints) de ASP.NET Core fornece bons exemplos de criação de restrições.</span><span class="sxs-lookup"><span data-stu-id="d5000-602">The ASP.NET Core [Constraints](https://github.com/dotnet/aspnetcore/tree/master/src/Http/Routing/src/Constraints) folder provides good examples of creating a constraints.</span></span> <span data-ttu-id="d5000-603">Por exemplo, [GuidRouteConstraint](https://github.com/dotnet/aspnetcore/blob/master/src/Http/Routing/src/Constraints/GuidRouteConstraint.cs#L18).</span><span class="sxs-lookup"><span data-stu-id="d5000-603">For example, [GuidRouteConstraint](https://github.com/dotnet/aspnetcore/blob/master/src/Http/Routing/src/Constraints/GuidRouteConstraint.cs#L18).</span></span>

<span data-ttu-id="d5000-604">Para usar um personalizado `IRouteConstraint`, o tipo de restrição de rota deve ser registrado com o <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> aplicativo no contêiner de serviço.</span><span class="sxs-lookup"><span data-stu-id="d5000-604">To use a custom `IRouteConstraint`, the route constraint type must be registered with the app's <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> in the service container.</span></span> <span data-ttu-id="d5000-605">O `ConstraintMap` é um dicionário que mapeia as chaves de restrição de rota para implementações de `IRouteConstraint` que validam essas restrições.</span><span class="sxs-lookup"><span data-stu-id="d5000-605">A `ConstraintMap` is a dictionary that maps route constraint keys to `IRouteConstraint` implementations that validate those constraints.</span></span> <span data-ttu-id="d5000-606">É possível atualizar o `ConstraintMap` do aplicativo no `Startup.ConfigureServices` como parte de uma chamada [services.AddRouting](xref:Microsoft.Extensions.DependencyInjection.RoutingServiceCollectionExtensions.AddRouting*) ou configurando <xref:Microsoft.AspNetCore.Routing.RouteOptions> diretamente com `services.Configure<RouteOptions>`.</span><span class="sxs-lookup"><span data-stu-id="d5000-606">An app's `ConstraintMap` can be updated in `Startup.ConfigureServices` either as part of a [services.AddRouting](xref:Microsoft.Extensions.DependencyInjection.RoutingServiceCollectionExtensions.AddRouting*) call or by configuring <xref:Microsoft.AspNetCore.Routing.RouteOptions> directly with `services.Configure<RouteOptions>`.</span></span> <span data-ttu-id="d5000-607">Por exemplo: </span><span class="sxs-lookup"><span data-stu-id="d5000-607">For example:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/StartupConstraint.cs?name=snippet)]

<span data-ttu-id="d5000-608">A restrição anterior é aplicada no código a seguir:</span><span class="sxs-lookup"><span data-stu-id="d5000-608">The preceding constraint is applied in the following code:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/Controllers/TestController.cs?name=snippet&highlight=6,13)]

[!INCLUDE[](~/includes/MyDisplayRouteInfo.md)]

<span data-ttu-id="d5000-609">A implementação de `MyCustomConstraint` impede `0` a aplicação a um parâmetro de rota:</span><span class="sxs-lookup"><span data-stu-id="d5000-609">The implementation of `MyCustomConstraint` prevents `0` being applied to a route parameter:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/StartupConstraint.cs?name=snippet2)]

[!INCLUDE[](~/includes/regex.md)]

<span data-ttu-id="d5000-610">O código anterior:</span><span class="sxs-lookup"><span data-stu-id="d5000-610">The preceding code:</span></span>

* <span data-ttu-id="d5000-611">Impede `0` no `{id}` segmento da rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-611">Prevents `0` in the `{id}` segment of the route.</span></span>
* <span data-ttu-id="d5000-612">É mostrado para fornecer um exemplo básico de implementação de uma restrição personalizada.</span><span class="sxs-lookup"><span data-stu-id="d5000-612">Is shown to provide a basic example of implementing a custom constraint.</span></span> <span data-ttu-id="d5000-613">Ele não deve ser usado em um aplicativo de produção.</span><span class="sxs-lookup"><span data-stu-id="d5000-613">It should not be used in a production app.</span></span>

<span data-ttu-id="d5000-614">O código a seguir é uma abordagem melhor para impedir `id` que um `0` que contém um seja processado:</span><span class="sxs-lookup"><span data-stu-id="d5000-614">The following code is a better approach to preventing an `id` containing a `0` from being processed:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/Controllers/TestController.cs?name=snippet2)]

<span data-ttu-id="d5000-615">O código anterior tem as seguintes vantagens em relação `MyCustomConstraint` à abordagem:</span><span class="sxs-lookup"><span data-stu-id="d5000-615">The preceding code has the following advantages over the `MyCustomConstraint` approach:</span></span>

* <span data-ttu-id="d5000-616">Ele não requer uma restrição personalizada.</span><span class="sxs-lookup"><span data-stu-id="d5000-616">It doesn't require a custom constraint.</span></span>
* <span data-ttu-id="d5000-617">Ele retorna um erro mais descritivo quando o parâmetro de rota `0`inclui.</span><span class="sxs-lookup"><span data-stu-id="d5000-617">It returns a more descriptive error when the route parameter includes `0`.</span></span>

## <a name="parameter-transformer-reference"></a><span data-ttu-id="d5000-618">Referência de parâmetro de transformador</span><span class="sxs-lookup"><span data-stu-id="d5000-618">Parameter transformer reference</span></span>

<span data-ttu-id="d5000-619">Transformadores de parâmetro:</span><span class="sxs-lookup"><span data-stu-id="d5000-619">Parameter transformers:</span></span>

* <span data-ttu-id="d5000-620">Execute ao gerar um link usando <xref:Microsoft.AspNetCore.Routing.LinkGenerator>.</span><span class="sxs-lookup"><span data-stu-id="d5000-620">Execute when generating a link using <xref:Microsoft.AspNetCore.Routing.LinkGenerator>.</span></span>
* <span data-ttu-id="d5000-621">Implementar <xref:Microsoft.AspNetCore.Routing.IOutboundParameterTransformer?displayProperty=fullName>.</span><span class="sxs-lookup"><span data-stu-id="d5000-621">Implement <xref:Microsoft.AspNetCore.Routing.IOutboundParameterTransformer?displayProperty=fullName>.</span></span>
* <span data-ttu-id="d5000-622">São configurados usando <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap>.</span><span class="sxs-lookup"><span data-stu-id="d5000-622">Are configured using <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap>.</span></span>
* <span data-ttu-id="d5000-623">Usam o valor de rota do parâmetro e o transformam em um novo valor de cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="d5000-623">Take the parameter's route value and transform it to a new string value.</span></span>
* <span data-ttu-id="d5000-624">Resultam no uso do valor transformado no link gerado.</span><span class="sxs-lookup"><span data-stu-id="d5000-624">Result in using the transformed value in the generated link.</span></span>

<span data-ttu-id="d5000-625">Por exemplo, um transformador de parâmetro `slugify` personalizado em padrão de rota `blog\{article:slugify}` com `Url.Action(new { article = "MyTestArticle" })` gera `blog\my-test-article`.</span><span class="sxs-lookup"><span data-stu-id="d5000-625">For example, a custom `slugify` parameter transformer in route pattern `blog\{article:slugify}` with `Url.Action(new { article = "MyTestArticle" })` generates `blog\my-test-article`.</span></span>

<span data-ttu-id="d5000-626">Considere a seguinte `IOutboundParameterTransformer` implementação:</span><span class="sxs-lookup"><span data-stu-id="d5000-626">Consider the following `IOutboundParameterTransformer` implementation:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/StartupConstraint2.cs?name=snippet2)]

<span data-ttu-id="d5000-627">Para usar um transformador de parâmetro em um padrão de rota, configure <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> - `Startup.ConfigureServices`o usando em:</span><span class="sxs-lookup"><span data-stu-id="d5000-627">To use a parameter transformer in a route pattern, configure it using <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> in `Startup.ConfigureServices`:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/StartupConstraint2.cs?name=snippet)]

<span data-ttu-id="d5000-628">A estrutura de ASP.NET Core usa transformadores de parâmetro para transformar o URI em que um ponto de extremidade é resolvido.</span><span class="sxs-lookup"><span data-stu-id="d5000-628">The ASP.NET Core framework uses parameter transformers to transform the URI where an endpoint resolves.</span></span> <span data-ttu-id="d5000-629">Por exemplo, os transformadores de parâmetro transforma os valores de rota usados `area`para `controller`corresponder `action`a, `page`, e.</span><span class="sxs-lookup"><span data-stu-id="d5000-629">For example, parameter transformers transform the route values used to match an `area`, `controller`, `action`, and `page`.</span></span>

```csharp
routes.MapControllerRoute(
    name: "default",
    template: "{controller:slugify=Home}/{action:slugify=Index}/{id?}");
```

<span data-ttu-id="d5000-630">Com o modelo de rota anterior, a `SubscriptionManagementController.GetAll` ação é correspondida com o `/subscription-management/get-all`URI.</span><span class="sxs-lookup"><span data-stu-id="d5000-630">With the preceding route template, the action `SubscriptionManagementController.GetAll` is matched with the URI `/subscription-management/get-all`.</span></span> <span data-ttu-id="d5000-631">Um transformador de parâmetro não altera os valores de rota usados para gerar um link.</span><span class="sxs-lookup"><span data-stu-id="d5000-631">A parameter transformer doesn't change the route values used to generate a link.</span></span> <span data-ttu-id="d5000-632">Por exemplo, `Url.Action("GetAll", "SubscriptionManagement")` gera `/subscription-management/get-all`.</span><span class="sxs-lookup"><span data-stu-id="d5000-632">For example, `Url.Action("GetAll", "SubscriptionManagement")` outputs `/subscription-management/get-all`.</span></span>

<span data-ttu-id="d5000-633">ASP.NET Core fornece convenções de API para usar transformadores de parâmetro com rotas geradas:</span><span class="sxs-lookup"><span data-stu-id="d5000-633">ASP.NET Core provides API conventions for using parameter transformers with generated routes:</span></span>

* <span data-ttu-id="d5000-634">A <xref:Microsoft.AspNetCore.Mvc.ApplicationModels.RouteTokenTransformerConvention?displayProperty=fullName> Convenção MVC aplica um transformador de parâmetro especificado a todas as rotas de atributo no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d5000-634">The <xref:Microsoft.AspNetCore.Mvc.ApplicationModels.RouteTokenTransformerConvention?displayProperty=fullName> MVC convention applies a specified parameter transformer to all attribute routes in the app.</span></span> <span data-ttu-id="d5000-635">O transformador de parâmetro transforma os tokens de rota do atributo conforme elas são substituídas.</span><span class="sxs-lookup"><span data-stu-id="d5000-635">The parameter transformer transforms attribute route tokens as they are replaced.</span></span> <span data-ttu-id="d5000-636">Para obter mais informações, confira [Usar um transformador de parâmetro para personalizar a substituição de token](xref:mvc/controllers/routing#use-a-parameter-transformer-to-customize-token-replacement).</span><span class="sxs-lookup"><span data-stu-id="d5000-636">For more information, see [Use a parameter transformer to customize token replacement](xref:mvc/controllers/routing#use-a-parameter-transformer-to-customize-token-replacement).</span></span>
* <span data-ttu-id="d5000-637">Razor Pages usa a <xref:Microsoft.AspNetCore.Mvc.ApplicationModels.PageRouteTransformerConvention> Convenção de API.</span><span class="sxs-lookup"><span data-stu-id="d5000-637">Razor Pages uses the <xref:Microsoft.AspNetCore.Mvc.ApplicationModels.PageRouteTransformerConvention> API convention.</span></span> <span data-ttu-id="d5000-638">Essa convenção aplica um transformador de parâmetro especificado a todas as Razor Pages descobertas automaticamente.</span><span class="sxs-lookup"><span data-stu-id="d5000-638">This convention applies a specified parameter transformer to all automatically discovered Razor Pages.</span></span> <span data-ttu-id="d5000-639">O transformador de parâmetro transforma os segmentos de nome de arquivo e pasta de rotas do Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="d5000-639">The parameter transformer transforms the folder and file name segments of Razor Pages routes.</span></span> <span data-ttu-id="d5000-640">Para obter mais informações, confira [Usar um transformador de parâmetros para personalizar rotas de página](xref:razor-pages/razor-pages-conventions#use-a-parameter-transformer-to-customize-page-routes).</span><span class="sxs-lookup"><span data-stu-id="d5000-640">For more information, see [Use a parameter transformer to customize page routes](xref:razor-pages/razor-pages-conventions#use-a-parameter-transformer-to-customize-page-routes).</span></span>

<a name="ugr"></a>

## <a name="url-generation-reference"></a><span data-ttu-id="d5000-641">Referência de geração de URL</span><span class="sxs-lookup"><span data-stu-id="d5000-641">URL generation reference</span></span>

<span data-ttu-id="d5000-642">Esta seção contém uma referência para o algoritmo implementado pela geração de URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-642">This section contains a reference for the algorithm implemented by URL generation.</span></span> <span data-ttu-id="d5000-643">Na prática, os exemplos mais complexos de geração de URL usam controladores ou Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="d5000-643">In practice, most complex examples of URL generation use controllers or Razor Pages.</span></span> <span data-ttu-id="d5000-644">Consulte [Roteamento em controladores](xref:mvc/controllers/routing) para obter informações adicionais.</span><span class="sxs-lookup"><span data-stu-id="d5000-644">See  [routing in controllers](xref:mvc/controllers/routing) for additional information.</span></span>

<span data-ttu-id="d5000-645">O processo de geração de URL começa com uma chamada para [LinkGenerator. GetPathByAddress](xref:Microsoft.AspNetCore.Routing.LinkGenerator.GetPathByAddress*) ou um método semelhante.</span><span class="sxs-lookup"><span data-stu-id="d5000-645">The URL generation process begins with a call to [LinkGenerator.GetPathByAddress](xref:Microsoft.AspNetCore.Routing.LinkGenerator.GetPathByAddress*) or a similar method.</span></span> <span data-ttu-id="d5000-646">O método é fornecido com um endereço, um conjunto de valores de rota e, opcionalmente, informações sobre a solicitação `HttpContext`atual do.</span><span class="sxs-lookup"><span data-stu-id="d5000-646">The method is provided with an address, a set of route values, and optionally information about the current request from `HttpContext`.</span></span>

<span data-ttu-id="d5000-647">A primeira etapa é usar o endereço para resolver um conjunto de pontos de extremidade candidatos usando um [`IEndpointAddressScheme<TAddress>`](xref:Microsoft.AspNetCore.Routing.IEndpointAddressScheme`1) que corresponda ao tipo do endereço.</span><span class="sxs-lookup"><span data-stu-id="d5000-647">The first step is to use the address to resolve a set of candidate endpoints using an [`IEndpointAddressScheme<TAddress>`](xref:Microsoft.AspNetCore.Routing.IEndpointAddressScheme`1) that matches the address's type.</span></span>

<span data-ttu-id="d5000-648">Uma vez do conjunto de candidatos é encontrado pelo esquema de endereço, os pontos de extremidade são ordenados e processados iterativamente até que uma operação de geração de URL tenha sucesso.</span><span class="sxs-lookup"><span data-stu-id="d5000-648">Once of set of candidates is found by the address scheme, the endpoints are ordered and processed iteratively until a URL generation operation succeeds.</span></span> <span data-ttu-id="d5000-649">A geração de URL **não** verifica ambiguidades, o primeiro resultado retornado é o resultado final.</span><span class="sxs-lookup"><span data-stu-id="d5000-649">URL generation does **not** check for ambiguities, the first result returned is the final result.</span></span>

### <a name="troubleshooting-url-generation-with-logging"></a><span data-ttu-id="d5000-650">Solução de problemas de geração de URL com registro em log</span><span class="sxs-lookup"><span data-stu-id="d5000-650">Troubleshooting URL generation with logging</span></span>

<span data-ttu-id="d5000-651">A primeira etapa na solução de problemas de geração de URL é definir o `Microsoft.AspNetCore.Routing` nível `TRACE`de log de como.</span><span class="sxs-lookup"><span data-stu-id="d5000-651">The first step in troubleshooting URL generation is setting the logging level of `Microsoft.AspNetCore.Routing` to `TRACE`.</span></span> <span data-ttu-id="d5000-652">`LinkGenerator`registra muitos detalhes sobre seu processamento, o que pode ser útil para solucionar problemas.</span><span class="sxs-lookup"><span data-stu-id="d5000-652">`LinkGenerator` logs many details about its processing which can be useful to troubleshoot problems.</span></span>

<span data-ttu-id="d5000-653">Consulte [referência de geração de URL](#ugr) para obter detalhes sobre a geração de URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-653">See [URL generation reference](#ugr) for details on URL generation.</span></span>

### <a name="addresses"></a><span data-ttu-id="d5000-654">Endereços</span><span class="sxs-lookup"><span data-stu-id="d5000-654">Addresses</span></span>

<span data-ttu-id="d5000-655">Os endereços são o conceito de geração de URL usado para associar uma chamada ao gerador de link a um conjunto de pontos de extremidade candidatos.</span><span class="sxs-lookup"><span data-stu-id="d5000-655">Addresses are the concept in URL generation used to bind a call into the link generator to a set of candidate endpoints.</span></span>

<span data-ttu-id="d5000-656">Os endereços são um conceito extensível que vem com duas implementações por padrão:</span><span class="sxs-lookup"><span data-stu-id="d5000-656">Addresses are an extensible concept that come with two implementations by default:</span></span>

* <span data-ttu-id="d5000-657">Usando o nome do`string`ponto de *extremidade* () como o endereço:</span><span class="sxs-lookup"><span data-stu-id="d5000-657">Using *endpoint name* (`string`) as the address:</span></span>
    * <span data-ttu-id="d5000-658">Fornece funcionalidade semelhante ao nome da rota do MVC.</span><span class="sxs-lookup"><span data-stu-id="d5000-658">Provides similar functionality to MVC's route name.</span></span>
    * <span data-ttu-id="d5000-659">Usa o <xref:Microsoft.AspNetCore.Routing.IEndpointNameMetadata> tipo de metadados.</span><span class="sxs-lookup"><span data-stu-id="d5000-659">Uses the <xref:Microsoft.AspNetCore.Routing.IEndpointNameMetadata> metadata type.</span></span>
    * <span data-ttu-id="d5000-660">Resolve a cadeia de caracteres fornecida em relação aos metadados de todos os pontos de extremidade registrados.</span><span class="sxs-lookup"><span data-stu-id="d5000-660">Resolves the provided string against the metadata of all registered endpoints.</span></span>
    * <span data-ttu-id="d5000-661">Gera uma exceção na inicialização se vários pontos de extremidade usarem o mesmo nome.</span><span class="sxs-lookup"><span data-stu-id="d5000-661">Throws an exception on startup if multiple endpoints use the same name.</span></span>
    * <span data-ttu-id="d5000-662">Recomendado para uso de uso geral fora dos controladores e Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="d5000-662">Recommended for general-purpose use outside of controllers and Razor Pages.</span></span>
* <span data-ttu-id="d5000-663">Usando *valores* de rota<xref:Microsoft.AspNetCore.Routing.RouteValuesAddress>() como o endereço:</span><span class="sxs-lookup"><span data-stu-id="d5000-663">Using *route values* (<xref:Microsoft.AspNetCore.Routing.RouteValuesAddress>) as the address:</span></span>
    * <span data-ttu-id="d5000-664">Fornece funcionalidade semelhante para controladores e Razor Pages geração de URL herdada.</span><span class="sxs-lookup"><span data-stu-id="d5000-664">Provides similar functionality to controllers and Razor Pages legacy URL generation.</span></span>
    * <span data-ttu-id="d5000-665">Muito complexo para estender e depurar.</span><span class="sxs-lookup"><span data-stu-id="d5000-665">Very complex to extend and debug.</span></span>
    * <span data-ttu-id="d5000-666">Fornece a implementação usada por `IUrlHelper`, auxiliares de marca, auxiliares HTML, resultados de ação, etc.</span><span class="sxs-lookup"><span data-stu-id="d5000-666">Provides the implementation used by `IUrlHelper`, Tag Helpers, HTML Helpers, Action Results, etc.</span></span>

<span data-ttu-id="d5000-667">A função do esquema de endereço é fazer a associação entre o endereço e os pontos de extremidade correspondentes por critérios arbitrários:</span><span class="sxs-lookup"><span data-stu-id="d5000-667">The role of the address scheme is to make the association between the address and matching endpoints by arbitrary criteria:</span></span>

* <span data-ttu-id="d5000-668">O esquema de nome do ponto de extremidade executa uma pesquisa de dicionário básica.</span><span class="sxs-lookup"><span data-stu-id="d5000-668">The endpoint name scheme performs a basic dictionary lookup.</span></span>
* <span data-ttu-id="d5000-669">O esquema de valores de rota tem um melhor subconjunto complexo do algoritmo de conjunto.</span><span class="sxs-lookup"><span data-stu-id="d5000-669">The route values scheme has a complex best subset of set algorithm.</span></span>

<a name="ambient"></a>

### <a name="ambient-values-and-explicit-values"></a><span data-ttu-id="d5000-670">Valores de ambiente e valores explícitos</span><span class="sxs-lookup"><span data-stu-id="d5000-670">Ambient values and explicit values</span></span>

<span data-ttu-id="d5000-671">Da solicitação atual, o roteamento acessa os valores de rota da solicitação `HttpContext.Request.RouteValues`atual.</span><span class="sxs-lookup"><span data-stu-id="d5000-671">From the current request, routing accesses the route values of the current request `HttpContext.Request.RouteValues`.</span></span> <span data-ttu-id="d5000-672">Os valores associados à solicitação atual são chamados de **valores de ambiente**.</span><span class="sxs-lookup"><span data-stu-id="d5000-672">The values associated with the current request are referred to as the **ambient values**.</span></span> <span data-ttu-id="d5000-673">Para fins de clareza, a documentação refere-se aos valores de rota passados para métodos como **valores explícitos**.</span><span class="sxs-lookup"><span data-stu-id="d5000-673">For the purpose of clarity, the documentation refers to the route values passed in to methods as **explicit values**.</span></span>

<span data-ttu-id="d5000-674">O exemplo a seguir mostra valores de ambiente e valores explícitos.</span><span class="sxs-lookup"><span data-stu-id="d5000-674">The following example shows ambient values and explicit values.</span></span> <span data-ttu-id="d5000-675">Ele fornece valores de ambiente da solicitação atual e valores explícitos `{ id = 17, }`::</span><span class="sxs-lookup"><span data-stu-id="d5000-675">It provides ambient values from the current request and explicit values: `{ id = 17, }`:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/Controllers/WidgetController.cs?name=snippet)]

<span data-ttu-id="d5000-676">O código anterior:</span><span class="sxs-lookup"><span data-stu-id="d5000-676">The preceding code:</span></span>

* <span data-ttu-id="d5000-677">Retorna `/Widget/Index/17`</span><span class="sxs-lookup"><span data-stu-id="d5000-677">Returns `/Widget/Index/17`</span></span>
* <span data-ttu-id="d5000-678">Obtém <xref:Microsoft.AspNetCore.Routing.LinkGenerator> por meio de [di](xref:fundamentals/dependency-injection).</span><span class="sxs-lookup"><span data-stu-id="d5000-678">Gets <xref:Microsoft.AspNetCore.Routing.LinkGenerator> via [DI](xref:fundamentals/dependency-injection).</span></span>

<span data-ttu-id="d5000-679">O código a seguir não fornece valores de ambiente e valores `{ controller = "Home", action = "Subscribe", id = 17, }`explícitos::</span><span class="sxs-lookup"><span data-stu-id="d5000-679">The following code provides no ambient values and explicit values: `{ controller = "Home", action = "Subscribe", id = 17, }`:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/Controllers/WidgetController.cs?name=snippet2)]

<span data-ttu-id="d5000-680">O método anterior retorna`/Home/Subscribe/17`</span><span class="sxs-lookup"><span data-stu-id="d5000-680">The preceding  method returns `/Home/Subscribe/17`</span></span>

<span data-ttu-id="d5000-681">O código a seguir no `WidgetController` retorna `/Widget/Subscribe/17`:</span><span class="sxs-lookup"><span data-stu-id="d5000-681">The following code in the `WidgetController` returns `/Widget/Subscribe/17`:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/Controllers/WidgetController.cs?name=snippet3)]

<span data-ttu-id="d5000-682">O código a seguir fornece o controlador de valores de ambiente na solicitação atual e valores explícitos: `{ action = "Edit", id = 17, }`:</span><span class="sxs-lookup"><span data-stu-id="d5000-682">The following code provides the controller from ambient values in the current request and explicit values: `{ action = "Edit", id = 17, }`:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/Controllers/GadgetController.cs?name=snippet)]

<span data-ttu-id="d5000-683">No código anterior:</span><span class="sxs-lookup"><span data-stu-id="d5000-683">In the preceding code:</span></span>

* <span data-ttu-id="d5000-684">`/Gadget/Edit/17`é retornado.</span><span class="sxs-lookup"><span data-stu-id="d5000-684">`/Gadget/Edit/17` is returned.</span></span>
* <span data-ttu-id="d5000-685"><xref:Microsoft.AspNetCore.Mvc.ControllerBase.Url>Obtém o <xref:Microsoft.AspNetCore.Mvc.IUrlHelper>.</span><span class="sxs-lookup"><span data-stu-id="d5000-685"><xref:Microsoft.AspNetCore.Mvc.ControllerBase.Url> gets the <xref:Microsoft.AspNetCore.Mvc.IUrlHelper>.</span></span>
* <xref:Microsoft.AspNetCore.Mvc.UrlHelperExtensions.Action*>   
<span data-ttu-id="d5000-686">gera uma URL com um caminho absoluto para um método de ação.</span><span class="sxs-lookup"><span data-stu-id="d5000-686">generates a URL with an absolute path for an action method.</span></span> <span data-ttu-id="d5000-687">A URL contém o nome `action` e `route` os valores especificados.</span><span class="sxs-lookup"><span data-stu-id="d5000-687">The URL contains the specified `action` name and `route` values.</span></span>

<span data-ttu-id="d5000-688">O código a seguir fornece valores de ambiente da solicitação atual e dos valores `{ page = "./Edit, id = 17, }`explícitos::</span><span class="sxs-lookup"><span data-stu-id="d5000-688">The following code provides ambient values from the current request and explicit values: `{ page = "./Edit, id = 17, }`:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/Pages/Index.cshtml.cs?name=snippet)]

<span data-ttu-id="d5000-689">O código anterior define `url` como `/Edit/17` quando a página Editar Razor contém a seguinte diretiva de página:</span><span class="sxs-lookup"><span data-stu-id="d5000-689">The preceding code sets `url` to  `/Edit/17` when the Edit Razor Page contains the following page directive:</span></span>

 `@page "{id:int}"`

<span data-ttu-id="d5000-690">Se a página de edição não contiver o modelo `url` de `/Edit?id=17` `"{id:int}"` rota, será.</span><span class="sxs-lookup"><span data-stu-id="d5000-690">If the Edit page doesn't contain the `"{id:int}"` route template, `url` is `/Edit?id=17`.</span></span>

<span data-ttu-id="d5000-691">O comportamento do MVC <xref:Microsoft.AspNetCore.Mvc.IUrlHelper> adiciona uma camada de complexidade além das regras descritas aqui:</span><span class="sxs-lookup"><span data-stu-id="d5000-691">The behavior of MVC's <xref:Microsoft.AspNetCore.Mvc.IUrlHelper> adds a layer of complexity in addition to the rules described here:</span></span>

* <span data-ttu-id="d5000-692">`IUrlHelper`sempre fornece os valores de rota da solicitação atual como valores de ambiente.</span><span class="sxs-lookup"><span data-stu-id="d5000-692">`IUrlHelper` always provides the route values from the current request as ambient values.</span></span>
* <span data-ttu-id="d5000-693">[IUrlHelper. Action](xref:Microsoft.AspNetCore.Mvc.UrlHelperExtensions.Action*) sempre copia os valores `action` atuais `controller` e de rota como valores explícitos, a menos que sejam substituídos pelo desenvolvedor.</span><span class="sxs-lookup"><span data-stu-id="d5000-693">[IUrlHelper.Action](xref:Microsoft.AspNetCore.Mvc.UrlHelperExtensions.Action*) always copies the current `action` and `controller` route values as explicit values unless overridden by the developer.</span></span>
* <span data-ttu-id="d5000-694">[IUrlHelper. Page](xref:Microsoft.AspNetCore.Mvc.UrlHelperExtensions.Page*) sempre copia o valor `page` de rota atual como um valor explícito, a menos que seja substituído.</span><span class="sxs-lookup"><span data-stu-id="d5000-694">[IUrlHelper.Page](xref:Microsoft.AspNetCore.Mvc.UrlHelperExtensions.Page*) always copies the current `page` route value as an explicit value unless overridden.</span></span> <!--by the user-->
* <span data-ttu-id="d5000-695">`IUrlHelper.Page`sempre substitui o valor `handler` de rota atual `null` por como valores explícitos, a menos que seja substituído.</span><span class="sxs-lookup"><span data-stu-id="d5000-695">`IUrlHelper.Page` always overrides the current `handler` route value with `null` as an explicit values unless overridden.</span></span>

<span data-ttu-id="d5000-696">Os usuários geralmente são surpresos com os detalhes comportamentais dos valores de ambiente, porque o MVC não parece seguir suas próprias regras.</span><span class="sxs-lookup"><span data-stu-id="d5000-696">Users are often surprised by the behavioral details of ambient values, because MVC doesn't seem to follow its own rules.</span></span> <span data-ttu-id="d5000-697">Para razões históricas e de compatibilidade `action`, certos valores `controller` `page`de rota, como, `handler` , e têm seu próprio comportamento de caso especial.</span><span class="sxs-lookup"><span data-stu-id="d5000-697">For historical and compatibility reasons, certain route values such as `action`, `controller`, `page`, and `handler` have their own special-case behavior.</span></span>

<span data-ttu-id="d5000-698">A funcionalidade equivalente fornecida pelo `LinkGenerator.GetPathByAction` e `LinkGenerator.GetPathByPage` duplica essas anomalias de `IUrlHelper` para compatibilidade.</span><span class="sxs-lookup"><span data-stu-id="d5000-698">The equivalent functionality provided by `LinkGenerator.GetPathByAction` and `LinkGenerator.GetPathByPage` duplicates these anomalies of `IUrlHelper` for compatibility.</span></span>

### <a name="url-generation-process"></a><span data-ttu-id="d5000-699">Processo de geração de URL</span><span class="sxs-lookup"><span data-stu-id="d5000-699">URL generation process</span></span>

<span data-ttu-id="d5000-700">Depois que o conjunto de pontos de extremidade candidatos for encontrado, o algoritmo de geração de URL:</span><span class="sxs-lookup"><span data-stu-id="d5000-700">Once the set of candidate endpoints are found, the URL generation algorithm:</span></span>

* <span data-ttu-id="d5000-701">Processa os pontos de extremidade iterativamente.</span><span class="sxs-lookup"><span data-stu-id="d5000-701">Processes the endpoints iteratively.</span></span>
* <span data-ttu-id="d5000-702">Retorna o primeiro resultado bem-sucedido.</span><span class="sxs-lookup"><span data-stu-id="d5000-702">Returns the first successful result.</span></span>

<span data-ttu-id="d5000-703">A primeira etapa nesse processo é chamada de **invalidação de valor de rota**.</span><span class="sxs-lookup"><span data-stu-id="d5000-703">The first step in this process is called **route value invalidation**.</span></span>  <span data-ttu-id="d5000-704">Invalidação de valor de rota é o processo pelo qual o roteamento decide quais valores de rota dos valores de ambiente devem ser usados e quais devem ser ignorados.</span><span class="sxs-lookup"><span data-stu-id="d5000-704">Route value invalidation is the process by which routing decides which route values from the ambient values should be used and which should be ignored.</span></span> <span data-ttu-id="d5000-705">Cada valor de ambiente é considerado e combinado com os valores explícitos ou ignorado.</span><span class="sxs-lookup"><span data-stu-id="d5000-705">Each ambient value is considered and either combined with the explicit values, or ignored.</span></span>

<span data-ttu-id="d5000-706">A melhor maneira de pensar sobre a função de valores de ambiente é que eles tentam salvar os desenvolvedores de aplicativos digitando, em alguns casos comuns.</span><span class="sxs-lookup"><span data-stu-id="d5000-706">The best way to think about the role of ambient values is that they attempt to save application developers typing, in some common cases.</span></span> <span data-ttu-id="d5000-707">Tradicionalmente, os cenários em que os valores de ambiente são úteis estão relacionados ao MVC:</span><span class="sxs-lookup"><span data-stu-id="d5000-707">Traditionally, the scenarios where ambient values are helpful are related to MVC:</span></span>

* <span data-ttu-id="d5000-708">Ao vincular a outra ação no mesmo controlador, o nome do controlador não precisa ser especificado.</span><span class="sxs-lookup"><span data-stu-id="d5000-708">When linking to another action in the same controller, the controller name doesn't need to be specified.</span></span>
* <span data-ttu-id="d5000-709">Ao vincular a outro controlador na mesma área, o nome da área não precisa ser especificado.</span><span class="sxs-lookup"><span data-stu-id="d5000-709">When linking to another controller in the same area, the area name doesn't need to be specified.</span></span>
* <span data-ttu-id="d5000-710">Ao vincular ao mesmo método de ação, os valores de rota não precisam ser especificados.</span><span class="sxs-lookup"><span data-stu-id="d5000-710">When linking to the same action method, route values don't need to be specified.</span></span>
* <span data-ttu-id="d5000-711">Ao vincular a outra parte do aplicativo, você não deseja transportar os valores de rota que não têm significado nessa parte do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d5000-711">When linking to another part of the app, you don't want to carry over route values that have no meaning in that part of the app.</span></span>

<span data-ttu-id="d5000-712">Chamadas para `LinkGenerator` ou `IUrlHelper` que retornam `null` geralmente são causadas por não entender a invalidação do valor da rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-712">Calls to `LinkGenerator` or `IUrlHelper` that return `null` are usually caused by not understanding route value invalidation.</span></span> <span data-ttu-id="d5000-713">Solucionar problemas de invalidação de valor de rota especificando explicitamente mais valores de rota para ver se isso resolve o problema.</span><span class="sxs-lookup"><span data-stu-id="d5000-713">Troubleshoot route value invalidation by explicitly specifying more of the route values to see if that solves the problem.</span></span>

<span data-ttu-id="d5000-714">A invalidação de valor de rota funciona na suposição de que o esquema de URL do aplicativo é hierárquico, com uma hierarquia formada da esquerda para a direita.</span><span class="sxs-lookup"><span data-stu-id="d5000-714">Route value invalidation works on the assumption that the app's URL scheme is hierarchical, with a hierarchy formed from left-to-right.</span></span> <span data-ttu-id="d5000-715">Considere o modelo `{controller}/{action}/{id?}` de rota do controlador básico para obter uma noção intuitiva de como isso funciona na prática.</span><span class="sxs-lookup"><span data-stu-id="d5000-715">Consider the basic controller route template `{controller}/{action}/{id?}` to get an intuitive sense of how this works in practice.</span></span> <span data-ttu-id="d5000-716">Uma **alteração** em um valor **invalida** todos os valores de rota que aparecem à direita.</span><span class="sxs-lookup"><span data-stu-id="d5000-716">A **change** to a value **invalidates** all of the route values that appear to the right.</span></span> <span data-ttu-id="d5000-717">Isso reflete a suposição sobre a hierarquia.</span><span class="sxs-lookup"><span data-stu-id="d5000-717">This reflects the assumption about hierarchy.</span></span> <span data-ttu-id="d5000-718">Se o aplicativo tiver um valor de ambiente `id`para, e a operação especificar um valor diferente para `controller`:</span><span class="sxs-lookup"><span data-stu-id="d5000-718">If the app has an ambient value for `id`, and the operation specifies a different value for the `controller`:</span></span>

* <span data-ttu-id="d5000-719">`id`Não será reutilizado porque `{controller}` está à esquerda de `{id?}`.</span><span class="sxs-lookup"><span data-stu-id="d5000-719">`id` won't be reused because `{controller}` is to the left of `{id?}`.</span></span>

<span data-ttu-id="d5000-720">Alguns exemplos que demonstram esse princípio:</span><span class="sxs-lookup"><span data-stu-id="d5000-720">Some examples demonstrating this principle:</span></span>

* <span data-ttu-id="d5000-721">Se os valores explícitos contiverem `id`um valor para, o `id` valor de ambiente para será ignorado.</span><span class="sxs-lookup"><span data-stu-id="d5000-721">If the explicit values contain a value for `id`, the ambient value for `id` is ignored.</span></span> <span data-ttu-id="d5000-722">Os valores de ambiente `controller` para `action` e podem ser usados.</span><span class="sxs-lookup"><span data-stu-id="d5000-722">The ambient values for `controller` and `action` can be used.</span></span>
* <span data-ttu-id="d5000-723">Se os valores explícitos contiverem `action`um valor para, qualquer `action` valor de ambiente para será ignorado.</span><span class="sxs-lookup"><span data-stu-id="d5000-723">If the explicit values contain a value for `action`, any ambient value for `action` is ignored.</span></span> <span data-ttu-id="d5000-724">Os valores de ambiente `controller` para podem ser usados.</span><span class="sxs-lookup"><span data-stu-id="d5000-724">The ambient values for `controller` can be used.</span></span> <span data-ttu-id="d5000-725">Se o valor explícito para `action` for diferente do valor de ambiente para `action`, o `id` valor não será usado.</span><span class="sxs-lookup"><span data-stu-id="d5000-725">If the explicit value for `action` is different from the ambient value for `action`, the `id` value won't be used.</span></span>  <span data-ttu-id="d5000-726">Se o valor explícito para `action` for igual ao valor de ambiente para `action`, o `id` valor poderá ser usado.</span><span class="sxs-lookup"><span data-stu-id="d5000-726">If the explicit value for `action` is the same as the ambient value for `action`, the `id` value can be used.</span></span>
* <span data-ttu-id="d5000-727">Se os valores explícitos contiverem `controller`um valor para, qualquer `controller` valor de ambiente para será ignorado.</span><span class="sxs-lookup"><span data-stu-id="d5000-727">If the explicit values contain a value for `controller`, any ambient value for `controller` is ignored.</span></span> <span data-ttu-id="d5000-728">Se o valor explícito para `controller` for diferente do valor de ambiente para `controller`, os `action` valores `id` e não serão usados.</span><span class="sxs-lookup"><span data-stu-id="d5000-728">If the explicit value for `controller` is different from the ambient value for `controller`, the `action` and `id` values won't be used.</span></span> <span data-ttu-id="d5000-729">Se o valor explícito para `controller` for igual ao valor de ambiente para `controller`, os `action` valores e `id` poderão ser usados.</span><span class="sxs-lookup"><span data-stu-id="d5000-729">If the explicit value for `controller` is the same as the ambient value for `controller`, the `action` and `id` values can be used.</span></span>

<span data-ttu-id="d5000-730">Esse processo é mais complicado pela existência de rotas de atributos e rotas convencionais dedicadas.</span><span class="sxs-lookup"><span data-stu-id="d5000-730">This process is further complicated by the existence of attribute routes and dedicated conventional routes.</span></span> <span data-ttu-id="d5000-731">Rotas convencionais do controlador, `{controller}/{action}/{id?}` como especificar uma hierarquia usando parâmetros de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-731">Controller conventional routes such as `{controller}/{action}/{id?}` specify a hierarchy using route parameters.</span></span> <span data-ttu-id="d5000-732">Para rotas convencionais e [rotas de atributos](xref:mvc/controllers/routing#ar) [dedicadas](xref:mvc/controllers/routing#dcr) para controladores e Razor Pages:</span><span class="sxs-lookup"><span data-stu-id="d5000-732">For [dedicated conventional routes](xref:mvc/controllers/routing#dcr) and [attribute routes](xref:mvc/controllers/routing#ar) to controllers and Razor Pages:</span></span>

* <span data-ttu-id="d5000-733">Há uma hierarquia de valores de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-733">There is a hierarchy of route values.</span></span>
* <span data-ttu-id="d5000-734">Eles não aparecem no modelo.</span><span class="sxs-lookup"><span data-stu-id="d5000-734">They don't appear in the template.</span></span>

<span data-ttu-id="d5000-735">Nesses casos, a geração de URL define o conceito de **valores necessários** .</span><span class="sxs-lookup"><span data-stu-id="d5000-735">For these cases, URL generation defines the **required values** concept.</span></span> <span data-ttu-id="d5000-736">Os pontos de extremidade criados por controladores e Razor Pages têm valores necessários especificados que permitem a invalidação do valor de rota funcionar.</span><span class="sxs-lookup"><span data-stu-id="d5000-736">Endpoints created by controllers and Razor Pages have required values specified that allow route value invalidation to work.</span></span>

<span data-ttu-id="d5000-737">O algoritmo de invalidação de valor de rota em detalhes:</span><span class="sxs-lookup"><span data-stu-id="d5000-737">The route value invalidation algorithm in detail:</span></span>

* <span data-ttu-id="d5000-738">Os nomes de valor necessários são combinados com os parâmetros de rota e, em seguida, processados da esquerda para a direita.</span><span class="sxs-lookup"><span data-stu-id="d5000-738">The required value names are combined with the route parameters, then processed from left-to-right.</span></span>
* <span data-ttu-id="d5000-739">Para cada parâmetro, o valor de ambiente e o valor explícito são comparados:</span><span class="sxs-lookup"><span data-stu-id="d5000-739">For each parameter, the ambient value and explicit value are compared:</span></span>
    * <span data-ttu-id="d5000-740">Se o valor de ambiente e o valor explícito forem iguais, o processo continuará.</span><span class="sxs-lookup"><span data-stu-id="d5000-740">If the ambient value and explicit value are the same, the process continues.</span></span>
    * <span data-ttu-id="d5000-741">Se o valor de ambiente estiver presente e o valor explícito não for, o valor de ambiente será usado ao gerar a URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-741">If the ambient value is present and the explicit value isn't, the ambient value is used when generating the URL.</span></span>
    * <span data-ttu-id="d5000-742">Se o valor de ambiente não estiver presente e o valor explícito for, rejeite o valor de ambiente e todos os valores de ambiente subsequentes.</span><span class="sxs-lookup"><span data-stu-id="d5000-742">If the ambient value isn't present and the explicit value is, reject the ambient value and all subsequent ambient values.</span></span>
    * <span data-ttu-id="d5000-743">Se o valor de ambiente e o valor explícito estiverem presentes, e os dois valores forem diferentes, rejeite o valor de ambiente e todos os valores de ambiente subsequentes.</span><span class="sxs-lookup"><span data-stu-id="d5000-743">If the ambient value and the explicit value are present, and the two values are different, reject the ambient value and all subsequent ambient values.</span></span>

<span data-ttu-id="d5000-744">Neste ponto, a operação de geração de URL está pronta para avaliar as restrições de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-744">At this point, the URL generation operation is ready to evaluate route constraints.</span></span> <span data-ttu-id="d5000-745">O conjunto de valores aceitos é combinado com os valores padrão de parâmetro, que é fornecido para restrições.</span><span class="sxs-lookup"><span data-stu-id="d5000-745">The set of accepted values is combined with the parameter default values, which is provided to constraints.</span></span> <span data-ttu-id="d5000-746">Se todas as restrições forem aprovadas, a operação continuará.</span><span class="sxs-lookup"><span data-stu-id="d5000-746">If the constraints all pass, the operation continues.</span></span>

<span data-ttu-id="d5000-747">Em seguida, os **valores aceitos** podem ser usados para expandir o modelo de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-747">Next, the **accepted values** can be used to expand the route template.</span></span> <span data-ttu-id="d5000-748">O modelo de rota é processado:</span><span class="sxs-lookup"><span data-stu-id="d5000-748">The route template is processed:</span></span>

* <span data-ttu-id="d5000-749">Da esquerda para a direita.</span><span class="sxs-lookup"><span data-stu-id="d5000-749">From left-to-right.</span></span>
* <span data-ttu-id="d5000-750">Cada parâmetro tem seu valor aceito substituído.</span><span class="sxs-lookup"><span data-stu-id="d5000-750">Each parameter has its accepted value substituted.</span></span>
* <span data-ttu-id="d5000-751">Com os seguintes casos especiais:</span><span class="sxs-lookup"><span data-stu-id="d5000-751">With the following special cases:</span></span>
  * <span data-ttu-id="d5000-752">Se os valores aceitos não contiverem um valor e o parâmetro tiver um valor padrão, o valor padrão será usado.</span><span class="sxs-lookup"><span data-stu-id="d5000-752">If the accepted values is missing a value and the parameter has a default value, the default value is used.</span></span>
  * <span data-ttu-id="d5000-753">Se os valores aceitos não contiverem um valor e o parâmetro for opcional, o processamento continuará.</span><span class="sxs-lookup"><span data-stu-id="d5000-753">If the accepted values is missing a value and the parameter is optional, processing continues.</span></span>
  * <span data-ttu-id="d5000-754">Se qualquer parâmetro de rota à direita de um parâmetro opcional ausente tiver um valor, a operação falhará.</span><span class="sxs-lookup"><span data-stu-id="d5000-754">If any route parameter to the right of a missing optional parameter has a value, the operation fails.</span></span>
  * <!-- review default-valued parameters optional parameters --> <span data-ttu-id="d5000-755">Parâmetros de valor padrão contíguos e parâmetros opcionais são recolhidos sempre que possível.</span><span class="sxs-lookup"><span data-stu-id="d5000-755">Contiguous default-valued parameters and optional parameters are collapsed where possible.</span></span>

<span data-ttu-id="d5000-756">Valores explicitamente fornecidos que não correspondem a um segmento da rota são adicionados à cadeia de caracteres de consulta.</span><span class="sxs-lookup"><span data-stu-id="d5000-756">Values explicitly provided that don't match a segment of the route are added to the query string.</span></span> <span data-ttu-id="d5000-757">A tabela a seguir mostra o resultado do uso do modelo de rota `{controller}/{action}/{id?}`.</span><span class="sxs-lookup"><span data-stu-id="d5000-757">The following table shows the result when using the route template `{controller}/{action}/{id?}`.</span></span>

| <span data-ttu-id="d5000-758">Valores de ambiente</span><span class="sxs-lookup"><span data-stu-id="d5000-758">Ambient Values</span></span>                     | <span data-ttu-id="d5000-759">Valores explícitos</span><span class="sxs-lookup"><span data-stu-id="d5000-759">Explicit Values</span></span>                        | <span data-ttu-id="d5000-760">Result</span><span class="sxs-lookup"><span data-stu-id="d5000-760">Result</span></span>                  |
| ---------------------------------- | -------------------------------------- | ----------------------- |
| <span data-ttu-id="d5000-761">controlador = "Home"</span><span class="sxs-lookup"><span data-stu-id="d5000-761">controller = "Home"</span></span>                | <span data-ttu-id="d5000-762">ação = "About"</span><span class="sxs-lookup"><span data-stu-id="d5000-762">action = "About"</span></span>                       | `/Home/About`           |
| <span data-ttu-id="d5000-763">controlador = "Home"</span><span class="sxs-lookup"><span data-stu-id="d5000-763">controller = "Home"</span></span>                | <span data-ttu-id="d5000-764">controlador = "Order", ação = "About"</span><span class="sxs-lookup"><span data-stu-id="d5000-764">controller = "Order", action = "About"</span></span> | `/Order/About`          |
| <span data-ttu-id="d5000-765">controlador = "Home", cor = "Red"</span><span class="sxs-lookup"><span data-stu-id="d5000-765">controller = "Home", color = "Red"</span></span> | <span data-ttu-id="d5000-766">ação = "About"</span><span class="sxs-lookup"><span data-stu-id="d5000-766">action = "About"</span></span>                       | `/Home/About`           |
| <span data-ttu-id="d5000-767">controlador = "Home"</span><span class="sxs-lookup"><span data-stu-id="d5000-767">controller = "Home"</span></span>                | <span data-ttu-id="d5000-768">ação = "About", cor = "Red"</span><span class="sxs-lookup"><span data-stu-id="d5000-768">action = "About", color = "Red"</span></span>        | `/Home/About?color=Red` |

### <a name="problems-with-route-value-invalidation"></a><span data-ttu-id="d5000-769">Problemas com invalidação de valor de rota</span><span class="sxs-lookup"><span data-stu-id="d5000-769">Problems with route value invalidation</span></span>

<span data-ttu-id="d5000-770">A partir de ASP.NET Core 3,0, alguns esquemas de geração de URL usados nas versões anteriores do ASP.NET Core não funcionam bem com a geração de URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-770">As of ASP.NET Core 3.0, some URL generation schemes used in earlier ASP.NET Core versions don't work well with URL generation.</span></span> <span data-ttu-id="d5000-771">A equipe de ASP.NET Core planeja adicionar recursos para atender a essas necessidades em uma versão futura.</span><span class="sxs-lookup"><span data-stu-id="d5000-771">The ASP.NET Core team plans to add features to address these needs in a future release.</span></span> <span data-ttu-id="d5000-772">Por enquanto, a melhor solução é usar o roteamento herdado.</span><span class="sxs-lookup"><span data-stu-id="d5000-772">For now the best solution is to use legacy routing.</span></span>

<span data-ttu-id="d5000-773">O código a seguir mostra um exemplo de um esquema de geração de URL que não tem suporte pelo roteamento.</span><span class="sxs-lookup"><span data-stu-id="d5000-773">The following code shows an example of a URL generation scheme that's not supported by routing.</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/StartupUnsupported.cs?name=snippet)]

<span data-ttu-id="d5000-774">No código anterior, o `culture` parâmetro Route é usado para localização.</span><span class="sxs-lookup"><span data-stu-id="d5000-774">In the preceding code, the `culture` route parameter is used for localization.</span></span> <span data-ttu-id="d5000-775">O desejo é ter o `culture` parâmetro sempre aceito como um valor de ambiente.</span><span class="sxs-lookup"><span data-stu-id="d5000-775">The desire is to have the `culture` parameter always accepted as an ambient value.</span></span> <span data-ttu-id="d5000-776">No entanto `culture` , o parâmetro não é aceito como um valor de ambiente devido à maneira como os valores necessários funcionam:</span><span class="sxs-lookup"><span data-stu-id="d5000-776">However, the `culture` parameter is not accepted as an ambient value because of the way required values work:</span></span>

* <span data-ttu-id="d5000-777">No modelo `"default"` de rota, o `culture` parâmetro de rota é à esquerda de `controller`, portanto, as `controller` alterações para não serão `culture`validadas.</span><span class="sxs-lookup"><span data-stu-id="d5000-777">In the `"default"` route template, the `culture` route parameter is to the left of `controller`, so changes to `controller` won't invalidate `culture`.</span></span>
* <span data-ttu-id="d5000-778">No modelo `"blog"` de rota, o `culture` parâmetro de rota é considerado à direita de `controller`, que aparece nos valores necessários.</span><span class="sxs-lookup"><span data-stu-id="d5000-778">In the `"blog"` route template, the `culture` route parameter is considered to be to the right of `controller`, which appears in the required values.</span></span>

## <a name="configuring-endpoint-metadata"></a><span data-ttu-id="d5000-779">Configurando metadados de ponto de extremidade</span><span class="sxs-lookup"><span data-stu-id="d5000-779">Configuring endpoint metadata</span></span>

<span data-ttu-id="d5000-780">Os links a seguir fornecem informações sobre como configurar metadados de ponto de extremidade:</span><span class="sxs-lookup"><span data-stu-id="d5000-780">The following links provide information on configuring endpoint metadata:</span></span>

* [<span data-ttu-id="d5000-781">Habilitar CORS com roteamento de ponto de extremidade</span><span class="sxs-lookup"><span data-stu-id="d5000-781">Enable Cors with endpoint routing</span></span>](xref:security/cors#enable-cors-with-endpoint-routing)
* <span data-ttu-id="d5000-782">[Exemplo de IAuthorizationPolicyProvider](https://github.com/dotnet/AspNetCore/tree/release/3.0/src/Security/samples/CustomPolicyProvider) usando um `[MinimumAgeAuthorize]` atributo personalizado</span><span class="sxs-lookup"><span data-stu-id="d5000-782">[IAuthorizationPolicyProvider sample](https://github.com/dotnet/AspNetCore/tree/release/3.0/src/Security/samples/CustomPolicyProvider) using a custom `[MinimumAgeAuthorize]` attribute</span></span>
* <span data-ttu-id="d5000-783">[Testar a autenticação com o atributo [autorizar]](xref:security/authentication/identity#test-identity)</span><span class="sxs-lookup"><span data-stu-id="d5000-783">[Test authentication with the [Authorize] attribute](xref:security/authentication/identity#test-identity)</span></span>
* <xref:Microsoft.AspNetCore.Builder.AuthorizationEndpointConventionBuilderExtensions.RequireAuthorization*>
* <span data-ttu-id="d5000-784">[Selecionando o esquema com o atributo [autorizar]](xref:security/authorization/limitingidentitybyscheme#selecting-the-scheme-with-the-authorize-attribute)</span><span class="sxs-lookup"><span data-stu-id="d5000-784">[Selecting the scheme with the [Authorize] attribute](xref:security/authorization/limitingidentitybyscheme#selecting-the-scheme-with-the-authorize-attribute)</span></span>
* <span data-ttu-id="d5000-785">[Aplicando políticas usando o atributo [autorizar]](xref:security/authorization/policies#applying-policies-to-mvc-controllers)</span><span class="sxs-lookup"><span data-stu-id="d5000-785">[Applying policies using the [Authorize] attribute](xref:security/authorization/policies#applying-policies-to-mvc-controllers)</span></span>
* <xref:security/authorization/roles>

<a name="hostmatch"></a>

## <a name="host-matching-in-routes-with-requirehost"></a><span data-ttu-id="d5000-786">Correspondência de host em rotas com RequireHost</span><span class="sxs-lookup"><span data-stu-id="d5000-786">Host matching in routes with RequireHost</span></span>

<span data-ttu-id="d5000-787"><xref:Microsoft.AspNetCore.Builder.RoutingEndpointConventionBuilderExtensions.RequireHost*>aplica uma restrição à rota que requer o host especificado.</span><span class="sxs-lookup"><span data-stu-id="d5000-787"><xref:Microsoft.AspNetCore.Builder.RoutingEndpointConventionBuilderExtensions.RequireHost*> applies a constraint to the route which requires the specified host.</span></span> <span data-ttu-id="d5000-788">O `RequireHost` parâmetro ou [[host]](xref:Microsoft.AspNetCore.Routing.HostAttribute) pode ser:</span><span class="sxs-lookup"><span data-stu-id="d5000-788">The `RequireHost` or [[Host]](xref:Microsoft.AspNetCore.Routing.HostAttribute) parameter can be:</span></span>

* <span data-ttu-id="d5000-789">Host: `www.domain.com`, corresponde `www.domain.com` a qualquer porta.</span><span class="sxs-lookup"><span data-stu-id="d5000-789">Host: `www.domain.com`, matches `www.domain.com` with any port.</span></span>
* <span data-ttu-id="d5000-790">Host com curinga: `*.domain.com`, corresponde `www.domain.com`, `subdomain.domain.com`ou `www.subdomain.domain.com` em qualquer porta.</span><span class="sxs-lookup"><span data-stu-id="d5000-790">Host with wildcard: `*.domain.com`, matches `www.domain.com`, `subdomain.domain.com`, or `www.subdomain.domain.com` on any port.</span></span>
* <span data-ttu-id="d5000-791">Porta: `*:5000`, corresponde à porta 5000 com qualquer host.</span><span class="sxs-lookup"><span data-stu-id="d5000-791">Port: `*:5000`, matches port 5000 with any host.</span></span>
* <span data-ttu-id="d5000-792">Host e porta: `www.domain.com:5000` ou `*.domain.com:5000`, corresponde ao host e à porta.</span><span class="sxs-lookup"><span data-stu-id="d5000-792">Host and port: `www.domain.com:5000` or `*.domain.com:5000`, matches host and port.</span></span>

<span data-ttu-id="d5000-793">Vários parâmetros podem ser especificados usando `RequireHost` ou `[Host]`.</span><span class="sxs-lookup"><span data-stu-id="d5000-793">Multiple parameters can be specified using `RequireHost` or `[Host]`.</span></span> <span data-ttu-id="d5000-794">A restrição corresponde a hosts válidos para qualquer um dos parâmetros.</span><span class="sxs-lookup"><span data-stu-id="d5000-794">The constraint  matches hosts valid for any of the parameters.</span></span> <span data-ttu-id="d5000-795">Por exemplo, `[Host("domain.com", "*.domain.com")]` corresponde `domain.com`a `www.domain.com`, e `subdomain.domain.com`.</span><span class="sxs-lookup"><span data-stu-id="d5000-795">For example, `[Host("domain.com", "*.domain.com")]` matches `domain.com`, `www.domain.com`, and `subdomain.domain.com`.</span></span>

<span data-ttu-id="d5000-796">O código a seguir `RequireHost` usa para exigir o host especificado na rota:</span><span class="sxs-lookup"><span data-stu-id="d5000-796">The following code uses `RequireHost` to require the specified host on the route:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/StartupRequireHost.cs?name=snippet)]

<span data-ttu-id="d5000-797">O código a seguir usa `[Host]` o atributo no controlador para exigir qualquer um dos hosts especificados:</span><span class="sxs-lookup"><span data-stu-id="d5000-797">The following code uses the `[Host]` attribute on the controller to require any of the specified hosts:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/Controllers/ProductController.cs?name=snippet)]

<span data-ttu-id="d5000-798">Quando o `[Host]` atributo é aplicado ao método de controlador e de ação:</span><span class="sxs-lookup"><span data-stu-id="d5000-798">When the `[Host]` attribute is applied to both the controller and action method:</span></span>

* <span data-ttu-id="d5000-799">O atributo na ação é usado.</span><span class="sxs-lookup"><span data-stu-id="d5000-799">The attribute on the action is used.</span></span>
* <span data-ttu-id="d5000-800">O atributo do controlador é ignorado.</span><span class="sxs-lookup"><span data-stu-id="d5000-800">The controller attribute is ignored.</span></span>

## <a name="performance-guidance-for-routing"></a><span data-ttu-id="d5000-801">Diretrizes de desempenho para roteamento</span><span class="sxs-lookup"><span data-stu-id="d5000-801">Performance guidance for routing</span></span>

<span data-ttu-id="d5000-802">A maior parte do roteamento foi atualizada no ASP.NET Core 3,0 para aumentar o desempenho.</span><span class="sxs-lookup"><span data-stu-id="d5000-802">Most of routing was updated in ASP.NET Core 3.0 to increase performance.</span></span>

<span data-ttu-id="d5000-803">Quando um aplicativo tem problemas de desempenho, o roteamento geralmente é suspeito como o problema.</span><span class="sxs-lookup"><span data-stu-id="d5000-803">When an app has performance problems, routing is often suspected as the problem.</span></span> <span data-ttu-id="d5000-804">O motivo pelo qual o roteamento é suspeito é que as estruturas como controladores e Razor Pages relatam a quantidade de tempo gasto dentro da estrutura em suas mensagens de registro em log.</span><span class="sxs-lookup"><span data-stu-id="d5000-804">The reason routing is suspected is that frameworks like controllers and Razor Pages report the amount of time spent inside the framework in their logging messages.</span></span> <span data-ttu-id="d5000-805">Quando há uma diferença significativa entre a hora relatada pelos controladores e o tempo total da solicitação:</span><span class="sxs-lookup"><span data-stu-id="d5000-805">When there's a significant difference between the time reported by controllers and the total time of the request:</span></span>

* <span data-ttu-id="d5000-806">Os desenvolvedores eliminam o código do aplicativo como a origem do problema.</span><span class="sxs-lookup"><span data-stu-id="d5000-806">Developers eliminate their app code as the source of the problem.</span></span>
* <span data-ttu-id="d5000-807">É comum supor que o roteamento é a causa.</span><span class="sxs-lookup"><span data-stu-id="d5000-807">It's common to assume routing is the cause.</span></span>

<span data-ttu-id="d5000-808">O roteamento é o desempenho testado usando milhares de pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="d5000-808">Routing is performance tested using thousands of endpoints.</span></span> <span data-ttu-id="d5000-809">É improvável que um aplicativo típico encontre um problema de desempenho apenas por ser muito grande.</span><span class="sxs-lookup"><span data-stu-id="d5000-809">It's unlikely that a typical app will encounter a performance problem just by being too large.</span></span> <span data-ttu-id="d5000-810">A causa mais comum do desempenho de roteamento lento é geralmente um middleware personalizado com um comportamento incorreto.</span><span class="sxs-lookup"><span data-stu-id="d5000-810">The most common root cause of slow routing performance is usually a badly-behaving custom middleware.</span></span>

<span data-ttu-id="d5000-811">Este exemplo de código a seguir demonstra uma técnica básica para restringir a origem do atraso:</span><span class="sxs-lookup"><span data-stu-id="d5000-811">This following code sample demonstrates a basic technique for narrowing down the source of delay:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/StartupDelay.cs?name=snippet)]

<span data-ttu-id="d5000-812">Para o roteamento de tempo:</span><span class="sxs-lookup"><span data-stu-id="d5000-812">To time routing:</span></span>

* <span data-ttu-id="d5000-813">Intercalar cada middleware com uma cópia do middleware de tempo mostrado no código anterior.</span><span class="sxs-lookup"><span data-stu-id="d5000-813">Interleave each middleware with a copy of the timing middleware shown in the preceding code.</span></span>
* <span data-ttu-id="d5000-814">Adicione um identificador exclusivo para correlacionar os dados de tempo com o código.</span><span class="sxs-lookup"><span data-stu-id="d5000-814">Add a unique identifier to correlate the timing data with the code.</span></span>

<span data-ttu-id="d5000-815">Essa é uma maneira básica de restringir o atraso quando for significativo, por exemplo, mais do que `10ms`.</span><span class="sxs-lookup"><span data-stu-id="d5000-815">This is a basic way to narrow down the delay when it's significant, for example, more than `10ms`.</span></span>  <span data-ttu-id="d5000-816">A `Time 2` subtração `Time 1` de relata o tempo gasto dentro `UseRouting` do middleware.</span><span class="sxs-lookup"><span data-stu-id="d5000-816">Subtracting `Time 2` from `Time 1` reports the time spent inside the `UseRouting` middleware.</span></span>

<span data-ttu-id="d5000-817">O código a seguir usa uma abordagem mais compacta para o código de tempo anterior:</span><span class="sxs-lookup"><span data-stu-id="d5000-817">The following code uses a more compact approach to the preceding timing code:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/StartupSW.cs?name=snippetSW)]

[!code-csharp[](routing/samples/3.x/RoutingSample/StartupSW.cs?name=snippet)]

### <a name="potentially-expensive-routing-features"></a><span data-ttu-id="d5000-818">Recursos de roteamento potencialmente caros</span><span class="sxs-lookup"><span data-stu-id="d5000-818">Potentially expensive routing features</span></span>

<span data-ttu-id="d5000-819">A lista a seguir fornece uma visão geral dos recursos de roteamento que são relativamente caros em comparação com os modelos de rota básicos:</span><span class="sxs-lookup"><span data-stu-id="d5000-819">The following list provides some insight into routing features that are relatively expensive compared with basic route templates:</span></span>

* <span data-ttu-id="d5000-820">Expressões regulares: é possível escrever expressões regulares que são complexas ou ter tempo de execução demorado com uma pequena quantidade de entrada.</span><span class="sxs-lookup"><span data-stu-id="d5000-820">Regular expressions: It's possible to write regular expressions that are complex, or have long running time with a small amount of input.</span></span>

* <span data-ttu-id="d5000-821">Segmentos complexos (`{x}-{y}-{z}`):</span><span class="sxs-lookup"><span data-stu-id="d5000-821">Complex segments (`{x}-{y}-{z}`):</span></span> 
  * <span data-ttu-id="d5000-822">São significativamente mais caros do que analisar um segmento de caminho de URL regular.</span><span class="sxs-lookup"><span data-stu-id="d5000-822">Are significantly more expensive than parsing a regular URL path segment.</span></span>
  * <span data-ttu-id="d5000-823">Resulta em muitas subcadeias de caracteres que estão sendo alocadas.</span><span class="sxs-lookup"><span data-stu-id="d5000-823">Result in many more substrings being allocated.</span></span>
  * <span data-ttu-id="d5000-824">A lógica de segmento complexa não foi atualizada na atualização de desempenho de roteamento ASP.NET Core 3,0.</span><span class="sxs-lookup"><span data-stu-id="d5000-824">The complex segment logic was not updated in ASP.NET Core 3.0 routing performance update.</span></span>

* <span data-ttu-id="d5000-825">Acesso a dados síncronos: muitos aplicativos complexos têm acesso ao banco de dado como parte de seu roteamento.</span><span class="sxs-lookup"><span data-stu-id="d5000-825">Synchronous data access: Many complex apps have database access as part of their routing.</span></span> <span data-ttu-id="d5000-826">ASP.NET Core 2,2 e o roteamento anterior podem não fornecer os pontos de extensibilidade corretos para dar suporte ao roteamento de acesso ao banco de dados.</span><span class="sxs-lookup"><span data-stu-id="d5000-826">ASP.NET Core 2.2 and earlier routing might not provide the right extensibility points to support database access routing.</span></span> <span data-ttu-id="d5000-827">Por exemplo, <xref:Microsoft.AspNetCore.Routing.IRouteConstraint>e <xref:Microsoft.AspNetCore.Mvc.ActionConstraints.IActionConstraint> são síncronos.</span><span class="sxs-lookup"><span data-stu-id="d5000-827">For example, <xref:Microsoft.AspNetCore.Routing.IRouteConstraint>, and <xref:Microsoft.AspNetCore.Mvc.ActionConstraints.IActionConstraint> are synchronous.</span></span> <span data-ttu-id="d5000-828">Pontos de <xref:Microsoft.AspNetCore.Routing.MatcherPolicy> extensibilidade como e <xref:Microsoft.AspNetCore.Routing.EndpointSelectorContext> são assíncronos.</span><span class="sxs-lookup"><span data-stu-id="d5000-828">Extensibility points such as <xref:Microsoft.AspNetCore.Routing.MatcherPolicy> and <xref:Microsoft.AspNetCore.Routing.EndpointSelectorContext> are asynchronous.</span></span>

## <a name="guidance-for-library-authors"></a><span data-ttu-id="d5000-829">Diretrizes para autores de biblioteca</span><span class="sxs-lookup"><span data-stu-id="d5000-829">Guidance for library authors</span></span>

<span data-ttu-id="d5000-830">Esta seção contém diretrizes para autores de biblioteca com base no roteamento.</span><span class="sxs-lookup"><span data-stu-id="d5000-830">This section contains guidance for library authors building on top of routing.</span></span> <span data-ttu-id="d5000-831">Esses detalhes destinam-se a garantir que os desenvolvedores de aplicativos tenham uma boa experiência usando bibliotecas e estruturas que estendem o roteamento.</span><span class="sxs-lookup"><span data-stu-id="d5000-831">These details are intended to ensure that app developers have a good experience using libraries and frameworks that extend routing.</span></span>

### <a name="define-endpoints"></a><span data-ttu-id="d5000-832">Definir pontos de extremidade</span><span class="sxs-lookup"><span data-stu-id="d5000-832">Define endpoints</span></span>

<span data-ttu-id="d5000-833">Para criar uma estrutura que usa o roteamento para correspondência de URL, Comece definindo uma experiência de usuário que se baseia <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*>no.</span><span class="sxs-lookup"><span data-stu-id="d5000-833">To create a framework that uses routing for URL matching, start by defining a user experience that builds on top of <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*>.</span></span>

<span data-ttu-id="d5000-834">**Faça** a compilação acima de <xref:Microsoft.AspNetCore.Routing.IEndpointRouteBuilder>.</span><span class="sxs-lookup"><span data-stu-id="d5000-834">**DO** build on top of <xref:Microsoft.AspNetCore.Routing.IEndpointRouteBuilder>.</span></span> <span data-ttu-id="d5000-835">Isso permite que os usuários redijam sua estrutura com outros recursos de ASP.NET Core sem confusão.</span><span class="sxs-lookup"><span data-stu-id="d5000-835">This allows users to compose your framework with other ASP.NET Core features without confusion.</span></span> <span data-ttu-id="d5000-836">Cada modelo de ASP.NET Core inclui roteamento.</span><span class="sxs-lookup"><span data-stu-id="d5000-836">Every ASP.NET Core template includes routing.</span></span> <span data-ttu-id="d5000-837">Suponha que o roteamento esteja presente e familiar para os usuários.</span><span class="sxs-lookup"><span data-stu-id="d5000-837">Assume routing is present and familiar for users.</span></span>

```csharp
app.UseEndpoints(endpoints =>
{
    // Your framework
    endpoints.MapMyFramework(...);

    endpoints.MapHealthChecks("/healthz");
});
```

<span data-ttu-id="d5000-838">**Retorne um** tipo concreto lacrado de uma chamada `MapMyFramework(...)` para essa <xref:Microsoft.AspNetCore.Builder.IEndpointConventionBuilder>implementação.</span><span class="sxs-lookup"><span data-stu-id="d5000-838">**DO** return a sealed concrete type from a call to `MapMyFramework(...)` that implements <xref:Microsoft.AspNetCore.Builder.IEndpointConventionBuilder>.</span></span> <span data-ttu-id="d5000-839">A maioria `Map...` dos métodos de estrutura segue esse padrão.</span><span class="sxs-lookup"><span data-stu-id="d5000-839">Most framework `Map...` methods follow this pattern.</span></span> <span data-ttu-id="d5000-840">A `IEndpointConventionBuilder` interface:</span><span class="sxs-lookup"><span data-stu-id="d5000-840">The `IEndpointConventionBuilder` interface:</span></span>

* <span data-ttu-id="d5000-841">Permite a capacidade de composição de metadados.</span><span class="sxs-lookup"><span data-stu-id="d5000-841">Allows composability of metadata.</span></span>
* <span data-ttu-id="d5000-842">É direcionado por uma variedade de métodos de extensão.</span><span class="sxs-lookup"><span data-stu-id="d5000-842">Is targeted by a variety of extension methods.</span></span>

<span data-ttu-id="d5000-843">Declarar seu próprio tipo permite que você adicione sua própria funcionalidade específica à estrutura ao construtor.</span><span class="sxs-lookup"><span data-stu-id="d5000-843">Declaring your own type allows you to add your own framework-specific functionality to the builder.</span></span> <span data-ttu-id="d5000-844">Está OK para encapsular um construtor declarado por estrutura e encaminhar chamadas para ele.</span><span class="sxs-lookup"><span data-stu-id="d5000-844">It's ok to wrap a framework-declared builder and forward calls to it.</span></span>

```csharp
app.UseEndpoints(endpoints =>
{
    // Your framework
    endpoints.MapMyFramework(...).RequrireAuthorization()
                                 .WithMyFrameworkFeature(awesome: true);

    endpoints.MapHealthChecks("/healthz");
});
```

<span data-ttu-id="d5000-845">**Considere** escrever o seu <xref:Microsoft.AspNetCore.Routing.EndpointDataSource>próprio.</span><span class="sxs-lookup"><span data-stu-id="d5000-845">**CONSIDER** writing your own <xref:Microsoft.AspNetCore.Routing.EndpointDataSource>.</span></span> <span data-ttu-id="d5000-846">`EndpointDataSource`é o primitivo de baixo nível para declarar e atualizar uma coleção de pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="d5000-846">`EndpointDataSource` is the low-level primitive for declaring and updating a collection of endpoints.</span></span> <span data-ttu-id="d5000-847">`EndpointDataSource`é uma API avançada usada por controladores e Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="d5000-847">`EndpointDataSource` is a powerful API used by controllers and Razor Pages.</span></span>

<span data-ttu-id="d5000-848">Os testes de roteamento têm um [exemplo básico](https://github.com/aspnet/AspNetCore/blob/master/src/Http/Routing/test/testassets/RoutingSandbox/Framework/FrameworkEndpointDataSource.cs#L17) de uma fonte de dados não atualizada.</span><span class="sxs-lookup"><span data-stu-id="d5000-848">The routing tests have a [basic example](https://github.com/aspnet/AspNetCore/blob/master/src/Http/Routing/test/testassets/RoutingSandbox/Framework/FrameworkEndpointDataSource.cs#L17) of a non-updating data source.</span></span>

<span data-ttu-id="d5000-849">**Não** tente registrar um `EndpointDataSource` por padrão.</span><span class="sxs-lookup"><span data-stu-id="d5000-849">**DO NOT** attempt to register an `EndpointDataSource` by default.</span></span> <span data-ttu-id="d5000-850">Exigir que os usuários registrem sua <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*>estrutura no.</span><span class="sxs-lookup"><span data-stu-id="d5000-850">Require users to register your framework in <xref:Microsoft.AspNetCore.Builder.EndpointRoutingApplicationBuilderExtensions.UseEndpoints*>.</span></span> <span data-ttu-id="d5000-851">A filosofia do roteamento é que nada é incluído por padrão, e esse `UseEndpoints` é o local para registrar pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="d5000-851">The philosophy of routing is that nothing is included by default, and that `UseEndpoints` is the place to register endpoints.</span></span>

### <a name="creating-routing-integrated-middleware"></a><span data-ttu-id="d5000-852">Criando middleware integrado de roteamento</span><span class="sxs-lookup"><span data-stu-id="d5000-852">Creating routing-integrated middleware</span></span>

<span data-ttu-id="d5000-853">**Considere** definir tipos de metadados como uma interface.</span><span class="sxs-lookup"><span data-stu-id="d5000-853">**CONSIDER** defining metadata types as an interface.</span></span>

<span data-ttu-id="d5000-854">**Faça com** que seja possível usar tipos de metadados como um atributo em classes e métodos.</span><span class="sxs-lookup"><span data-stu-id="d5000-854">**DO** make it possible to use metadata types as an attribute on classes and methods.</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/ICoolMetadata.cs?name=snippet2)]

<span data-ttu-id="d5000-855">Estruturas como controladores e Razor Pages dão suporte à aplicação de atributos de metadados a tipos e métodos.</span><span class="sxs-lookup"><span data-stu-id="d5000-855">Frameworks like controllers and Razor Pages support applying metadata attributes to types and methods.</span></span> <span data-ttu-id="d5000-856">Se você declarar tipos de metadados:</span><span class="sxs-lookup"><span data-stu-id="d5000-856">If you declare metadata types:</span></span>

* <span data-ttu-id="d5000-857">Torná-los acessíveis como [atributos](/dotnet/csharp/programming-guide/concepts/attributes/).</span><span class="sxs-lookup"><span data-stu-id="d5000-857">Make them accessible as [attributes](/dotnet/csharp/programming-guide/concepts/attributes/).</span></span>
* <span data-ttu-id="d5000-858">A maioria dos usuários está familiarizada com a aplicação de atributos.</span><span class="sxs-lookup"><span data-stu-id="d5000-858">Most users are familiar with applying attributes.</span></span>

<span data-ttu-id="d5000-859">Declarar um tipo de metadados como uma interface adiciona outra camada de flexibilidade:</span><span class="sxs-lookup"><span data-stu-id="d5000-859">Declaring a metadata type as an interface adds another layer of flexibility:</span></span>

* <span data-ttu-id="d5000-860">As interfaces são combináveis.</span><span class="sxs-lookup"><span data-stu-id="d5000-860">Interfaces are composable.</span></span>
* <span data-ttu-id="d5000-861">Os desenvolvedores podem declarar seus próprios tipos que combinam várias políticas.</span><span class="sxs-lookup"><span data-stu-id="d5000-861">Developers can declare their own types that combine multiple policies.</span></span>

<span data-ttu-id="d5000-862">**Faça com** que seja possível substituir os metadados, conforme mostrado no exemplo a seguir:</span><span class="sxs-lookup"><span data-stu-id="d5000-862">**DO** make it possible to override metadata, as shown in the following example:</span></span>

[!code-csharp[](routing/samples/3.x/RoutingSample/ICoolMetadata.cs?name=snippet)]

<span data-ttu-id="d5000-863">A melhor maneira de seguir essas diretrizes é evitar a definição de **metadados de marcador**:</span><span class="sxs-lookup"><span data-stu-id="d5000-863">The best way to follow these guidelines is to avoid defining **marker metadata**:</span></span>

* <span data-ttu-id="d5000-864">Não procure apenas a presença de um tipo de metadados.</span><span class="sxs-lookup"><span data-stu-id="d5000-864">Don't just look for the presence of a metadata type.</span></span>
* <span data-ttu-id="d5000-865">Defina uma propriedade nos metadados e verifique a propriedade.</span><span class="sxs-lookup"><span data-stu-id="d5000-865">Define a property on the metadata and check the property.</span></span>

<span data-ttu-id="d5000-866">A coleção de metadados é ordenada e dá suporte à substituição por prioridade.</span><span class="sxs-lookup"><span data-stu-id="d5000-866">The metadata collection is ordered and supports overriding by priority.</span></span> <span data-ttu-id="d5000-867">No caso de controladores, os metadados no método de ação são mais específicos.</span><span class="sxs-lookup"><span data-stu-id="d5000-867">In the case of controllers, metadata on the action method is most specific.</span></span>

<span data-ttu-id="d5000-868">**Faça com que o** middleware seja útil com e sem roteamento.</span><span class="sxs-lookup"><span data-stu-id="d5000-868">**DO** make middleware useful with and without routing.</span></span>

```csharp
app.UseRouting();

app.UseAuthorization(new AuthorizationPolicy() { ... });

app.UseEndpoints(endpoints =>
{
    // Your framework
    endpoints.MapMyFramework(...).RequrireAuthorization();
});
```

<span data-ttu-id="d5000-869">Como exemplo dessa diretriz, considere o `UseAuthorization` middleware.</span><span class="sxs-lookup"><span data-stu-id="d5000-869">As an example of this guideline, consider the `UseAuthorization` middleware.</span></span> <span data-ttu-id="d5000-870">O middleware de autorização permite que você passe uma política de fallback.</span><span class="sxs-lookup"><span data-stu-id="d5000-870">The authorization middleware allows you to pass in a fallback policy.</span></span> <!-- shown where?  (shown here) --> <span data-ttu-id="d5000-871">A política de fallback, se especificada, se aplica a ambos:</span><span class="sxs-lookup"><span data-stu-id="d5000-871">The fallback policy, if specified, applies to both:</span></span>

* <span data-ttu-id="d5000-872">Pontos de extremidade sem uma política especificada.</span><span class="sxs-lookup"><span data-stu-id="d5000-872">Endpoints without a specified policy.</span></span>
* <span data-ttu-id="d5000-873">Solicitações que não correspondem a um ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="d5000-873">Requests that don't match an endpoint.</span></span>

<span data-ttu-id="d5000-874">Isso torna o middleware de autorização útil fora do contexto do roteamento.</span><span class="sxs-lookup"><span data-stu-id="d5000-874">This makes the authorization middleware useful outside of the context of routing.</span></span> <span data-ttu-id="d5000-875">O middleware de autorização pode ser usado para programação de middleware tradicional.</span><span class="sxs-lookup"><span data-stu-id="d5000-875">The authorization middleware can be used for traditional middleware programming.</span></span>

[!INCLUDE[](~/includes/dbg-route.md)]

::: moniker-end

::: moniker range="= aspnetcore-2.2"

<span data-ttu-id="d5000-876">O roteamento é responsável por mapear URIs de solicitação para pontos de extremidade e expedir solicitações de entrada para esses pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="d5000-876">Routing is responsible for mapping request URIs to endpoints and dispatching incoming requests to those endpoints.</span></span> <span data-ttu-id="d5000-877">As rotas são definidas no aplicativo e configuradas quando o aplicativo é iniciado.</span><span class="sxs-lookup"><span data-stu-id="d5000-877">Routes are defined in the app and configured when the app starts.</span></span> <span data-ttu-id="d5000-878">Uma rota pode opcionalmente extrair os valores da URL contida na solicitação e esses valores podem então ser usados para o processamento da solicitação.</span><span class="sxs-lookup"><span data-stu-id="d5000-878">A route can optionally extract values from the URL contained in the request, and these values can then be used for request processing.</span></span> <span data-ttu-id="d5000-879">Usando informações de rota do aplicativo, o roteamento também é capaz de gerar URLs que são mapeadas para pontos de extremidade.</span><span class="sxs-lookup"><span data-stu-id="d5000-879">Using route information from the app, routing is also able to generate URLs that map to endpoints.</span></span>

<span data-ttu-id="d5000-880">Para usar os últimos cenários de roteamento no ASP.NET Core 2.2, especifique a [versão de compatibilidade](xref:mvc/compatibility-version) com o registro de serviços MVC em `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="d5000-880">To use the latest routing scenarios in ASP.NET Core 2.2, specify the [compatibility version](xref:mvc/compatibility-version) to the MVC services registration in `Startup.ConfigureServices`:</span></span>

```csharp
services.AddMvc()
    .SetCompatibilityVersion(CompatibilityVersion.Version_2_2);
```

<span data-ttu-id="d5000-881">A opção <xref:Microsoft.AspNetCore.Mvc.MvcOptions.EnableEndpointRouting> determina se o roteamento deve usar internamente a lógica baseada em ponto de extremidade ou a lógica baseada em <xref:Microsoft.AspNetCore.Routing.IRouter> do ASP.NET Core 2.1 ou anterior.</span><span class="sxs-lookup"><span data-stu-id="d5000-881">The <xref:Microsoft.AspNetCore.Mvc.MvcOptions.EnableEndpointRouting> option determines if routing should internally use endpoint-based logic or the <xref:Microsoft.AspNetCore.Routing.IRouter>-based logic of ASP.NET Core 2.1 or earlier.</span></span> <span data-ttu-id="d5000-882">Quando a versão de compatibilidade é definida como 2.2 ou posterior, o valor padrão é `true`.</span><span class="sxs-lookup"><span data-stu-id="d5000-882">When the compatibility version is set to 2.2 or later, the default value is `true`.</span></span> <span data-ttu-id="d5000-883">Defina o valor como `false` para usar a lógica de roteamento anterior:</span><span class="sxs-lookup"><span data-stu-id="d5000-883">Set the value to `false` to use the prior routing logic:</span></span>

```csharp
// Use the routing logic of ASP.NET Core 2.1 or earlier:
services.AddMvc(options => options.EnableEndpointRouting = false)
    .SetCompatibilityVersion(CompatibilityVersion.Version_2_2);
```

<span data-ttu-id="d5000-884">Para obter mais informações sobre o roteamento baseado em <xref:Microsoft.AspNetCore.Routing.IRouter>, confira a [versão do ASP.NET Core 2.1 deste tópico](/aspnet/core/fundamentals/routing?view=aspnetcore-2.1).</span><span class="sxs-lookup"><span data-stu-id="d5000-884">For more information on <xref:Microsoft.AspNetCore.Routing.IRouter>-based routing, see the [ASP.NET Core 2.1 version of this topic](/aspnet/core/fundamentals/routing?view=aspnetcore-2.1).</span></span>

> [!IMPORTANT]
> <span data-ttu-id="d5000-885">Este documento aborda o roteamento de nível inferior do ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="d5000-885">This document covers low-level ASP.NET Core routing.</span></span> <span data-ttu-id="d5000-886">Para obter informações sobre o roteamento do ASP.NET Core MVC, confira <xref:mvc/controllers/routing>.</span><span class="sxs-lookup"><span data-stu-id="d5000-886">For information on ASP.NET Core MVC routing, see <xref:mvc/controllers/routing>.</span></span> <span data-ttu-id="d5000-887">Para obter informações sobre convenções de roteamento no Razor Pages, confira <xref:razor-pages/razor-pages-conventions>.</span><span class="sxs-lookup"><span data-stu-id="d5000-887">For information on routing conventions in Razor Pages, see <xref:razor-pages/razor-pages-conventions>.</span></span>

<span data-ttu-id="d5000-888">[Exibir ou baixar código de exemplo](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/routing/samples) ([como baixar](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="d5000-888">[View or download sample code](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/routing/samples) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="routing-basics"></a><span data-ttu-id="d5000-889">Conceitos básicos sobre roteamento</span><span class="sxs-lookup"><span data-stu-id="d5000-889">Routing basics</span></span>

<span data-ttu-id="d5000-890">A maioria dos aplicativos deve escolher um esquema de roteamento básico e descritivo para que as URLs sejam legíveis e significativas.</span><span class="sxs-lookup"><span data-stu-id="d5000-890">Most apps should choose a basic and descriptive routing scheme so that URLs are readable and meaningful.</span></span> <span data-ttu-id="d5000-891">A rota convencional padrão `{controller=Home}/{action=Index}/{id?}`:</span><span class="sxs-lookup"><span data-stu-id="d5000-891">The default conventional route `{controller=Home}/{action=Index}/{id?}`:</span></span>

* <span data-ttu-id="d5000-892">Dá suporte a um esquema de roteamento básico e descritivo.</span><span class="sxs-lookup"><span data-stu-id="d5000-892">Supports a basic and descriptive routing scheme.</span></span>
* <span data-ttu-id="d5000-893">É um ponto de partida útil para aplicativos baseados em interface do usuário.</span><span class="sxs-lookup"><span data-stu-id="d5000-893">Is a useful starting point for UI-based apps.</span></span>

<span data-ttu-id="d5000-894">Os desenvolvedores normalmente adicionam rotas rencisas adicionais a áreas de tráfego intenso de um aplicativo em situações especializadas usando [Roteamento de atributos](xref:mvc/controllers/routing#attribute-routing) ou rotas convencionais dedicadas.</span><span class="sxs-lookup"><span data-stu-id="d5000-894">Developers commonly add additional terse routes to high-traffic areas of an app in specialized situations using [attribute routing](xref:mvc/controllers/routing#attribute-routing) or dedicated conventional routes.</span></span> <span data-ttu-id="d5000-895">Exemplos de situações especializadas incluem pontos de extremidade de blog e de comércio eletrônico.</span><span class="sxs-lookup"><span data-stu-id="d5000-895">Specialized situations examples include, blog and ecommerce endpoints.</span></span>

<span data-ttu-id="d5000-896">As APIs da Web devem usar o roteamento de atributo para modelar a funcionalidade do aplicativo como um conjunto de recursos em que as operações são representadas por verbos HTTP.</span><span class="sxs-lookup"><span data-stu-id="d5000-896">Web APIs should use attribute routing to model the app's functionality as a set of resources where operations are represented by HTTP verbs.</span></span> <span data-ttu-id="d5000-897">Isso significa que muitas operações, por exemplo, GET e POST, no mesmo recurso lógico usam a mesma URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-897">This means that many operations, for example, GET, and POST, on the same logical resource use the same URL.</span></span> <span data-ttu-id="d5000-898">O roteamento de atributo fornece um nível de controle necessário para projetar cuidadosamente o layout de ponto de extremidade público de uma API.</span><span class="sxs-lookup"><span data-stu-id="d5000-898">Attribute routing provides a level of control that's needed to carefully design an API's public endpoint layout.</span></span>

<span data-ttu-id="d5000-899">Os aplicativos do Razor Pages usam o roteamento convencional padrão para fornecer recursos nomeados na pasta *Pages* de um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d5000-899">Razor Pages apps use default conventional routing to serve named resources in the *Pages* folder of an app.</span></span> <span data-ttu-id="d5000-900">Estão disponíveis convenções adicionais que permitem a personalização do comportamento de roteamento do Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="d5000-900">Additional conventions are available that allow you to customize Razor Pages routing behavior.</span></span> <span data-ttu-id="d5000-901">Para obter mais informações, consulte <xref:razor-pages/index> e <xref:razor-pages/razor-pages-conventions>.</span><span class="sxs-lookup"><span data-stu-id="d5000-901">For more information, see <xref:razor-pages/index> and <xref:razor-pages/razor-pages-conventions>.</span></span>

<span data-ttu-id="d5000-902">O suporte à geração de URL permite que o aplicativo seja desenvolvido sem hard-coding das URLs para vincular o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d5000-902">URL generation support allows the app to be developed without hard-coding URLs to link the app together.</span></span> <span data-ttu-id="d5000-903">Esse suporte permite começar com uma configuração de roteamento básica e modificar as rotas, depois que o layout de recurso do aplicativo é determinado.</span><span class="sxs-lookup"><span data-stu-id="d5000-903">This support allows for starting with a basic routing configuration and modifying the routes after the app's resource layout is determined.</span></span>

<span data-ttu-id="d5000-904">O roteamento usa *pontos* de extremidade`Endpoint`() para representar pontos de extremidade lógicos em um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d5000-904">Routing uses *endpoints* (`Endpoint`) to represent logical endpoints in an app.</span></span>

<span data-ttu-id="d5000-905">Um ponto de extremidade define um delegado para processar solicitações e uma coleção de metadados arbitrários.</span><span class="sxs-lookup"><span data-stu-id="d5000-905">An endpoint defines a delegate to process requests and a collection of arbitrary metadata.</span></span> <span data-ttu-id="d5000-906">Os metadados usados implementam interesses paralelos com base em políticas e na configuração anexada a cada ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="d5000-906">The metadata is used implement cross-cutting concerns based on policies and configuration attached to each endpoint.</span></span>

<span data-ttu-id="d5000-907">O sistema de roteamento tem as seguintes características:</span><span class="sxs-lookup"><span data-stu-id="d5000-907">The routing system has the following characteristics:</span></span>

* <span data-ttu-id="d5000-908">A sintaxe do modelo de rota é usada para definir rotas com os parâmetros de rota com tokens criados.</span><span class="sxs-lookup"><span data-stu-id="d5000-908">Route template syntax is used to define routes with tokenized route parameters.</span></span>
* <span data-ttu-id="d5000-909">A configuração de ponto de extremidade de estilo convencional e de estilo de atributo é permitida.</span><span class="sxs-lookup"><span data-stu-id="d5000-909">Conventional-style and attribute-style endpoint configuration is permitted.</span></span>
* <span data-ttu-id="d5000-910"><xref:Microsoft.AspNetCore.Routing.IRouteConstraint> é usado para determinar se um parâmetro de URL contém um valor válido para determinada restrição de ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="d5000-910"><xref:Microsoft.AspNetCore.Routing.IRouteConstraint> is used to determine whether a URL parameter contains a valid value for a given endpoint constraint.</span></span>
* <span data-ttu-id="d5000-911">Modelos de aplicativo, como MVC/Razor Pages, registram todos os seus pontos de extremidade, que têm uma implementação previsível de cenários de roteamento.</span><span class="sxs-lookup"><span data-stu-id="d5000-911">App models, such as MVC/Razor Pages, register all of their endpoints, which have a predictable implementation of routing scenarios.</span></span>
* <span data-ttu-id="d5000-912">A implementação de roteamento toma decisões de roteamento, sempre que desejado no pipeline de middleware.</span><span class="sxs-lookup"><span data-stu-id="d5000-912">The routing implementation makes routing decisions wherever desired in the middleware pipeline.</span></span>
* <span data-ttu-id="d5000-913">O Middleware que aparece após um Middleware de Roteamento pode inspecionar o resultado da decisão de ponto de extremidade do Middleware de Roteamento para determinado URI de solicitação.</span><span class="sxs-lookup"><span data-stu-id="d5000-913">Middleware that appears after a Routing Middleware can inspect the result of the Routing Middleware's endpoint decision for a given request URI.</span></span>
* <span data-ttu-id="d5000-914">É possível enumerar todos os pontos de extremidade no aplicativo em qualquer lugar do pipeline de middleware.</span><span class="sxs-lookup"><span data-stu-id="d5000-914">It's possible to enumerate all of the endpoints in the app anywhere in the middleware pipeline.</span></span>
* <span data-ttu-id="d5000-915">Um aplicativo pode usar o roteamento para gerar URLs (por exemplo, para redirecionamento ou links) com base nas informações de ponto de extremidade e evitar URLs embutidas em código, o que ajuda na facilidade de manutenção.</span><span class="sxs-lookup"><span data-stu-id="d5000-915">An app can use routing to generate URLs (for example, for redirection or links) based on endpoint information and thus avoid hard-coded URLs, which helps maintainability.</span></span>
* <span data-ttu-id="d5000-916">A geração de URL baseia-se em endereços, que dá suporte à extensibilidade arbitrária:</span><span class="sxs-lookup"><span data-stu-id="d5000-916">URL generation is based on addresses, which support arbitrary extensibility:</span></span>

  * <span data-ttu-id="d5000-917">A API de Gerador de Link (<xref:Microsoft.AspNetCore.Routing.LinkGenerator>) pode ser resolvida em qualquer lugar usando a [DI (Injeção de Dependência)](xref:fundamentals/dependency-injection) para gerar URLs.</span><span class="sxs-lookup"><span data-stu-id="d5000-917">The Link Generator API (<xref:Microsoft.AspNetCore.Routing.LinkGenerator>) can be resolved anywhere using [dependency injection (DI)](xref:fundamentals/dependency-injection) to generate URLs.</span></span>
  * <span data-ttu-id="d5000-918">Quando a API de Gerador de Link não está disponível por meio da DI, <xref:Microsoft.AspNetCore.Mvc.IUrlHelper> oferece métodos para criar URLs.</span><span class="sxs-lookup"><span data-stu-id="d5000-918">Where the Link Generator API isn't available via DI, <xref:Microsoft.AspNetCore.Mvc.IUrlHelper> offers methods to build URLs.</span></span>

> [!NOTE]
> <span data-ttu-id="d5000-919">Com o lançamento do roteamento de ponto de extremidade no ASP.NET Core 2.2, a vinculação de ponto de extremidade fica limitada às ações e às páginas do MVC/Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="d5000-919">With the release of endpoint routing in ASP.NET Core 2.2, endpoint linking is limited to MVC/Razor Pages actions and pages.</span></span> <span data-ttu-id="d5000-920">As expansões de funcionalidades de vinculação de ponto de extremidade estão planejadas para versões futuras.</span><span class="sxs-lookup"><span data-stu-id="d5000-920">The expansions of endpoint-linking capabilities is planned for future releases.</span></span>

<span data-ttu-id="d5000-921">O roteamento está conectado ao pipeline do [middleware](xref:fundamentals/middleware/index) pela classe <xref:Microsoft.AspNetCore.Builder.RouterMiddleware>.</span><span class="sxs-lookup"><span data-stu-id="d5000-921">Routing is connected to the [middleware](xref:fundamentals/middleware/index) pipeline by the <xref:Microsoft.AspNetCore.Builder.RouterMiddleware> class.</span></span> <span data-ttu-id="d5000-922">O [ASP.NET Core MVC](xref:mvc/overview) adiciona o roteamento ao pipeline de middleware como parte de sua configuração e manipula o roteamento nos aplicativos do MVC e do Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="d5000-922">[ASP.NET Core MVC](xref:mvc/overview) adds routing to the middleware pipeline as part of its configuration and handles routing in MVC and Razor Pages apps.</span></span> <span data-ttu-id="d5000-923">Para saber como usar o roteamento como um componente autônomo, confira a seção [Usar o Middleware de Roteamento](#use-routing-middleware).</span><span class="sxs-lookup"><span data-stu-id="d5000-923">To learn how to use routing as a standalone component, see the [Use Routing Middleware](#use-routing-middleware) section.</span></span>

### <a name="url-matching"></a><span data-ttu-id="d5000-924">Correspondência de URL</span><span class="sxs-lookup"><span data-stu-id="d5000-924">URL matching</span></span>

<span data-ttu-id="d5000-925">A correspondência de URL é o processo pelo qual o roteamento expede uma solicitação de entrada para um *ponto de extremidade*.</span><span class="sxs-lookup"><span data-stu-id="d5000-925">URL matching is the process by which routing dispatches an incoming request to an *endpoint*.</span></span> <span data-ttu-id="d5000-926">Esse processo se baseia nos dados do caminho da URL, mas pode ser estendido para considerar qualquer dado na solicitação.</span><span class="sxs-lookup"><span data-stu-id="d5000-926">This process is based on data in the URL path but can be extended to consider any data in the request.</span></span> <span data-ttu-id="d5000-927">A capacidade de expedir solicitações para manipuladores separados é fundamental para dimensionar o tamanho e a complexidade de um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d5000-927">The ability to dispatch requests to separate handlers is key to scaling the size and complexity of an app.</span></span>

<span data-ttu-id="d5000-928">O sistema de roteamento no roteamento de ponto de extremidade é responsável por todas as decisões de expedição.</span><span class="sxs-lookup"><span data-stu-id="d5000-928">The routing system in endpoint routing is responsible for all dispatching decisions.</span></span> <span data-ttu-id="d5000-929">Como o middleware aplica políticas com base no ponto de extremidade selecionado, é importante que qualquer decisão que possa afetar a expedição ou a aplicação de políticas de segurança seja feita dentro do sistema de roteamento.</span><span class="sxs-lookup"><span data-stu-id="d5000-929">Since the middleware applies policies based on the selected endpoint, it's important that any decision that can affect dispatching or the application of security policies is made inside the routing system.</span></span>

<span data-ttu-id="d5000-930">Quando o delegado do ponto de extremidade é executado, as propriedades de [RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData) são definidas com valores apropriados com base no processamento da solicitação executado até o momento.</span><span class="sxs-lookup"><span data-stu-id="d5000-930">When the endpoint delegate is executed, the properties of [RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData) are set to appropriate values based on the request processing performed thus far.</span></span>

<span data-ttu-id="d5000-931">[RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values*) é um dicionário de *valores de rota* produzido por meio da rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-931">[RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values*) is a dictionary of *route values* produced from the route.</span></span> <span data-ttu-id="d5000-932">Esses valores geralmente são determinados pela criação de token da URL e podem ser usados para aceitar a entrada do usuário ou tomar outras decisões de expedição dentro do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d5000-932">These values are usually determined by tokenizing the URL and can be used to accept user input or to make further dispatching decisions inside the app.</span></span>

<span data-ttu-id="d5000-933">[RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) é um recipiente de propriedades de dados adicionais relacionados à rota correspondente.</span><span class="sxs-lookup"><span data-stu-id="d5000-933">[RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) is a property bag of additional data related to the matched route.</span></span> <span data-ttu-id="d5000-934"><xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*> são fornecidos para dar suporte à associação de dados de estado com cada rota para que o aplicativo possa tomar decisões com base em qual rota teve uma correspondência.</span><span class="sxs-lookup"><span data-stu-id="d5000-934"><xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*> are provided to support associating state data with each route so that the app can make decisions based on which route matched.</span></span> <span data-ttu-id="d5000-935">Esses valores são definidos pelo desenvolvedor e **não** afetam de forma alguma o comportamento do roteamento.</span><span class="sxs-lookup"><span data-stu-id="d5000-935">These values are developer-defined and do **not** affect the behavior of routing in any way.</span></span> <span data-ttu-id="d5000-936">Além disso, os valores em stash em [RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) podem ser de qualquer tipo, ao contrário de [RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values), que devem ser conversíveis de/para cadeias de caracteres.</span><span class="sxs-lookup"><span data-stu-id="d5000-936">Additionally, values stashed in [RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) can be of any type, in contrast to [RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values), which must be convertible to and from strings.</span></span>

<span data-ttu-id="d5000-937">[RouteData.Routers](xref:Microsoft.AspNetCore.Routing.RouteData.Routers) é uma lista das rotas que participaram da correspondência bem-sucedida da solicitação.</span><span class="sxs-lookup"><span data-stu-id="d5000-937">[RouteData.Routers](xref:Microsoft.AspNetCore.Routing.RouteData.Routers) is a list of the routes that took part in successfully matching the request.</span></span> <span data-ttu-id="d5000-938">As rotas podem ser aninhadas uma dentro da outra.</span><span class="sxs-lookup"><span data-stu-id="d5000-938">Routes can be nested inside of one another.</span></span> <span data-ttu-id="d5000-939">A propriedade <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> reflete o caminho pela árvore lógica de rotas que resultou em uma correspondência.</span><span class="sxs-lookup"><span data-stu-id="d5000-939">The <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> property reflects the path through the logical tree of routes that resulted in a match.</span></span> <span data-ttu-id="d5000-940">Em geral, o primeiro item em <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> é a coleção de rotas e deve ser usado para a geração de URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-940">Generally, the first item in <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> is the route collection and should be used for URL generation.</span></span> <span data-ttu-id="d5000-941">O último item em <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> é o manipulador de rotas que teve uma correspondência.</span><span class="sxs-lookup"><span data-stu-id="d5000-941">The last item in <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> is the route handler that matched.</span></span>

<a name="lg"></a>

### <a name="url-generation-with-linkgenerator"></a><span data-ttu-id="d5000-942">Geração de URL com o LinkGenerator</span><span class="sxs-lookup"><span data-stu-id="d5000-942">URL generation with LinkGenerator</span></span>

<span data-ttu-id="d5000-943">Geração de URL é o processo pelo qual o roteamento pode criar um caminho de URL de acordo com um conjunto de valores de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-943">URL generation is the process by which routing can create a URL path based on a set of route values.</span></span> <span data-ttu-id="d5000-944">Isso permite uma separação lógica entre os pontos de extremidade e as URLs que os acessam.</span><span class="sxs-lookup"><span data-stu-id="d5000-944">This allows for a logical separation between your endpoints and the URLs that access them.</span></span>

<span data-ttu-id="d5000-945">O roteamento de ponto de extremidade inclui a API de Gerador de Link (<xref:Microsoft.AspNetCore.Routing.LinkGenerator>).</span><span class="sxs-lookup"><span data-stu-id="d5000-945">Endpoint routing includes the Link Generator API (<xref:Microsoft.AspNetCore.Routing.LinkGenerator>).</span></span> <span data-ttu-id="d5000-946"><xref:Microsoft.AspNetCore.Routing.LinkGenerator>é um serviço singleton que pode ser recuperado de [di](xref:fundamentals/dependency-injection).</span><span class="sxs-lookup"><span data-stu-id="d5000-946"><xref:Microsoft.AspNetCore.Routing.LinkGenerator> is a singleton service that can be retrieved from [DI](xref:fundamentals/dependency-injection).</span></span> <span data-ttu-id="d5000-947">A API pode ser usada fora do contexto de uma solicitação em execução.</span><span class="sxs-lookup"><span data-stu-id="d5000-947">The API can be used outside of the context of an executing request.</span></span> <span data-ttu-id="d5000-948"><xref:Microsoft.AspNetCore.Mvc.IUrlHelper> do MVC e cenários que dependem de <xref:Microsoft.AspNetCore.Mvc.IUrlHelper>, como [Auxiliares de Marcação](xref:mvc/views/tag-helpers/intro), Auxiliares de HTML e [Resultados da Ação](xref:mvc/controllers/actions), usam o gerador de link para fornecer funcionalidades de geração de link.</span><span class="sxs-lookup"><span data-stu-id="d5000-948">MVC's <xref:Microsoft.AspNetCore.Mvc.IUrlHelper> and scenarios that rely on <xref:Microsoft.AspNetCore.Mvc.IUrlHelper>, such as [Tag Helpers](xref:mvc/views/tag-helpers/intro), HTML Helpers, and [Action Results](xref:mvc/controllers/actions), use the link generator to provide link generating capabilities.</span></span>

<span data-ttu-id="d5000-949">O gerador de link é respaldado pelo conceito de um *endereço* e *esquemas de endereço*.</span><span class="sxs-lookup"><span data-stu-id="d5000-949">The link generator is backed by the concept of an *address* and *address schemes*.</span></span> <span data-ttu-id="d5000-950">Um esquema de endereço é uma maneira de determinar os pontos de extremidade que devem ser considerados para a geração de link.</span><span class="sxs-lookup"><span data-stu-id="d5000-950">An address scheme is a way of determining the endpoints that should be considered for link generation.</span></span> <span data-ttu-id="d5000-951">Por exemplo, os cenários de nome de rota e valores de rota com os quais muitos usuários estão familiarizados no MVC/Razor Pages são implementados como um esquema de endereço.</span><span class="sxs-lookup"><span data-stu-id="d5000-951">For example, the route name and route values scenarios many users are familiar with from MVC/Razor Pages are implemented as an address scheme.</span></span>

<span data-ttu-id="d5000-952">O gerador de link pode ser vinculado a ações e páginas do MVC/Razor Pages por meio dos seguintes métodos de extensão:</span><span class="sxs-lookup"><span data-stu-id="d5000-952">The link generator can link to MVC/Razor Pages actions and pages via the following extension methods:</span></span>

* <xref:Microsoft.AspNetCore.Routing.ControllerLinkGeneratorExtensions.GetPathByAction*>
* <xref:Microsoft.AspNetCore.Routing.ControllerLinkGeneratorExtensions.GetUriByAction*>
* <xref:Microsoft.AspNetCore.Routing.PageLinkGeneratorExtensions.GetPathByPage*>
* <xref:Microsoft.AspNetCore.Routing.PageLinkGeneratorExtensions.GetUriByPage*>

<span data-ttu-id="d5000-953">Uma sobrecarga desses métodos aceita argumentos que incluem o `HttpContext`.</span><span class="sxs-lookup"><span data-stu-id="d5000-953">An overload of these methods accepts arguments that include the `HttpContext`.</span></span> <span data-ttu-id="d5000-954">Esses métodos são funcionalmente equivalentes a `Url.Action` e `Url.Page`, mas oferecem mais flexibilidade e opções.</span><span class="sxs-lookup"><span data-stu-id="d5000-954">These methods are functionally equivalent to `Url.Action` and `Url.Page` but offer additional flexibility and options.</span></span>

<span data-ttu-id="d5000-955">Os métodos `GetPath*` são mais semelhantes a `Url.Action` e `Url.Page`, pois geram um URI que contém um caminho absoluto.</span><span class="sxs-lookup"><span data-stu-id="d5000-955">The `GetPath*` methods are most similar to `Url.Action` and `Url.Page` in that they generate a URI containing an absolute path.</span></span> <span data-ttu-id="d5000-956">Os métodos `GetUri*` sempre geram um URI absoluto que contém um esquema e um host.</span><span class="sxs-lookup"><span data-stu-id="d5000-956">The `GetUri*` methods always generate an absolute URI containing a scheme and host.</span></span> <span data-ttu-id="d5000-957">Os métodos que aceitam um `HttpContext` geram um URI no contexto da solicitação em execução.</span><span class="sxs-lookup"><span data-stu-id="d5000-957">The methods that accept an `HttpContext` generate a URI in the context of the executing request.</span></span> <span data-ttu-id="d5000-958">Os valores de rota de ambiente, o caminho base da URL, o esquema e o host da solicitação em execução são usados, a menos que sejam substituídos.</span><span class="sxs-lookup"><span data-stu-id="d5000-958">The ambient route values, URL base path, scheme, and host from the executing request are used unless overridden.</span></span>

<span data-ttu-id="d5000-959"><xref:Microsoft.AspNetCore.Routing.LinkGenerator> é chamado com um endereço.</span><span class="sxs-lookup"><span data-stu-id="d5000-959"><xref:Microsoft.AspNetCore.Routing.LinkGenerator> is called with an address.</span></span> <span data-ttu-id="d5000-960">A geração de um URI ocorre em duas etapas:</span><span class="sxs-lookup"><span data-stu-id="d5000-960">Generating a URI occurs in two steps:</span></span>

1. <span data-ttu-id="d5000-961">Um endereço é associado a uma lista de pontos de extremidade que correspondem ao endereço.</span><span class="sxs-lookup"><span data-stu-id="d5000-961">An address is bound to a list of endpoints that match the address.</span></span>
1. <span data-ttu-id="d5000-962">O `RoutePattern` de cada ponto de extremidade é avaliado até que seja encontrado um padrão de rota correspondente aos valores fornecidos.</span><span class="sxs-lookup"><span data-stu-id="d5000-962">Each endpoint's `RoutePattern` is evaluated until a route pattern that matches the supplied values is found.</span></span> <span data-ttu-id="d5000-963">A saída resultante é combinada com as outras partes de URI fornecidas ao gerador de link e é retornada.</span><span class="sxs-lookup"><span data-stu-id="d5000-963">The resulting output is combined with the other URI parts supplied to the link generator and returned.</span></span>

<span data-ttu-id="d5000-964">Os métodos fornecidos pelo <xref:Microsoft.AspNetCore.Routing.LinkGenerator> dão suporte a funcionalidades de geração de link padrão para qualquer tipo de endereço.</span><span class="sxs-lookup"><span data-stu-id="d5000-964">The methods provided by <xref:Microsoft.AspNetCore.Routing.LinkGenerator> support standard link generation capabilities for any type of address.</span></span> <span data-ttu-id="d5000-965">A maneira mais conveniente usar o gerador de link é por meio de métodos de extensão que executam operações para um tipo de endereço específico.</span><span class="sxs-lookup"><span data-stu-id="d5000-965">The most convenient way to use the link generator is through extension methods that perform operations for a specific address type.</span></span>

| <span data-ttu-id="d5000-966">Método de extensão</span><span class="sxs-lookup"><span data-stu-id="d5000-966">Extension Method</span></span>   | <span data-ttu-id="d5000-967">Descrição</span><span class="sxs-lookup"><span data-stu-id="d5000-967">Description</span></span>                                                         |
| ------------------ | ------------------------------------------------------------------- |
| <xref:Microsoft.AspNetCore.Routing.LinkGenerator.GetPathByAddress*> | <span data-ttu-id="d5000-968">Gera um URI com um caminho absoluto com base nos valores fornecidos.</span><span class="sxs-lookup"><span data-stu-id="d5000-968">Generates a URI with an absolute path based on the provided values.</span></span> |
| <xref:Microsoft.AspNetCore.Routing.LinkGenerator.GetUriByAddress*> | <span data-ttu-id="d5000-969">Gera um URI absoluto com base nos valores fornecidos.</span><span class="sxs-lookup"><span data-stu-id="d5000-969">Generates an absolute URI based on the provided values.</span></span>             |

> [!WARNING]
> <span data-ttu-id="d5000-970">Preste atenção às seguintes implicações da chamada de métodos <xref:Microsoft.AspNetCore.Routing.LinkGenerator>:</span><span class="sxs-lookup"><span data-stu-id="d5000-970">Pay attention to the following implications of calling <xref:Microsoft.AspNetCore.Routing.LinkGenerator> methods:</span></span>
>
> * <span data-ttu-id="d5000-971">Use métodos de extensão de `GetUri*` com cuidado em uma configuração de aplicativo que não valide o cabeçalho `Host` das solicitações de entrada.</span><span class="sxs-lookup"><span data-stu-id="d5000-971">Use `GetUri*` extension methods with caution in an app configuration that doesn't validate the `Host` header of incoming requests.</span></span> <span data-ttu-id="d5000-972">Se o cabeçalho `Host` das solicitações de entrada não é validado, uma entrada de solicitação não confiável pode ser enviada novamente ao cliente em URIs em uma exibição/página.</span><span class="sxs-lookup"><span data-stu-id="d5000-972">If the `Host` header of incoming requests isn't validated, untrusted request input can be sent back to the client in URIs in a view/page.</span></span> <span data-ttu-id="d5000-973">Recomendamos que todos os aplicativos de produção configurem seu servidor para validar o cabeçalho `Host` com os valores válidos conhecidos.</span><span class="sxs-lookup"><span data-stu-id="d5000-973">We recommend that all production apps configure their server to validate the `Host` header against known valid values.</span></span>
>
> * <span data-ttu-id="d5000-974">Use <xref:Microsoft.AspNetCore.Routing.LinkGenerator> com cuidado no middleware em combinação com `Map` ou `MapWhen`.</span><span class="sxs-lookup"><span data-stu-id="d5000-974">Use <xref:Microsoft.AspNetCore.Routing.LinkGenerator> with caution in middleware in combination with `Map` or `MapWhen`.</span></span> <span data-ttu-id="d5000-975">`Map*` altera o caminho base da solicitação em execução, o que afeta a saída da geração de link.</span><span class="sxs-lookup"><span data-stu-id="d5000-975">`Map*` changes the base path of the executing request, which affects the output of link generation.</span></span> <span data-ttu-id="d5000-976">Todas as APIs de <xref:Microsoft.AspNetCore.Routing.LinkGenerator> permitem a especificação de um caminho base.</span><span class="sxs-lookup"><span data-stu-id="d5000-976">All of the <xref:Microsoft.AspNetCore.Routing.LinkGenerator> APIs allow specifying a base path.</span></span> <span data-ttu-id="d5000-977">Sempre especifique um caminho base vazio para desfazer o efeito de `Map*` na geração de link.</span><span class="sxs-lookup"><span data-stu-id="d5000-977">Always specify an empty base path to undo `Map*`'s affect on link generation.</span></span>

## <a name="differences-from-earlier-versions-of-routing"></a><span data-ttu-id="d5000-978">Diferenças das versões anteriores de roteamento</span><span class="sxs-lookup"><span data-stu-id="d5000-978">Differences from earlier versions of routing</span></span>

<span data-ttu-id="d5000-979">Existem algumas diferenças entre o roteamento de ponto de extremidade no ASP.NET Core 2.2 ou posterior e nas versões anteriores de roteamento no ASP.NET Core:</span><span class="sxs-lookup"><span data-stu-id="d5000-979">A few differences exist between endpoint routing in ASP.NET Core 2.2 or later and earlier versions of routing in ASP.NET Core:</span></span>

* <span data-ttu-id="d5000-980">O sistema de roteamento do ponto de extremidade não dá suporte à extensibilidade baseada em <xref:Microsoft.AspNetCore.Routing.IRouter>, incluindo a herança de <xref:Microsoft.AspNetCore.Routing.Route>.</span><span class="sxs-lookup"><span data-stu-id="d5000-980">The endpoint routing system doesn't support <xref:Microsoft.AspNetCore.Routing.IRouter>-based extensibility, including inheriting from <xref:Microsoft.AspNetCore.Routing.Route>.</span></span>

* <span data-ttu-id="d5000-981">O roteamento de ponto de extremidade não dá suporte a [WebApiCompatShim](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.WebApiCompatShim).</span><span class="sxs-lookup"><span data-stu-id="d5000-981">Endpoint routing doesn't support [WebApiCompatShim](https://www.nuget.org/packages/Microsoft.AspNetCore.Mvc.WebApiCompatShim).</span></span> <span data-ttu-id="d5000-982">Use a [versão de compatibilidade](xref:mvc/compatibility-version) 2,1`.SetCompatibilityVersion(CompatibilityVersion.Version_2_1)`() para continuar usando o Shim de compatibilidade.</span><span class="sxs-lookup"><span data-stu-id="d5000-982">Use the 2.1 [compatibility version](xref:mvc/compatibility-version) (`.SetCompatibilityVersion(CompatibilityVersion.Version_2_1)`) to continue using the compatibility shim.</span></span>

* <span data-ttu-id="d5000-983">O Roteamento de Ponto de Extremidade tem um comportamento diferente para o uso de maiúsculas dos URIs gerados ao usar rotas convencionais.</span><span class="sxs-lookup"><span data-stu-id="d5000-983">Endpoint Routing has different behavior for the casing of generated URIs when using conventional routes.</span></span>

  <span data-ttu-id="d5000-984">Considere o seguinte modelo de rota padrão:</span><span class="sxs-lookup"><span data-stu-id="d5000-984">Consider the following default route template:</span></span>

  ```csharp
  app.UseMvc(routes =>
  {
      routes.MapRoute("default", "{controller=Home}/{action=Index}/{id?}");
  });
  ```

  <span data-ttu-id="d5000-985">Suponha que você gere um link para uma ação usando a seguinte rota:</span><span class="sxs-lookup"><span data-stu-id="d5000-985">Suppose you generate a link to an action using the following route:</span></span>

  ```csharp
  var link = Url.Action("ReadPost", "blog", new { id = 17, });
  ```

  <span data-ttu-id="d5000-986">Com o roteamento baseado em <xref:Microsoft.AspNetCore.Routing.IRouter>, esse código gera um URI igual a `/blog/ReadPost/17`, que respeita o uso de maiúsculas do valor de rota fornecido.</span><span class="sxs-lookup"><span data-stu-id="d5000-986">With <xref:Microsoft.AspNetCore.Routing.IRouter>-based routing, this code generates a URI of `/blog/ReadPost/17`, which respects the casing of the provided route value.</span></span> <span data-ttu-id="d5000-987">O roteamento de ponto de extremidade no ASP.NET Core 2.2 ou posterior produz `/Blog/ReadPost/17` ("Blog" está em letras maiúsculas).</span><span class="sxs-lookup"><span data-stu-id="d5000-987">Endpoint routing in ASP.NET Core 2.2 or later produces `/Blog/ReadPost/17` ("Blog" is capitalized).</span></span> <span data-ttu-id="d5000-988">O roteamento de ponto de extremidade fornece a interface `IOutboundParameterTransformer` que pode ser usada para personalizar esse comportamento globalmente ou para aplicar diferentes convenções ao mapeamento de URLs.</span><span class="sxs-lookup"><span data-stu-id="d5000-988">Endpoint routing provides the `IOutboundParameterTransformer` interface that can be used to customize this behavior globally or to apply different conventions for mapping URLs.</span></span>

  <span data-ttu-id="d5000-989">Para obter mais informações, confira a seção [Referência de transformador de parâmetro](#parameter-transformer-reference).</span><span class="sxs-lookup"><span data-stu-id="d5000-989">For more information, see the [Parameter transformer reference](#parameter-transformer-reference) section.</span></span>

* <span data-ttu-id="d5000-990">A Geração de Link usada pelo MVC/Razor Pages com rotas convencionais tem um comportamento diferente ao tentar estabelecer um vínculo com um controlador/uma ação ou uma página não existente.</span><span class="sxs-lookup"><span data-stu-id="d5000-990">Link Generation used by MVC/Razor Pages with conventional routes behaves differently when attempting to link to an controller/action or page that doesn't exist.</span></span>

  <span data-ttu-id="d5000-991">Considere o seguinte modelo de rota padrão:</span><span class="sxs-lookup"><span data-stu-id="d5000-991">Consider the following default route template:</span></span>

  ```csharp
  app.UseMvc(routes =>
  {
      routes.MapRoute("default", "{controller=Home}/{action=Index}/{id?}");
  });
  ```

  <span data-ttu-id="d5000-992">Suponha que você gere um link para uma ação usando o modelo padrão com o seguinte:</span><span class="sxs-lookup"><span data-stu-id="d5000-992">Suppose you generate a link to an action using the default template with the following:</span></span>

  ```csharp
  var link = Url.Action("ReadPost", "Blog", new { id = 17, });
  ```

  <span data-ttu-id="d5000-993">Com o roteamento baseado em `IRouter`, o resultado é sempre `/Blog/ReadPost/17`, mesmo se o `BlogController` não existe ou não tem um método de ação `ReadPost`.</span><span class="sxs-lookup"><span data-stu-id="d5000-993">With `IRouter`-based routing, the result is always `/Blog/ReadPost/17`, even if the `BlogController` doesn't exist or doesn't have a `ReadPost` action method.</span></span> <span data-ttu-id="d5000-994">Conforme esperado, o roteamento de ponto de extremidade no ASP.NET Core 2.2 ou posterior produz `/Blog/ReadPost/17` se o método de ação existe.</span><span class="sxs-lookup"><span data-stu-id="d5000-994">As expected, endpoint routing in ASP.NET Core 2.2 or later produces `/Blog/ReadPost/17` if the action method exists.</span></span> <span data-ttu-id="d5000-995">*No entanto, o roteamento de ponto de extremidade produz uma cadeia de caracteres vazia se a ação não existe.*</span><span class="sxs-lookup"><span data-stu-id="d5000-995">*However, endpoint routing produces an empty string if the action doesn't exist.*</span></span> <span data-ttu-id="d5000-996">Conceitualmente, o roteamento de ponto de extremidade não pressupõe a existência do ponto de extremidade, caso a ação não exista.</span><span class="sxs-lookup"><span data-stu-id="d5000-996">Conceptually, endpoint routing doesn't assume that the endpoint exists if the action doesn't exist.</span></span>

* <span data-ttu-id="d5000-997">O *algoritmo de invalidação de valor de ambiente* da geração de link tem um comportamento diferente quando usado com o roteamento de ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="d5000-997">The link generation *ambient value invalidation algorithm* behaves differently when used with endpoint routing.</span></span>

  <span data-ttu-id="d5000-998">A *invalidação de valor de ambiente* é o algoritmo que decide quais valores de rota da solicitação em execução no momento (os valores de ambiente) podem ser usados em operações de geração de link.</span><span class="sxs-lookup"><span data-stu-id="d5000-998">*Ambient value invalidation* is the algorithm that decides which route values from the currently executing request (the ambient values) can be used in link generation operations.</span></span> <span data-ttu-id="d5000-999">O roteamento convencional sempre invalidava valores de rota extras ao estabelecer o vínculo com uma ação diferente.</span><span class="sxs-lookup"><span data-stu-id="d5000-999">Conventional routing always invalidated extra route values when linking to a different action.</span></span> <span data-ttu-id="d5000-1000">O roteamento de atributo não tinha esse comportamento antes do lançamento do ASP.NET Core 2.2.</span><span class="sxs-lookup"><span data-stu-id="d5000-1000">Attribute routing didn't have this behavior prior to the release of ASP.NET Core 2.2.</span></span> <span data-ttu-id="d5000-1001">Em versões anteriores do ASP.NET Core, os links para outra ação que usam os mesmos nomes de parâmetro de rota resultavam em erros de geração de link.</span><span class="sxs-lookup"><span data-stu-id="d5000-1001">In earlier versions of ASP.NET Core, links to another action that use the same route parameter names resulted in link generation errors.</span></span> <span data-ttu-id="d5000-1002">No ASP.NET Core 2.2 ou posterior, as duas formas de roteamento invalidam os valores ao estabelecer o vínculo com outra ação.</span><span class="sxs-lookup"><span data-stu-id="d5000-1002">In ASP.NET Core 2.2 or later, both forms of routing invalidate values when linking to another action.</span></span>

  <span data-ttu-id="d5000-1003">Considere o exemplo a seguir no ASP.NET Core 2.1 ou anterior.</span><span class="sxs-lookup"><span data-stu-id="d5000-1003">Consider the following example in ASP.NET Core 2.1 or earlier.</span></span> <span data-ttu-id="d5000-1004">Ao estabelecer o vínculo com outra ação (ou outra página), os valores de rota podem ser reutilizados de maneiras indesejadas.</span><span class="sxs-lookup"><span data-stu-id="d5000-1004">When linking to another action (or another page), route values can be reused in undesirable ways.</span></span>

  <span data-ttu-id="d5000-1005">Em */Pages/Store/Product.cshtml*:</span><span class="sxs-lookup"><span data-stu-id="d5000-1005">In */Pages/Store/Product.cshtml*:</span></span>

  ```cshtml
  @page "{id}"
  @Url.Page("/Login")
  ```

  <span data-ttu-id="d5000-1006">Em */Pages/Login.cshtml*:</span><span class="sxs-lookup"><span data-stu-id="d5000-1006">In */Pages/Login.cshtml*:</span></span>

  ```cshtml
  @page "{id?}"
  ```

  <span data-ttu-id="d5000-1007">Se o URI é `/Store/Product/18` no ASP.NET Core 2.1 ou anterior, o link gerado na página Store/Info por `@Url.Page("/Login")` é `/Login/18`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1007">If the URI is `/Store/Product/18` in ASP.NET Core 2.1 or earlier, the link generated on the Store/Info page by `@Url.Page("/Login")` is `/Login/18`.</span></span> <span data-ttu-id="d5000-1008">O valor de `id` igual a 18 é reutilizado, mesmo que o destino do link seja uma parte totalmente diferente do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d5000-1008">The `id` value of 18 is reused, even though the link destination is different part of the app entirely.</span></span> <span data-ttu-id="d5000-1009">O valor de rota de `id` no contexto da página `/Login` provavelmente é um valor de ID de usuário, e não um valor de ID do produto (product ID) da loja.</span><span class="sxs-lookup"><span data-stu-id="d5000-1009">The `id` route value in the context of the `/Login` page is probably a user ID value, not a store product ID value.</span></span>

  <span data-ttu-id="d5000-1010">No roteamento de ponto de extremidade com o ASP.NET Core 2.2 ou posterior, o resultado é `/Login`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1010">In endpoint routing with ASP.NET Core 2.2 or later, the result is `/Login`.</span></span> <span data-ttu-id="d5000-1011">Os valores de ambiente não são reutilizados quando o destino vinculado é uma ação ou uma página diferente.</span><span class="sxs-lookup"><span data-stu-id="d5000-1011">Ambient values aren't reused when the linked destination is a different action or page.</span></span>

* <span data-ttu-id="d5000-1012">Sintaxe do parâmetro de rota de viagem de ida e volta: as barras "/" não são codificadas ao usar uma sintaxe do parâmetro catch-all de asterisco duplo (`**`).</span><span class="sxs-lookup"><span data-stu-id="d5000-1012">Round-tripping route parameter syntax: Forward slashes aren't encoded when using a double-asterisk (`**`) catch-all parameter syntax.</span></span>

  <span data-ttu-id="d5000-1013">Durante a geração de link, o sistema de roteamento codifica o valor capturado em um parâmetro catch-all de asterisco duplo (`**`) (por exemplo, `{**myparametername}`), exceto as barras "/".</span><span class="sxs-lookup"><span data-stu-id="d5000-1013">During link generation, the routing system encodes the value captured in a double-asterisk (`**`) catch-all parameter (for example, `{**myparametername}`) except the forward slashes.</span></span> <span data-ttu-id="d5000-1014">O catch-all de asterisco duplo é compatível com o roteamento baseado em `IRouter` no ASP.NET Core 2.2 ou posterior.</span><span class="sxs-lookup"><span data-stu-id="d5000-1014">The double-asterisk catch-all is supported with `IRouter`-based routing in ASP.NET Core 2.2 or later.</span></span>

  <span data-ttu-id="d5000-1015">A sintaxe do parâmetro catch-all de asterisco único em versões anteriores do ASP.NET Core (`{*myparametername}`) permanece com suporte e as barras "/" são codificadas.</span><span class="sxs-lookup"><span data-stu-id="d5000-1015">The single asterisk catch-all parameter syntax in prior versions of ASP.NET Core (`{*myparametername}`) remains supported, and forward slashes are encoded.</span></span>

  | <span data-ttu-id="d5000-1016">Rota</span><span class="sxs-lookup"><span data-stu-id="d5000-1016">Route</span></span>              | <span data-ttu-id="d5000-1017">Link gerado com</span><span class="sxs-lookup"><span data-stu-id="d5000-1017">Link generated with</span></span><br>`Url.Action(new { category = "admin/products" })`&hellip; |
  | ------------------ | --------------------------------------------------------------------- |
  | `/search/{*page}`  | <span data-ttu-id="d5000-1018">`/search/admin%2Fproducts` (a barra "/" é codificada)</span><span class="sxs-lookup"><span data-stu-id="d5000-1018">`/search/admin%2Fproducts` (the forward slash is encoded)</span></span>             |
  | `/search/{**page}` | `/search/admin/products`                                              |

### <a name="middleware-example"></a><span data-ttu-id="d5000-1019">Exemplo de middleware</span><span class="sxs-lookup"><span data-stu-id="d5000-1019">Middleware example</span></span>

<span data-ttu-id="d5000-1020">No exemplo a seguir, um middleware usa a API de <xref:Microsoft.AspNetCore.Routing.LinkGenerator> para criar um link para um método de ação que lista os produtos da loja.</span><span class="sxs-lookup"><span data-stu-id="d5000-1020">In the following example, a middleware uses the <xref:Microsoft.AspNetCore.Routing.LinkGenerator> API to create link to an action method that lists store products.</span></span> <span data-ttu-id="d5000-1021">O uso do gerador de link com sua injeção em uma classe e uma chamada a `GenerateLink` está disponível para qualquer classe em um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d5000-1021">Using the link generator by injecting it into a class and calling `GenerateLink` is available to any class in an app.</span></span>

```csharp
using Microsoft.AspNetCore.Routing;

public class ProductsLinkMiddleware
{
    private readonly LinkGenerator _linkGenerator;

    public ProductsLinkMiddleware(RequestDelegate next, LinkGenerator linkGenerator)
    {
        _linkGenerator = linkGenerator;
    }

    public async Task InvokeAsync(HttpContext httpContext)
    {
        var url = _linkGenerator.GetPathByAction("ListProducts", "Store");

        httpContext.Response.ContentType = "text/plain";

        await httpContext.Response.WriteAsync($"Go to {url} to see our products.");
    }
}
```

### <a name="create-routes"></a><span data-ttu-id="d5000-1022">Criar rotas</span><span class="sxs-lookup"><span data-stu-id="d5000-1022">Create routes</span></span>

<span data-ttu-id="d5000-1023">A maioria dos aplicativos cria rotas chamando <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> ou um dos métodos de extensão semelhantes definidos em <xref:Microsoft.AspNetCore.Routing.IRouteBuilder>.</span><span class="sxs-lookup"><span data-stu-id="d5000-1023">Most apps create routes by calling <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> or one of the similar extension methods defined on <xref:Microsoft.AspNetCore.Routing.IRouteBuilder>.</span></span> <span data-ttu-id="d5000-1024">Qualquer um dos métodos de extensão de <xref:Microsoft.AspNetCore.Routing.IRouteBuilder> cria uma instância de <xref:Microsoft.AspNetCore.Routing.Route> e a adicionam à coleção de rotas.</span><span class="sxs-lookup"><span data-stu-id="d5000-1024">Any of the <xref:Microsoft.AspNetCore.Routing.IRouteBuilder> extension methods create an instance of <xref:Microsoft.AspNetCore.Routing.Route> and add it to the route collection.</span></span>

<span data-ttu-id="d5000-1025"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> não aceita um parâmetro de manipulador de rotas.</span><span class="sxs-lookup"><span data-stu-id="d5000-1025"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> doesn't accept a route handler parameter.</span></span> <span data-ttu-id="d5000-1026"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> apenas adiciona rotas que são manipuladas pelo <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*>.</span><span class="sxs-lookup"><span data-stu-id="d5000-1026"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> only adds routes that are handled by the <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*>.</span></span> <span data-ttu-id="d5000-1027">Para saber mais sobre o roteamento no MVC, confira <xref:mvc/controllers/routing>.</span><span class="sxs-lookup"><span data-stu-id="d5000-1027">To learn more about routing in MVC, see <xref:mvc/controllers/routing>.</span></span>

<span data-ttu-id="d5000-1028">O exemplo de código a seguir é um exemplo de uma chamada <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> usada por uma definição de rota típica do ASP.NET Core MVC:</span><span class="sxs-lookup"><span data-stu-id="d5000-1028">The following code example is an example of a <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> call used by a typical ASP.NET Core MVC route definition:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id?}");
```

<span data-ttu-id="d5000-1029">Esse modelo corresponde a um caminho de URL e extrai os valores de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-1029">This template matches a URL path and extracts the route values.</span></span> <span data-ttu-id="d5000-1030">Por exemplo, o caminho `/Products/Details/17` gera os seguintes valores de rota: `{ controller = Products, action = Details, id = 17 }`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1030">For example, the path `/Products/Details/17` generates the following route values: `{ controller = Products, action = Details, id = 17 }`.</span></span>

<span data-ttu-id="d5000-1031">Os valores de rota são determinados pela divisão do caminho da URL em segmentos e pela correspondência de cada segmento com o nome do *parâmetro de rota* no modelo de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-1031">Route values are determined by splitting the URL path into segments and matching each segment with the *route parameter* name in the route template.</span></span> <span data-ttu-id="d5000-1032">Os parâmetros de rota são nomeados.</span><span class="sxs-lookup"><span data-stu-id="d5000-1032">Route parameters are named.</span></span> <span data-ttu-id="d5000-1033">Os parâmetros são definidos com a colocação do nome do parâmetro em chaves `{ ... }`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1033">The parameters defined by enclosing the parameter name in braces `{ ... }`.</span></span>

<span data-ttu-id="d5000-1034">O modelo anterior também pode corresponder ao caminho da URL `/` e produzir os valores `{ controller = Home, action = Index }`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1034">The preceding template could also match the URL path `/` and produce the values `{ controller = Home, action = Index }`.</span></span> <span data-ttu-id="d5000-1035">Isso ocorre porque os parâmetros de rota `{controller}` e `{action}` têm valores padrão e o parâmetro de rota `id` é opcional.</span><span class="sxs-lookup"><span data-stu-id="d5000-1035">This occurs because the `{controller}` and `{action}` route parameters have default values and the `id` route parameter is optional.</span></span> <span data-ttu-id="d5000-1036">Um sinal de igual (`=`) seguido de um valor após o nome do parâmetro de rota define um valor padrão para o parâmetro.</span><span class="sxs-lookup"><span data-stu-id="d5000-1036">An equals sign (`=`) followed by a value after the route parameter name defines a default value for the parameter.</span></span> <span data-ttu-id="d5000-1037">Um ponto de interrogação (`?`) após o nome do parâmetro de rota define o parâmetro como opcional.</span><span class="sxs-lookup"><span data-stu-id="d5000-1037">A question mark (`?`) after the route parameter name defines an optional parameter.</span></span>

<span data-ttu-id="d5000-1038">Os parâmetros de rota com um valor padrão *sempre* produzem um valor de rota quando a rota corresponde.</span><span class="sxs-lookup"><span data-stu-id="d5000-1038">Route parameters with a default value *always* produce a route value when the route matches.</span></span> <span data-ttu-id="d5000-1039">Os parâmetros opcionais não produzem um valor de rota se não houver nenhum segmento de caminho de URL correspondente.</span><span class="sxs-lookup"><span data-stu-id="d5000-1039">Optional parameters don't produce a route value if there is no corresponding URL path segment.</span></span> <span data-ttu-id="d5000-1040">Confira a seção [Referência de modelo de rota](#route-template-reference) para obter uma descrição completa dos recursos e da sintaxe de modelo de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-1040">See the [Route template reference](#route-template-reference) section for a thorough description of route template scenarios and syntax.</span></span>

<span data-ttu-id="d5000-1041">No seguinte exemplo, a definição do parâmetro de rota `{id:int}` define uma [restrição de rota](#route-constraint-reference) para o parâmetro de rota `id`:</span><span class="sxs-lookup"><span data-stu-id="d5000-1041">In the following example, the route parameter definition `{id:int}` defines a [route constraint](#route-constraint-reference) for the `id` route parameter:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id:int}");
```

<span data-ttu-id="d5000-1042">Esse modelo corresponde a um caminho de URL, como `/Products/Details/17`, mas não como `/Products/Details/Apples`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1042">This template matches a URL path like `/Products/Details/17` but not `/Products/Details/Apples`.</span></span> <span data-ttu-id="d5000-1043">As restrições de rota implementam <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> e inspecionam valores de rota para verificá-los.</span><span class="sxs-lookup"><span data-stu-id="d5000-1043">Route constraints implement <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> and inspect route values to verify them.</span></span> <span data-ttu-id="d5000-1044">Neste exemplo, o valor de rota `id` precisa ser conversível em um inteiro.</span><span class="sxs-lookup"><span data-stu-id="d5000-1044">In this example, the route value `id` must be convertible to an integer.</span></span> <span data-ttu-id="d5000-1045">Confira [route-constraint-reference](#route-constraint-reference) para obter uma explicação das restrições de rota fornecidas pela estrutura.</span><span class="sxs-lookup"><span data-stu-id="d5000-1045">See [route-constraint-reference](#route-constraint-reference) for an explanation of route constraints provided by the framework.</span></span>

<span data-ttu-id="d5000-1046">Sobrecargas adicionais de <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> aceitam valores para `constraints`, `dataTokens` e `defaults`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1046">Additional overloads of <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> accept values for `constraints`, `dataTokens`, and `defaults`.</span></span> <span data-ttu-id="d5000-1047">O uso típico desses parâmetros é passar um objeto de tipo anônimo, no qual os nomes da propriedade do tipo anônimo correspondem aos nomes do parâmetro de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-1047">The typical usage of these parameters is to pass an anonymously typed object, where the property names of the anonymous type match route parameter names.</span></span>

<span data-ttu-id="d5000-1048">Os seguintes exemplos de <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> criam rotas equivalentes:</span><span class="sxs-lookup"><span data-stu-id="d5000-1048">The following <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> examples create equivalent routes:</span></span>

```csharp
routes.MapRoute(
    name: "default_route",
    template: "{controller}/{action}/{id?}",
    defaults: new { controller = "Home", action = "Index" });

routes.MapRoute(
    name: "default_route",
    template: "{controller=Home}/{action=Index}/{id?}");
```

> [!TIP]
> <span data-ttu-id="d5000-1049">A sintaxe embutida para a definição de restrições e padrões pode ser interessante para rotas simples.</span><span class="sxs-lookup"><span data-stu-id="d5000-1049">The inline syntax for defining constraints and defaults can be convenient for simple routes.</span></span> <span data-ttu-id="d5000-1050">No entanto, há cenários, como tokens de dados, que não dão suporte à sintaxe embutida.</span><span class="sxs-lookup"><span data-stu-id="d5000-1050">However, there are scenarios, such as data tokens, that aren't supported by inline syntax.</span></span>

<span data-ttu-id="d5000-1051">O seguinte exemplo demonstra mais alguns cenários:</span><span class="sxs-lookup"><span data-stu-id="d5000-1051">The following example demonstrates a few additional scenarios:</span></span>

```csharp
routes.MapRoute(
    name: "blog",
    template: "Blog/{**article}",
    defaults: new { controller = "Blog", action = "ReadArticle" });
```

<span data-ttu-id="d5000-1052">O modelo anterior corresponde a um caminho de URL, como `/Blog/All-About-Routing/Introduction`, e extrai os valores `{ controller = Blog, action = ReadArticle, article = All-About-Routing/Introduction }`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1052">The preceding template matches a URL path like `/Blog/All-About-Routing/Introduction` and extracts the values `{ controller = Blog, action = ReadArticle, article = All-About-Routing/Introduction }`.</span></span> <span data-ttu-id="d5000-1053">Os valores de rota padrão para `controller` e `action` são produzidos pela rota, mesmo que não haja nenhum parâmetro de rota correspondente no modelo.</span><span class="sxs-lookup"><span data-stu-id="d5000-1053">The default route values for `controller` and `action` are produced by the route even though there are no corresponding route parameters in the template.</span></span> <span data-ttu-id="d5000-1054">Os valores padrão podem ser especificados no modelo de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-1054">Default values can be specified in the route template.</span></span> <span data-ttu-id="d5000-1055">O parâmetro de rota `article` é definido como um *catch-all* pela aparência de um asterisco duplo (`**`) antes do nome do parâmetro de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-1055">The `article` route parameter is defined as a *catch-all* by the appearance of an double asterisk (`**`) before the route parameter name.</span></span> <span data-ttu-id="d5000-1056">Os parâmetros de rota catch-all capturam o restante do caminho de URL e também podem corresponder à cadeia de caracteres vazia.</span><span class="sxs-lookup"><span data-stu-id="d5000-1056">Catch-all route parameters capture the remainder of the URL path and can also match the empty string.</span></span>

<span data-ttu-id="d5000-1057">O seguinte exemplo adiciona restrições de rota e tokens de dados:</span><span class="sxs-lookup"><span data-stu-id="d5000-1057">The following example adds route constraints and data tokens:</span></span>

```csharp
routes.MapRoute(
    name: "us_english_products",
    template: "en-US/Products/{id}",
    defaults: new { controller = "Products", action = "Details" },
    constraints: new { id = new IntRouteConstraint() },
    dataTokens: new { locale = "en-US" });
```

<span data-ttu-id="d5000-1058">O modelo anterior corresponde a um caminho de URL como `/en-US/Products/5` e extrai os valores de `{ controller = Products, action = Details, id = 5 }` e os tokens de dados `{ locale = en-US }`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1058">The preceding template matches a URL path like `/en-US/Products/5` and extracts the values `{ controller = Products, action = Details, id = 5 }` and the data tokens `{ locale = en-US }`.</span></span>

![Tokens locais do Windows](routing/_static/tokens.png)

### <a name="route-class-url-generation"></a><span data-ttu-id="d5000-1060">Geração de URL da classe de rota</span><span class="sxs-lookup"><span data-stu-id="d5000-1060">Route class URL generation</span></span>

<span data-ttu-id="d5000-1061">A classe <xref:Microsoft.AspNetCore.Routing.Route> também pode executar a geração de URL pela combinação de um conjunto de valores de rota com seu modelo de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-1061">The <xref:Microsoft.AspNetCore.Routing.Route> class can also perform URL generation by combining a set of route values with its route template.</span></span> <span data-ttu-id="d5000-1062">Logicamente, este é o processo inverso de correspondência do caminho de URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-1062">This is logically the reverse process of matching the URL path.</span></span>

> [!TIP]
> <span data-ttu-id="d5000-1063">Para entender melhor a geração de URL, imagine qual URL você deseja gerar e, em seguida, pense em como um modelo de rota corresponderia a essa URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-1063">To better understand URL generation, imagine what URL you want to generate and then think about how a route template would match that URL.</span></span> <span data-ttu-id="d5000-1064">Quais valores serão produzidos?</span><span class="sxs-lookup"><span data-stu-id="d5000-1064">What values would be produced?</span></span> <span data-ttu-id="d5000-1065">Este é o equivalente aproximado de como funciona a geração de URL na classe <xref:Microsoft.AspNetCore.Routing.Route>.</span><span class="sxs-lookup"><span data-stu-id="d5000-1065">This is the rough equivalent of how URL generation works in the <xref:Microsoft.AspNetCore.Routing.Route> class.</span></span>

<span data-ttu-id="d5000-1066">O seguinte exemplo usa uma rota padrão geral do ASP.NET Core MVC:</span><span class="sxs-lookup"><span data-stu-id="d5000-1066">The following example uses a general ASP.NET Core MVC default route:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id?}");
```

<span data-ttu-id="d5000-1067">Com os valores de rota `{ controller = Products, action = List }`, a URL `/Products/List` é gerada.</span><span class="sxs-lookup"><span data-stu-id="d5000-1067">With the route values `{ controller = Products, action = List }`, the URL `/Products/List` is generated.</span></span> <span data-ttu-id="d5000-1068">Os valores de rota são substituídos pelos parâmetros de rota correspondentes para formar o caminho de URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-1068">The route values are substituted for the corresponding route parameters to form the URL path.</span></span> <span data-ttu-id="d5000-1069">Como `id` é um parâmetro de rota opcional, a URL é gerada com êxito sem um valor para `id`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1069">Since `id` is an optional route parameter, the URL is successfully generated without a value for `id`.</span></span>

<span data-ttu-id="d5000-1070">Com os valores de rota `{ controller = Home, action = Index }`, a URL `/` é gerada.</span><span class="sxs-lookup"><span data-stu-id="d5000-1070">With the route values `{ controller = Home, action = Index }`, the URL `/` is generated.</span></span> <span data-ttu-id="d5000-1071">Os valores de rota fornecidos correspondem aos valores padrão, sendo que os segmentos correspondentes aos valores padrão são omitidos com segurança.</span><span class="sxs-lookup"><span data-stu-id="d5000-1071">The provided route values match the default values, and the segments corresponding to the default values are safely omitted.</span></span>

<span data-ttu-id="d5000-1072">A viagem de ida e volta gerada pelas duas URLs com a definição de rota a seguir (`/Home/Index` e `/`) produz os mesmos valores de rota que foram usados para gerar a URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-1072">Both URLs generated round-trip with the following route definition (`/Home/Index` and `/`) produce the same route values that were used to generate the URL.</span></span>

> [!NOTE]
> <span data-ttu-id="d5000-1073">Um aplicativo que usa o ASP.NET Core MVC deve usar <xref:Microsoft.AspNetCore.Mvc.Routing.UrlHelper> para gerar URLs, em vez de chamar o roteamento diretamente.</span><span class="sxs-lookup"><span data-stu-id="d5000-1073">An app using ASP.NET Core MVC should use <xref:Microsoft.AspNetCore.Mvc.Routing.UrlHelper> to generate URLs instead of calling into routing directly.</span></span>

<span data-ttu-id="d5000-1074">Para obter mais informações sobre a geração de URL, confira a seção [Referência de geração de URL](#url-generation-reference).</span><span class="sxs-lookup"><span data-stu-id="d5000-1074">For more information on URL generation, see the [Url generation reference](#url-generation-reference) section.</span></span>

## <a name="use-routing-middleware"></a><span data-ttu-id="d5000-1075">Usar o middleware de roteamento</span><span class="sxs-lookup"><span data-stu-id="d5000-1075">Use Routing Middleware</span></span>

<span data-ttu-id="d5000-1076">Referencie o [metapacote Microsoft.AspNetCore.App](xref:fundamentals/metapackage-app) no arquivo de projeto do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d5000-1076">Reference the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app) in the app's project file.</span></span>

<span data-ttu-id="d5000-1077">Adicione o roteamento ao contêiner de serviço em `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="d5000-1077">Add routing to the service container in `Startup.ConfigureServices`:</span></span>

[!code-csharp[](routing/samples/2.x/RoutingSample/Startup.cs?name=snippet_ConfigureServices&highlight=3)]

<span data-ttu-id="d5000-1078">As rotas precisam ser configuradas no método `Startup.Configure`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1078">Routes must be configured in the `Startup.Configure` method.</span></span> <span data-ttu-id="d5000-1079">O aplicativo de exemplo usa as seguintes APIs:</span><span class="sxs-lookup"><span data-stu-id="d5000-1079">The sample app uses the following APIs:</span></span>

* <xref:Microsoft.AspNetCore.Routing.RouteBuilder>
* <span data-ttu-id="d5000-1080"><xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*>&ndash; Corresponde apenas a solicitações HTTP Get.</span><span class="sxs-lookup"><span data-stu-id="d5000-1080"><xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*> &ndash; Matches only HTTP GET requests.</span></span>
* <xref:Microsoft.AspNetCore.Builder.RoutingBuilderExtensions.UseRouter*>

[!code-csharp[](routing/samples/2.x/RoutingSample/Startup.cs?name=snippet_RouteHandler)]

<span data-ttu-id="d5000-1081">A tabela a seguir mostra as respostas com os URIs fornecidos.</span><span class="sxs-lookup"><span data-stu-id="d5000-1081">The following table shows the responses with the given URIs.</span></span>

| <span data-ttu-id="d5000-1082">URI</span><span class="sxs-lookup"><span data-stu-id="d5000-1082">URI</span></span>                    | <span data-ttu-id="d5000-1083">Resposta</span><span class="sxs-lookup"><span data-stu-id="d5000-1083">Response</span></span>                                          |
| ---------------------- | ------------------------------------------------- |
| `/package/create/3`    | <span data-ttu-id="d5000-1084">Olá!</span><span class="sxs-lookup"><span data-stu-id="d5000-1084">Hello!</span></span> <span data-ttu-id="d5000-1085">Valores de rota: [operation, create], [id, 3]</span><span class="sxs-lookup"><span data-stu-id="d5000-1085">Route values: [operation, create], [id, 3]</span></span> |
| `/package/track/-3`    | <span data-ttu-id="d5000-1086">Olá!</span><span class="sxs-lookup"><span data-stu-id="d5000-1086">Hello!</span></span> <span data-ttu-id="d5000-1087">Valores de rota: [operation, track], [id, -3]</span><span class="sxs-lookup"><span data-stu-id="d5000-1087">Route values: [operation, track], [id, -3]</span></span> |
| `/package/track/-3/`   | <span data-ttu-id="d5000-1088">Olá!</span><span class="sxs-lookup"><span data-stu-id="d5000-1088">Hello!</span></span> <span data-ttu-id="d5000-1089">Valores de rota: [operation, track], [id, -3]</span><span class="sxs-lookup"><span data-stu-id="d5000-1089">Route values: [operation, track], [id, -3]</span></span> |
| `/package/track/`      | <span data-ttu-id="d5000-1090">A solicitação é ignorada; sem correspondência.</span><span class="sxs-lookup"><span data-stu-id="d5000-1090">The request falls through, no match.</span></span>              |
| `GET /hello/Joe`       | <span data-ttu-id="d5000-1091">Olá, Joe!</span><span class="sxs-lookup"><span data-stu-id="d5000-1091">Hi, Joe!</span></span>                                          |
| `POST /hello/Joe`      | <span data-ttu-id="d5000-1092">A solicitação é ignorada; corresponde apenas a HTTP GET.</span><span class="sxs-lookup"><span data-stu-id="d5000-1092">The request falls through, matches HTTP GET only.</span></span> |
| `GET /hello/Joe/Smith` | <span data-ttu-id="d5000-1093">A solicitação é ignorada; sem correspondência.</span><span class="sxs-lookup"><span data-stu-id="d5000-1093">The request falls through, no match.</span></span>              |

<span data-ttu-id="d5000-1094">A estrutura fornece um conjunto de métodos de extensão para a criação de rotas (<xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions>):</span><span class="sxs-lookup"><span data-stu-id="d5000-1094">The framework provides a set of extension methods for creating routes (<xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions>):</span></span>

* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapDelete*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareDelete*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareGet*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewarePost*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewarePut*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareRoute*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareVerb*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapPost*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapPut*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapRoute*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapVerb*>

<span data-ttu-id="d5000-1095">Os métodos `Map[Verb]` usam restrições para limitar a rota ao Verbo HTTP no nome do método.</span><span class="sxs-lookup"><span data-stu-id="d5000-1095">The `Map[Verb]` methods use constraints to limit the route to the HTTP Verb in the method name.</span></span> <span data-ttu-id="d5000-1096">Por exemplo, veja <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*> e <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapVerb*>.</span><span class="sxs-lookup"><span data-stu-id="d5000-1096">For example, see <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*> and <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapVerb*>.</span></span>

## <a name="route-template-reference"></a><span data-ttu-id="d5000-1097">Referência de modelo de rota</span><span class="sxs-lookup"><span data-stu-id="d5000-1097">Route template reference</span></span>

<span data-ttu-id="d5000-1098">Os tokens entre chaves (`{ ... }`) definem os *parâmetros de rota* que serão associados se a rota for correspondida.</span><span class="sxs-lookup"><span data-stu-id="d5000-1098">Tokens within curly braces (`{ ... }`) define *route parameters* that are bound if the route is matched.</span></span> <span data-ttu-id="d5000-1099">Você pode definir mais de um parâmetro de rota em um segmento de rota, mas eles precisam ser separados por um valor literal.</span><span class="sxs-lookup"><span data-stu-id="d5000-1099">You can define more than one route parameter in a route segment, but they must be separated by a literal value.</span></span> <span data-ttu-id="d5000-1100">Por exemplo, `{controller=Home}{action=Index}` não é uma rota válida, já que não há nenhum valor literal entre `{controller}` e `{action}`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1100">For example, `{controller=Home}{action=Index}` isn't a valid route, since there's no literal value between `{controller}` and `{action}`.</span></span> <span data-ttu-id="d5000-1101">Esses parâmetros de rota precisam ter um nome e podem ter atributos adicionais especificados.</span><span class="sxs-lookup"><span data-stu-id="d5000-1101">These route parameters must have a name and may have additional attributes specified.</span></span>

<span data-ttu-id="d5000-1102">Um texto literal diferente dos parâmetros de rota (por exemplo, `{id}`) e do separador de caminho `/` precisa corresponder ao texto na URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-1102">Literal text other than route parameters (for example, `{id}`) and the path separator `/` must match the text in the URL.</span></span> <span data-ttu-id="d5000-1103">A correspondência de texto não diferencia maiúsculas de minúsculas e se baseia na representação decodificada do caminho de URLs.</span><span class="sxs-lookup"><span data-stu-id="d5000-1103">Text matching is case-insensitive and based on the decoded representation of the URLs path.</span></span> <span data-ttu-id="d5000-1104">Para encontrar a correspondência de um delimitador de parâmetro de rota literal (`{` ou `}`), faça o escape do delimitador repetindo o caractere (`{{` ou `}}`).</span><span class="sxs-lookup"><span data-stu-id="d5000-1104">To match a literal route parameter delimiter (`{` or `}`), escape the delimiter by repeating the character (`{{` or `}}`).</span></span>

<span data-ttu-id="d5000-1105">Padrões de URL que tentam capturar um nome de arquivo com uma extensão de arquivo opcional apresentam considerações adicionais.</span><span class="sxs-lookup"><span data-stu-id="d5000-1105">URL patterns that attempt to capture a file name with an optional file extension have additional considerations.</span></span> <span data-ttu-id="d5000-1106">Por exemplo, considere o modelo `files/{filename}.{ext?}`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1106">For example, consider the template `files/{filename}.{ext?}`.</span></span> <span data-ttu-id="d5000-1107">Quando existem valores para `filename` e `ext`, ambos os valores são populados.</span><span class="sxs-lookup"><span data-stu-id="d5000-1107">When values for both `filename` and `ext` exist, both values are populated.</span></span> <span data-ttu-id="d5000-1108">Se apenas existir um valor para `filename` na URL, a rota encontrará uma correspondência, pois o ponto à direita (`.`) é opcional.</span><span class="sxs-lookup"><span data-stu-id="d5000-1108">If only a value for `filename` exists in the URL, the route matches because the trailing period (`.`) is  optional.</span></span> <span data-ttu-id="d5000-1109">As URLs a seguir correspondem a essa rota:</span><span class="sxs-lookup"><span data-stu-id="d5000-1109">The following URLs match this route:</span></span>

* `/files/myFile.txt`
* `/files/myFile`

<span data-ttu-id="d5000-1110">Você pode usar um asterisco (`*`) ou um asterisco duplo (`**`) como um prefixo para um parâmetro de rota para associá-lo ao restante do URI.</span><span class="sxs-lookup"><span data-stu-id="d5000-1110">You can use an asterisk (`*`) or double asterisk (`**`) as a prefix to a route parameter to bind to the rest of the URI.</span></span> <span data-ttu-id="d5000-1111">Eles são chamados de parâmetros *catch-all*.</span><span class="sxs-lookup"><span data-stu-id="d5000-1111">These are called a *catch-all* parameters.</span></span> <span data-ttu-id="d5000-1112">Por exemplo, `blog/{**slug}` corresponde a qualquer URI que começa com `/blog` e tem qualquer valor depois dele, que é atribuído ao valor de rota `slug`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1112">For example, `blog/{**slug}` matches any URI that starts with `/blog` and has any value following it, which is assigned to the `slug` route value.</span></span> <span data-ttu-id="d5000-1113">Os parâmetros catch-all também podem corresponder à cadeia de caracteres vazia.</span><span class="sxs-lookup"><span data-stu-id="d5000-1113">Catch-all parameters can also match the empty string.</span></span>

<span data-ttu-id="d5000-1114">O parâmetro catch-all faz o escape dos caracteres corretos quando a rota é usada para gerar uma URL, incluindo os caracteres separadores de caminho (`/`).</span><span class="sxs-lookup"><span data-stu-id="d5000-1114">The catch-all parameter escapes the appropriate characters when the route is used to generate a URL, including path separator (`/`) characters.</span></span> <span data-ttu-id="d5000-1115">Por exemplo, a rota `foo/{*path}` com valores de rota `{ path = "my/path" }` gera `foo/my%2Fpath`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1115">For example, the route `foo/{*path}` with route values `{ path = "my/path" }` generates `foo/my%2Fpath`.</span></span> <span data-ttu-id="d5000-1116">Observe o escape da barra invertida.</span><span class="sxs-lookup"><span data-stu-id="d5000-1116">Note the escaped forward slash.</span></span> <span data-ttu-id="d5000-1117">Para fazer a viagem de ida e volta dos caracteres separadores de caminho, use o prefixo do parâmetro da rota `**`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1117">To round-trip path separator characters, use the `**` route parameter prefix.</span></span> <span data-ttu-id="d5000-1118">A rota `foo/{**path}` com `{ path = "my/path" }` gera `foo/my/path`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1118">The route `foo/{**path}` with `{ path = "my/path" }` generates `foo/my/path`.</span></span>

<span data-ttu-id="d5000-1119">Os parâmetros de rota podem ter *valores padrão*, designados pela especificação do valor padrão após o nome do parâmetro separado por um sinal de igual (`=`).</span><span class="sxs-lookup"><span data-stu-id="d5000-1119">Route parameters may have *default values* designated by specifying the default value after the parameter name separated by an equals sign (`=`).</span></span> <span data-ttu-id="d5000-1120">Por exemplo, `{controller=Home}` define `Home` como o valor padrão de `controller`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1120">For example, `{controller=Home}` defines `Home` as the default value for `controller`.</span></span> <span data-ttu-id="d5000-1121">O valor padrão é usado se nenhum valor está presente na URL para o parâmetro.</span><span class="sxs-lookup"><span data-stu-id="d5000-1121">The default value is used if no value is present in the URL for the parameter.</span></span> <span data-ttu-id="d5000-1122">Os parâmetros de rota se tornam opcionais com o acréscimo de um ponto de interrogação (`?`) ao final do nome do parâmetro, como em `id?`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1122">Route parameters are made optional by appending a question mark (`?`) to the end of the parameter name, as in `id?`.</span></span> <span data-ttu-id="d5000-1123">A diferença entre valores opcionais e parâmetros de rota padrão é que um parâmetro de rota com um valor padrão sempre produz um valor – um parâmetro opcional tem um valor somente quando um valor é fornecido pela URL de solicitação.</span><span class="sxs-lookup"><span data-stu-id="d5000-1123">The difference between optional values and default route parameters is that a route parameter with a default value always produces a value&mdash;an optional parameter has a value only when a value is provided by the request URL.</span></span>

<span data-ttu-id="d5000-1124">Os parâmetros de rota podem ter restrições que precisam corresponder ao valor de rota associado da URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-1124">Route parameters may have constraints that must match the route value bound from the URL.</span></span> <span data-ttu-id="d5000-1125">A adição de dois-pontos (`:`) e do nome da restrição após o nome do parâmetro de rota especifica uma *restrição embutida* em um parâmetro de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-1125">Adding a colon (`:`) and constraint name after the route parameter name specifies an *inline constraint* on a route parameter.</span></span> <span data-ttu-id="d5000-1126">Se a restrição exigir argumentos, eles ficarão entre parênteses (`(...)`) após o nome da restrição.</span><span class="sxs-lookup"><span data-stu-id="d5000-1126">If the constraint requires arguments, they're enclosed in parentheses (`(...)`) after the constraint name.</span></span> <span data-ttu-id="d5000-1127">Várias restrições embutidas podem ser especificadas por meio do acréscimo de outros dois-pontos (`:`) e do nome da restrição.</span><span class="sxs-lookup"><span data-stu-id="d5000-1127">Multiple inline constraints can be specified by appending another colon (`:`) and constraint name.</span></span>

<span data-ttu-id="d5000-1128">O nome da restrição e os argumentos são passados para o serviço <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> para criar uma instância de <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> a ser usada no processamento de URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-1128">The constraint name and arguments are passed to the <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> service to create an instance of <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> to use in URL processing.</span></span> <span data-ttu-id="d5000-1129">Por exemplo, o modelo de rota `blog/{article:minlength(10)}` especifica uma restrição `minlength` com o argumento `10`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1129">For example, the route template `blog/{article:minlength(10)}` specifies a `minlength` constraint with the argument `10`.</span></span> <span data-ttu-id="d5000-1130">Para obter mais informações sobre as restrições de rota e uma lista das restrições fornecidas pela estrutura, confira a seção [Referência de restrição de rota](#route-constraint-reference).</span><span class="sxs-lookup"><span data-stu-id="d5000-1130">For more information on route constraints and a list of the constraints provided by the framework, see the [Route constraint reference](#route-constraint-reference) section.</span></span>

<span data-ttu-id="d5000-1131">Os parâmetros de rota também podem ter transformadores de parâmetro, que transformam o valor de um parâmetro ao gerar links e fazer a correspondência de ações e páginas com URLs.</span><span class="sxs-lookup"><span data-stu-id="d5000-1131">Route parameters may also have parameter transformers, which transform a parameter's value when generating links and matching actions and pages to URLs.</span></span> <span data-ttu-id="d5000-1132">Assim como as restrições, os transformadores de parâmetro podem ser adicionados embutidos a um parâmetro de rota colocando dois-pontos (`:`) e o nome do transformador após o nome do parâmetro de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-1132">Like constraints, parameter transformers can be added inline to a route parameter by adding a colon (`:`) and transformer name after the route parameter name.</span></span> <span data-ttu-id="d5000-1133">Por exemplo, o modelo de rota `blog/{article:slugify}` especifica um transformador `slugify`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1133">For example, the route template `blog/{article:slugify}` specifies a `slugify` transformer.</span></span> <span data-ttu-id="d5000-1134">Para obter mais informações sobre transformadores de parâmetro, confira a seção [Referência de transformador de parâmetro](#parameter-transformer-reference).</span><span class="sxs-lookup"><span data-stu-id="d5000-1134">For more information on parameter transformers, see the [Parameter transformer reference](#parameter-transformer-reference) section.</span></span>

<span data-ttu-id="d5000-1135">A tabela a seguir demonstra modelos de rota de exemplo e seu comportamento.</span><span class="sxs-lookup"><span data-stu-id="d5000-1135">The following table demonstrates example route templates and their behavior.</span></span>

| <span data-ttu-id="d5000-1136">Modelo de rota</span><span class="sxs-lookup"><span data-stu-id="d5000-1136">Route Template</span></span>                           | <span data-ttu-id="d5000-1137">URI de correspondência de exemplo</span><span class="sxs-lookup"><span data-stu-id="d5000-1137">Example Matching URI</span></span>    | <span data-ttu-id="d5000-1138">O URI de solicitação&hellip;</span><span class="sxs-lookup"><span data-stu-id="d5000-1138">The request URI&hellip;</span></span>                                                    |
| ---------------------------------------- | ----------------------- | -------------------------------------------------------------------------- |
| `hello`                                  | `/hello`                | <span data-ttu-id="d5000-1139">Somente corresponde ao caminho único `/hello`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1139">Only matches the single path `/hello`.</span></span>                                     |
| `{Page=Home}`                            | `/`                     | <span data-ttu-id="d5000-1140">Faz a correspondência e define `Page` como `Home`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1140">Matches and sets `Page` to `Home`.</span></span>                                         |
| `{Page=Home}`                            | `/Contact`              | <span data-ttu-id="d5000-1141">Faz a correspondência e define `Page` como `Contact`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1141">Matches and sets `Page` to `Contact`.</span></span>                                      |
| `{controller}/{action}/{id?}`            | `/Products/List`        | <span data-ttu-id="d5000-1142">É mapeado para o controlador `Products` e a ação `List`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1142">Maps to the `Products` controller and `List` action.</span></span>                       |
| `{controller}/{action}/{id?}`            | `/Products/Details/123` | <span data-ttu-id="d5000-1143">É mapeado para o controlador `Products` e a ação `Details` (`id` definido como 123).</span><span class="sxs-lookup"><span data-stu-id="d5000-1143">Maps to the `Products` controller and  `Details` action (`id` set to 123).</span></span> |
| `{controller=Home}/{action=Index}/{id?}` | `/`                     | <span data-ttu-id="d5000-1144">É mapeado para o controlador `Home` e o método `Index` (`id` é ignorado).</span><span class="sxs-lookup"><span data-stu-id="d5000-1144">Maps to the `Home` controller and `Index` method (`id` is ignored).</span></span>        |

<span data-ttu-id="d5000-1145">Em geral, o uso de um modelo é a abordagem mais simples para o roteamento.</span><span class="sxs-lookup"><span data-stu-id="d5000-1145">Using a template is generally the simplest approach to routing.</span></span> <span data-ttu-id="d5000-1146">Restrições e padrões também podem ser especificados fora do modelo de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-1146">Constraints and defaults can also be specified outside the route template.</span></span>

> [!TIP]
> <span data-ttu-id="d5000-1147">Habilite o [Log](xref:fundamentals/logging/index) para ver como as implementações de roteamento internas, como <xref:Microsoft.AspNetCore.Routing.Route>, correspondem às solicitações.</span><span class="sxs-lookup"><span data-stu-id="d5000-1147">Enable [Logging](xref:fundamentals/logging/index) to see how the built-in routing implementations, such as <xref:Microsoft.AspNetCore.Routing.Route>, match requests.</span></span>

## <a name="reserved-routing-names"></a><span data-ttu-id="d5000-1148">Nomes reservados de roteamento</span><span class="sxs-lookup"><span data-stu-id="d5000-1148">Reserved routing names</span></span>

<span data-ttu-id="d5000-1149">As seguintes palavras-chave são nomes reservados e não podem ser usadas como nomes de rota ou parâmetros:</span><span class="sxs-lookup"><span data-stu-id="d5000-1149">The following keywords are reserved names and can't be used as route names or parameters:</span></span>

* `action`
* `area`
* `controller`
* `handler`
* `page`

## <a name="route-constraint-reference"></a><span data-ttu-id="d5000-1150">Referência de restrição de rota</span><span class="sxs-lookup"><span data-stu-id="d5000-1150">Route constraint reference</span></span>

<span data-ttu-id="d5000-1151">As restrições de rota são executadas quando ocorre uma correspondência com a URL de entrada e é criado um token do caminho da URL em valores de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-1151">Route constraints execute when a match has occurred to the incoming URL and the URL path is tokenized into route values.</span></span> <span data-ttu-id="d5000-1152">Em geral, as restrições da rota inspecionam o valor de rota associado por meio do modelo de rota e tomam uma decisão do tipo "sim/não" sobre se o valor é aceitável ou não.</span><span class="sxs-lookup"><span data-stu-id="d5000-1152">Route constraints generally inspect the route value associated via the route template and make a yes/no decision about whether or not the value is acceptable.</span></span> <span data-ttu-id="d5000-1153">Algumas restrições da rota usam dados fora do valor de rota para considerar se a solicitação pode ser encaminhada.</span><span class="sxs-lookup"><span data-stu-id="d5000-1153">Some route constraints use data outside the route value to consider whether the request can be routed.</span></span> <span data-ttu-id="d5000-1154">Por exemplo, a <xref:Microsoft.AspNetCore.Routing.Constraints.HttpMethodRouteConstraint> pode aceitar ou rejeitar uma solicitação de acordo com o verbo HTTP.</span><span class="sxs-lookup"><span data-stu-id="d5000-1154">For example, the <xref:Microsoft.AspNetCore.Routing.Constraints.HttpMethodRouteConstraint> can accept or reject a request based on its HTTP verb.</span></span> <span data-ttu-id="d5000-1155">As restrições são usadas em solicitações de roteamento e na geração de link.</span><span class="sxs-lookup"><span data-stu-id="d5000-1155">Constraints are used in routing requests and link generation.</span></span>

> [!WARNING]
> <span data-ttu-id="d5000-1156">Não use restrições para a **validação de entrada**.</span><span class="sxs-lookup"><span data-stu-id="d5000-1156">Don't use constraints for **input validation**.</span></span> <span data-ttu-id="d5000-1157">Se as restrições forem usadas para a **validação de entrada**, uma entrada inválida resultará em uma resposta *404 – Não Encontrado*, em vez de *400 – Solicitação Inválida* com uma mensagem de erro apropriada.</span><span class="sxs-lookup"><span data-stu-id="d5000-1157">If constraints are used for **input validation**, invalid input results in a *404 - Not Found* response instead of a *400 - Bad Request* with an appropriate error message.</span></span> <span data-ttu-id="d5000-1158">As restrições de rota são usadas para **desfazer a ambiguidade** entre rotas semelhantes, não para validar as entradas de uma rota específica.</span><span class="sxs-lookup"><span data-stu-id="d5000-1158">Route constraints are used to **disambiguate** similar routes, not to validate the inputs for a particular route.</span></span>

<span data-ttu-id="d5000-1159">A tabela a seguir demonstra restrições de rota de exemplo e seu comportamento esperado.</span><span class="sxs-lookup"><span data-stu-id="d5000-1159">The following table demonstrates example route constraints and their expected behavior.</span></span>

| <span data-ttu-id="d5000-1160">restrição</span><span class="sxs-lookup"><span data-stu-id="d5000-1160">constraint</span></span> | <span data-ttu-id="d5000-1161">Exemplo</span><span class="sxs-lookup"><span data-stu-id="d5000-1161">Example</span></span> | <span data-ttu-id="d5000-1162">Correspondências de exemplo</span><span class="sxs-lookup"><span data-stu-id="d5000-1162">Example Matches</span></span> | <span data-ttu-id="d5000-1163">Anotações</span><span class="sxs-lookup"><span data-stu-id="d5000-1163">Notes</span></span> |
| ---------- | ------- | --------------- | ----- |
| `int` | `{id:int}` | <span data-ttu-id="d5000-1164">`123456789`, `-123456789`</span><span class="sxs-lookup"><span data-stu-id="d5000-1164">`123456789`, `-123456789`</span></span> | <span data-ttu-id="d5000-1165">Corresponde a qualquer inteiro.</span><span class="sxs-lookup"><span data-stu-id="d5000-1165">Matches any integer.</span></span> |
| `bool` | `{active:bool}` | <span data-ttu-id="d5000-1166">`true`, `FALSE`</span><span class="sxs-lookup"><span data-stu-id="d5000-1166">`true`, `FALSE`</span></span> | <span data-ttu-id="d5000-1167">Corresponde `true` a ou ' false.</span><span class="sxs-lookup"><span data-stu-id="d5000-1167">Matches `true` or \`false.</span></span> <span data-ttu-id="d5000-1168">Não diferencia maiúsculas de minúsculas.</span><span class="sxs-lookup"><span data-stu-id="d5000-1168">Case-insensitive.</span></span> |
| `datetime` | `{dob:datetime}` | <span data-ttu-id="d5000-1169">`2016-12-31`, `2016-12-31 7:32pm`</span><span class="sxs-lookup"><span data-stu-id="d5000-1169">`2016-12-31`, `2016-12-31 7:32pm`</span></span> | <span data-ttu-id="d5000-1170">Corresponde a um `DateTime` valor válido na cultura invariável.</span><span class="sxs-lookup"><span data-stu-id="d5000-1170">Matches a valid `DateTime` value in the invariant culture.</span></span> <span data-ttu-id="d5000-1171">Consulte o aviso anterior.</span><span class="sxs-lookup"><span data-stu-id="d5000-1171">See  preceding warning.</span></span>|
| `decimal` | `{price:decimal}` | <span data-ttu-id="d5000-1172">`49.99`, `-1,000.01`</span><span class="sxs-lookup"><span data-stu-id="d5000-1172">`49.99`, `-1,000.01`</span></span> | <span data-ttu-id="d5000-1173">Corresponde a um `decimal` valor válido na cultura invariável.</span><span class="sxs-lookup"><span data-stu-id="d5000-1173">Matches a valid `decimal` value in the invariant culture.</span></span> <span data-ttu-id="d5000-1174">Consulte o aviso anterior.</span><span class="sxs-lookup"><span data-stu-id="d5000-1174">See  preceding warning.</span></span>|
| `double` | `{weight:double}` | <span data-ttu-id="d5000-1175">`1.234`, `-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="d5000-1175">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="d5000-1176">Corresponde a um `double` valor válido na cultura invariável.</span><span class="sxs-lookup"><span data-stu-id="d5000-1176">Matches a valid `double` value in the invariant culture.</span></span> <span data-ttu-id="d5000-1177">Consulte o aviso anterior.</span><span class="sxs-lookup"><span data-stu-id="d5000-1177">See  preceding warning.</span></span>|
| `float` | `{weight:float}` | <span data-ttu-id="d5000-1178">`1.234`, `-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="d5000-1178">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="d5000-1179">Corresponde a um `float` valor válido na cultura invariável.</span><span class="sxs-lookup"><span data-stu-id="d5000-1179">Matches a valid `float` value in the invariant culture.</span></span> <span data-ttu-id="d5000-1180">Consulte o aviso anterior.</span><span class="sxs-lookup"><span data-stu-id="d5000-1180">See  preceding warning.</span></span>|
| `guid` | `{id:guid}` | <span data-ttu-id="d5000-1181">`CD2C1638-1638-72D5-1638-DEADBEEF1638`, `{CD2C1638-1638-72D5-1638-DEADBEEF1638}`</span><span class="sxs-lookup"><span data-stu-id="d5000-1181">`CD2C1638-1638-72D5-1638-DEADBEEF1638`, `{CD2C1638-1638-72D5-1638-DEADBEEF1638}`</span></span> | <span data-ttu-id="d5000-1182">Corresponde a um `Guid` valor válido.</span><span class="sxs-lookup"><span data-stu-id="d5000-1182">Matches a valid `Guid` value.</span></span> |
| `long` | `{ticks:long}` | <span data-ttu-id="d5000-1183">`123456789`, `-123456789`</span><span class="sxs-lookup"><span data-stu-id="d5000-1183">`123456789`, `-123456789`</span></span> | <span data-ttu-id="d5000-1184">Corresponde a um `long` valor válido.</span><span class="sxs-lookup"><span data-stu-id="d5000-1184">Matches a valid `long` value.</span></span> |
| `minlength(value)` | `{username:minlength(4)}` | `Rick` | <span data-ttu-id="d5000-1185">A cadeia de caracteres deve ter pelo menos 4 caracteres.</span><span class="sxs-lookup"><span data-stu-id="d5000-1185">String must be at least 4 characters.</span></span> |
| `maxlength(value)` | `{filename:maxlength(8)}` | `MyFile` | <span data-ttu-id="d5000-1186">A cadeia de caracteres tem no máximo 8 caracteres.</span><span class="sxs-lookup"><span data-stu-id="d5000-1186">String has maximum of 8 characters.</span></span> |
| `length(length)` | `{filename:length(12)}` | `somefile.txt` | <span data-ttu-id="d5000-1187">A cadeia de caracteres deve ter exatamente 12 caracteres.</span><span class="sxs-lookup"><span data-stu-id="d5000-1187">String must be exactly 12 characters long.</span></span> |
| `length(min,max)` | `{filename:length(8,16)}` | `somefile.txt` | <span data-ttu-id="d5000-1188">A cadeia de caracteres deve ser pelo menos 8 e ter no máximo 16 caracteres.</span><span class="sxs-lookup"><span data-stu-id="d5000-1188">String must be at least 8 and has maximum of 16 characters.</span></span> |
| `min(value)` | `{age:min(18)}` | `19` | <span data-ttu-id="d5000-1189">O valor inteiro deve ser pelo menos 18.</span><span class="sxs-lookup"><span data-stu-id="d5000-1189">Integer value must be at least 18.</span></span> |
| `max(value)` | `{age:max(120)}` | `91` | <span data-ttu-id="d5000-1190">Valor inteiro máximo de 120.</span><span class="sxs-lookup"><span data-stu-id="d5000-1190">Integer value maximum of 120.</span></span> |
| `range(min,max)` | `{age:range(18,120)}` | `91` | <span data-ttu-id="d5000-1191">O valor inteiro deve ser pelo menos 18 e o máximo de 120.</span><span class="sxs-lookup"><span data-stu-id="d5000-1191">Integer value must be at least 18 and maximum of 120.</span></span> |
| `alpha` | `{name:alpha}` | `Rick` | <span data-ttu-id="d5000-1192">A cadeia de caracteres deve consistir em um ou `a` - `z`mais caracteres alfabéticos.</span><span class="sxs-lookup"><span data-stu-id="d5000-1192">String must consist of one or more alphabetical characters `a`-`z`.</span></span>  <span data-ttu-id="d5000-1193">Não diferencia maiúsculas de minúsculas.</span><span class="sxs-lookup"><span data-stu-id="d5000-1193">Case-insensitive.</span></span> |
| `regex(expression)` | `{ssn:regex(^\\d{{3}}-\\d{{2}}-\\d{{4}}$)}` | `123-45-6789` | <span data-ttu-id="d5000-1194">A cadeia de caracteres deve corresponder à expressão regular.</span><span class="sxs-lookup"><span data-stu-id="d5000-1194">String must match the regular expression.</span></span> <span data-ttu-id="d5000-1195">Confira dicas sobre como definir uma expressão regular.</span><span class="sxs-lookup"><span data-stu-id="d5000-1195">See tips about defining a regular expression.</span></span> |
| `required` | `{name:required}` | `Rick` | <span data-ttu-id="d5000-1196">Usado para impor que um valor não parâmetro esteja presente durante a geração de URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-1196">Used to enforce that a non-parameter value is present during URL generation.</span></span> |

<span data-ttu-id="d5000-1197">Várias restrições delimitadas por vírgula podem ser aplicadas a um único parâmetro.</span><span class="sxs-lookup"><span data-stu-id="d5000-1197">Multiple, colon-delimited constraints can be applied to a single parameter.</span></span> <span data-ttu-id="d5000-1198">Por exemplo, a restrição a seguir restringe um parâmetro para um valor inteiro de 1 ou maior:</span><span class="sxs-lookup"><span data-stu-id="d5000-1198">For example, the following constraint restricts a parameter to an integer value of 1 or greater:</span></span>

```csharp
[Route("users/{id:int:min(1)}")]
public User GetUserById(int id) { }
```

> [!WARNING]
> <span data-ttu-id="d5000-1199">As restrições de rota que verificam a URL e são convertidas em um tipo CLR (como `int` ou `DateTime`) sempre usam a cultura invariável.</span><span class="sxs-lookup"><span data-stu-id="d5000-1199">Route constraints that verify the URL and are converted to a CLR type (such as `int` or `DateTime`) always use the invariant culture.</span></span> <span data-ttu-id="d5000-1200">Essas restrições consideram que a URL não é localizável.</span><span class="sxs-lookup"><span data-stu-id="d5000-1200">These constraints assume that the URL is non-localizable.</span></span> <span data-ttu-id="d5000-1201">As restrições de rota fornecidas pela estrutura não modificam os valores armazenados nos valores de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-1201">The framework-provided route constraints don't modify the values stored in route values.</span></span> <span data-ttu-id="d5000-1202">Todos os valores de rota analisados com base na URL são armazenados como cadeias de caracteres.</span><span class="sxs-lookup"><span data-stu-id="d5000-1202">All route values parsed from the URL are stored as strings.</span></span> <span data-ttu-id="d5000-1203">Por exemplo, a restrição `float` tenta converter o valor de rota em um float, mas o valor convertido é usado somente para verificar se ele pode ser convertido em um float.</span><span class="sxs-lookup"><span data-stu-id="d5000-1203">For example, the `float` constraint attempts to convert the route value to a float, but the converted value is used only to verify it can be converted to a float.</span></span>

## <a name="regular-expressions"></a><span data-ttu-id="d5000-1204">Expressões regulares</span><span class="sxs-lookup"><span data-stu-id="d5000-1204">Regular expressions</span></span>

<span data-ttu-id="d5000-1205">A estrutura do ASP.NET Core adiciona `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant` ao construtor de expressão regular.</span><span class="sxs-lookup"><span data-stu-id="d5000-1205">The ASP.NET Core framework adds `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant` to the regular expression constructor.</span></span> <span data-ttu-id="d5000-1206">Confira <xref:System.Text.RegularExpressions.RegexOptions> para obter uma descrição desses membros.</span><span class="sxs-lookup"><span data-stu-id="d5000-1206">See <xref:System.Text.RegularExpressions.RegexOptions> for a description of these members.</span></span>

<span data-ttu-id="d5000-1207">As expressões regulares usam delimitadores e tokens semelhantes aos usados pelo roteamento e pela linguagem C#.</span><span class="sxs-lookup"><span data-stu-id="d5000-1207">Regular expressions use delimiters and tokens similar to those used by routing and the C# language.</span></span> <span data-ttu-id="d5000-1208">Os tokens de expressão regular precisam ter escape.</span><span class="sxs-lookup"><span data-stu-id="d5000-1208">Regular expression tokens must be escaped.</span></span> <span data-ttu-id="d5000-1209">Para usar a expressão `^\d{3}-\d{2}-\d{4}$` regular no roteamento:</span><span class="sxs-lookup"><span data-stu-id="d5000-1209">To use the regular expression `^\d{3}-\d{2}-\d{4}$` in routing:</span></span>

* <span data-ttu-id="d5000-1210">A expressão deve ter os caracteres de barra `\` invertida única fornecidos na cadeia de caracteres como `\\` caractere de barra invertida dupla no código-fonte.</span><span class="sxs-lookup"><span data-stu-id="d5000-1210">The expression must have the single backslash `\` characters provided in the string as double backslash `\\` characters in the source code.</span></span>
* <span data-ttu-id="d5000-1211">A expressão regular deve `\\` ser para escapar do caractere de `\` escape da cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="d5000-1211">The regular expression must us `\\` in order to escape the `\` string escape character.</span></span>
* <span data-ttu-id="d5000-1212">A expressão regular não requer `\\` ao usar [literais de cadeia de caracteres textuais](/dotnet/csharp/language-reference/keywords/string).</span><span class="sxs-lookup"><span data-stu-id="d5000-1212">The regular expression doesn't require `\\` when using [verbatim string literals](/dotnet/csharp/language-reference/keywords/string).</span></span>

<span data-ttu-id="d5000-1213">Para escapar os caracteres `{`delimitadores `}`de `[`parâmetro `]`de roteamento,,,, duplos `}`os `[[`caracteres `]]`na expressão `{{`,,,,.</span><span class="sxs-lookup"><span data-stu-id="d5000-1213">To escape routing parameter delimiter characters `{`, `}`, `[`, `]`, double the characters in the expression `{{`, `}`, `[[`, `]]`.</span></span> <span data-ttu-id="d5000-1214">A tabela a seguir mostra uma expressão regular e a versão de escape:</span><span class="sxs-lookup"><span data-stu-id="d5000-1214">The following table shows a regular expression and the escaped version:</span></span>

| <span data-ttu-id="d5000-1215">Expressão regular</span><span class="sxs-lookup"><span data-stu-id="d5000-1215">Regular Expression</span></span>    | <span data-ttu-id="d5000-1216">Expressão regular com escape</span><span class="sxs-lookup"><span data-stu-id="d5000-1216">Escaped Regular Expression</span></span>     |
| --------------------- | ------------------------------ |
| `^\d{3}-\d{2}-\d{4}$` | `^\\d{{3}}-\\d{{2}}-\\d{{4}}$` |
| `^[a-z]{2}$`          | `^[[a-z]]{{2}}$`               |

<span data-ttu-id="d5000-1217">As expressões regulares usadas no roteamento geralmente começam com o `^` caractere de cursor e correspondem à posição inicial da cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="d5000-1217">Regular expressions used in routing often start with the caret `^` character and match starting position of the string.</span></span> <span data-ttu-id="d5000-1218">As expressões geralmente terminam com o caractere `$` de sinal de dólar e correspondem ao final da cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="d5000-1218">The expressions often end with the dollar sign `$` character and match end of the string.</span></span> <span data-ttu-id="d5000-1219">Os caracteres `^` e `$` garantem que a expressão regular corresponde a todo o valor do parâmetro de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-1219">The `^` and `$` characters ensure that the regular expression match the entire route parameter value.</span></span> <span data-ttu-id="d5000-1220">Sem os caracteres `^` e `$`, a expressão regular corresponde a qualquer subcadeia de caracteres na cadeia de caracteres, o que geralmente não é o desejado.</span><span class="sxs-lookup"><span data-stu-id="d5000-1220">Without the `^` and `$` characters, the regular expression match any substring within the string, which is often undesirable.</span></span> <span data-ttu-id="d5000-1221">A tabela a seguir fornece exemplos e explica por que eles encontram ou não uma correspondência.</span><span class="sxs-lookup"><span data-stu-id="d5000-1221">The following table provides examples and explains why they match or fail to match.</span></span>

| <span data-ttu-id="d5000-1222">Expression</span><span class="sxs-lookup"><span data-stu-id="d5000-1222">Expression</span></span>   | <span data-ttu-id="d5000-1223">Cadeia de caracteres</span><span class="sxs-lookup"><span data-stu-id="d5000-1223">String</span></span>    | <span data-ttu-id="d5000-1224">Correspondência</span><span class="sxs-lookup"><span data-stu-id="d5000-1224">Match</span></span> | <span data-ttu-id="d5000-1225">Comentário</span><span class="sxs-lookup"><span data-stu-id="d5000-1225">Comment</span></span>               |
| ------------ | --------- | :---: |  -------------------- |
| `[a-z]{2}`   | <span data-ttu-id="d5000-1226">hello</span><span class="sxs-lookup"><span data-stu-id="d5000-1226">hello</span></span>     | <span data-ttu-id="d5000-1227">Sim</span><span class="sxs-lookup"><span data-stu-id="d5000-1227">Yes</span></span>   | <span data-ttu-id="d5000-1228">A subcadeia de caracteres corresponde</span><span class="sxs-lookup"><span data-stu-id="d5000-1228">Substring matches</span></span>     |
| `[a-z]{2}`   | <span data-ttu-id="d5000-1229">123abc456</span><span class="sxs-lookup"><span data-stu-id="d5000-1229">123abc456</span></span> | <span data-ttu-id="d5000-1230">Sim</span><span class="sxs-lookup"><span data-stu-id="d5000-1230">Yes</span></span>   | <span data-ttu-id="d5000-1231">A subcadeia de caracteres corresponde</span><span class="sxs-lookup"><span data-stu-id="d5000-1231">Substring matches</span></span>     |
| `[a-z]{2}`   | <span data-ttu-id="d5000-1232">mz</span><span class="sxs-lookup"><span data-stu-id="d5000-1232">mz</span></span>        | <span data-ttu-id="d5000-1233">Sim</span><span class="sxs-lookup"><span data-stu-id="d5000-1233">Yes</span></span>   | <span data-ttu-id="d5000-1234">Corresponde à expressão</span><span class="sxs-lookup"><span data-stu-id="d5000-1234">Matches expression</span></span>    |
| `[a-z]{2}`   | <span data-ttu-id="d5000-1235">MZ</span><span class="sxs-lookup"><span data-stu-id="d5000-1235">MZ</span></span>        | <span data-ttu-id="d5000-1236">Sim</span><span class="sxs-lookup"><span data-stu-id="d5000-1236">Yes</span></span>   | <span data-ttu-id="d5000-1237">Não diferencia maiúsculas de minúsculas</span><span class="sxs-lookup"><span data-stu-id="d5000-1237">Not case sensitive</span></span>    |
| `^[a-z]{2}$` | <span data-ttu-id="d5000-1238">hello</span><span class="sxs-lookup"><span data-stu-id="d5000-1238">hello</span></span>     | <span data-ttu-id="d5000-1239">Não</span><span class="sxs-lookup"><span data-stu-id="d5000-1239">No</span></span>    | <span data-ttu-id="d5000-1240">Confira `^` e `$` acima</span><span class="sxs-lookup"><span data-stu-id="d5000-1240">See `^` and `$` above</span></span> |
| `^[a-z]{2}$` | <span data-ttu-id="d5000-1241">123abc456</span><span class="sxs-lookup"><span data-stu-id="d5000-1241">123abc456</span></span> | <span data-ttu-id="d5000-1242">Não</span><span class="sxs-lookup"><span data-stu-id="d5000-1242">No</span></span>    | <span data-ttu-id="d5000-1243">Confira `^` e `$` acima</span><span class="sxs-lookup"><span data-stu-id="d5000-1243">See `^` and `$` above</span></span> |

<span data-ttu-id="d5000-1244">Para saber mais sobre a sintaxe de expressões regulares, confira [Expressões regulares do .NET Framework](/dotnet/standard/base-types/regular-expression-language-quick-reference).</span><span class="sxs-lookup"><span data-stu-id="d5000-1244">For more information on regular expression syntax, see [.NET Framework Regular Expressions](/dotnet/standard/base-types/regular-expression-language-quick-reference).</span></span>

<span data-ttu-id="d5000-1245">Para restringir um parâmetro a um conjunto conhecido de valores possíveis, use uma expressão regular.</span><span class="sxs-lookup"><span data-stu-id="d5000-1245">To constrain a parameter to a known set of possible values, use a regular expression.</span></span> <span data-ttu-id="d5000-1246">Por exemplo, `{action:regex(^(list|get|create)$)}` apenas corresponde o valor da rota `action` a `list`, `get` ou `create`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1246">For example, `{action:regex(^(list|get|create)$)}` only matches the `action` route value to `list`, `get`, or `create`.</span></span> <span data-ttu-id="d5000-1247">Se passada para o dicionário de restrições, a cadeia de caracteres `^(list|get|create)$` é equivalente.</span><span class="sxs-lookup"><span data-stu-id="d5000-1247">If passed into the constraints dictionary, the string `^(list|get|create)$` is equivalent.</span></span> <span data-ttu-id="d5000-1248">As restrições passadas para o dicionário de restrições (não embutidas em um modelo) que não correspondem a uma das restrições conhecidas também são tratadas como expressões regulares.</span><span class="sxs-lookup"><span data-stu-id="d5000-1248">Constraints that are passed in the constraints dictionary (not inline within a template) that don't match one of the known constraints are also treated as regular expressions.</span></span>

## <a name="custom-route-constraints"></a><span data-ttu-id="d5000-1249">Restrições de rotas personalizadas</span><span class="sxs-lookup"><span data-stu-id="d5000-1249">Custom route constraints</span></span>

<span data-ttu-id="d5000-1250">Além das restrições de rota internas, é possível criar restrições de rota personalizadas com a implementação da interface do <xref:Microsoft.AspNetCore.Routing.IRouteConstraint>.</span><span class="sxs-lookup"><span data-stu-id="d5000-1250">In addition to the built-in route constraints, custom route constraints can be created by implementing the <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> interface.</span></span> <span data-ttu-id="d5000-1251">A interface do <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> contém um único método, `Match`, que retorna `true` quando a restrição é satisfeita. Caso contrário, retorna `false`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1251">The <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> interface contains a single method, `Match`, which returns `true` if the constraint is satisfied and `false` otherwise.</span></span>

<span data-ttu-id="d5000-1252">Para usar uma <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> personalizada, o tipo de restrição de rota deve ser registrado com o <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> do aplicativo, no contêiner de serviço do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d5000-1252">To use a custom <xref:Microsoft.AspNetCore.Routing.IRouteConstraint>, the route constraint type must be registered with the app's <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> in the app's service container.</span></span> <span data-ttu-id="d5000-1253">O <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> é um dicionário que mapeia as chaves de restrição de rota para implementações de <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> que validam essas restrições.</span><span class="sxs-lookup"><span data-stu-id="d5000-1253">A <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> is a dictionary that maps route constraint keys to <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> implementations that validate those constraints.</span></span> <span data-ttu-id="d5000-1254">É possível atualizar o <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> do aplicativo no `Startup.ConfigureServices` como parte de uma chamada [services.AddRouting](xref:Microsoft.Extensions.DependencyInjection.RoutingServiceCollectionExtensions.AddRouting*) ou configurando <xref:Microsoft.AspNetCore.Routing.RouteOptions> diretamente com `services.Configure<RouteOptions>`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1254">An app's <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> can be updated in `Startup.ConfigureServices` either as part of a [services.AddRouting](xref:Microsoft.Extensions.DependencyInjection.RoutingServiceCollectionExtensions.AddRouting*) call or by configuring <xref:Microsoft.AspNetCore.Routing.RouteOptions> directly with `services.Configure<RouteOptions>`.</span></span> <span data-ttu-id="d5000-1255">Por exemplo: </span><span class="sxs-lookup"><span data-stu-id="d5000-1255">For example:</span></span>

```csharp
services.AddRouting(options =>
{
    options.ConstraintMap.Add("customName", typeof(MyCustomConstraint));
});
```

<span data-ttu-id="d5000-1256">a restrição pode então ser aplicada às rotas da maneira usual, usando o nome especificado ao registrar o tipo de restrição.</span><span class="sxs-lookup"><span data-stu-id="d5000-1256">The constraint can then be applied to routes in the usual manner, using the name specified when registering the constraint type.</span></span> <span data-ttu-id="d5000-1257">Por exemplo: </span><span class="sxs-lookup"><span data-stu-id="d5000-1257">For example:</span></span>

```csharp
[HttpGet("{id:customName}")]
public ActionResult<string> Get(string id)
```

## <a name="parameter-transformer-reference"></a><span data-ttu-id="d5000-1258">Referência de parâmetro de transformador</span><span class="sxs-lookup"><span data-stu-id="d5000-1258">Parameter transformer reference</span></span>

<span data-ttu-id="d5000-1259">Transformadores de parâmetro:</span><span class="sxs-lookup"><span data-stu-id="d5000-1259">Parameter transformers:</span></span>

* <span data-ttu-id="d5000-1260">Executar ao gerar um link para um <xref:Microsoft.AspNetCore.Routing.Route>.</span><span class="sxs-lookup"><span data-stu-id="d5000-1260">Execute when generating a link for a <xref:Microsoft.AspNetCore.Routing.Route>.</span></span>
* <span data-ttu-id="d5000-1261">Implementar `Microsoft.AspNetCore.Routing.IOutboundParameterTransformer`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1261">Implement `Microsoft.AspNetCore.Routing.IOutboundParameterTransformer`.</span></span>
* <span data-ttu-id="d5000-1262">São configurados usando <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap>.</span><span class="sxs-lookup"><span data-stu-id="d5000-1262">Are configured using <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap>.</span></span>
* <span data-ttu-id="d5000-1263">Usam o valor de rota do parâmetro e o transformam em um novo valor de cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="d5000-1263">Take the parameter's route value and transform it to a new string value.</span></span>
* <span data-ttu-id="d5000-1264">Resultam no uso do valor transformado no link gerado.</span><span class="sxs-lookup"><span data-stu-id="d5000-1264">Result in using the transformed value in the generated link.</span></span>

<span data-ttu-id="d5000-1265">Por exemplo, um transformador de parâmetro `slugify` personalizado em padrão de rota `blog\{article:slugify}` com `Url.Action(new { article = "MyTestArticle" })` gera `blog\my-test-article`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1265">For example, a custom `slugify` parameter transformer in route pattern `blog\{article:slugify}` with `Url.Action(new { article = "MyTestArticle" })` generates `blog\my-test-article`.</span></span>

<span data-ttu-id="d5000-1266">Para usar um transformador de parâmetro em um padrão de rota, configure-o primeiro usando <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> em `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="d5000-1266">To use a parameter transformer in a route pattern, configure it first using <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> in `Startup.ConfigureServices`:</span></span>

```csharp
services.AddRouting(options =>
{
    // Replace the type and the name used to refer to it with your own
    // IOutboundParameterTransformer implementation
    options.ConstraintMap["slugify"] = typeof(SlugifyParameterTransformer);
});
```

<span data-ttu-id="d5000-1267">Os transformadores de parâmetro são usados pela estrutura para transformar o URI no qual um ponto de extremidade é resolvido.</span><span class="sxs-lookup"><span data-stu-id="d5000-1267">Parameter transformers are used by the framework to transform the URI where an endpoint resolves.</span></span> <span data-ttu-id="d5000-1268">Por exemplo, o ASP.NET Core MVC usa os transformadores de parâmetro para transformar o valor de rota usado para corresponder a um `area`, `controller`, `action` e `page`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1268">For example, ASP.NET Core MVC uses parameter transformers to transform the route value used to match an `area`, `controller`, `action`, and `page`.</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller:slugify=Home}/{action:slugify=Index}/{id?}");
```

<span data-ttu-id="d5000-1269">Com a rota anterior, a ação `SubscriptionManagementController.GetAll` é combinada com o URI `/subscription-management/get-all`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1269">With the preceding route, the action `SubscriptionManagementController.GetAll` is matched with the URI `/subscription-management/get-all`.</span></span> <span data-ttu-id="d5000-1270">Um transformador de parâmetro não altera os valores de rota usados para gerar um link.</span><span class="sxs-lookup"><span data-stu-id="d5000-1270">A parameter transformer doesn't change the route values used to generate a link.</span></span> <span data-ttu-id="d5000-1271">Por exemplo, `Url.Action("GetAll", "SubscriptionManagement")` gera `/subscription-management/get-all`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1271">For example, `Url.Action("GetAll", "SubscriptionManagement")` outputs `/subscription-management/get-all`.</span></span>

<span data-ttu-id="d5000-1272">ASP.NET Core fornece convenções de API para usar transformadores de parâmetro com as rotas geradas:</span><span class="sxs-lookup"><span data-stu-id="d5000-1272">ASP.NET Core provides API conventions for using a parameter transformers with generated routes:</span></span>

* <span data-ttu-id="d5000-1273">ASP.NET Core MVC tem a convenção de API `Microsoft.AspNetCore.Mvc.ApplicationModels.RouteTokenTransformerConvention`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1273">ASP.NET Core MVC has the `Microsoft.AspNetCore.Mvc.ApplicationModels.RouteTokenTransformerConvention` API convention.</span></span> <span data-ttu-id="d5000-1274">Essa convenção aplica um transformador de parâmetro especificado a todas as rotas de atributo no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d5000-1274">This convention applies a specified parameter transformer to all attribute routes in the app.</span></span> <span data-ttu-id="d5000-1275">O transformador de parâmetro transforma os tokens de rota do atributo conforme elas são substituídas.</span><span class="sxs-lookup"><span data-stu-id="d5000-1275">The parameter transformer transforms attribute route tokens as they are replaced.</span></span> <span data-ttu-id="d5000-1276">Para obter mais informações, confira [Usar um transformador de parâmetro para personalizar a substituição de token](/aspnet/core/mvc/controllers/routing#use-a-parameter-transformer-to-customize-token-replacement).</span><span class="sxs-lookup"><span data-stu-id="d5000-1276">For more information, see [Use a parameter transformer to customize token replacement](/aspnet/core/mvc/controllers/routing#use-a-parameter-transformer-to-customize-token-replacement).</span></span>
* <span data-ttu-id="d5000-1277">O Razor Pages tem a convenção de API `Microsoft.AspNetCore.Mvc.ApplicationModels.PageRouteTransformerConvention`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1277">Razor Pages has the `Microsoft.AspNetCore.Mvc.ApplicationModels.PageRouteTransformerConvention` API convention.</span></span> <span data-ttu-id="d5000-1278">Essa convenção aplica um transformador de parâmetro especificado a todas as Razor Pages descobertas automaticamente.</span><span class="sxs-lookup"><span data-stu-id="d5000-1278">This convention applies a specified parameter transformer to all automatically discovered Razor Pages.</span></span> <span data-ttu-id="d5000-1279">O transformador de parâmetro transforma os segmentos de nome de arquivo e pasta de rotas do Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="d5000-1279">The parameter transformer transforms the folder and file name segments of Razor Pages routes.</span></span> <span data-ttu-id="d5000-1280">Para obter mais informações, confira [Usar um transformador de parâmetros para personalizar rotas de página](/aspnet/core/razor-pages/razor-pages-conventions#use-a-parameter-transformer-to-customize-page-routes).</span><span class="sxs-lookup"><span data-stu-id="d5000-1280">For more information, see [Use a parameter transformer to customize page routes](/aspnet/core/razor-pages/razor-pages-conventions#use-a-parameter-transformer-to-customize-page-routes).</span></span>

## <a name="url-generation-reference"></a><span data-ttu-id="d5000-1281">Referência de geração de URL</span><span class="sxs-lookup"><span data-stu-id="d5000-1281">URL generation reference</span></span>

<span data-ttu-id="d5000-1282">O exemplo a seguir mostra como gerar um link para uma rota com base em um dicionário de valores de rota e em um <xref:Microsoft.AspNetCore.Routing.RouteCollection>.</span><span class="sxs-lookup"><span data-stu-id="d5000-1282">The following example shows how to generate a link to a route given a dictionary of route values and a <xref:Microsoft.AspNetCore.Routing.RouteCollection>.</span></span>

[!code-csharp[](routing/samples/2.x/RoutingSample/Startup.cs?name=snippet_Dictionary)]

<span data-ttu-id="d5000-1283">O <xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath> gerado no final do exemplo anterior é `/package/create/123`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1283">The <xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath> generated at the end of the preceding sample is `/package/create/123`.</span></span> <span data-ttu-id="d5000-1284">O dicionário fornece os valores de rota `operation` e `id` do modelo "Rastrear rota do pacote", `package/{operation}/{id}`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1284">The dictionary supplies the `operation` and `id` route values of the "Track Package Route" template, `package/{operation}/{id}`.</span></span> <span data-ttu-id="d5000-1285">Para obter detalhes, consulte o código de exemplo na seção [Usar o middleware de roteamento](#use-routing-middleware) ou no [aplicativo de exemplo](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/routing/samples).</span><span class="sxs-lookup"><span data-stu-id="d5000-1285">For details, see the sample code in the [Use Routing Middleware](#use-routing-middleware) section or the [sample app](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/routing/samples).</span></span>

<span data-ttu-id="d5000-1286">O segundo parâmetro para o construtor <xref:Microsoft.AspNetCore.Routing.VirtualPathContext> é uma coleção de *valores de ambiente*.</span><span class="sxs-lookup"><span data-stu-id="d5000-1286">The second parameter to the <xref:Microsoft.AspNetCore.Routing.VirtualPathContext> constructor is a collection of *ambient values*.</span></span> <span data-ttu-id="d5000-1287">Os valores de ambiente são convenientes de serem usados porque limitam o número de valores que um desenvolvedor precisa especificar em um contexto de solicitação.</span><span class="sxs-lookup"><span data-stu-id="d5000-1287">Ambient values are convenient to use because they limit the number of values a developer must specify within a request context.</span></span> <span data-ttu-id="d5000-1288">Os valores de rota atuais da solicitação atual são considerados valores de ambiente para a geração de link.</span><span class="sxs-lookup"><span data-stu-id="d5000-1288">The current route values of the current request are considered ambient values for link generation.</span></span> <span data-ttu-id="d5000-1289">Na ação `About` de um aplicativo ASP.NET Core MVC do `HomeController`, não é necessário especificar o valor de rota do controlador a ser vinculado à ação `Index` – o valor de ambiente `Home` é usado.</span><span class="sxs-lookup"><span data-stu-id="d5000-1289">In an ASP.NET Core MVC app's `About` action of the `HomeController`, you don't need to specify the controller route value to link to the `Index` action&mdash;the ambient value of `Home` is used.</span></span>

<span data-ttu-id="d5000-1290">Os valores de ambiente que não correspondem a um parâmetro são ignorados.</span><span class="sxs-lookup"><span data-stu-id="d5000-1290">Ambient values that don't match a parameter are ignored.</span></span> <span data-ttu-id="d5000-1291">Os valores de ambiente também são ignorados quando um valor fornecido explicitamente substitui o valor de ambiente.</span><span class="sxs-lookup"><span data-stu-id="d5000-1291">Ambient values are also ignored when an explicitly provided value overrides the ambient value.</span></span> <span data-ttu-id="d5000-1292">A correspondência ocorre da esquerda para a direita na URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-1292">Matching occurs from left to right in the URL.</span></span>

<span data-ttu-id="d5000-1293">Valores fornecidos explicitamente, mas que não correspondem a um segmento da rota, são adicionados à cadeia de consulta.</span><span class="sxs-lookup"><span data-stu-id="d5000-1293">Values explicitly provided but that don't match a segment of the route are added to the query string.</span></span> <span data-ttu-id="d5000-1294">A tabela a seguir mostra o resultado do uso do modelo de rota `{controller}/{action}/{id?}`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1294">The following table shows the result when using the route template `{controller}/{action}/{id?}`.</span></span>

| <span data-ttu-id="d5000-1295">Valores de ambiente</span><span class="sxs-lookup"><span data-stu-id="d5000-1295">Ambient Values</span></span>                     | <span data-ttu-id="d5000-1296">Valores explícitos</span><span class="sxs-lookup"><span data-stu-id="d5000-1296">Explicit Values</span></span>                        | <span data-ttu-id="d5000-1297">Result</span><span class="sxs-lookup"><span data-stu-id="d5000-1297">Result</span></span>                  |
| ---------------------------------- | -------------------------------------- | ----------------------- |
| <span data-ttu-id="d5000-1298">controlador = "Home"</span><span class="sxs-lookup"><span data-stu-id="d5000-1298">controller = "Home"</span></span>                | <span data-ttu-id="d5000-1299">ação = "About"</span><span class="sxs-lookup"><span data-stu-id="d5000-1299">action = "About"</span></span>                       | `/Home/About`           |
| <span data-ttu-id="d5000-1300">controlador = "Home"</span><span class="sxs-lookup"><span data-stu-id="d5000-1300">controller = "Home"</span></span>                | <span data-ttu-id="d5000-1301">controlador = "Order", ação = "About"</span><span class="sxs-lookup"><span data-stu-id="d5000-1301">controller = "Order", action = "About"</span></span> | `/Order/About`          |
| <span data-ttu-id="d5000-1302">controlador = "Home", cor = "Red"</span><span class="sxs-lookup"><span data-stu-id="d5000-1302">controller = "Home", color = "Red"</span></span> | <span data-ttu-id="d5000-1303">ação = "About"</span><span class="sxs-lookup"><span data-stu-id="d5000-1303">action = "About"</span></span>                       | `/Home/About`           |
| <span data-ttu-id="d5000-1304">controlador = "Home"</span><span class="sxs-lookup"><span data-stu-id="d5000-1304">controller = "Home"</span></span>                | <span data-ttu-id="d5000-1305">ação = "About", cor = "Red"</span><span class="sxs-lookup"><span data-stu-id="d5000-1305">action = "About", color = "Red"</span></span>        | `/Home/About?color=Red` |

<span data-ttu-id="d5000-1306">Se uma rota tem um valor padrão que não corresponde a um parâmetro e esse valor é fornecido de forma explícita, ele precisa corresponder ao valor padrão:</span><span class="sxs-lookup"><span data-stu-id="d5000-1306">If a route has a default value that doesn't correspond to a parameter and that value is explicitly provided, it must match the default value:</span></span>

```csharp
routes.MapRoute("blog_route", "blog/{*slug}",
    defaults: new { controller = "Blog", action = "ReadPost" });
```

<span data-ttu-id="d5000-1307">A geração de link somente gera um link para essa rota quando os valores correspondentes de `controller` e `action` são fornecidos.</span><span class="sxs-lookup"><span data-stu-id="d5000-1307">Link generation only generates a link for this route when the matching values for `controller` and `action` are provided.</span></span>

## <a name="complex-segments"></a><span data-ttu-id="d5000-1308">Segmentos complexos</span><span class="sxs-lookup"><span data-stu-id="d5000-1308">Complex segments</span></span>

<span data-ttu-id="d5000-1309">Segmentos complexos (por exemplo, `[Route("/x{token}y")]`) são processados por meio da combinação de literais da direita para a esquerda, de uma maneira diferente de Greedy.</span><span class="sxs-lookup"><span data-stu-id="d5000-1309">Complex segments (for example `[Route("/x{token}y")]`) are processed by matching up literals from right to left in a non-greedy way.</span></span> <span data-ttu-id="d5000-1310">Confira [este código](https://github.com/dotnet/AspNetCore/blob/release/2.2/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293) para ver uma explicação detalhada de como os segmentos complexos são combinados.</span><span class="sxs-lookup"><span data-stu-id="d5000-1310">See [this code](https://github.com/dotnet/AspNetCore/blob/release/2.2/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293) for a detailed explanation of how complex segments are matched.</span></span> <span data-ttu-id="d5000-1311">O [exemplo de código](https://github.com/dotnet/AspNetCore/blob/release/2.2/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293) não é usado pelo ASP.NET Core, mas fornece uma explicação adequada sobre segmentos complexos.</span><span class="sxs-lookup"><span data-stu-id="d5000-1311">The [code sample](https://github.com/dotnet/AspNetCore/blob/release/2.2/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293) is not used by ASP.NET Core, but it provides a good explanation of complex segments.</span></span>
<!-- While that code is no longer used by ASP.NET Core for complex segment matching, it provides a good match to the current algorithm. The [current code](https://github.com/dotnet/AspNetCore/blob/91514c9af7e0f4c44029b51f05a01c6fe4c96e4c/src/Http/Routing/src/Matching/DfaMatcherBuilder.cs#L227-L244) is too abstracted from matching to be useful for understanding complex segment matching.
-->

::: moniker-end

::: moniker range="< aspnetcore-2.2"

<span data-ttu-id="d5000-1312">O roteamento é responsável por mapear URIs de solicitação para manipuladores de rotas e expedir as solicitações de entrada.</span><span class="sxs-lookup"><span data-stu-id="d5000-1312">Routing is responsible for mapping request URIs to route handlers and dispatching an incoming requests.</span></span> <span data-ttu-id="d5000-1313">As rotas são definidas no aplicativo e configuradas quando o aplicativo é iniciado.</span><span class="sxs-lookup"><span data-stu-id="d5000-1313">Routes are defined in the app and configured when the app starts.</span></span> <span data-ttu-id="d5000-1314">Uma rota pode opcionalmente extrair os valores da URL contida na solicitação e esses valores podem então ser usados para o processamento da solicitação.</span><span class="sxs-lookup"><span data-stu-id="d5000-1314">A route can optionally extract values from the URL contained in the request, and these values can then be used for request processing.</span></span> <span data-ttu-id="d5000-1315">Usando rotas configuradas no aplicativo, o roteamento pode gerar URLs que são mapeadas para manipuladores de rotas.</span><span class="sxs-lookup"><span data-stu-id="d5000-1315">Using configured routes from the app, routing is able to generate URLs that map to route handlers.</span></span>

<span data-ttu-id="d5000-1316">Para usar os últimos cenários de roteamento no ASP.NET Core 2.1, especifique a [versão de compatibilidade](xref:mvc/compatibility-version) com o registro de serviços MVC em `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="d5000-1316">To use the latest routing scenarios in ASP.NET Core 2.1, specify the [compatibility version](xref:mvc/compatibility-version) to the MVC services registration in `Startup.ConfigureServices`:</span></span>

```csharp
services.AddMvc()
    .SetCompatibilityVersion(CompatibilityVersion.Version_2_1);
```

> [!IMPORTANT]
> <span data-ttu-id="d5000-1317">Este documento aborda o roteamento de nível inferior do ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="d5000-1317">This document covers low-level ASP.NET Core routing.</span></span> <span data-ttu-id="d5000-1318">Para obter informações sobre o roteamento do ASP.NET Core MVC, confira <xref:mvc/controllers/routing>.</span><span class="sxs-lookup"><span data-stu-id="d5000-1318">For information on ASP.NET Core MVC routing, see <xref:mvc/controllers/routing>.</span></span> <span data-ttu-id="d5000-1319">Para obter informações sobre convenções de roteamento no Razor Pages, confira <xref:razor-pages/razor-pages-conventions>.</span><span class="sxs-lookup"><span data-stu-id="d5000-1319">For information on routing conventions in Razor Pages, see <xref:razor-pages/razor-pages-conventions>.</span></span>

<span data-ttu-id="d5000-1320">[Exibir ou baixar código de exemplo](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/routing/samples) ([como baixar](xref:index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="d5000-1320">[View or download sample code](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/routing/samples) ([how to download](xref:index#how-to-download-a-sample))</span></span>

## <a name="routing-basics"></a><span data-ttu-id="d5000-1321">Conceitos básicos sobre roteamento</span><span class="sxs-lookup"><span data-stu-id="d5000-1321">Routing basics</span></span>

<span data-ttu-id="d5000-1322">A maioria dos aplicativos deve escolher um esquema de roteamento básico e descritivo para que as URLs sejam legíveis e significativas.</span><span class="sxs-lookup"><span data-stu-id="d5000-1322">Most apps should choose a basic and descriptive routing scheme so that URLs are readable and meaningful.</span></span> <span data-ttu-id="d5000-1323">A rota convencional padrão `{controller=Home}/{action=Index}/{id?}`:</span><span class="sxs-lookup"><span data-stu-id="d5000-1323">The default conventional route `{controller=Home}/{action=Index}/{id?}`:</span></span>

* <span data-ttu-id="d5000-1324">Dá suporte a um esquema de roteamento básico e descritivo.</span><span class="sxs-lookup"><span data-stu-id="d5000-1324">Supports a basic and descriptive routing scheme.</span></span>
* <span data-ttu-id="d5000-1325">É um ponto de partida útil para aplicativos baseados em interface do usuário.</span><span class="sxs-lookup"><span data-stu-id="d5000-1325">Is a useful starting point for UI-based apps.</span></span>

<span data-ttu-id="d5000-1326">Os desenvolvedores geralmente adicionam outras rotas concisas às áreas de alto tráfego de um aplicativo em situações especiais (por exemplo, pontos de extremidade de blog e comércio eletrônico) usando o [roteamento de atributo](xref:mvc/controllers/routing#attribute-routing) ou rotas convencionais dedicadas.</span><span class="sxs-lookup"><span data-stu-id="d5000-1326">Developers commonly add additional terse routes to high-traffic areas of an app in specialized situations (for example, blog and ecommerce endpoints) using [attribute routing](xref:mvc/controllers/routing#attribute-routing) or dedicated conventional routes.</span></span>

<span data-ttu-id="d5000-1327">As APIs da Web devem usar o roteamento de atributo para modelar a funcionalidade do aplicativo como um conjunto de recursos em que as operações são representadas por verbos HTTP.</span><span class="sxs-lookup"><span data-stu-id="d5000-1327">Web APIs should use attribute routing to model the app's functionality as a set of resources where operations are represented by HTTP verbs.</span></span> <span data-ttu-id="d5000-1328">Isso significa que muitas operações (por exemplo, GET, POST) no mesmo recurso lógico usarão a mesma URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-1328">This means that many operations (for example, GET, POST) on the same logical resource will use the same URL.</span></span> <span data-ttu-id="d5000-1329">O roteamento de atributo fornece um nível de controle necessário para projetar cuidadosamente o layout de ponto de extremidade público de uma API.</span><span class="sxs-lookup"><span data-stu-id="d5000-1329">Attribute routing provides a level of control that's needed to carefully design an API's public endpoint layout.</span></span>

<span data-ttu-id="d5000-1330">Os aplicativos do Razor Pages usam o roteamento convencional padrão para fornecer recursos nomeados na pasta *Pages* de um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d5000-1330">Razor Pages apps use default conventional routing to serve named resources in the *Pages* folder of an app.</span></span> <span data-ttu-id="d5000-1331">Estão disponíveis convenções adicionais que permitem a personalização do comportamento de roteamento do Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="d5000-1331">Additional conventions are available that allow you to customize Razor Pages routing behavior.</span></span> <span data-ttu-id="d5000-1332">Para obter mais informações, consulte <xref:razor-pages/index> e <xref:razor-pages/razor-pages-conventions>.</span><span class="sxs-lookup"><span data-stu-id="d5000-1332">For more information, see <xref:razor-pages/index> and <xref:razor-pages/razor-pages-conventions>.</span></span>

<span data-ttu-id="d5000-1333">O suporte à geração de URL permite que o aplicativo seja desenvolvido sem hard-coding das URLs para vincular o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d5000-1333">URL generation support allows the app to be developed without hard-coding URLs to link the app together.</span></span> <span data-ttu-id="d5000-1334">Esse suporte permite começar com uma configuração de roteamento básica e modificar as rotas, depois que o layout de recurso do aplicativo é determinado.</span><span class="sxs-lookup"><span data-stu-id="d5000-1334">This support allows for starting with a basic routing configuration and modifying the routes after the app's resource layout is determined.</span></span>

<span data-ttu-id="d5000-1335">O roteamento usa implementações <xref:Microsoft.AspNetCore.Routing.IRouter> de rotas do para:</span><span class="sxs-lookup"><span data-stu-id="d5000-1335">Routing uses routes implementations of <xref:Microsoft.AspNetCore.Routing.IRouter> to:</span></span>

* <span data-ttu-id="d5000-1336">Mapear solicitações de entrada para *manipuladores de rotas*.</span><span class="sxs-lookup"><span data-stu-id="d5000-1336">Map incoming requests to *route handlers*.</span></span>
* <span data-ttu-id="d5000-1337">Gerar as URLs usadas nas respostas.</span><span class="sxs-lookup"><span data-stu-id="d5000-1337">Generate the URLs used in responses.</span></span>

<span data-ttu-id="d5000-1338">Por padrão, um aplicativo tem uma única coleção de rotas.</span><span class="sxs-lookup"><span data-stu-id="d5000-1338">By default, an app has a single collection of routes.</span></span> <span data-ttu-id="d5000-1339">Quando uma solicitação é recebida, as rotas na coleção são processadas na ordem em que existem na coleção.</span><span class="sxs-lookup"><span data-stu-id="d5000-1339">When a request arrives, the routes in the collection are processed in the order that they exist in the collection.</span></span> <span data-ttu-id="d5000-1340">A estrutura tenta corresponder uma URL de solicitação de entrada a uma rota na coleção chamando o método <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> em cada rota da coleção.</span><span class="sxs-lookup"><span data-stu-id="d5000-1340">The framework attempts to match an incoming request URL to a route in the collection by calling the <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> method on each route in the collection.</span></span> <span data-ttu-id="d5000-1341">Uma resposta pode usar o roteamento para gerar URLs (por exemplo, para redirecionamento ou links) com base nas informações de rotas e evitar URLs embutidas em código, o que ajuda na facilidade de manutenção.</span><span class="sxs-lookup"><span data-stu-id="d5000-1341">A response can use routing to generate URLs (for example, for redirection or links) based on route information and thus avoid hard-coded URLs, which helps maintainability.</span></span>

<span data-ttu-id="d5000-1342">O sistema de roteamento tem as seguintes características:</span><span class="sxs-lookup"><span data-stu-id="d5000-1342">The routing system has the following characteristics:</span></span>

* <span data-ttu-id="d5000-1343">A sintaxe do modelo de rota é usada para definir rotas com os parâmetros de rota com tokens criados.</span><span class="sxs-lookup"><span data-stu-id="d5000-1343">Route template syntax is used to define routes with tokenized route parameters.</span></span>
* <span data-ttu-id="d5000-1344">A configuração de ponto de extremidade de estilo convencional e de estilo de atributo é permitida.</span><span class="sxs-lookup"><span data-stu-id="d5000-1344">Conventional-style and attribute-style endpoint configuration is permitted.</span></span>
* <span data-ttu-id="d5000-1345"><xref:Microsoft.AspNetCore.Routing.IRouteConstraint> é usado para determinar se um parâmetro de URL contém um valor válido para determinada restrição de ponto de extremidade.</span><span class="sxs-lookup"><span data-stu-id="d5000-1345"><xref:Microsoft.AspNetCore.Routing.IRouteConstraint> is used to determine whether a URL parameter contains a valid value for a given endpoint constraint.</span></span>
* <span data-ttu-id="d5000-1346">Modelos de aplicativo, como MVC/Razor Pages, registram todas as suas rotas, que têm uma implementação previsível de cenários de roteamento.</span><span class="sxs-lookup"><span data-stu-id="d5000-1346">App models, such as MVC/Razor Pages, register all of their routes, which have a predictable implementation of routing scenarios.</span></span>
* <span data-ttu-id="d5000-1347">Uma resposta pode usar o roteamento para gerar URLs (por exemplo, para redirecionamento ou links) com base nas informações de rotas e evitar URLs embutidas em código, o que ajuda na facilidade de manutenção.</span><span class="sxs-lookup"><span data-stu-id="d5000-1347">A response can use routing to generate URLs (for example, for redirection or links) based on route information and thus avoid hard-coded URLs, which helps maintainability.</span></span>
* <span data-ttu-id="d5000-1348">A geração de URL baseia-se em rotas, que dá suporte à extensibilidade arbitrária.</span><span class="sxs-lookup"><span data-stu-id="d5000-1348">URL generation is based on routes, which support arbitrary extensibility.</span></span> <span data-ttu-id="d5000-1349"><xref:Microsoft.AspNetCore.Mvc.IUrlHelper> oferece métodos para criar URLs.</span><span class="sxs-lookup"><span data-stu-id="d5000-1349"><xref:Microsoft.AspNetCore.Mvc.IUrlHelper> offers methods to build URLs.</span></span>
<!-- fix [middleware](xref:fundamentals/middleware/index) -->
<span data-ttu-id="d5000-1350">O roteamento está conectado ao pipeline do [middleware](xref:fundamentals/middleware/index) pela classe <xref:Microsoft.AspNetCore.Builder.RouterMiddleware>.</span><span class="sxs-lookup"><span data-stu-id="d5000-1350">Routing is connected to the [middleware](xref:fundamentals/middleware/index) pipeline by the <xref:Microsoft.AspNetCore.Builder.RouterMiddleware> class.</span></span> <span data-ttu-id="d5000-1351">O [ASP.NET Core MVC](xref:mvc/overview) adiciona o roteamento ao pipeline de middleware como parte de sua configuração e manipula o roteamento nos aplicativos do MVC e do Razor Pages.</span><span class="sxs-lookup"><span data-stu-id="d5000-1351">[ASP.NET Core MVC](xref:mvc/overview) adds routing to the middleware pipeline as part of its configuration and handles routing in MVC and Razor Pages apps.</span></span> <span data-ttu-id="d5000-1352">Para saber como usar o roteamento como um componente autônomo, confira a seção [Usar o Middleware de Roteamento](#use-routing-middleware).</span><span class="sxs-lookup"><span data-stu-id="d5000-1352">To learn how to use routing as a standalone component, see the [Use Routing Middleware](#use-routing-middleware) section.</span></span>

### <a name="url-matching"></a><span data-ttu-id="d5000-1353">Correspondência de URL</span><span class="sxs-lookup"><span data-stu-id="d5000-1353">URL matching</span></span>

<span data-ttu-id="d5000-1354">Correspondência de URL é o processo pelo qual o roteamento expede uma solicitação de entrada para um *manipulador*.</span><span class="sxs-lookup"><span data-stu-id="d5000-1354">URL matching is the process by which routing dispatches an incoming request to a *handler*.</span></span> <span data-ttu-id="d5000-1355">Esse processo se baseia nos dados do caminho da URL, mas pode ser estendido para considerar qualquer dado na solicitação.</span><span class="sxs-lookup"><span data-stu-id="d5000-1355">This process is based on data in the URL path but can be extended to consider any data in the request.</span></span> <span data-ttu-id="d5000-1356">A capacidade de expedir solicitações para manipuladores separados é fundamental para dimensionar o tamanho e a complexidade de um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d5000-1356">The ability to dispatch requests to separate handlers is key to scaling the size and complexity of an app.</span></span>

<span data-ttu-id="d5000-1357">As solicitações de entrada entram no <xref:Microsoft.AspNetCore.Builder.RouterMiddleware>, que chama o método <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> em cada rota na sequência.</span><span class="sxs-lookup"><span data-stu-id="d5000-1357">Incoming requests enter the <xref:Microsoft.AspNetCore.Builder.RouterMiddleware>, which calls the <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> method on each route in sequence.</span></span> <span data-ttu-id="d5000-1358">A instância <xref:Microsoft.AspNetCore.Routing.IRouter> escolhe se deseja *manipular* a solicitação definindo o [RouteContext.Handler](xref:Microsoft.AspNetCore.Routing.RouteContext.Handler*) como um <xref:Microsoft.AspNetCore.Http.RequestDelegate> não nulo.</span><span class="sxs-lookup"><span data-stu-id="d5000-1358">The <xref:Microsoft.AspNetCore.Routing.IRouter> instance chooses whether to *handle* the request by setting the [RouteContext.Handler](xref:Microsoft.AspNetCore.Routing.RouteContext.Handler*) to a non-null <xref:Microsoft.AspNetCore.Http.RequestDelegate>.</span></span> <span data-ttu-id="d5000-1359">Se uma rota definir um manipulador para a solicitação, o processamento de rotas será interrompido e o manipulador será invocado para processar a solicitação.</span><span class="sxs-lookup"><span data-stu-id="d5000-1359">If a route sets a handler for the request, route processing stops, and the handler is invoked to process the request.</span></span> <span data-ttu-id="d5000-1360">Se nenhum manipulador de rotas é encontrado para processar a solicitação, o middleware transmite a solicitação para o próximo middleware no pipeline de solicitação.</span><span class="sxs-lookup"><span data-stu-id="d5000-1360">If no route handler is found to process the request, the middleware hands the request off to the next middleware in the request pipeline.</span></span>

<span data-ttu-id="d5000-1361">A entrada primária para <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> é o [RouteContext.HttpContext](xref:Microsoft.AspNetCore.Routing.RouteContext.HttpContext*) associado à solicitação atual.</span><span class="sxs-lookup"><span data-stu-id="d5000-1361">The primary input to <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> is the [RouteContext.HttpContext](xref:Microsoft.AspNetCore.Routing.RouteContext.HttpContext*) associated with the current request.</span></span> <span data-ttu-id="d5000-1362">[RouteContext.Handler](xref:Microsoft.AspNetCore.Routing.RouteContext.Handler) e [RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData*) são saídas definidas depois que é encontrada uma correspondência de uma rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-1362">The [RouteContext.Handler](xref:Microsoft.AspNetCore.Routing.RouteContext.Handler) and [RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData*) are outputs set after a route is matched.</span></span>

<span data-ttu-id="d5000-1363">Uma correspondência que chama <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> também define as propriedades do [RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData) com valores apropriados com base no processamento da solicitação executado até o momento.</span><span class="sxs-lookup"><span data-stu-id="d5000-1363">A match that calls <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> also sets the properties of the [RouteContext.RouteData](xref:Microsoft.AspNetCore.Routing.RouteContext.RouteData) to appropriate values based on the request processing performed thus far.</span></span>

<span data-ttu-id="d5000-1364">[RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values*) é um dicionário de *valores de rota* produzido por meio da rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-1364">[RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values*) is a dictionary of *route values* produced from the route.</span></span> <span data-ttu-id="d5000-1365">Esses valores geralmente são determinados pela criação de token da URL e podem ser usados para aceitar a entrada do usuário ou tomar outras decisões de expedição dentro do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d5000-1365">These values are usually determined by tokenizing the URL and can be used to accept user input or to make further dispatching decisions inside the app.</span></span>

<span data-ttu-id="d5000-1366">[RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) é um recipiente de propriedades de dados adicionais relacionados à rota correspondente.</span><span class="sxs-lookup"><span data-stu-id="d5000-1366">[RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) is a property bag of additional data related to the matched route.</span></span> <span data-ttu-id="d5000-1367"><xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*> são fornecidos para dar suporte à associação de dados de estado com cada rota para que o aplicativo possa tomar decisões com base em qual rota teve uma correspondência.</span><span class="sxs-lookup"><span data-stu-id="d5000-1367"><xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*> are provided to support associating state data with each route so that the app can make decisions based on which route matched.</span></span> <span data-ttu-id="d5000-1368">Esses valores são definidos pelo desenvolvedor e **não** afetam de forma alguma o comportamento do roteamento.</span><span class="sxs-lookup"><span data-stu-id="d5000-1368">These values are developer-defined and do **not** affect the behavior of routing in any way.</span></span> <span data-ttu-id="d5000-1369">Além disso, os valores em stash em [RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) podem ser de qualquer tipo, ao contrário de [RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values), que devem ser conversíveis de/para cadeias de caracteres.</span><span class="sxs-lookup"><span data-stu-id="d5000-1369">Additionally, values stashed in [RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*) can be of any type, in contrast to [RouteData.Values](xref:Microsoft.AspNetCore.Routing.RouteData.Values), which must be convertible to and from strings.</span></span>

<span data-ttu-id="d5000-1370">[RouteData.Routers](xref:Microsoft.AspNetCore.Routing.RouteData.Routers) é uma lista das rotas que participaram da correspondência bem-sucedida da solicitação.</span><span class="sxs-lookup"><span data-stu-id="d5000-1370">[RouteData.Routers](xref:Microsoft.AspNetCore.Routing.RouteData.Routers) is a list of the routes that took part in successfully matching the request.</span></span> <span data-ttu-id="d5000-1371">As rotas podem ser aninhadas uma dentro da outra.</span><span class="sxs-lookup"><span data-stu-id="d5000-1371">Routes can be nested inside of one another.</span></span> <span data-ttu-id="d5000-1372">A propriedade <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> reflete o caminho pela árvore lógica de rotas que resultou em uma correspondência.</span><span class="sxs-lookup"><span data-stu-id="d5000-1372">The <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> property reflects the path through the logical tree of routes that resulted in a match.</span></span> <span data-ttu-id="d5000-1373">Em geral, o primeiro item em <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> é a coleção de rotas e deve ser usado para a geração de URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-1373">Generally, the first item in <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> is the route collection and should be used for URL generation.</span></span> <span data-ttu-id="d5000-1374">O último item em <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> é o manipulador de rotas que teve uma correspondência.</span><span class="sxs-lookup"><span data-stu-id="d5000-1374">The last item in <xref:Microsoft.AspNetCore.Routing.RouteData.Routers> is the route handler that matched.</span></span>

<a name="lg"></a>

### <a name="url-generation"></a><span data-ttu-id="d5000-1375">Geração de URL</span><span class="sxs-lookup"><span data-stu-id="d5000-1375">URL generation</span></span>

<span data-ttu-id="d5000-1376">Geração de URL é o processo pelo qual o roteamento pode criar um caminho de URL de acordo com um conjunto de valores de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-1376">URL generation is the process by which routing can create a URL path based on a set of route values.</span></span> <span data-ttu-id="d5000-1377">Isso permite uma separação lógica entre os manipuladores de rotas e as URLs que os acessam.</span><span class="sxs-lookup"><span data-stu-id="d5000-1377">This allows for a logical separation between route handlers and the URLs that access them.</span></span>

<span data-ttu-id="d5000-1378">A geração de URL segue um processo iterativo semelhante, mas começa com o código da estrutura ou do usuário chamando o método <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> da coleção de rotas.</span><span class="sxs-lookup"><span data-stu-id="d5000-1378">URL generation follows a similar iterative process, but it starts with user or framework code calling into the <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> method of the route collection.</span></span> <span data-ttu-id="d5000-1379">Cada *rota* tem seu método <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> chamado em sequência, até que um <xref:Microsoft.AspNetCore.Routing.VirtualPathData> não nulo seja retornado.</span><span class="sxs-lookup"><span data-stu-id="d5000-1379">Each *route* has its <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> method called in sequence until a non-null <xref:Microsoft.AspNetCore.Routing.VirtualPathData> is returned.</span></span>

<span data-ttu-id="d5000-1380">As entradas primárias para <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> são:</span><span class="sxs-lookup"><span data-stu-id="d5000-1380">The primary inputs to <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> are:</span></span>

* [<span data-ttu-id="d5000-1381">VirtualPathContext.HttpContext</span><span class="sxs-lookup"><span data-stu-id="d5000-1381">VirtualPathContext.HttpContext</span></span>](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.HttpContext)
* [<span data-ttu-id="d5000-1382">VirtualPathContext.Values</span><span class="sxs-lookup"><span data-stu-id="d5000-1382">VirtualPathContext.Values</span></span>](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values)
* [<span data-ttu-id="d5000-1383">VirtualPathContext.AmbientValues</span><span class="sxs-lookup"><span data-stu-id="d5000-1383">VirtualPathContext.AmbientValues</span></span>](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues)

<span data-ttu-id="d5000-1384">As rotas usam principalmente os valores de rota fornecidos por <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values> e <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues> para decidir se é possível gerar uma URL e quais valores serão incluídos.</span><span class="sxs-lookup"><span data-stu-id="d5000-1384">Routes primarily use the route values provided by <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values> and <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues> to decide whether it's possible to generate a URL and what values to include.</span></span> <span data-ttu-id="d5000-1385">Os <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues> são o conjunto de valores de rota produzidos pela correspondência da solicitação atual.</span><span class="sxs-lookup"><span data-stu-id="d5000-1385">The <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues> are the set of route values that were produced from matching the current request.</span></span> <span data-ttu-id="d5000-1386">Por outro lado, <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values> são os valores de rota que especificam como gerar a URL desejada para a operação atual.</span><span class="sxs-lookup"><span data-stu-id="d5000-1386">In contrast, <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values> are the route values that specify how to generate the desired URL for the current operation.</span></span> <span data-ttu-id="d5000-1387">O <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.HttpContext> é fornecido para o caso de uma rota precisar obter serviços ou dados adicionais associados ao contexto atual.</span><span class="sxs-lookup"><span data-stu-id="d5000-1387">The <xref:Microsoft.AspNetCore.Routing.VirtualPathContext.HttpContext> is provided in case a route should obtain services or additional data associated with the current context.</span></span>

> [!TIP]
> <span data-ttu-id="d5000-1388">Considere [VirtualPathContext.Values](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values*) como um conjunto de substituições de [VirtualPathContext.AmbientValues](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues*).</span><span class="sxs-lookup"><span data-stu-id="d5000-1388">Think of [VirtualPathContext.Values](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.Values*) as a set of overrides for the [VirtualPathContext.AmbientValues](xref:Microsoft.AspNetCore.Routing.VirtualPathContext.AmbientValues*).</span></span> <span data-ttu-id="d5000-1389">A geração de URL tenta reutilizar os valores de rota da solicitação atual para gerar URLs para links usando a mesma rota ou os mesmos valores de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-1389">URL generation attempts to reuse route values from the current request to generate URLs for links using the same route or route values.</span></span>

<span data-ttu-id="d5000-1390">A saída de <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> é um <xref:Microsoft.AspNetCore.Routing.VirtualPathData>.</span><span class="sxs-lookup"><span data-stu-id="d5000-1390">The output of <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> is a <xref:Microsoft.AspNetCore.Routing.VirtualPathData>.</span></span> <span data-ttu-id="d5000-1391"><xref:Microsoft.AspNetCore.Routing.VirtualPathData> é um paralelo de <xref:Microsoft.AspNetCore.Routing.RouteData>.</span><span class="sxs-lookup"><span data-stu-id="d5000-1391"><xref:Microsoft.AspNetCore.Routing.VirtualPathData> is a parallel of <xref:Microsoft.AspNetCore.Routing.RouteData>.</span></span> <span data-ttu-id="d5000-1392"><xref:Microsoft.AspNetCore.Routing.VirtualPathData> contém o <xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath> da URL de saída e algumas propriedades adicionais que devem ser definidas pela rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-1392"><xref:Microsoft.AspNetCore.Routing.VirtualPathData> contains the <xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath> for the output URL and some additional properties that should be set by the route.</span></span>

<span data-ttu-id="d5000-1393">A propriedade [VirtualPathData.VirtualPath](xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath*) contém o *caminho virtual* produzido pela rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-1393">The [VirtualPathData.VirtualPath](xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath*) property contains the *virtual path* produced by the route.</span></span> <span data-ttu-id="d5000-1394">Dependendo das suas necessidades, talvez você precise processar ainda mais o caminho.</span><span class="sxs-lookup"><span data-stu-id="d5000-1394">Depending on your needs, you may need to process the path further.</span></span> <span data-ttu-id="d5000-1395">Se você desejar renderizar a URL gerada em HTML, preceda o caminho base do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d5000-1395">If you want to render the generated URL in HTML, prepend the base path of the app.</span></span>

<span data-ttu-id="d5000-1396">O [VirtualPathData.Router](xref:Microsoft.AspNetCore.Routing.VirtualPathData.Router*) é uma referência à rota que gerou a URL com êxito.</span><span class="sxs-lookup"><span data-stu-id="d5000-1396">The [VirtualPathData.Router](xref:Microsoft.AspNetCore.Routing.VirtualPathData.Router*) is a reference to the route that successfully generated the URL.</span></span>

<span data-ttu-id="d5000-1397">As propriedades de [VirtualPathData.DataTokens](xref:Microsoft.AspNetCore.Routing.VirtualPathData.DataTokens*) são um dicionário de dados adicionais relacionados à rota que gerou a URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-1397">The [VirtualPathData.DataTokens](xref:Microsoft.AspNetCore.Routing.VirtualPathData.DataTokens*) properties is a dictionary of additional data related to the route that generated the URL.</span></span> <span data-ttu-id="d5000-1398">Isso é o paralelo de [RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*).</span><span class="sxs-lookup"><span data-stu-id="d5000-1398">This is the parallel of [RouteData.DataTokens](xref:Microsoft.AspNetCore.Routing.RouteData.DataTokens*).</span></span>

### <a name="create-routes"></a><span data-ttu-id="d5000-1399">Criar rotas</span><span class="sxs-lookup"><span data-stu-id="d5000-1399">Create routes</span></span>

<span data-ttu-id="d5000-1400">O roteamento fornece a classe <xref:Microsoft.AspNetCore.Routing.Route> como a implementação padrão de <xref:Microsoft.AspNetCore.Routing.IRouter>.</span><span class="sxs-lookup"><span data-stu-id="d5000-1400">Routing provides the <xref:Microsoft.AspNetCore.Routing.Route> class as the standard implementation of <xref:Microsoft.AspNetCore.Routing.IRouter>.</span></span> <span data-ttu-id="d5000-1401"><xref:Microsoft.AspNetCore.Routing.Route> usa a sintaxe de *modelo de rota* para definir padrões que corresponderão ao caminho da URL quando <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> for chamado.</span><span class="sxs-lookup"><span data-stu-id="d5000-1401"><xref:Microsoft.AspNetCore.Routing.Route> uses the *route template* syntax to define patterns to match against the URL path when <xref:Microsoft.AspNetCore.Routing.IRouter.RouteAsync*> is called.</span></span> <span data-ttu-id="d5000-1402"><xref:Microsoft.AspNetCore.Routing.Route> usa o mesmo modelo de rota para gerar uma URL quando <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> é chamado.</span><span class="sxs-lookup"><span data-stu-id="d5000-1402"><xref:Microsoft.AspNetCore.Routing.Route> uses the same route template to generate a URL when <xref:Microsoft.AspNetCore.Routing.IRouter.GetVirtualPath*> is called.</span></span>

<span data-ttu-id="d5000-1403">A maioria dos aplicativos cria rotas chamando <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> ou um dos métodos de extensão semelhantes definidos em <xref:Microsoft.AspNetCore.Routing.IRouteBuilder>.</span><span class="sxs-lookup"><span data-stu-id="d5000-1403">Most apps create routes by calling <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> or one of the similar extension methods defined on <xref:Microsoft.AspNetCore.Routing.IRouteBuilder>.</span></span> <span data-ttu-id="d5000-1404">Qualquer um dos métodos de extensão de <xref:Microsoft.AspNetCore.Routing.IRouteBuilder> cria uma instância de <xref:Microsoft.AspNetCore.Routing.Route> e a adicionam à coleção de rotas.</span><span class="sxs-lookup"><span data-stu-id="d5000-1404">Any of the <xref:Microsoft.AspNetCore.Routing.IRouteBuilder> extension methods create an instance of <xref:Microsoft.AspNetCore.Routing.Route> and add it to the route collection.</span></span>

<span data-ttu-id="d5000-1405"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> não aceita um parâmetro de manipulador de rotas.</span><span class="sxs-lookup"><span data-stu-id="d5000-1405"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> doesn't accept a route handler parameter.</span></span> <span data-ttu-id="d5000-1406"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> apenas adiciona rotas que são manipuladas pelo <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*>.</span><span class="sxs-lookup"><span data-stu-id="d5000-1406"><xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> only adds routes that are handled by the <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*>.</span></span> <span data-ttu-id="d5000-1407">O manipulador padrão é um `IRouter`, e o manipulador não pode manipular a solicitação.</span><span class="sxs-lookup"><span data-stu-id="d5000-1407">The default handler is an `IRouter`, and the handler might not handle the request.</span></span> <span data-ttu-id="d5000-1408">Por exemplo, o ASP.NET Core MVC normalmente é configurado como um manipulador padrão que só manipula as solicitações que correspondem a um controlador e a uma ação disponíveis.</span><span class="sxs-lookup"><span data-stu-id="d5000-1408">For example, ASP.NET Core MVC is typically configured as a default handler that only handles requests that match an available controller and action.</span></span> <span data-ttu-id="d5000-1409">Para saber mais sobre o roteamento no MVC, confira <xref:mvc/controllers/routing>.</span><span class="sxs-lookup"><span data-stu-id="d5000-1409">To learn more about routing in MVC, see <xref:mvc/controllers/routing>.</span></span>

<span data-ttu-id="d5000-1410">O exemplo de código a seguir é um exemplo de uma chamada <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> usada por uma definição de rota típica do ASP.NET Core MVC:</span><span class="sxs-lookup"><span data-stu-id="d5000-1410">The following code example is an example of a <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> call used by a typical ASP.NET Core MVC route definition:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id?}");
```

<span data-ttu-id="d5000-1411">Esse modelo corresponde a um caminho de URL e extrai os valores de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-1411">This template matches a URL path and extracts the route values.</span></span> <span data-ttu-id="d5000-1412">Por exemplo, o caminho `/Products/Details/17` gera os seguintes valores de rota: `{ controller = Products, action = Details, id = 17 }`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1412">For example, the path `/Products/Details/17` generates the following route values: `{ controller = Products, action = Details, id = 17 }`.</span></span>

<span data-ttu-id="d5000-1413">Os valores de rota são determinados pela divisão do caminho da URL em segmentos e pela correspondência de cada segmento com o nome do *parâmetro de rota* no modelo de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-1413">Route values are determined by splitting the URL path into segments and matching each segment with the *route parameter* name in the route template.</span></span> <span data-ttu-id="d5000-1414">Os parâmetros de rota são nomeados.</span><span class="sxs-lookup"><span data-stu-id="d5000-1414">Route parameters are named.</span></span> <span data-ttu-id="d5000-1415">Os parâmetros são definidos com a colocação do nome do parâmetro em chaves `{ ... }`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1415">The parameters defined by enclosing the parameter name in braces `{ ... }`.</span></span>

<span data-ttu-id="d5000-1416">O modelo anterior também pode corresponder ao caminho da URL `/` e produzir os valores `{ controller = Home, action = Index }`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1416">The preceding template could also match the URL path `/` and produce the values `{ controller = Home, action = Index }`.</span></span> <span data-ttu-id="d5000-1417">Isso ocorre porque os parâmetros de rota `{controller}` e `{action}` têm valores padrão e o parâmetro de rota `id` é opcional.</span><span class="sxs-lookup"><span data-stu-id="d5000-1417">This occurs because the `{controller}` and `{action}` route parameters have default values and the `id` route parameter is optional.</span></span> <span data-ttu-id="d5000-1418">Um sinal de igual (`=`) seguido de um valor após o nome do parâmetro de rota define um valor padrão para o parâmetro.</span><span class="sxs-lookup"><span data-stu-id="d5000-1418">An equals sign (`=`) followed by a value after the route parameter name defines a default value for the parameter.</span></span> <span data-ttu-id="d5000-1419">Um ponto de interrogação (`?`) após o nome do parâmetro de rota define o parâmetro como opcional.</span><span class="sxs-lookup"><span data-stu-id="d5000-1419">A question mark (`?`) after the route parameter name defines an optional parameter.</span></span>

<span data-ttu-id="d5000-1420">Os parâmetros de rota com um valor padrão *sempre* produzem um valor de rota quando a rota corresponde.</span><span class="sxs-lookup"><span data-stu-id="d5000-1420">Route parameters with a default value *always* produce a route value when the route matches.</span></span> <span data-ttu-id="d5000-1421">Os parâmetros opcionais não produzem um valor de rota se não houver nenhum segmento de caminho de URL correspondente.</span><span class="sxs-lookup"><span data-stu-id="d5000-1421">Optional parameters don't produce a route value if there is no corresponding URL path segment.</span></span> <span data-ttu-id="d5000-1422">Confira a seção [Referência de modelo de rota](#route-template-reference) para obter uma descrição completa dos recursos e da sintaxe de modelo de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-1422">See the [Route template reference](#route-template-reference) section for a thorough description of route template scenarios and syntax.</span></span>

<span data-ttu-id="d5000-1423">No seguinte exemplo, a definição do parâmetro de rota `{id:int}` define uma [restrição de rota](#route-constraint-reference) para o parâmetro de rota `id`:</span><span class="sxs-lookup"><span data-stu-id="d5000-1423">In the following example, the route parameter definition `{id:int}` defines a [route constraint](#route-constraint-reference) for the `id` route parameter:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id:int}");
```

<span data-ttu-id="d5000-1424">Esse modelo corresponde a um caminho de URL, como `/Products/Details/17`, mas não como `/Products/Details/Apples`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1424">This template matches a URL path like `/Products/Details/17` but not `/Products/Details/Apples`.</span></span> <span data-ttu-id="d5000-1425">As restrições de rota implementam <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> e inspecionam valores de rota para verificá-los.</span><span class="sxs-lookup"><span data-stu-id="d5000-1425">Route constraints implement <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> and inspect route values to verify them.</span></span> <span data-ttu-id="d5000-1426">Neste exemplo, o valor de rota `id` precisa ser conversível em um inteiro.</span><span class="sxs-lookup"><span data-stu-id="d5000-1426">In this example, the route value `id` must be convertible to an integer.</span></span> <span data-ttu-id="d5000-1427">Confira [route-constraint-reference](#route-constraint-reference) para obter uma explicação das restrições de rota fornecidas pela estrutura.</span><span class="sxs-lookup"><span data-stu-id="d5000-1427">See [route-constraint-reference](#route-constraint-reference) for an explanation of route constraints provided by the framework.</span></span>

<span data-ttu-id="d5000-1428">Sobrecargas adicionais de <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> aceitam valores para `constraints`, `dataTokens` e `defaults`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1428">Additional overloads of <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> accept values for `constraints`, `dataTokens`, and `defaults`.</span></span> <span data-ttu-id="d5000-1429">O uso típico desses parâmetros é passar um objeto de tipo anônimo, no qual os nomes da propriedade do tipo anônimo correspondem aos nomes do parâmetro de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-1429">The typical usage of these parameters is to pass an anonymously typed object, where the property names of the anonymous type match route parameter names.</span></span>

<span data-ttu-id="d5000-1430">Os seguintes exemplos de <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> criam rotas equivalentes:</span><span class="sxs-lookup"><span data-stu-id="d5000-1430">The following <xref:Microsoft.AspNetCore.Builder.MapRouteRouteBuilderExtensions.MapRoute*> examples create equivalent routes:</span></span>

```csharp
routes.MapRoute(
    name: "default_route",
    template: "{controller}/{action}/{id?}",
    defaults: new { controller = "Home", action = "Index" });

routes.MapRoute(
    name: "default_route",
    template: "{controller=Home}/{action=Index}/{id?}");
```

> [!TIP]
> <span data-ttu-id="d5000-1431">A sintaxe embutida para a definição de restrições e padrões pode ser interessante para rotas simples.</span><span class="sxs-lookup"><span data-stu-id="d5000-1431">The inline syntax for defining constraints and defaults can be convenient for simple routes.</span></span> <span data-ttu-id="d5000-1432">No entanto, há cenários, como tokens de dados, que não dão suporte à sintaxe embutida.</span><span class="sxs-lookup"><span data-stu-id="d5000-1432">However, there are scenarios, such as data tokens, that aren't supported by inline syntax.</span></span>

<span data-ttu-id="d5000-1433">O seguinte exemplo demonstra mais alguns cenários:</span><span class="sxs-lookup"><span data-stu-id="d5000-1433">The following example demonstrates a few additional scenarios:</span></span>

```csharp
routes.MapRoute(
    name: "blog",
    template: "Blog/{*article}",
    defaults: new { controller = "Blog", action = "ReadArticle" });
```

<span data-ttu-id="d5000-1434">O modelo anterior corresponde a um caminho de URL, como `/Blog/All-About-Routing/Introduction`, e extrai os valores `{ controller = Blog, action = ReadArticle, article = All-About-Routing/Introduction }`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1434">The preceding template matches a URL path like `/Blog/All-About-Routing/Introduction` and extracts the values `{ controller = Blog, action = ReadArticle, article = All-About-Routing/Introduction }`.</span></span> <span data-ttu-id="d5000-1435">Os valores de rota padrão para `controller` e `action` são produzidos pela rota, mesmo que não haja nenhum parâmetro de rota correspondente no modelo.</span><span class="sxs-lookup"><span data-stu-id="d5000-1435">The default route values for `controller` and `action` are produced by the route even though there are no corresponding route parameters in the template.</span></span> <span data-ttu-id="d5000-1436">Os valores padrão podem ser especificados no modelo de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-1436">Default values can be specified in the route template.</span></span> <span data-ttu-id="d5000-1437">O parâmetro de rota `article` é definido como um *catch-all* pela aparência de um asterisco (`*`) antes do nome do parâmetro de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-1437">The `article` route parameter is defined as a *catch-all* by the appearance of an asterisk (`*`) before the route parameter name.</span></span> <span data-ttu-id="d5000-1438">Os parâmetros de rota catch-all capturam o restante do caminho de URL e também podem corresponder à cadeia de caracteres vazia.</span><span class="sxs-lookup"><span data-stu-id="d5000-1438">Catch-all route parameters capture the remainder of the URL path and can also match the empty string.</span></span>

<span data-ttu-id="d5000-1439">O seguinte exemplo adiciona restrições de rota e tokens de dados:</span><span class="sxs-lookup"><span data-stu-id="d5000-1439">The following example adds route constraints and data tokens:</span></span>

```csharp
routes.MapRoute(
    name: "us_english_products",
    template: "en-US/Products/{id}",
    defaults: new { controller = "Products", action = "Details" },
    constraints: new { id = new IntRouteConstraint() },
    dataTokens: new { locale = "en-US" });
```

<span data-ttu-id="d5000-1440">O modelo anterior corresponde a um caminho de URL como `/en-US/Products/5` e extrai os valores de `{ controller = Products, action = Details, id = 5 }` e os tokens de dados `{ locale = en-US }`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1440">The preceding template matches a URL path like `/en-US/Products/5` and extracts the values `{ controller = Products, action = Details, id = 5 }` and the data tokens `{ locale = en-US }`.</span></span>

![Tokens locais do Windows](routing/_static/tokens.png)

### <a name="route-class-url-generation"></a><span data-ttu-id="d5000-1442">Geração de URL da classe de rota</span><span class="sxs-lookup"><span data-stu-id="d5000-1442">Route class URL generation</span></span>

<span data-ttu-id="d5000-1443">A classe <xref:Microsoft.AspNetCore.Routing.Route> também pode executar a geração de URL pela combinação de um conjunto de valores de rota com seu modelo de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-1443">The <xref:Microsoft.AspNetCore.Routing.Route> class can also perform URL generation by combining a set of route values with its route template.</span></span> <span data-ttu-id="d5000-1444">Logicamente, este é o processo inverso de correspondência do caminho de URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-1444">This is logically the reverse process of matching the URL path.</span></span>

> [!TIP]
> <span data-ttu-id="d5000-1445">Para entender melhor a geração de URL, imagine qual URL você deseja gerar e, em seguida, pense em como um modelo de rota corresponderia a essa URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-1445">To better understand URL generation, imagine what URL you want to generate and then think about how a route template would match that URL.</span></span> <span data-ttu-id="d5000-1446">Quais valores serão produzidos?</span><span class="sxs-lookup"><span data-stu-id="d5000-1446">What values would be produced?</span></span> <span data-ttu-id="d5000-1447">Este é o equivalente aproximado de como funciona a geração de URL na classe <xref:Microsoft.AspNetCore.Routing.Route>.</span><span class="sxs-lookup"><span data-stu-id="d5000-1447">This is the rough equivalent of how URL generation works in the <xref:Microsoft.AspNetCore.Routing.Route> class.</span></span>

<span data-ttu-id="d5000-1448">O seguinte exemplo usa uma rota padrão geral do ASP.NET Core MVC:</span><span class="sxs-lookup"><span data-stu-id="d5000-1448">The following example uses a general ASP.NET Core MVC default route:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id?}");
```

<span data-ttu-id="d5000-1449">Com os valores de rota `{ controller = Products, action = List }`, a URL `/Products/List` é gerada.</span><span class="sxs-lookup"><span data-stu-id="d5000-1449">With the route values `{ controller = Products, action = List }`, the URL `/Products/List` is generated.</span></span> <span data-ttu-id="d5000-1450">Os valores de rota são substituídos pelos parâmetros de rota correspondentes para formar o caminho de URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-1450">The route values are substituted for the corresponding route parameters to form the URL path.</span></span> <span data-ttu-id="d5000-1451">Como `id` é um parâmetro de rota opcional, a URL é gerada com êxito sem um valor para `id`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1451">Since `id` is an optional route parameter, the URL is successfully generated without a value for `id`.</span></span>

<span data-ttu-id="d5000-1452">Com os valores de rota `{ controller = Home, action = Index }`, a URL `/` é gerada.</span><span class="sxs-lookup"><span data-stu-id="d5000-1452">With the route values `{ controller = Home, action = Index }`, the URL `/` is generated.</span></span> <span data-ttu-id="d5000-1453">Os valores de rota fornecidos correspondem aos valores padrão, sendo que os segmentos correspondentes aos valores padrão são omitidos com segurança.</span><span class="sxs-lookup"><span data-stu-id="d5000-1453">The provided route values match the default values, and the segments corresponding to the default values are safely omitted.</span></span>

<span data-ttu-id="d5000-1454">A viagem de ida e volta gerada pelas duas URLs com a definição de rota a seguir (`/Home/Index` e `/`) produz os mesmos valores de rota que foram usados para gerar a URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-1454">Both URLs generated round-trip with the following route definition (`/Home/Index` and `/`) produce the same route values that were used to generate the URL.</span></span>

> [!NOTE]
> <span data-ttu-id="d5000-1455">Um aplicativo que usa o ASP.NET Core MVC deve usar <xref:Microsoft.AspNetCore.Mvc.Routing.UrlHelper> para gerar URLs, em vez de chamar o roteamento diretamente.</span><span class="sxs-lookup"><span data-stu-id="d5000-1455">An app using ASP.NET Core MVC should use <xref:Microsoft.AspNetCore.Mvc.Routing.UrlHelper> to generate URLs instead of calling into routing directly.</span></span>

<span data-ttu-id="d5000-1456">Para obter mais informações sobre a geração de URL, confira a seção [Referência de geração de URL](#url-generation-reference).</span><span class="sxs-lookup"><span data-stu-id="d5000-1456">For more information on URL generation, see the [Url generation reference](#url-generation-reference) section.</span></span>

## <a name="use-routing-middleware"></a><span data-ttu-id="d5000-1457">Usar middleware de roteamento</span><span class="sxs-lookup"><span data-stu-id="d5000-1457">Use routing middleware</span></span>

<span data-ttu-id="d5000-1458">Referencie o [metapacote Microsoft.AspNetCore.App](xref:fundamentals/metapackage-app) no arquivo de projeto do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d5000-1458">Reference the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app) in the app's project file.</span></span>

<span data-ttu-id="d5000-1459">Adicione o roteamento ao contêiner de serviço em `Startup.ConfigureServices`:</span><span class="sxs-lookup"><span data-stu-id="d5000-1459">Add routing to the service container in `Startup.ConfigureServices`:</span></span>

[!code-csharp[](routing/samples/2.x/RoutingSample/Startup.cs?name=snippet_ConfigureServices&highlight=3)]

<span data-ttu-id="d5000-1460">As rotas precisam ser configuradas no método `Startup.Configure`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1460">Routes must be configured in the `Startup.Configure` method.</span></span> <span data-ttu-id="d5000-1461">O aplicativo de exemplo usa as seguintes APIs:</span><span class="sxs-lookup"><span data-stu-id="d5000-1461">The sample app uses the following APIs:</span></span>

* <xref:Microsoft.AspNetCore.Routing.RouteBuilder>
* <span data-ttu-id="d5000-1462"><xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*>&ndash; Corresponde apenas a solicitações HTTP Get.</span><span class="sxs-lookup"><span data-stu-id="d5000-1462"><xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*> &ndash; Matches only HTTP GET requests.</span></span>
* <xref:Microsoft.AspNetCore.Builder.RoutingBuilderExtensions.UseRouter*>

[!code-csharp[](routing/samples/2.x/RoutingSample/Startup.cs?name=snippet_RouteHandler)]

<span data-ttu-id="d5000-1463">A tabela a seguir mostra as respostas com os URIs fornecidos.</span><span class="sxs-lookup"><span data-stu-id="d5000-1463">The following table shows the responses with the given URIs.</span></span>

| <span data-ttu-id="d5000-1464">URI</span><span class="sxs-lookup"><span data-stu-id="d5000-1464">URI</span></span>                    | <span data-ttu-id="d5000-1465">Resposta</span><span class="sxs-lookup"><span data-stu-id="d5000-1465">Response</span></span>                                          |
| ---------------------- | ------------------------------------------------- |
| `/package/create/3`    | <span data-ttu-id="d5000-1466">Olá!</span><span class="sxs-lookup"><span data-stu-id="d5000-1466">Hello!</span></span> <span data-ttu-id="d5000-1467">Valores de rota: [operation, create], [id, 3]</span><span class="sxs-lookup"><span data-stu-id="d5000-1467">Route values: [operation, create], [id, 3]</span></span> |
| `/package/track/-3`    | <span data-ttu-id="d5000-1468">Olá!</span><span class="sxs-lookup"><span data-stu-id="d5000-1468">Hello!</span></span> <span data-ttu-id="d5000-1469">Valores de rota: [operation, track], [id, -3]</span><span class="sxs-lookup"><span data-stu-id="d5000-1469">Route values: [operation, track], [id, -3]</span></span> |
| `/package/track/-3/`   | <span data-ttu-id="d5000-1470">Olá!</span><span class="sxs-lookup"><span data-stu-id="d5000-1470">Hello!</span></span> <span data-ttu-id="d5000-1471">Valores de rota: [operation, track], [id, -3]</span><span class="sxs-lookup"><span data-stu-id="d5000-1471">Route values: [operation, track], [id, -3]</span></span> |
| `/package/track/`      | <span data-ttu-id="d5000-1472">A solicitação é ignorada; sem correspondência.</span><span class="sxs-lookup"><span data-stu-id="d5000-1472">The request falls through, no match.</span></span>              |
| `GET /hello/Joe`       | <span data-ttu-id="d5000-1473">Olá, Joe!</span><span class="sxs-lookup"><span data-stu-id="d5000-1473">Hi, Joe!</span></span>                                          |
| `POST /hello/Joe`      | <span data-ttu-id="d5000-1474">A solicitação é ignorada; corresponde apenas a HTTP GET.</span><span class="sxs-lookup"><span data-stu-id="d5000-1474">The request falls through, matches HTTP GET only.</span></span> |
| `GET /hello/Joe/Smith` | <span data-ttu-id="d5000-1475">A solicitação é ignorada; sem correspondência.</span><span class="sxs-lookup"><span data-stu-id="d5000-1475">The request falls through, no match.</span></span>              |

<span data-ttu-id="d5000-1476">Se você estiver configurando uma única rota, chame <xref:Microsoft.AspNetCore.Builder.RoutingBuilderExtensions.UseRouter*> passando uma instância de `IRouter`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1476">If you're configuring a single route, call <xref:Microsoft.AspNetCore.Builder.RoutingBuilderExtensions.UseRouter*> passing in an `IRouter` instance.</span></span> <span data-ttu-id="d5000-1477">Você não precisa usar <xref:Microsoft.AspNetCore.Routing.RouteBuilder>.</span><span class="sxs-lookup"><span data-stu-id="d5000-1477">You won't need to use <xref:Microsoft.AspNetCore.Routing.RouteBuilder>.</span></span>

<span data-ttu-id="d5000-1478">A estrutura fornece um conjunto de métodos de extensão para a criação de rotas (<xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions>):</span><span class="sxs-lookup"><span data-stu-id="d5000-1478">The framework provides a set of extension methods for creating routes (<xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions>):</span></span>

* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapDelete*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareDelete*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareGet*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewarePost*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewarePut*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareRoute*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapMiddlewareVerb*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapPost*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapPut*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapRoute*>
* <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapVerb*>

<span data-ttu-id="d5000-1479">Alguns dos métodos listados, como <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*>, exigem um <xref:Microsoft.AspNetCore.Http.RequestDelegate>.</span><span class="sxs-lookup"><span data-stu-id="d5000-1479">Some of listed methods, such as <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*>, require a <xref:Microsoft.AspNetCore.Http.RequestDelegate>.</span></span> <span data-ttu-id="d5000-1480">O <xref:Microsoft.AspNetCore.Http.RequestDelegate> é usado como o *manipulador de rotas* quando a rota corresponde.</span><span class="sxs-lookup"><span data-stu-id="d5000-1480">The <xref:Microsoft.AspNetCore.Http.RequestDelegate> is used as the *route handler* when the route matches.</span></span> <span data-ttu-id="d5000-1481">Outros métodos nesta família permitem configurar um pipeline de middleware a ser usado como o manipulador de rotas.</span><span class="sxs-lookup"><span data-stu-id="d5000-1481">Other methods in this family allow configuring a middleware pipeline for use as the route handler.</span></span> <span data-ttu-id="d5000-1482">Se o método `Map*` não aceitar um manipulador, como <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapRoute*>, ele usará o <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*>.</span><span class="sxs-lookup"><span data-stu-id="d5000-1482">If the `Map*` method doesn't accept a handler, such as <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapRoute*>, it uses the <xref:Microsoft.AspNetCore.Routing.RouteBuilder.DefaultHandler*>.</span></span>

<span data-ttu-id="d5000-1483">Os métodos `Map[Verb]` usam restrições para limitar a rota ao Verbo HTTP no nome do método.</span><span class="sxs-lookup"><span data-stu-id="d5000-1483">The `Map[Verb]` methods use constraints to limit the route to the HTTP Verb in the method name.</span></span> <span data-ttu-id="d5000-1484">Por exemplo, veja <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*> e <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapVerb*>.</span><span class="sxs-lookup"><span data-stu-id="d5000-1484">For example, see <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapGet*> and <xref:Microsoft.AspNetCore.Routing.RequestDelegateRouteBuilderExtensions.MapVerb*>.</span></span>

## <a name="route-template-reference"></a><span data-ttu-id="d5000-1485">Referência de modelo de rota</span><span class="sxs-lookup"><span data-stu-id="d5000-1485">Route template reference</span></span>

<span data-ttu-id="d5000-1486">Os tokens entre chaves (`{ ... }`) definem os *parâmetros de rota* que serão associados se a rota for correspondida.</span><span class="sxs-lookup"><span data-stu-id="d5000-1486">Tokens within curly braces (`{ ... }`) define *route parameters* that are bound if the route is matched.</span></span> <span data-ttu-id="d5000-1487">Você pode definir mais de um parâmetro de rota em um segmento de rota, mas eles precisam ser separados por um valor literal.</span><span class="sxs-lookup"><span data-stu-id="d5000-1487">You can define more than one route parameter in a route segment, but they must be separated by a literal value.</span></span> <span data-ttu-id="d5000-1488">Por exemplo, `{controller=Home}{action=Index}` não é uma rota válida, já que não há nenhum valor literal entre `{controller}` e `{action}`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1488">For example, `{controller=Home}{action=Index}` isn't a valid route, since there's no literal value between `{controller}` and `{action}`.</span></span> <span data-ttu-id="d5000-1489">Esses parâmetros de rota precisam ter um nome e podem ter atributos adicionais especificados.</span><span class="sxs-lookup"><span data-stu-id="d5000-1489">These route parameters must have a name and may have additional attributes specified.</span></span>

<span data-ttu-id="d5000-1490">Um texto literal diferente dos parâmetros de rota (por exemplo, `{id}`) e do separador de caminho `/` precisa corresponder ao texto na URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-1490">Literal text other than route parameters (for example, `{id}`) and the path separator `/` must match the text in the URL.</span></span> <span data-ttu-id="d5000-1491">A correspondência de texto não diferencia maiúsculas de minúsculas e se baseia na representação decodificada do caminho de URLs.</span><span class="sxs-lookup"><span data-stu-id="d5000-1491">Text matching is case-insensitive and based on the decoded representation of the URLs path.</span></span> <span data-ttu-id="d5000-1492">Para encontrar a correspondência de um delimitador de parâmetro de rota literal (`{` ou `}`), faça o escape do delimitador repetindo o caractere (`{{` ou `}}`).</span><span class="sxs-lookup"><span data-stu-id="d5000-1492">To match a literal route parameter delimiter (`{` or `}`), escape the delimiter by repeating the character (`{{` or `}}`).</span></span>

<span data-ttu-id="d5000-1493">Padrões de URL que tentam capturar um nome de arquivo com uma extensão de arquivo opcional apresentam considerações adicionais.</span><span class="sxs-lookup"><span data-stu-id="d5000-1493">URL patterns that attempt to capture a file name with an optional file extension have additional considerations.</span></span> <span data-ttu-id="d5000-1494">Por exemplo, considere o modelo `files/{filename}.{ext?}`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1494">For example, consider the template `files/{filename}.{ext?}`.</span></span> <span data-ttu-id="d5000-1495">Quando existem valores para `filename` e `ext`, ambos os valores são populados.</span><span class="sxs-lookup"><span data-stu-id="d5000-1495">When values for both `filename` and `ext` exist, both values are populated.</span></span> <span data-ttu-id="d5000-1496">Se apenas existir um valor para `filename` na URL, a rota encontrará uma correspondência, pois o ponto à direita (`.`) é opcional.</span><span class="sxs-lookup"><span data-stu-id="d5000-1496">If only a value for `filename` exists in the URL, the route matches because the trailing period (`.`) is  optional.</span></span> <span data-ttu-id="d5000-1497">As URLs a seguir correspondem a essa rota:</span><span class="sxs-lookup"><span data-stu-id="d5000-1497">The following URLs match this route:</span></span>

* `/files/myFile.txt`
* `/files/myFile`

<span data-ttu-id="d5000-1498">Você pode usar o asterisco (`*`) como um prefixo para um parâmetro de rota a ser associado ao restante do URI.</span><span class="sxs-lookup"><span data-stu-id="d5000-1498">You can use the asterisk (`*`) as a prefix to a route parameter to bind to the rest of the URI.</span></span> <span data-ttu-id="d5000-1499">Isso é chamado de parâmetro *catch-all*.</span><span class="sxs-lookup"><span data-stu-id="d5000-1499">This is called a *catch-all* parameter.</span></span> <span data-ttu-id="d5000-1500">Por exemplo, `blog/{*slug}` corresponde a qualquer URI que começa com `/blog` e tem qualquer valor depois dele, que é atribuído ao valor de rota `slug`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1500">For example, `blog/{*slug}` matches any URI that starts with `/blog` and has any value following it, which is assigned to the `slug` route value.</span></span> <span data-ttu-id="d5000-1501">Os parâmetros catch-all também podem corresponder à cadeia de caracteres vazia.</span><span class="sxs-lookup"><span data-stu-id="d5000-1501">Catch-all parameters can also match the empty string.</span></span>

<span data-ttu-id="d5000-1502">O parâmetro catch-all faz o escape dos caracteres corretos quando a rota é usada para gerar uma URL, incluindo os caracteres separadores de caminho (`/`).</span><span class="sxs-lookup"><span data-stu-id="d5000-1502">The catch-all parameter escapes the appropriate characters when the route is used to generate a URL, including path separator (`/`) characters.</span></span> <span data-ttu-id="d5000-1503">Por exemplo, a rota `foo/{*path}` com valores de rota `{ path = "my/path" }` gera `foo/my%2Fpath`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1503">For example, the route `foo/{*path}` with route values `{ path = "my/path" }` generates `foo/my%2Fpath`.</span></span> <span data-ttu-id="d5000-1504">Observe o escape da barra invertida.</span><span class="sxs-lookup"><span data-stu-id="d5000-1504">Note the escaped forward slash.</span></span>

<span data-ttu-id="d5000-1505">Os parâmetros de rota podem ter *valores padrão*, designados pela especificação do valor padrão após o nome do parâmetro separado por um sinal de igual (`=`).</span><span class="sxs-lookup"><span data-stu-id="d5000-1505">Route parameters may have *default values* designated by specifying the default value after the parameter name separated by an equals sign (`=`).</span></span> <span data-ttu-id="d5000-1506">Por exemplo, `{controller=Home}` define `Home` como o valor padrão de `controller`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1506">For example, `{controller=Home}` defines `Home` as the default value for `controller`.</span></span> <span data-ttu-id="d5000-1507">O valor padrão é usado se nenhum valor está presente na URL para o parâmetro.</span><span class="sxs-lookup"><span data-stu-id="d5000-1507">The default value is used if no value is present in the URL for the parameter.</span></span> <span data-ttu-id="d5000-1508">Os parâmetros de rota se tornam opcionais com o acréscimo de um ponto de interrogação (`?`) ao final do nome do parâmetro, como em `id?`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1508">Route parameters are made optional by appending a question mark (`?`) to the end of the parameter name, as in `id?`.</span></span> <span data-ttu-id="d5000-1509">A diferença entre valores opcionais e parâmetros de rota padrão é que um parâmetro de rota com um valor padrão sempre produz um valor – um parâmetro opcional tem um valor somente quando um valor é fornecido pela URL de solicitação.</span><span class="sxs-lookup"><span data-stu-id="d5000-1509">The difference between optional values and default route parameters is that a route parameter with a default value always produces a value&mdash;an optional parameter has a value only when a value is provided by the request URL.</span></span>

<span data-ttu-id="d5000-1510">Os parâmetros de rota podem ter restrições que precisam corresponder ao valor de rota associado da URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-1510">Route parameters may have constraints that must match the route value bound from the URL.</span></span> <span data-ttu-id="d5000-1511">A adição de dois-pontos (`:`) e do nome da restrição após o nome do parâmetro de rota especifica uma *restrição embutida* em um parâmetro de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-1511">Adding a colon (`:`) and constraint name after the route parameter name specifies an *inline constraint* on a route parameter.</span></span> <span data-ttu-id="d5000-1512">Se a restrição exigir argumentos, eles ficarão entre parênteses (`(...)`) após o nome da restrição.</span><span class="sxs-lookup"><span data-stu-id="d5000-1512">If the constraint requires arguments, they're enclosed in parentheses (`(...)`) after the constraint name.</span></span> <span data-ttu-id="d5000-1513">Várias restrições embutidas podem ser especificadas por meio do acréscimo de outros dois-pontos (`:`) e do nome da restrição.</span><span class="sxs-lookup"><span data-stu-id="d5000-1513">Multiple inline constraints can be specified by appending another colon (`:`) and constraint name.</span></span>

<span data-ttu-id="d5000-1514">O nome da restrição e os argumentos são passados para o serviço <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> para criar uma instância de <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> a ser usada no processamento de URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-1514">The constraint name and arguments are passed to the <xref:Microsoft.AspNetCore.Routing.IInlineConstraintResolver> service to create an instance of <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> to use in URL processing.</span></span> <span data-ttu-id="d5000-1515">Por exemplo, o modelo de rota `blog/{article:minlength(10)}` especifica uma restrição `minlength` com o argumento `10`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1515">For example, the route template `blog/{article:minlength(10)}` specifies a `minlength` constraint with the argument `10`.</span></span> <span data-ttu-id="d5000-1516">Para obter mais informações sobre as restrições de rota e uma lista das restrições fornecidas pela estrutura, confira a seção [Referência de restrição de rota](#route-constraint-reference).</span><span class="sxs-lookup"><span data-stu-id="d5000-1516">For more information on route constraints and a list of the constraints provided by the framework, see the [Route constraint reference](#route-constraint-reference) section.</span></span>

<span data-ttu-id="d5000-1517">A tabela a seguir demonstra modelos de rota de exemplo e seu comportamento.</span><span class="sxs-lookup"><span data-stu-id="d5000-1517">The following table demonstrates example route templates and their behavior.</span></span>

| <span data-ttu-id="d5000-1518">Modelo de rota</span><span class="sxs-lookup"><span data-stu-id="d5000-1518">Route Template</span></span>                           | <span data-ttu-id="d5000-1519">URI de correspondência de exemplo</span><span class="sxs-lookup"><span data-stu-id="d5000-1519">Example Matching URI</span></span>    | <span data-ttu-id="d5000-1520">O URI de solicitação&hellip;</span><span class="sxs-lookup"><span data-stu-id="d5000-1520">The request URI&hellip;</span></span>                                                    |
| ---------------------------------------- | ----------------------- | -------------------------------------------------------------------------- |
| `hello`                                  | `/hello`                | <span data-ttu-id="d5000-1521">Somente corresponde ao caminho único `/hello`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1521">Only matches the single path `/hello`.</span></span>                                     |
| `{Page=Home}`                            | `/`                     | <span data-ttu-id="d5000-1522">Faz a correspondência e define `Page` como `Home`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1522">Matches and sets `Page` to `Home`.</span></span>                                         |
| `{Page=Home}`                            | `/Contact`              | <span data-ttu-id="d5000-1523">Faz a correspondência e define `Page` como `Contact`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1523">Matches and sets `Page` to `Contact`.</span></span>                                      |
| `{controller}/{action}/{id?}`            | `/Products/List`        | <span data-ttu-id="d5000-1524">É mapeado para o controlador `Products` e a ação `List`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1524">Maps to the `Products` controller and `List` action.</span></span>                       |
| `{controller}/{action}/{id?}`            | `/Products/Details/123` | <span data-ttu-id="d5000-1525">É mapeado para o controlador `Products` e a ação `Details` (`id` definido como 123).</span><span class="sxs-lookup"><span data-stu-id="d5000-1525">Maps to the `Products` controller and  `Details` action (`id` set to 123).</span></span> |
| `{controller=Home}/{action=Index}/{id?}` | `/`                     | <span data-ttu-id="d5000-1526">É mapeado para o controlador `Home` e o método `Index` (`id` é ignorado).</span><span class="sxs-lookup"><span data-stu-id="d5000-1526">Maps to the `Home` controller and `Index` method (`id` is ignored).</span></span>        |

<span data-ttu-id="d5000-1527">Em geral, o uso de um modelo é a abordagem mais simples para o roteamento.</span><span class="sxs-lookup"><span data-stu-id="d5000-1527">Using a template is generally the simplest approach to routing.</span></span> <span data-ttu-id="d5000-1528">Restrições e padrões também podem ser especificados fora do modelo de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-1528">Constraints and defaults can also be specified outside the route template.</span></span>

> [!TIP]
> <span data-ttu-id="d5000-1529">Habilite o [Log](xref:fundamentals/logging/index) para ver como as implementações de roteamento internas, como <xref:Microsoft.AspNetCore.Routing.Route>, correspondem às solicitações.</span><span class="sxs-lookup"><span data-stu-id="d5000-1529">Enable [Logging](xref:fundamentals/logging/index) to see how the built-in routing implementations, such as <xref:Microsoft.AspNetCore.Routing.Route>, match requests.</span></span>

## <a name="route-constraint-reference"></a><span data-ttu-id="d5000-1530">Referência de restrição de rota</span><span class="sxs-lookup"><span data-stu-id="d5000-1530">Route constraint reference</span></span>

<span data-ttu-id="d5000-1531">As restrições de rota são executadas quando ocorre uma correspondência com a URL de entrada e é criado um token do caminho da URL em valores de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-1531">Route constraints execute when a match has occurred to the incoming URL and the URL path is tokenized into route values.</span></span> <span data-ttu-id="d5000-1532">Em geral, as restrições da rota inspecionam o valor de rota associado por meio do modelo de rota e tomam uma decisão do tipo "sim/não" sobre se o valor é aceitável ou não.</span><span class="sxs-lookup"><span data-stu-id="d5000-1532">Route constraints generally inspect the route value associated via the route template and make a yes/no decision about whether or not the value is acceptable.</span></span> <span data-ttu-id="d5000-1533">Algumas restrições da rota usam dados fora do valor de rota para considerar se a solicitação pode ser encaminhada.</span><span class="sxs-lookup"><span data-stu-id="d5000-1533">Some route constraints use data outside the route value to consider whether the request can be routed.</span></span> <span data-ttu-id="d5000-1534">Por exemplo, a <xref:Microsoft.AspNetCore.Routing.Constraints.HttpMethodRouteConstraint> pode aceitar ou rejeitar uma solicitação de acordo com o verbo HTTP.</span><span class="sxs-lookup"><span data-stu-id="d5000-1534">For example, the <xref:Microsoft.AspNetCore.Routing.Constraints.HttpMethodRouteConstraint> can accept or reject a request based on its HTTP verb.</span></span> <span data-ttu-id="d5000-1535">As restrições são usadas em solicitações de roteamento e na geração de link.</span><span class="sxs-lookup"><span data-stu-id="d5000-1535">Constraints are used in routing requests and link generation.</span></span>

> [!WARNING]
> <span data-ttu-id="d5000-1536">Não use restrições para a **validação de entrada**.</span><span class="sxs-lookup"><span data-stu-id="d5000-1536">Don't use constraints for **input validation**.</span></span> <span data-ttu-id="d5000-1537">Se as restrições forem usadas para a **validação de entrada**, uma entrada inválida resultará em uma resposta *404 – Não Encontrado*, em vez de *400 – Solicitação Inválida* com uma mensagem de erro apropriada.</span><span class="sxs-lookup"><span data-stu-id="d5000-1537">If constraints are used for **input validation**, invalid input results in a *404 - Not Found* response instead of a *400 - Bad Request* with an appropriate error message.</span></span> <span data-ttu-id="d5000-1538">As restrições de rota são usadas para **desfazer a ambiguidade** entre rotas semelhantes, não para validar as entradas de uma rota específica.</span><span class="sxs-lookup"><span data-stu-id="d5000-1538">Route constraints are used to **disambiguate** similar routes, not to validate the inputs for a particular route.</span></span>

<span data-ttu-id="d5000-1539">A tabela a seguir demonstra restrições de rota de exemplo e seu comportamento esperado.</span><span class="sxs-lookup"><span data-stu-id="d5000-1539">The following table demonstrates example route constraints and their expected behavior.</span></span>

| <span data-ttu-id="d5000-1540">restrição</span><span class="sxs-lookup"><span data-stu-id="d5000-1540">constraint</span></span> | <span data-ttu-id="d5000-1541">Exemplo</span><span class="sxs-lookup"><span data-stu-id="d5000-1541">Example</span></span> | <span data-ttu-id="d5000-1542">Correspondências de exemplo</span><span class="sxs-lookup"><span data-stu-id="d5000-1542">Example Matches</span></span> | <span data-ttu-id="d5000-1543">Anotações</span><span class="sxs-lookup"><span data-stu-id="d5000-1543">Notes</span></span> |
| ---------- | ------- | --------------- | ----- |
| `int` | `{id:int}` | <span data-ttu-id="d5000-1544">`123456789`, `-123456789`</span><span class="sxs-lookup"><span data-stu-id="d5000-1544">`123456789`, `-123456789`</span></span> | <span data-ttu-id="d5000-1545">Corresponde a qualquer inteiro</span><span class="sxs-lookup"><span data-stu-id="d5000-1545">Matches any integer</span></span> |
| `bool` | `{active:bool}` | <span data-ttu-id="d5000-1546">`true`, `FALSE`</span><span class="sxs-lookup"><span data-stu-id="d5000-1546">`true`, `FALSE`</span></span> | <span data-ttu-id="d5000-1547">Corresponde a `true` ou `false` (não diferencia maiúsculas de minúsculas)</span><span class="sxs-lookup"><span data-stu-id="d5000-1547">Matches `true` or `false` (case-insensitive)</span></span> |
| `datetime` | `{dob:datetime}` | <span data-ttu-id="d5000-1548">`2016-12-31`, `2016-12-31 7:32pm`</span><span class="sxs-lookup"><span data-stu-id="d5000-1548">`2016-12-31`, `2016-12-31 7:32pm`</span></span> | <span data-ttu-id="d5000-1549">Corresponde a um `DateTime` valor válido na cultura invariável.</span><span class="sxs-lookup"><span data-stu-id="d5000-1549">Matches a valid `DateTime` value in the invariant culture.</span></span> <span data-ttu-id="d5000-1550">Consulte o aviso anterior.</span><span class="sxs-lookup"><span data-stu-id="d5000-1550">See  preceding warning.</span></span>|
| `decimal` | `{price:decimal}` | <span data-ttu-id="d5000-1551">`49.99`, `-1,000.01`</span><span class="sxs-lookup"><span data-stu-id="d5000-1551">`49.99`, `-1,000.01`</span></span> | <span data-ttu-id="d5000-1552">Corresponde a um `decimal` valor válido na cultura invariável.</span><span class="sxs-lookup"><span data-stu-id="d5000-1552">Matches a valid `decimal` value in the invariant culture.</span></span> <span data-ttu-id="d5000-1553">Consulte o aviso anterior.</span><span class="sxs-lookup"><span data-stu-id="d5000-1553">See  preceding warning.</span></span>|
| `double` | `{weight:double}` | <span data-ttu-id="d5000-1554">`1.234`, `-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="d5000-1554">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="d5000-1555">Corresponde a um `double` valor válido na cultura invariável.</span><span class="sxs-lookup"><span data-stu-id="d5000-1555">Matches a valid `double` value in the invariant culture.</span></span> <span data-ttu-id="d5000-1556">Consulte o aviso anterior.</span><span class="sxs-lookup"><span data-stu-id="d5000-1556">See  preceding warning.</span></span>|
| `float` | `{weight:float}` | <span data-ttu-id="d5000-1557">`1.234`, `-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="d5000-1557">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="d5000-1558">Corresponde a um `float` valor válido na cultura invariável.</span><span class="sxs-lookup"><span data-stu-id="d5000-1558">Matches a valid `float` value in the invariant culture.</span></span> <span data-ttu-id="d5000-1559">Consulte o aviso anterior.</span><span class="sxs-lookup"><span data-stu-id="d5000-1559">See  preceding warning.</span></span>|
| `guid` | `{id:guid}` | <span data-ttu-id="d5000-1560">`CD2C1638-1638-72D5-1638-DEADBEEF1638`, `{CD2C1638-1638-72D5-1638-DEADBEEF1638}`</span><span class="sxs-lookup"><span data-stu-id="d5000-1560">`CD2C1638-1638-72D5-1638-DEADBEEF1638`, `{CD2C1638-1638-72D5-1638-DEADBEEF1638}`</span></span> | <span data-ttu-id="d5000-1561">Corresponde a um valor `Guid` válido</span><span class="sxs-lookup"><span data-stu-id="d5000-1561">Matches a valid `Guid` value</span></span> |
| `long` | `{ticks:long}` | <span data-ttu-id="d5000-1562">`123456789`, `-123456789`</span><span class="sxs-lookup"><span data-stu-id="d5000-1562">`123456789`, `-123456789`</span></span> | <span data-ttu-id="d5000-1563">Corresponde a um valor `long` válido</span><span class="sxs-lookup"><span data-stu-id="d5000-1563">Matches a valid `long` value</span></span> |
| `minlength(value)` | `{username:minlength(4)}` | `Rick` | <span data-ttu-id="d5000-1564">A cadeia de caracteres deve ter, no mínimo, 4 caracteres</span><span class="sxs-lookup"><span data-stu-id="d5000-1564">String must be at least 4 characters</span></span> |
| `maxlength(value)` | `{filename:maxlength(8)}` | `Richard` | <span data-ttu-id="d5000-1565">A cadeia de caracteres não pode ser maior que 8 caracteres</span><span class="sxs-lookup"><span data-stu-id="d5000-1565">String must be no more than 8 characters</span></span> |
| `length(length)` | `{filename:length(12)}` | `somefile.txt` | <span data-ttu-id="d5000-1566">A cadeia de caracteres deve ter exatamente 12 caracteres</span><span class="sxs-lookup"><span data-stu-id="d5000-1566">String must be exactly 12 characters long</span></span> |
| `length(min,max)` | `{filename:length(8,16)}` | `somefile.txt` | <span data-ttu-id="d5000-1567">A cadeia de caracteres deve ter, pelo menos, 8 e não mais de 16 caracteres</span><span class="sxs-lookup"><span data-stu-id="d5000-1567">String must be at least 8 and no more than 16 characters long</span></span> |
| `min(value)` | `{age:min(18)}` | `19` | <span data-ttu-id="d5000-1568">O valor inteiro deve ser, pelo menos, 18</span><span class="sxs-lookup"><span data-stu-id="d5000-1568">Integer value must be at least 18</span></span> |
| `max(value)` | `{age:max(120)}` | `91` | <span data-ttu-id="d5000-1569">O valor inteiro não deve ser maior que 120</span><span class="sxs-lookup"><span data-stu-id="d5000-1569">Integer value must be no more than 120</span></span> |
| `range(min,max)` | `{age:range(18,120)}` | `91` | <span data-ttu-id="d5000-1570">O valor inteiro deve ser, pelo menos, 18, mas não maior que 120</span><span class="sxs-lookup"><span data-stu-id="d5000-1570">Integer value must be at least 18 but no more than 120</span></span> |
| `alpha` | `{name:alpha}` | `Rick` | <span data-ttu-id="d5000-1571">A cadeia de caracteres deve consistir em um ou mais caracteres alfabéticos (`a`-`z`, não diferencia maiúsculas de minúsculas)</span><span class="sxs-lookup"><span data-stu-id="d5000-1571">String must consist of one or more alphabetical characters (`a`-`z`, case-insensitive)</span></span> |
| `regex(expression)` | `{ssn:regex(^\\d{{3}}-\\d{{2}}-\\d{{4}}$)}` | `123-45-6789` | <span data-ttu-id="d5000-1572">A cadeia de caracteres deve corresponder à expressão regular (veja as dicas sobre como definir uma expressão regular)</span><span class="sxs-lookup"><span data-stu-id="d5000-1572">String must match the regular expression (see tips about defining a regular expression)</span></span> |
| `required` | `{name:required}` | `Rick` | <span data-ttu-id="d5000-1573">Usado para impor que um valor não parâmetro está presente durante a geração de URL</span><span class="sxs-lookup"><span data-stu-id="d5000-1573">Used to enforce that a non-parameter value is present during URL generation</span></span> |

<span data-ttu-id="d5000-1574">Várias restrições delimitadas por vírgula podem ser aplicadas a um único parâmetro.</span><span class="sxs-lookup"><span data-stu-id="d5000-1574">Multiple, colon-delimited constraints can be applied to a single parameter.</span></span> <span data-ttu-id="d5000-1575">Por exemplo, a restrição a seguir restringe um parâmetro para um valor inteiro de 1 ou maior:</span><span class="sxs-lookup"><span data-stu-id="d5000-1575">For example, the following constraint restricts a parameter to an integer value of 1 or greater:</span></span>

```csharp
[Route("users/{id:int:min(1)}")]
public User GetUserById(int id) { }
```

> [!WARNING]
> <span data-ttu-id="d5000-1576">As restrições de rota que verificam a URL e são convertidas em um tipo CLR (como `int` ou `DateTime`) sempre usam a cultura invariável.</span><span class="sxs-lookup"><span data-stu-id="d5000-1576">Route constraints that verify the URL and are converted to a CLR type (such as `int` or `DateTime`) always use the invariant culture.</span></span> <span data-ttu-id="d5000-1577">Essas restrições consideram que a URL não é localizável.</span><span class="sxs-lookup"><span data-stu-id="d5000-1577">These constraints assume that the URL is non-localizable.</span></span> <span data-ttu-id="d5000-1578">As restrições de rota fornecidas pela estrutura não modificam os valores armazenados nos valores de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-1578">The framework-provided route constraints don't modify the values stored in route values.</span></span> <span data-ttu-id="d5000-1579">Todos os valores de rota analisados com base na URL são armazenados como cadeias de caracteres.</span><span class="sxs-lookup"><span data-stu-id="d5000-1579">All route values parsed from the URL are stored as strings.</span></span> <span data-ttu-id="d5000-1580">Por exemplo, a restrição `float` tenta converter o valor de rota em um float, mas o valor convertido é usado somente para verificar se ele pode ser convertido em um float.</span><span class="sxs-lookup"><span data-stu-id="d5000-1580">For example, the `float` constraint attempts to convert the route value to a float, but the converted value is used only to verify it can be converted to a float.</span></span>

## <a name="regular-expressions"></a><span data-ttu-id="d5000-1581">Expressões regulares</span><span class="sxs-lookup"><span data-stu-id="d5000-1581">Regular expressions</span></span>

<span data-ttu-id="d5000-1582">A estrutura do ASP.NET Core adiciona `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant` ao construtor de expressão regular.</span><span class="sxs-lookup"><span data-stu-id="d5000-1582">The ASP.NET Core framework adds `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant` to the regular expression constructor.</span></span> <span data-ttu-id="d5000-1583">Confira <xref:System.Text.RegularExpressions.RegexOptions> para obter uma descrição desses membros.</span><span class="sxs-lookup"><span data-stu-id="d5000-1583">See <xref:System.Text.RegularExpressions.RegexOptions> for a description of these members.</span></span>

<span data-ttu-id="d5000-1584">As expressões regulares usam delimitadores e tokens semelhantes aos usados pelo Roteamento e pela linguagem C#.</span><span class="sxs-lookup"><span data-stu-id="d5000-1584">Regular expressions use delimiters and tokens similar to those used by Routing and the C# language.</span></span> <span data-ttu-id="d5000-1585">Os tokens de expressão regular precisam ter escape.</span><span class="sxs-lookup"><span data-stu-id="d5000-1585">Regular expression tokens must be escaped.</span></span> <span data-ttu-id="d5000-1586">Para usar a expressão regular `^\d{3}-\d{2}-\d{4}$` no roteamento, a expressão precisa ter os caracteres `\` (barra invertida) fornecidos na cadeia de caracteres como caracteres `\\` (barra invertida dupla) no arquivo de origem C# para fazer o escape do caractere de escape da cadeia de caracteres `\` (a menos que estejam sendo usados [literais de cadeia de caracteres textuais](/dotnet/csharp/language-reference/keywords/string)).</span><span class="sxs-lookup"><span data-stu-id="d5000-1586">To use the regular expression `^\d{3}-\d{2}-\d{4}$` in routing, the expression must have the `\` (single backslash) characters provided in the string as `\\` (double backslash) characters in the C# source file in order to escape the `\` string escape character (unless using [verbatim string literals](/dotnet/csharp/language-reference/keywords/string)).</span></span> <span data-ttu-id="d5000-1587">Para fazer o escape dos caracteres de delimitador de parâmetro de roteamento (`{`, `}`, `[`, `]`), duplique os caracteres na expressão (`{{`, `}`, `[[`, `]]`).</span><span class="sxs-lookup"><span data-stu-id="d5000-1587">To escape routing parameter delimiter characters (`{`, `}`, `[`, `]`), double the characters in the expression (`{{`, `}`, `[[`, `]]`).</span></span> <span data-ttu-id="d5000-1588">A tabela a seguir mostra uma expressão regular e a versão com escape.</span><span class="sxs-lookup"><span data-stu-id="d5000-1588">The following table shows a regular expression and the escaped version.</span></span>

| <span data-ttu-id="d5000-1589">Expressão regular</span><span class="sxs-lookup"><span data-stu-id="d5000-1589">Regular Expression</span></span>    | <span data-ttu-id="d5000-1590">Expressão regular com escape</span><span class="sxs-lookup"><span data-stu-id="d5000-1590">Escaped Regular Expression</span></span>     |
| --------------------- | ------------------------------ |
| `^\d{3}-\d{2}-\d{4}$` | `^\\d{{3}}-\\d{{2}}-\\d{{4}}$` |
| `^[a-z]{2}$`          | `^[[a-z]]{{2}}$`               |

<span data-ttu-id="d5000-1591">As expressões regulares usadas no roteamento geralmente começam com o caractere de acento circunflexo (`^`) e correspondem à posição inicial da cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="d5000-1591">Regular expressions used in routing often start with the caret (`^`) character and match starting position of the string.</span></span> <span data-ttu-id="d5000-1592">As expressões geralmente terminam com o caractere de cifrão (`$`) e correspondem ao final da cadeia de caracteres.</span><span class="sxs-lookup"><span data-stu-id="d5000-1592">The expressions often end with the dollar sign (`$`) character and match end of the string.</span></span> <span data-ttu-id="d5000-1593">Os caracteres `^` e `$` garantem que a expressão regular corresponde a todo o valor do parâmetro de rota.</span><span class="sxs-lookup"><span data-stu-id="d5000-1593">The `^` and `$` characters ensure that the regular expression match the entire route parameter value.</span></span> <span data-ttu-id="d5000-1594">Sem os caracteres `^` e `$`, a expressão regular corresponde a qualquer subcadeia de caracteres na cadeia de caracteres, o que geralmente não é o desejado.</span><span class="sxs-lookup"><span data-stu-id="d5000-1594">Without the `^` and `$` characters, the regular expression match any substring within the string, which is often undesirable.</span></span> <span data-ttu-id="d5000-1595">A tabela a seguir fornece exemplos e explica por que eles encontram ou não uma correspondência.</span><span class="sxs-lookup"><span data-stu-id="d5000-1595">The following table provides examples and explains why they match or fail to match.</span></span>

| <span data-ttu-id="d5000-1596">Expression</span><span class="sxs-lookup"><span data-stu-id="d5000-1596">Expression</span></span>   | <span data-ttu-id="d5000-1597">Cadeia de caracteres</span><span class="sxs-lookup"><span data-stu-id="d5000-1597">String</span></span>    | <span data-ttu-id="d5000-1598">Correspondência</span><span class="sxs-lookup"><span data-stu-id="d5000-1598">Match</span></span> | <span data-ttu-id="d5000-1599">Comentário</span><span class="sxs-lookup"><span data-stu-id="d5000-1599">Comment</span></span>               |
| ------------ | --------- | :---: |  -------------------- |
| `[a-z]{2}`   | <span data-ttu-id="d5000-1600">hello</span><span class="sxs-lookup"><span data-stu-id="d5000-1600">hello</span></span>     | <span data-ttu-id="d5000-1601">Sim</span><span class="sxs-lookup"><span data-stu-id="d5000-1601">Yes</span></span>   | <span data-ttu-id="d5000-1602">A subcadeia de caracteres corresponde</span><span class="sxs-lookup"><span data-stu-id="d5000-1602">Substring matches</span></span>     |
| `[a-z]{2}`   | <span data-ttu-id="d5000-1603">123abc456</span><span class="sxs-lookup"><span data-stu-id="d5000-1603">123abc456</span></span> | <span data-ttu-id="d5000-1604">Sim</span><span class="sxs-lookup"><span data-stu-id="d5000-1604">Yes</span></span>   | <span data-ttu-id="d5000-1605">A subcadeia de caracteres corresponde</span><span class="sxs-lookup"><span data-stu-id="d5000-1605">Substring matches</span></span>     |
| `[a-z]{2}`   | <span data-ttu-id="d5000-1606">mz</span><span class="sxs-lookup"><span data-stu-id="d5000-1606">mz</span></span>        | <span data-ttu-id="d5000-1607">Sim</span><span class="sxs-lookup"><span data-stu-id="d5000-1607">Yes</span></span>   | <span data-ttu-id="d5000-1608">Corresponde à expressão</span><span class="sxs-lookup"><span data-stu-id="d5000-1608">Matches expression</span></span>    |
| `[a-z]{2}`   | <span data-ttu-id="d5000-1609">MZ</span><span class="sxs-lookup"><span data-stu-id="d5000-1609">MZ</span></span>        | <span data-ttu-id="d5000-1610">Sim</span><span class="sxs-lookup"><span data-stu-id="d5000-1610">Yes</span></span>   | <span data-ttu-id="d5000-1611">Não diferencia maiúsculas de minúsculas</span><span class="sxs-lookup"><span data-stu-id="d5000-1611">Not case sensitive</span></span>    |
| `^[a-z]{2}$` | <span data-ttu-id="d5000-1612">hello</span><span class="sxs-lookup"><span data-stu-id="d5000-1612">hello</span></span>     | <span data-ttu-id="d5000-1613">Não</span><span class="sxs-lookup"><span data-stu-id="d5000-1613">No</span></span>    | <span data-ttu-id="d5000-1614">Confira `^` e `$` acima</span><span class="sxs-lookup"><span data-stu-id="d5000-1614">See `^` and `$` above</span></span> |
| `^[a-z]{2}$` | <span data-ttu-id="d5000-1615">123abc456</span><span class="sxs-lookup"><span data-stu-id="d5000-1615">123abc456</span></span> | <span data-ttu-id="d5000-1616">Não</span><span class="sxs-lookup"><span data-stu-id="d5000-1616">No</span></span>    | <span data-ttu-id="d5000-1617">Confira `^` e `$` acima</span><span class="sxs-lookup"><span data-stu-id="d5000-1617">See `^` and `$` above</span></span> |

<span data-ttu-id="d5000-1618">Para saber mais sobre a sintaxe de expressões regulares, confira [Expressões regulares do .NET Framework](/dotnet/standard/base-types/regular-expression-language-quick-reference).</span><span class="sxs-lookup"><span data-stu-id="d5000-1618">For more information on regular expression syntax, see [.NET Framework Regular Expressions](/dotnet/standard/base-types/regular-expression-language-quick-reference).</span></span>

<span data-ttu-id="d5000-1619">Para restringir um parâmetro a um conjunto conhecido de valores possíveis, use uma expressão regular.</span><span class="sxs-lookup"><span data-stu-id="d5000-1619">To constrain a parameter to a known set of possible values, use a regular expression.</span></span> <span data-ttu-id="d5000-1620">Por exemplo, `{action:regex(^(list|get|create)$)}` apenas corresponde o valor da rota `action` a `list`, `get` ou `create`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1620">For example, `{action:regex(^(list|get|create)$)}` only matches the `action` route value to `list`, `get`, or `create`.</span></span> <span data-ttu-id="d5000-1621">Se passada para o dicionário de restrições, a cadeia de caracteres `^(list|get|create)$` é equivalente.</span><span class="sxs-lookup"><span data-stu-id="d5000-1621">If passed into the constraints dictionary, the string `^(list|get|create)$` is equivalent.</span></span> <span data-ttu-id="d5000-1622">As restrições passadas para o dicionário de restrições (não embutidas em um modelo) que não correspondem a uma das restrições conhecidas também são tratadas como expressões regulares.</span><span class="sxs-lookup"><span data-stu-id="d5000-1622">Constraints that are passed in the constraints dictionary (not inline within a template) that don't match one of the known constraints are also treated as regular expressions.</span></span>

## <a name="custom-route-constraints"></a><span data-ttu-id="d5000-1623">Restrições de rota personalizadas</span><span class="sxs-lookup"><span data-stu-id="d5000-1623">Custom Route Constraints</span></span>

<span data-ttu-id="d5000-1624">Além das restrições de rota internas, é possível criar restrições de rota personalizadas com a implementação da interface do <xref:Microsoft.AspNetCore.Routing.IRouteConstraint>.</span><span class="sxs-lookup"><span data-stu-id="d5000-1624">In addition to the built-in route constraints, custom route constraints can be created by implementing the <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> interface.</span></span> <span data-ttu-id="d5000-1625">A interface do <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> contém um único método, `Match`, que retorna `true` quando a restrição é satisfeita. Caso contrário, retorna `false`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1625">The <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> interface contains a single method, `Match`, which returns `true` if the constraint is satisfied and `false` otherwise.</span></span>

<span data-ttu-id="d5000-1626">Para usar uma <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> personalizada, o tipo de restrição de rota deve ser registrado com o <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> do aplicativo, no contêiner de serviço do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d5000-1626">To use a custom <xref:Microsoft.AspNetCore.Routing.IRouteConstraint>, the route constraint type must be registered with the app's <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> in the app's service container.</span></span> <span data-ttu-id="d5000-1627">O <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> é um dicionário que mapeia as chaves de restrição de rota para implementações de <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> que validam essas restrições.</span><span class="sxs-lookup"><span data-stu-id="d5000-1627">A <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> is a dictionary that maps route constraint keys to <xref:Microsoft.AspNetCore.Routing.IRouteConstraint> implementations that validate those constraints.</span></span> <span data-ttu-id="d5000-1628">É possível atualizar o <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> do aplicativo no `Startup.ConfigureServices` como parte de uma chamada [services.AddRouting](xref:Microsoft.Extensions.DependencyInjection.RoutingServiceCollectionExtensions.AddRouting*) ou configurando <xref:Microsoft.AspNetCore.Routing.RouteOptions> diretamente com `services.Configure<RouteOptions>`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1628">An app's <xref:Microsoft.AspNetCore.Routing.RouteOptions.ConstraintMap> can be updated in `Startup.ConfigureServices` either as part of a [services.AddRouting](xref:Microsoft.Extensions.DependencyInjection.RoutingServiceCollectionExtensions.AddRouting*) call or by configuring <xref:Microsoft.AspNetCore.Routing.RouteOptions> directly with `services.Configure<RouteOptions>`.</span></span> <span data-ttu-id="d5000-1629">Por exemplo: </span><span class="sxs-lookup"><span data-stu-id="d5000-1629">For example:</span></span>

```csharp
services.AddRouting(options =>
{
    options.ConstraintMap.Add("customName", typeof(MyCustomConstraint));
});
```

<span data-ttu-id="d5000-1630">a restrição pode então ser aplicada às rotas da maneira usual, usando o nome especificado ao registrar o tipo de restrição.</span><span class="sxs-lookup"><span data-stu-id="d5000-1630">The constraint can then be applied to routes in the usual manner, using the name specified when registering the constraint type.</span></span> <span data-ttu-id="d5000-1631">Por exemplo: </span><span class="sxs-lookup"><span data-stu-id="d5000-1631">For example:</span></span>

```csharp
[HttpGet("{id:customName}")]
public ActionResult<string> Get(string id)
```

## <a name="url-generation-reference"></a><span data-ttu-id="d5000-1632">Referência de geração de URL</span><span class="sxs-lookup"><span data-stu-id="d5000-1632">URL generation reference</span></span>

<span data-ttu-id="d5000-1633">O exemplo a seguir mostra como gerar um link para uma rota com base em um dicionário de valores de rota e em um <xref:Microsoft.AspNetCore.Routing.RouteCollection>.</span><span class="sxs-lookup"><span data-stu-id="d5000-1633">The following example shows how to generate a link to a route given a dictionary of route values and a <xref:Microsoft.AspNetCore.Routing.RouteCollection>.</span></span>

[!code-csharp[](routing/samples/2.x/RoutingSample/Startup.cs?name=snippet_Dictionary)]

<span data-ttu-id="d5000-1634">O <xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath> gerado no final do exemplo anterior é `/package/create/123`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1634">The <xref:Microsoft.AspNetCore.Routing.VirtualPathData.VirtualPath> generated at the end of the preceding sample is `/package/create/123`.</span></span> <span data-ttu-id="d5000-1635">O dicionário fornece os valores de rota `operation` e `id` do modelo "Rastrear rota do pacote", `package/{operation}/{id}`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1635">The dictionary supplies the `operation` and `id` route values of the "Track Package Route" template, `package/{operation}/{id}`.</span></span> <span data-ttu-id="d5000-1636">Para obter detalhes, consulte o código de exemplo na seção [Usar o middleware de roteamento](#use-routing-middleware) ou no [aplicativo de exemplo](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/routing/samples).</span><span class="sxs-lookup"><span data-stu-id="d5000-1636">For details, see the sample code in the [Use Routing Middleware](#use-routing-middleware) section or the [sample app](https://github.com/dotnet/AspNetCore.Docs/tree/master/aspnetcore/fundamentals/routing/samples).</span></span>

<span data-ttu-id="d5000-1637">O segundo parâmetro para o construtor <xref:Microsoft.AspNetCore.Routing.VirtualPathContext> é uma coleção de *valores de ambiente*.</span><span class="sxs-lookup"><span data-stu-id="d5000-1637">The second parameter to the <xref:Microsoft.AspNetCore.Routing.VirtualPathContext> constructor is a collection of *ambient values*.</span></span> <span data-ttu-id="d5000-1638">Os valores de ambiente são convenientes de serem usados porque limitam o número de valores que um desenvolvedor precisa especificar em um contexto de solicitação.</span><span class="sxs-lookup"><span data-stu-id="d5000-1638">Ambient values are convenient to use because they limit the number of values a developer must specify within a request context.</span></span> <span data-ttu-id="d5000-1639">Os valores de rota atuais da solicitação atual são considerados valores de ambiente para a geração de link.</span><span class="sxs-lookup"><span data-stu-id="d5000-1639">The current route values of the current request are considered ambient values for link generation.</span></span> <span data-ttu-id="d5000-1640">Na ação `About` de um aplicativo ASP.NET Core MVC do `HomeController`, não é necessário especificar o valor de rota do controlador a ser vinculado à ação `Index` – o valor de ambiente `Home` é usado.</span><span class="sxs-lookup"><span data-stu-id="d5000-1640">In an ASP.NET Core MVC app's `About` action of the `HomeController`, you don't need to specify the controller route value to link to the `Index` action&mdash;the ambient value of `Home` is used.</span></span>

<span data-ttu-id="d5000-1641">Os valores de ambiente que não correspondem a um parâmetro são ignorados.</span><span class="sxs-lookup"><span data-stu-id="d5000-1641">Ambient values that don't match a parameter are ignored.</span></span> <span data-ttu-id="d5000-1642">Os valores de ambiente também são ignorados quando um valor fornecido explicitamente substitui o valor de ambiente.</span><span class="sxs-lookup"><span data-stu-id="d5000-1642">Ambient values are also ignored when an explicitly provided value overrides the ambient value.</span></span> <span data-ttu-id="d5000-1643">A correspondência ocorre da esquerda para a direita na URL.</span><span class="sxs-lookup"><span data-stu-id="d5000-1643">Matching occurs from left to right in the URL.</span></span>

<span data-ttu-id="d5000-1644">Valores fornecidos explicitamente, mas que não correspondem a um segmento da rota, são adicionados à cadeia de consulta.</span><span class="sxs-lookup"><span data-stu-id="d5000-1644">Values explicitly provided but that don't match a segment of the route are added to the query string.</span></span> <span data-ttu-id="d5000-1645">A tabela a seguir mostra o resultado do uso do modelo de rota `{controller}/{action}/{id?}`.</span><span class="sxs-lookup"><span data-stu-id="d5000-1645">The following table shows the result when using the route template `{controller}/{action}/{id?}`.</span></span>

| <span data-ttu-id="d5000-1646">Valores de ambiente</span><span class="sxs-lookup"><span data-stu-id="d5000-1646">Ambient Values</span></span>                     | <span data-ttu-id="d5000-1647">Valores explícitos</span><span class="sxs-lookup"><span data-stu-id="d5000-1647">Explicit Values</span></span>                        | <span data-ttu-id="d5000-1648">Result</span><span class="sxs-lookup"><span data-stu-id="d5000-1648">Result</span></span>                  |
| ---------------------------------- | -------------------------------------- | ----------------------- |
| <span data-ttu-id="d5000-1649">controlador = "Home"</span><span class="sxs-lookup"><span data-stu-id="d5000-1649">controller = "Home"</span></span>                | <span data-ttu-id="d5000-1650">ação = "About"</span><span class="sxs-lookup"><span data-stu-id="d5000-1650">action = "About"</span></span>                       | `/Home/About`           |
| <span data-ttu-id="d5000-1651">controlador = "Home"</span><span class="sxs-lookup"><span data-stu-id="d5000-1651">controller = "Home"</span></span>                | <span data-ttu-id="d5000-1652">controlador = "Order", ação = "About"</span><span class="sxs-lookup"><span data-stu-id="d5000-1652">controller = "Order", action = "About"</span></span> | `/Order/About`          |
| <span data-ttu-id="d5000-1653">controlador = "Home", cor = "Red"</span><span class="sxs-lookup"><span data-stu-id="d5000-1653">controller = "Home", color = "Red"</span></span> | <span data-ttu-id="d5000-1654">ação = "About"</span><span class="sxs-lookup"><span data-stu-id="d5000-1654">action = "About"</span></span>                       | `/Home/About`           |
| <span data-ttu-id="d5000-1655">controlador = "Home"</span><span class="sxs-lookup"><span data-stu-id="d5000-1655">controller = "Home"</span></span>                | <span data-ttu-id="d5000-1656">ação = "About", cor = "Red"</span><span class="sxs-lookup"><span data-stu-id="d5000-1656">action = "About", color = "Red"</span></span>        | `/Home/About?color=Red` |

<span data-ttu-id="d5000-1657">Se uma rota tem um valor padrão que não corresponde a um parâmetro e esse valor é fornecido de forma explícita, ele precisa corresponder ao valor padrão:</span><span class="sxs-lookup"><span data-stu-id="d5000-1657">If a route has a default value that doesn't correspond to a parameter and that value is explicitly provided, it must match the default value:</span></span>

```csharp
routes.MapRoute("blog_route", "blog/{*slug}",
    defaults: new { controller = "Blog", action = "ReadPost" });
```

<span data-ttu-id="d5000-1658">A geração de link somente gera um link para essa rota quando os valores correspondentes de `controller` e `action` são fornecidos.</span><span class="sxs-lookup"><span data-stu-id="d5000-1658">Link generation only generates a link for this route when the matching values for `controller` and `action` are provided.</span></span>

## <a name="complex-segments"></a><span data-ttu-id="d5000-1659">Segmentos complexos</span><span class="sxs-lookup"><span data-stu-id="d5000-1659">Complex segments</span></span>

<span data-ttu-id="d5000-1660">Segmentos complexos (por exemplo, `[Route("/x{token}y")]`) são processados por meio da combinação de literais da direita para a esquerda, de uma maneira diferente de Greedy.</span><span class="sxs-lookup"><span data-stu-id="d5000-1660">Complex segments (for example `[Route("/x{token}y")]`) are processed by matching up literals from right to left in a non-greedy way.</span></span> <span data-ttu-id="d5000-1661">Confira [este código](https://github.com/aspnet/AspNetCore/blob/release/2.2/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293) para ver uma explicação detalhada de como os segmentos complexos são combinados.</span><span class="sxs-lookup"><span data-stu-id="d5000-1661">See [this code](https://github.com/aspnet/AspNetCore/blob/release/2.2/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293) for a detailed explanation of how complex segments are matched.</span></span> <span data-ttu-id="d5000-1662">O [exemplo de código](https://github.com/aspnet/AspNetCore/blob/release/2.2/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293) não é usado pelo ASP.NET Core, mas fornece uma explicação adequada sobre segmentos complexos.</span><span class="sxs-lookup"><span data-stu-id="d5000-1662">The [code sample](https://github.com/aspnet/AspNetCore/blob/release/2.2/src/Http/Routing/src/Patterns/RoutePatternMatcher.cs#L293) is not used by ASP.NET Core, but it provides a good explanation of complex segments.</span></span>

::: moniker-end
