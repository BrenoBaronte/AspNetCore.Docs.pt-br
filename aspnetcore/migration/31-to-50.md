---
title: Migrar do ASP.NET Core 3,1 para 5,0
author: scottaddie
description: Saiba como migrar um projeto ASP.NET Core 3,1 para ASP.NET Core 5,0.
ms.author: scaddie
ms.custom: mvc
ms.date: 11/17/2020
no-loc:
- appsettings.json
- ASP.NET Core Identity
- cookie
- Cookie
- Blazor
- Blazor Server
- Blazor WebAssembly
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: migration/31-to-50
ms.openlocfilehash: 9550892f8b8bd9418f26d29ba77a6856a3bb30a0
ms.sourcegitcommit: fb208f907249cc7aab029afff941a0266c187050
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/17/2020
ms.locfileid: "94688378"
---
# <a name="migrate-from-aspnet-core-31-to-50"></a><span data-ttu-id="45445-103">Migrar do ASP.NET Core 3,1 para 5,0</span><span class="sxs-lookup"><span data-stu-id="45445-103">Migrate from ASP.NET Core 3.1 to 5.0</span></span>

<span data-ttu-id="45445-104">Por [Scott Addie](https://github.com/scottaddie)</span><span class="sxs-lookup"><span data-stu-id="45445-104">By [Scott Addie](https://github.com/scottaddie)</span></span>

<span data-ttu-id="45445-105">Este artigo explica como atualizar um projeto existente do ASP.NET Core 3,1 para ASP.NET Core 5,0.</span><span class="sxs-lookup"><span data-stu-id="45445-105">This article explains how to update an existing ASP.NET Core 3.1 project to ASP.NET Core 5.0.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="45445-106">Pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="45445-106">Prerequisites</span></span>

# <a name="visual-studio"></a>[<span data-ttu-id="45445-107">Visual Studio</span><span class="sxs-lookup"><span data-stu-id="45445-107">Visual Studio</span></span>](#tab/visual-studio)

[!INCLUDE[](~/includes/net-core-prereqs-vs-5.0.md)]

# <a name="visual-studio-code"></a>[<span data-ttu-id="45445-108">Visual Studio Code</span><span class="sxs-lookup"><span data-stu-id="45445-108">Visual Studio Code</span></span>](#tab/visual-studio-code)

[!INCLUDE[](~/includes/net-core-prereqs-vsc-5.0.md)]

# <a name="visual-studio-for-mac"></a>[<span data-ttu-id="45445-109">Visual Studio para Mac</span><span class="sxs-lookup"><span data-stu-id="45445-109">Visual Studio for Mac</span></span>](#tab/visual-studio-mac)

[!INCLUDE[](~/includes/net-core-prereqs-mac-5.0.md)]

---

## <a name="update-net-core-sdk-version-in-globaljson"></a><span data-ttu-id="45445-110">Atualizar a versão do SDK do .NET Core em global.json</span><span class="sxs-lookup"><span data-stu-id="45445-110">Update .NET Core SDK version in global.json</span></span>

<span data-ttu-id="45445-111">Se você confiar em um [global.jsno](/dotnet/core/tools/global-json) arquivo para direcionar uma versão específica do SDK do .NET Core, atualize a `version` propriedade para a versão do SDK do .NET 5,0 que está instalada.</span><span class="sxs-lookup"><span data-stu-id="45445-111">If you rely upon a [global.json](/dotnet/core/tools/global-json) file to target a specific .NET Core SDK version, update the `version` property to the .NET 5.0 SDK version that's installed.</span></span> <span data-ttu-id="45445-112">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="45445-112">For example:</span></span>

```diff
{
  "sdk": {
-    "version": "3.1.200"
+    "version": "5.0.100"
  }
}
```

## <a name="update-the-target-framework"></a><span data-ttu-id="45445-113">Atualizar a estrutura de destino</span><span class="sxs-lookup"><span data-stu-id="45445-113">Update the target framework</span></span>

<span data-ttu-id="45445-114">Se estiver atualizando um Blazor WebAssembly projeto, pule para a seção [Atualizar Blazor WebAssembly projetos](#update-blazor-webassembly-projects) .</span><span class="sxs-lookup"><span data-stu-id="45445-114">If updating a Blazor WebAssembly project, skip to the [Update Blazor WebAssembly projects](#update-blazor-webassembly-projects) section.</span></span> <span data-ttu-id="45445-115">Para qualquer outro tipo de projeto ASP.NET Core, atualize o moniker de estrutura de destino do arquivo de projeto [(TFM)](/dotnet/standard/frameworks) para `net5.0` :</span><span class="sxs-lookup"><span data-stu-id="45445-115">For any other ASP.NET Core project type, update the project file's [Target Framework Moniker (TFM)](/dotnet/standard/frameworks) to `net5.0`:</span></span>

```diff
<Project Sdk="Microsoft.NET.Sdk.Web">

  <PropertyGroup>
-    <TargetFramework>netcoreapp3.1</TargetFramework>
+    <TargetFramework>net5.0</TargetFramework>
  </PropertyGroup>

</Project>
```

## <a name="update-no-locblazor-webassembly-and-no-locblazor-server-projects"></a><span data-ttu-id="45445-116">Atualização Blazor WebAssembly e Blazor Server projetos</span><span class="sxs-lookup"><span data-stu-id="45445-116">Update Blazor WebAssembly and Blazor Server projects</span></span>

<span data-ttu-id="45445-117">*As diretrizes nesta seção se aplicam aos dois Blazor modelos de hospedagem. As seções a seguir nesta seção fornecem orientações adicionais específicas para hospedar modelos e tipos de aplicativos. Aplique o guidnace de todas as seções relevantes ao seu aplicativo.*</span><span class="sxs-lookup"><span data-stu-id="45445-117">*The guidance in this section applies to both Blazor hosting models. Sections following this section provide additional guidance specific to hosting models and app types. Apply the guidnace from all relevant sections to your app.*</span></span>

1. <span data-ttu-id="45445-118">Em `wwwroot/index.html` um Blazor WebAssembly aplicativo ou no `Pages/_Host.cshtml` de um Blazor Server aplicativo, adicione um `<link>` elemento ao `<head>` elemento para os estilos.</span><span class="sxs-lookup"><span data-stu-id="45445-118">In `wwwroot/index.html` of a Blazor WebAssembly app or the `Pages/_Host.cshtml` of a Blazor Server app, add a `<link>` element to the `<head>` element for styles.</span></span> <span data-ttu-id="45445-119">Nos seguintes `<link>` valores de atributo de elemento `href` , o espaço reservado `{ASSEMBLY NAME}` é o nome do assembly do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="45445-119">In the following `<link>` element `href` attribute values, the placeholder `{ASSEMBLY NAME}` is the app's assembly name.</span></span>

    ```diff
    +<link href="{ASSEMBLY NAME}.styles.css" rel="stylesheet" />
    ```
    
    <span data-ttu-id="45445-120">Blazor WebAssemblyExemplo autônomo:</span><span class="sxs-lookup"><span data-stu-id="45445-120">Standalone Blazor WebAssembly example:</span></span>
    
    ```diff
    +<link href="BlazorSample.styles.css" rel="stylesheet" />
    ```

    <span data-ttu-id="45445-121">*`Client`* projeto de um exemplo de solução hospedada Blazor WebAssembly :</span><span class="sxs-lookup"><span data-stu-id="45445-121">*`Client`* project of a hosted Blazor WebAssembly solution example:</span></span>
    
    ```diff
    +<link href="BlazorSample.Client.styles.css" rel="stylesheet" />
    ```

1. <span data-ttu-id="45445-122">No `Shared/MainLayout.razor` arquivo, coloque todo o conteúdo em um `<div>` elemento com um `class` de `page` :</span><span class="sxs-lookup"><span data-stu-id="45445-122">In the `Shared/MainLayout.razor` file, surround all of the content in a `<div>` element with an `class` of `page`:</span></span>

    ```razor
    <div class="page">
    
        ...
        
    </div>
    ```
    
1. <span data-ttu-id="45445-123">Adicione os seguintes arquivos à `Shared` pasta:</span><span class="sxs-lookup"><span data-stu-id="45445-123">Add the following files to the `Shared` folder:</span></span>

    <span data-ttu-id="45445-124">`MainLayout.razor.css`:</span><span class="sxs-lookup"><span data-stu-id="45445-124">`MainLayout.razor.css`:</span></span>
    
    ```css
    .page {
        position: relative;
        display: flex;
        flex-direction: column;
    }

    .main {
        flex: 1;
    }

    .sidebar {
        background-image: linear-gradient(180deg, rgb(5, 39, 103) 0%, #3a0647 70%);
    }

    .top-row {
        background-color: #f7f7f7;
        border-bottom: 1px solid #d6d5d5;
        justify-content: flex-end;
        height: 3.5rem;
        display: flex;
        align-items: center;
    }

        .top-row ::deep a, .top-row .btn-link {
            white-space: nowrap;
            margin-left: 1.5rem;
        }

        .top-row a:first-child {
            overflow: hidden;
            text-overflow: ellipsis;
        }

    @media (max-width: 767.98px) {
        .top-row:not(.auth) {
            display: none;
        }

        .top-row.auth {
            justify-content: space-between;
        }

        .top-row a, .top-row .btn-link {
            margin-left: 0;
        }
    }

    @media (min-width: 768px) {
        .page {
            flex-direction: row;
        }

        .sidebar {
            width: 250px;
            height: 100vh;
            position: sticky;
            top: 0;
        }

        .top-row {
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .main > div {
            padding-left: 2rem !important;
            padding-right: 1.5rem !important;
        }
    }
    ```
    
    <span data-ttu-id="45445-125">`NavMenu.razor.css`:</span><span class="sxs-lookup"><span data-stu-id="45445-125">`NavMenu.razor.css`:</span></span>
    
    ```css
    .navbar-toggler {
        background-color: rgba(255, 255, 255, 0.1);
    }

    .top-row {
        height: 3.5rem;
        background-color: rgba(0,0,0,0.4);
    }

    .navbar-brand {
        font-size: 1.1rem;
    }

    .oi {
        width: 2rem;
        font-size: 1.1rem;
        vertical-align: text-top;
        top: -2px;
    }

    .nav-item {
        font-size: 0.9rem;
        padding-bottom: 0.5rem;
    }

        .nav-item:first-of-type {
            padding-top: 1rem;
        }

        .nav-item:last-of-type {
            padding-bottom: 1rem;
        }

        .nav-item ::deep a {
            color: #d7d7d7;
            border-radius: 4px;
            height: 3rem;
            display: flex;
            align-items: center;
            line-height: 3rem;
        }

    .nav-item ::deep a.active {
        background-color: rgba(255,255,255,0.25);
        color: white;
    }

    .nav-item ::deep a:hover {
        background-color: rgba(255,255,255,0.1);
        color: white;
    }

    @media (min-width: 768px) {
        .navbar-toggler {
            display: none;
        }

        .collapse {
            /* Never collapse the sidebar for wide screens */
            display: block;
        }
    }
    ```

1. <span data-ttu-id="45445-126">O arquivo base mais recente `wwwroot/css/app.css` de um Blazor WebAssembly aplicativo ou `wwwroot/css/site.css` arquivo de um Blazor Server aplicativo inclui os seguintes estilos.</span><span class="sxs-lookup"><span data-stu-id="45445-126">The latest base `wwwroot/css/app.css` file of a Blazor WebAssembly app or `wwwroot/css/site.css` file of a Blazor Server app includes the following styles.</span></span> <span data-ttu-id="45445-127">Remova os estilos extras, deixando os estilos a seguir e os que você adicionou ao aplicativo.</span><span class="sxs-lookup"><span data-stu-id="45445-127">Remove extra styles leaving the following styles and any that you've added to the app.</span></span>

    <span data-ttu-id="45445-128">A seguinte folha de estilo inclui apenas estilos base e **não inclui estilos** personalizados adicionados pelo desenvolvedor:</span><span class="sxs-lookup"><span data-stu-id="45445-128">The following stylesheet only includes base styles and does **not** include custom styles added by the developer:</span></span>
   
    ```css
    @import url('open-iconic/font/css/open-iconic-bootstrap.min.css');

    html, body {
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    }

    a, .btn-link {
        color: #0366d6;
    }

    .btn-primary {
        color: #fff;
        background-color: #1b6ec2;
        border-color: #1861ac;
    }

    .content {
        padding-top: 1.1rem;
    }

    .valid.modified:not([type=checkbox]) {
        outline: 1px solid #26b050;
    }

    .invalid {
        outline: 1px solid red;
    }

    .validation-message {
        color: red;
    }

    #blazor-error-ui {
        background: lightyellow;
        bottom: 0;
        box-shadow: 0 -1px 2px rgba(0, 0, 0, 0.2);
        display: none;
        left: 0;
        padding: 0.6rem 1.25rem 0.7rem 1.25rem;
        position: fixed;
        width: 100%;
        z-index: 1000;
    }

    #blazor-error-ui .dismiss {
        cursor: pointer;
        position: absolute;
        right: 0.75rem;
        top: 0.5rem;
    }
    ```

## <a name="update-no-locblazor-webassembly-projects"></a><span data-ttu-id="45445-129">Atualizar Blazor WebAssembly projetos</span><span class="sxs-lookup"><span data-stu-id="45445-129">Update Blazor WebAssembly projects</span></span>

<span data-ttu-id="45445-130">Para um Blazor WebAssembly projeto do, incluindo o *`Client`* projeto de uma Blazor solução hospedada, aplique as seguintes alterações ao arquivo de projeto:</span><span class="sxs-lookup"><span data-stu-id="45445-130">For a Blazor WebAssembly project, including the *`Client`* project of a hosted Blazor solution, apply the following changes to the project file:</span></span>

1. <span data-ttu-id="45445-131">Atualize o SDK de `Microsoft.NET.Sdk.Web` para `Microsoft.NET.Sdk.BlazorWebAssembly` :</span><span class="sxs-lookup"><span data-stu-id="45445-131">Update the SDK from `Microsoft.NET.Sdk.Web` to `Microsoft.NET.Sdk.BlazorWebAssembly`:</span></span>

    ```diff
    - <Project Sdk="Microsoft.NET.Sdk.Web">
    + <Project Sdk="Microsoft.NET.Sdk.BlazorWebAssembly">
    ```
    
    > [!NOTE]
    > <span data-ttu-id="45445-132">Essa atualização se aplica somente a Blazor WebAssembly projetos autônomos e a *`Client`* projetos de soluções hospedadas Blazor .</span><span class="sxs-lookup"><span data-stu-id="45445-132">This update only applies to standalone Blazor WebAssembly projects and the *`Client`* projects of hosted Blazor solutions.</span></span>

1. <span data-ttu-id="45445-133">Atualize as seguintes propriedades:</span><span class="sxs-lookup"><span data-stu-id="45445-133">Update the following properties:</span></span>

    ```diff
    <Project Sdk="Microsoft.NET.Sdk.BlazorWebAssembly">
    
      <PropertyGroup>
    -     <TargetFramework>netstandard2.1</TargetFramework>
    -     <RazorLangVersion>3.0</RazorLangVersion>
    +     <TargetFramework>net5.0</TargetFramework>
      </PropertyGroup>
    ```

1. <span data-ttu-id="45445-134">Remova a referência de pacote para [Microsoft. AspNetCore. Components. Webassembly. Build](https://www.nuget.org/packages/Microsoft.AspNetCore.Components.WebAssembly.Build):</span><span class="sxs-lookup"><span data-stu-id="45445-134">Remove the package reference to [Microsoft.AspNetCore.Components.WebAssembly.Build](https://www.nuget.org/packages/Microsoft.AspNetCore.Components.WebAssembly.Build):</span></span>

    ```diff
    <ItemGroup>
    -    <PackageReference Include="Microsoft.AspNetCore.Components.WebAssembly.Build" Version="3.2.1" PrivateAssets="all" />
    ```

1. <span data-ttu-id="45445-135">Atualize outros pacotes para suas versões mais recentes.</span><span class="sxs-lookup"><span data-stu-id="45445-135">Update other packages to their latest versions.</span></span> <span data-ttu-id="45445-136">As versões mais recentes podem ser encontradas em [NuGet.org](https://www.nuget.org).</span><span class="sxs-lookup"><span data-stu-id="45445-136">The latest versions can be found at [NuGet.org](https://www.nuget.org).</span></span>

1. <span data-ttu-id="45445-137">No `wwwroot/index.html` , altere o elemento que carrega o `App` componente:</span><span class="sxs-lookup"><span data-stu-id="45445-137">In `wwwroot/index.html`, change the element that loads the `App` component:</span></span>
    
    ```diff
    -<app>Loading...</app>
    +<app id="app">Loading...</app>
    ```
    
1. <span data-ttu-id="45445-138">Em `Program.Main`:</span><span class="sxs-lookup"><span data-stu-id="45445-138">In `Program.Main`:</span></span>

   * <span data-ttu-id="45445-139">Altere a referência ao `<app>` elemento para um seletor de CSS adicionando um hash `#` a ele.</span><span class="sxs-lookup"><span data-stu-id="45445-139">Change the reference to the `<app>` element to a CSS selector by adding a hash `#` to it.</span></span>
   * <span data-ttu-id="45445-140">Altere o `HttpClient` registro para escopo.</span><span class="sxs-lookup"><span data-stu-id="45445-140">Change the `HttpClient` registration to scoped.</span></span>

    ```diff
    -builder.RootComponents.Add<App>("app");
    +builder.RootComponents.Add<App>("#app");
    
    -builder.Services.AddTransient(sp => new HttpClient 
    -    { BaseAddress = new Uri(builder.HostEnvironment.BaseAddress) });
    +builder.Services.AddScoped(sp => new HttpClient 
    +    { BaseAddress = new Uri(builder.HostEnvironment.BaseAddress) });
    ```

### <a name="standalone-no-locblazor-webassembly-app-with-microsoft-accounts"></a><span data-ttu-id="45445-141">Blazor WebAssemblyAplicativo autônomo com contas da Microsoft</span><span class="sxs-lookup"><span data-stu-id="45445-141">Standalone Blazor WebAssembly app with Microsoft Accounts</span></span>

<span data-ttu-id="45445-142">Para um Blazor WebAssembly aplicativo autônomo registrado no portal do Azure usar Azure Active Directory (AAD) para contas da Microsoft:</span><span class="sxs-lookup"><span data-stu-id="45445-142">For a standalone Blazor WebAssembly app registered in the Azure portal to use Azure Active Directory (AAD) for Microsoft Accounts:</span></span>

* <span data-ttu-id="45445-143">O aplicativo requer os `openid` `offline_access` escopos e:</span><span class="sxs-lookup"><span data-stu-id="45445-143">The app requires the `openid` and `offline_access` scopes:</span></span>

  ```csharp
  options.ProviderOptions.DefaultAccessTokenScopes.Add("openid");
  options.ProviderOptions.DefaultAccessTokenScopes.Add("offline_access");
  ```
  
* <span data-ttu-id="45445-144">Na folha **autenticação** de registro do aplicativo portal do Azure, defina a configuração da plataforma como **aplicativo de página única** com o URI de redirecionamento do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="45445-144">In the Azure portal app registration **Authentication** blade, set the platform configuration to **Single-page application** with the app's redirect URI.</span></span>

* <span data-ttu-id="45445-145">Também na folha **autenticação** , desabilite a **concessão implícita** para **tokens de acesso** e **tokens de ID**.</span><span class="sxs-lookup"><span data-stu-id="45445-145">Also in the **Authentication** blade, disable **Implicit grant** for **Access tokens** and **ID tokens**.</span></span>

<span data-ttu-id="45445-146">Para obter mais informações, consulte <xref:blazor/security/webassembly/standalone-with-microsoft-accounts>.</span><span class="sxs-lookup"><span data-stu-id="45445-146">For more information, see <xref:blazor/security/webassembly/standalone-with-microsoft-accounts>.</span></span>

### <a name="standalone-no-locblazor-webassembly-app-with-azure-active-directory-aad"></a><span data-ttu-id="45445-147">Blazor WebAssemblyAplicativo autônomo com Azure Active Directory (AAD)</span><span class="sxs-lookup"><span data-stu-id="45445-147">Standalone Blazor WebAssembly app with Azure Active Directory (AAD)</span></span>

<span data-ttu-id="45445-148">Para um Blazor WebAssembly aplicativo autônomo registrado no portal do Azure usar Azure Active Directory (AAD):</span><span class="sxs-lookup"><span data-stu-id="45445-148">For a standalone Blazor WebAssembly app registered in the Azure portal to use Azure Active Directory (AAD):</span></span>

* <span data-ttu-id="45445-149">O aplicativo requer o `https://graph.microsoft.com/User.Read` escopo:</span><span class="sxs-lookup"><span data-stu-id="45445-149">The app requires the `https://graph.microsoft.com/User.Read` scope:</span></span>

  ```csharp
  options.ProviderOptions.DefaultAccessTokenScopes
      .Add("https://graph.microsoft.com/User.Read");
  ```
  
* <span data-ttu-id="45445-150">Na folha **autenticação** de registro do aplicativo portal do Azure, defina a configuração da plataforma como **aplicativo de página única** com o URI de redirecionamento do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="45445-150">In the Azure portal app registration **Authentication** blade, set the platform configuration to **Single-page application** with the app's redirect URI.</span></span>

* <span data-ttu-id="45445-151">Também na folha **autenticação** , desabilite a **concessão implícita** para **tokens de acesso** e **tokens de ID**.</span><span class="sxs-lookup"><span data-stu-id="45445-151">Also in the **Authentication** blade, disable **Implicit grant** for **Access tokens** and **ID tokens**.</span></span>
  
<span data-ttu-id="45445-152">Para obter mais informações, consulte <xref:blazor/security/webassembly/standalone-with-azure-active-directory>.</span><span class="sxs-lookup"><span data-stu-id="45445-152">For more information, see <xref:blazor/security/webassembly/standalone-with-azure-active-directory>.</span></span>

### <a name="standalone-no-locblazor-app-with-azure-active-directory-aad-b2c"></a><span data-ttu-id="45445-153">BlazorAplicativo autônomo com Azure Active Directory (AAD) B2C</span><span class="sxs-lookup"><span data-stu-id="45445-153">Standalone Blazor app with Azure Active Directory (AAD) B2C</span></span>

<span data-ttu-id="45445-154">Para um Blazor WebAssembly aplicativo autônomo registrado no portal do Azure usar Azure Active Directory (AAD) B2C:</span><span class="sxs-lookup"><span data-stu-id="45445-154">For a standalone Blazor WebAssembly app registered in the Azure portal to use Azure Active Directory (AAD) B2C:</span></span>

* <span data-ttu-id="45445-155">O aplicativo requer os `openid` `offline_access` escopos e:</span><span class="sxs-lookup"><span data-stu-id="45445-155">The app requires the `openid` and `offline_access` scopes:</span></span>

  ```csharp
  options.ProviderOptions.DefaultAccessTokenScopes.Add("openid");
  options.ProviderOptions.DefaultAccessTokenScopes.Add("offline_access");
  ```
  
* <span data-ttu-id="45445-156">Na folha **autenticação** de registro do aplicativo portal do Azure, defina a configuração da plataforma como **aplicativo de página única** com o URI de redirecionamento do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="45445-156">In the Azure portal app registration **Authentication** blade, set the platform configuration to **Single-page application** with the app's redirect URI.</span></span>

* <span data-ttu-id="45445-157">Também na folha **autenticação** , desabilite a **concessão implícita** para **tokens de acesso** e **tokens de ID**.</span><span class="sxs-lookup"><span data-stu-id="45445-157">Also in the **Authentication** blade, disable **Implicit grant** for **Access tokens** and **ID tokens**.</span></span>

<span data-ttu-id="45445-158">Para obter mais informações, consulte <xref:blazor/security/webassembly/standalone-with-azure-active-directory-b2c>.</span><span class="sxs-lookup"><span data-stu-id="45445-158">For more information, see <xref:blazor/security/webassembly/standalone-with-azure-active-directory-b2c>.</span></span>

### <a name="hosted-no-locblazor-webassembly-app-with-azure-active-directory-aad-or-b2c"></a><span data-ttu-id="45445-159">Blazor WebAssemblyAplicativo hospedado com Azure Active Directory (AAD) ou B2C</span><span class="sxs-lookup"><span data-stu-id="45445-159">Hosted Blazor WebAssembly app with Azure Active Directory (AAD) or B2C</span></span>

<span data-ttu-id="45445-160">O *`Client`* registro de aplicativo de uma Blazor solução hospedada que usa o AAD ou o AAD B2C para autenticação de usuário deve usar uma configuração de plataforma de aplicativos do Azure de **página única** :</span><span class="sxs-lookup"><span data-stu-id="45445-160">The *`Client`* app registration of a hosted Blazor solution that uses AAD or AAD B2C for user authentication should use a **Single-page application** Azure Apps platform configuration:</span></span>

1. <span data-ttu-id="45445-161">No registro do aplicativo portal do Azure para o *`Client`* aplicativo, remova a configuração **da plataforma Web** .</span><span class="sxs-lookup"><span data-stu-id="45445-161">In the Azure portal app registration for the *`Client`* app, remove the **Web** platform configuration.</span></span>
1. <span data-ttu-id="45445-162">Adicione uma configuração de plataforma de **aplicativo de página única** com o URI de redirecionamento do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="45445-162">Add a **Single-page application** platform configuration with the app's redirect URI.</span></span>
1. <span data-ttu-id="45445-163">Desabilite a **concessão implícita** para **tokens de acesso** e **tokens de ID**.</span><span class="sxs-lookup"><span data-stu-id="45445-163">Disable **Implicit grant** for **Access tokens** and **ID tokens**.</span></span>

<span data-ttu-id="45445-164">Para obter mais informações, consulte:</span><span class="sxs-lookup"><span data-stu-id="45445-164">For more information, see:</span></span>

* <xref:blazor/security/webassembly/hosted-with-azure-active-directory>
* <xref:blazor/security/webassembly/hosted-with-azure-active-directory-b2c>

### <a name="update-the-server-project-of-a-hosted-no-locblazor-solution"></a><span data-ttu-id="45445-165">Atualizar o projeto de servidor de uma Blazor solução hospedada</span><span class="sxs-lookup"><span data-stu-id="45445-165">Update the Server project of a hosted Blazor solution</span></span>

<span data-ttu-id="45445-166">Atualize o *`Server`* projeto de uma solução hospedada Blazor como um aplicativo ASP.NET Core seguindo as diretrizes gerais neste artigo.</span><span class="sxs-lookup"><span data-stu-id="45445-166">Update the *`Server`* project of a hosted Blazor solution as an ASP.NET Core app following the general guidance in this article.</span></span>

<span data-ttu-id="45445-167">Além disso, *`Server`* os projetos que autenticam usuários em Blazor WebAssembly aplicativos cliente com Azure Active Directory (AAD) ou B2C devem adotar novos pacotes do Microsoft Identity v 2.0:</span><span class="sxs-lookup"><span data-stu-id="45445-167">Additionally, *`Server`* projects that authenticate users to client Blazor WebAssembly apps with Azure Active Directory (AAD) or B2C should adopt new Microsoft Identity v2.0 packages:</span></span> 
  
<span data-ttu-id="45445-168">Para o AAD:</span><span class="sxs-lookup"><span data-stu-id="45445-168">For AAD:</span></span>

```diff
-<PackageReference Include="Microsoft.AspNetCore.Authentication.AzureAD.UI" Version="..." />
+<PackageReference Include="Microsoft.Identity.Web" Version="1.2.0" />
+<PackageReference Include="Microsoft.Identity.Web.UI" Version="1.2.0" />
```

<span data-ttu-id="45445-169">Por AAD B2C:</span><span class="sxs-lookup"><span data-stu-id="45445-169">For AAD B2C:</span></span>

```diff
-<PackageReference Include="Microsoft.AspNetCore.Authentication.AzureADB2C.UI" Version="..." />
+<PackageReference Include="Microsoft.Identity.Web" Version="1.2.0" />
+<PackageReference Include="Microsoft.Identity.Web.UI" Version="1.2.0" />
```

> [!NOTE]
> <span data-ttu-id="45445-170">O SDK do *`Server`* projeto em uma solução hospedada Blazor WebAssembly permanece `Microsoft.NET.Sdk.Web` :</span><span class="sxs-lookup"><span data-stu-id="45445-170">The SDK of the *`Server`* project in a hosted Blazor WebAssembly solution remains `Microsoft.NET.Sdk.Web`:</span></span>
>
> ```xml
> <Project Sdk="Microsoft.NET.Sdk.Web">
> ```

<span data-ttu-id="45445-171">Para obter mais informações, consulte:</span><span class="sxs-lookup"><span data-stu-id="45445-171">For more information, see:</span></span>

* <xref:blazor/security/webassembly/hosted-with-azure-active-directory>
* <xref:blazor/security/webassembly/hosted-with-azure-active-directory-b2c>

### <a name="unauthorized-client-for-azure-active-directory-aad"></a><span data-ttu-id="45445-172">Cliente não autorizado para Azure Active Directory (AAD)</span><span class="sxs-lookup"><span data-stu-id="45445-172">Unauthorized client for Azure Active Directory (AAD)</span></span>

<span data-ttu-id="45445-173">Depois de atualizar um Blazor WebAssembly aplicativo que usa o AAD para autenticação, você poderá receber o seguinte erro no retorno de chamada de logon para o aplicativo depois que o usuário entrar com o AAD:</span><span class="sxs-lookup"><span data-stu-id="45445-173">After upgrading a Blazor WebAssembly app that uses AAD for authentication, you may receive the following error on the login callback to the app after the user signs in with AAD:</span></span>

> <span data-ttu-id="45445-174">info: falha na autorização de Microsoft. AspNetCore. Authorization. DefaultAuthorizationService [2].</span><span class="sxs-lookup"><span data-stu-id="45445-174">info: Microsoft.AspNetCore.Authorization.DefaultAuthorizationService[2] Authorization failed.</span></span> <span data-ttu-id="45445-175">Esses requisitos não foram atendidos: DenyAnonymousAuthorizationRequirement: requer um usuário autenticado.</span><span class="sxs-lookup"><span data-stu-id="45445-175">These requirements were not met: DenyAnonymousAuthorizationRequirement: Requires an authenticated user.</span></span>

<span data-ttu-id="45445-176">Erro de retorno de chamada de logon do AAD:</span><span class="sxs-lookup"><span data-stu-id="45445-176">Login callback error from AAD:</span></span>

* <span data-ttu-id="45445-177">Erro: `unauthorized_client`</span><span class="sxs-lookup"><span data-stu-id="45445-177">Error: `unauthorized_client`</span></span>
* <span data-ttu-id="45445-178">Descrição: `AADB2C90058: The provided application is not configured to allow public clients.`</span><span class="sxs-lookup"><span data-stu-id="45445-178">Description: `AADB2C90058: The provided application is not configured to allow public clients.`</span></span>

<span data-ttu-id="45445-179">Para resolver o erro:</span><span class="sxs-lookup"><span data-stu-id="45445-179">To resolve the error:</span></span>

1. <span data-ttu-id="45445-180">No portal do Azure, acesse o [manifesto do aplicativo](/azure/active-directory/develop/reference-app-manifest).</span><span class="sxs-lookup"><span data-stu-id="45445-180">In the Azure portal, access the [app's manifest](/azure/active-directory/develop/reference-app-manifest).</span></span>
1. <span data-ttu-id="45445-181">Defina o [`allowPublicClient`](/azure/active-directory/develop/reference-app-manifest#allowpublicclient-attribute) atributo como `null` ou `true` .</span><span class="sxs-lookup"><span data-stu-id="45445-181">Set the [`allowPublicClient`](/azure/active-directory/develop/reference-app-manifest#allowpublicclient-attribute) attribute to `null` or `true`.</span></span>

## <a name="update-no-locrazor-class-libraries-rcls"></a><span data-ttu-id="45445-182">Atualizar Razor bibliotecas de classes (RCLs)</span><span class="sxs-lookup"><span data-stu-id="45445-182">Update Razor class libraries (RCLs)</span></span>

<span data-ttu-id="45445-183">Migre Razor bibliotecas de classes (RCLs) para aproveitar as novas APIs ou recursos que são introduzidos como parte do ASP.NET Core 5,0.</span><span class="sxs-lookup"><span data-stu-id="45445-183">Migrate Razor class libraries (RCLs) to take advantage of new APIs or features that are introduced as part of ASP.NET Core 5.0.</span></span> 

<span data-ttu-id="45445-184">Para atualizar um RCL que tem como alvo os componentes:</span><span class="sxs-lookup"><span data-stu-id="45445-184">To update a RCL that targets components:</span></span>

1. <span data-ttu-id="45445-185">Atualize as seguintes propriedades no arquivo de projeto:</span><span class="sxs-lookup"><span data-stu-id="45445-185">Update the following properties in the project file:</span></span>

   ```diff
   <Project Sdk="Microsoft.NET.Sdk.Razor">
    
     <PropertyGroup>
   -     <TargetFramework>netstandard2.0</TargetFramework>
   -     <RazorLangVersion>3.0</RazorLangVersion>
   +     <TargetFramework>net5.0</TargetFramework>
     </PropertyGroup>
   ```

1. <span data-ttu-id="45445-186">Atualize outros pacotes para suas versões mais recentes.</span><span class="sxs-lookup"><span data-stu-id="45445-186">Update other packages to their latest versions.</span></span> <span data-ttu-id="45445-187">As versões mais recentes podem ser encontradas em [NuGet.org](https://www.nuget.org).</span><span class="sxs-lookup"><span data-stu-id="45445-187">The latest versions can be found at [NuGet.org](https://www.nuget.org).</span></span>

<span data-ttu-id="45445-188">Para atualizar um RCL de destino MVC, atualize as seguintes propriedades no arquivo de projeto:</span><span class="sxs-lookup"><span data-stu-id="45445-188">To update an RCL targeting MVC, update the following properties in the project file:</span></span>

```diff
<Project Sdk="Microsoft.NET.Sdk.Razor">

  <PropertyGroup>
-    <TargetFramework>netcoreapp3.1</TargetFramework>
+    <TargetFramework>net5.0</TargetFramework>
    <AddRazorSupportForMvc>true</AddRazorSupportForMvc>
  </PropertyGroup>
```

## <a name="update-package-references"></a><span data-ttu-id="45445-189">Referências do pacote de atualização</span><span class="sxs-lookup"><span data-stu-id="45445-189">Update package references</span></span>

<span data-ttu-id="45445-190">No arquivo de projeto, atualize cada [Microsoft. AspNetCore. \*](https://www.nuget.org/packages?q=Microsoft.AspNetCore.*), [Microsoft. EntityFrameworkCore. \*](https://www.nuget.org/packages?q=Microsoft.EntityFrameworkCore.*), [Microsoft. Extensions. \*](https://www.nuget.org/packages?q=Microsoft.Extensions.*)e [System.Net.Http.Jsno](https://www.nuget.org/packages/System.Net.Http.Json) atributo de referência do pacote `Version` como 5.0.0 ou posterior.</span><span class="sxs-lookup"><span data-stu-id="45445-190">In the project file, update each [Microsoft.AspNetCore.\*](https://www.nuget.org/packages?q=Microsoft.AspNetCore.*), [Microsoft.EntityFrameworkCore.\*](https://www.nuget.org/packages?q=Microsoft.EntityFrameworkCore.*), [Microsoft.Extensions.\*](https://www.nuget.org/packages?q=Microsoft.Extensions.*), and [System.Net.Http.Json](https://www.nuget.org/packages/System.Net.Http.Json) package reference's `Version` attribute to 5.0.0 or later.</span></span> <span data-ttu-id="45445-191">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="45445-191">For example:</span></span>

```diff
<ItemGroup>
-    <PackageReference Include="Microsoft.AspNetCore.JsonPatch" Version="3.1.6" />
-    <PackageReference Include="Microsoft.EntityFrameworkCore.Tools" Version="3.1.6">
-    <PackageReference Include="Microsoft.Extensions.Caching.Abstractions" Version="3.1.6" />
-    <PackageReference Include="System.Net.Http.Json" Version="3.2.1" />
+    <PackageReference Include="Microsoft.AspNetCore.JsonPatch" Version="5.0.0" />
+    <PackageReference Include="Microsoft.EntityFrameworkCore.Tools" Version="5.0.0">
+    <PackageReference Include="Microsoft.Extensions.Caching.Abstractions" Version="5.0.0" />
+    <PackageReference Include="System.Net.Http.Json" Version="5.0.0" />
</ItemGroup>
```

## <a name="update-docker-images"></a><span data-ttu-id="45445-192">Atualizar imagens do Docker</span><span class="sxs-lookup"><span data-stu-id="45445-192">Update Docker images</span></span>

<span data-ttu-id="45445-193">Para aplicativos que usam o Docker, *Dockerfile* atualize suas `FROM` instruções e scripts do Dockerfile.</span><span class="sxs-lookup"><span data-stu-id="45445-193">For apps using Docker, update your *Dockerfile* `FROM` statements and scripts.</span></span> <span data-ttu-id="45445-194">Use uma imagem base que inclua o tempo de execução do ASP.NET Core 5,0.</span><span class="sxs-lookup"><span data-stu-id="45445-194">Use a base image that includes the ASP.NET Core 5.0 runtime.</span></span> <span data-ttu-id="45445-195">Considere a seguinte `docker pull` diferença de comando entre ASP.NET Core 3,1 e 5,0:</span><span class="sxs-lookup"><span data-stu-id="45445-195">Consider the following `docker pull` command difference between ASP.NET Core 3.1 and 5.0:</span></span>

```diff
- docker pull mcr.microsoft.com/dotnet/core/aspnet:3.1
+ docker pull mcr.microsoft.com/dotnet/aspnet:5.0
```

<span data-ttu-id="45445-196">Como parte da mudança para ".NET" como o nome do produto, as imagens do Docker foram movidas dos `mcr.microsoft.com/dotnet/core` repositórios para `mcr.microsoft.com/dotnet` .</span><span class="sxs-lookup"><span data-stu-id="45445-196">As part of the move to ".NET" as the product name, the Docker images moved from the `mcr.microsoft.com/dotnet/core` repositories to `mcr.microsoft.com/dotnet`.</span></span> <span data-ttu-id="45445-197">Para obter mais informações, consulte [dotnet/dotnet-Docker # 1939](https://github.com/dotnet/dotnet-docker/issues/1939).</span><span class="sxs-lookup"><span data-stu-id="45445-197">For more information, see [dotnet/dotnet-docker#1939](https://github.com/dotnet/dotnet-docker/issues/1939).</span></span>

## <a name="model-binding-changes-in-aspnet-core-mvc-and-no-locrazor-pages"></a><span data-ttu-id="45445-198">Alterações de associação de modelo em ASP.NET Core MVC e Razor páginas</span><span class="sxs-lookup"><span data-stu-id="45445-198">Model binding changes in ASP.NET Core MVC and Razor Pages</span></span>

### <a name="datetime-values-are-model-bound-as-utc-times"></a><span data-ttu-id="45445-199">Os valores de data e hora são associados ao modelo como horários UTC</span><span class="sxs-lookup"><span data-stu-id="45445-199">DateTime values are model bound as UTC times</span></span>

<span data-ttu-id="45445-200">No ASP.NET Core 3,1 e anteriores, os `DateTime` valores eram associados ao modelo como hora local, em que o fuso horário foi determinado pelo servidor.</span><span class="sxs-lookup"><span data-stu-id="45445-200">In ASP.NET Core 3.1 and earlier, `DateTime` values were model-bound as local time, where the timezone was determined by the server.</span></span> <span data-ttu-id="45445-201">`DateTime` valores associados da formatação de entrada (JSON) e `DateTimeOffset` valores foram associados como fusos UTC.</span><span class="sxs-lookup"><span data-stu-id="45445-201">`DateTime` values bound from input formatting (JSON) and `DateTimeOffset` values were bound as UTC timezones.</span></span>

<span data-ttu-id="45445-202">No ASP.NET Core 5,0 e posterior, a associação de modelo associa `DateTime` valores consistentemente com o fuso horário UTC.</span><span class="sxs-lookup"><span data-stu-id="45445-202">In ASP.NET Core 5.0 and later, model binding consistently binds `DateTime` values with the UTC timezone.</span></span>

<span data-ttu-id="45445-203">Para manter o comportamento anterior, remova o `DateTimeModelBinderProvider` em `Startup.ConfigureServices` :</span><span class="sxs-lookup"><span data-stu-id="45445-203">To retain the previous behavior, remove the `DateTimeModelBinderProvider` in `Startup.ConfigureServices`:</span></span>

```csharp
services.AddControllersWithViews(options => 
    options.ModelBinderProviders.RemoveType<DateTimeModelBinderProvider>());
```

### <a name="complexobjectmodelbinderprovider--complexobjectmodelbinder-replace-complextypemodelbinderprovider--complextypemodelbinder"></a><span data-ttu-id="45445-204">ComplexObjectModelBinderProvider \ ComplexObjectModelBinder substituir ComplexTypeModelBinderProvider \ ComplexTypeModelBinder</span><span class="sxs-lookup"><span data-stu-id="45445-204">ComplexObjectModelBinderProvider \ ComplexObjectModelBinder replace ComplexTypeModelBinderProvider \ ComplexTypeModelBinder</span></span>

<span data-ttu-id="45445-205">Para adicionar suporte para tipos de [registro do C# 9](/dotnet/csharp/whats-new/csharp-9#record-types)de associação de modelos, o <xref:Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexTypeModelBinderProvider> é:</span><span class="sxs-lookup"><span data-stu-id="45445-205">To add support for model binding [C# 9 record types](/dotnet/csharp/whats-new/csharp-9#record-types), the <xref:Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexTypeModelBinderProvider> is:</span></span>

* <span data-ttu-id="45445-206">Anotado como obsoleto.</span><span class="sxs-lookup"><span data-stu-id="45445-206">Annotated as obsolete.</span></span>
* <span data-ttu-id="45445-207">Não é mais registrado por padrão.</span><span class="sxs-lookup"><span data-stu-id="45445-207">No longer registered by default.</span></span>

<span data-ttu-id="45445-208">Os aplicativos que dependem da presença do `ComplexTypeModelBinderProvider` na `ModelBinderProviders` coleção precisam referenciar o novo provedor de fichário:</span><span class="sxs-lookup"><span data-stu-id="45445-208">Apps that rely on the presence of the `ComplexTypeModelBinderProvider` in the `ModelBinderProviders` collection need to reference the new binder provider:</span></span>

```diff
- var complexModelBinderProvider = options.ModelBinderProviders.OfType<ComplexTypeModelBinderProvider>();
+ var complexModelBinderProvider = options.ModelBinderProviders.OfType<ComplexObjectModelBinderProvider>();
```

## <a name="review-breaking-changes"></a><span data-ttu-id="45445-209">Revisar alterações recentes</span><span class="sxs-lookup"><span data-stu-id="45445-209">Review breaking changes</span></span>

<span data-ttu-id="45445-210">Para alterações significativas do .NET Core 3,1 para o .NET 5,0, consulte [alterações recentes para a migração da versão 3,1 para a 5,0](/dotnet/core/compatibility/3.1-5.0).</span><span class="sxs-lookup"><span data-stu-id="45445-210">For breaking changes from .NET Core 3.1 to .NET 5.0, see [Breaking changes for migration from version 3.1 to 5.0](/dotnet/core/compatibility/3.1-5.0).</span></span> <span data-ttu-id="45445-211">ASP.NET Core e Entity Framework Core também estão incluídos na lista.</span><span class="sxs-lookup"><span data-stu-id="45445-211">ASP.NET Core and Entity Framework Core are also included in the list.</span></span>
