---
title: Migrar do ASP.NET Core 3,1 para 5,0
author: scottaddie
description: Saiba como migrar um projeto ASP.NET Core 3,1 para ASP.NET Core 5,0.
ms.author: scaddie
ms.custom: mvc
ms.date: 12/02/2020
no-loc:
- appsettings.json
- ASP.NET Core Identity
- cookie
- Cookie
- Blazor
- Blazor Server
- Blazor WebAssembly
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: migration/31-to-50
ms.openlocfilehash: 60e36f031208c9a19655813c97830fe5a055c394
ms.sourcegitcommit: 8b0e9a72c1599ce21830c843558a661ba908ce32
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/08/2021
ms.locfileid: "98024763"
---
# <a name="migrate-from-aspnet-core-31-to-50"></a><span data-ttu-id="c9688-103">Migrar do ASP.NET Core 3,1 para 5,0</span><span class="sxs-lookup"><span data-stu-id="c9688-103">Migrate from ASP.NET Core 3.1 to 5.0</span></span>

<span data-ttu-id="c9688-104">Por [Scott Addie](https://github.com/scottaddie)</span><span class="sxs-lookup"><span data-stu-id="c9688-104">By [Scott Addie](https://github.com/scottaddie)</span></span>

<span data-ttu-id="c9688-105">Este artigo explica como atualizar um projeto existente do ASP.NET Core 3,1 para ASP.NET Core 5,0.</span><span class="sxs-lookup"><span data-stu-id="c9688-105">This article explains how to update an existing ASP.NET Core 3.1 project to ASP.NET Core 5.0.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="c9688-106">Pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="c9688-106">Prerequisites</span></span>

# <a name="visual-studio"></a>[<span data-ttu-id="c9688-107">Visual Studio</span><span class="sxs-lookup"><span data-stu-id="c9688-107">Visual Studio</span></span>](#tab/visual-studio)

[!INCLUDE[](~/includes/net-core-prereqs-vs-5.0.md)]

# <a name="visual-studio-code"></a>[<span data-ttu-id="c9688-108">Visual Studio Code</span><span class="sxs-lookup"><span data-stu-id="c9688-108">Visual Studio Code</span></span>](#tab/visual-studio-code)

[!INCLUDE[](~/includes/net-core-prereqs-vsc-5.0.md)]

# <a name="visual-studio-for-mac"></a>[<span data-ttu-id="c9688-109">Visual Studio para Mac</span><span class="sxs-lookup"><span data-stu-id="c9688-109">Visual Studio for Mac</span></span>](#tab/visual-studio-mac)

[!INCLUDE[](~/includes/net-core-prereqs-mac-5.0.md)]

---

## <a name="update-net-core-sdk-version-in-globaljson"></a><span data-ttu-id="c9688-110">Atualizar a versão do SDK do .NET Core em global.json</span><span class="sxs-lookup"><span data-stu-id="c9688-110">Update .NET Core SDK version in global.json</span></span>

<span data-ttu-id="c9688-111">Se você confiar em um [global.jsno](/dotnet/core/tools/global-json) arquivo para direcionar uma versão específica do SDK do .NET Core, atualize a `version` propriedade para a versão do SDK do .NET 5,0 que está instalada.</span><span class="sxs-lookup"><span data-stu-id="c9688-111">If you rely upon a [global.json](/dotnet/core/tools/global-json) file to target a specific .NET Core SDK version, update the `version` property to the .NET 5.0 SDK version that's installed.</span></span> <span data-ttu-id="c9688-112">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="c9688-112">For example:</span></span>

```diff
{
  "sdk": {
-    "version": "3.1.200"
+    "version": "5.0.100"
  }
}
```

## <a name="update-the-target-framework"></a><span data-ttu-id="c9688-113">Atualizar a estrutura de destino</span><span class="sxs-lookup"><span data-stu-id="c9688-113">Update the target framework</span></span>

<span data-ttu-id="c9688-114">Se estiver atualizando um Blazor WebAssembly projeto, pule para a seção [Atualizar Blazor WebAssembly projetos](#update-blazor-webassembly-projects) .</span><span class="sxs-lookup"><span data-stu-id="c9688-114">If updating a Blazor WebAssembly project, skip to the [Update Blazor WebAssembly projects](#update-blazor-webassembly-projects) section.</span></span> <span data-ttu-id="c9688-115">Para qualquer outro tipo de projeto ASP.NET Core, atualize o moniker de estrutura de destino do arquivo de projeto [(TFM)](/dotnet/standard/frameworks) para `net5.0` :</span><span class="sxs-lookup"><span data-stu-id="c9688-115">For any other ASP.NET Core project type, update the project file's [Target Framework Moniker (TFM)](/dotnet/standard/frameworks) to `net5.0`:</span></span>

```diff
<Project Sdk="Microsoft.NET.Sdk.Web">

  <PropertyGroup>
-    <TargetFramework>netcoreapp3.1</TargetFramework>
+    <TargetFramework>net5.0</TargetFramework>
  </PropertyGroup>

</Project>
```

## <a name="changes-to-no-locblazor-app-routing-logic-in-501"></a><span data-ttu-id="c9688-116">Alterações Blazor na lógica de roteamento de aplicativo no 5.0.1</span><span class="sxs-lookup"><span data-stu-id="c9688-116">Changes to Blazor app routing logic in 5.0.1</span></span>

<span data-ttu-id="c9688-117">A computação da precedência de rota mudou na versão do patch ASP.NET Core 5.0.1.</span><span class="sxs-lookup"><span data-stu-id="c9688-117">The computation of route precedence changed in the ASP.NET Core 5.0.1 patch release.</span></span> <span data-ttu-id="c9688-118">Isso poderá afetar você se tiver definido as rotas catch-all ou rotas com parâmetros opcionais.</span><span class="sxs-lookup"><span data-stu-id="c9688-118">This might affect you if you've defined catch-all routes or routes with optional parameters.</span></span>

### <a name="old-behavior"></a><span data-ttu-id="c9688-119">Comportamento antigo</span><span class="sxs-lookup"><span data-stu-id="c9688-119">Old behavior</span></span>

<span data-ttu-id="c9688-120">Com o comportamento anterior no ASP.NET Core 5.0.0 ou anterior, as rotas com precedência mais baixa, como `{*slug}` , são correspondidas antes das rotas com precedência mais alta, como `/customer/{id}` .</span><span class="sxs-lookup"><span data-stu-id="c9688-120">With the prior behavior in ASP.NET Core 5.0.0 or earlier, routes with lower precedence, such as `{*slug}`, are matched before routes with higher precedence, such as `/customer/{id}`.</span></span>

### <a name="new-behavior"></a><span data-ttu-id="c9688-121">Novo comportamento</span><span class="sxs-lookup"><span data-stu-id="c9688-121">New behavior</span></span>

<span data-ttu-id="c9688-122">O novo comportamento no ASP.NET Core 5.0.1 ou posterior corresponde mais próximo ao comportamento de roteamento definido em aplicativos ASP.NET Core, em que a estrutura computa e estabelece a precedência de rota para cada segmento primeiro e usa apenas o comprimento da rota para quebrar os vínculos como um critério secundário.</span><span class="sxs-lookup"><span data-stu-id="c9688-122">The new behavior in ASP.NET Core 5.0.1 or later more closely matches the routing behavior defined in ASP.NET Core apps, where the framework computes and establishes the route precedence for each segment first and only uses the length of the route to break ties as a secondary criteria.</span></span>

### <a name="reason-for-change"></a><span data-ttu-id="c9688-123">Motivo da alteração</span><span class="sxs-lookup"><span data-stu-id="c9688-123">Reason for change</span></span>

<span data-ttu-id="c9688-124">O comportamento original é considerado um bug na implementação porque nosso objetivo é que o Blazor sistema de roteamento se comporte da mesma forma que o sistema de roteamento de ASP.NET Core para o subconjunto de recursos com suporte pelo Blazor Roteamento.</span><span class="sxs-lookup"><span data-stu-id="c9688-124">The original behavior is considered a bug in the implementation because our goal is for the Blazor routing system to behave in the same way as the ASP.NET Core routing system for the subset of features supported by Blazor routing.</span></span>

### <a name="recommended-action"></a><span data-ttu-id="c9688-125">Ação recomendada</span><span class="sxs-lookup"><span data-stu-id="c9688-125">Recommended action</span></span>

<span data-ttu-id="c9688-126">Adicione o `PreferExactMatches` atributo ao `Router` componente no `App.razor` arquivo para aceitar o comportamento correto:</span><span class="sxs-lookup"><span data-stu-id="c9688-126">Add the `PreferExactMatches` attribute to the `Router` component in the `App.razor` file to opt into the correct behavior:</span></span>

```razor
<Router AppAssembly="@typeof(Program).Assembly" PreferExactMatches="true">
```

<span data-ttu-id="c9688-127">Quando `PreferExactMatches` é definido como `true` , a correspondência de rota prefere correspondências exatas sobre curingas.</span><span class="sxs-lookup"><span data-stu-id="c9688-127">When `PreferExactMatches` is set to `true`, route matching prefers exact matches over wildcards.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="c9688-128">Todos os aplicativos devem ser definidos explicitamente `PreferExactMatches` como `true` .</span><span class="sxs-lookup"><span data-stu-id="c9688-128">All apps should explicitly set `PreferExactMatches` to `true`.</span></span>
>
> <span data-ttu-id="c9688-129">A capacidade de definir `PreferExactMatches` `false` ou deixar a desdefinição *é fornecida apenas para compatibilidade com versões anteriores*.</span><span class="sxs-lookup"><span data-stu-id="c9688-129">The ability to set `PreferExactMatches` to `false` or leave it unset *is only provided for backward compatibility*.</span></span>
>
> <span data-ttu-id="c9688-130">Quando o .NET 6 for lançado, o roteador sempre preferirá correspondências exatas e a `PreferExactMatches` opção não estará disponível.</span><span class="sxs-lookup"><span data-stu-id="c9688-130">When .NET 6 is released, the router will always prefer exact matches, and the `PreferExactMatches` option won't be available.</span></span>

## <a name="update-no-locblazor-webassembly-and-no-locblazor-server-projects"></a><span data-ttu-id="c9688-131">Atualização Blazor WebAssembly e Blazor Server projetos</span><span class="sxs-lookup"><span data-stu-id="c9688-131">Update Blazor WebAssembly and Blazor Server projects</span></span>

<span data-ttu-id="c9688-132">*As diretrizes nesta seção se aplicam aos dois Blazor modelos de hospedagem. As seções a seguir nesta seção fornecem orientações adicionais específicas para hospedar modelos e tipos de aplicativos. Aplique as diretrizes de todas as seções relevantes ao seu aplicativo.*</span><span class="sxs-lookup"><span data-stu-id="c9688-132">*The guidance in this section applies to both Blazor hosting models. Sections following this section provide additional guidance specific to hosting models and app types. Apply the guidance from all relevant sections to your app.*</span></span>

1. <span data-ttu-id="c9688-133">Em `wwwroot/index.html` um Blazor WebAssembly aplicativo ou no `Pages/_Host.cshtml` de um Blazor Server aplicativo, adicione um `<link>` elemento ao `<head>` elemento para os estilos.</span><span class="sxs-lookup"><span data-stu-id="c9688-133">In `wwwroot/index.html` of a Blazor WebAssembly app or the `Pages/_Host.cshtml` of a Blazor Server app, add a `<link>` element to the `<head>` element for styles.</span></span> <span data-ttu-id="c9688-134">Nos seguintes `<link>` valores de atributo de elemento `href` , o espaço reservado `{ASSEMBLY NAME}` é o nome do assembly do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c9688-134">In the following `<link>` element `href` attribute values, the placeholder `{ASSEMBLY NAME}` is the app's assembly name.</span></span>

    ```diff
    +<link href="{ASSEMBLY NAME}.styles.css" rel="stylesheet" />
    ```

    <span data-ttu-id="c9688-135">Autônomo Blazor WebAssembly ou Blazor Server exemplo:</span><span class="sxs-lookup"><span data-stu-id="c9688-135">Standalone Blazor WebAssembly or Blazor Server example:</span></span>

    ```diff
    +<link href="BlazorSample.styles.css" rel="stylesheet" />
    ```

    <span data-ttu-id="c9688-136">*`Client`* projeto de um exemplo de solução hospedada Blazor WebAssembly :</span><span class="sxs-lookup"><span data-stu-id="c9688-136">*`Client`* project of a hosted Blazor WebAssembly solution example:</span></span>

    ```diff
    +<link href="BlazorSample.Client.styles.css" rel="stylesheet" />
    ```

1. <span data-ttu-id="c9688-137">Inclua um novo namespace no arquivo do aplicativo `_Imports.razor` para a [virtualização de componentes](xref:blazor/components/virtualization), <xref:Microsoft.AspNetCore.Components.Web.Virtualization?displayProperty=fullName> .</span><span class="sxs-lookup"><span data-stu-id="c9688-137">Include a new namespace in the app's `_Imports.razor` file for [component virtualization](xref:blazor/components/virtualization), <xref:Microsoft.AspNetCore.Components.Web.Virtualization?displayProperty=fullName>.</span></span> <span data-ttu-id="c9688-138">Os arquivos a seguir `_Imports.razor` mostram os namespaces padrão em aplicativos gerados por meio dos Blazor modelos de projeto.</span><span class="sxs-lookup"><span data-stu-id="c9688-138">The following `_Imports.razor` files show the default namespaces in apps generated from the Blazor project templates.</span></span> <span data-ttu-id="c9688-139">O espaço reservado `{ASSEMBLY NAME}` é o nome do assembly do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c9688-139">The placeholder `{ASSEMBLY NAME}` is the app's assembly name.</span></span>

   <span data-ttu-id="c9688-140">Blazor WebAssembly (`_Imports.razor`):</span><span class="sxs-lookup"><span data-stu-id="c9688-140">Blazor WebAssembly (`_Imports.razor`):</span></span>
   
   ```razor
   @using System.Net.Http
   @using System.Net.Http.Json
   @using Microsoft.AspNetCore.Components.Forms
   @using Microsoft.AspNetCore.Components.Routing
   @using Microsoft.AspNetCore.Components.Web
   @using Microsoft.AspNetCore.Components.Web.Virtualization
   @using Microsoft.AspNetCore.Components.WebAssembly.Http
   @using Microsoft.JSInterop
   @using {ASSEMBLY NAME}
   @using {ASSEMBLY NAME}.Shared
   ```

   <span data-ttu-id="c9688-141">Blazor Server (`_Imports.razor`):</span><span class="sxs-lookup"><span data-stu-id="c9688-141">Blazor Server (`_Imports.razor`):</span></span>
   
   ```razor
   @using System.Net.Http
   @using Microsoft.AspNetCore.Authorization
   @using Microsoft.AspNetCore.Components.Authorization
   @using Microsoft.AspNetCore.Components.Forms
   @using Microsoft.AspNetCore.Components.Routing
   @using Microsoft.AspNetCore.Components.Web
   @using Microsoft.AspNetCore.Components.Web.Virtualization
   @using Microsoft.JSInterop
   @using {ASSEMBLY NAME}
   @using {ASSEMBLY NAME}.Shared
   ```
   
1. <span data-ttu-id="c9688-142">No `MainLayout` componente ( `Shared/MainLayout.razor` ), coloque a marcação HTML do componente com um `<div>` elemento que tenha um `class` atributo definido como `page` :</span><span class="sxs-lookup"><span data-stu-id="c9688-142">In the `MainLayout` component (`Shared/MainLayout.razor`), surround the component's HTML markup with a `<div>` element that has a `class` attribute set to `page`:</span></span>

    ```razor
    <div class="page">
    
        ...
        
    </div>
    ```
    
1. <span data-ttu-id="c9688-143">Adicione os seguintes arquivos à `Shared` pasta:</span><span class="sxs-lookup"><span data-stu-id="c9688-143">Add the following files to the `Shared` folder:</span></span>

    <span data-ttu-id="c9688-144">`MainLayout.razor.css`:</span><span class="sxs-lookup"><span data-stu-id="c9688-144">`MainLayout.razor.css`:</span></span>
    
    ```css
    .page {
        position: relative;
        display: flex;
        flex-direction: column;
    }

    .main {
        flex: 1;
    }

    .sidebar {
        background-image: linear-gradient(180deg, rgb(5, 39, 103) 0%, #3a0647 70%);
    }

    .top-row {
        background-color: #f7f7f7;
        border-bottom: 1px solid #d6d5d5;
        justify-content: flex-end;
        height: 3.5rem;
        display: flex;
        align-items: center;
    }

        .top-row ::deep a, .top-row .btn-link {
            white-space: nowrap;
            margin-left: 1.5rem;
        }

        .top-row a:first-child {
            overflow: hidden;
            text-overflow: ellipsis;
        }

    @media (max-width: 767.98px) {
        .top-row:not(.auth) {
            display: none;
        }

        .top-row.auth {
            justify-content: space-between;
        }

        .top-row a, .top-row .btn-link {
            margin-left: 0;
        }
    }

    @media (min-width: 768px) {
        .page {
            flex-direction: row;
        }

        .sidebar {
            width: 250px;
            height: 100vh;
            position: sticky;
            top: 0;
        }

        .top-row {
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .main > div {
            padding-left: 2rem !important;
            padding-right: 1.5rem !important;
        }
    }
    ```
    
    <span data-ttu-id="c9688-145">`NavMenu.razor.css`:</span><span class="sxs-lookup"><span data-stu-id="c9688-145">`NavMenu.razor.css`:</span></span>
    
    ```css
    .navbar-toggler {
        background-color: rgba(255, 255, 255, 0.1);
    }

    .top-row {
        height: 3.5rem;
        background-color: rgba(0,0,0,0.4);
    }

    .navbar-brand {
        font-size: 1.1rem;
    }

    .oi {
        width: 2rem;
        font-size: 1.1rem;
        vertical-align: text-top;
        top: -2px;
    }

    .nav-item {
        font-size: 0.9rem;
        padding-bottom: 0.5rem;
    }

        .nav-item:first-of-type {
            padding-top: 1rem;
        }

        .nav-item:last-of-type {
            padding-bottom: 1rem;
        }

        .nav-item ::deep a {
            color: #d7d7d7;
            border-radius: 4px;
            height: 3rem;
            display: flex;
            align-items: center;
            line-height: 3rem;
        }

    .nav-item ::deep a.active {
        background-color: rgba(255,255,255,0.25);
        color: white;
    }

    .nav-item ::deep a:hover {
        background-color: rgba(255,255,255,0.1);
        color: white;
    }

    @media (min-width: 768px) {
        .navbar-toggler {
            display: none;
        }

        .collapse {
            /* Never collapse the sidebar for wide screens */
            display: block;
        }
    }
    ```

1. <span data-ttu-id="c9688-146">O arquivo base mais recente `wwwroot/css/app.css` de um Blazor WebAssembly aplicativo ou `wwwroot/css/site.css` arquivo de um Blazor Server aplicativo inclui os seguintes estilos.</span><span class="sxs-lookup"><span data-stu-id="c9688-146">The latest base `wwwroot/css/app.css` file of a Blazor WebAssembly app or `wwwroot/css/site.css` file of a Blazor Server app includes the following styles.</span></span> <span data-ttu-id="c9688-147">Remova os estilos extras, deixando os estilos a seguir e os que você adicionou ao aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c9688-147">Remove extra styles leaving the following styles and any that you've added to the app.</span></span>

    <span data-ttu-id="c9688-148">A seguinte folha de estilo inclui apenas estilos base e **não inclui estilos** personalizados adicionados pelo desenvolvedor:</span><span class="sxs-lookup"><span data-stu-id="c9688-148">The following stylesheet only includes base styles and does **not** include custom styles added by the developer:</span></span>
   
    ```css
    @import url('open-iconic/font/css/open-iconic-bootstrap.min.css');

    html, body {
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    }

    a, .btn-link {
        color: #0366d6;
    }

    .btn-primary {
        color: #fff;
        background-color: #1b6ec2;
        border-color: #1861ac;
    }

    .content {
        padding-top: 1.1rem;
    }

    .valid.modified:not([type=checkbox]) {
        outline: 1px solid #26b050;
    }

    .invalid {
        outline: 1px solid red;
    }

    .validation-message {
        color: red;
    }

    #blazor-error-ui {
        background: lightyellow;
        bottom: 0;
        box-shadow: 0 -1px 2px rgba(0, 0, 0, 0.2);
        display: none;
        left: 0;
        padding: 0.6rem 1.25rem 0.7rem 1.25rem;
        position: fixed;
        width: 100%;
        z-index: 1000;
    }

    #blazor-error-ui .dismiss {
        cursor: pointer;
        position: absolute;
        right: 0.75rem;
        top: 0.5rem;
    }
    ```

## <a name="update-no-locblazor-webassembly-projects"></a><span data-ttu-id="c9688-149">Atualizar Blazor WebAssembly projetos</span><span class="sxs-lookup"><span data-stu-id="c9688-149">Update Blazor WebAssembly projects</span></span>

<span data-ttu-id="c9688-150">Siga as orientações na seção [atualização Blazor WebAssembly e Blazor Server projetos](#update-blazor-webassembly-and-blazor-server-projects) anteriores.</span><span class="sxs-lookup"><span data-stu-id="c9688-150">Follow the guidance in the preceding [Update Blazor WebAssembly and Blazor Server projects](#update-blazor-webassembly-and-blazor-server-projects) section.</span></span>

<span data-ttu-id="c9688-151">Para um Blazor WebAssembly projeto do, incluindo o *`Client`* projeto de uma Blazor solução hospedada, aplique as seguintes alterações ao arquivo de projeto:</span><span class="sxs-lookup"><span data-stu-id="c9688-151">For a Blazor WebAssembly project, including the *`Client`* project of a hosted Blazor solution, apply the following changes to the project file:</span></span>

1. <span data-ttu-id="c9688-152">Atualize o SDK de `Microsoft.NET.Sdk.Web` para `Microsoft.NET.Sdk.BlazorWebAssembly` :</span><span class="sxs-lookup"><span data-stu-id="c9688-152">Update the SDK from `Microsoft.NET.Sdk.Web` to `Microsoft.NET.Sdk.BlazorWebAssembly`:</span></span>

    ```diff
    - <Project Sdk="Microsoft.NET.Sdk.Web">
    + <Project Sdk="Microsoft.NET.Sdk.BlazorWebAssembly">
    ```
    
    > [!NOTE]
    > <span data-ttu-id="c9688-153">Essa atualização se aplica somente a Blazor WebAssembly projetos autônomos e a *`Client`* projetos de soluções hospedadas Blazor .</span><span class="sxs-lookup"><span data-stu-id="c9688-153">This update only applies to standalone Blazor WebAssembly projects and the *`Client`* projects of hosted Blazor solutions.</span></span>

1. <span data-ttu-id="c9688-154">Atualize as seguintes propriedades:</span><span class="sxs-lookup"><span data-stu-id="c9688-154">Update the following properties:</span></span>

    ```diff
    <Project Sdk="Microsoft.NET.Sdk.BlazorWebAssembly">
    
      <PropertyGroup>
    -     <TargetFramework>netstandard2.1</TargetFramework>
    -     <RazorLangVersion>3.0</RazorLangVersion>
    +     <TargetFramework>net5.0</TargetFramework>
      </PropertyGroup>
    ```

1. <span data-ttu-id="c9688-155">Remova a referência de pacote para [Microsoft. AspNetCore. Components. Webassembly. Build](https://www.nuget.org/packages/Microsoft.AspNetCore.Components.WebAssembly.Build):</span><span class="sxs-lookup"><span data-stu-id="c9688-155">Remove the package reference to [Microsoft.AspNetCore.Components.WebAssembly.Build](https://www.nuget.org/packages/Microsoft.AspNetCore.Components.WebAssembly.Build):</span></span>

    ```diff
    <ItemGroup>
    -    <PackageReference Include="Microsoft.AspNetCore.Components.WebAssembly.Build" Version="3.2.1" PrivateAssets="all" />
    ```

1. <span data-ttu-id="c9688-156">Atualize outros pacotes para suas versões mais recentes.</span><span class="sxs-lookup"><span data-stu-id="c9688-156">Update other packages to their latest versions.</span></span> <span data-ttu-id="c9688-157">As versões mais recentes podem ser encontradas em [NuGet.org](https://www.nuget.org).</span><span class="sxs-lookup"><span data-stu-id="c9688-157">The latest versions can be found at [NuGet.org](https://www.nuget.org).</span></span>

1. <span data-ttu-id="c9688-158">No `wwwroot/index.html` , altere o elemento que carrega o `App` componente para um `<div>` elemento com um `id` definido como `app` :</span><span class="sxs-lookup"><span data-stu-id="c9688-158">In `wwwroot/index.html`, change the element that loads the `App` component to a `<div>` element with an `id` set to `app`:</span></span>
    
    ```diff
    -<app>Loading...</app>
    +<div id="app">Loading...</div>
    ```
    
1. <span data-ttu-id="c9688-159">Em `Program.Main` ( `Program.cs` ):</span><span class="sxs-lookup"><span data-stu-id="c9688-159">In `Program.Main` (`Program.cs`):</span></span>

   * <span data-ttu-id="c9688-160">Altere a referência ao `<app>` elemento para um seletor de CSS adicionando um hash `#` a ele.</span><span class="sxs-lookup"><span data-stu-id="c9688-160">Change the reference to the `<app>` element to a CSS selector by adding a hash `#` to it.</span></span>
   * <span data-ttu-id="c9688-161">Altere o `HttpClient` registro para escopo.</span><span class="sxs-lookup"><span data-stu-id="c9688-161">Change the `HttpClient` registration to scoped.</span></span>

    ```diff
    -builder.RootComponents.Add<App>("app");
    +builder.RootComponents.Add<App>("#app");
    
    -builder.Services.AddTransient(sp => new HttpClient 
    -    { BaseAddress = new Uri(builder.HostEnvironment.BaseAddress) });
    +builder.Services.AddScoped(sp => new HttpClient 
    +    { BaseAddress = new Uri(builder.HostEnvironment.BaseAddress) });
    ```

### <a name="standalone-no-locblazor-webassembly-app-with-microsoft-accounts"></a><span data-ttu-id="c9688-162">Blazor WebAssemblyAplicativo autônomo com contas da Microsoft</span><span class="sxs-lookup"><span data-stu-id="c9688-162">Standalone Blazor WebAssembly app with Microsoft Accounts</span></span>

<span data-ttu-id="c9688-163">Siga as orientações nas seções [atualização anterior Blazor WebAssembly e Blazor Server projetos](#update-blazor-webassembly-and-blazor-server-projects) e [Atualizar Blazor WebAssembly projetos](#update-blazor-webassembly-projects) .</span><span class="sxs-lookup"><span data-stu-id="c9688-163">Follow the guidance in the preceding [Update Blazor WebAssembly and Blazor Server projects](#update-blazor-webassembly-and-blazor-server-projects) and [Update Blazor WebAssembly projects](#update-blazor-webassembly-projects) sections.</span></span>

<span data-ttu-id="c9688-164">Para um Blazor WebAssembly aplicativo autônomo registrado no portal do Azure usar Azure Active Directory (AAD) para contas da Microsoft:</span><span class="sxs-lookup"><span data-stu-id="c9688-164">For a standalone Blazor WebAssembly app registered in the Azure portal to use Azure Active Directory (AAD) for Microsoft Accounts:</span></span>

* <span data-ttu-id="c9688-165">O aplicativo requer os `openid` `offline_access` escopos e:</span><span class="sxs-lookup"><span data-stu-id="c9688-165">The app requires the `openid` and `offline_access` scopes:</span></span>

  ```csharp
  options.ProviderOptions.DefaultAccessTokenScopes.Add("openid");
  options.ProviderOptions.DefaultAccessTokenScopes.Add("offline_access");
  ```
  
* <span data-ttu-id="c9688-166">Na folha de **autenticação** de registro do aplicativo portal do Azure:</span><span class="sxs-lookup"><span data-stu-id="c9688-166">In the Azure portal app registration **Authentication** blade:</span></span>

  1. <span data-ttu-id="c9688-167">Remova a configuração de plataforma **da Web** .</span><span class="sxs-lookup"><span data-stu-id="c9688-167">Remove the **Web** platform configuration.</span></span>
  1. <span data-ttu-id="c9688-168">Adicione uma configuração de plataforma de **aplicativo de página única** com o URI de redirecionamento do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c9688-168">Add a **Single-page application** platform configuration with the app's redirect URI.</span></span>
  1. <span data-ttu-id="c9688-169">Desabilite a **concessão implícita** para **tokens de acesso** e **tokens de ID**.</span><span class="sxs-lookup"><span data-stu-id="c9688-169">Disable **Implicit grant** for **Access tokens** and **ID tokens**.</span></span>

<span data-ttu-id="c9688-170">Para obter mais informações, consulte <xref:blazor/security/webassembly/standalone-with-microsoft-accounts>.</span><span class="sxs-lookup"><span data-stu-id="c9688-170">For more information, see <xref:blazor/security/webassembly/standalone-with-microsoft-accounts>.</span></span>

### <a name="standalone-no-locblazor-webassembly-app-with-azure-active-directory-aad"></a><span data-ttu-id="c9688-171">Blazor WebAssemblyAplicativo autônomo com Azure Active Directory (AAD)</span><span class="sxs-lookup"><span data-stu-id="c9688-171">Standalone Blazor WebAssembly app with Azure Active Directory (AAD)</span></span>

<span data-ttu-id="c9688-172">Siga as orientações nas seções [atualização anterior Blazor WebAssembly e Blazor Server projetos](#update-blazor-webassembly-and-blazor-server-projects) e [Atualizar Blazor WebAssembly projetos](#update-blazor-webassembly-projects) .</span><span class="sxs-lookup"><span data-stu-id="c9688-172">Follow the guidance in the preceding [Update Blazor WebAssembly and Blazor Server projects](#update-blazor-webassembly-and-blazor-server-projects) and [Update Blazor WebAssembly projects](#update-blazor-webassembly-projects) sections.</span></span>

<span data-ttu-id="c9688-173">Para um Blazor WebAssembly aplicativo autônomo registrado no portal do Azure usar Azure Active Directory (AAD):</span><span class="sxs-lookup"><span data-stu-id="c9688-173">For a standalone Blazor WebAssembly app registered in the Azure portal to use Azure Active Directory (AAD):</span></span>

* <span data-ttu-id="c9688-174">O aplicativo requer o `https://graph.microsoft.com/User.Read` escopo:</span><span class="sxs-lookup"><span data-stu-id="c9688-174">The app requires the `https://graph.microsoft.com/User.Read` scope:</span></span>

  ```csharp
  options.ProviderOptions.DefaultAccessTokenScopes
      .Add("https://graph.microsoft.com/User.Read");
  ```
  
* <span data-ttu-id="c9688-175">Na folha de **autenticação** de registro do aplicativo portal do Azure:</span><span class="sxs-lookup"><span data-stu-id="c9688-175">In the Azure portal app registration **Authentication** blade:</span></span>

  1. <span data-ttu-id="c9688-176">Remova a configuração de plataforma **da Web** .</span><span class="sxs-lookup"><span data-stu-id="c9688-176">Remove the **Web** platform configuration.</span></span>
  1. <span data-ttu-id="c9688-177">Adicione uma configuração de plataforma de **aplicativo de página única** com o URI de redirecionamento do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c9688-177">Add a **Single-page application** platform configuration with the app's redirect URI.</span></span>
  1. <span data-ttu-id="c9688-178">Desabilite a **concessão implícita** para **tokens de acesso** e **tokens de ID**.</span><span class="sxs-lookup"><span data-stu-id="c9688-178">Disable **Implicit grant** for **Access tokens** and **ID tokens**.</span></span>
  
<span data-ttu-id="c9688-179">Para obter mais informações, consulte <xref:blazor/security/webassembly/standalone-with-azure-active-directory>.</span><span class="sxs-lookup"><span data-stu-id="c9688-179">For more information, see <xref:blazor/security/webassembly/standalone-with-azure-active-directory>.</span></span>

### <a name="standalone-no-locblazor-webassembly-app-with-azure-active-directory-aad-b2c"></a><span data-ttu-id="c9688-180">Blazor WebAssemblyAplicativo autônomo com Azure Active Directory (AAD) B2C</span><span class="sxs-lookup"><span data-stu-id="c9688-180">Standalone Blazor WebAssembly app with Azure Active Directory (AAD) B2C</span></span>

<span data-ttu-id="c9688-181">Siga as orientações nas seções [atualização anterior Blazor WebAssembly e Blazor Server projetos](#update-blazor-webassembly-and-blazor-server-projects) e [Atualizar Blazor WebAssembly projetos](#update-blazor-webassembly-projects) .</span><span class="sxs-lookup"><span data-stu-id="c9688-181">Follow the guidance in the preceding [Update Blazor WebAssembly and Blazor Server projects](#update-blazor-webassembly-and-blazor-server-projects) and [Update Blazor WebAssembly projects](#update-blazor-webassembly-projects) sections.</span></span>

<span data-ttu-id="c9688-182">Para um Blazor WebAssembly aplicativo autônomo registrado no portal do Azure usar Azure Active Directory (AAD) B2C:</span><span class="sxs-lookup"><span data-stu-id="c9688-182">For a standalone Blazor WebAssembly app registered in the Azure portal to use Azure Active Directory (AAD) B2C:</span></span>

* <span data-ttu-id="c9688-183">O aplicativo requer os `openid` `offline_access` escopos e:</span><span class="sxs-lookup"><span data-stu-id="c9688-183">The app requires the `openid` and `offline_access` scopes:</span></span>

  ```csharp
  options.ProviderOptions.DefaultAccessTokenScopes.Add("openid");
  options.ProviderOptions.DefaultAccessTokenScopes.Add("offline_access");
  ```
  
* <span data-ttu-id="c9688-184">Na folha de **autenticação** de registro do aplicativo portal do Azure:</span><span class="sxs-lookup"><span data-stu-id="c9688-184">In the Azure portal app registration **Authentication** blade:</span></span>

  1. <span data-ttu-id="c9688-185">Remova a configuração de plataforma **da Web** .</span><span class="sxs-lookup"><span data-stu-id="c9688-185">Remove the **Web** platform configuration.</span></span>
  1. <span data-ttu-id="c9688-186">Adicione uma configuração de plataforma de **aplicativo de página única** com o URI de redirecionamento do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c9688-186">Add a **Single-page application** platform configuration with the app's redirect URI.</span></span>
  1. <span data-ttu-id="c9688-187">Desabilite a **concessão implícita** para **tokens de acesso** e **tokens de ID**.</span><span class="sxs-lookup"><span data-stu-id="c9688-187">Disable **Implicit grant** for **Access tokens** and **ID tokens**.</span></span>

<span data-ttu-id="c9688-188">Para obter mais informações, consulte <xref:blazor/security/webassembly/standalone-with-azure-active-directory-b2c>.</span><span class="sxs-lookup"><span data-stu-id="c9688-188">For more information, see <xref:blazor/security/webassembly/standalone-with-azure-active-directory-b2c>.</span></span>

### <a name="hosted-no-locblazor-webassembly-app-with-azure-active-directory-aad-or-aad-b2c"></a><span data-ttu-id="c9688-189">Blazor WebAssemblyAplicativo hospedado com Azure Active Directory (AAD) ou AAD B2C</span><span class="sxs-lookup"><span data-stu-id="c9688-189">Hosted Blazor WebAssembly app with Azure Active Directory (AAD) or AAD B2C</span></span>

<span data-ttu-id="c9688-190">Siga as orientações nas seções [atualização anterior Blazor WebAssembly e Blazor Server projetos](#update-blazor-webassembly-and-blazor-server-projects) e [Atualizar Blazor WebAssembly projetos](#update-blazor-webassembly-projects) .</span><span class="sxs-lookup"><span data-stu-id="c9688-190">Follow the guidance in the preceding [Update Blazor WebAssembly and Blazor Server projects](#update-blazor-webassembly-and-blazor-server-projects) and [Update Blazor WebAssembly projects](#update-blazor-webassembly-projects) sections.</span></span>

<span data-ttu-id="c9688-191">O *`Client`* registro de aplicativo de uma Blazor solução hospedada que usa o AAD ou o AAD B2C para autenticação de usuário deve usar uma configuração de plataforma de aplicativos do Azure de **página única** .</span><span class="sxs-lookup"><span data-stu-id="c9688-191">The *`Client`* app registration of a hosted Blazor solution that uses AAD or AAD B2C for user authentication should use a **Single-page application** Azure Apps platform configuration.</span></span>

<span data-ttu-id="c9688-192">Na folha de *`Client`* **autenticação** de registro do aplicativo portal do Azure:</span><span class="sxs-lookup"><span data-stu-id="c9688-192">In the Azure portal *`Client`* app registration **Authentication** blade:</span></span>

  1. <span data-ttu-id="c9688-193">Remova a configuração de plataforma **da Web** .</span><span class="sxs-lookup"><span data-stu-id="c9688-193">Remove the **Web** platform configuration.</span></span>
  1. <span data-ttu-id="c9688-194">Adicione uma configuração de plataforma de **aplicativo de página única** com o URI de redirecionamento do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c9688-194">Add a **Single-page application** platform configuration with the app's redirect URI.</span></span>
  1. <span data-ttu-id="c9688-195">Desabilite a **concessão implícita** para **tokens de acesso** e **tokens de ID**.</span><span class="sxs-lookup"><span data-stu-id="c9688-195">Disable **Implicit grant** for **Access tokens** and **ID tokens**.</span></span>

<span data-ttu-id="c9688-196">Para obter mais informações, consulte:</span><span class="sxs-lookup"><span data-stu-id="c9688-196">For more information, see:</span></span>

* <xref:blazor/security/webassembly/hosted-with-azure-active-directory>
* <xref:blazor/security/webassembly/hosted-with-azure-active-directory-b2c>

### <a name="update-the-server-project-of-a-hosted-no-locblazor-solution"></a><span data-ttu-id="c9688-197">Atualizar o projeto de servidor de uma Blazor solução hospedada</span><span class="sxs-lookup"><span data-stu-id="c9688-197">Update the Server project of a hosted Blazor solution</span></span>

<span data-ttu-id="c9688-198">Siga as orientações nas seções anteriores:</span><span class="sxs-lookup"><span data-stu-id="c9688-198">Follow the guidance in the preceding sections:</span></span>

* [<span data-ttu-id="c9688-199">Atualização Blazor WebAssembly e Blazor Server projetos</span><span class="sxs-lookup"><span data-stu-id="c9688-199">Update Blazor WebAssembly and Blazor Server projects</span></span>](#update-blazor-webassembly-and-blazor-server-projects)
* [<span data-ttu-id="c9688-200">Atualizar Blazor WebAssembly projetos</span><span class="sxs-lookup"><span data-stu-id="c9688-200">Update Blazor WebAssembly projects</span></span>](#update-blazor-webassembly-projects)
* <span data-ttu-id="c9688-201">A seção que se aplica ao provedor do aplicativo com Azure Active Directory:</span><span class="sxs-lookup"><span data-stu-id="c9688-201">The section that applies to the app's provider with Azure Active Directory:</span></span>
  * [<span data-ttu-id="c9688-202">Blazor WebAssemblyAplicativo autônomo com contas da Microsoft</span><span class="sxs-lookup"><span data-stu-id="c9688-202">Standalone Blazor WebAssembly app with Microsoft Accounts</span></span>](#standalone-blazor-webassembly-app-with-microsoft-accounts)
  * [<span data-ttu-id="c9688-203">Blazor WebAssemblyAplicativo autônomo com Azure Active Directory (AAD)</span><span class="sxs-lookup"><span data-stu-id="c9688-203">Standalone Blazor WebAssembly app with Azure Active Directory (AAD)</span></span>](#standalone-blazor-webassembly-app-with-azure-active-directory-aad)
  * [<span data-ttu-id="c9688-204">Blazor WebAssemblyAplicativo autônomo com Azure Active Directory (AAD) B2C</span><span class="sxs-lookup"><span data-stu-id="c9688-204">Standalone Blazor WebAssembly app with Azure Active Directory (AAD) B2C</span></span>](#standalone-blazor-webassembly-app-with-azure-active-directory-aad-b2c)

<span data-ttu-id="c9688-205">Atualize o *`Server`* projeto de uma solução hospedada Blazor como um aplicativo ASP.NET Core seguindo as diretrizes gerais neste artigo.</span><span class="sxs-lookup"><span data-stu-id="c9688-205">Update the *`Server`* project of a hosted Blazor solution as an ASP.NET Core app following the general guidance in this article.</span></span>

<span data-ttu-id="c9688-206">Além disso, *`Server`* os projetos que autenticam usuários em Blazor WebAssembly aplicativos cliente com Azure Active Directory (AAD) ou B2C devem adotar novos pacotes do Microsoft Identity v 2.0:</span><span class="sxs-lookup"><span data-stu-id="c9688-206">Additionally, *`Server`* projects that authenticate users to client Blazor WebAssembly apps with Azure Active Directory (AAD) or B2C should adopt new Microsoft Identity v2.0 packages:</span></span> 
  
<span data-ttu-id="c9688-207">Para o AAD:</span><span class="sxs-lookup"><span data-stu-id="c9688-207">For AAD:</span></span>

```diff
-<PackageReference Include="Microsoft.AspNetCore.Authentication.AzureAD.UI" Version="..." />
+<PackageReference Include="Microsoft.Identity.Web" Version="{VERSION}" />
+<PackageReference Include="Microsoft.Identity.Web.UI" Version="{VERSION}" />
```

<span data-ttu-id="c9688-208">Por AAD B2C:</span><span class="sxs-lookup"><span data-stu-id="c9688-208">For AAD B2C:</span></span>

```diff
-<PackageReference Include="Microsoft.AspNetCore.Authentication.AzureADB2C.UI" Version="..." />
+<PackageReference Include="Microsoft.Identity.Web" Version="{VERSION}" />
+<PackageReference Include="Microsoft.Identity.Web.UI" Version="{VERSION}" />
```

<span data-ttu-id="c9688-209">Para as referências de pacote anteriores, determine as versões de pacote para os `{VERSION}` espaços reservados em NuGet.org:</span><span class="sxs-lookup"><span data-stu-id="c9688-209">For the preceding package references, determine the package versions for the `{VERSION}` placeholders at NuGet.org:</span></span>

* [`Microsoft.Identity.Web`](https://www.nuget.org/packages/Microsoft.Identity.Web)
* [`Microsoft.Identity.Web.UI`](https://www.nuget.org/packages/Microsoft.Identity.Web.UI)

> [!NOTE]
> <span data-ttu-id="c9688-210">O SDK do *`Server`* projeto em uma solução hospedada Blazor WebAssembly permanece `Microsoft.NET.Sdk.Web` :</span><span class="sxs-lookup"><span data-stu-id="c9688-210">The SDK of the *`Server`* project in a hosted Blazor WebAssembly solution remains `Microsoft.NET.Sdk.Web`:</span></span>
>
> ```xml
> <Project Sdk="Microsoft.NET.Sdk.Web">
> ```

<span data-ttu-id="c9688-211">Para obter mais informações, consulte:</span><span class="sxs-lookup"><span data-stu-id="c9688-211">For more information, see:</span></span>

* <xref:blazor/security/webassembly/hosted-with-azure-active-directory>
* <xref:blazor/security/webassembly/hosted-with-azure-active-directory-b2c>

### <a name="clean-and-rebuild-the-solution"></a><span data-ttu-id="c9688-212">Limpar e recompilar a solução</span><span class="sxs-lookup"><span data-stu-id="c9688-212">Clean and rebuild the solution</span></span>

<span data-ttu-id="c9688-213">Depois de migrar o aplicativo ou a solução para o .NET 5, limpe e recompile o aplicativo ou a solução.</span><span class="sxs-lookup"><span data-stu-id="c9688-213">After migrating the app or solution to .NET 5, clean and rebuild the app or solution.</span></span> <span data-ttu-id="c9688-214">Se existirem incompatibilidades de pacotes entre novas referências de pacote e pacotes em cache:</span><span class="sxs-lookup"><span data-stu-id="c9688-214">If package incompatibilities exist between new package references and cached packages:</span></span>

1. <span data-ttu-id="c9688-215">Limpe os caches de pacote NuGet executando o seguinte [`dotnet nuget locals`](/dotnet/core/tools/dotnet-nuget-locals) comando em um shell de comando:</span><span class="sxs-lookup"><span data-stu-id="c9688-215">Clear NuGet package caches by executing the following [`dotnet nuget locals`](/dotnet/core/tools/dotnet-nuget-locals) command in a command shell:</span></span>

   ```dotnetcli
   dotnet nuget locals --clear all
   ```
   
1. <span data-ttu-id="c9688-216">Limpar e recompilar o aplicativo ou a solução.</span><span class="sxs-lookup"><span data-stu-id="c9688-216">Clean and rebuild the app or solution.</span></span>

### <a name="troubleshoot"></a><span data-ttu-id="c9688-217">Solucionar problemas</span><span class="sxs-lookup"><span data-stu-id="c9688-217">Troubleshoot</span></span>

<span data-ttu-id="c9688-218">Siga as diretrizes de *solução de problemas* no final do Blazor WebAssembly tópico de segurança que se aplica ao seu aplicativo:</span><span class="sxs-lookup"><span data-stu-id="c9688-218">Follow the *Troubleshoot* guidance at the end of the Blazor WebAssembly security topic that applies to your app:</span></span>

<span data-ttu-id="c9688-219">Aplicativos autônomos Blazor WebAssembly :</span><span class="sxs-lookup"><span data-stu-id="c9688-219">Standalone Blazor WebAssembly apps:</span></span>

* [<span data-ttu-id="c9688-220">Diretrizes gerais para provedores de OIDC e a biblioteca de autenticação Webassembly</span><span class="sxs-lookup"><span data-stu-id="c9688-220">General guidance for OIDC providers and the WebAssembly Authentication Library</span></span>](xref:blazor/security/webassembly/standalone-with-authentication-library)
* [<span data-ttu-id="c9688-221">Contas da Microsoft</span><span class="sxs-lookup"><span data-stu-id="c9688-221">Microsoft Accounts</span></span>](xref:blazor/security/webassembly/standalone-with-microsoft-accounts)
* [<span data-ttu-id="c9688-222">AAD (Azure Active Directory)</span><span class="sxs-lookup"><span data-stu-id="c9688-222">Azure Active Directory (AAD)</span></span>](xref:blazor/security/webassembly/standalone-with-azure-active-directory)
* [<span data-ttu-id="c9688-223">Azure Active Directory (AAD) B2C</span><span class="sxs-lookup"><span data-stu-id="c9688-223">Azure Active Directory (AAD) B2C</span></span>](xref:blazor/security/webassembly/standalone-with-azure-active-directory-b2c)

<span data-ttu-id="c9688-224">Aplicativos hospedados Blazor WebAssembly :</span><span class="sxs-lookup"><span data-stu-id="c9688-224">Hosted Blazor WebAssembly apps:</span></span>

* [<span data-ttu-id="c9688-225">AAD (Azure Active Directory)</span><span class="sxs-lookup"><span data-stu-id="c9688-225">Azure Active Directory (AAD)</span></span>](xref:blazor/security/webassembly/hosted-with-azure-active-directory)
* [<span data-ttu-id="c9688-226">Azure Active Directory (AAD) B2C</span><span class="sxs-lookup"><span data-stu-id="c9688-226">Azure Active Directory (AAD) B2C</span></span>](xref:blazor/security/webassembly/hosted-with-azure-active-directory-b2c)
* [<span data-ttu-id="c9688-227">Identity Servidor</span><span class="sxs-lookup"><span data-stu-id="c9688-227">Identity Server</span></span>](xref:blazor/security/webassembly/hosted-with-identity-server)

### <a name="unauthorized-client-for-azure-active-directory-aad"></a><span data-ttu-id="c9688-228">Cliente não autorizado para Azure Active Directory (AAD)</span><span class="sxs-lookup"><span data-stu-id="c9688-228">Unauthorized client for Azure Active Directory (AAD)</span></span>

<span data-ttu-id="c9688-229">Depois de atualizar um Blazor WebAssembly aplicativo que usa o AAD para autenticação, você poderá receber o seguinte erro no retorno de chamada de logon para o aplicativo depois que o usuário entrar com o AAD:</span><span class="sxs-lookup"><span data-stu-id="c9688-229">After upgrading a Blazor WebAssembly app that uses AAD for authentication, you may receive the following error on the login callback to the app after the user signs in with AAD:</span></span>

> <span data-ttu-id="c9688-230">info: falha na autorização de Microsoft. AspNetCore. Authorization. DefaultAuthorizationService [2].</span><span class="sxs-lookup"><span data-stu-id="c9688-230">info: Microsoft.AspNetCore.Authorization.DefaultAuthorizationService[2] Authorization failed.</span></span> <span data-ttu-id="c9688-231">Esses requisitos não foram atendidos: DenyAnonymousAuthorizationRequirement: requer um usuário autenticado.</span><span class="sxs-lookup"><span data-stu-id="c9688-231">These requirements were not met: DenyAnonymousAuthorizationRequirement: Requires an authenticated user.</span></span>

<span data-ttu-id="c9688-232">Erro de retorno de chamada de logon do AAD:</span><span class="sxs-lookup"><span data-stu-id="c9688-232">Login callback error from AAD:</span></span>

* <span data-ttu-id="c9688-233">Erro: `unauthorized_client`</span><span class="sxs-lookup"><span data-stu-id="c9688-233">Error: `unauthorized_client`</span></span>
* <span data-ttu-id="c9688-234">Descrição: `AADB2C90058: The provided application is not configured to allow public clients.`</span><span class="sxs-lookup"><span data-stu-id="c9688-234">Description: `AADB2C90058: The provided application is not configured to allow public clients.`</span></span>

<span data-ttu-id="c9688-235">Para resolver o erro:</span><span class="sxs-lookup"><span data-stu-id="c9688-235">To resolve the error:</span></span>

1. <span data-ttu-id="c9688-236">No portal do Azure, acesse o [manifesto do aplicativo](/azure/active-directory/develop/reference-app-manifest).</span><span class="sxs-lookup"><span data-stu-id="c9688-236">In the Azure portal, access the [app's manifest](/azure/active-directory/develop/reference-app-manifest).</span></span>
1. <span data-ttu-id="c9688-237">Defina o [`allowPublicClient`](/azure/active-directory/develop/reference-app-manifest#allowpublicclient-attribute) atributo como `null` ou `true` .</span><span class="sxs-lookup"><span data-stu-id="c9688-237">Set the [`allowPublicClient`](/azure/active-directory/develop/reference-app-manifest#allowpublicclient-attribute) attribute to `null` or `true`.</span></span>

## <a name="update-a-no-locblazor-progressive-web-application-pwa"></a><span data-ttu-id="c9688-238">Atualizar um Blazor aplicativo Web progressivo (PWA)</span><span class="sxs-lookup"><span data-stu-id="c9688-238">Update a Blazor Progressive Web Application (PWA)</span></span>

<span data-ttu-id="c9688-239">Adicione o seguinte item ao arquivo de projeto do aplicativo do PWA:</span><span class="sxs-lookup"><span data-stu-id="c9688-239">Add the following item to the PWA app's project file:</span></span>

```xml
<ItemGroup>
  <ServiceWorker Include="wwwroot\service-worker.js" 
    PublishedContent="wwwroot\service-worker.published.js" />
</ItemGroup>
```

## <a name="update-no-locrazor-class-libraries-rcls"></a><span data-ttu-id="c9688-240">Atualizar Razor bibliotecas de classes (RCLs)</span><span class="sxs-lookup"><span data-stu-id="c9688-240">Update Razor class libraries (RCLs)</span></span>

<span data-ttu-id="c9688-241">Migre Razor bibliotecas de classes (RCLs) para aproveitar as novas APIs ou recursos que são introduzidos como parte do ASP.NET Core 5,0.</span><span class="sxs-lookup"><span data-stu-id="c9688-241">Migrate Razor class libraries (RCLs) to take advantage of new APIs or features that are introduced as part of ASP.NET Core 5.0.</span></span> 

<span data-ttu-id="c9688-242">Para atualizar um RCL que tem como alvo os componentes:</span><span class="sxs-lookup"><span data-stu-id="c9688-242">To update a RCL that targets components:</span></span>

1. <span data-ttu-id="c9688-243">Atualize as seguintes propriedades no arquivo de projeto:</span><span class="sxs-lookup"><span data-stu-id="c9688-243">Update the following properties in the project file:</span></span>

   ```diff
   <Project Sdk="Microsoft.NET.Sdk.Razor">
    
     <PropertyGroup>
   -     <TargetFramework>netstandard2.0</TargetFramework>
   -     <RazorLangVersion>3.0</RazorLangVersion>
   +     <TargetFramework>net5.0</TargetFramework>
     </PropertyGroup>
   ```

1. <span data-ttu-id="c9688-244">Atualize outros pacotes para suas versões mais recentes.</span><span class="sxs-lookup"><span data-stu-id="c9688-244">Update other packages to their latest versions.</span></span> <span data-ttu-id="c9688-245">As versões mais recentes podem ser encontradas em [NuGet.org](https://www.nuget.org).</span><span class="sxs-lookup"><span data-stu-id="c9688-245">The latest versions can be found at [NuGet.org](https://www.nuget.org).</span></span>

<span data-ttu-id="c9688-246">Para atualizar um RCL de destino MVC, atualize as seguintes propriedades no arquivo de projeto:</span><span class="sxs-lookup"><span data-stu-id="c9688-246">To update an RCL targeting MVC, update the following properties in the project file:</span></span>

```diff
<Project Sdk="Microsoft.NET.Sdk.Razor">

  <PropertyGroup>
-    <TargetFramework>netcoreapp3.1</TargetFramework>
+    <TargetFramework>net5.0</TargetFramework>
    <AddRazorSupportForMvc>true</AddRazorSupportForMvc>
  </PropertyGroup>
```

## <a name="update-package-references"></a><span data-ttu-id="c9688-247">Referências do pacote de atualização</span><span class="sxs-lookup"><span data-stu-id="c9688-247">Update package references</span></span>

<span data-ttu-id="c9688-248">No arquivo de projeto, atualize cada [Microsoft. AspNetCore. \*](https://www.nuget.org/packages?q=Microsoft.AspNetCore.*), [Microsoft. EntityFrameworkCore. \*](https://www.nuget.org/packages?q=Microsoft.EntityFrameworkCore.*), [Microsoft. Extensions. \*](https://www.nuget.org/packages?q=Microsoft.Extensions.*)e [System.Net.Http.Jsno](https://www.nuget.org/packages/System.Net.Http.Json) atributo de referência do pacote `Version` como 5.0.0 ou posterior.</span><span class="sxs-lookup"><span data-stu-id="c9688-248">In the project file, update each [Microsoft.AspNetCore.\*](https://www.nuget.org/packages?q=Microsoft.AspNetCore.*), [Microsoft.EntityFrameworkCore.\*](https://www.nuget.org/packages?q=Microsoft.EntityFrameworkCore.*), [Microsoft.Extensions.\*](https://www.nuget.org/packages?q=Microsoft.Extensions.*), and [System.Net.Http.Json](https://www.nuget.org/packages/System.Net.Http.Json) package reference's `Version` attribute to 5.0.0 or later.</span></span> <span data-ttu-id="c9688-249">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="c9688-249">For example:</span></span>

```diff
<ItemGroup>
-    <PackageReference Include="Microsoft.AspNetCore.JsonPatch" Version="3.1.6" />
-    <PackageReference Include="Microsoft.EntityFrameworkCore.Tools" Version="3.1.6">
-    <PackageReference Include="Microsoft.Extensions.Caching.Abstractions" Version="3.1.6" />
-    <PackageReference Include="System.Net.Http.Json" Version="3.2.1" />
+    <PackageReference Include="Microsoft.AspNetCore.JsonPatch" Version="5.0.0" />
+    <PackageReference Include="Microsoft.EntityFrameworkCore.Tools" Version="5.0.0">
+    <PackageReference Include="Microsoft.Extensions.Caching.Abstractions" Version="5.0.0" />
+    <PackageReference Include="System.Net.Http.Json" Version="5.0.0" />
</ItemGroup>
```

## <a name="update-docker-images"></a><span data-ttu-id="c9688-250">Atualizar imagens do Docker</span><span class="sxs-lookup"><span data-stu-id="c9688-250">Update Docker images</span></span>

<span data-ttu-id="c9688-251">Para aplicativos que usam o Docker,  atualize suas `FROM` instruções e scripts do Dockerfile.</span><span class="sxs-lookup"><span data-stu-id="c9688-251">For apps using Docker, update your *Dockerfile* `FROM` statements and scripts.</span></span> <span data-ttu-id="c9688-252">Use uma imagem base que inclua o tempo de execução do ASP.NET Core 5,0.</span><span class="sxs-lookup"><span data-stu-id="c9688-252">Use a base image that includes the ASP.NET Core 5.0 runtime.</span></span> <span data-ttu-id="c9688-253">Considere a seguinte `docker pull` diferença de comando entre ASP.NET Core 3,1 e 5,0:</span><span class="sxs-lookup"><span data-stu-id="c9688-253">Consider the following `docker pull` command difference between ASP.NET Core 3.1 and 5.0:</span></span>

```diff
- docker pull mcr.microsoft.com/dotnet/core/aspnet:3.1
+ docker pull mcr.microsoft.com/dotnet/aspnet:5.0
```

<span data-ttu-id="c9688-254">Como parte da mudança para ".NET" como o nome do produto, as imagens do Docker foram movidas dos `mcr.microsoft.com/dotnet/core` repositórios para `mcr.microsoft.com/dotnet` .</span><span class="sxs-lookup"><span data-stu-id="c9688-254">As part of the move to ".NET" as the product name, the Docker images moved from the `mcr.microsoft.com/dotnet/core` repositories to `mcr.microsoft.com/dotnet`.</span></span> <span data-ttu-id="c9688-255">Para obter mais informações, consulte [dotnet/dotnet-Docker # 1939](https://github.com/dotnet/dotnet-docker/issues/1939).</span><span class="sxs-lookup"><span data-stu-id="c9688-255">For more information, see [dotnet/dotnet-docker#1939](https://github.com/dotnet/dotnet-docker/issues/1939).</span></span>

## <a name="model-binding-changes-in-aspnet-core-mvc-and-no-locrazor-pages"></a><span data-ttu-id="c9688-256">Alterações de associação de modelo em ASP.NET Core MVC e Razor páginas</span><span class="sxs-lookup"><span data-stu-id="c9688-256">Model binding changes in ASP.NET Core MVC and Razor Pages</span></span>

### <a name="datetime-values-are-model-bound-as-utc-times"></a><span data-ttu-id="c9688-257">Os valores de data e hora são associados ao modelo como horários UTC</span><span class="sxs-lookup"><span data-stu-id="c9688-257">DateTime values are model bound as UTC times</span></span>

<span data-ttu-id="c9688-258">No ASP.NET Core 3,1 e anteriores, os `DateTime` valores eram associados ao modelo como hora local, em que o fuso horário foi determinado pelo servidor.</span><span class="sxs-lookup"><span data-stu-id="c9688-258">In ASP.NET Core 3.1 and earlier, `DateTime` values were model-bound as local time, where the timezone was determined by the server.</span></span> <span data-ttu-id="c9688-259">`DateTime` valores associados da formatação de entrada (JSON) e `DateTimeOffset` valores foram associados como fusos UTC.</span><span class="sxs-lookup"><span data-stu-id="c9688-259">`DateTime` values bound from input formatting (JSON) and `DateTimeOffset` values were bound as UTC timezones.</span></span>

<span data-ttu-id="c9688-260">No ASP.NET Core 5,0 e posterior, a associação de modelo associa `DateTime` valores consistentemente com o fuso horário UTC.</span><span class="sxs-lookup"><span data-stu-id="c9688-260">In ASP.NET Core 5.0 and later, model binding consistently binds `DateTime` values with the UTC timezone.</span></span>

<span data-ttu-id="c9688-261">Para manter o comportamento anterior, remova o `DateTimeModelBinderProvider` em `Startup.ConfigureServices` :</span><span class="sxs-lookup"><span data-stu-id="c9688-261">To retain the previous behavior, remove the `DateTimeModelBinderProvider` in `Startup.ConfigureServices`:</span></span>

```csharp
services.AddControllersWithViews(options => 
    options.ModelBinderProviders.RemoveType<DateTimeModelBinderProvider>());
```

### <a name="complexobjectmodelbinderprovider--complexobjectmodelbinder-replace-complextypemodelbinderprovider--complextypemodelbinder"></a><span data-ttu-id="c9688-262">ComplexObjectModelBinderProvider \ ComplexObjectModelBinder substituir ComplexTypeModelBinderProvider \ ComplexTypeModelBinder</span><span class="sxs-lookup"><span data-stu-id="c9688-262">ComplexObjectModelBinderProvider \ ComplexObjectModelBinder replace ComplexTypeModelBinderProvider \ ComplexTypeModelBinder</span></span>

<span data-ttu-id="c9688-263">Para adicionar suporte para tipos de [registro do C# 9](/dotnet/csharp/whats-new/csharp-9#record-types)de associação de modelos, o <xref:Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexTypeModelBinderProvider> é:</span><span class="sxs-lookup"><span data-stu-id="c9688-263">To add support for model binding [C# 9 record types](/dotnet/csharp/whats-new/csharp-9#record-types), the <xref:Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexTypeModelBinderProvider> is:</span></span>

* <span data-ttu-id="c9688-264">Anotado como obsoleto.</span><span class="sxs-lookup"><span data-stu-id="c9688-264">Annotated as obsolete.</span></span>
* <span data-ttu-id="c9688-265">Não é mais registrado por padrão.</span><span class="sxs-lookup"><span data-stu-id="c9688-265">No longer registered by default.</span></span>

<span data-ttu-id="c9688-266">Os aplicativos que dependem da presença do `ComplexTypeModelBinderProvider` na `ModelBinderProviders` coleção precisam referenciar o novo provedor de fichário:</span><span class="sxs-lookup"><span data-stu-id="c9688-266">Apps that rely on the presence of the `ComplexTypeModelBinderProvider` in the `ModelBinderProviders` collection need to reference the new binder provider:</span></span>

```diff
- var complexModelBinderProvider = options.ModelBinderProviders.OfType<ComplexTypeModelBinderProvider>();
+ var complexModelBinderProvider = options.ModelBinderProviders.OfType<ComplexObjectModelBinderProvider>();
```

## <a name="usedatabaseerrorpage-obsolete"></a><span data-ttu-id="c9688-267">UseDatabaseErrorPage obsoleto</span><span class="sxs-lookup"><span data-stu-id="c9688-267">UseDatabaseErrorPage obsolete</span></span>

<span data-ttu-id="c9688-268">Os modelos ASP.NET Core 3,1 que incluem uma opção para contas de usuário individuais geram uma chamada para <xref:Microsoft.AspNetCore.Builder.DatabaseErrorPageExtensions.UseDatabaseErrorPage%2A> .</span><span class="sxs-lookup"><span data-stu-id="c9688-268">The ASP.NET Core 3.1 templates that include an option for individual user accounts generate a call to <xref:Microsoft.AspNetCore.Builder.DatabaseErrorPageExtensions.UseDatabaseErrorPage%2A>.</span></span> <span data-ttu-id="c9688-269">`UseDatabaseErrorPage` Agora é obsoleto e deve ser substituído por uma combinação de `AddDatabaseDeveloperPageExceptionFilter` e `UseMigrationsEndPoint` , conforme mostrado no código a seguir:</span><span class="sxs-lookup"><span data-stu-id="c9688-269">`UseDatabaseErrorPage` is now obsolete and should be replaced with a combination of `AddDatabaseDeveloperPageExceptionFilter` and `UseMigrationsEndPoint`, as shown in the following code:</span></span>

```diff
public void ConfigureServices(IServiceCollection services)
{
    services.AddDbContext<ApplicationDbContext>(options =>
        options.UseSqlServer(
            Configuration.GetConnectionString("DefaultConnection")));
+   services.AddDatabaseDeveloperPageExceptionFilter();
    services.AddDefaultIdentity<IdentityUser>(options => options.SignIn.RequireConfirmedAccount = true)
        .AddEntityFrameworkStores<ApplicationDbContext>();
    services.AddRazorPages();
}

public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
{
    if (env.IsDevelopment())
    {
        app.UseDeveloperExceptionPage();
+       app.UseMigrationsEndPoint();
-       app.UseDatabaseErrorPage();
    }
    else
    {
        app.UseExceptionHandler("/Error");
        app.UseHsts();
    }
```

<span data-ttu-id="c9688-270">Para obter mais informações, consulte [este problema do GitHub](https://github.com/dotnet/aspnetcore/issues/24987).</span><span class="sxs-lookup"><span data-stu-id="c9688-270">For more information, see [this GitHub issue](https://github.com/dotnet/aspnetcore/issues/24987).</span></span>

## <a name="review-breaking-changes"></a><span data-ttu-id="c9688-271">Revisar alterações recentes</span><span class="sxs-lookup"><span data-stu-id="c9688-271">Review breaking changes</span></span>

<span data-ttu-id="c9688-272">Para alterações significativas do .NET Core 3,1 para o .NET 5,0, consulte [alterações recentes para a migração da versão 3,1 para a 5,0](/dotnet/core/compatibility/3.1-5.0).</span><span class="sxs-lookup"><span data-stu-id="c9688-272">For breaking changes from .NET Core 3.1 to .NET 5.0, see [Breaking changes for migration from version 3.1 to 5.0](/dotnet/core/compatibility/3.1-5.0).</span></span> <span data-ttu-id="c9688-273">ASP.NET Core e Entity Framework Core também estão incluídos na lista.</span><span class="sxs-lookup"><span data-stu-id="c9688-273">ASP.NET Core and Entity Framework Core are also included in the list.</span></span>
