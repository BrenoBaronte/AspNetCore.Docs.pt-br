---
title: "Solucionar problemas de núcleo do ASP.NET no IIS"
author: guardrex
description: "Saiba como diagnosticar problemas com as implantações do IIS de aplicativos do ASP.NET Core."
ms.author: riande
manager: wpickett
ms.custom: mvc
ms.date: 03/13/2017
ms.topic: article
ms.technology: aspnet
ms.prod: asp.net-core
uid: host-and-deploy/iis/troubleshoot
ms.openlocfilehash: 2e42d5904e2be8c031c5c6d4bbc104a251b699f2
ms.sourcegitcommit: 12e5194936b7e820efc5505a2d5d4f84e88eb5ef
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/11/2018
---
# <a name="troubleshoot-aspnet-core-on-iis"></a><span data-ttu-id="1b07e-103">Solucionar problemas de núcleo do ASP.NET no IIS</span><span class="sxs-lookup"><span data-stu-id="1b07e-103">Troubleshoot ASP.NET Core on IIS</span></span>

<span data-ttu-id="1b07e-104">Por [Luke Latham](https://github.com/guardrex)</span><span class="sxs-lookup"><span data-stu-id="1b07e-104">By [Luke Latham](https://github.com/guardrex)</span></span>

<span data-ttu-id="1b07e-105">Para diagnosticar problemas com as implantações do IIS:</span><span class="sxs-lookup"><span data-stu-id="1b07e-105">To diagnose issues with IIS deployments:</span></span>

* <span data-ttu-id="1b07e-106">Estude a saída do navegador.</span><span class="sxs-lookup"><span data-stu-id="1b07e-106">Study browser output.</span></span>
* <span data-ttu-id="1b07e-107">Examine o log de **Aplicativo** do sistema por meio do **Visualizador de eventos**.</span><span class="sxs-lookup"><span data-stu-id="1b07e-107">Examine the system's **Application** log through **Event Viewer**.</span></span>
* <span data-ttu-id="1b07e-108">Habilite o registro em log do `stdout`.</span><span class="sxs-lookup"><span data-stu-id="1b07e-108">Enable `stdout` logging.</span></span> <span data-ttu-id="1b07e-109">O log do **Módulo do ASP.NET Core** é encontrado no caminho fornecido no atributo *stdoutLogFile* do elemento `<aspNetCore>` em *web.config*. As pastas no caminho fornecido no valor do atributo devem existir na implantação.</span><span class="sxs-lookup"><span data-stu-id="1b07e-109">The **ASP.NET Core Module** log is found on the path provided in the *stdoutLogFile* attribute of the `<aspNetCore>` element in *web.config*. Any folders on the path provided in the attribute value must exist in the deployment.</span></span> <span data-ttu-id="1b07e-110">Definir *stdoutLogEnabled* para `true`.</span><span class="sxs-lookup"><span data-stu-id="1b07e-110">Set *stdoutLogEnabled* to `true`.</span></span> <span data-ttu-id="1b07e-111">Aplicativos que usam o o `Microsoft.NET.Sdk.Web` SDK para criar o *Web. config* padrão de arquivos o *stdoutLogEnabled* definindo como `false`, manualmente fornecem o *deWeb.config* de arquivos ou modificar o arquivo para habilitar `stdout` log.</span><span class="sxs-lookup"><span data-stu-id="1b07e-111">Apps that use the the `Microsoft.NET.Sdk.Web` SDK to create the *web.config* file default the *stdoutLogEnabled* setting to `false`, so manually provide the *web.config* file or modify the file in order to enable `stdout` logging.</span></span>

<span data-ttu-id="1b07e-112">Use as informações dessas três fontes com o [tópico de referência de erros comuns](xref:host-and-deploy/azure-iis-errors-reference) para determinar o problema.</span><span class="sxs-lookup"><span data-stu-id="1b07e-112">Use information from those three sources with the [common errors reference topic](xref:host-and-deploy/azure-iis-errors-reference) to determine the problem.</span></span> <span data-ttu-id="1b07e-113">Siga os avisos de solução de problemas fornecidos para resolver o problema.</span><span class="sxs-lookup"><span data-stu-id="1b07e-113">Follow the troubleshooting advice provided to resolve the issue.</span></span>

<span data-ttu-id="1b07e-114">Vários dos erros comuns não são exibidos no navegador, no Log do aplicativo e no Log do módulo do ASP.NET Core até que o módulo *startupTimeLimit* (padrão: 120 segundos) e *startupRetryCount* (padrão: 2) tenham decorrido.</span><span class="sxs-lookup"><span data-stu-id="1b07e-114">Several of the common errors don't appear in the browser, Application Log, and ASP.NET Core Module Log until the module *startupTimeLimit* (default: 120 seconds) and *startupRetryCount* (default: 2) have passed.</span></span> <span data-ttu-id="1b07e-115">Portanto, aguarde seis minutos completos antes de deduzir que o módulo falhou ao iniciar um processo para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1b07e-115">Therefore, wait a full six minutes before deducing that the module has failed to start a process for the app.</span></span>

<span data-ttu-id="1b07e-116">Uma maneira rápida de determinar se o aplicativo está funcionando corretamente é executar o aplicativo diretamente no Kestrel.</span><span class="sxs-lookup"><span data-stu-id="1b07e-116">One quick way to determine if the app is working properly is to run the app directly on Kestrel.</span></span> <span data-ttu-id="1b07e-117">Se o aplicativo foi publicado como um [implantação dependentes de framework](/dotnet/core/deploying/#framework-dependent-deployments-fdd), execute `dotnet <assembly_name>.dll` na pasta de implantação, que é o caminho físico do IIS para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1b07e-117">If the app was published as a [framework-dependent deployment](/dotnet/core/deploying/#framework-dependent-deployments-fdd), execute `dotnet <assembly_name>.dll` in the deployment folder, which is the IIS physical path to the app.</span></span> <span data-ttu-id="1b07e-118">Se o aplicativo foi publicado como um [implantação autossuficiente](/dotnet/core/deploying/#self-contained-deployments-scd), execute o aplicativo do executável diretamente a partir de um prompt de comando, `<assembly_name>.exe`, na pasta de implantação.</span><span class="sxs-lookup"><span data-stu-id="1b07e-118">If the app was published as a [self-contained deployment](/dotnet/core/deploying/#self-contained-deployments-scd), run the app's executable directly from a command prompt, `<assembly_name>.exe`, in the deployment folder.</span></span> <span data-ttu-id="1b07e-119">Se Kestrel está escutando na porta padrão 5000, o aplicativo deve estar disponível em `http://localhost:5000/`.</span><span class="sxs-lookup"><span data-stu-id="1b07e-119">If Kestrel is listening on default port 5000, the app should be available at `http://localhost:5000/`.</span></span> <span data-ttu-id="1b07e-120">Se o aplicativo normalmente responde no endereço de ponto de extremidade Kestrel, o problema é mais provável relacionados à configuração de proxy reverso e menos provável dentro do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1b07e-120">If the app responds normally at the Kestrel endpoint address, the problem is more likely related to the reverse proxy configuration and less likely within the app.</span></span>

<span data-ttu-id="1b07e-121">É uma maneira de determinar se o proxy reverso está funcionando corretamente executar uma solicitação de arquivo estático simples para uma folha de estilos, um script ou uma imagem de arquivos estáticos do aplicativo *wwwroot* usando [Middleware de arquivo estático](xref:fundamentals/static-files).</span><span class="sxs-lookup"><span data-stu-id="1b07e-121">One way to determine if the reverse proxy is working properly is to perform a simple static file request for a stylesheet, script, or image from the app's static files in *wwwroot* using [Static File Middleware](xref:fundamentals/static-files).</span></span> <span data-ttu-id="1b07e-122">Se o aplicativo pode servir arquivos estáticos, mas exibições do MVC e outros pontos de extremidade estão falhando, o problema é menos provável relacionados à configuração de proxy reverso e provavelmente dentro do aplicativo (por exemplo, o roteamento MVC ou 500 Erro interno do servidor).</span><span class="sxs-lookup"><span data-stu-id="1b07e-122">If the app can serve static files but MVC Views and other endpoints are failing, the problem is less likely related to the reverse proxy configuration and more likely within the app (for example, MVC routing or 500 Internal Server Error).</span></span>

<span data-ttu-id="1b07e-123">Quando Kestrel é iniciado normalmente por trás do IIS, mas o aplicativo não será executado no sistema depois de executado com êxito, uma variável de ambiente pode ser adicionada temporariamente para *Web. config* para definir o `ASPNETCORE_ENVIRONMENT` para `Development`.</span><span class="sxs-lookup"><span data-stu-id="1b07e-123">When Kestrel starts normally behind IIS but the app won't run on the system after successfully running locally, an environment variable can be temporarily added to *web.config* to set the `ASPNETCORE_ENVIRONMENT` to `Development`.</span></span> <span data-ttu-id="1b07e-124">Como o ambiente não é substituído na inicialização do aplicativo, definindo a variável de ambiente permite que o [página de exceção de desenvolvedor](xref:fundamentals/error-handling) aparecem quando o aplicativo é executado.</span><span class="sxs-lookup"><span data-stu-id="1b07e-124">As long as the environment isn't overridden in app startup, setting the environment variable allows the [developer exception page](xref:fundamentals/error-handling) to appear when the app is run.</span></span> <span data-ttu-id="1b07e-125">Definir a variável de ambiente para `ASPNETCORE_ENVIRONMENT` dessa maneira só é recomendado para servidores de preparo/teste que não são expostos à Internet.</span><span class="sxs-lookup"><span data-stu-id="1b07e-125">Setting the environment variable for `ASPNETCORE_ENVIRONMENT` in this way is only recommended for staging/testing servers that aren't exposed to the Internet.</span></span> <span data-ttu-id="1b07e-126">Certifique-se de remover a variável de ambiente a *Web. config* quando terminar de arquivo.</span><span class="sxs-lookup"><span data-stu-id="1b07e-126">Be sure to remove the environment variable from the *web.config* file when finished.</span></span> <span data-ttu-id="1b07e-127">Para obter informações sobre como definir variáveis de ambiente por meio de *Web. config*, consulte [environmentVariables elemento filho aspNetCore](xref:host-and-deploy/aspnet-core-module#setting-environment-variables).</span><span class="sxs-lookup"><span data-stu-id="1b07e-127">For information on setting environment variables via *web.config*, see [environmentVariables child element of aspNetCore](xref:host-and-deploy/aspnet-core-module#setting-environment-variables).</span></span>

<span data-ttu-id="1b07e-128">Na maioria dos casos, a habilitação do log do aplicativo ajudará na solução de problemas com o aplicativo ou o proxy reverso.</span><span class="sxs-lookup"><span data-stu-id="1b07e-128">In most cases, enabling application logging assists in troubleshooting problems with the app or the reverse proxy.</span></span> <span data-ttu-id="1b07e-129">Consulte [Log](xref:fundamentals/logging/index) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="1b07e-129">See [Logging](xref:fundamentals/logging/index) for more information.</span></span>

<span data-ttu-id="1b07e-130">A última dica de solução de problemas se refere aos aplicativos que não são executados depois de atualizar o .NET Core SDK nas versões de pacote ou de máquina de desenvolvimento dentro do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1b07e-130">The last troubleshooting tip pertains to apps that fail to run after upgrading either the .NET Core SDK on the development machine or package versions within the app.</span></span> <span data-ttu-id="1b07e-131">Em alguns casos, pacotes incoerentes podem interromper um aplicativo ao executar atualizações principais.</span><span class="sxs-lookup"><span data-stu-id="1b07e-131">In some cases, incoherent packages may break an app when performing major upgrades.</span></span> <span data-ttu-id="1b07e-132">A maioria desses problemas pode ser corrigida por:</span><span class="sxs-lookup"><span data-stu-id="1b07e-132">Most of these issues can be fixed by:</span></span>

* <span data-ttu-id="1b07e-133">Excluindo o `bin` e `obj` pastas no projeto.</span><span class="sxs-lookup"><span data-stu-id="1b07e-133">Deleting the `bin` and `obj` folders in the project.</span></span>
* <span data-ttu-id="1b07e-134">Pacote de compensação armazena em cache em `%UserProfile%\.nuget\packages\` e `%LocalAppData%\Nuget\v3-cache`.</span><span class="sxs-lookup"><span data-stu-id="1b07e-134">Clearing package caches at `%UserProfile%\.nuget\packages\` and `%LocalAppData%\Nuget\v3-cache`.</span></span>
* <span data-ttu-id="1b07e-135">A restauração e recompilar o projeto.</span><span class="sxs-lookup"><span data-stu-id="1b07e-135">Restoring and rebuilding the project.</span></span>
* <span data-ttu-id="1b07e-136">Confirmando que a implantação anterior no servidor foi excluída completamente antes de reimplantar o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1b07e-136">Confirming that the prior deployment on the server has been completely deleted prior to re-deploying the app.</span></span>

> [!TIP]
> <span data-ttu-id="1b07e-137">Uma maneira conveniente para Limpar caches do pacote é executar `dotnet nuget locals all --clear` em um prompt de comando.</span><span class="sxs-lookup"><span data-stu-id="1b07e-137">A convenient way to clear package caches is to execute `dotnet nuget locals all --clear` from a command prompt.</span></span>
> 
> <span data-ttu-id="1b07e-138">Limpar os caches de pacote também pode ser feito usando o [nuget.exe](https://www.nuget.org/downloads) ferramenta e executar o comando `nuget locals all -clear`.</span><span class="sxs-lookup"><span data-stu-id="1b07e-138">Clearing package caches can also be accomplished by using the [nuget.exe](https://www.nuget.org/downloads) tool and executing the command `nuget locals all -clear`.</span></span> <span data-ttu-id="1b07e-139">*NuGet.exe* não é uma instalação de pacote com o Windows 10 e devem ser obtidos separadamente do site do NuGet.</span><span class="sxs-lookup"><span data-stu-id="1b07e-139">*nuget.exe* isn't a bundled install with Windows 10 and must be obtained separately from the NuGet website.</span></span>
<!--
> [!TIP]
> A convenient way to clear package caches is to:
>
> * Obtain the *NuGet.exe* tool from [NuGet.org](https://www.nuget.org/).
> * Add the path to *NuGet.exe* to the system PATH.
> * Execute `nuget locals all -clear` from a command prompt.
>
> Alternatively, execute `dotnet nuget locals all --clear` from a command prompt without obtaining *NuGet.exe*. -->

## <a name="additional-resources"></a><span data-ttu-id="1b07e-140">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="1b07e-140">Additional resources</span></span>

* [<span data-ttu-id="1b07e-141">Referência de erros comuns para o Serviço de Aplicativo do Azure e o IIS com o ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="1b07e-141">Common errors reference for Azure App Service and IIS with ASP.NET Core</span></span>](xref:host-and-deploy/azure-iis-errors-reference)
* [<span data-ttu-id="1b07e-142">Referência de configuração do Módulo do ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="1b07e-142">ASP.NET Core Module configuration reference</span></span>](xref:host-and-deploy/aspnet-core-module)
