---
title: Hierarquia de finalidade e multilocação no ASP.NET Core
author: rick-anderson
description: Saiba mais sobre a hierarquia de cadeia de caracteres de finalidade e multilocação, pois ela se relaciona com as APIs de proteção de dados ASP.NET Core.
ms.author: riande
ms.date: 10/14/2016
no-loc:
- cookie
- Cookie
- Blazor
- Blazor Server
- Blazor WebAssembly
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: security/data-protection/consumer-apis/purpose-strings-multitenancy
ms.openlocfilehash: 4d442d3020c0d67b40ebd101442e5c84dcd4dbc6
ms.sourcegitcommit: 497be502426e9d90bb7d0401b1b9f74b6a384682
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/08/2020
ms.locfileid: "88022219"
---
# <a name="purpose-hierarchy-and-multi-tenancy-in-aspnet-core"></a><span data-ttu-id="b73cd-103">Hierarquia de finalidade e multilocação no ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="b73cd-103">Purpose hierarchy and multi-tenancy in ASP.NET Core</span></span>

<span data-ttu-id="b73cd-104">Como um `IDataProtector` também é implicitamente um `IDataProtectionProvider` , as finalidades podem ser encadeadas.</span><span class="sxs-lookup"><span data-stu-id="b73cd-104">Since an `IDataProtector` is also implicitly an `IDataProtectionProvider`, purposes can be chained together.</span></span> <span data-ttu-id="b73cd-105">Nesse sentido, `provider.CreateProtector([ "purpose1", "purpose2" ])` é equivalente a `provider.CreateProtector("purpose1").CreateProtector("purpose2")` .</span><span class="sxs-lookup"><span data-stu-id="b73cd-105">In this sense, `provider.CreateProtector([ "purpose1", "purpose2" ])` is equivalent to `provider.CreateProtector("purpose1").CreateProtector("purpose2")`.</span></span>

<span data-ttu-id="b73cd-106">Isso permite algumas relações hierárquicas interessantes por meio do sistema de proteção de dados.</span><span class="sxs-lookup"><span data-stu-id="b73cd-106">This allows for some interesting hierarchical relationships through the data protection system.</span></span> <span data-ttu-id="b73cd-107">No exemplo anterior de [contoso. Messaging. SecureMessage](xref:security/data-protection/consumer-apis/purpose-strings#data-protection-contoso-purpose), o componente SecureMessage pode chamar `provider.CreateProtector("Contoso.Messaging.SecureMessage")` uma vez na frente e armazenar em cache o resultado em um `_myProvider` campo particular.</span><span class="sxs-lookup"><span data-stu-id="b73cd-107">In the earlier example of [Contoso.Messaging.SecureMessage](xref:security/data-protection/consumer-apis/purpose-strings#data-protection-contoso-purpose), the SecureMessage component can call `provider.CreateProtector("Contoso.Messaging.SecureMessage")` once up-front and cache the result into a private `_myProvider` field.</span></span> <span data-ttu-id="b73cd-108">Os protetores futuros podem ser criados por meio de chamadas para `_myProvider.CreateProtector("User: username")` , e esses protetores seriam usados para proteger as mensagens individuais.</span><span class="sxs-lookup"><span data-stu-id="b73cd-108">Future protectors can then be created via calls to `_myProvider.CreateProtector("User: username")`, and these protectors would be used for securing the individual messages.</span></span>

<span data-ttu-id="b73cd-109">Isso também pode ser invertido.</span><span class="sxs-lookup"><span data-stu-id="b73cd-109">This can also be flipped.</span></span> <span data-ttu-id="b73cd-110">Considere um único aplicativo lógico que hospeda vários locatários (um CMS parece razoável) e cada locatário pode ser configurado com seu próprio sistema de gerenciamento de autenticação e estado.</span><span class="sxs-lookup"><span data-stu-id="b73cd-110">Consider a single logical application which hosts multiple tenants (a CMS seems reasonable), and each tenant can be configured with its own authentication and state management system.</span></span> <span data-ttu-id="b73cd-111">O aplicativo de segurança tem um único provedor mestre e chama `provider.CreateProtector("Tenant 1")` e `provider.CreateProtector("Tenant 2")` fornece a cada locatário sua própria fatia isolada do sistema de proteção de dados.</span><span class="sxs-lookup"><span data-stu-id="b73cd-111">The umbrella application has a single master provider, and it calls `provider.CreateProtector("Tenant 1")` and `provider.CreateProtector("Tenant 2")` to give each tenant its own isolated slice of the data protection system.</span></span> <span data-ttu-id="b73cd-112">Os locatários podem então derivar seus próprios protetores individuais com base em suas próprias necessidades, mas não importa o quão difícil eles tentam não poderem criar protetores que colidem com qualquer outro locatário no sistema.</span><span class="sxs-lookup"><span data-stu-id="b73cd-112">The tenants could then derive their own individual protectors based on their own needs, but no matter how hard they try they cannot create protectors which collide with any other tenant in the system.</span></span> <span data-ttu-id="b73cd-113">Graficamente, isso é representado como abaixo.</span><span class="sxs-lookup"><span data-stu-id="b73cd-113">Graphically, this is represented as below.</span></span>

![Propósitos de várias locação](purpose-strings-multitenancy/_static/purposes-multi-tenancy.png)

>[!WARNING]
> <span data-ttu-id="b73cd-115">Isso pressupõe que o aplicativo de proteção contra as APIs estão disponíveis para locatários individuais e que os locatários não podem executar código arbitrário no servidor.</span><span class="sxs-lookup"><span data-stu-id="b73cd-115">This assumes the umbrella application controls which APIs are available to individual tenants and that tenants cannot execute arbitrary code on the server.</span></span> <span data-ttu-id="b73cd-116">Se um locatário puder executar código arbitrário, ele poderá executar uma reflexão privada para interromper as garantias de isolamento ou simplesmente ler o material de chaveamento mestre diretamente e obter as subchaves desejadas.</span><span class="sxs-lookup"><span data-stu-id="b73cd-116">If a tenant can execute arbitrary code, they could perform private reflection to break the isolation guarantees, or they could just read the master keying material directly and derive whatever subkeys they desire.</span></span>

<span data-ttu-id="b73cd-117">O sistema de proteção de dados usa, na verdade, um tipo de multilocação em sua configuração padrão.</span><span class="sxs-lookup"><span data-stu-id="b73cd-117">The data protection system actually uses a sort of multi-tenancy in its default out-of-the-box configuration.</span></span> <span data-ttu-id="b73cd-118">Por padrão, o material de chave mestra é armazenado na pasta de perfil de usuário da conta de processo de trabalho (ou no registro, para identidades do pool de aplicativos do IIS).</span><span class="sxs-lookup"><span data-stu-id="b73cd-118">By default master keying material is stored in the worker process account's user profile folder (or the registry, for IIS application pool identities).</span></span> <span data-ttu-id="b73cd-119">Mas, na verdade, é bastante comum usar uma única conta para executar vários aplicativos e, portanto, todos esses aplicativos acabarão compartilhando o material de chaveamento mestre.</span><span class="sxs-lookup"><span data-stu-id="b73cd-119">But it's actually fairly common to use a single account to run multiple applications, and thus all these applications would end up sharing the master keying material.</span></span> <span data-ttu-id="b73cd-120">Para resolver isso, o sistema de proteção de dados insere automaticamente um identificador exclusivo por aplicativo como o primeiro elemento na cadeia de finalidade geral.</span><span class="sxs-lookup"><span data-stu-id="b73cd-120">To solve this, the data protection system automatically inserts a unique-per-application identifier as the first element in the overall purpose chain.</span></span> <span data-ttu-id="b73cd-121">Essa finalidade implícita serve para [isolar aplicativos individuais](xref:security/data-protection/configuration/overview#per-application-isolation) uns dos outros, tratando efetivamente de cada aplicativo como um locatário exclusivo no sistema, e o processo de criação de protetor é idêntico à imagem acima.</span><span class="sxs-lookup"><span data-stu-id="b73cd-121">This implicit purpose serves to [isolate individual applications](xref:security/data-protection/configuration/overview#per-application-isolation) from one another by effectively treating each application as a unique tenant within the system, and the protector creation process looks identical to the image above.</span></span>
