---
title: Proteção de dados do ASP.NET Core
author: rick-anderson
description: Saiba mais sobre o conceito de proteção de dados e os princípios de design de APIs de proteção de dados de ASP.NET Core.
ms.author: riande
ms.date: 10/14/2016
uid: security/data-protection/introduction
ms.openlocfilehash: 29a2bbef6f2fd9b61541173af143926ca82bfad7
ms.sourcegitcommit: 3ca527f27c88cfc9d04688db5499e372fbc2c775
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 07/17/2018
ms.locfileid: "39095689"
---
# <a name="aspnet-core-data-protection"></a><span data-ttu-id="a0dba-103">Proteção de dados do ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="a0dba-103">ASP.NET Core Data Protection</span></span>

<span data-ttu-id="a0dba-104">Aplicativos da Web geralmente precisam armazenar dados confidenciais de segurança.</span><span class="sxs-lookup"><span data-stu-id="a0dba-104">Web applications often need to store security-sensitive data.</span></span> <span data-ttu-id="a0dba-105">Windows fornece DPAPI para aplicativos da área de trabalho, mas isso é inadequado para aplicativos da web.</span><span class="sxs-lookup"><span data-stu-id="a0dba-105">Windows provides DPAPI for desktop applications but this is unsuitable for web applications.</span></span> <span data-ttu-id="a0dba-106">A pilha de proteção de dados do ASP.NET Core fornecem uma API de criptografia simple e fácil de usar um desenvolvedor pode usar para proteger dados, incluindo rotação e gerenciamento de chaves.</span><span class="sxs-lookup"><span data-stu-id="a0dba-106">The ASP.NET Core data protection stack provide a simple, easy to use cryptographic API a developer can use to protect data, including key management and rotation.</span></span>

<span data-ttu-id="a0dba-107">A pilha de proteção de dados do ASP.NET Core foi projetada para servir como a substituição de longo prazo para o &lt;machineKey&gt; elemento no ASP.NET 1. x - 4. x.</span><span class="sxs-lookup"><span data-stu-id="a0dba-107">The ASP.NET Core data protection stack is designed to serve as the long-term replacement for the &lt;machineKey&gt; element in ASP.NET 1.x - 4.x.</span></span> <span data-ttu-id="a0dba-108">Ele foi projetado para resolver muitos dos problemas da pilha de criptografia antigo, fornecendo uma solução para a maioria dos casos de uso, os aplicativos modernos têm probabilidade de encontrar.</span><span class="sxs-lookup"><span data-stu-id="a0dba-108">It was designed to address many of the shortcomings of the old cryptographic stack while providing an out-of-the-box solution for the majority of use cases modern applications are likely to encounter.</span></span>

## <a name="problem-statement"></a><span data-ttu-id="a0dba-109">Declaração do problema</span><span class="sxs-lookup"><span data-stu-id="a0dba-109">Problem statement</span></span>

<span data-ttu-id="a0dba-110">A declaração do problema geral pode ser declarada em uma única sentença sucintamente: eu preciso manter informações confiáveis para recuperação posterior, mas eu não confio o mecanismo de persistência.</span><span class="sxs-lookup"><span data-stu-id="a0dba-110">The overall problem statement can be succinctly stated in a single sentence: I need to persist trusted information for later retrieval, but I don't trust the persistence mechanism.</span></span> <span data-ttu-id="a0dba-111">Em termos de web, isso pode ser escrito como "Eu preciso de ida e volta estado confiável por meio de um cliente não confiável."</span><span class="sxs-lookup"><span data-stu-id="a0dba-111">In web terms, this might be written as "I need to round-trip trusted state via an untrusted client."</span></span>

<span data-ttu-id="a0dba-112">O exemplo canônico disso é um cookie de autenticação ou portador token.</span><span class="sxs-lookup"><span data-stu-id="a0dba-112">The canonical example of this is an authentication cookie or bearer token.</span></span> <span data-ttu-id="a0dba-113">O servidor gera um "Estou Groot e ter permissões de xyz" de token e entrega-o para o cliente.</span><span class="sxs-lookup"><span data-stu-id="a0dba-113">The server generates an "I am Groot and have xyz permissions" token and hands it to the client.</span></span> <span data-ttu-id="a0dba-114">Em uma data futura, o cliente apresentará esse token de volta para o servidor, mas o servidor precisa de algum tipo de garantia de que o cliente não foi forjada o token.</span><span class="sxs-lookup"><span data-stu-id="a0dba-114">At some future date the client will present that token back to the server, but the server needs some kind of assurance that the client hasn't forged the token.</span></span> <span data-ttu-id="a0dba-115">Portanto, o primeiro requisito: autenticidade (também conhecido como</span><span class="sxs-lookup"><span data-stu-id="a0dba-115">Thus the first requirement: authenticity (a.k.a.</span></span> <span data-ttu-id="a0dba-116">integridade e à prova de adulteração).</span><span class="sxs-lookup"><span data-stu-id="a0dba-116">integrity, tamper-proofing).</span></span>

<span data-ttu-id="a0dba-117">Uma vez que o estado persistente é confiável pelo servidor, estimamos que esse estado pode conter informações específicas para o ambiente operacional.</span><span class="sxs-lookup"><span data-stu-id="a0dba-117">Since the persisted state is trusted by the server, we anticipate that this state might contain information that's specific to the operating environment.</span></span> <span data-ttu-id="a0dba-118">Isso pode ser na forma de um caminho de arquivo, uma permissão, um identificador ou outra referência indireta, ou alguma outra parte dos dados específicos do servidor.</span><span class="sxs-lookup"><span data-stu-id="a0dba-118">This could be in the form of a file path, a permission, a handle or other indirect reference, or some other piece of server-specific data.</span></span> <span data-ttu-id="a0dba-119">Essas informações, em geral, não deveriam ser divulgadas para um cliente não confiável.</span><span class="sxs-lookup"><span data-stu-id="a0dba-119">Such information should generally not be disclosed to an untrusted client.</span></span> <span data-ttu-id="a0dba-120">Portanto, o segundo requisito: confidencialidade.</span><span class="sxs-lookup"><span data-stu-id="a0dba-120">Thus the second requirement: confidentiality.</span></span>

<span data-ttu-id="a0dba-121">Por fim, como aplicativos modernos são divididos em componentes, o que vimos é componentes individuais vai querer tirar proveito desse sistema sem levar em consideração outros componentes no sistema.</span><span class="sxs-lookup"><span data-stu-id="a0dba-121">Finally, since modern applications are componentized, what we've seen is that individual components will want to take advantage of this system without regard to other components in the system.</span></span> <span data-ttu-id="a0dba-122">Por exemplo, se um componente de token de portador é usando essa pilha, ele deve operar sem interferência de um mecanismo de anti-CSRF que também pode usar a mesma pilha.</span><span class="sxs-lookup"><span data-stu-id="a0dba-122">For instance, if a bearer token component is using this stack, it should operate without interference from an anti-CSRF mechanism that might also be using the same stack.</span></span> <span data-ttu-id="a0dba-123">Portanto, o requisito final: isolamento.</span><span class="sxs-lookup"><span data-stu-id="a0dba-123">Thus the final requirement: isolation.</span></span>

<span data-ttu-id="a0dba-124">Podemos fornecer ainda mais as restrições para limitar o escopo de nossos requisitos.</span><span class="sxs-lookup"><span data-stu-id="a0dba-124">We can provide further constraints in order to narrow the scope of our requirements.</span></span> <span data-ttu-id="a0dba-125">Vamos supor que todos os serviços que operam com o sistema de criptografia são igualmente confiáveis e que os dados não precisam ser gerado ou consumido fora os serviços sob nosso controle direto.</span><span class="sxs-lookup"><span data-stu-id="a0dba-125">We assume that all services operating within the cryptosystem are equally trusted and that the data doesn't need to be generated or consumed outside of the services under our direct control.</span></span> <span data-ttu-id="a0dba-126">Além disso, exigimos que as operações são tão rápidas quanto possível, pois cada solicitação ao serviço web pode percorrer o sistema criptográfico uma ou mais vezes.</span><span class="sxs-lookup"><span data-stu-id="a0dba-126">Furthermore, we require that operations are as fast as possible since each request to the web service might go through the cryptosystem one or more times.</span></span> <span data-ttu-id="a0dba-127">Isso torna a criptografia simétrica ideal para o nosso cenário, e podemos pode desconto criptografia assimétrica até que tal uma vez que ele é necessário.</span><span class="sxs-lookup"><span data-stu-id="a0dba-127">This makes symmetric cryptography ideal for our scenario, and we can discount asymmetric cryptography until such a time that it's needed.</span></span>

## <a name="design-philosophy"></a><span data-ttu-id="a0dba-128">Filosofia de design</span><span class="sxs-lookup"><span data-stu-id="a0dba-128">Design philosophy</span></span>

<span data-ttu-id="a0dba-129">Começamos por meio da identificação de problemas com a pilha existente.</span><span class="sxs-lookup"><span data-stu-id="a0dba-129">We started by identifying problems with the existing stack.</span></span> <span data-ttu-id="a0dba-130">Depois que tivermos, nós pesquisamos o panorama das soluções existentes e concluiu que não há solução existente teve muito os recursos que são procurados.</span><span class="sxs-lookup"><span data-stu-id="a0dba-130">Once we had that, we surveyed the landscape of existing solutions and concluded that no existing solution quite had the capabilities we sought.</span></span> <span data-ttu-id="a0dba-131">Em seguida, projetamos uma solução baseada em vários princípios de orientação.</span><span class="sxs-lookup"><span data-stu-id="a0dba-131">We then engineered a solution based on several guiding principles.</span></span>

* <span data-ttu-id="a0dba-132">O sistema deve oferecer a simplicidade da configuração.</span><span class="sxs-lookup"><span data-stu-id="a0dba-132">The system should offer simplicity of configuration.</span></span> <span data-ttu-id="a0dba-133">O ideal é que o sistema seria sem nenhuma configuração e os desenvolvedores poderiam parta para a ação.</span><span class="sxs-lookup"><span data-stu-id="a0dba-133">Ideally the system would be zero-configuration and developers could hit the ground running.</span></span> <span data-ttu-id="a0dba-134">Em situações em que os desenvolvedores precisam configurar um aspecto específico (como o repositório de chaves), consideração deve ser fornecida a fazer essas configurações específicas simples.</span><span class="sxs-lookup"><span data-stu-id="a0dba-134">In situations where developers need to configure a specific aspect (such as the key repository), consideration should be given to making those specific configurations simple.</span></span>

* <span data-ttu-id="a0dba-135">Oferecem uma API voltado ao consumidor simples.</span><span class="sxs-lookup"><span data-stu-id="a0dba-135">Offer a simple consumer-facing API.</span></span> <span data-ttu-id="a0dba-136">As APIs devem ser fáceis de usar corretamente e difícil de usar incorretamente.</span><span class="sxs-lookup"><span data-stu-id="a0dba-136">The APIs should be easy to use correctly and difficult to use incorrectly.</span></span>

* <span data-ttu-id="a0dba-137">Os desenvolvedores não devem aprender os princípios de gerenciamento de chaves.</span><span class="sxs-lookup"><span data-stu-id="a0dba-137">Developers shouldn't learn key management principles.</span></span> <span data-ttu-id="a0dba-138">O sistema deve lidar com a seleção de algoritmo e a vida útil da chave em nome do desenvolvedor.</span><span class="sxs-lookup"><span data-stu-id="a0dba-138">The system should handle algorithm selection and key lifetime on the developer's behalf.</span></span> <span data-ttu-id="a0dba-139">O ideal é que o desenvolvedor nunca mesmo deve ter acesso ao material da chave bruto.</span><span class="sxs-lookup"><span data-stu-id="a0dba-139">Ideally the developer should never even have access to the raw key material.</span></span>

* <span data-ttu-id="a0dba-140">As chaves devem ser protegidas em repouso quando possível.</span><span class="sxs-lookup"><span data-stu-id="a0dba-140">Keys should be protected at rest when possible.</span></span> <span data-ttu-id="a0dba-141">O sistema deve descobrir um mecanismo de proteção padrão apropriado e aplicá-la automaticamente.</span><span class="sxs-lookup"><span data-stu-id="a0dba-141">The system should figure out an appropriate default protection mechanism and apply it automatically.</span></span>

<span data-ttu-id="a0dba-142">Com esses princípios em mente, desenvolvemos um simples [fácil de usar](xref:security/data-protection/using-data-protection) pilha da proteção de dados.</span><span class="sxs-lookup"><span data-stu-id="a0dba-142">With these principles in mind we developed a simple, [easy to use](xref:security/data-protection/using-data-protection) data protection stack.</span></span>

<span data-ttu-id="a0dba-143">As APIs de proteção de dados do ASP.NET Core não destinam principalmente para persistência indefinida de cargas confidenciais.</span><span class="sxs-lookup"><span data-stu-id="a0dba-143">The ASP.NET Core data protection APIs are not primarily intended for indefinite persistence of confidential payloads.</span></span> <span data-ttu-id="a0dba-144">Outras tecnologias, como [DPAPI do Windows CNG](https://msdn.microsoft.com/library/windows/desktop/hh706794%28v=vs.85%29.aspx) e [do Azure Rights Management](https://docs.microsoft.com/rights-management/) são mais adequados para o cenário de armazenamento indefinido, e eles têm recursos de gerenciamento de chave forte de forma correspondente.</span><span class="sxs-lookup"><span data-stu-id="a0dba-144">Other technologies like [Windows CNG DPAPI](https://msdn.microsoft.com/library/windows/desktop/hh706794%28v=vs.85%29.aspx) and [Azure Rights Management](https://docs.microsoft.com/rights-management/) are more suited to the scenario of indefinite storage, and they have correspondingly strong key management capabilities.</span></span> <span data-ttu-id="a0dba-145">Dito isso, não há nada proibindo um desenvolvedor que usa as APIs de proteção de dados do ASP.NET Core para proteção de longo prazo de dados confidenciais.</span><span class="sxs-lookup"><span data-stu-id="a0dba-145">That said, there's nothing prohibiting a developer from using the ASP.NET Core data protection APIs for long-term protection of confidential data.</span></span>

## <a name="audience"></a><span data-ttu-id="a0dba-146">Público-alvo</span><span class="sxs-lookup"><span data-stu-id="a0dba-146">Audience</span></span>

<span data-ttu-id="a0dba-147">O sistema de proteção de dados é dividido em cinco pacotes principais.</span><span class="sxs-lookup"><span data-stu-id="a0dba-147">The data protection system is divided into five main packages.</span></span> <span data-ttu-id="a0dba-148">Vários aspectos dessas APIs três principal públicos-alvo; de destino</span><span class="sxs-lookup"><span data-stu-id="a0dba-148">Various aspects of these APIs target three main audiences;</span></span>

1. <span data-ttu-id="a0dba-149">O [visão geral das APIs de consumidor](xref:security/data-protection/consumer-apis/overview) os desenvolvedores de aplicativo e estrutura de destino.</span><span class="sxs-lookup"><span data-stu-id="a0dba-149">The [Consumer APIs Overview](xref:security/data-protection/consumer-apis/overview) target application and framework developers.</span></span>

   <span data-ttu-id="a0dba-150">"Quero saber mais sobre como funciona a pilha de ou sobre como ela é configurada.</span><span class="sxs-lookup"><span data-stu-id="a0dba-150">"I don't want to learn about how the stack operates or about how it's configured.</span></span> <span data-ttu-id="a0dba-151">Simplesmente quero executar alguma operação no tão simples uma maneira possível com a alta probabilidade de usar as APIs com êxito".</span><span class="sxs-lookup"><span data-stu-id="a0dba-151">I simply want to perform some operation in as simple a manner as possible with high probability of using the APIs successfully."</span></span>

2. <span data-ttu-id="a0dba-152">O [APIs de configuração](xref:security/data-protection/configuration/overview) os desenvolvedores de aplicativos e administradores de sistema de destino.</span><span class="sxs-lookup"><span data-stu-id="a0dba-152">The [configuration APIs](xref:security/data-protection/configuration/overview) target application developers and system administrators.</span></span>

   <span data-ttu-id="a0dba-153">"Eu preciso informar ao sistema de proteção de dados de que meu ambiente requer configurações ou os caminhos não padrão."</span><span class="sxs-lookup"><span data-stu-id="a0dba-153">"I need to tell the data protection system that my environment requires non-default paths or settings."</span></span>

3. <span data-ttu-id="a0dba-154">Os desenvolvedores de destino APIs de extensibilidade responsável pela implementação de política personalizada.</span><span class="sxs-lookup"><span data-stu-id="a0dba-154">The extensibility APIs target developers in charge of implementing custom policy.</span></span> <span data-ttu-id="a0dba-155">O uso dessas APIs seria limitado a situações raras e experientes, os desenvolvedores de reconhecimento de segurança.</span><span class="sxs-lookup"><span data-stu-id="a0dba-155">Usage of these APIs would be limited to rare situations and experienced, security aware developers.</span></span>

   <span data-ttu-id="a0dba-156">"Eu preciso substituir um componente inteiro dentro do sistema porque tenho requisitos comportamentais realmente exclusivos.</span><span class="sxs-lookup"><span data-stu-id="a0dba-156">"I need to replace an entire component within the system because I have truly unique behavioral requirements.</span></span> <span data-ttu-id="a0dba-157">Desejo saber usados raramente partes da superfície de API a fim de criar um plug-in que atenda aos meus requisitos."</span><span class="sxs-lookup"><span data-stu-id="a0dba-157">I am willing to learn uncommonly-used parts of the API surface in order to build a plugin that fulfills my requirements."</span></span>

## <a name="package-layout"></a><span data-ttu-id="a0dba-158">Layout do pacote</span><span class="sxs-lookup"><span data-stu-id="a0dba-158">Package Layout</span></span>

<span data-ttu-id="a0dba-159">A pilha da proteção de dados consiste em cinco pacotes.</span><span class="sxs-lookup"><span data-stu-id="a0dba-159">The data protection stack consists of five packages.</span></span>

* <span data-ttu-id="a0dba-160">Microsoft.AspNetCore.DataProtection.Abstractions contém as interfaces IDataProtectionProvider e IDataProtector básicas.</span><span class="sxs-lookup"><span data-stu-id="a0dba-160">Microsoft.AspNetCore.DataProtection.Abstractions contains the basic IDataProtectionProvider and IDataProtector interfaces.</span></span> <span data-ttu-id="a0dba-161">Ele também contém métodos de extensão úteis que podem ajudar a trabalhar com esses tipos (por exemplo, sobrecargas de IDataProtector.Protect).</span><span class="sxs-lookup"><span data-stu-id="a0dba-161">It also contains useful extension methods that can assist working with these types (e.g., overloads of IDataProtector.Protect).</span></span> <span data-ttu-id="a0dba-162">Consulte a seção de interfaces de consumidor para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="a0dba-162">See the consumer interfaces section for more information.</span></span> <span data-ttu-id="a0dba-163">Se outra pessoa é responsável por instanciar o sistema de proteção de dados e você simplesmente está consumindo as APIs, você vai querer Microsoft.AspNetCore.DataProtection.Abstractions de referência.</span><span class="sxs-lookup"><span data-stu-id="a0dba-163">If somebody else is responsible for instantiating the data protection system and you are simply consuming the APIs, you'll want to reference Microsoft.AspNetCore.DataProtection.Abstractions.</span></span>

* <span data-ttu-id="a0dba-164">Microsoft.AspNetCore.DataProtection contém a implementação principal do sistema de proteção de dados, incluindo as principais operações criptográficas, gerenciamento de chaves, configuração e extensibilidade.</span><span class="sxs-lookup"><span data-stu-id="a0dba-164">Microsoft.AspNetCore.DataProtection contains the core implementation of the data protection system, including the core cryptographic operations, key management, configuration, and extensibility.</span></span> <span data-ttu-id="a0dba-165">Se você é responsável por instanciar o sistema de proteção de dados (por exemplo, adicioná-lo para um IServiceCollection) ou modificar ou estender seu comportamento, você vai querer Microsoft.AspNetCore.DataProtection de referência.</span><span class="sxs-lookup"><span data-stu-id="a0dba-165">If you're responsible for instantiating the data protection system (e.g., adding it to an IServiceCollection) or modifying or extending its behavior, you'll want to reference Microsoft.AspNetCore.DataProtection.</span></span>

* <span data-ttu-id="a0dba-166">Microsoft.AspNetCore.DataProtection.Extensions contém APIs adicionais que os desenvolvedores podem ser úteis, mas que não cabem no pacote principal.</span><span class="sxs-lookup"><span data-stu-id="a0dba-166">Microsoft.AspNetCore.DataProtection.Extensions contains additional APIs which developers might find useful but which don't belong in the core package.</span></span> <span data-ttu-id="a0dba-167">Por exemplo, este pacote contém uma API simples "instanciar o sistema que aponta para um diretório de armazenamento de chaves sem nenhuma configuração de injeção de dependência" (mais informações).</span><span class="sxs-lookup"><span data-stu-id="a0dba-167">For instance, this package contains a simple "instantiate the system pointing at a specific key storage directory with no dependency injection setup" API (more info).</span></span> <span data-ttu-id="a0dba-168">Ele também contém métodos de extensão para limitar o tempo de vida de cargas protegidas (mais informações).</span><span class="sxs-lookup"><span data-stu-id="a0dba-168">It also contains extension methods for limiting the lifetime of protected payloads (more info).</span></span>

* <span data-ttu-id="a0dba-169">Microsoft.AspNetCore.DataProtection.SystemWeb pode ser instalado em um aplicativo de 4.x ASP.NET existente para redirecionar seu &lt;machineKey&gt; operações em vez disso, usar a nova pilha de proteção de dados.</span><span class="sxs-lookup"><span data-stu-id="a0dba-169">Microsoft.AspNetCore.DataProtection.SystemWeb can be installed into an existing ASP.NET 4.x application to redirect its &lt;machineKey&gt; operations to instead use the new data protection stack.</span></span> <span data-ttu-id="a0dba-170">Ver [compatibilidade](xref:security/data-protection/compatibility/replacing-machinekey#compatibility-replacing-machinekey) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="a0dba-170">See [compatibility](xref:security/data-protection/compatibility/replacing-machinekey#compatibility-replacing-machinekey) for more information.</span></span>

* <span data-ttu-id="a0dba-171">Microsoft.AspNetCore.Cryptography.KeyDerivation fornece uma implementação da rotina de hash de senha de PBKDF2 e podem ser usadas por sistemas que precisam lidar com as senhas de usuário com segurança.</span><span class="sxs-lookup"><span data-stu-id="a0dba-171">Microsoft.AspNetCore.Cryptography.KeyDerivation provides an implementation of the PBKDF2 password hashing routine and can be used by systems which need to handle user passwords securely.</span></span> <span data-ttu-id="a0dba-172">Ver [senhas de Hash](xref:security/data-protection/consumer-apis/password-hashing) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="a0dba-172">See [Hash passwords](xref:security/data-protection/consumer-apis/password-hashing) for more information.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="a0dba-173">Recursos adicionais</span><span class="sxs-lookup"><span data-stu-id="a0dba-173">Additional resources</span></span>

<xref:host-and-deploy/web-farm>
