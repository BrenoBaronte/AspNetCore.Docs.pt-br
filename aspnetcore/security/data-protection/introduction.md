---
title: "Introdução à proteção de dados"
author: rick-anderson
description: "Este documento apresenta o conceito de proteção de dados e descreve os princípios de design das APIs de núcleo do ASP.NET associado."
keywords: "ASP.NET Core, proteção de dados"
ms.author: riande
manager: wpickett
ms.date: 10/14/2016
ms.topic: article
ms.assetid: 4542cd37-b47c-454c-be19-d1b5810d67fe
ms.technology: aspnet
ms.prod: asp.net-core
uid: security/data-protection/introduction
ms.openlocfilehash: dd34f2e69ea0f6427ee5f446d6440dfab17a42c4
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/10/2017
---
# <a name="introduction-to-data-protection"></a><span data-ttu-id="694f5-104">Introdução à proteção de dados</span><span class="sxs-lookup"><span data-stu-id="694f5-104">Introduction to Data Protection</span></span>

<span data-ttu-id="694f5-105">Aplicativos da Web geralmente necessário armazenar dados confidenciais.</span><span class="sxs-lookup"><span data-stu-id="694f5-105">Web applications often need to store security-sensitive data.</span></span> <span data-ttu-id="694f5-106">O Windows fornece DPAPI para aplicativos de desktop, mas isso é inadequado para aplicativos da web.</span><span class="sxs-lookup"><span data-stu-id="694f5-106">Windows provides DPAPI for desktop applications but this is unsuitable for web applications.</span></span> <span data-ttu-id="694f5-107">A pilha de proteção de dados do ASP.NET Core fornecem uma API de criptografia simple e fácil de usar um desenvolvedor pode usar para proteger dados, incluindo gerenciamento de chave e rotação.</span><span class="sxs-lookup"><span data-stu-id="694f5-107">The ASP.NET Core data protection stack provide a simple, easy to use cryptographic API a developer can use to protect data, including key management and rotation.</span></span>

<span data-ttu-id="694f5-108">A pilha de proteção de dados do ASP.NET Core foi projetada para servir como a substituição de longo prazo para o <machineKey> elemento no ASP.NET 1. x - 4. x.</span><span class="sxs-lookup"><span data-stu-id="694f5-108">The ASP.NET Core data protection stack is designed to serve as the long-term replacement for the <machineKey> element in ASP.NET 1.x - 4.x.</span></span> <span data-ttu-id="694f5-109">Ele foi projetado para resolver muitos dos problemas da pilha de criptografia antigo enquanto fornece uma solução para a maioria dos casos de uso, os aplicativos modernos têm probabilidade de encontrar.</span><span class="sxs-lookup"><span data-stu-id="694f5-109">It was designed to address many of the shortcomings of the old cryptographic stack while providing an out-of-the-box solution for the majority of use cases modern applications are likely to encounter.</span></span>

## <a name="problem-statement"></a><span data-ttu-id="694f5-110">Declaração do problema</span><span class="sxs-lookup"><span data-stu-id="694f5-110">Problem statement</span></span>

<span data-ttu-id="694f5-111">A declaração do problema geral pode ser declarada em um único sentença sucintamente: necessário manter informações confiáveis para recuperação posterior, mas não confia que o mecanismo de persistência.</span><span class="sxs-lookup"><span data-stu-id="694f5-111">The overall problem statement can be succinctly stated in a single sentence: I need to persist trusted information for later retrieval, but I do not trust the persistence mechanism.</span></span> <span data-ttu-id="694f5-112">Em termos de web, isso pode ser escrito como "Preciso ir e voltar estado confiável por meio de um cliente não confiável."</span><span class="sxs-lookup"><span data-stu-id="694f5-112">In web terms, this might be written as "I need to round-trip trusted state via an untrusted client."</span></span>

<span data-ttu-id="694f5-113">O exemplo canônico disso é um cookie de autenticação ou portador token.</span><span class="sxs-lookup"><span data-stu-id="694f5-113">The canonical example of this is an authentication cookie or bearer token.</span></span> <span data-ttu-id="694f5-114">O servidor gera um "Estou Groot e ter permissões de xyz" token e encaminha-lo ao cliente.</span><span class="sxs-lookup"><span data-stu-id="694f5-114">The server generates an "I am Groot and have xyz permissions" token and hands it to the client.</span></span> <span data-ttu-id="694f5-115">No futuro, o cliente apresentará esse token para o servidor, mas o servidor precisa de algum tipo de garantia de que o cliente não foi forjada o token.</span><span class="sxs-lookup"><span data-stu-id="694f5-115">At some future date the client will present that token back to the server, but the server needs some kind of assurance that the client hasn't forged the token.</span></span> <span data-ttu-id="694f5-116">Portanto, o primeiro requisito: autenticidade (também conhecido como</span><span class="sxs-lookup"><span data-stu-id="694f5-116">Thus the first requirement: authenticity (a.k.a.</span></span> <span data-ttu-id="694f5-117">integridade e à prova de adulteração).</span><span class="sxs-lookup"><span data-stu-id="694f5-117">integrity, tamper-proofing).</span></span>

<span data-ttu-id="694f5-118">Como o estado persistente é confiável pelo servidor, estimamos que esse estado pode conter informações específicas para o ambiente operacional.</span><span class="sxs-lookup"><span data-stu-id="694f5-118">Since the persisted state is trusted by the server, we anticipate that this state might contain information that is specific to the operating environment.</span></span> <span data-ttu-id="694f5-119">Isso pode ser na forma de um caminho de arquivo, uma permissão, um identificador ou outra referência indireta ou alguma outra parte de dados específico do servidor.</span><span class="sxs-lookup"><span data-stu-id="694f5-119">This could be in the form of a file path, a permission, a handle or other indirect reference, or some other piece of server-specific data.</span></span> <span data-ttu-id="694f5-120">Essas informações, geralmente, não devem ser reveladas para um cliente não confiável.</span><span class="sxs-lookup"><span data-stu-id="694f5-120">Such information should generally not be disclosed to an untrusted client.</span></span> <span data-ttu-id="694f5-121">Portanto, o segundo requisito: confidencialidade.</span><span class="sxs-lookup"><span data-stu-id="694f5-121">Thus the second requirement: confidentiality.</span></span>

<span data-ttu-id="694f5-122">Finalmente, desde que os aplicativos modernos são componentizados, o que vimos é que componentes individuais queira tirar proveito do sistema sem considerar outros componentes no sistema.</span><span class="sxs-lookup"><span data-stu-id="694f5-122">Finally, since modern applications are componentized, what we've seen is that individual components will want to take advantage of this system without regard to other components in the system.</span></span> <span data-ttu-id="694f5-123">Por exemplo, se um componente de token de portador está usando esta pilha, ele deve operar sem interferência de um mecanismo de anti-CSRF que também pode usar a mesma pilha.</span><span class="sxs-lookup"><span data-stu-id="694f5-123">For instance, if a bearer token component is using this stack, it should operate without interference from an anti-CSRF mechanism that might also be using the same stack.</span></span> <span data-ttu-id="694f5-124">Portanto, o requisito de final: isolamento.</span><span class="sxs-lookup"><span data-stu-id="694f5-124">Thus the final requirement: isolation.</span></span>

<span data-ttu-id="694f5-125">Podemos fornecer mais restrições para restringir o escopo dos nossos requisitos.</span><span class="sxs-lookup"><span data-stu-id="694f5-125">We can provide further constraints in order to narrow the scope of our requirements.</span></span> <span data-ttu-id="694f5-126">Vamos supor que todos os serviços que operam com o criptográfico são igualmente confiáveis e que os dados não precisam ser gerado ou consumido fora os serviços em nosso controle direto.</span><span class="sxs-lookup"><span data-stu-id="694f5-126">We assume that all services operating within the cryptosystem are equally trusted and that the data does not need to be generated or consumed outside of the services under our direct control.</span></span> <span data-ttu-id="694f5-127">Além disso, é necessário que as operações são tão rápidas quanto possível, desde que cada solicitação ao serviço web pode percorrer o criptográfico uma ou mais vezes.</span><span class="sxs-lookup"><span data-stu-id="694f5-127">Furthermore, we require that operations are as fast as possible since each request to the web service might go through the cryptosystem one or more times.</span></span> <span data-ttu-id="694f5-128">Isso torna a criptografia simétrica ideal para o nosso cenário, e nós pode desconto criptografia assimétrica até como uma hora que é necessário.</span><span class="sxs-lookup"><span data-stu-id="694f5-128">This makes symmetric cryptography ideal for our scenario, and we can discount asymmetric cryptography until such a time that it is needed.</span></span>

## <a name="design-philosophy"></a><span data-ttu-id="694f5-129">Filosofia de design</span><span class="sxs-lookup"><span data-stu-id="694f5-129">Design philosophy</span></span>

<span data-ttu-id="694f5-130">Começamos identificando problemas com a pilha existente.</span><span class="sxs-lookup"><span data-stu-id="694f5-130">We started by identifying problems with the existing stack.</span></span> <span data-ttu-id="694f5-131">Depois que tivemos que, podemos pesquisadas o cenário de soluções existentes e concluiu que nenhuma solução existente tinha muito dos recursos que são procurados.</span><span class="sxs-lookup"><span data-stu-id="694f5-131">Once we had that, we surveyed the landscape of existing solutions and concluded that no existing solution quite had the capabilities we sought.</span></span> <span data-ttu-id="694f5-132">Em seguida, projetamos uma solução baseada em vários princípios.</span><span class="sxs-lookup"><span data-stu-id="694f5-132">We then engineered a solution based on several guiding principles.</span></span>

* <span data-ttu-id="694f5-133">O sistema deve oferecer simplicidade de configuração.</span><span class="sxs-lookup"><span data-stu-id="694f5-133">The system should offer simplicity of configuration.</span></span> <span data-ttu-id="694f5-134">O ideal é o sistema seria nenhuma configuração e os desenvolvedores foi atingido o início em execução.</span><span class="sxs-lookup"><span data-stu-id="694f5-134">Ideally the system would be zero-configuration and developers could hit the ground running.</span></span> <span data-ttu-id="694f5-135">Em situações em que os desenvolvedores precisam configurar um aspecto específico (como o repositório de chaves), consideração deve ser fornecida a fazer essas configurações específicas simples.</span><span class="sxs-lookup"><span data-stu-id="694f5-135">In situations where developers need to configure a specific aspect (such as the key repository), consideration should be given to making those specific configurations simple.</span></span>

* <span data-ttu-id="694f5-136">Oferece uma API simples do voltado ao consumidor.</span><span class="sxs-lookup"><span data-stu-id="694f5-136">Offer a simple consumer-facing API.</span></span> <span data-ttu-id="694f5-137">As APIs deve ser fácil de usar corretamente e difícil de usar incorretamente.</span><span class="sxs-lookup"><span data-stu-id="694f5-137">The APIs should be easy to use correctly and difficult to use incorrectly.</span></span>

* <span data-ttu-id="694f5-138">Os desenvolvedores não devem conhecer os princípios de gerenciamento de chaves.</span><span class="sxs-lookup"><span data-stu-id="694f5-138">Developers should not learn key management principles.</span></span> <span data-ttu-id="694f5-139">O sistema deve lidar com a seleção do algoritmo e a vida útil da chave em nome do desenvolvedor.</span><span class="sxs-lookup"><span data-stu-id="694f5-139">The system should handle algorithm selection and key lifetime on the developer's behalf.</span></span> <span data-ttu-id="694f5-140">Idealmente o desenvolvedor nunca mesmo deve ter acesso ao material de chave bruto.</span><span class="sxs-lookup"><span data-stu-id="694f5-140">Ideally the developer should never even have access to the raw key material.</span></span>

* <span data-ttu-id="694f5-141">As chaves devem ser protegidas em repouso quando possível.</span><span class="sxs-lookup"><span data-stu-id="694f5-141">Keys should be protected at rest when possible.</span></span> <span data-ttu-id="694f5-142">O sistema deve descobrir um mecanismo de proteção padrão apropriado e aplicá-lo automaticamente.</span><span class="sxs-lookup"><span data-stu-id="694f5-142">The system should figure out an appropriate default protection mechanism and apply it automatically.</span></span>

<span data-ttu-id="694f5-143">Esses princípios em mente, desenvolvemos um simples, [fácil de usar](using-data-protection.md) pilha de proteção de dados.</span><span class="sxs-lookup"><span data-stu-id="694f5-143">With these principles in mind we developed a simple, [easy to use](using-data-protection.md) data protection stack.</span></span>

<span data-ttu-id="694f5-144">A proteção de dados do ASP.NET Core APIs não são principalmente para persistência indefinida de cargas confidenciais.</span><span class="sxs-lookup"><span data-stu-id="694f5-144">The ASP.NET Core data protection APIs are not primarily intended for indefinite persistence of confidential payloads.</span></span> <span data-ttu-id="694f5-145">Outras tecnologias, como [Windows CNG DPAPI](https://msdn.microsoft.com/library/windows/desktop/hh706794%28v=vs.85%29.aspx) e [Azure Rights Management](https://docs.microsoft.com/rights-management/) são mais adequados para o cenário de armazenamento indefinido, e eles têm recursos de gerenciamento de chave forte de forma correspondente.</span><span class="sxs-lookup"><span data-stu-id="694f5-145">Other technologies like [Windows CNG DPAPI](https://msdn.microsoft.com/library/windows/desktop/hh706794%28v=vs.85%29.aspx) and [Azure Rights Management](https://docs.microsoft.com/rights-management/) are more suited to the scenario of indefinite storage, and they have correspondingly strong key management capabilities.</span></span> <span data-ttu-id="694f5-146">Dito isso, não há nada proibindo um desenvolvedor usa as APIs de proteção de dados ASP.NET Core para proteção de longo prazo de dados confidenciais.</span><span class="sxs-lookup"><span data-stu-id="694f5-146">That said, there is nothing prohibiting a developer from using the ASP.NET Core data protection APIs for long-term protection of confidential data.</span></span>

## <a name="audience"></a><span data-ttu-id="694f5-147">Público-alvo</span><span class="sxs-lookup"><span data-stu-id="694f5-147">Audience</span></span>

<span data-ttu-id="694f5-148">O sistema de proteção de dados é dividido em cinco pacotes principais.</span><span class="sxs-lookup"><span data-stu-id="694f5-148">The data protection system is divided into five main packages.</span></span> <span data-ttu-id="694f5-149">Vários aspectos dessas APIs três público principal; de destino</span><span class="sxs-lookup"><span data-stu-id="694f5-149">Various aspects of these APIs target three main audiences;</span></span>

1. <span data-ttu-id="694f5-150">O [visão geral de APIs do consumidor](consumer-apis/overview.md) os desenvolvedores de aplicativo e do framework de destino.</span><span class="sxs-lookup"><span data-stu-id="694f5-150">The [Consumer APIs Overview](consumer-apis/overview.md) target application and framework developers.</span></span>

   <span data-ttu-id="694f5-151">"Quero saber mais sobre como funciona a pilha de ou sobre como ele está configurado.</span><span class="sxs-lookup"><span data-stu-id="694f5-151">"I don't want to learn about how the stack operates or about how it is configured.</span></span> <span data-ttu-id="694f5-152">Simplesmente desejo executar alguma operação no simples assim uma maneira possível com alta probabilidade de usar as APIs com êxito."</span><span class="sxs-lookup"><span data-stu-id="694f5-152">I simply want to perform some operation in as simple a manner as possible with high probability of using the APIs successfully."</span></span>

2. <span data-ttu-id="694f5-153">O [APIs de configuração](configuration/overview.md) os desenvolvedores de aplicativos e os administradores do sistema de destino.</span><span class="sxs-lookup"><span data-stu-id="694f5-153">The [configuration APIs](configuration/overview.md) target application developers and system administrators.</span></span>

   <span data-ttu-id="694f5-154">"Eu preciso informar o sistema de proteção de dados que o meu ambiente requer caminhos não padrão ou as configurações".</span><span class="sxs-lookup"><span data-stu-id="694f5-154">"I need to tell the data protection system that my environment requires non-default paths or settings."</span></span>

3. <span data-ttu-id="694f5-155">Os desenvolvedores de destino APIs de extensibilidade responsável pela implementação de política personalizada.</span><span class="sxs-lookup"><span data-stu-id="694f5-155">The extensibility APIs target developers in charge of implementing custom policy.</span></span> <span data-ttu-id="694f5-156">O uso dessas APIs seria limitado a situações raras e experientes, os desenvolvedores com reconhecimento de segurança.</span><span class="sxs-lookup"><span data-stu-id="694f5-156">Usage of these APIs would be limited to rare situations and experienced, security aware developers.</span></span>

   <span data-ttu-id="694f5-157">"Preciso substituir um componente inteiro dentro do sistema porque tenho requisitos comportamentais realmente exclusivos.</span><span class="sxs-lookup"><span data-stu-id="694f5-157">"I need to replace an entire component within the system because I have truly unique behavioral requirements.</span></span> <span data-ttu-id="694f5-158">Desejo saber uncommonly usado partes da superfície de API para criar um plug-in que atende aos meus requisitos."</span><span class="sxs-lookup"><span data-stu-id="694f5-158">I am willing to learn uncommonly-used parts of the API surface in order to build a plugin that fulfills my requirements."</span></span>

## <a name="package-layout"></a><span data-ttu-id="694f5-159">Layout do pacote</span><span class="sxs-lookup"><span data-stu-id="694f5-159">Package Layout</span></span>

<span data-ttu-id="694f5-160">A pilha de proteção de dados consiste em cinco pacotes.</span><span class="sxs-lookup"><span data-stu-id="694f5-160">The data protection stack consists of five packages.</span></span>

* <span data-ttu-id="694f5-161">Microsoft.AspNetCore.DataProtection.Abstractions contém as interfaces IDataProtectionProvider e IDataProtector básicas.</span><span class="sxs-lookup"><span data-stu-id="694f5-161">Microsoft.AspNetCore.DataProtection.Abstractions contains the basic IDataProtectionProvider and IDataProtector interfaces.</span></span> <span data-ttu-id="694f5-162">Ele também contém métodos de extensão úteis que podem ajudá-lo a trabalhar com esses tipos (por exemplo, sobrecargas de IDataProtector.Protect).</span><span class="sxs-lookup"><span data-stu-id="694f5-162">It also contains useful extension methods that can assist working with these types (e.g., overloads of IDataProtector.Protect).</span></span> <span data-ttu-id="694f5-163">Consulte a seção de interfaces de consumidor para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="694f5-163">See the consumer interfaces section for more information.</span></span> <span data-ttu-id="694f5-164">Se alguém é responsável por criar uma instância do sistema de proteção de dados e as APIs simplesmente está consumindo, você desejará Microsoft.AspNetCore.DataProtection.Abstractions de referência.</span><span class="sxs-lookup"><span data-stu-id="694f5-164">If somebody else is responsible for instantiating the data protection system and you are simply consuming the APIs, you'll want to reference Microsoft.AspNetCore.DataProtection.Abstractions.</span></span>

* <span data-ttu-id="694f5-165">Microsoft.AspNetCore.DataProtection contém a implementação de núcleo do sistema proteção de dados, incluindo as principais operações criptográficas, gerenciamento de chaves, configuração e extensibilidade.</span><span class="sxs-lookup"><span data-stu-id="694f5-165">Microsoft.AspNetCore.DataProtection contains the core implementation of the data protection system, including the core cryptographic operations, key management, configuration, and extensibility.</span></span> <span data-ttu-id="694f5-166">Se você é responsável para instanciar o sistema de proteção de dados (por exemplo, adicioná-lo para um IServiceCollection) ou modificar ou estender seu comportamento, você desejará Microsoft.AspNetCore.DataProtection de referência.</span><span class="sxs-lookup"><span data-stu-id="694f5-166">If you're responsible for instantiating the data protection system (e.g., adding it to an IServiceCollection) or modifying or extending its behavior, you'll want to reference Microsoft.AspNetCore.DataProtection.</span></span>

* <span data-ttu-id="694f5-167">Microsoft.AspNetCore.DataProtection.Extensions contém APIs adicionais que os desenvolvedores podem ser úteis, mas que não pertencem no pacote principal.</span><span class="sxs-lookup"><span data-stu-id="694f5-167">Microsoft.AspNetCore.DataProtection.Extensions contains additional APIs which developers might find useful but which don't belong in the core package.</span></span> <span data-ttu-id="694f5-168">Por exemplo, este pacote contém uma API simples "instanciar o sistema apontando para um diretório de armazenamento de chave específico com nenhuma configuração de injeção de dependência" (mais informações).</span><span class="sxs-lookup"><span data-stu-id="694f5-168">For instance, this package contains a simple "instantiate the system pointing at a specific key storage directory with no dependency injection setup" API (more info).</span></span> <span data-ttu-id="694f5-169">Ele também contém métodos de extensão para limitar o tempo de vida das cargas protegidos (mais informações).</span><span class="sxs-lookup"><span data-stu-id="694f5-169">It also contains extension methods for limiting the lifetime of protected payloads (more info).</span></span>

* <span data-ttu-id="694f5-170">Microsoft.AspNetCore.DataProtection.SystemWeb pode ser instalado em um aplicativo de 4. x ASP.NET existente para redirecionar seu <machineKey> operações em vez disso, usar a nova pilha de proteção de dados.</span><span class="sxs-lookup"><span data-stu-id="694f5-170">Microsoft.AspNetCore.DataProtection.SystemWeb can be installed into an existing ASP.NET 4.x application to redirect its <machineKey> operations to instead use the new data protection stack.</span></span> <span data-ttu-id="694f5-171">Consulte [compatibilidade](compatibility/replacing-machinekey.md#compatibility-replacing-machinekey) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="694f5-171">See [compatibility](compatibility/replacing-machinekey.md#compatibility-replacing-machinekey) for more information.</span></span>

* <span data-ttu-id="694f5-172">Microsoft.AspNetCore.Cryptography.KeyDerivation fornece uma implementação da rotina de hash de senha do PBKDF2 e podem ser usadas por sistemas que precisam lidar com as senhas de usuário com segurança.</span><span class="sxs-lookup"><span data-stu-id="694f5-172">Microsoft.AspNetCore.Cryptography.KeyDerivation provides an implementation of the PBKDF2 password hashing routine and can be used by systems which need to handle user passwords securely.</span></span> <span data-ttu-id="694f5-173">Consulte [senha hash](consumer-apis/password-hashing.md) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="694f5-173">See [Password Hashing](consumer-apis/password-hashing.md) for more information.</span></span>
