---
title: Tempo de vida e gerenciamento de chaves
author: rick-anderson
description: Descreve o tempo de vida e gerenciamento de chaves.
keywords: Gerenciamento, DPAPI, DataProtection de chaves do ASP.NET Core
ms.author: riande
manager: wpickett
ms.date: 10/14/2016
ms.topic: article
ms.assetid: ef7dad2a-7029-4ae5-8f06-1fbebedccaa4
ms.technology: aspnet
ms.prod: asp.net-core
uid: security/data-protection/configuration/default-settings
ms.openlocfilehash: 913eda69f88ef05a990d9465024f4fa6b08cd1b7
ms.sourcegitcommit: 0b6c8e6d81d2b3c161cd375036eecbace46a9707
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 08/11/2017
---
# <a name="key-management-and-lifetime"></a><span data-ttu-id="a8fbd-104">Tempo de vida e gerenciamento de chaves</span><span class="sxs-lookup"><span data-stu-id="a8fbd-104">Key management and lifetime</span></span>

<a name=data-protection-default-settings></a>

## <a name="key-management"></a><span data-ttu-id="a8fbd-105">Gerenciamento de chaves</span><span class="sxs-lookup"><span data-stu-id="a8fbd-105">Key Management</span></span>

<span data-ttu-id="a8fbd-106">O sistema tenta detectar seu ambiente operacional e fornecer a BOM padrões de comportamentos de configuração de zero.</span><span class="sxs-lookup"><span data-stu-id="a8fbd-106">The system tries to detect its operational environment and provide good zero-configuration behavioral defaults.</span></span> <span data-ttu-id="a8fbd-107">A heurística usada é a seguinte:</span><span class="sxs-lookup"><span data-stu-id="a8fbd-107">The heuristic used is as follows.</span></span>

1. <span data-ttu-id="a8fbd-108">Se o sistema está sendo hospedado no Azure Web Sites, as chaves são mantidas para a pasta "% HOME%\ASP.NET\DataProtection-Keys".</span><span class="sxs-lookup"><span data-stu-id="a8fbd-108">If the system is being hosted in Azure Web Sites, keys are persisted to the "%HOME%\ASP.NET\DataProtection-Keys" folder.</span></span> <span data-ttu-id="a8fbd-109">Esta pasta é apoiada pelo repositório de rede e é sincronizada em todos os computadores que hospedam o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="a8fbd-109">This folder is backed by network storage and is synchronized across all machines hosting the application.</span></span> <span data-ttu-id="a8fbd-110">As chaves não são protegidas em repouso.</span><span class="sxs-lookup"><span data-stu-id="a8fbd-110">Keys are not protected at rest.</span></span> <span data-ttu-id="a8fbd-111">Essa pasta fornece o anel de chave para todas as instâncias de um aplicativo em um slot de implantação única.</span><span class="sxs-lookup"><span data-stu-id="a8fbd-111">This folder supplies the key ring to all instances of an application in a single deployment slot.</span></span> <span data-ttu-id="a8fbd-112">Slots de implantação separado, como preparação e produção, não compartilharão um anel de chave.</span><span class="sxs-lookup"><span data-stu-id="a8fbd-112">Separate deployment slots, such as Staging and Production, will not share a key ring.</span></span> <span data-ttu-id="a8fbd-113">Quando você alternar entre os slots de implantação, por exemplo, troca de preparo para produção ou usando A / B teste, qualquer sistema usando a proteção de dados não poderá descriptografar dados armazenados usando o anel de chave dentro do slot anterior.</span><span class="sxs-lookup"><span data-stu-id="a8fbd-113">When you swap between deployment slots, for example swapping Staging to Production or using A/B testing, any system using data protection will not be able to decrypt stored data using the key ring inside the previous slot.</span></span> <span data-ttu-id="a8fbd-114">Isso levará a usuários que estão sendo conectados fora de um aplicativo ASP.NET que usa o middleware de cookie padrão do ASP.NET, pois ele usa a proteção de dados para proteger seus cookies.</span><span class="sxs-lookup"><span data-stu-id="a8fbd-114">This will lead to users being logged out of an ASP.NET application that uses the standard ASP.NET cookie middleware, as it uses data protection to protect its cookies.</span></span> <span data-ttu-id="a8fbd-115">Se você desejar independente de slot chave anéis, usar um provedor de anel de chave externa, como armazenamento Blob do Azure, Cofre de chaves do Azure, um repositório SQL, ou o cache Redis.</span><span class="sxs-lookup"><span data-stu-id="a8fbd-115">If you desire slot-independent key rings, use an external key ring provider, such as Azure Blob Storage, Azure Key Vault, a SQL store, or Redis cache.</span></span>

2. <span data-ttu-id="a8fbd-116">Se o perfil de usuário estiver disponível, as chaves são mantidas para a pasta "% LOCALAPPDATA%\ASP.NET\DataProtection-Keys".</span><span class="sxs-lookup"><span data-stu-id="a8fbd-116">If the user profile is available, keys are persisted to the "%LOCALAPPDATA%\ASP.NET\DataProtection-Keys" folder.</span></span> <span data-ttu-id="a8fbd-117">Além disso, se o sistema operacional for Windows, eles serão criptografados em repouso usando a DPAPI.</span><span class="sxs-lookup"><span data-stu-id="a8fbd-117">Additionally, if the operating system is Windows, they'll be encrypted at rest using DPAPI.</span></span>

3. <span data-ttu-id="a8fbd-118">Se o aplicativo está hospedado no IIS, as chaves são persistentes no registro HKLM em uma chave do registro especial que é ACLed apenas para a conta de processo do operador.</span><span class="sxs-lookup"><span data-stu-id="a8fbd-118">If the application is hosted in IIS, keys are persisted to the HKLM registry in a special registry key that is ACLed only to the worker process account.</span></span> <span data-ttu-id="a8fbd-119">As chaves são criptografadas em repouso usando a DPAPI.</span><span class="sxs-lookup"><span data-stu-id="a8fbd-119">Keys are encrypted at rest using DPAPI.</span></span>

4. <span data-ttu-id="a8fbd-120">Se corresponder a nenhuma dessas condições, as chaves não são mantidas fora do processo atual.</span><span class="sxs-lookup"><span data-stu-id="a8fbd-120">If none of these conditions matches, keys are not persisted outside of the current process.</span></span> <span data-ttu-id="a8fbd-121">Quando o processo é desligado, todos os geradas chaves serão perdidas.</span><span class="sxs-lookup"><span data-stu-id="a8fbd-121">When the process shuts down, all generated keys will be lost.</span></span>

<span data-ttu-id="a8fbd-122">O desenvolvedor está sempre no controle total e pode substituir como e onde as chaves são armazenadas.</span><span class="sxs-lookup"><span data-stu-id="a8fbd-122">The developer is always in full control and can override how and where keys are stored.</span></span> <span data-ttu-id="a8fbd-123">As três primeiras opções acima devem bom padrões para a maioria dos aplicativos semelhante a como o ASP.NET <machineKey> rotinas de geração automática funcionaram no passado.</span><span class="sxs-lookup"><span data-stu-id="a8fbd-123">The first three options above should good defaults for most applications similar to how the ASP.NET <machineKey> auto-generation routines worked in the past.</span></span> <span data-ttu-id="a8fbd-124">Final, opção de failback outono é o único cenário que requer que o desenvolvedor especifique realmente [configuração](overview.md) inicial se quiserem persistência de chave, mas este retorno só podem ocorrer em situações raras.</span><span class="sxs-lookup"><span data-stu-id="a8fbd-124">The final, fall back option is the only scenario that truly requires the developer to specify [configuration](overview.md) upfront if they want key persistence, but this fall-back would only occur in rare situations.</span></span>

>[!WARNING]
> <span data-ttu-id="a8fbd-125">Se o desenvolvedor substitui essa heurística e aponta o sistema de proteção de dados em um repositório de chave específico, a criptografia automática de chaves em repouso será desabilitada.</span><span class="sxs-lookup"><span data-stu-id="a8fbd-125">If the developer overrides this heuristic and points the data protection system at a specific key repository, automatic encryption of keys at rest will be disabled.</span></span> <span data-ttu-id="a8fbd-126">Em repouso proteção pode ser habilitada novamente por meio de [configuração](overview.md).</span><span class="sxs-lookup"><span data-stu-id="a8fbd-126">At rest protection can be re-enabled via [configuration](overview.md).</span></span>

## <a name="key-lifetime"></a><span data-ttu-id="a8fbd-127">Vida útil da chave</span><span class="sxs-lookup"><span data-stu-id="a8fbd-127">Key Lifetime</span></span>

<span data-ttu-id="a8fbd-128">Chaves por padrão tem um tempo de vida de 90 dias.</span><span class="sxs-lookup"><span data-stu-id="a8fbd-128">Keys by default have a 90-day lifetime.</span></span> <span data-ttu-id="a8fbd-129">Quando uma chave expira, o sistema será automaticamente gere uma nova chave e definir a nova chave como a chave ativa.</span><span class="sxs-lookup"><span data-stu-id="a8fbd-129">When a key expires, the system will automatically generate a new key and set the new key as the active key.</span></span> <span data-ttu-id="a8fbd-130">Como chaves desativadas permanecem no sistema ainda poderá descriptografar os dados protegidos com eles.</span><span class="sxs-lookup"><span data-stu-id="a8fbd-130">As long as retired keys remain on the system you will still be able to decrypt any data protected with them.</span></span> <span data-ttu-id="a8fbd-131">Consulte [gerenciamento de chaves](../implementation/key-management.md#data-protection-implementation-key-management-expiration) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="a8fbd-131">See [key management](../implementation/key-management.md#data-protection-implementation-key-management-expiration) for more information.</span></span>

## <a name="default-algorithms"></a><span data-ttu-id="a8fbd-132">Algoritmos padrão</span><span class="sxs-lookup"><span data-stu-id="a8fbd-132">Default Algorithms</span></span>

<span data-ttu-id="a8fbd-133">O algoritmo de proteção de carga padrão usado é AES-256-CBC para confidencialidade e HMACSHA256 autenticidade.</span><span class="sxs-lookup"><span data-stu-id="a8fbd-133">The default payload protection algorithm used is AES-256-CBC for confidentiality and HMACSHA256 for authenticity.</span></span> <span data-ttu-id="a8fbd-134">Uma chave mestra de 512 bits, revertida a cada 90 dias, é usada para derivar as duas chaves subdiretório usadas para esses algoritmos em uma base por carga.</span><span class="sxs-lookup"><span data-stu-id="a8fbd-134">A 512-bit master key, rolled every 90 days, is used to derive the two sub-keys used for these algorithms on a per-payload basis.</span></span> <span data-ttu-id="a8fbd-135">Consulte [subchave derivação](../implementation/subkeyderivation.md#data-protection-implementation-subkey-derivation-aad) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="a8fbd-135">See [subkey derivation](../implementation/subkeyderivation.md#data-protection-implementation-subkey-derivation-aad) for more information.</span></span>
