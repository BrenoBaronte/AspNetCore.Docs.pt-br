---
title: Hospedar o ASP.NET Core no Windows com o IIS
author: guardrex
description: "Configuração e implantação do IIS (Serviços de Informações da Internet) do Windows Server de aplicativos ASP.NET Core."
keywords: "ASP.NET Core, serviços de informações da Internet, IIS, Windows Server, pacote de hospedagem, módulo do ASP.NET Core, Implantação da Web"
ms.author: riande
manager: wpickett
ms.date: 03/13/2017
ms.topic: article
ms.assetid: a4449ad3-5bad-410c-afa7-dc32d832b552
ms.technology: aspnet
ms.prod: asp.net-core
uid: publishing/iis
ms.openlocfilehash: 75fc1edec9050a4690a39d37307f2f95f5d534a5
ms.sourcegitcommit: 6e83c55eb0450a3073ef2b95fa5f5bcb20dbbf89
ms.translationtype: HT
ms.contentlocale: pt-BR
ms.lasthandoff: 09/28/2017
---
# <a name="host-aspnet-core-on-windows-with-iis"></a><span data-ttu-id="2a8af-104">Hospedar o ASP.NET Core no Windows com o IIS</span><span class="sxs-lookup"><span data-stu-id="2a8af-104">Host ASP.NET Core on Windows with IIS</span></span>

<span data-ttu-id="2a8af-105">Por [Luke Latham](https://github.com/guardrex) e [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="2a8af-105">By [Luke Latham](https://github.com/guardrex) and [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

## <a name="supported-operating-systems"></a><span data-ttu-id="2a8af-106">Sistemas operacionais com suporte</span><span class="sxs-lookup"><span data-stu-id="2a8af-106">Supported operating systems</span></span>

<span data-ttu-id="2a8af-107">Há suporte para os seguintes sistemas operacionais:</span><span class="sxs-lookup"><span data-stu-id="2a8af-107">The following operating systems are supported:</span></span>

* <span data-ttu-id="2a8af-108">Windows 7 e mais recente</span><span class="sxs-lookup"><span data-stu-id="2a8af-108">Windows 7 and newer</span></span>
* <span data-ttu-id="2a8af-109">Windows Server 2008 R2 e mais recente&#8224;</span><span class="sxs-lookup"><span data-stu-id="2a8af-109">Windows Server 2008 R2 and newer&#8224;</span></span>

<span data-ttu-id="2a8af-110">&#8224;Conceitualmente, a configuração do IIS descrita neste documento também se aplica à hospedagem de aplicativos ASP.NET Core no IIS do Nano Server, mas consulte [ASP.NET Core com o IIS no Nano Server](xref:tutorials/nano-server) para obter instruções específicas.</span><span class="sxs-lookup"><span data-stu-id="2a8af-110">&#8224;Conceptually, the IIS configuration described in this document also applies to hosting ASP.NET Core applications on Nano Server IIS, but refer to [ASP.NET Core with IIS on Nano Server](xref:tutorials/nano-server) for specific instructions.</span></span>

<span data-ttu-id="2a8af-111">[Servidor HTTP. sys](xref:fundamentals/servers/httpsys) (anteriormente chamado de [WebListener](xref:fundamentals/servers/weblistener)) não funcionará em uma configuração de proxy reverso com IIS.</span><span class="sxs-lookup"><span data-stu-id="2a8af-111">[HTTP.sys server](xref:fundamentals/servers/httpsys) (formerly called [WebListener](xref:fundamentals/servers/weblistener)) won't work in a reverse-proxy configuration with IIS.</span></span> <span data-ttu-id="2a8af-112">Você deve usar o [servidor Kestrel](xref:fundamentals/servers/kestrel).</span><span class="sxs-lookup"><span data-stu-id="2a8af-112">You must use the [Kestrel server](xref:fundamentals/servers/kestrel).</span></span>

## <a name="iis-configuration"></a><span data-ttu-id="2a8af-113">Configuração do IIS</span><span class="sxs-lookup"><span data-stu-id="2a8af-113">IIS configuration</span></span>

<span data-ttu-id="2a8af-114">Habilite a função **Servidor Web (IIS)** e estabeleça serviços de função.</span><span class="sxs-lookup"><span data-stu-id="2a8af-114">Enable the **Web Server (IIS)** role and establish role services.</span></span>

### <a name="windows-desktop-operating-systems"></a><span data-ttu-id="2a8af-115">Sistemas operacionais de área de trabalho do Windows</span><span class="sxs-lookup"><span data-stu-id="2a8af-115">Windows desktop operating systems</span></span>

<span data-ttu-id="2a8af-116">Navegue para **Painel de Controle** > **Programas** > **Programas e Recursos** > **Ativar ou desativar recursos do Windows** (lado esquerdo da tela).</span><span class="sxs-lookup"><span data-stu-id="2a8af-116">Navigate to **Control Panel** > **Programs** > **Programs and Features** > **Turn Windows features on or off** (left side of the screen).</span></span> <span data-ttu-id="2a8af-117">Abra o grupo de **Serviços de Informações da Internet** e **Ferramentas de Gerenciamento da Web**.</span><span class="sxs-lookup"><span data-stu-id="2a8af-117">Open the group for **Internet Information Services** and **Web Management Tools**.</span></span> <span data-ttu-id="2a8af-118">Marque a caixa de **Console de Gerenciamento do IIS**.</span><span class="sxs-lookup"><span data-stu-id="2a8af-118">Check the box for **IIS Management Console**.</span></span> <span data-ttu-id="2a8af-119">Marque a caixa de **Serviços na World Wide Web**.</span><span class="sxs-lookup"><span data-stu-id="2a8af-119">Check the box for **World Wide Web Services**.</span></span> <span data-ttu-id="2a8af-120">Aceite os recursos padrão dos **Serviços na World Wide Web** ou personalize os recursos do IIS de acordo com suas necessidades.</span><span class="sxs-lookup"><span data-stu-id="2a8af-120">Accept the default features for **World Wide Web Services** or customize the IIS features to suit your needs.</span></span>

![O Console de Gerenciamento do IIS e os Serviços na World Wide Web estão selecionados em Recursos do Windows.](iis/_static/windows-features-win10.png)

### <a name="windows-server-operating-systems"></a><span data-ttu-id="2a8af-122">Sistemas operacionais do Windows Server</span><span class="sxs-lookup"><span data-stu-id="2a8af-122">Windows Server operating systems</span></span>

<span data-ttu-id="2a8af-123">Para sistemas operacionais de servidor, use o assistente para **Adicionar Funções e Recursos** por meio do menu **Gerenciar** ou do link no **Gerenciador do Servidor**.</span><span class="sxs-lookup"><span data-stu-id="2a8af-123">For server operating systems, use the **Add Roles and Features** wizard via the **Manage** menu or the link in **Server Manager**.</span></span> <span data-ttu-id="2a8af-124">Na etapa **Funções de Servidor**, marque a caixa de **Servidor Web (IIS)**.</span><span class="sxs-lookup"><span data-stu-id="2a8af-124">On the **Server Roles** step, check the box for **Web Server (IIS)**.</span></span>

![A função de Servidor Web IIS é selecionada na etapa Selecionar funções de servidor.](iis/_static/server-roles-ws2016.png)

<span data-ttu-id="2a8af-126">Na etapa **Serviços de função**, selecione os serviços de função do IIS desejados ou aceite os serviços de função padrão fornecidos.</span><span class="sxs-lookup"><span data-stu-id="2a8af-126">On the **Role services** step, select the IIS role services you desire or accept the default role services provided.</span></span>

![Os serviços de função padrão são selecionados na etapa Selecionar serviços de função.](iis/_static/role-services-ws2016.png)

<span data-ttu-id="2a8af-128">Continue para a etapa **Confirmação** para instalar os serviços e a função de servidor Web.</span><span class="sxs-lookup"><span data-stu-id="2a8af-128">Proceed through the **Confirmation** step to install the web server role and services.</span></span> <span data-ttu-id="2a8af-129">A reinicialização de um servidor/IIS não é necessária após a instalação da função do Servidor Web (IIS).</span><span class="sxs-lookup"><span data-stu-id="2a8af-129">A server/IIS restart isn't required after installing the Web Server (IIS) role.</span></span>

## <a name="install-the-net-core-windows-server-hosting-bundle"></a><span data-ttu-id="2a8af-130">Instalar o pacote de hospedagem do Windows Server do .NET Core</span><span class="sxs-lookup"><span data-stu-id="2a8af-130">Install the .NET Core Windows Server Hosting bundle</span></span>

1. <span data-ttu-id="2a8af-131">Instale o [pacote de hospedagem do Windows Server do .NET Core](https://aka.ms/dotnetcore.2.0.0-windowshosting) no sistema de hospedagem.</span><span class="sxs-lookup"><span data-stu-id="2a8af-131">Install the [.NET Core Windows Server Hosting bundle](https://aka.ms/dotnetcore.2.0.0-windowshosting) on the hosting system.</span></span> <span data-ttu-id="2a8af-132">O pacote instala o Tempo de Execução .NET Core, a Biblioteca do .NET Core e o [Módulo do ASP.NET Core](xref:fundamentals/servers/aspnet-core-module).</span><span class="sxs-lookup"><span data-stu-id="2a8af-132">The bundle installs the .NET Core Runtime, .NET Core Library, and the [ASP.NET Core Module](xref:fundamentals/servers/aspnet-core-module).</span></span> <span data-ttu-id="2a8af-133">O módulo cria o proxy reverso entre o IIS e o servidor Kestrel.</span><span class="sxs-lookup"><span data-stu-id="2a8af-133">The module creates the reverse-proxy between IIS and the Kestrel server.</span></span> <span data-ttu-id="2a8af-134">Se o sistema não tiver uma conexão com a Internet, obtenha e instale os [Pacotes redistribuíveis do Microsoft Visual C++ 2015](https://www.microsoft.com/download/details.aspx?id=53840) antes de instalar o pacote de hospedagem do Windows Server do .NET Core.</span><span class="sxs-lookup"><span data-stu-id="2a8af-134">If the system doesn't have an Internet connection, obtain and install the [Microsoft Visual C++ 2015 Redistributable](https://www.microsoft.com/download/details.aspx?id=53840) before installing the .NET Core Windows Server Hosting bundle.</span></span>

2. <span data-ttu-id="2a8af-135">Reinicie o sistema ou execute **net stop was /y** seguido por **net start w3svc** em um prompt de comando para acompanhar uma alteração no PATH do sistema.</span><span class="sxs-lookup"><span data-stu-id="2a8af-135">Restart the system or execute **net stop was /y** followed by **net start w3svc** from a command prompt to pick up a change to the system PATH.</span></span>

> [!NOTE]
> <span data-ttu-id="2a8af-136">Se você usar uma Configuração Compartilhada do IIS, consulte [Módulo do ASP.NET Core com a Configuração Compartilhada do IIS](xref:hosting/aspnet-core-module#aspnet-core-module-with-an-iis-shared-configuration).</span><span class="sxs-lookup"><span data-stu-id="2a8af-136">If you use an IIS Shared Configuration, see [ASP.NET Core Module with IIS Shared Configuration](xref:hosting/aspnet-core-module#aspnet-core-module-with-an-iis-shared-configuration).</span></span>

## <a name="install-web-deploy-when-publishing-with-visual-studio"></a><span data-ttu-id="2a8af-137">Instalar a Implantação da Web durante a publicação com o Visual Studio</span><span class="sxs-lookup"><span data-stu-id="2a8af-137">Install Web Deploy when publishing with Visual Studio</span></span>

<span data-ttu-id="2a8af-138">Se você pretende implantar seus aplicativos com a [Implantação da Web](/iis/publish/using-web-deploy/introduction-to-web-deploy) no [Visual Studio](https://www.visualstudio.com/vs/), instale a última versão da Implantação da Web no sistema de hospedagem.</span><span class="sxs-lookup"><span data-stu-id="2a8af-138">If you intend to deploy your applications with [Web Deploy](/iis/publish/using-web-deploy/introduction-to-web-deploy) in [Visual Studio](https://www.visualstudio.com/vs/), install the latest version of Web Deploy on the hosting system.</span></span> <span data-ttu-id="2a8af-139">Para instalar a Implantação da Web, use o [WebPI (Web Platform Installer)](https://www.microsoft.com/web/downloads/platform.aspx) ou obtenha um instalador diretamente no [Centro de Download da Microsoft](https://www.microsoft.com/download/details.aspx?id=43717).</span><span class="sxs-lookup"><span data-stu-id="2a8af-139">To install Web Deploy, you can use the [Web Platform Installer (WebPI)](https://www.microsoft.com/web/downloads/platform.aspx) or obtain an installer directly from the [Microsoft Download Center](https://www.microsoft.com/download/details.aspx?id=43717).</span></span> <span data-ttu-id="2a8af-140">O método preferencial é usar o WebPI.</span><span class="sxs-lookup"><span data-stu-id="2a8af-140">The preferred method is to use WebPI.</span></span> <span data-ttu-id="2a8af-141">O WebPI oferece uma instalação autônoma e uma configuração para provedores de hospedagem.</span><span class="sxs-lookup"><span data-stu-id="2a8af-141">WebPI offers a standalone setup and a configuration for hosting providers.</span></span>

## <a name="application-configuration"></a><span data-ttu-id="2a8af-142">Configuração do aplicativo</span><span class="sxs-lookup"><span data-stu-id="2a8af-142">Application configuration</span></span>

### <a name="enabling-the-iisintegration-components"></a><span data-ttu-id="2a8af-143">Habilitando os componentes de IISIntegration</span><span class="sxs-lookup"><span data-stu-id="2a8af-143">Enabling the IISIntegration components</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="2a8af-144">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="2a8af-144">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

<span data-ttu-id="2a8af-145">Um típico *Program.cs* chama [CreateDefaultBuilder](/dotnet/api/microsoft.aspnetcore.webhost.createdefaultbuilder) para começar a configurar um host.</span><span class="sxs-lookup"><span data-stu-id="2a8af-145">A typical *Program.cs* calls [CreateDefaultBuilder](/dotnet/api/microsoft.aspnetcore.webhost.createdefaultbuilder) to begin setting up a host.</span></span> <span data-ttu-id="2a8af-146">`CreateDefaultBuilder` configura [Kestrel](xref:fundamentals/servers/kestrel) como o servidor Web e habilita a integração IIS configurando o caminho base e a porta para o [módulo do ASP.NET Core](xref:fundamentals/servers/aspnet-core-module):</span><span class="sxs-lookup"><span data-stu-id="2a8af-146">`CreateDefaultBuilder` configures [Kestrel](xref:fundamentals/servers/kestrel) as the web server and enables IIS integration by configuring the base path and port for the [ASP.NET Core Module](xref:fundamentals/servers/aspnet-core-module):</span></span>

```csharp
public static IWebHost BuildWebHost(string[] args) =>
    WebHost.CreateDefaultBuilder(args)
        ...
```

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="2a8af-147">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="2a8af-147">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

<span data-ttu-id="2a8af-148">Inclua uma dependência no pacote [Microsoft.AspNetCore.Server.IISIntegration](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.IISIntegration/) nas dependências do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2a8af-148">Include a dependency on the [Microsoft.AspNetCore.Server.IISIntegration](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.IISIntegration/) package in your app dependencies.</span></span> <span data-ttu-id="2a8af-149">Incorpore o middleware Integração do IIS no aplicativo adicionando o método de extensão *UseIISIntegration* ao *WebHostBuilder*:</span><span class="sxs-lookup"><span data-stu-id="2a8af-149">Incorporate IIS Integration middleware into the app by adding the *UseIISIntegration* extension method to *WebHostBuilder*:</span></span>

```csharp
var host = new WebHostBuilder()
    .UseKestrel()
    .UseIISIntegration()
    ...
```

<span data-ttu-id="2a8af-150">Ambos `UseKestrel` e `UseIISIntegration` são necessários.</span><span class="sxs-lookup"><span data-stu-id="2a8af-150">Both `UseKestrel` and `UseIISIntegration` are required.</span></span> <span data-ttu-id="2a8af-151">A chamada do código a *UseIISIntegration* não afeta a portabilidade do código.</span><span class="sxs-lookup"><span data-stu-id="2a8af-151">Code calling *UseIISIntegration* doesn't affect code portability.</span></span> <span data-ttu-id="2a8af-152">Se o aplicativo não é executado por trás do IIS (por exemplo, o aplicativo é executado diretamente em Kestrel), `UseIISIntegration` fica sem operações.</span><span class="sxs-lookup"><span data-stu-id="2a8af-152">If the app isn't run behind IIS (for example, the app is run directly on Kestrel), `UseIISIntegration` no-ops.</span></span>

---

<span data-ttu-id="2a8af-153">Para obter mais informações sobre hospedagem, consulte [Hospedagem em ASP.NET Core](xref:fundamentals/hosting).</span><span class="sxs-lookup"><span data-stu-id="2a8af-153">For more information on hosting, see [Hosting in ASP.NET Core](xref:fundamentals/hosting).</span></span>

### <a name="iis-options"></a><span data-ttu-id="2a8af-154">Opções do IIS</span><span class="sxs-lookup"><span data-stu-id="2a8af-154">IIS options</span></span>

<span data-ttu-id="2a8af-155">Para configurar opções do serviço *IISIntegration*, inclua uma configuração de serviço para *IISOptions* em *ConfigureServices*:</span><span class="sxs-lookup"><span data-stu-id="2a8af-155">To configure *IISIntegration* service options, include a service configuration for *IISOptions* in *ConfigureServices*:</span></span>

```csharp
services.Configure<IISOptions>(options => 
{
    ...
});
```

| <span data-ttu-id="2a8af-156">Opção</span><span class="sxs-lookup"><span data-stu-id="2a8af-156">Option</span></span>                         | <span data-ttu-id="2a8af-157">Padrão</span><span class="sxs-lookup"><span data-stu-id="2a8af-157">Default</span></span> | <span data-ttu-id="2a8af-158">Configuração</span><span class="sxs-lookup"><span data-stu-id="2a8af-158">Setting</span></span> |
| ------------------------------ | ------- | ------- |
| `AutomaticAuthentication`      | `true`  | <span data-ttu-id="2a8af-159">Se `true`, o middleware de autenticação configurará o `HttpContext.User` e responderá a desafios genéricos.</span><span class="sxs-lookup"><span data-stu-id="2a8af-159">If `true`, the authentication middleware sets the `HttpContext.User` and responds to generic challenges.</span></span> <span data-ttu-id="2a8af-160">Se `false`, o middleware de autenticação fornecerá apenas uma identidade (`HttpContext.User`) e responderá a desafios quando explicitamente solicitado pelo `AuthenticationScheme`.</span><span class="sxs-lookup"><span data-stu-id="2a8af-160">If `false`, the authentication middleware only provides an identity (`HttpContext.User`) and responds to challenges when explicitly requested by the `AuthenticationScheme`.</span></span> <span data-ttu-id="2a8af-161">A autenticação do Windows deve estar habilitada no IIS para que o `AutomaticAuthentication` funcione.</span><span class="sxs-lookup"><span data-stu-id="2a8af-161">Windows Authentication must be enabled in IIS for `AutomaticAuthentication` to function.</span></span> |
| `AuthenticationDisplayName`    | `null`  | <span data-ttu-id="2a8af-162">Configura o nome de exibição mostrado aos usuários em páginas de logon.</span><span class="sxs-lookup"><span data-stu-id="2a8af-162">Sets the display name shown to users on login pages.</span></span> |
| `ForwardClientCertificate`     | `true`  | <span data-ttu-id="2a8af-163">Se `true` e o cabeçalho da solicitação `MS-ASPNETCORE-CLIENTCERT` estiverem presentes, o `HttpContext.Connection.ClientCertificate` será populado.</span><span class="sxs-lookup"><span data-stu-id="2a8af-163">If `true` and the `MS-ASPNETCORE-CLIENTCERT` request header is present, the `HttpContext.Connection.ClientCertificate` is populated.</span></span> |

### <a name="webconfig"></a><span data-ttu-id="2a8af-164">web.config</span><span class="sxs-lookup"><span data-stu-id="2a8af-164">web.config</span></span>

<span data-ttu-id="2a8af-165">O arquivo *web.config* configura o Módulo do ASP.NET Core e fornece outras configurações do IIS.</span><span class="sxs-lookup"><span data-stu-id="2a8af-165">The *web.config* file configures the ASP.NET Core Module and provides other IIS configuration.</span></span> <span data-ttu-id="2a8af-166">A criação, transformação e publicação de *web.config* são manipuladas pelo `Microsoft.NET.Sdk.Web`, que é incluído quando você define o SDK do projeto na parte superior do arquivo (*.csproj*) do projeto, `<Project Sdk="Microsoft.NET.Sdk.Web">`.</span><span class="sxs-lookup"><span data-stu-id="2a8af-166">Creating, transforming, and publishing *web.config* is handled by `Microsoft.NET.Sdk.Web`, which is included when you set your project's SDK at the top of your project (*.csproj*) file, `<Project Sdk="Microsoft.NET.Sdk.Web">`.</span></span> <span data-ttu-id="2a8af-167">Para impedir que o destino do MSBuild se transforme no arquivo *web.config*, adicione a propriedade **\<IsTransformWebConfigDisabled>** ao arquivo de projeto com a configuração `true`:</span><span class="sxs-lookup"><span data-stu-id="2a8af-167">To prevent the MSBuild target from transforming your *web.config* file, add the **\<IsTransformWebConfigDisabled>** property to your project file with a setting of `true`:</span></span>

```xml
<PropertyGroup>
  <IsTransformWebConfigDisabled>true</IsTransformWebConfigDisabled>
</PropertyGroup>
```

<span data-ttu-id="2a8af-168">Caso você não tenha um arquivo *web.config* no projeto quando publicar com *dotnet publish* ou com a publicação do Visual Studio, o arquivo será criado para você no [resultado publicado](xref:hosting/directory-structure).</span><span class="sxs-lookup"><span data-stu-id="2a8af-168">If you don't have a *web.config* file in the project when you publish with *dotnet publish* or with Visual Studio publish, the file is created for you in [published output](xref:hosting/directory-structure).</span></span> <span data-ttu-id="2a8af-169">Se você tiver um arquivo *web.config* no projeto, ele será transformado com o *processPath* e os *arguments* corretos para configurar o [Módulo do ASP.NET Core](xref:fundamentals/servers/aspnet-core-module) e será movido para o resultado publicado.</span><span class="sxs-lookup"><span data-stu-id="2a8af-169">If you have a *web.config* file in your project, it's transformed with the correct *processPath* and *arguments* to configure the [ASP.NET Core Module](xref:fundamentals/servers/aspnet-core-module) and moved to published output.</span></span> <span data-ttu-id="2a8af-170">A transformação não altera as definições de configuração do IIS incluídas no arquivo.</span><span class="sxs-lookup"><span data-stu-id="2a8af-170">The transformation doesn't touch IIS configuration settings that you've included in the file.</span></span>

## <a name="create-the-iis-website"></a><span data-ttu-id="2a8af-171">Criar o site do IIS</span><span class="sxs-lookup"><span data-stu-id="2a8af-171">Create the IIS Website</span></span>

1. <span data-ttu-id="2a8af-172">No sistema do IIS de destino, crie uma pasta para conter as pastas e os arquivos publicados do aplicativo, que são descritos em [Estrutura de diretório](xref:hosting/directory-structure).</span><span class="sxs-lookup"><span data-stu-id="2a8af-172">On the target IIS system, create a folder to contain the app's published folders and files, which are described in [Directory Structure](xref:hosting/directory-structure).</span></span>

2. <span data-ttu-id="2a8af-173">Na pasta criada, crie uma pasta *logs* para manter os logs stdout (se você pretende habilitar o log para solucionar problemas de inicialização).</span><span class="sxs-lookup"><span data-stu-id="2a8af-173">Within the folder you created, create a *logs* folder to hold stdout logs (if you plan to enable logging to troubleshoot start-up issues).</span></span> <span data-ttu-id="2a8af-174">Se você pretende implantar o aplicativo com uma pasta *logs* na carga, ignore esta etapa.</span><span class="sxs-lookup"><span data-stu-id="2a8af-174">If you plan to deploy your application with a *logs* folder in the payload, you may skip this step.</span></span> <span data-ttu-id="2a8af-175">Há uma [questão em aberto para criar a pasta automaticamente](https://github.com/aspnet/AspNetCoreModule/issues/30).</span><span class="sxs-lookup"><span data-stu-id="2a8af-175">There's an [open issue to create the folder automatically](https://github.com/aspnet/AspNetCoreModule/issues/30).</span></span> <span data-ttu-id="2a8af-176">Se deseja que o MSBuild crie a pasta de *log*, adicione o seguinte `Target` ao arquivo de projeto:</span><span class="sxs-lookup"><span data-stu-id="2a8af-176">If you would like MSBuild to create the *log* folder for you, add the following `Target` to your project file:</span></span>

   ```xml
   <Target Name="CreateLogsFolder" AfterTargets="AfterPublish">
     <MakeDir Directories="$(PublishDir)logs" Condition="!Exists('$(PublishDir)logs')" />
     <MakeDir Directories="$(PublishUrl)logs" Condition="!Exists('$(PublishUrl)logs')" />
   </Target>
   ```

3. <span data-ttu-id="2a8af-177">Em **Gerenciador do IIS**, crie um novo site.</span><span class="sxs-lookup"><span data-stu-id="2a8af-177">In **IIS Manager**, create a new website.</span></span> <span data-ttu-id="2a8af-178">Forneça um **Nome do site** e defina o **Caminho físico** como a pasta de implantação do aplicativo que você criou.</span><span class="sxs-lookup"><span data-stu-id="2a8af-178">Provide a **Site name** and set the **Physical path** to the app's deployment folder that you created.</span></span> <span data-ttu-id="2a8af-179">Forneça a configuração **Associação** e crie o site.</span><span class="sxs-lookup"><span data-stu-id="2a8af-179">Provide the **Binding** configuration and create the website.</span></span>

4. <span data-ttu-id="2a8af-180">Defina o pool de aplicativos como **Sem Código Gerenciado**.</span><span class="sxs-lookup"><span data-stu-id="2a8af-180">Set the application pool to **No Managed Code**.</span></span> <span data-ttu-id="2a8af-181">O ASP.NET Core é executado em um processo separado e gerencia o tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="2a8af-181">ASP.NET Core runs in a separate process and manages the runtime.</span></span>

5. <span data-ttu-id="2a8af-182">Abra a janela **Adicionar Site**.</span><span class="sxs-lookup"><span data-stu-id="2a8af-182">Open the **Add Website** window.</span></span>

   ![Clique em Adicionar Site no menu contextual de Sites.](iis/_static/add-website-context-menu-ws2016.png)

6. <span data-ttu-id="2a8af-184">Configure o site.</span><span class="sxs-lookup"><span data-stu-id="2a8af-184">Configure the website.</span></span>

   ![Forneça o Nome do site, o caminho físico e o Nome do host na etapa Adicionar Site.](iis/_static/add-website-ws2016.png)

7. <span data-ttu-id="2a8af-186">No painel **Pools de Aplicativos**, abra a janela **Editar pool de aplicativos** clicando com o botão direito do mouse no pool de aplicativos do site da Web e selecionando **Configurações Básicas...** no menu pop-up.</span><span class="sxs-lookup"><span data-stu-id="2a8af-186">In the **Application Pools** panel, open the **Edit Application Pool** window by right-clicking on the website's app pool and selecting **Basic Settings...** from the popup menu.</span></span>

   ![Selecione Configurações Básicas no menu contextual do Pool de Aplicativos.](iis/_static/apppools-basic-settings-ws2016.png)

8. <span data-ttu-id="2a8af-188">Defina a **versão do CLR do .NET** como **Sem Código Gerenciado**.</span><span class="sxs-lookup"><span data-stu-id="2a8af-188">Set the **.NET CLR version** to **No Managed Code**.</span></span>

   ![Defina Sem Código Gerenciado para a versão do CLR do .NET.](iis/_static/edit-apppool-ws2016.png)
     
    <span data-ttu-id="2a8af-190">Observação: a configuração da **versão do CLR do .NET** como **Sem Código Gerenciado** é opcional.</span><span class="sxs-lookup"><span data-stu-id="2a8af-190">Note: Setting the **.NET CLR version** to **No Managed Code** is optional.</span></span> <span data-ttu-id="2a8af-191">O ASP.NET Core não depende do carregamento do CLR de área de trabalho.</span><span class="sxs-lookup"><span data-stu-id="2a8af-191">ASP.NET Core doesn't rely on loading the desktop CLR.</span></span>

9. <span data-ttu-id="2a8af-192">Confirme se a identidade do modelo de processo tem as permissões apropriadas.</span><span class="sxs-lookup"><span data-stu-id="2a8af-192">Confirm the process model identity has the proper permissions.</span></span>

   <span data-ttu-id="2a8af-193">Se você alterar a identidade padrão do pool de aplicativos (**Modelo de Processo** > **Identidade**) em **ApplicationPoolIdentity** para outra identidade, verifique se a nova identidade tem as permissões necessárias para acessar a pasta do aplicativo, o banco de dados e outros recursos necessários.</span><span class="sxs-lookup"><span data-stu-id="2a8af-193">If you change the default identity of the app pool (**Process Model** > **Identity**) from **ApplicationPoolIdentity** to another identity, verify that the new identity has the required permissions to access the app's folder, database, and other required resources.</span></span>
   
## <a name="deploy-the-application"></a><span data-ttu-id="2a8af-194">Implantar o aplicativo</span><span class="sxs-lookup"><span data-stu-id="2a8af-194">Deploy the application</span></span>
<span data-ttu-id="2a8af-195">Implante o aplicativo na pasta criada no sistema do IIS de destino.</span><span class="sxs-lookup"><span data-stu-id="2a8af-195">Deploy the application to the folder you created on the target IIS system.</span></span> <span data-ttu-id="2a8af-196">A [Implantação da Web](/iis/publish/using-web-deploy/introduction-to-web-deploy) é o mecanismo recomendado para implantação.</span><span class="sxs-lookup"><span data-stu-id="2a8af-196">[Web Deploy](/iis/publish/using-web-deploy/introduction-to-web-deploy) is the recommended mechanism for deployment.</span></span> <span data-ttu-id="2a8af-197">As alternativas à Implantação da Web são listadas abaixo.</span><span class="sxs-lookup"><span data-stu-id="2a8af-197">Alternatives to Web Deploy are listed below.</span></span>

<span data-ttu-id="2a8af-198">Confirme se o aplicativo publicado para implantação não está em execução.</span><span class="sxs-lookup"><span data-stu-id="2a8af-198">Confirm that the published app for deployment isn't running.</span></span> <span data-ttu-id="2a8af-199">Os arquivos da pasta *publish* são bloqueados quando o aplicativo está em execução.</span><span class="sxs-lookup"><span data-stu-id="2a8af-199">Files in the *publish* folder are locked when the app is running.</span></span> <span data-ttu-id="2a8af-200">A implantação não pode ocorrer porque os arquivos bloqueados não podem ser copiados.</span><span class="sxs-lookup"><span data-stu-id="2a8af-200">Deployment can't occur because locked files can't be copied.</span></span>

### <a name="web-deploy-with-visual-studio"></a><span data-ttu-id="2a8af-201">Implantação da Web com o Visual Studio</span><span class="sxs-lookup"><span data-stu-id="2a8af-201">Web Deploy with Visual Studio</span></span>
<span data-ttu-id="2a8af-202">Consulte o tópico [Criar perfis de publicação para o Visual Studio e o MSBuild para implantar aplicativos ASP.NET Core](xref:publishing/web-publishing-vs#publish-profiles) para saber como criar um perfil de publicação para uso com a Implantação da Web.</span><span class="sxs-lookup"><span data-stu-id="2a8af-202">See [Create publish profiles for Visual Studio and MSBuild, to deploy ASP.NET Core apps](xref:publishing/web-publishing-vs#publish-profiles) topic to learn how to create a publish profile for use with Web Deploy.</span></span> <span data-ttu-id="2a8af-203">Se o provedor de hospedagem fornecer um Perfil de Publicação ou o suporte para a criação de um, baixe seu perfil e importe-o usando a caixa de diálogo **Publicar** do Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="2a8af-203">If your hosting provider supplies a Publish Profile or support for creating one, download their profile and import it using the Visual Studio **Publish** dialog.</span></span>

![Página de caixa de diálogo Publicar](iis/_static/pub-dialog.png)

### <a name="web-deploy-outside-of-visual-studio"></a><span data-ttu-id="2a8af-205">Implantação da Web fora do Visual Studio</span><span class="sxs-lookup"><span data-stu-id="2a8af-205">Web Deploy outside of Visual Studio</span></span>
<span data-ttu-id="2a8af-206">Também é possível usar a [Implantação da Web](/iis/publish/using-web-deploy/introduction-to-web-deploy) fora do Visual Studio na linha de comando.</span><span class="sxs-lookup"><span data-stu-id="2a8af-206">You can also use [Web Deploy](/iis/publish/using-web-deploy/introduction-to-web-deploy) outside of Visual Studio from the command line.</span></span> <span data-ttu-id="2a8af-207">Para obter mais informações, consulte [Ferramenta de Implantação da Web](/iis/publish/using-web-deploy/use-the-web-deployment-tool).</span><span class="sxs-lookup"><span data-stu-id="2a8af-207">For more information, see [Web Deployment Tool](/iis/publish/using-web-deploy/use-the-web-deployment-tool).</span></span>

### <a name="alternatives-to-web-deploy"></a><span data-ttu-id="2a8af-208">Alternativas à Implantação da Web</span><span class="sxs-lookup"><span data-stu-id="2a8af-208">Alternatives to Web Deploy</span></span>
<span data-ttu-id="2a8af-209">Se você não desejar usar a Implantação da Web ou se não estiver usando o Visual Studio, poderá usar um dos vários métodos para mover o aplicativo para o sistema de hospedagem, como o Xcopy, Robocopy ou PowerShell.</span><span class="sxs-lookup"><span data-stu-id="2a8af-209">If you don't wish to use Web Deploy or are not using Visual Studio, you may use any of several methods to move the application to the hosting system, such as Xcopy, Robocopy, or PowerShell.</span></span> <span data-ttu-id="2a8af-210">Os usuários do Visual Studio podem usar as [Amostras de Publicação](https://github.com/aspnet/vsweb-publish/blob/master/samples/samples.md).</span><span class="sxs-lookup"><span data-stu-id="2a8af-210">Visual Studio users may use the [Publish Samples](https://github.com/aspnet/vsweb-publish/blob/master/samples/samples.md).</span></span>

## <a name="browse-the-website"></a><span data-ttu-id="2a8af-211">Navegar no site</span><span class="sxs-lookup"><span data-stu-id="2a8af-211">Browse the website</span></span>
![O navegador Microsoft Edge carregou a página de inicialização do IIS.](iis/_static/browsewebsite.png)
   
> [!WARNING]
> <span data-ttu-id="2a8af-213">Os aplicativos .NET Core são hospedados por meio de um proxy reverso entre o IIS e o servidor Kestrel.</span><span class="sxs-lookup"><span data-stu-id="2a8af-213">.NET Core apps are hosted via a reverse-proxy between IIS and the Kestrel server.</span></span> <span data-ttu-id="2a8af-214">Para criar um proxy reverso, o arquivo *web.config* deve estar presente no caminho raiz do conteúdo (geralmente, o aplicativo base do caminho) do aplicativo implantado, que é o caminho físico do site fornecido ao IIS.</span><span class="sxs-lookup"><span data-stu-id="2a8af-214">In order to create the reverse-proxy, the *web.config* file must be present at the content root path (typically the app base path) of the deployed application, which is the website physical path provided to IIS.</span></span> <span data-ttu-id="2a8af-215">Existem arquivos confidenciais no caminho físico do aplicativo, incluindo subpastas, como *my_application.runtimeconfig.json*, *my_application.xml* (comentários da Documentação XML) e *my_application.deps.json*.</span><span class="sxs-lookup"><span data-stu-id="2a8af-215">Sensitive files exist on the app's physical path, including subfolders, such as *my_application.runtimeconfig.json*, *my_application.xml* (XML Documentation comments), and *my_application.deps.json*.</span></span> <span data-ttu-id="2a8af-216">O arquivo *web.config* é necessário para criar o proxy reverso para o Kestrel, que impede que o IIS atenda a esses e outros arquivos confidenciais.</span><span class="sxs-lookup"><span data-stu-id="2a8af-216">The *web.config* file is required to create the reverse proxy to Kestrel, which prevents IIS from serving these and other sensitive files.</span></span> <span data-ttu-id="2a8af-217">**Portanto, é importante que o arquivo *web.config* não seja renomeado ou removido acidentalmente da implantação.**</span><span class="sxs-lookup"><span data-stu-id="2a8af-217">**Therefore, it's important that the *web.config* file isn't accidently renamed or removed from the deployment.**</span></span>

## <a name="data-protection"></a><span data-ttu-id="2a8af-218">Proteção de dados</span><span class="sxs-lookup"><span data-stu-id="2a8af-218">Data protection</span></span>

<span data-ttu-id="2a8af-219">Um aplicativo ASP.NET Core armazena o token de autenticação na memória com as seguintes condições:</span><span class="sxs-lookup"><span data-stu-id="2a8af-219">An ASP.NET Core application stores the keyring in memory under the following conditions:</span></span>

* <span data-ttu-id="2a8af-220">Um site é hospedado com a proteção do IIS.</span><span class="sxs-lookup"><span data-stu-id="2a8af-220">A website is hosted behind IIS.</span></span>
* <span data-ttu-id="2a8af-221">A pilha da Proteção de dados não foi configurada para armazenar o token de autenticação em um repositório persistente.</span><span class="sxs-lookup"><span data-stu-id="2a8af-221">The Data Protection stack hasn't been configured to store the keyring in a persistent store.</span></span>

<span data-ttu-id="2a8af-222">Se o token de autenticação for armazenado na memória, quando o aplicativo for reiniciado:</span><span class="sxs-lookup"><span data-stu-id="2a8af-222">If the keyring is stored in memory when the app restarts:</span></span>

* <span data-ttu-id="2a8af-223">Todos os tokens de autenticação de formulários serão inválidos.</span><span class="sxs-lookup"><span data-stu-id="2a8af-223">All forms authentication tokens are invalidated.</span></span> 
* <span data-ttu-id="2a8af-224">Os usuários precisarão fazer logon novamente em sua próxima solicitação.</span><span class="sxs-lookup"><span data-stu-id="2a8af-224">Users are required to login again on their next request.</span></span> 
* <span data-ttu-id="2a8af-225">Todos os dados protegidos com o token de autenticação não ficarão mais desprotegidos.</span><span class="sxs-lookup"><span data-stu-id="2a8af-225">Any data you protected with the keyring are no longer protected.</span></span>

> [!WARNING]
> <span data-ttu-id="2a8af-226">A Proteção de Dados é usada por vários middlewares ASP.NET, incluindo aqueles usados na autenticação.</span><span class="sxs-lookup"><span data-stu-id="2a8af-226">Data Protection is used by several ASP.NET middlewares, including those used in authentication.</span></span> <span data-ttu-id="2a8af-227">Mesmo se você não chamar APIs de Proteção de dados no próprio código, deverá configurar a Proteção de dados com um script de implantação ou no próprio código.</span><span class="sxs-lookup"><span data-stu-id="2a8af-227">Even if you don't call Data Protection APIs from your own code, you should configure Data Protection with a deployment script or in your code.</span></span> <span data-ttu-id="2a8af-228">Se você não configurar a proteção de dados, por padrão, as chaves serão mantidas na memória e descartadas quando o aplicativo for reiniciado.</span><span class="sxs-lookup"><span data-stu-id="2a8af-228">If you don't configure data protection, by default the keys are held in memory and discarded when your app restarts.</span></span> <span data-ttu-id="2a8af-229">A reinicialização invalida os cookies gravados pelo middleware de autenticação de cookie e os usuários precisarão fazer logon novamente.</span><span class="sxs-lookup"><span data-stu-id="2a8af-229">Restarting invalidates cookies written by the cookie authentication middleware and users must login again.</span></span>

<span data-ttu-id="2a8af-230">Para configurar a Proteção de dados no IIS, use uma das seguintes abordagens:</span><span class="sxs-lookup"><span data-stu-id="2a8af-230">To configure Data Protection under IIS, you must use one of the following approaches:</span></span>

* <span data-ttu-id="2a8af-231">Execute um [script do PowerShell](https://github.com/aspnet/DataProtection/blob/dev/Provision-AutoGenKeys.ps1) para criar as entradas do registro adequadas (por exemplo, `.\Provision-AutoGenKeys.ps1 DefaultAppPool`).</span><span class="sxs-lookup"><span data-stu-id="2a8af-231">Run a [powershell script](https://github.com/aspnet/DataProtection/blob/dev/Provision-AutoGenKeys.ps1) to create suitable registry entries (For example, `.\Provision-AutoGenKeys.ps1 DefaultAppPool`).</span></span> <span data-ttu-id="2a8af-232">Isso armazena as chaves no registro, protegidas usando a DPAPI com uma chave de todo o computador.</span><span class="sxs-lookup"><span data-stu-id="2a8af-232">This stores keys in the registry, protected using DPAPI with a machine-wide key.</span></span>
* <span data-ttu-id="2a8af-233">Configure o Pool de Aplicativos do IIS para carregar o perfil do usuário.</span><span class="sxs-lookup"><span data-stu-id="2a8af-233">Configure the IIS Application Pool to load the user profile.</span></span> <span data-ttu-id="2a8af-234">Essa configuração está na seção **Modelo de Processo** nas **Configurações Avançadas** do pool de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="2a8af-234">This setting is in the **Process Model** section under the **Advanced Settings** for the application pool.</span></span> <span data-ttu-id="2a8af-235">Defina **Carregar Perfil do Usuário** como `True`.</span><span class="sxs-lookup"><span data-stu-id="2a8af-235">Set **Load User Profile** to `True`.</span></span> <span data-ttu-id="2a8af-236">Isso armazena as chaves no diretório do perfil do usuário e as protege usando a DPAPI com uma chave específica à conta de usuário usada para o pool de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="2a8af-236">This stores keys under the user profile directory and protects them using DPAPI with a key specific to the user account used for the app pool.</span></span>
* <span data-ttu-id="2a8af-237">Ajuste o código do aplicativo para [usar o sistema de arquivos como um repositório de tokens de autenticação](xref:security/data-protection/configuration/overview).</span><span class="sxs-lookup"><span data-stu-id="2a8af-237">Adjust your app code to [use the file system as a key ring store](xref:security/data-protection/configuration/overview).</span></span> <span data-ttu-id="2a8af-238">Use um certificado X509 para proteger o token de autenticação e certificar-se de que é um certificado confiável.</span><span class="sxs-lookup"><span data-stu-id="2a8af-238">Use an X509 certificate to protect the keyring and ensure it's a trusted certificate.</span></span> <span data-ttu-id="2a8af-239">Se ele for um certificado autoassinado, você deverá colocá-lo no repositório Raiz confiável.</span><span class="sxs-lookup"><span data-stu-id="2a8af-239">If it's a self signed certificate, you must place it in the Trusted Root store.</span></span>

<span data-ttu-id="2a8af-240">Ao usar o IIS em uma web farm:</span><span class="sxs-lookup"><span data-stu-id="2a8af-240">When using IIS in a web farm:</span></span>

* <span data-ttu-id="2a8af-241">Use um compartilhamento de arquivos que pode ser acessado por todos os computadores.</span><span class="sxs-lookup"><span data-stu-id="2a8af-241">Use a file share that all machines can access.</span></span>
* <span data-ttu-id="2a8af-242">Implante um certificado X509 em cada computador.</span><span class="sxs-lookup"><span data-stu-id="2a8af-242">Deploy an X509 certificate to each machine.</span></span> <span data-ttu-id="2a8af-243">Configure a [proteção de dados no código](https://docs.microsoft.com/aspnet/core/security/data-protection/configuration/overview).</span><span class="sxs-lookup"><span data-stu-id="2a8af-243">Configure [data protection in code](https://docs.microsoft.com/aspnet/core/security/data-protection/configuration/overview).</span></span>

### <a name="1-create-a-data-protection-registry-hive"></a><span data-ttu-id="2a8af-244">1. Criar um Hive do Registro de Proteção de Dados</span><span class="sxs-lookup"><span data-stu-id="2a8af-244">1. Create a Data Protection Registry Hive</span></span>

<span data-ttu-id="2a8af-245">As chaves de Proteção de Dados usadas pelos aplicativos ASP.NET são armazenadas em hives do Registro externos aos aplicativos.</span><span class="sxs-lookup"><span data-stu-id="2a8af-245">Data Protection keys used by ASP.NET applications are stored in registry hives external to the applications.</span></span> <span data-ttu-id="2a8af-246">Para persistir as chaves de determinado aplicativo, você deve criar um hive do registro para o pool de aplicativos do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2a8af-246">To persist the keys for a given application, you must create a registry hive for the app's application pool.</span></span>

<span data-ttu-id="2a8af-247">Para instalações autônomas do IIS, você pode usar o [script Provision-AutoGenKeys.ps1 de Proteção de Dados do PowerShell](https://github.com/aspnet/DataProtection/blob/dev/Provision-AutoGenKeys.ps1) para cada pool de aplicativos usado com um aplicativo ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="2a8af-247">For standalone IIS installations, you may use the [Data Protection Provision-AutoGenKeys.ps1 PowerShell script](https://github.com/aspnet/DataProtection/blob/dev/Provision-AutoGenKeys.ps1) for each app pool used with an ASP.NET Core app.</span></span> <span data-ttu-id="2a8af-248">Esse script cria uma chave do registro especial no registro HKLM que tem a ACL acessível apenas para a conta do processo de trabalho.</span><span class="sxs-lookup"><span data-stu-id="2a8af-248">This script creates a special registry key in the HKLM registry that is ACLed only to the worker process account.</span></span> <span data-ttu-id="2a8af-249">As chaves são criptografadas em repouso usando a DPAPI.</span><span class="sxs-lookup"><span data-stu-id="2a8af-249">Keys are encrypted at rest using DPAPI.</span></span>

<span data-ttu-id="2a8af-250">Em cenários de web farm, um aplicativo pode ser configurado para usar um caminho UNC para armazenar seu token de autenticação de proteção de dados.</span><span class="sxs-lookup"><span data-stu-id="2a8af-250">In web farm scenarios, an app can be configured to use a UNC path to store its data protection keyring.</span></span> <span data-ttu-id="2a8af-251">Por padrão, as chaves de proteção de dados não são criptografadas.</span><span class="sxs-lookup"><span data-stu-id="2a8af-251">By default, the data protection keys are not encrypted.</span></span> <span data-ttu-id="2a8af-252">Garanta que as permissões de arquivo de um compartilhamento como esse são limitadas à conta do Windows na qual o aplicativo é executado.</span><span class="sxs-lookup"><span data-stu-id="2a8af-252">You should ensure that the file permissions for such a share are limited to the Windows account the app runs as.</span></span> <span data-ttu-id="2a8af-253">Além disso, você pode optar por proteger as chaves em repouso usando um certificado X509.</span><span class="sxs-lookup"><span data-stu-id="2a8af-253">In addition, you may choose to protect keys at rest using an X509 certificate.</span></span> <span data-ttu-id="2a8af-254">Talvez você deseje considerar um mecanismo para permitir aos usuários carregar certificados: coloque os certificados no repositório de certificados confiáveis do usuário e certifique-se de que eles estejam disponíveis em todos os computadores nos quais o aplicativo do usuário é executado.</span><span class="sxs-lookup"><span data-stu-id="2a8af-254">You may wish to consider a mechanism to allow users to upload certificates: Place certificates into the user's trusted certificate store and ensure they're available on all machines where the user's app runs.</span></span> <span data-ttu-id="2a8af-255">Consulte [Configurando a Proteção de Dados](xref:security/data-protection/configuration/overview#data-protection-configuring) para obter detalhes.</span><span class="sxs-lookup"><span data-stu-id="2a8af-255">See [Configuring Data Protection](xref:security/data-protection/configuration/overview#data-protection-configuring) for details.</span></span>

### <a name="2-configure-the-iis-application-pool-to-load-the-user-profile"></a><span data-ttu-id="2a8af-256">2. Configurar o Pool de Aplicativos do IIS para carregar o perfil do usuário</span><span class="sxs-lookup"><span data-stu-id="2a8af-256">2. Configure the IIS Application Pool to load the user profile</span></span>

<span data-ttu-id="2a8af-257">Essa configuração está na seção **Modelo de processo** nas **Configurações avançadas** do pool de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="2a8af-257">This setting is in the **Process Model** section under the **Advanced Settings** for the app pool.</span></span> <span data-ttu-id="2a8af-258">Defina Carregar perfil do usuário como `True`.</span><span class="sxs-lookup"><span data-stu-id="2a8af-258">Set Load User Profile to `True`.</span></span> <span data-ttu-id="2a8af-259">Isso armazena as chaves no diretório do perfil do usuário e as protege usando a DPAPI com uma chave específica à conta de usuário usada para o pool de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="2a8af-259">This stores keys under the user profile directory and protects them using DPAPI with a key specific to the user account used for the app pool.</span></span>

### <a name="3-machine-wide-policy-for-data-protection"></a><span data-ttu-id="2a8af-260">3. Política de todo o computador para proteção de dados</span><span class="sxs-lookup"><span data-stu-id="2a8af-260">3. Machine-wide policy for data protection</span></span>

<span data-ttu-id="2a8af-261">O sistema de proteção de dados tem suporte limitado para a configuração da [política de todo o computador](xref:security/data-protection/configuration/machine-wide-policy#data-protection-configuration-machinewidepolicy) padrão para todos os aplicativos que consomem as APIs de proteção de dados.</span><span class="sxs-lookup"><span data-stu-id="2a8af-261">The data protection system has limited support for setting a default [machine-wide policy](xref:security/data-protection/configuration/machine-wide-policy#data-protection-configuration-machinewidepolicy) for all apps that consume the Data Protection APIs.</span></span> <span data-ttu-id="2a8af-262">Consulte a documentação de [proteção de dados](xref:security/data-protection/index) para obter mais detalhes.</span><span class="sxs-lookup"><span data-stu-id="2a8af-262">See the [data protection](xref:security/data-protection/index) documentation for more details.</span></span>

## <a name="configuration-of-sub-applications"></a><span data-ttu-id="2a8af-263">Configuração de subaplicativos</span><span class="sxs-lookup"><span data-stu-id="2a8af-263">Configuration of sub-applications</span></span>

<span data-ttu-id="2a8af-264">Os subaplicativos adicionados no aplicativo raiz não devem incluir o Módulo do ASP.NET Core como um manipulador.</span><span class="sxs-lookup"><span data-stu-id="2a8af-264">Sub applications added under the root application shouldn't include the ASP.NET Core Module as a handler.</span></span> <span data-ttu-id="2a8af-265">Se você adicionar o módulo como um manipulador em um arquivo *web.config* de um subaplicativo, você receberá um 500.19 (Erro interno do servidor) que referencia o arquivo de configuração com falha ao tentar procurar o subaplicativo.</span><span class="sxs-lookup"><span data-stu-id="2a8af-265">If you add the module as a handler in a sub-application's *web.config* file, you receive a 500.19 (Internal Server Error) referencing the faulty config file when you attempt to browse the sub-app.</span></span> <span data-ttu-id="2a8af-266">O seguinte exemplo mostra o conteúdo de um arquivo *web.config* publicado de um subaplicativo ASP.NET Core:</span><span class="sxs-lookup"><span data-stu-id="2a8af-266">The following example shows the contents of a published *web.config* file for an ASP.NET Core sub-app:</span></span>

```xml
<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <system.webServer>
    <aspNetCore processPath="dotnet" 
      arguments=".\MyApp.dll" 
      stdoutLogEnabled="false" 
      stdoutLogFile=".\logs\stdout" />
  </system.webServer>
</configuration>
```

<span data-ttu-id="2a8af-267">Se desejar hospedar um subaplicativo não ASP.NET Core abaixo de um aplicativo ASP.NET Core, deverá remover explicitamente o manipulador herdado no arquivo *web.config* do subaplicativo:</span><span class="sxs-lookup"><span data-stu-id="2a8af-267">If you intend to host a non-ASP.NET Core sub-app underneath an ASP.NET Core app, you must explicitly remove the inherited handler in the sub-app *web.config* file:</span></span>

```xml
<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <system.webServer>
    <handlers>
      <remove name="aspNetCore"/>
    </handlers>
    <aspNetCore processPath="dotnet" 
      arguments=".\MyApp.dll" 
      stdoutLogEnabled="false" 
      stdoutLogFile=".\logs\stdout" />
  </system.webServer>
</configuration>
```

<span data-ttu-id="2a8af-268">Para obter mais informações sobre como configurar o Módulo do ASP.NET Core com o arquivo *web.config*, consulte o tópico [Introdução ao Módulo do ASP.NET Core](xref:fundamentals/servers/aspnet-core-module) e a [referência de configuração do Módulo do Core ASP.NET](xref:hosting/aspnet-core-module).</span><span class="sxs-lookup"><span data-stu-id="2a8af-268">For more information on configuring the ASP.NET Core Module with the *web.config* file, see the [Introduction to ASP.NET Core Module](xref:fundamentals/servers/aspnet-core-module) topic and the [ASP.NET Core Module configuration reference](xref:hosting/aspnet-core-module).</span></span>

## <a name="configuration-of-iis-with-webconfig"></a><span data-ttu-id="2a8af-269">Configuração do IIS com web.config</span><span class="sxs-lookup"><span data-stu-id="2a8af-269">Configuration of IIS with web.config</span></span>

<span data-ttu-id="2a8af-270">A configuração do IIS ainda é influenciada pela seção `<system.webServer>` de *web.config* para os recursos do IIS que se aplicam a uma configuração de proxy reverso.</span><span class="sxs-lookup"><span data-stu-id="2a8af-270">IIS configuration is still influenced by the `<system.webServer>` section of *web.config* for those IIS features that apply to a reverse proxy configuration.</span></span> <span data-ttu-id="2a8af-271">Por exemplo, você pode ter o IIS configurado no nível do sistema para usar a compactação dinâmica, mas poderá desabilitar essa configuração para um aplicativo com o elemento `<urlCompression>` no arquivo *web.config* do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2a8af-271">For example, you may have IIS configured at the system level to use dynamic compression, but you could disable that setting for an app with the `<urlCompression>` element in the app's *web.config* file.</span></span> <span data-ttu-id="2a8af-272">Para obter mais informações, consulte a [referência de configuração do `<system.webServer>`](https://docs.microsoft.com/iis/configuration/system.webServer/), a [referência de configuração do Módulo do ASP.NET Core](xref:hosting/aspnet-core-module) e [Usando os Módulos do IIS com o ASP.NET Core](xref:hosting/iis-modules).</span><span class="sxs-lookup"><span data-stu-id="2a8af-272">For more information, see the [configuration reference for `<system.webServer>`](https://docs.microsoft.com/iis/configuration/system.webServer/), [ASP.NET Core Module Configuration Reference](xref:hosting/aspnet-core-module) and [Using IIS Modules with ASP.NET Core](xref:hosting/iis-modules).</span></span> <span data-ttu-id="2a8af-273">Se precisar definir variáveis de ambiente para aplicativos individuais executados em Pools de Aplicativos isolados (com suporte no IIS 10.0+), consulte a seção *comando AppCmd.exe* do tópico [Variáveis de ambiente \<environmentVariables>](/iis/configuration/system.applicationHost/applicationPools/add/environmentVariables/#appcmdexe) na documentação de referência do IIS.</span><span class="sxs-lookup"><span data-stu-id="2a8af-273">If you need to set environment variables for individual apps running in isolated Application Pools (supported on IIS 10.0+), see the *AppCmd.exe command* section of the [Environment Variables \<environmentVariables>](/iis/configuration/system.applicationHost/applicationPools/add/environmentVariables/#appcmdexe) topic in the IIS reference documentation.</span></span>

## <a name="configuration-sections-of-webconfig"></a><span data-ttu-id="2a8af-274">Seções de configuração de web.config</span><span class="sxs-lookup"><span data-stu-id="2a8af-274">Configuration sections of web.config</span></span>

<span data-ttu-id="2a8af-275">Ao contrário dos aplicativos .NET Framework configurados com os elementos `<system.web>`, `<appSettings>`, `<connectionStrings>` e `<location>` em *web.config*, os aplicativos ASP.NET Core são configurados usando outros provedores de configuração.</span><span class="sxs-lookup"><span data-stu-id="2a8af-275">Unlike .NET Framework applications that are configured with the `<system.web>`, `<appSettings>`, `<connectionStrings>`, and `<location>` elements in *web.config*, ASP.NET Core apps are configured using other configuration providers.</span></span> <span data-ttu-id="2a8af-276">Para obter mais informações, consulte [Configuração](xref:fundamentals/configuration).</span><span class="sxs-lookup"><span data-stu-id="2a8af-276">For more information, see [Configuration](xref:fundamentals/configuration).</span></span>

## <a name="application-pools"></a><span data-ttu-id="2a8af-277">Pools de aplicativos</span><span class="sxs-lookup"><span data-stu-id="2a8af-277">Application Pools</span></span>

<span data-ttu-id="2a8af-278">Ao hospedar vários sites em um único sistema, você deve isolar os aplicativos entre si, executando cada aplicativo em seu próprio pool de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="2a8af-278">When hosting multiple websites on a single system, you should isolate the apps from each other by running each app in its own application pool.</span></span> <span data-ttu-id="2a8af-279">A caixa de diálogo **Adicionar Site** do IIS usa como padrão esse comportamento.</span><span class="sxs-lookup"><span data-stu-id="2a8af-279">The IIS **Add Website** dialog defaults to this behavior.</span></span> <span data-ttu-id="2a8af-280">Quando você fornece um **Nome do site**, o texto é transferido automaticamente para a caixa de texto **Pool de aplicativos**.</span><span class="sxs-lookup"><span data-stu-id="2a8af-280">When you provide a **Site name**, the text is automatically transferred to the **Application pool** textbox.</span></span> <span data-ttu-id="2a8af-281">Um novo pool de aplicativos é criado usando o nome do site quando você adicionar o site.</span><span class="sxs-lookup"><span data-stu-id="2a8af-281">A new application pool is created using the site name when you add the website.</span></span>

## <a name="application-pool-identity"></a><span data-ttu-id="2a8af-282">Identidade do pool de aplicativos</span><span class="sxs-lookup"><span data-stu-id="2a8af-282">Application Pool Identity</span></span>

<span data-ttu-id="2a8af-283">Uma conta de identidade do pool de aplicativos permite executar um aplicativo em uma conta exclusiva sem a necessidade de criar e gerenciar domínios ou contas locais.</span><span class="sxs-lookup"><span data-stu-id="2a8af-283">An application pool identity account allows you to run an application under a unique account without having to create and manage domains or local accounts.</span></span> <span data-ttu-id="2a8af-284">No IIS 8.0+, o WAS (Processo de trabalho do administrador) do IIS cria uma conta virtual com o nome do novo pool de aplicativos e executa os processos de trabalho do pool de aplicativos nesta conta por padrão.</span><span class="sxs-lookup"><span data-stu-id="2a8af-284">On IIS 8.0+, the IIS Admin Worker Process (WAS) creates a virtual account with the name of the new application pool and runs the app pool's worker processes under this account by default.</span></span> <span data-ttu-id="2a8af-285">No Console de Gerenciamento do IIS, em **Configurações avançadas** do pool de aplicativos, verifique se a **Identidade** é definida para usar **ApplicationPoolIdentity**, conforme mostrado na imagem abaixo.</span><span class="sxs-lookup"><span data-stu-id="2a8af-285">In the IIS Management Console under **Advanced Settings** for your app pool, ensure that the **Identity** is set to use **ApplicationPoolIdentity** as shown in the image below.</span></span>

![Caixa de diálogo Configurações avançadas do pool de aplicativos](iis/_static/apppool-identity.png)

<span data-ttu-id="2a8af-287">O processo de gerenciamento do IIS cria um identificador seguro com o nome do pool de aplicativos no Sistema de segurança do Windows.</span><span class="sxs-lookup"><span data-stu-id="2a8af-287">The IIS management process creates a secure identifier with the name of the app pool in the Windows Security System.</span></span> <span data-ttu-id="2a8af-288">Os recursos podem ser protegidos usando essa identidade; no entanto, essa identidade não é uma conta de usuário real e não será mostrada no Console de Gerenciamento de usuário do Windows.</span><span class="sxs-lookup"><span data-stu-id="2a8af-288">Resources can be secured by using this identity; however, this identity isn't a real user account and won't show up in the Windows User Management Console.</span></span>

<span data-ttu-id="2a8af-289">Se você precisar conceder ao processo de trabalho do IIS o acesso elevado ao aplicativo, precisará modificar a ACL (lista de controle de acesso) do diretório que contém o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2a8af-289">If you need to grant the IIS worker process elevated access to your app, you must modify the Access Control List (ACL) for the directory containing your application.</span></span>

1. <span data-ttu-id="2a8af-290">Abra o Windows Explorer e navegue para o diretório.</span><span class="sxs-lookup"><span data-stu-id="2a8af-290">Open Windows Explorer and navigate to the directory.</span></span>

2. <span data-ttu-id="2a8af-291">Clique com o botão direito do mouse no diretório e clique em **Propriedades**.</span><span class="sxs-lookup"><span data-stu-id="2a8af-291">Right click on the directory and click **Properties**.</span></span>

3. <span data-ttu-id="2a8af-292">Na guia **Segurança**, clique no botão **Editar** e, em seguida, no botão **Adicionar**.</span><span class="sxs-lookup"><span data-stu-id="2a8af-292">Under the **Security** tab, click the **Edit** button and then the **Add** button.</span></span>

4. <span data-ttu-id="2a8af-293">Clique no botão **Locais** e selecione seu sistema.</span><span class="sxs-lookup"><span data-stu-id="2a8af-293">Click the **Locations** button and make sure you select your system.</span></span>

5. <span data-ttu-id="2a8af-294">Insira **IIS AppPool\DefaultAppPool** na caixa de texto **Inserir os nomes de objeto a serem selecionados**.</span><span class="sxs-lookup"><span data-stu-id="2a8af-294">Enter **IIS AppPool\DefaultAppPool** in **Enter the object names to select** textbox.</span></span>

  ![Caixa de diálogo Selecionar usuários ou grupos da pasta do aplicativo](iis/_static/select-users-or-groups-1.png)

6. <span data-ttu-id="2a8af-296">Clique no botão **Verificar Nomes** e, em seguida, clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="2a8af-296">Click the **Check Names** button and then click **OK**.</span></span>

  ![Caixa de diálogo Selecionar usuários ou grupos da pasta do aplicativo](iis/_static/select-users-or-groups-2.png)

<span data-ttu-id="2a8af-298">Também faça isso por meio de um prompt de comando usando a ferramenta **ICACLS**:</span><span class="sxs-lookup"><span data-stu-id="2a8af-298">You can also do this via a command prompt using **ICACLS** tool:</span></span>

```console
ICACLS C:\sites\MyWebApp /grant "IIS AppPool\DefaultAppPool":F
```

## <a name="troubleshooting-tips"></a><span data-ttu-id="2a8af-299">Dicas de solução de problemas</span><span class="sxs-lookup"><span data-stu-id="2a8af-299">Troubleshooting tips</span></span>

<span data-ttu-id="2a8af-300">Para diagnosticar problemas com as implantações do IIS:</span><span class="sxs-lookup"><span data-stu-id="2a8af-300">To diagnose problems with IIS deployments:</span></span>

* <span data-ttu-id="2a8af-301">Estude a saída do navegador.</span><span class="sxs-lookup"><span data-stu-id="2a8af-301">Study browser output.</span></span>
* <span data-ttu-id="2a8af-302">Examine o log de **Aplicativo** do sistema por meio do **Visualizador de eventos**.</span><span class="sxs-lookup"><span data-stu-id="2a8af-302">Examine the system's **Application** log through **Event Viewer**.</span></span>
* <span data-ttu-id="2a8af-303">Habilite o registro em log do `stdout`.</span><span class="sxs-lookup"><span data-stu-id="2a8af-303">Enable `stdout` logging.</span></span> <span data-ttu-id="2a8af-304">O log do **Módulo do ASP.NET Core** é encontrado no caminho fornecido no atributo *stdoutLogFile* do elemento `<aspNetCore>` em *web.config*. As pastas no caminho fornecido no valor do atributo devem existir na implantação.</span><span class="sxs-lookup"><span data-stu-id="2a8af-304">The **ASP.NET Core Module** log is found on the path provided in the *stdoutLogFile* attribute of the `<aspNetCore>` element in *web.config*. Any folders on the path provided in the attribute value must exist in the deployment.</span></span> <span data-ttu-id="2a8af-305">Você também deve definir *stdoutLogEnabled="true"*.</span><span class="sxs-lookup"><span data-stu-id="2a8af-305">You must also set *stdoutLogEnabled="true"*.</span></span> <span data-ttu-id="2a8af-306">Os aplicativos que usam o SDK do `Microsoft.NET.Sdk.Web` para criar o arquivo *web.config* usam como padrão a configuração *stdoutLogEnabled* como *false*. Portanto, é necessário fornecer manualmente o arquivo *web.config* ou modificar o arquivo para habilitar o log do `stdout`.</span><span class="sxs-lookup"><span data-stu-id="2a8af-306">Apps that use the the `Microsoft.NET.Sdk.Web` SDK to create the *web.config* file default the *stdoutLogEnabled* setting to *false*, so you must manually provide the *web.config* file or modify the file in order to enable `stdout` logging.</span></span>

<span data-ttu-id="2a8af-307">Vários dos erros comuns não são exibidos no navegador, no Log do aplicativo e no Log do módulo do ASP.NET Core até que o módulo *startupTimeLimit* (padrão: 120 segundos) e *startupRetryCount* (padrão: 2) tenham decorrido.</span><span class="sxs-lookup"><span data-stu-id="2a8af-307">Several of the common errors don't appear in the browser, Application Log, and ASP.NET Core Module Log until the module *startupTimeLimit* (default: 120 seconds) and *startupRetryCount* (default: 2) have passed.</span></span> <span data-ttu-id="2a8af-308">Portanto, aguarde seis minutos completos antes de deduzir que o módulo falhou ao iniciar um processo para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2a8af-308">Therefore, wait a full six minutes before deducing that the module has failed to start a process for the app.</span></span>

<span data-ttu-id="2a8af-309">Uma maneira rápida de determinar se o aplicativo está funcionando corretamente é executar o aplicativo diretamente no Kestrel.</span><span class="sxs-lookup"><span data-stu-id="2a8af-309">One quick way to determine if the app is working properly is to run the app directly on Kestrel.</span></span> <span data-ttu-id="2a8af-310">Se o aplicativo foi publicado como uma implantação dependente de estrutura (FFD), execute `dotnet my_application.dll` na pasta de implantação, que é o caminho físico do IIS para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2a8af-310">If the app was published as a framework-dependent deployment (FDD), execute `dotnet my_application.dll` in the deployment folder, which is the IIS physical path to the app.</span></span> <span data-ttu-id="2a8af-311">Se o aplicativo foi publicado como uma implantação independente (SCD), execute o executável do aplicativo diretamente em um prompt de comando, `my_application.exe`, na pasta de implantação.</span><span class="sxs-lookup"><span data-stu-id="2a8af-311">If the app was published as a self-contained deployment (SCD), run the app's executable directly from a command prompt, `my_application.exe`, in the deployment folder.</span></span> <span data-ttu-id="2a8af-312">Se o Kestrel estiver escutando na porta padrão 5000, você poderá procurar o aplicativo em `http://localhost:5000/`.</span><span class="sxs-lookup"><span data-stu-id="2a8af-312">If Kestrel is listening on default port 5000, you should be able to browse the app at `http://localhost:5000/`.</span></span> <span data-ttu-id="2a8af-313">Se o aplicativo responder normalmente no endereço do ponto de extremidade do Kestrel, mais provavelmente, o problema estará relacionado à configuração do IIS-Módulo do ASP.NET Core-Kestrel e, menos provavelmente, ao próprio aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2a8af-313">If the app responds normally at the Kestrel endpoint address, the problem is more likely related to the IIS-ASP.NET Core Module-Kestrel configuration and less likely within the app itself.</span></span>

<span data-ttu-id="2a8af-314">Uma maneira de determinar se o proxy reverso do IIS para o servidor Kestrel está funcionando corretamente é executar uma solicitação de arquivo estático simples para uma folha de estilos, um script ou uma imagem dos arquivos estáticos do aplicativo em *wwwroot* usando o [middleware de Arquivo estático](xref:fundamentals/static-files).</span><span class="sxs-lookup"><span data-stu-id="2a8af-314">One way to determine if the IIS reverse proxy to the Kestrel server is working properly is to perform a simple static file request for a stylesheet, script, or image from the app's static files in *wwwroot* using [Static File middleware](xref:fundamentals/static-files).</span></span> <span data-ttu-id="2a8af-315">Se o aplicativo puder atender a arquivos estáticos, mas as Exibições do MVC e outros pontos de extremidade estiverem falhando, menos provavelmente, o problema será relacionado à configuração do IIS/Módulo do ASP.NET Core/Kestrel e, mais provavelmente, ao próprio aplicativo (por exemplo, roteamento MVC ou 500 Erro interno de servidor).</span><span class="sxs-lookup"><span data-stu-id="2a8af-315">If the app can serve static files but MVC Views and other endpoints are failing, the problem is less likely related to the IIS-ASP.NET Core Module-Kestrel configuration and more likely within the app itself (for example, MVC routing or 500 Internal Server Error).</span></span>

<span data-ttu-id="2a8af-316">Quando o Kestrel é iniciado normalmente com a proteção do IIS, mas o aplicativo não é executado no sistema depois de ser executado com êxito localmente, você pode adicionar temporariamente uma variável de ambiente ao *web.config* para definir o `ASPNETCORE_ENVIRONMENT` como `Development`.</span><span class="sxs-lookup"><span data-stu-id="2a8af-316">When Kestrel starts normally behind IIS but the app won't run on the system after successfully running locally, you can temporarily add an environment variable to *web.config* to set the `ASPNETCORE_ENVIRONMENT` to `Development`.</span></span> <span data-ttu-id="2a8af-317">Desde que você não substitua o ambiente na inicialização do aplicativo, isso permitirá que a [página de exceção do desenvolvedor](xref:fundamentals/error-handling) seja exibida quando o aplicativo é executado no sistema.</span><span class="sxs-lookup"><span data-stu-id="2a8af-317">As long as you don't override the environment in app startup, this allows the [developer exception page](xref:fundamentals/error-handling) to appear when the app is run on the system.</span></span> <span data-ttu-id="2a8af-318">A configuração da variável de ambiente como `ASPNETCORE_ENVIRONMENT` dessa maneira só é recomendado para sistemas de preparo/teste que não estejam expostos à Internet.</span><span class="sxs-lookup"><span data-stu-id="2a8af-318">Setting the environment variable for `ASPNETCORE_ENVIRONMENT` in this way is only recommended for staging/testing systems that aren't exposed to the Internet.</span></span> <span data-ttu-id="2a8af-319">Lembre-se de remover a variável de ambiente do arquivo *web.config* quando terminar.</span><span class="sxs-lookup"><span data-stu-id="2a8af-319">Be sure you remove the environment variable from the *web.config* file when finished.</span></span> <span data-ttu-id="2a8af-320">Para obter informações sobre como definir variáveis de ambiente por meio de *web.config* no proxy reverso, consulte [Elemento filho environmentVariables de aspNetCore](xref:hosting/aspnet-core-module#setting-environment-variables).</span><span class="sxs-lookup"><span data-stu-id="2a8af-320">For information on setting environment variables via *web.config* for the reverse proxy, see [environmentVariables child element of aspNetCore](xref:hosting/aspnet-core-module#setting-environment-variables).</span></span>

<span data-ttu-id="2a8af-321">Na maioria dos casos, a habilitação do log do aplicativo ajudará na solução de problemas com o aplicativo ou o proxy reverso.</span><span class="sxs-lookup"><span data-stu-id="2a8af-321">In most cases, enabling application logging assists in troubleshooting problems with the app or the reverse proxy.</span></span> <span data-ttu-id="2a8af-322">Consulte [Log](xref:fundamentals/logging) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="2a8af-322">See [Logging](xref:fundamentals/logging) for more information.</span></span>

<span data-ttu-id="2a8af-323">Nossa última dica de solução de problemas se refere a aplicativos que não são executados após o upgrade do SDK do .NET Core nas versões de pacote ou de computador de desenvolvimento no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2a8af-323">Our last troubleshooting tip pertains to apps that fail to run after upgrading either the .NET Core SDK on the development machine or package versions within the app.</span></span> <span data-ttu-id="2a8af-324">Em alguns casos, pacotes incoerentes podem interromper um aplicativo ao executar atualizações principais.</span><span class="sxs-lookup"><span data-stu-id="2a8af-324">In some cases, incoherent packages may break an app when performing major upgrades.</span></span> <span data-ttu-id="2a8af-325">Corrija a maioria desses problemas excluindo as pastas `bin` e `obj` do projeto, limpando os caches do pacote em `%UserProfile%\.nuget\packages\` e `%LocalAppData%\Nuget\v3-cache`, restaurando o projeto e confirmando se a implantação anterior no sistema foi completamente excluída antes de reimplantar o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2a8af-325">You can fix most of these issues by deleting the `bin` and `obj` folders in the project, clearing package caches at `%UserProfile%\.nuget\packages\` and `%LocalAppData%\Nuget\v3-cache`, restoring the project, and confirming that your prior deployment on the system has been completely deleted prior to re-deploying the app.</span></span>

> [!TIP]
> <span data-ttu-id="2a8af-326">Uma maneira conveniente de limpar caches do pacote é obter a ferramenta *NuGet.exe* em [NuGet.org](https://www.nuget.org/), adicioná-la ao PATH do sistema e executar `nuget locals all -clear` em um prompt de comando.</span><span class="sxs-lookup"><span data-stu-id="2a8af-326">A convenient way to clear package caches is to obtain the *NuGet.exe* tool from [NuGet.org](https://www.nuget.org/), add it to your system PATH, and execute `nuget locals all -clear` from a command prompt.</span></span> <span data-ttu-id="2a8af-327">Você também pode executar o comando `dotnet nuget locals all --clear` em um prompt de comando sem obter *NuGet.exe*.</span><span class="sxs-lookup"><span data-stu-id="2a8af-327">You can also execute the `dotnet nuget locals all --clear` command from a command prompt without obtaining *NuGet.exe*.</span></span>

## <a name="common-errors"></a><span data-ttu-id="2a8af-328">Erros comuns</span><span class="sxs-lookup"><span data-stu-id="2a8af-328">Common errors</span></span>

<span data-ttu-id="2a8af-329">A lista a seguir não é uma lista completa de erros.</span><span class="sxs-lookup"><span data-stu-id="2a8af-329">The following isn't a complete list of errors.</span></span> <span data-ttu-id="2a8af-330">Caso encontre um erro não listado aqui, deixe uma mensagem de erro detalhada na seção de comentários abaixo.</span><span class="sxs-lookup"><span data-stu-id="2a8af-330">Should you encounter an error not listed here, please leave a detailed error message in the comments section below.</span></span>

### <a name="installer-unable-to-obtain-vc-redistributable"></a><span data-ttu-id="2a8af-331">O instalador não pode obter os Pacotes Redistribuíveis do VC++</span><span class="sxs-lookup"><span data-stu-id="2a8af-331">Installer unable to obtain VC++ Redistributable</span></span>

* <span data-ttu-id="2a8af-332">**Exceção do Instalador:** 0x80072efd ou 0x80072f76 – erro não especificado</span><span class="sxs-lookup"><span data-stu-id="2a8af-332">**Installer Exception:** 0x80072efd or 0x80072f76 - Unspecified error</span></span>

* <span data-ttu-id="2a8af-333">**Exceção do Log do Instalador&#8224;:** erro 0x80072efd ou 0x80072f76: falha ao executar o pacote EXE</span><span class="sxs-lookup"><span data-stu-id="2a8af-333">**Installer Log Exception&#8224;:** Error 0x80072efd or 0x80072f76: Failed to execute EXE package</span></span>

  <span data-ttu-id="2a8af-334">&#8224;O log está localizado em C:\Users\\{USER}\AppData\Local\Temp\dd_DotNetCoreWinSvrHosting__{timestamp}.log.</span><span class="sxs-lookup"><span data-stu-id="2a8af-334">&#8224;The log is located at C:\Users\\{USER}\AppData\Local\Temp\dd_DotNetCoreWinSvrHosting__{timestamp}.log.</span></span>

<span data-ttu-id="2a8af-335">Solução de problemas:</span><span class="sxs-lookup"><span data-stu-id="2a8af-335">Troubleshooting:</span></span>

* <span data-ttu-id="2a8af-336">Se o sistema não tiver acesso à Internet durante a instalação do servidor que hospeda o pacote, essa exceção ocorrerá quando o instalador for impedido de obter os *Pacotes redistribuíveis do Microsoft Visual C++ 2015*.</span><span class="sxs-lookup"><span data-stu-id="2a8af-336">If the system doesn't have Internet access while installing the server hosting bundle, this exception occurs when the installer is prevented from obtaining the *Microsoft Visual C++ 2015 Redistributable*.</span></span> <span data-ttu-id="2a8af-337">Obtenha um instalador no [Centro de Download da Microsoft](https://www.microsoft.com/download/details.aspx?id=53840).</span><span class="sxs-lookup"><span data-stu-id="2a8af-337">You may obtain an installer from the [Microsoft Download Center](https://www.microsoft.com/download/details.aspx?id=53840).</span></span> <span data-ttu-id="2a8af-338">Se o instalador falhar, talvez você não receba o tempo de execução do .NET Core necessário para hospedar implantações dependentes de estrutura (FDD).</span><span class="sxs-lookup"><span data-stu-id="2a8af-338">If the installer fails, you may not receive the .NET Core runtime required to host a framework-dependent deployment (FDD).</span></span> <span data-ttu-id="2a8af-339">Se você pretende hospedar uma FDD, confirme se o tempo de execução está instalado em Programas &amp; Recursos.</span><span class="sxs-lookup"><span data-stu-id="2a8af-339">If you plan to host an FDD, confirm that the runtime is installed in Programs &amp; Features.</span></span> <span data-ttu-id="2a8af-340">Obtenha um instalador de tempo de execução em [Downloads do .NET](https://www.microsoft.com/net/download/core).</span><span class="sxs-lookup"><span data-stu-id="2a8af-340">You may obtain a runtime installer from [.NET Downloads](https://www.microsoft.com/net/download/core).</span></span> <span data-ttu-id="2a8af-341">Depois de instalar o tempo de execução, reinicie o sistema ou o IIS executando **net stop was /y** seguido por **net start w3svc** em um prompt de comando.</span><span class="sxs-lookup"><span data-stu-id="2a8af-341">After installing the runtime, restart the system or restart IIS by executing **net stop was /y** followed by **net start w3svc** from a command prompt.</span></span>

### <a name="os-upgrade-removed-the-32-bit-aspnet-core-module"></a><span data-ttu-id="2a8af-342">O upgrade do sistema operacional removeu o Módulo do ASP.NET Core de 32 bits</span><span class="sxs-lookup"><span data-stu-id="2a8af-342">OS upgrade removed the 32-bit ASP.NET Core Module</span></span>

* <span data-ttu-id="2a8af-343">**Log do Aplicativo:** a DLL do Módulo **C:\WINDOWS\system32\inetsrv\aspnetcore.dll** falhou ao ser carregada.</span><span class="sxs-lookup"><span data-stu-id="2a8af-343">**Application Log:** The Module DLL **C:\WINDOWS\system32\inetsrv\aspnetcore.dll** failed to load.</span></span> <span data-ttu-id="2a8af-344">Os dados são o erro.</span><span class="sxs-lookup"><span data-stu-id="2a8af-344">The data is the error.</span></span>

<span data-ttu-id="2a8af-345">Solução de problemas:</span><span class="sxs-lookup"><span data-stu-id="2a8af-345">Troubleshooting:</span></span>

* <span data-ttu-id="2a8af-346">Arquivos que não são do sistema operacional no diretório **C:\Windows\SysWOW64\inetsrv** não são preservados durante um upgrade do sistema operacional.</span><span class="sxs-lookup"><span data-stu-id="2a8af-346">Non-OS files in the **C:\Windows\SysWOW64\inetsrv** directory aren't preserved during an OS upgrade.</span></span> <span data-ttu-id="2a8af-347">Se você tiver o Módulo do ASP.NET Core instalado antes de um upgrade do sistema operacional e, em seguida, tentar executar qualquer AppPool no modo de 32 bits após um upgrade do sistema operacional, encontrará esse problema.</span><span class="sxs-lookup"><span data-stu-id="2a8af-347">If you have the ASP.NET Core Module installed prior to an OS upgrade and then try to run any AppPool in 32-bit mode after an OS upgrade, you encounter this issue.</span></span> <span data-ttu-id="2a8af-348">Após um upgrade do sistema operacional, repare o Módulo do ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="2a8af-348">After an OS upgrade, repair the ASP.NET Core Module.</span></span> <span data-ttu-id="2a8af-349">Consulte [Instalar o pacote de hospedagem do Windows Server do .NET Core](#install-the-net-core-windows-server-hosting-bundle).</span><span class="sxs-lookup"><span data-stu-id="2a8af-349">See [Install the .NET Core Windows Server Hosting bundle](#install-the-net-core-windows-server-hosting-bundle).</span></span> <span data-ttu-id="2a8af-350">Selecione **Reparar** ao executar o instalador.</span><span class="sxs-lookup"><span data-stu-id="2a8af-350">Select **Repair** when you run the installer.</span></span>

### <a name="platform-conflicts-with-rid"></a><span data-ttu-id="2a8af-351">Conflitos de plataforma com o RID</span><span class="sxs-lookup"><span data-stu-id="2a8af-351">Platform conflicts with RID</span></span>

* <span data-ttu-id="2a8af-352">**Navegador:** 502.5 Erro HTTP – falha do processo</span><span class="sxs-lookup"><span data-stu-id="2a8af-352">**Browser:** HTTP Error 502.5 - Process Failure</span></span>

* <span data-ttu-id="2a8af-353">**Log do Aplicativo:** o aplicativo “MACHINE/WEBROOT/APPHOST/MY_APPLICATION” com a raiz física “C:\{PATH}\'” falhou ao iniciar o processo com a linha de comando “C:\\{PATH}\my_application.{exe|dll}” , ErrorCode = 0x80004005 : ff.</span><span class="sxs-lookup"><span data-stu-id="2a8af-353">**Application Log:** Application 'MACHINE/WEBROOT/APPHOST/MY_APPLICATION' with physical root 'C:\{PATH}\' failed to start process with commandline '"C:\\{PATH}\my_application.{exe|dll}" ', ErrorCode = '0x80004005 : ff.</span></span>

* <span data-ttu-id="2a8af-354">**Log do Módulo do ASP.NET Core:** exceção sem tratamento: System.BadImageFormatException: não foi possível carregar o arquivo ou o assembly “my_application.dll”.</span><span class="sxs-lookup"><span data-stu-id="2a8af-354">**ASP.NET Core Module Log:** Unhandled Exception: System.BadImageFormatException: Could not load file or assembly 'my_application.dll'.</span></span> <span data-ttu-id="2a8af-355">Foi feita uma tentativa de carregar um programa com um formato incorreto.</span><span class="sxs-lookup"><span data-stu-id="2a8af-355">An attempt was made to load a program with an incorrect format.</span></span>

<span data-ttu-id="2a8af-356">Solução de problemas:</span><span class="sxs-lookup"><span data-stu-id="2a8af-356">Troubleshooting:</span></span>

* <span data-ttu-id="2a8af-357">Confirme se o aplicativo é executado localmente no Kestrel.</span><span class="sxs-lookup"><span data-stu-id="2a8af-357">Confirm that the application runs locally on Kestrel.</span></span> <span data-ttu-id="2a8af-358">Uma falha do processo pode ser o resultado de um problema no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2a8af-358">A process failure might be the result of a problem within the application.</span></span> <span data-ttu-id="2a8af-359">Para obter mais informações, consulte [Dicas de solução de problemas](#troubleshooting-tips).</span><span class="sxs-lookup"><span data-stu-id="2a8af-359">For more information, see [Troubleshooting tips](#troubleshooting-tips).</span></span>

* <span data-ttu-id="2a8af-360">Confirme se você não definiu um `<PlatformTarget>` no *.csproj* que está em conflito com o RID.</span><span class="sxs-lookup"><span data-stu-id="2a8af-360">Confirm that you didn't set a `<PlatformTarget>` in your *.csproj* that conflicts with the RID.</span></span> <span data-ttu-id="2a8af-361">Por exemplo, não especifique um `<PlatformTarget>` igual a `x86` e publique com um RID igual a `win10-x64`, usando *dotnet publish -c Release -r win10-x64* ou definindo o `<RuntimeIdentifiers>` no *.csproj* como `win10-x64`.</span><span class="sxs-lookup"><span data-stu-id="2a8af-361">For example, don't specify a `<PlatformTarget>` of `x86` and publish with an RID of `win10-x64`, either by using *dotnet publish -c Release -r win10-x64* or by setting the `<RuntimeIdentifiers>` in your *.csproj* to `win10-x64`.</span></span> <span data-ttu-id="2a8af-362">O projeto é publicado sem avisos nem erros, mas falha com as exceções registradas acima no sistema.</span><span class="sxs-lookup"><span data-stu-id="2a8af-362">The project publishes without warning or error but fails with the above logged exceptions on the system.</span></span>

* <span data-ttu-id="2a8af-363">Se essa exceção ocorrer para uma implantação dos Aplicativos do Azure ao fazer upgrade de um aplicativo e implantar assemblies mais recentes, exclua manualmente todos os arquivos da implantação anterior.</span><span class="sxs-lookup"><span data-stu-id="2a8af-363">If this exception occurs for an Azure Apps deployment when upgrading an application and deploying newer assemblies, manually delete all files from the prior deployment.</span></span> <span data-ttu-id="2a8af-364">Assemblies incompatíveis remanescentes podem resultar em uma exceção `System.BadImageFormatException` durante a implantação de um aplicativo atualizado.</span><span class="sxs-lookup"><span data-stu-id="2a8af-364">Lingering incompatible assemblies can result in a `System.BadImageFormatException` exception when deploying an upgraded app.</span></span>

### <a name="uri-endpoint-wrong-or-stopped-website"></a><span data-ttu-id="2a8af-365">Ponto de extremidade de URI incorreto ou site interrompido</span><span class="sxs-lookup"><span data-stu-id="2a8af-365">URI endpoint wrong or stopped website</span></span>

* <span data-ttu-id="2a8af-366">**Navegador:** ERR_CONNECTION_REFUSED</span><span class="sxs-lookup"><span data-stu-id="2a8af-366">**Browser:** ERR_CONNECTION_REFUSED</span></span>

* <span data-ttu-id="2a8af-367">**Log do Aplicativo:** nenhuma entrada</span><span class="sxs-lookup"><span data-stu-id="2a8af-367">**Application Log:** No entry</span></span>

* <span data-ttu-id="2a8af-368">**Log do Módulo do ASP.NET Core:** arquivo de log não criado</span><span class="sxs-lookup"><span data-stu-id="2a8af-368">**ASP.NET Core Module Log:** Log file not created</span></span>

<span data-ttu-id="2a8af-369">Solução de problemas:</span><span class="sxs-lookup"><span data-stu-id="2a8af-369">Troubleshooting:</span></span>

* <span data-ttu-id="2a8af-370">Confirme se que você está usando o ponto de extremidade de URI correto para o aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2a8af-370">Confirm you are using the correct URI endpoint for the application.</span></span> <span data-ttu-id="2a8af-371">Verifique as associações.</span><span class="sxs-lookup"><span data-stu-id="2a8af-371">Check your bindings.</span></span>

* <span data-ttu-id="2a8af-372">Confirme se o site do IIS não está no estado *Parado*.</span><span class="sxs-lookup"><span data-stu-id="2a8af-372">Confirm that the IIS website is not in the *Stopped* state.</span></span>

### <a name="corewebengine-or-w3svc-server-features-disabled"></a><span data-ttu-id="2a8af-373">Recursos do servidor CoreWebEngine ou W3SVC desabilitados</span><span class="sxs-lookup"><span data-stu-id="2a8af-373">CoreWebEngine or W3SVC server features disabled</span></span>

* <span data-ttu-id="2a8af-374">**Exceção do Sistema Operacional:** os recursos CoreWebEngine e W3SVC do IIS 7.0 devem ser instalados para usar o Módulo do ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="2a8af-374">**OS Exception:** The IIS 7.0 CoreWebEngine and W3SVC features must be installed to use the ASP.NET Core Module.</span></span>

<span data-ttu-id="2a8af-375">Solução de problemas:</span><span class="sxs-lookup"><span data-stu-id="2a8af-375">Troubleshooting:</span></span>

* <span data-ttu-id="2a8af-376">Confirme se você habilitou a função e os recursos apropriados.</span><span class="sxs-lookup"><span data-stu-id="2a8af-376">Confirm that you have enabled the proper role and features.</span></span> <span data-ttu-id="2a8af-377">Consulte [Configuração do IIS](#iis-configuration).</span><span class="sxs-lookup"><span data-stu-id="2a8af-377">See [IIS Configuration](#iis-configuration).</span></span>

### <a name="incorrect-website-physical-path-or-application-missing"></a><span data-ttu-id="2a8af-378">Caminho físico do site incorreto ou aplicativo ausente</span><span class="sxs-lookup"><span data-stu-id="2a8af-378">Incorrect website physical path or application missing</span></span>

* <span data-ttu-id="2a8af-379">**Navegador:** 403 Proibido – acesso negado **OU** 403.14 Proibido – o servidor Web está configurado para não listar o conteúdo deste diretório.</span><span class="sxs-lookup"><span data-stu-id="2a8af-379">**Browser:** 403 Forbidden - Access is denied **--OR--** 403.14 Forbidden - The Web server is configured to not list the contents of this directory.</span></span>

* <span data-ttu-id="2a8af-380">**Log do Aplicativo:** nenhuma entrada</span><span class="sxs-lookup"><span data-stu-id="2a8af-380">**Application Log:** No entry</span></span>

* <span data-ttu-id="2a8af-381">**Log do Módulo do ASP.NET Core:** arquivo de log não criado</span><span class="sxs-lookup"><span data-stu-id="2a8af-381">**ASP.NET Core Module Log:** Log file not created</span></span>

<span data-ttu-id="2a8af-382">Solução de problemas:</span><span class="sxs-lookup"><span data-stu-id="2a8af-382">Troubleshooting:</span></span>

* <span data-ttu-id="2a8af-383">Confira as **Configurações Básicas** no site do IIS e a pasta do aplicativo físico.</span><span class="sxs-lookup"><span data-stu-id="2a8af-383">Check the IIS website **Basic Settings** and the physical application folder.</span></span> <span data-ttu-id="2a8af-384">Confirme se o aplicativo está na pasta no **Caminho físico** do site do IIS.</span><span class="sxs-lookup"><span data-stu-id="2a8af-384">Confirm that the application is in the folder at the IIS website **Physical path**.</span></span>

### <a name="incorrect-role-module-not-installed-or-incorrect-permissions"></a><span data-ttu-id="2a8af-385">Função incorreta, módulo não instalado ou permissões incorretas</span><span class="sxs-lookup"><span data-stu-id="2a8af-385">Incorrect role, module not installed, or incorrect permissions</span></span>

* <span data-ttu-id="2a8af-386">**Navegador:** 500.19 Erro interno do servidor – a página solicitada não pode ser acessada porque os dados de configuração relacionados da página são inválidos.</span><span class="sxs-lookup"><span data-stu-id="2a8af-386">**Browser:** 500.19 Internal Server Error - The requested page cannot be accessed because the related configuration data for the page is invalid.</span></span>

* <span data-ttu-id="2a8af-387">**Log do Aplicativo:** nenhuma entrada</span><span class="sxs-lookup"><span data-stu-id="2a8af-387">**Application Log:** No entry</span></span>

* <span data-ttu-id="2a8af-388">**Log do Módulo do ASP.NET Core:** arquivo de log não criado</span><span class="sxs-lookup"><span data-stu-id="2a8af-388">**ASP.NET Core Module Log:** Log file not created</span></span>

<span data-ttu-id="2a8af-389">Solução de problemas:</span><span class="sxs-lookup"><span data-stu-id="2a8af-389">Troubleshooting:</span></span>

* <span data-ttu-id="2a8af-390">Confirme se você habilitou a função apropriada.</span><span class="sxs-lookup"><span data-stu-id="2a8af-390">Confirm that you've enabled the proper role.</span></span> <span data-ttu-id="2a8af-391">Consulte [Configuração do IIS](#iis-configuration).</span><span class="sxs-lookup"><span data-stu-id="2a8af-391">See [IIS Configuration](#iis-configuration).</span></span>

* <span data-ttu-id="2a8af-392">Verifique **Programas &amp; Recursos** e confirme se o **Módulo do Microsoft ASP.NET Core** foi instalado.</span><span class="sxs-lookup"><span data-stu-id="2a8af-392">Check **Programs &amp; Features** and confirm that the **Microsoft ASP.NET Core Module** has been installed.</span></span> <span data-ttu-id="2a8af-393">Se o **Módulo do Microsoft ASP.NET Core** não estiver presente na lista de programas instalados, instale o módulo.</span><span class="sxs-lookup"><span data-stu-id="2a8af-393">If the **Microsoft ASP.NET Core Module** isn't present in the list of installed programs, install the module.</span></span> <span data-ttu-id="2a8af-394">Consulte [Instalar o pacote de hospedagem do Windows Server do .NET Core](#install-the-net-core-windows-server-hosting-bundle).</span><span class="sxs-lookup"><span data-stu-id="2a8af-394">See [Install the .NET Core Windows Server Hosting bundle](#install-the-net-core-windows-server-hosting-bundle).</span></span>

* <span data-ttu-id="2a8af-395">Verifique se o **Pool de aplicativos** > **Modelo de processo** > **Identidade** está definido como **ApplicationPoolIdentity** ou se a identidade personalizada tem as permissões corretas para acessar a pasta de implantação do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2a8af-395">Make sure that the **Application Pool** > **Process Model** > **Identity** is set to **ApplicationPoolIdentity** or your custom identity has the correct permissions to access the app's deployment folder.</span></span>

### <a name="incorrect-processpath-missing-path-variable-hosting-bundle-not-installed-systemiis-not-restarted-vc-redistributable-not-installed-or-dotnetexe-access-violation"></a><span data-ttu-id="2a8af-396">processPath incorreto, variável de PATH ausente, pacote de hospedagem não instalado, sistema/IIS não reiniciado, Pacotes Redistribuíveis do VC++ não instalados ou violação de acesso de dotnet.exe</span><span class="sxs-lookup"><span data-stu-id="2a8af-396">Incorrect processPath, missing PATH variable, hosting bundle not installed, system/IIS not restarted, VC++ Redistributable not installed, or dotnet.exe access violation</span></span>

* <span data-ttu-id="2a8af-397">**Navegador:** 502.5 Erro HTTP – falha do processo</span><span class="sxs-lookup"><span data-stu-id="2a8af-397">**Browser:** HTTP Error 502.5 - Process Failure</span></span>

* <span data-ttu-id="2a8af-398">**Log do Aplicativo:** o aplicativo “MACHINE/WEBROOT/APPHOST/MY_APPLICATION” com a raiz física “C:\\{PATH}\'” falhou ao iniciar o processo com a linha de comando '".\my_application.exe" ', ErrorCode = '0x80070002 : 0.</span><span class="sxs-lookup"><span data-stu-id="2a8af-398">**Application Log:** Application 'MACHINE/WEBROOT/APPHOST/MY_APPLICATION' with physical root 'C:\\{PATH}\' failed to start process with commandline '".\my_application.exe" ', ErrorCode = '0x80070002 : 0.</span></span>

* <span data-ttu-id="2a8af-399">**Log do Módulo do ASP.NET Core:** arquivo de log criado, mas vazio</span><span class="sxs-lookup"><span data-stu-id="2a8af-399">**ASP.NET Core Module Log:** Log file created but empty</span></span>

<span data-ttu-id="2a8af-400">Solução de problemas:</span><span class="sxs-lookup"><span data-stu-id="2a8af-400">Troubleshooting:</span></span>

* <span data-ttu-id="2a8af-401">Confirme se o aplicativo é executado localmente no Kestrel.</span><span class="sxs-lookup"><span data-stu-id="2a8af-401">Confirm that the application runs locally on Kestrel.</span></span> <span data-ttu-id="2a8af-402">Uma falha do processo pode ser o resultado de um problema no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2a8af-402">A process failure might be the result of a problem within the application.</span></span> <span data-ttu-id="2a8af-403">Para obter mais informações, consulte [Dicas de solução de problemas](#troubleshooting-tips).</span><span class="sxs-lookup"><span data-stu-id="2a8af-403">For more information, see [Troubleshooting tips](#troubleshooting-tips).</span></span>

* <span data-ttu-id="2a8af-404">Verifique o atributo *processPath* no elemento `<aspNetCore>` em *web.config* para confirmar se ele é *dotnet* para uma implantação dependente de estrutura (FDD) ou *.\my_application.exe* para uma implantação independente (SCD).</span><span class="sxs-lookup"><span data-stu-id="2a8af-404">Check the *processPath* attribute on the `<aspNetCore>` element in *web.config* to confirm that it's *dotnet* for a framework-dependent deployment (FDD) or *.\my_application.exe* for a self-contained deployment (SCD).</span></span>

* <span data-ttu-id="2a8af-405">Para uma FDD, o *dotnet.exe* pode não estar acessível por meio das configurações de PATH.</span><span class="sxs-lookup"><span data-stu-id="2a8af-405">For an FDD, *dotnet.exe* might not be accessible via the PATH settings.</span></span> <span data-ttu-id="2a8af-406">Confirme se *C:\Program Files\dotnet\* existe nas configurações de PATH do Sistema.</span><span class="sxs-lookup"><span data-stu-id="2a8af-406">Confirm that *C:\Program Files\dotnet\* exists in the System PATH settings.</span></span>

* <span data-ttu-id="2a8af-407">Para uma FDD, o *dotnet.exe* pode não estar acessível para a identidade do usuário do Pool de aplicativos.</span><span class="sxs-lookup"><span data-stu-id="2a8af-407">For an FDD, *dotnet.exe* might not be accessible for the user identity of the Application Pool.</span></span> <span data-ttu-id="2a8af-408">Confirme se a identidade do usuário do AppPool tem acesso ao diretório *C:\Program Files\dotnet*.</span><span class="sxs-lookup"><span data-stu-id="2a8af-408">Confirm that the AppPool user identity has access to the *C:\Program Files\dotnet* directory.</span></span> <span data-ttu-id="2a8af-409">Confirme se não há nenhuma regra de negação configurada para a identidade do usuário do AppPool no *C:\Program Files\dotnet* e nos diretórios do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2a8af-409">Confirm that there are no deny rules configured for the AppPool user identity on the *C:\Program Files\dotnet* and application directories.</span></span>

* <span data-ttu-id="2a8af-410">Talvez você tenha implantado uma FDD e instalado o .NET Core sem reiniciar o IIS.</span><span class="sxs-lookup"><span data-stu-id="2a8af-410">You may have deployed an FDD and installed .NET Core without restarting IIS.</span></span> <span data-ttu-id="2a8af-411">Reinicie o servidor ou o IIS executando **net stop was /y** seguido por **net start w3svc** em um prompt de comando.</span><span class="sxs-lookup"><span data-stu-id="2a8af-411">Either restart the server or restart IIS by executing **net stop was /y** followed by **net start w3svc** from a command prompt.</span></span>

* <span data-ttu-id="2a8af-412">Você pode ter implantado uma FDD sem instalar o tempo de execução do .NET Core no sistema de hospedagem.</span><span class="sxs-lookup"><span data-stu-id="2a8af-412">You may have deployed an FDD without installing the .NET Core runtime on the hosting system.</span></span> <span data-ttu-id="2a8af-413">Se estiver tentando implantar uma FDD e não tiver instalado o tempo de execução do .NET Core, execute o **instalador do pacote de hospedagem do Windows Server do .NET Core** no sistema.</span><span class="sxs-lookup"><span data-stu-id="2a8af-413">If you're attempting to deploy a FDD and haven't installed the .NET Core runtime, run the **.NET Core Windows Server Hosting bundle installer** on the system.</span></span> <span data-ttu-id="2a8af-414">Consulte [Instalar o pacote de hospedagem do Windows Server do .NET Core](#install-the-net-core-windows-server-hosting-bundle).</span><span class="sxs-lookup"><span data-stu-id="2a8af-414">See [Install the .NET Core Windows Server Hosting bundle](#install-the-net-core-windows-server-hosting-bundle).</span></span> <span data-ttu-id="2a8af-415">Se estiver tentando instalar o tempo de execução do .NET Core em um sistema sem uma conexão com a Internet, obtenha o tempo de execução em [Downloads do .NET](https://www.microsoft.com/net/download/core) e execute o instalador do pacote de hospedagem para instalar o Módulo do ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="2a8af-415">If you're attempting to install the .NET Core runtime on a system without an Internet connection, obtain the runtime from [.NET Downloads](https://www.microsoft.com/net/download/core) and run the hosting bundle installer to install the ASP.NET Core Module.</span></span> <span data-ttu-id="2a8af-416">Conclua a instalação reiniciando o sistema ou o IIS executando **net stop was /y** seguido por **net start w3svc** em um prompt de comando.</span><span class="sxs-lookup"><span data-stu-id="2a8af-416">Complete the installation by restarting the system or restarting IIS by executing **net stop was /y** followed by **net start w3svc** from a command prompt.</span></span>

* <span data-ttu-id="2a8af-417">Talvez você tenha implantado uma FDD e instalado o .NET Core sem reiniciar o sistema/IIS.</span><span class="sxs-lookup"><span data-stu-id="2a8af-417">You may have deployed an FDD and installed .NET Core without restarting the system/IIS.</span></span> <span data-ttu-id="2a8af-418">Reinicie o sistema ou o IIS executando **net stop was /y** seguido por **net start w3svc** em um prompt de comando.</span><span class="sxs-lookup"><span data-stu-id="2a8af-418">Either restart the system or restart IIS by executing **net stop was /y** followed by **net start w3svc** from a command prompt.</span></span>

* <span data-ttu-id="2a8af-419">Talvez você tenha implantado uma FDD e os *Pacotes redistribuíveis do Microsoft Visual C++ 2015 (x64)* não estão instalados no sistema.</span><span class="sxs-lookup"><span data-stu-id="2a8af-419">You may have deployed an FDD and the *Microsoft Visual C++ 2015 Redistributable (x64)* is not installed on the system.</span></span> <span data-ttu-id="2a8af-420">Obtenha um instalador no [Centro de Download da Microsoft](https://www.microsoft.com/download/details.aspx?id=53840).</span><span class="sxs-lookup"><span data-stu-id="2a8af-420">You may obtain an installer from the [Microsoft Download Center](https://www.microsoft.com/download/details.aspx?id=53840).</span></span>

### <a name="incorrect-arguments-of-aspnetcore-element"></a><span data-ttu-id="2a8af-421">Argumentos incorretos do elemento \<aspNetCore\></span><span class="sxs-lookup"><span data-stu-id="2a8af-421">Incorrect arguments of \<aspNetCore\> element</span></span>

* <span data-ttu-id="2a8af-422">**Navegador:** 502.5 Erro HTTP – falha do processo</span><span class="sxs-lookup"><span data-stu-id="2a8af-422">**Browser:** HTTP Error 502.5 - Process Failure</span></span>

* <span data-ttu-id="2a8af-423">**Log do Aplicativo:** o aplicativo “MACHINE/WEBROOT/APPHOST/MY_APPLICATION” com a raiz física “C:\\{PATH}\'” falhou ao iniciar o processo com a linha de comando “dotnet” .\my_application.dll', ErrorCode = '0x80004005 : 80008081”.</span><span class="sxs-lookup"><span data-stu-id="2a8af-423">**Application Log:** Application 'MACHINE/WEBROOT/APPHOST/MY_APPLICATION' with physical root 'C:\\{PATH}\' failed to start process with commandline '"dotnet" .\my_application.dll', ErrorCode = '0x80004005 : 80008081.</span></span>

* <span data-ttu-id="2a8af-424">**Log do Módulo do ASP.NET Core:** o aplicativo a ser executado não existe: “PATH\my_application.dll”</span><span class="sxs-lookup"><span data-stu-id="2a8af-424">**ASP.NET Core Module Log:** The application to execute does not exist: 'PATH\my_application.dll'</span></span>

<span data-ttu-id="2a8af-425">Solução de problemas:</span><span class="sxs-lookup"><span data-stu-id="2a8af-425">Troubleshooting:</span></span>

* <span data-ttu-id="2a8af-426">Confirme se o aplicativo é executado localmente no Kestrel.</span><span class="sxs-lookup"><span data-stu-id="2a8af-426">Confirm that the application runs locally on Kestrel.</span></span> <span data-ttu-id="2a8af-427">Uma falha do processo pode ser o resultado de um problema no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2a8af-427">A process failure might be the result of a problem within the application.</span></span> <span data-ttu-id="2a8af-428">Para obter mais informações, consulte [Dicas de solução de problemas](#troubleshooting-tips).</span><span class="sxs-lookup"><span data-stu-id="2a8af-428">For more information, see [Troubleshooting tips](#troubleshooting-tips).</span></span>

* <span data-ttu-id="2a8af-429">Examine o atributo *arguments* no elemento `<aspNetCore>` no *web.config* para confirmar se ele (a) é *.\my_application.dll* de uma implantação dependente de estrutura (FDD); ou (b) não está presente, uma cadeia de caracteres vazia (*arguments=""*) ou uma lista de argumentos do aplicativo (*arguments="arg1, arg2, ..."*) para uma implantação independente (SCD).</span><span class="sxs-lookup"><span data-stu-id="2a8af-429">Examine the *arguments* attribute on the `<aspNetCore>` element in *web.config* to confirm that it is either (a) *.\my_application.dll* for a framework-dependent deployment (FDD); or (b) not present, an empty string (*arguments=""*), or a list of your app's arguments (*arguments="arg1, arg2, ..."*) for a self-contained deployment (SCD).</span></span>

### <a name="missing-net-framework-version"></a><span data-ttu-id="2a8af-430">Versão do .NET Framework ausente</span><span class="sxs-lookup"><span data-stu-id="2a8af-430">Missing .NET Framework version</span></span>

* <span data-ttu-id="2a8af-431">**Navegador:** 502.3 Gateway incorreto – Erro de conexão ao tentar encaminhar a solicitação.</span><span class="sxs-lookup"><span data-stu-id="2a8af-431">**Browser:** 502.3 Bad Gateway - There was a connection error while trying to route the request.</span></span>

* <span data-ttu-id="2a8af-432">**Log do Aplicativo:** ErrorCode = o aplicativo “MACHINE/WEBROOT/APPHOST/MY_APPLICATION” com a raiz física “C:\\{PATH}\'” falhou ao iniciar o processo com a linha de comando “dotnet” .\my_application.dll', ErrorCode = '0x80004005 : 80008081”.</span><span class="sxs-lookup"><span data-stu-id="2a8af-432">**Application Log:** ErrorCode = Application 'MACHINE/WEBROOT/APPHOST/MY_APPLICATION' with physical root 'C:\\{PATH}\' failed to start process with commandline '"dotnet" .\my_application.dll', ErrorCode = '0x80004005 : 80008081.</span></span>

* <span data-ttu-id="2a8af-433">**Log do Módulo do ASP.NET Core:** exceção do método, arquivo ou assembly ausente.</span><span class="sxs-lookup"><span data-stu-id="2a8af-433">**ASP.NET Core Module Log:** Missing method, file, or assembly exception.</span></span> <span data-ttu-id="2a8af-434">O método, o arquivo ou o assembly especificado na exceção é um método, arquivo ou assembly do .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="2a8af-434">The method, file, or assembly specified in the exception is a .NET Framework method, file, or assembly.</span></span>

<span data-ttu-id="2a8af-435">Solução de problemas:</span><span class="sxs-lookup"><span data-stu-id="2a8af-435">Troubleshooting:</span></span>

* <span data-ttu-id="2a8af-436">Instale a versão do .NET Framework ausente no sistema.</span><span class="sxs-lookup"><span data-stu-id="2a8af-436">Install the .NET Framework version missing from the system.</span></span>

* <span data-ttu-id="2a8af-437">Para uma implantação dependente de estrutura (FDD), confirme se você tem o tempo de execução correto instalado no sistema.</span><span class="sxs-lookup"><span data-stu-id="2a8af-437">For a framework-dependent deployment (FDD), confirm that you have the correct runtime installed on the system.</span></span> <span data-ttu-id="2a8af-438">Por exemplo, se você fizer upgrade de um projeto do 1.1 para 2.0, implantar no sistema de hospedagem e receber essa exceção, instale o Framework 2.0 no sistema de hospedagem.</span><span class="sxs-lookup"><span data-stu-id="2a8af-438">If you upgrade a project from 1.1 to 2.0, deploy to the hosting system, and receive this exception, ensure you install the 2.0 framework on the hosting system.</span></span>

### <a name="stopped-application-pool"></a><span data-ttu-id="2a8af-439">Pool de aplicativos interrompido</span><span class="sxs-lookup"><span data-stu-id="2a8af-439">Stopped Application Pool</span></span>

* <span data-ttu-id="2a8af-440">**Navegador:** 503 Serviço não disponível</span><span class="sxs-lookup"><span data-stu-id="2a8af-440">**Browser:** 503 Service Unavailable</span></span>

* <span data-ttu-id="2a8af-441">**Log do Aplicativo:** nenhuma entrada</span><span class="sxs-lookup"><span data-stu-id="2a8af-441">**Application Log:** No entry</span></span>

* <span data-ttu-id="2a8af-442">**Log do Módulo do ASP.NET Core:** arquivo de log não criado</span><span class="sxs-lookup"><span data-stu-id="2a8af-442">**ASP.NET Core Module Log:** Log file not created</span></span>

<span data-ttu-id="2a8af-443">Solução de problemas</span><span class="sxs-lookup"><span data-stu-id="2a8af-443">Troubleshooting</span></span>

* <span data-ttu-id="2a8af-444">Confirme se o Pool de Aplicativos não está no estado *Parado*.</span><span class="sxs-lookup"><span data-stu-id="2a8af-444">Confirm that the Application Pool is not in the *Stopped* state.</span></span>

### <a name="iis-integration-middleware-not-implemented"></a><span data-ttu-id="2a8af-445">Middleware de Integração do IIS não implementado</span><span class="sxs-lookup"><span data-stu-id="2a8af-445">IIS Integration middleware not implemented</span></span>

* <span data-ttu-id="2a8af-446">**Navegador:** 502.5 Erro HTTP – falha do processo</span><span class="sxs-lookup"><span data-stu-id="2a8af-446">**Browser:** HTTP Error 502.5 - Process Failure</span></span>

* <span data-ttu-id="2a8af-447">**Log do Aplicativo:** o aplicativo “MACHINE/WEBROOT/APPHOST/MY_APPLICATION” com a raiz física “C:\\{PATH}\'” criou um processo com a linha de comando “C:\\{PATH}\my_application.{exe|dll}”, mas falhou, não respondeu ou não escutou na porta determinada '{PORT}', ErrorCode = '0x800705b4'</span><span class="sxs-lookup"><span data-stu-id="2a8af-447">**Application Log:** Application 'MACHINE/WEBROOT/APPHOST/MY_APPLICATION' with physical root 'C:\\{PATH}\' created process with commandline '"C:\\{PATH}\my_application.{exe|dll}" ' but either crashed or did not reponse or did not listen on the given port '{PORT}', ErrorCode = '0x800705b4'</span></span>

* <span data-ttu-id="2a8af-448">**Log do Módulo do ASP.NET Core:** arquivo de log criado, mostrando uma operação normal.</span><span class="sxs-lookup"><span data-stu-id="2a8af-448">**ASP.NET Core Module Log:** Log file created and shows normal operation.</span></span>

<span data-ttu-id="2a8af-449">Solução de problemas</span><span class="sxs-lookup"><span data-stu-id="2a8af-449">Troubleshooting</span></span>

* <span data-ttu-id="2a8af-450">Confirme se o aplicativo é executado localmente no Kestrel.</span><span class="sxs-lookup"><span data-stu-id="2a8af-450">Confirm that the app runs locally on Kestrel.</span></span> <span data-ttu-id="2a8af-451">Uma falha do processo pode ser o resultado de um problema no aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2a8af-451">A process failure might be the result of a problem within the app.</span></span> <span data-ttu-id="2a8af-452">Para obter mais informações, consulte [Dicas de solução de problemas](#troubleshooting-tips).</span><span class="sxs-lookup"><span data-stu-id="2a8af-452">For more information, see [Troubleshooting tips](#troubleshooting-tips).</span></span>

* <span data-ttu-id="2a8af-453">Confirme se você referenciou corretamente o middleware Integração do IIS chamando o método *.UseIISIntegration()* no *WebHostBuilder()* do aplicativo (ASP.NET Core 1.x) ou se usou o método `CreateDefaultBuilder` (ASP.NET Core 2.x).</span><span class="sxs-lookup"><span data-stu-id="2a8af-453">Confirm that you've correctly referenced the IIS Integration middleware by calling the *.UseIISIntegration()* method on the application's *WebHostBuilder()* (ASP.NET Core 1.x) or used the `CreateDefaultBuilder` method (ASP.NET Core 2.x).</span></span> <span data-ttu-id="2a8af-454">Consulte [Hospedando no ASP.NET Core](xref:fundamentals/hosting) para obter mais detalhes.</span><span class="sxs-lookup"><span data-stu-id="2a8af-454">See [Hosting in ASP.NET Core](xref:fundamentals/hosting) for details.</span></span>

### <a name="sub-application-includes-a-handlers-section"></a><span data-ttu-id="2a8af-455">O subaplicativo inclui uma seção \<manipuladores\></span><span class="sxs-lookup"><span data-stu-id="2a8af-455">Sub-application includes a \<handlers\> section</span></span>

* <span data-ttu-id="2a8af-456">**Navegador:** 500.19 Erro HTTP – erro interno do servidor</span><span class="sxs-lookup"><span data-stu-id="2a8af-456">**Browser:** HTTP Error 500.19 - Internal Server Error</span></span>

* <span data-ttu-id="2a8af-457">**Log do Aplicativo:** nenhuma entrada</span><span class="sxs-lookup"><span data-stu-id="2a8af-457">**Application Log:** No entry</span></span>

* <span data-ttu-id="2a8af-458">**Log do Módulo do ASP.NET Core:** arquivo de log criado, mostrando uma operação normal do aplicativo raiz.</span><span class="sxs-lookup"><span data-stu-id="2a8af-458">**ASP.NET Core Module Log:** Log file created and shows normal operation for the root application.</span></span> <span data-ttu-id="2a8af-459">O arquivo de log não é criado para o subaplicativo.</span><span class="sxs-lookup"><span data-stu-id="2a8af-459">Log file not created for the sub-application.</span></span>

<span data-ttu-id="2a8af-460">Solução de problemas</span><span class="sxs-lookup"><span data-stu-id="2a8af-460">Troubleshooting</span></span>

* <span data-ttu-id="2a8af-461">Confirme se o arquivo *web.config* do subaplicativo não inclui uma seção `<handlers>`.</span><span class="sxs-lookup"><span data-stu-id="2a8af-461">Confirm that the sub-app's *web.config* file doesn't include a `<handlers>` section.</span></span>

### <a name="application-configuration-general-issue"></a><span data-ttu-id="2a8af-462">Problema geral de configuração do aplicativo</span><span class="sxs-lookup"><span data-stu-id="2a8af-462">Application configuration general issue</span></span>

* <span data-ttu-id="2a8af-463">**Navegador:** 502.5 Erro HTTP – falha do processo</span><span class="sxs-lookup"><span data-stu-id="2a8af-463">**Browser:** HTTP Error 502.5 - Process Failure</span></span>

* <span data-ttu-id="2a8af-464">**Log do Aplicativo:** o aplicativo “MACHINE/WEBROOT/APPHOST/MY_APPLICATION” com a raiz física “C:\\{PATH}\'” criou um processo com a linha de comando “C:\\{PATH}\my_application.{exe|dll}”, mas falhou, não respondeu ou não escutou na porta determinada '{PORT}', ErrorCode = '0x800705b4'</span><span class="sxs-lookup"><span data-stu-id="2a8af-464">**Application Log:** Application 'MACHINE/WEBROOT/APPHOST/MY_APPLICATION' with physical root 'C:\\{PATH}\' created process with commandline '"C:\\{PATH}\my_application.{exe|dll}" ' but either crashed or did not reponse or did not listen on the given port '{PORT}', ErrorCode = '0x800705b4'</span></span>

* <span data-ttu-id="2a8af-465">**Log do Módulo do ASP.NET Core:** arquivo de log criado, mas vazio</span><span class="sxs-lookup"><span data-stu-id="2a8af-465">**ASP.NET Core Module Log:** Log file created but empty</span></span>

<span data-ttu-id="2a8af-466">Solução de problemas</span><span class="sxs-lookup"><span data-stu-id="2a8af-466">Troubleshooting</span></span>

* <span data-ttu-id="2a8af-467">Essa exceção geral indica que o processo não pôde ser iniciado, provavelmente, devido a um problema de configuração do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="2a8af-467">This general exception indicates that the process failed to start, most likely due to an application configuration issue.</span></span> <span data-ttu-id="2a8af-468">Consultando [Estrutura de diretório](xref:hosting/directory-structure), confirme se as pastas e os arquivos implantados do aplicativo são apropriados e se os arquivos de configuração do aplicativo estão presentes e contêm as configurações corretas para o aplicativo e o ambiente.</span><span class="sxs-lookup"><span data-stu-id="2a8af-468">Referring to [Directory Structure](xref:hosting/directory-structure), confirm that your app's deployed files and folders are appropriate and that your app's configuration files are present and contain the correct settings for your app and environment.</span></span> <span data-ttu-id="2a8af-469">Para obter mais informações, consulte [Dicas de solução de problemas](#troubleshooting-tips).</span><span class="sxs-lookup"><span data-stu-id="2a8af-469">For more information, see [Troubleshooting tips](#troubleshooting-tips).</span></span>

## <a name="resources"></a><span data-ttu-id="2a8af-470">Recursos</span><span class="sxs-lookup"><span data-stu-id="2a8af-470">Resources</span></span>

* [<span data-ttu-id="2a8af-471">Introdução ao Módulo do ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="2a8af-471">Introduction to ASP.NET Core Module</span></span>](xref:fundamentals/servers/aspnet-core-module)
* [<span data-ttu-id="2a8af-472">Referência de configuração do Módulo do ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="2a8af-472">ASP.NET Core Module configuration reference</span></span>](xref:hosting/aspnet-core-module)
* [<span data-ttu-id="2a8af-473">Usando Módulos do IIS com o ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="2a8af-473">Using IIS Modules with ASP.NET Core</span></span>](xref:hosting/iis-modules)
* [<span data-ttu-id="2a8af-474">Introdução ao ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="2a8af-474">Introduction to ASP.NET Core</span></span>](../index.md)
* [<span data-ttu-id="2a8af-475">O site oficial da IIS da Microsoft</span><span class="sxs-lookup"><span data-stu-id="2a8af-475">The Official Microsoft IIS Site</span></span>](https://www.iis.net/)
* [<span data-ttu-id="2a8af-476">Biblioteca Microsoft TechNet: Windows Server</span><span class="sxs-lookup"><span data-stu-id="2a8af-476">Microsoft TechNet Library: Windows Server</span></span>](https://docs.microsoft.com/windows-server/windows-server-versions)
