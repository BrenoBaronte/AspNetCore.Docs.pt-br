---
uid: aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/the-fix-it-sample-application
title: "Apêndice: A correção-aplicativo de exemplo (compilação de aplicativos de nuvem do mundo Real com o Azure) | Microsoft Docs"
author: MikeWasson
description: "Os aplicativos de nuvem criando Real World com livro eletrônico do Azure baseia-se em uma apresentação desenvolvida por Scott Guthrie. Ele explica 13 padrões e práticas recomendadas que ele..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 06/12/2014
ms.topic: article
ms.assetid: 1bc333c5-f096-4ea7-b170-779accc21c1a
ms.technology: 
ms.prod: .net-framework
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/the-fix-it-sample-application
msc.type: authoredcontent
ms.openlocfilehash: c98e79bf8e9a1fe0899ed6d952c3e411ca472f7e
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/24/2018
---
<a name="appendix-the-fix-it-sample-application-building-real-world-cloud-apps-with-azure"></a><span data-ttu-id="7e90d-104">Apêndice: A correção-aplicativo de exemplo (compilação de aplicativos de nuvem do mundo Real com o Azure)</span><span class="sxs-lookup"><span data-stu-id="7e90d-104">Appendix: The Fix It Sample Application (Building Real-World Cloud Apps with Azure)</span></span>
====================
<span data-ttu-id="7e90d-105">por [Mike Wasson](https://github.com/MikeWasson), [Rick Anderson](https://github.com/Rick-Anderson), [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="7e90d-105">by [Mike Wasson](https://github.com/MikeWasson), [Rick Anderson](https://github.com/Rick-Anderson), [Tom Dykstra](https://github.com/tdykstra)</span></span>

[<span data-ttu-id="7e90d-106">Baixe a correção-projeto</span><span class="sxs-lookup"><span data-stu-id="7e90d-106">Download The Fix It Project</span></span>](http://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4)

> <span data-ttu-id="7e90d-107">O **nuvem aplicativos do mundo Real criando com o Azure** livro eletrônico baseia-se em uma apresentação desenvolvida por Scott Guthrie.</span><span class="sxs-lookup"><span data-stu-id="7e90d-107">The **Building Real World Cloud Apps with Azure** e-book is based on a presentation developed by Scott Guthrie.</span></span> <span data-ttu-id="7e90d-108">Explica as 13 padrões e práticas que podem ajudá-lo a ser bem-sucedido de desenvolvimento de aplicativos da web para a nuvem.</span><span class="sxs-lookup"><span data-stu-id="7e90d-108">It explains 13 patterns and practices that can help you be successful developing web apps for the cloud.</span></span> <span data-ttu-id="7e90d-109">Para obter informações sobre o livro eletrônico, consulte [primeiro capítulo](introduction.md).</span><span class="sxs-lookup"><span data-stu-id="7e90d-109">For information about the e-book, see [the first chapter](introduction.md).</span></span>


<span data-ttu-id="7e90d-110">Este apêndice a aplicativos de nuvem criando Real World com livro eletrônico do Azure contém as seções a seguir fornecem informações adicionais sobre como corrigir aplicativo de exemplo que você pode baixar:</span><span class="sxs-lookup"><span data-stu-id="7e90d-110">This appendix to the Building Real World Cloud Apps with Azure e-book contains the following sections that provide additional information about the Fix It sample application that you can download:</span></span>

- [<span data-ttu-id="7e90d-111">Problemas conhecidos</span><span class="sxs-lookup"><span data-stu-id="7e90d-111">Known issues</span></span>](#knownissues)
- [<span data-ttu-id="7e90d-112">Práticas recomendadas</span><span class="sxs-lookup"><span data-stu-id="7e90d-112">Best practices</span></span>](#bestpractices)
- [<span data-ttu-id="7e90d-113">Como executar o aplicativo do Visual Studio no computador local</span><span class="sxs-lookup"><span data-stu-id="7e90d-113">How to run the app from Visual Studio on your local computer</span></span>](#run-in-vs)
- [<span data-ttu-id="7e90d-114">Como implantar o aplicativo base para aplicativos de Web do serviço de aplicativo do Azure usando os scripts do Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="7e90d-114">How to deploy the base app to Azure App Service Web Apps by using the Windows PowerShell scripts</span></span>](#deploybase)
- [<span data-ttu-id="7e90d-115">Solucionando problemas de scripts do Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="7e90d-115">Troubleshooting the Windows PowerShell scripts</span></span>](#troubleshooting)
- [<span data-ttu-id="7e90d-116">Como implantar o aplicativo com a fila de processamento para aplicativos de Web do serviço de aplicativo do Azure e um serviço de nuvem do Azure</span><span class="sxs-lookup"><span data-stu-id="7e90d-116">How to deploy the app with queue processing to Azure App Service Web Apps and an Azure Cloud Service</span></span>](#deployqueues)

<a id="knownissues"></a>
## <a name="known-issues"></a><span data-ttu-id="7e90d-117">Problemas conhecidos</span><span class="sxs-lookup"><span data-stu-id="7e90d-117">Known issues</span></span>

<span data-ttu-id="7e90d-118">O aplicativo corrigir foi originalmente desenvolvido para ilustrar como mais simples possível alguns dos padrões apresentados neste livro eletrônico.</span><span class="sxs-lookup"><span data-stu-id="7e90d-118">The Fix It app was originally developed in order to illustrate as simply as possible some of the patterns presented in this e-book.</span></span> <span data-ttu-id="7e90d-119">No entanto, como o livro eletrônico é sobre a criação de aplicativos do mundo real, estamos sujeitos código corrigir para revisão e processo de teste semelhante ao que seria fazemos para software lançado.</span><span class="sxs-lookup"><span data-stu-id="7e90d-119">However, since the e-book is about building real-world apps, we subjected the Fix It code to a review and testing process similar to what we'd do for released software.</span></span> <span data-ttu-id="7e90d-120">Encontramos um número de problemas e, assim como acontece com qualquer aplicativo do mundo real, algumas delas corrigimos e algumas delas adiada para uma versão posterior.</span><span class="sxs-lookup"><span data-stu-id="7e90d-120">We found a number of issues, and as with any real-world application, some of them we fixed and some of them we deferred to a later release.</span></span>

<span data-ttu-id="7e90d-121">A lista a seguir inclui os problemas que devem ser tratados em um aplicativo de produção, mas por um motivo ou outro que decidimos não endereço na versão inicial do aplicativo exemplo corrigi-lo.</span><span class="sxs-lookup"><span data-stu-id="7e90d-121">The following list includes issues that should be addressed in a production application, but for one reason or another we decided not to address in the initial release of the Fix It sample application.</span></span>

### <a name="security"></a><span data-ttu-id="7e90d-122">Segurança</span><span class="sxs-lookup"><span data-stu-id="7e90d-122">Security</span></span>

- <span data-ttu-id="7e90d-123">Certifique-se de que você não pode atribuir uma tarefa a um proprietário inexistente.</span><span class="sxs-lookup"><span data-stu-id="7e90d-123">Ensure that you can't assign a task to a non-existent owner.</span></span>
- <span data-ttu-id="7e90d-124">Certifique-se de que você só pode exibir e modificar as tarefas que você criou ou atribuídos a você.</span><span class="sxs-lookup"><span data-stu-id="7e90d-124">Ensure that you can only view and modify tasks that you created or are assigned to you.</span></span>
- <span data-ttu-id="7e90d-125">Use HTTPS para páginas de entrada e os cookies de autenticação.</span><span class="sxs-lookup"><span data-stu-id="7e90d-125">Use HTTPS for sign-in pages and authentication cookies.</span></span>
- <span data-ttu-id="7e90d-126">Especifique um tempo limite de cookies de autenticação.</span><span class="sxs-lookup"><span data-stu-id="7e90d-126">Specify a time limit for authentication cookies.</span></span>

### <a name="input-validation"></a><span data-ttu-id="7e90d-127">Validação de entrada</span><span class="sxs-lookup"><span data-stu-id="7e90d-127">Input validation</span></span>

<span data-ttu-id="7e90d-128">Em geral, um aplicativo de produção faria mais validação de entrada que o aplicativo para corrigi-lo.</span><span class="sxs-lookup"><span data-stu-id="7e90d-128">In general, a production app would do more input validation than the Fix It app.</span></span> <span data-ttu-id="7e90d-129">Por exemplo, o tamanho da imagem / imagem de tamanho de arquivo permitido para carregamento deve ser limitado.</span><span class="sxs-lookup"><span data-stu-id="7e90d-129">For example, the image size / image file size allowed for upload should be limited.</span></span>

### <a name="administrator-functionality"></a><span data-ttu-id="7e90d-130">Funcionalidade de administrador</span><span class="sxs-lookup"><span data-stu-id="7e90d-130">Administrator functionality</span></span>

<span data-ttu-id="7e90d-131">Um administrador deve ser capaz de alterar a propriedade de tarefas existentes.</span><span class="sxs-lookup"><span data-stu-id="7e90d-131">An administrator should be able to change ownership on existing tasks.</span></span> <span data-ttu-id="7e90d-132">Por exemplo, o criador de uma tarefa pode deixar a empresa, deixando ninguém com autoridade para manter a tarefa, a menos que o acesso administrativo está habilitado.</span><span class="sxs-lookup"><span data-stu-id="7e90d-132">For example, the creator of a task might leave the company, leaving no one with authority to maintain the task unless administrative access is enabled.</span></span>

### <a name="queue-message-processing"></a><span data-ttu-id="7e90d-133">Processamento de mensagem da fila</span><span class="sxs-lookup"><span data-stu-id="7e90d-133">Queue message processing</span></span>

<span data-ttu-id="7e90d-134">Mensagem da fila de processamento no aplicativo corrigir foi projetada para ser simples para ilustrar o padrão de trabalho centrado em fila com uma quantidade mínima de código.</span><span class="sxs-lookup"><span data-stu-id="7e90d-134">Queue message processing in the Fix It app was designed to be simple in order to illustrate the queue-centric work pattern with a minimum amount of code.</span></span> <span data-ttu-id="7e90d-135">Esse código simple não seria adequado para um aplicativo de produção real.</span><span class="sxs-lookup"><span data-stu-id="7e90d-135">This simple code would not be adequate for an actual production application.</span></span>

- <span data-ttu-id="7e90d-136">O código não garante que cada mensagem da fila será processada no máximo uma vez.</span><span class="sxs-lookup"><span data-stu-id="7e90d-136">The code does not guarantee that each queue message will be processed at most once.</span></span> <span data-ttu-id="7e90d-137">Quando você receber uma mensagem da fila, há um período de tempo limite, durante o qual a mensagem está invisível para outros ouvintes de fila.</span><span class="sxs-lookup"><span data-stu-id="7e90d-137">When you get a message from the queue, there is a timeout period, during which the message is invisible to other queue listeners.</span></span> <span data-ttu-id="7e90d-138">Se o tempo limite expirar antes que a mensagem é excluída, a mensagem se torna visível novamente.</span><span class="sxs-lookup"><span data-stu-id="7e90d-138">If the timeout expires before the message is deleted, the message becomes visible again.</span></span> <span data-ttu-id="7e90d-139">Portanto, se uma instância de função de trabalho gasta muito tempo processando uma mensagem, é teoricamente possível para a mesma mensagem ser processado duas vezes, resultando em uma tarefa duplicada no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="7e90d-139">Therefore, if a worker role instance spends a long time processing a message, it is theoretically possible for the same message to get processed twice, resulting in a duplicate task in the database.</span></span> <span data-ttu-id="7e90d-140">Para obter mais informações sobre esse problema, consulte [filas de armazenamento do Azure usando](https://msdn.microsoft.com/library/ff803365.aspx#sec7).</span><span class="sxs-lookup"><span data-stu-id="7e90d-140">For more information about this issue, see [Using Azure Storage Queues](https://msdn.microsoft.com/library/ff803365.aspx#sec7).</span></span>
- <span data-ttu-id="7e90d-141">A lógica de sondagem de fila pode ser mais econômica, pela recuperação de mensagens de envio em lote.</span><span class="sxs-lookup"><span data-stu-id="7e90d-141">The queue polling logic could be more cost-effective, by batching message retrieval.</span></span> <span data-ttu-id="7e90d-142">Toda vez que você chamar [CloudQueue.GetMessageAsync](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueue.getmessageasync.aspx), há um custo de transações.</span><span class="sxs-lookup"><span data-stu-id="7e90d-142">Every time you call [CloudQueue.GetMessageAsync](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueue.getmessageasync.aspx), there is a transaction cost.</span></span> <span data-ttu-id="7e90d-143">Em vez disso, você pode chamar [CloudQueue.GetMessagesAsync](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueue.getmessagesasync.aspx) (Observe o plural'), que obtém várias mensagens em uma única transação.</span><span class="sxs-lookup"><span data-stu-id="7e90d-143">Instead, you can call [CloudQueue.GetMessagesAsync](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueue.getmessagesasync.aspx) (note the plural 's'), which gets multiple messages in a single transaction.</span></span> <span data-ttu-id="7e90d-144">Os custos de transações para filas de armazenamento do Azure são muito baixos, portanto, o impacto sobre os custos não é significativo na maioria dos cenários.</span><span class="sxs-lookup"><span data-stu-id="7e90d-144">The transaction costs for Azure Storage Queues are very low, so the impact on costs is not substantial in most scenarios.</span></span>
- <span data-ttu-id="7e90d-145">O loop estreito no código de processamento de mensagens de fila faz com que a afinidade de CPU, o que não utilizam as VMs de vários núcleos com eficiência.</span><span class="sxs-lookup"><span data-stu-id="7e90d-145">The tight loop in the queue message-processing code causes CPU affinity, which does not utilize multi-core VMs efficiently.</span></span> <span data-ttu-id="7e90d-146">Um melhor design usaria o paralelismo de tarefas para executar várias tarefas assíncronas em paralelo.</span><span class="sxs-lookup"><span data-stu-id="7e90d-146">A better design would use task parallelism to run several async tasks in parallel.</span></span>
- <span data-ttu-id="7e90d-147">Processamento de mensagens da fila tem o tratamento de exceção apenas rudimentares.</span><span class="sxs-lookup"><span data-stu-id="7e90d-147">Queue message-processing has only rudimentary exception handling.</span></span> <span data-ttu-id="7e90d-148">Por exemplo, o código não manipula [mensagens suspeitas](https://msdn.microsoft.com/library/ms789028.aspx).</span><span class="sxs-lookup"><span data-stu-id="7e90d-148">For example, the code doesn't handle [poison messages](https://msdn.microsoft.com/library/ms789028.aspx).</span></span> <span data-ttu-id="7e90d-149">(Quando o processamento da mensagem faz com que uma exceção, você precisa registrar o erro e excluir a mensagem, ou a função de trabalho tentará processá-la novamente, e o loop continuará indefinidamente.)</span><span class="sxs-lookup"><span data-stu-id="7e90d-149">(When message processing causes an exception, you have to log the error and delete the message, or the worker role will try to process it again, and the loop will continue indefinitely.)</span></span>

### <a name="sql-queries-are-unbounded"></a><span data-ttu-id="7e90d-150">Consultas SQL são não associadas</span><span class="sxs-lookup"><span data-stu-id="7e90d-150">SQL queries are unbounded</span></span>

<span data-ttu-id="7e90d-151">Corrigir código atual não impõe nenhum limite as consultas de páginas de índice podem retornar o número de linhas.</span><span class="sxs-lookup"><span data-stu-id="7e90d-151">Current Fix It code places no limit on how many rows the queries for Index pages might return.</span></span> <span data-ttu-id="7e90d-152">Se um grande volume de tarefas é inserido no banco de dados, o tamanho das listas resultantes recebida pode causar problemas de desempenho.</span><span class="sxs-lookup"><span data-stu-id="7e90d-152">If a large volume of tasks is entered into the database, the size of the resulting lists received could cause performance issues.</span></span> <span data-ttu-id="7e90d-153">A solução é implementar a paginação.</span><span class="sxs-lookup"><span data-stu-id="7e90d-153">The solution is to implement paging.</span></span> <span data-ttu-id="7e90d-154">Para obter um exemplo, consulte [classificação, filtragem e paginação com o Entity Framework em um aplicativo ASP.NET MVC](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="7e90d-154">For an example, see [Sorting, Filtering, and Paging with the Entity Framework in an ASP.NET MVC Application](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application.md).</span></span>

### <a name="view-models-recommended"></a><span data-ttu-id="7e90d-155">Exibir modelos recomendados</span><span class="sxs-lookup"><span data-stu-id="7e90d-155">View models recommended</span></span>

<span data-ttu-id="7e90d-156">O aplicativo corrigir usa a classe da entidade FixItTask para transmitir informações entre o controlador e o modo de exibição.</span><span class="sxs-lookup"><span data-stu-id="7e90d-156">The Fix It app uses the FixItTask entity class to pass information between the controller and the view.</span></span> <span data-ttu-id="7e90d-157">Uma prática recomendada é usar modelos de exibição.</span><span class="sxs-lookup"><span data-stu-id="7e90d-157">A best practice is to use view models.</span></span> <span data-ttu-id="7e90d-158">O modelo de domínio (por exemplo, a classe da entidade FixItTask) foi projetado para o que é necessário para a persistência de dados, enquanto um modelo de exibição pode ser projetado para apresentação de dados.</span><span class="sxs-lookup"><span data-stu-id="7e90d-158">The domain model (e.g., the FixItTask entity class) is designed around what is needed for data persistence, while a view model can be designed for data presentation.</span></span> <span data-ttu-id="7e90d-159">Para obter mais informações, consulte [12 ASP.NET MVC práticas recomendadas](http://codeclimber.net.nz/archive/2009/10/27/12-asp.net-mvc-best-practices.aspx).</span><span class="sxs-lookup"><span data-stu-id="7e90d-159">For more information, see [12 ASP.NET MVC Best Practices](http://codeclimber.net.nz/archive/2009/10/27/12-asp.net-mvc-best-practices.aspx).</span></span>

### <a name="secure-image-blob-recommended"></a><span data-ttu-id="7e90d-160">Blob de imagem seguro recomendado</span><span class="sxs-lookup"><span data-stu-id="7e90d-160">Secure image blob recommended</span></span>

<span data-ttu-id="7e90d-161">As lojas de aplicativos corrigir carregado imagens como público, o que significa que qualquer pessoa que localiza a URL pode acessar as imagens.</span><span class="sxs-lookup"><span data-stu-id="7e90d-161">The Fix It app stores uploaded images as public, meaning that anyone who finds the URL can access the images.</span></span> <span data-ttu-id="7e90d-162">As imagens poderiam ser protegidas em vez de público.</span><span class="sxs-lookup"><span data-stu-id="7e90d-162">The images could be secured instead of public.</span></span>

### <a name="no-powershell-automation-scripts-for-queues"></a><span data-ttu-id="7e90d-163">Nenhum script de automação do PowerShell para filas</span><span class="sxs-lookup"><span data-stu-id="7e90d-163">No PowerShell automation scripts for queues</span></span>

<span data-ttu-id="7e90d-164">Scripts de automação do PowerShell de exemplo foram desenvolvidos apenas para a versão base da Fix It executado totalmente em aplicativos de Web do serviço de aplicativo do Azure.</span><span class="sxs-lookup"><span data-stu-id="7e90d-164">Sample PowerShell automation scripts were written only for the base version of Fix It that runs entirely in Azure App Service Web Apps.</span></span> <span data-ttu-id="7e90d-165">Ainda não fornecemos scripts para configurar e implantar para o aplicativo web além de ambiente de serviço de nuvem necessária para processamento de fila.</span><span class="sxs-lookup"><span data-stu-id="7e90d-165">We haven't provided scripts for setting up and deploying to the web app plus Cloud Service environment required for queue processing.</span></span>

### <a name="special-handling-for-html-codes-in-user-input"></a><span data-ttu-id="7e90d-166">Tratamento especial para os códigos HTML na entrada do usuário</span><span class="sxs-lookup"><span data-stu-id="7e90d-166">Special handling for HTML codes in user input</span></span>

<span data-ttu-id="7e90d-167">ASP.NET impede automaticamente muitas maneiras em que usuários mal-intencionados podem tentar ataques de script entre sites inserindo o script em caixas de texto de entrada do usuário.</span><span class="sxs-lookup"><span data-stu-id="7e90d-167">ASP.NET automatically prevents many ways in which malicious users might attempt cross-site scripting attacks by entering script in user input text boxes.</span></span> <span data-ttu-id="7e90d-168">E o MVC `DisplayFor` auxiliar usada para exibir tarefas títulos e notas automaticamente valores codifica o HTML que ele envia para o navegador.</span><span class="sxs-lookup"><span data-stu-id="7e90d-168">And the MVC `DisplayFor` helper used to display task titles and notes automatically HTML-encodes values that it sends to the browser.</span></span> <span data-ttu-id="7e90d-169">Mas, em um aplicativo de produção, você talvez queira adotar medidas adicionais.</span><span class="sxs-lookup"><span data-stu-id="7e90d-169">But in a production app you might want to take additional measures.</span></span> <span data-ttu-id="7e90d-170">Para obter mais informações, consulte [validação de solicitação no ASP.NET](https://msdn.microsoft.com/library/hh882339.aspx).</span><span class="sxs-lookup"><span data-stu-id="7e90d-170">For more information, see [Request Validation in ASP.NET](https://msdn.microsoft.com/library/hh882339.aspx).</span></span>

<a id="bestpractices"></a>
## <a name="best-practices"></a><span data-ttu-id="7e90d-171">Práticas recomendadas</span><span class="sxs-lookup"><span data-stu-id="7e90d-171">Best practices</span></span>

<span data-ttu-id="7e90d-172">A seguir estão alguns problemas que foram corrigidos depois de ser descobertos na revisão de código e teste da versão original do aplicativo corrigi-lo.</span><span class="sxs-lookup"><span data-stu-id="7e90d-172">Following are some issues that were fixed after being discovered in code review and testing of the original version of the Fix It app.</span></span> <span data-ttu-id="7e90d-173">Alguns foram causados pelo codificador original não percebam determinada melhor prática, alguns simplesmente porque o código foi criado rapidamente e não foi destinado a software lançado.</span><span class="sxs-lookup"><span data-stu-id="7e90d-173">Some were caused by the original coder not being aware of a particular best practice, some simply because the code was written quickly and wasn't intended for released software.</span></span> <span data-ttu-id="7e90d-174">Nós estiver listando os problemas aqui caso ocorra algo que aprendemos com essa revisão e teste que pode ser útil para outras pessoas que também está desenvolvendo aplicativos web.</span><span class="sxs-lookup"><span data-stu-id="7e90d-174">We're listing the issues here in case there's something we learned from this review and testing that might be helpful to others who are also developing web apps.</span></span>

### <a name="dispose-the-database-repository"></a><span data-ttu-id="7e90d-175">Descartar o repositório de banco de dados</span><span class="sxs-lookup"><span data-stu-id="7e90d-175">Dispose the database repository</span></span>

<span data-ttu-id="7e90d-176">O `FixItTaskRepository` classe deve descartar o Entity Framework `DbContext` instância.</span><span class="sxs-lookup"><span data-stu-id="7e90d-176">The `FixItTaskRepository` class must dispose the Entity Framework `DbContext` instance.</span></span> <span data-ttu-id="7e90d-177">Isso ocorria implementando `IDisposable` no `FixItTaskRepository` classe:</span><span class="sxs-lookup"><span data-stu-id="7e90d-177">We did this by implementing `IDisposable` in the `FixItTaskRepository` class:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample1.cs)]

<span data-ttu-id="7e90d-178">Observe que AutoFac será descarta automaticamente a `FixItTaskRepository` instância, portanto, não precisamos dispose-lo explicitamente.</span><span class="sxs-lookup"><span data-stu-id="7e90d-178">Note that AutoFac will automatically dispose the `FixItTaskRepository` instance, so we don't need to explicitly dispose it.</span></span>

<span data-ttu-id="7e90d-179">Outra opção é remover o `DbContext` variável de membro de `FixItTaskRepository`e em vez disso, crie um local `DbContext` variável dentro de cada método de repositório, dentro de um `using` instrução.</span><span class="sxs-lookup"><span data-stu-id="7e90d-179">Another option is to remove the `DbContext` member variable from `FixItTaskRepository`, and instead create a local `DbContext` variable within each repository method, inside a `using` statement.</span></span> <span data-ttu-id="7e90d-180">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="7e90d-180">For example:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample2.cs)]

### <a name="register-singletons-as-such-with-di"></a><span data-ttu-id="7e90d-181">Registrar singletons assim com DI</span><span class="sxs-lookup"><span data-stu-id="7e90d-181">Register singletons as such with DI</span></span>

<span data-ttu-id="7e90d-182">Desde que apenas uma instância do `PhotoService` classe e `Logger` classe é necessária, essas classes devem ser [registrado como instâncias únicas para injeção de dependência](https://code.google.com/p/autofac/wiki/InstanceScope) na *DependenciesConfig.cs*:</span><span class="sxs-lookup"><span data-stu-id="7e90d-182">Since only one instance of the `PhotoService` class and `Logger` class is needed, these classes should be [registered as single instances for dependency injection](https://code.google.com/p/autofac/wiki/InstanceScope) in *DependenciesConfig.cs*:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample3.cs?highlight=1,3)]

### <a name="security-dont-show-error-details-to-users"></a><span data-ttu-id="7e90d-183">Segurança: Não exibir detalhes do erro para os usuários</span><span class="sxs-lookup"><span data-stu-id="7e90d-183">Security: Don't show error details to users</span></span>

<span data-ttu-id="7e90d-184">O corrigir aplicativo original não tem uma página de erro genérica e deixar todas as bolhas exceções até a interface do usuário, para que algumas exceções, como erros de conexão de banco de dados podem resultar em um rastreamento de pilha completos que está sendo exibido no navegador.</span><span class="sxs-lookup"><span data-stu-id="7e90d-184">The original Fix It app didn't have a generic error page and just let all exceptions bubble up to the UI, so some exceptions such as database connection errors could result in a full stack trace being displayed to the browser.</span></span> <span data-ttu-id="7e90d-185">Informações de erro detalhadas, às vezes, podem facilitar a ataques por usuários mal-intencionados.</span><span class="sxs-lookup"><span data-stu-id="7e90d-185">Detailed error information can sometimes facilitate attacks by malicious users.</span></span> <span data-ttu-id="7e90d-186">A solução é registrar em log os detalhes de exceção e exibir uma página de erro para o usuário que não inclui detalhes do erro.</span><span class="sxs-lookup"><span data-stu-id="7e90d-186">The solution is to log the exception details and display an error page to the user that doesn't include error details.</span></span> <span data-ttu-id="7e90d-187">O aplicativo corrigir já foi o log e para exibir uma página de erro, adicionamos `<customErrors mode=On>` no arquivo Web. config.</span><span class="sxs-lookup"><span data-stu-id="7e90d-187">The Fix It app was already logging, and in order to display an error page, we added `<customErrors mode=On>` in the Web.config file.</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample4.xml?highlight=2)]

<span data-ttu-id="7e90d-188">Por padrão, isso faz *Views\Shared\Error.cshtml* a ser exibido para erros.</span><span class="sxs-lookup"><span data-stu-id="7e90d-188">By default this causes *Views\Shared\Error.cshtml* to be displayed for errors.</span></span> <span data-ttu-id="7e90d-189">Você pode personalizar *Error.cshtml* ou criar seu próprio modo de exibição de página de erro e adicionar um `defaultRedirect` atributo.</span><span class="sxs-lookup"><span data-stu-id="7e90d-189">You can customize *Error.cshtml* or create your own error page view and add a `defaultRedirect` attribute.</span></span> <span data-ttu-id="7e90d-190">Você também pode especificar diferentes páginas de erro para erros específicos.</span><span class="sxs-lookup"><span data-stu-id="7e90d-190">You can also specify different error pages for specific errors.</span></span>

### <a name="security-only-allow-a-task-to-be-edited-by-its-creator"></a><span data-ttu-id="7e90d-191">Segurança: permitir que somente uma tarefa a ser editado pelo seu criador</span><span class="sxs-lookup"><span data-stu-id="7e90d-191">Security: only allow a task to be edited by its creator</span></span>

<span data-ttu-id="7e90d-192">A página de índice de painel mostra apenas tarefas criadas pelo usuário conectado, mas um usuário mal-intencionado pode criar uma URL com uma ID de tarefa do outro usuário.</span><span class="sxs-lookup"><span data-stu-id="7e90d-192">The Dashboard Index page only shows tasks created by the logged-on user, but a malicious user could create a URL with an ID to another user's task.</span></span> <span data-ttu-id="7e90d-193">Adicionamos código *DashboardController.cs* para retornar 404 nesse caso:</span><span class="sxs-lookup"><span data-stu-id="7e90d-193">We added code in *DashboardController.cs* to return a 404 in that case:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample5.cs?highlight=9-14,24-29)]

### <a name="dont-swallow-exceptions"></a><span data-ttu-id="7e90d-194">Não assimilar exceções</span><span class="sxs-lookup"><span data-stu-id="7e90d-194">Don't swallow exceptions</span></span>

<span data-ttu-id="7e90d-195">O corrigir aplicativo original apenas retornou nulo após o logon a uma exceção que resultou de uma consulta SQL:</span><span class="sxs-lookup"><span data-stu-id="7e90d-195">The original Fix It app just returned null after logging an exception that resulted from a SQL query:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample6.cs?highlight=4)]

<span data-ttu-id="7e90d-196">Isso tornaria Vista pelo usuário como se a consulta foi bem-sucedida, mas apenas não retornou nenhuma linha.</span><span class="sxs-lookup"><span data-stu-id="7e90d-196">This would make it look to the user as if the query succeeded but just didn't return any rows.</span></span> <span data-ttu-id="7e90d-197">A solução é para gerar novamente a exceção após capturando e registro em log:</span><span class="sxs-lookup"><span data-stu-id="7e90d-197">Solution is to re-throw the exception after catching and logging:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample7.cs)]

### <a name="catch-all-exceptions-in-worker-roles"></a><span data-ttu-id="7e90d-198">Capturar todas as exceções em funções de trabalho</span><span class="sxs-lookup"><span data-stu-id="7e90d-198">Catch all exceptions in worker roles</span></span>

<span data-ttu-id="7e90d-199">Todas as exceções sem tratamento em uma função de trabalho fará com que a máquina virtual seja reciclado, então você deseja incluir tudo o que fazer em um bloco try-catch e tratar todas as exceções.</span><span class="sxs-lookup"><span data-stu-id="7e90d-199">Any unhandled exceptions in a worker role will cause the VM to be recycled, so you want to wrap everything you do in a try-catch block and handle all exceptions.</span></span>

### <a name="specify-length-for-string-properties-in-entity-classes"></a><span data-ttu-id="7e90d-200">Especificar o tamanho para propriedades de cadeia de caracteres em classes de entidade</span><span class="sxs-lookup"><span data-stu-id="7e90d-200">Specify length for string properties in entity classes</span></span>

<span data-ttu-id="7e90d-201">Para exibir código simples, a versão original do aplicativo corrigir não especifica tamanhos para os campos da entidade FixItTask e como resultado, eles foram definidos como varchar (max) no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="7e90d-201">In order to display simple code, the original version of the Fix It app didn't specify lengths for the fields of the FixItTask entity, and as a result they were defined as varchar(max) in the database.</span></span> <span data-ttu-id="7e90d-202">Como resultado, a interface do usuário aceite praticamente qualquer valor de entrada.</span><span class="sxs-lookup"><span data-stu-id="7e90d-202">As a result, the UI would accept almost any amount of input.</span></span> <span data-ttu-id="7e90d-203">Especificando comprimentos define limites que se aplicam tanto ao usuário de entrada na página da web e tamanho da coluna no banco de dados:</span><span class="sxs-lookup"><span data-stu-id="7e90d-203">Specifying lengths sets limits that apply both to user input in the web page and column size in the database:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample8.cs?highlight=4,7,10,12,14)]

### <a name="mark-private-members-as-readonly-when-they-arent-expected-to-change"></a><span data-ttu-id="7e90d-204">Marcar membros particulares como somente leitura quando elas não são esperadas para alterar</span><span class="sxs-lookup"><span data-stu-id="7e90d-204">Mark private members as readonly when they aren't expected to change</span></span>

<span data-ttu-id="7e90d-205">Por exemplo, o `DashboardController` classe uma instância do `FixItTaskRepository` é criada e não é esperado para alterar, então a definimos como [readonly](https://msdn.microsoft.com/library/acdd6hb7.aspx).</span><span class="sxs-lookup"><span data-stu-id="7e90d-205">For example, in the `DashboardController` class an instance of `FixItTaskRepository` is created and isn't expected to change, so we defined it as [readonly](https://msdn.microsoft.com/library/acdd6hb7.aspx).</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample9.cs?highlight=3)]

### <a name="use-listany-instead-of-listcount-gt-0"></a><span data-ttu-id="7e90d-206">Use a lista. Any () em vez de lista. Contagem &gt; 0</span><span class="sxs-lookup"><span data-stu-id="7e90d-206">Use list.Any() instead of list.Count() &gt; 0</span></span>

<span data-ttu-id="7e90d-207">Se você importante é se um ou mais itens em uma lista de ajustam os critérios especificados, use o [qualquer](https://msdn.microsoft.com/library/bb534972.aspx) método, porque retorna assim que um ajuste os critérios de item for encontrado, enquanto o `Count` sempre tem método iterar em cada item.</span><span class="sxs-lookup"><span data-stu-id="7e90d-207">If you all you care about is whether one or more items in a list fit the specified criteria, use the [Any](https://msdn.microsoft.com/library/bb534972.aspx) method, because it returns as soon as an item fitting the criteria is found, whereas the `Count` method always has to iterate through every item.</span></span> <span data-ttu-id="7e90d-208">O painel *cshtml* arquivo originalmente tinha este código:</span><span class="sxs-lookup"><span data-stu-id="7e90d-208">The Dashboard *Index.cshtml* file originally had this code:</span></span>

[!code-cshtml[Main](the-fix-it-sample-application/samples/sample10.cshtml)]

<span data-ttu-id="7e90d-209">É alterado para isso:</span><span class="sxs-lookup"><span data-stu-id="7e90d-209">We changed it to this:</span></span>

[!code-cshtml[Main](the-fix-it-sample-application/samples/sample11.cshtml?highlight=1)]

### <a name="generate-urls-in-mvc-views-using-mvc-helpers"></a><span data-ttu-id="7e90d-210">Gerar URLs nas exibições do MVC usando auxiliares do MVC</span><span class="sxs-lookup"><span data-stu-id="7e90d-210">Generate URLs in MVC views using MVC helpers</span></span>

<span data-ttu-id="7e90d-211">Para o **criar um Fix It** botão na home page, corrigir aplicativo rígido codificado um elemento âncora:</span><span class="sxs-lookup"><span data-stu-id="7e90d-211">For the **Create a Fix It** button on the home page, the Fix It app hard coded an anchor element:</span></span>

[!code-cshtml[Main](the-fix-it-sample-application/samples/sample12.cshtml)]

<span data-ttu-id="7e90d-212">Para links de ação/exibição como isso é melhor usar o [URL](https://msdn.microsoft.com/library/system.web.mvc.urlhelper.action.aspx) auxiliar HTML, por exemplo:</span><span class="sxs-lookup"><span data-stu-id="7e90d-212">For View/Action links like this it's better to use the [Url.Action](https://msdn.microsoft.com/library/system.web.mvc.urlhelper.action.aspx) HTML helper, for example:</span></span>

[!code-cshtml[Main](the-fix-it-sample-application/samples/sample13.cshtml)]

### <a name="use-taskdelay-instead-of-threadsleep-in-worker-role"></a><span data-ttu-id="7e90d-213">Use Task.Delay em vez de thread. Sleep em função de trabalho</span><span class="sxs-lookup"><span data-stu-id="7e90d-213">Use Task.Delay instead of Thread.Sleep in worker role</span></span>

<span data-ttu-id="7e90d-214">O modelo de projeto novo coloca `Thread.Sleep` no exemplo de código para uma função de trabalho, mas fazendo com que o thread em suspensão pode causar o pool de threads gerar mais threads desnecessários.</span><span class="sxs-lookup"><span data-stu-id="7e90d-214">The new-project template puts `Thread.Sleep` in the sample code for a worker role, but causing the thread to sleep can cause the thread pool to spawn additional unnecessary threads.</span></span> <span data-ttu-id="7e90d-215">Você pode evitar que usando [Task.Delay](https://msdn.microsoft.com/library/hh139096.aspx) em vez disso.</span><span class="sxs-lookup"><span data-stu-id="7e90d-215">You can avoid that by using [Task.Delay](https://msdn.microsoft.com/library/hh139096.aspx) instead.</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample14.cs?highlight=11)]

### <a name="avoid-async-void"></a><span data-ttu-id="7e90d-216">Evite async void</span><span class="sxs-lookup"><span data-stu-id="7e90d-216">Avoid async void</span></span>

<span data-ttu-id="7e90d-217">Se um método assíncrono não precisa retornar um valor, retornar um `Task` tipo em vez de `void`.</span><span class="sxs-lookup"><span data-stu-id="7e90d-217">If an async method doesn't need to return a value, return a `Task` type rather than `void`.</span></span>

<span data-ttu-id="7e90d-218">Este exemplo é proveniente de `FixItQueueManager` classe:</span><span class="sxs-lookup"><span data-stu-id="7e90d-218">This example is from the `FixItQueueManager` class:</span></span> 

[!code-csharp[Main](the-fix-it-sample-application/samples/sample15.cs)]

<span data-ttu-id="7e90d-219">Você deve usar `async void` apenas para manipuladores de eventos de nível superior.</span><span class="sxs-lookup"><span data-stu-id="7e90d-219">You should use `async void` only for top-level event handlers.</span></span> <span data-ttu-id="7e90d-220">Se você definir um método como `async void`, o chamador não é possível **await** o método ou capturar qualquer exceção que o método gera.</span><span class="sxs-lookup"><span data-stu-id="7e90d-220">If you define a method as `async void`, the caller cannot **await** the method or catch any exceptions the method throws.</span></span> <span data-ttu-id="7e90d-221">Para obter mais informações, consulte [as práticas recomendadas de programação assíncrona](https://msdn.microsoft.com/magazine/jj991977.aspx).</span><span class="sxs-lookup"><span data-stu-id="7e90d-221">For more information, see [Best Practices in Asynchronous Programming](https://msdn.microsoft.com/magazine/jj991977.aspx).</span></span> 

### <a name="use-a-cancellation-token-to-break-from-worker-role-loop"></a><span data-ttu-id="7e90d-222">Use um token de cancelamento para quebra de loop de função de trabalho</span><span class="sxs-lookup"><span data-stu-id="7e90d-222">Use a cancellation token to break from worker role loop</span></span>

<span data-ttu-id="7e90d-223">Normalmente, o **executar** método em uma função de trabalho contém um loop infinito.</span><span class="sxs-lookup"><span data-stu-id="7e90d-223">Typically, the **Run** method on a worker role contains an infinite loop.</span></span> <span data-ttu-id="7e90d-224">Quando a função de trabalho está sendo interrompido, o [RoleEntryPoint](https://msdn.microsoft.com/library/windowsazure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) método é chamado.</span><span class="sxs-lookup"><span data-stu-id="7e90d-224">When the worker role is stopping, the [RoleEntryPoint.OnStop](https://msdn.microsoft.com/library/windowsazure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) method is called.</span></span> <span data-ttu-id="7e90d-225">Você deve usar esse método para cancelar o trabalho que está sendo feito dentro de **executar** método e sair normalmente.</span><span class="sxs-lookup"><span data-stu-id="7e90d-225">You should use this method to cancel the work that is being done inside the **Run** method and exit gracefully.</span></span> <span data-ttu-id="7e90d-226">Caso contrário, o processo pode ser finalizado no meio de uma operação.</span><span class="sxs-lookup"><span data-stu-id="7e90d-226">Otherwise, the process might be terminated in the middle of an operation.</span></span>

### <a name="opt-out-of-automatic-mime-sniffing-procedure"></a><span data-ttu-id="7e90d-227">Recusar o procedimento de detecção automática de MIME</span><span class="sxs-lookup"><span data-stu-id="7e90d-227">Opt out of Automatic MIME Sniffing Procedure</span></span>

<span data-ttu-id="7e90d-228">Em alguns casos, o Internet Explorer relata um tipo MIME diferente do tipo especificado pelo servidor web.</span><span class="sxs-lookup"><span data-stu-id="7e90d-228">In some cases, Internet Explorer reports a MIME type different than the type specified by the web server.</span></span> <span data-ttu-id="7e90d-229">Por exemplo, se o Internet Explorer encontrar HTML conteúdo em um arquivo fornecido com o cabeçalho de resposta HTTP Content-Type: texto/sem formatação, o Internet Explorer determina se o conteúdo deve ser renderizado como HTML.</span><span class="sxs-lookup"><span data-stu-id="7e90d-229">For instance, if Internet Explorer finds HTML content in a file delivered with the HTTP response header Content-Type: text/plain, Internet Explorer determines that the content should be rendered as HTML.</span></span> <span data-ttu-id="7e90d-230">Infelizmente, esse "MIME-sniffing" também pode levar a problemas de segurança para servidores que hospedam o conteúdo não confiável.</span><span class="sxs-lookup"><span data-stu-id="7e90d-230">Unfortunately, this "MIME-sniffing" can also lead to security problems for servers hosting untrusted content.</span></span> <span data-ttu-id="7e90d-231">Para combater esse problema, o Internet Explorer 8 fez algumas alterações ao código de determinação do tipo de MIME e permite que os desenvolvedores de aplicativos [recusar a detecção de MIME](https://blogs.msdn.com/b/ie/archive/2008/07/02/ie8-security-part-v-comprehensive-protection.aspx).</span><span class="sxs-lookup"><span data-stu-id="7e90d-231">To combat this problem, Internet Explorer 8 has made a number of changes to MIME-type determination code and allows application developers to [opt out of MIME-sniffing](https://blogs.msdn.com/b/ie/archive/2008/07/02/ie8-security-part-v-comprehensive-protection.aspx).</span></span> <span data-ttu-id="7e90d-232">O código a seguir foi adicionado para o *Web. config* arquivo.</span><span class="sxs-lookup"><span data-stu-id="7e90d-232">The following code was added to the *Web.config* file.</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample16.xml?highlight=2-7)]

### <a name="enable-bundling-and-minification"></a><span data-ttu-id="7e90d-233">Habilitar o empacotamento e minimização</span><span class="sxs-lookup"><span data-stu-id="7e90d-233">Enable bundling and minification</span></span>

<span data-ttu-id="7e90d-234">Quando o Visual Studio cria um novo projeto web, empacotamento e minimização dos arquivos JavaScript não está habilitado por padrão.</span><span class="sxs-lookup"><span data-stu-id="7e90d-234">When Visual Studio creates a new web project, bundling and minification of JavaScript files is not enabled by default.</span></span> <span data-ttu-id="7e90d-235">Adicionamos uma linha de código em BundleConfig.cs:</span><span class="sxs-lookup"><span data-stu-id="7e90d-235">We added a line of code in BundleConfig.cs:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample17.cs?highlight=9)]

### <a name="set-an-expiration-time-out-for-authentication-cookies"></a><span data-ttu-id="7e90d-236">Definir um tempo limite de expiração de cookies de autenticação</span><span class="sxs-lookup"><span data-stu-id="7e90d-236">Set an expiration time-out for authentication cookies</span></span>

<span data-ttu-id="7e90d-237">Por padrão, os cookies de autenticação expiram em duas semanas.</span><span class="sxs-lookup"><span data-stu-id="7e90d-237">By default, authentication cookies expire in two weeks.</span></span> <span data-ttu-id="7e90d-238">Um tempo mais curto é mais seguro.</span><span class="sxs-lookup"><span data-stu-id="7e90d-238">A shorter time is more secure.</span></span> <span data-ttu-id="7e90d-239">Você pode alterar essa configuração no *StartupAuth.cs*:</span><span class="sxs-lookup"><span data-stu-id="7e90d-239">You can change this setting in *StartupAuth.cs*:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample18.cs?highlight=4-5)]

<a id="run-in-vs"></a>
## <a name="how-to-run-the-app-from-visual-studio-on-your-local-computer"></a><span data-ttu-id="7e90d-240">Como executar o aplicativo do Visual Studio no computador local</span><span class="sxs-lookup"><span data-stu-id="7e90d-240">How to run the app from Visual Studio on your local computer</span></span>

<span data-ttu-id="7e90d-241">Há duas maneiras de executar o aplicativo corrigir:</span><span class="sxs-lookup"><span data-stu-id="7e90d-241">There are two ways to run the Fix It app:</span></span>

- <span data-ttu-id="7e90d-242">Execute o aplicativo de base que grava novas tarefas diretamente ao banco de dados SQL.</span><span class="sxs-lookup"><span data-stu-id="7e90d-242">Run the base application that writes new tasks directly to the SQL database.</span></span>
- <span data-ttu-id="7e90d-243">Execute o aplicativo usando uma fila de adição de um serviço de back-end para criar tarefas.</span><span class="sxs-lookup"><span data-stu-id="7e90d-243">Run the application using a queue plus a backend service to create tasks.</span></span> <span data-ttu-id="7e90d-244">O padrão de fila é descrito no capítulo [padrão centrado em fila de trabalho](queue-centric-work-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="7e90d-244">The queue pattern is described in the chapter [Queue-Centric Work Pattern](queue-centric-work-pattern.md).</span></span>

<a id="runbase"></a>
### <a name="run-the-base-application"></a><span data-ttu-id="7e90d-245">Executar o aplicativo básico</span><span class="sxs-lookup"><span data-stu-id="7e90d-245">Run the base application</span></span>

1. <span data-ttu-id="7e90d-246">Instalar [Visual Studio 2013 ou o Visual Studio 2013 Express para Web](https://www.visualstudio.com/downloads).</span><span class="sxs-lookup"><span data-stu-id="7e90d-246">Install [Visual Studio 2013 or Visual Studio 2013 Express for Web](https://www.visualstudio.com/downloads).</span></span>
2. <span data-ttu-id="7e90d-247">Instalar o [SDK do Azure para .NET para Visual Studio 2013.](https://go.microsoft.com/fwlink/p/?linkid=323510&amp;clcid=0x409)</span><span class="sxs-lookup"><span data-stu-id="7e90d-247">Install the [Azure SDK for .NET for Visual Studio 2013.](https://go.microsoft.com/fwlink/p/?linkid=323510&amp;clcid=0x409)</span></span>
3. <span data-ttu-id="7e90d-248">Baixe o arquivo. zip do [Galeria de códigos do MSDN](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4).</span><span class="sxs-lookup"><span data-stu-id="7e90d-248">Download the .zip file from the [MSDN Code Gallery](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4).</span></span>
4. <span data-ttu-id="7e90d-249">No Explorador de arquivos, clique com botão direito no arquivo. zip e clique em propriedades, na janela Propriedades, clique em Desbloquear.</span><span class="sxs-lookup"><span data-stu-id="7e90d-249">In File Explorer, right-click the .zip file and click Properties, then in the Properties window click Unblock.</span></span>
5. <span data-ttu-id="7e90d-250">Descompacte o arquivo.</span><span class="sxs-lookup"><span data-stu-id="7e90d-250">Unzip the file.</span></span>
6. <span data-ttu-id="7e90d-251">Clique duas vezes no arquivo. sln para iniciar o Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="7e90d-251">Double-click the .sln file to launch Visual Studio.</span></span>
7. <span data-ttu-id="7e90d-252">No menu Ferramentas, clique em Gerenciador de biblioteca de pacote e, em seguida, Package Manager Console.</span><span class="sxs-lookup"><span data-stu-id="7e90d-252">From the Tools menu, click Library Package Manager, then Package Manager Console.</span></span>
8. <span data-ttu-id="7e90d-253">No pacote Manager Console (PMC), clique em Restaurar.</span><span class="sxs-lookup"><span data-stu-id="7e90d-253">In the Package Manager Console (PMC), click Restore.</span></span>
9. <span data-ttu-id="7e90d-254">Sair do Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="7e90d-254">Exit Visual Studio.</span></span>
10. <span data-ttu-id="7e90d-255">Iniciar o [emulador de armazenamento do Azure](https://msdn.microsoft.com/library/windowsazure/hh403989.aspx).</span><span class="sxs-lookup"><span data-stu-id="7e90d-255">Start the [Azure storage emulator](https://msdn.microsoft.com/library/windowsazure/hh403989.aspx).</span></span>
11. <span data-ttu-id="7e90d-256">Reinicie o Visual Studio, abrir o arquivo de solução que você encerrou na etapa anterior.</span><span class="sxs-lookup"><span data-stu-id="7e90d-256">Restart Visual Studio, opening the solution file you closed in the previous step.</span></span>
12. <span data-ttu-id="7e90d-257">Verifique se que o projeto FixIt está definido como o projeto de inicialização e, em seguida, pressione CTRL + F5 para executar o projeto.</span><span class="sxs-lookup"><span data-stu-id="7e90d-257">Make sure the FixIt project is set as the startup project, and then press CTRL+F5 to run the project.</span></span>

<a id="queueslocal"></a>
### <a name="run-the-application-with-queue-processing"></a><span data-ttu-id="7e90d-258">Executar o aplicativo de processamento de fila</span><span class="sxs-lookup"><span data-stu-id="7e90d-258">Run the application with queue processing</span></span>

1. <span data-ttu-id="7e90d-259">Siga as orientações para [executar o aplicativo base](#runbase)e, em seguida, feche o navegador e feche o Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="7e90d-259">Follow the directions for [Run the base application](#runbase), and then close the browser and close Visual Studio.</span></span>
2. <span data-ttu-id="7e90d-260">Inicie o Visual Studio com privilégios de administrador.</span><span class="sxs-lookup"><span data-stu-id="7e90d-260">Start Visual Studio with administrator privileges.</span></span> <span data-ttu-id="7e90d-261">(Você vai usar o emulador de computação do Azure, e que requer privilégios de administrador).</span><span class="sxs-lookup"><span data-stu-id="7e90d-261">(You'll be using the Azure compute emulator, and that requires administrator privileges.)</span></span>
3. <span data-ttu-id="7e90d-262">No aplicativo *Web. config* arquivo o *MyFixIt* (o projeto da web) do projeto, altere o valor de `appSettings/UseQueues` como "true":</span><span class="sxs-lookup"><span data-stu-id="7e90d-262">In the application *Web.config* file in the *MyFixIt* project (the web project), change the value of `appSettings/UseQueues` to "true":</span></span> 

    [!code-console[Main](the-fix-it-sample-application/samples/sample19.cmd?highlight=3)]
4. <span data-ttu-id="7e90d-263">Se o [emulador de armazenamento do Azure](https://msdn.microsoft.com/library/windowsazure/hh403989.aspx) não está em execução, inicie-o novamente.</span><span class="sxs-lookup"><span data-stu-id="7e90d-263">If the [Azure storage emulator](https://msdn.microsoft.com/library/windowsazure/hh403989.aspx) isn't still running, start it again.</span></span>
5. <span data-ttu-id="7e90d-264">Execute o projeto web FixIt e o projeto MyFixItCloudService simultaneamente.</span><span class="sxs-lookup"><span data-stu-id="7e90d-264">Run the FixIt web project and the MyFixItCloudService project simultaneously.</span></span>

    <span data-ttu-id="7e90d-265">Usando o Visual Studio 2013:</span><span class="sxs-lookup"><span data-stu-id="7e90d-265">Using Visual Studio 2013:</span></span>

    1. <span data-ttu-id="7e90d-266">Pressione F5 para executar o projeto FixIt.</span><span class="sxs-lookup"><span data-stu-id="7e90d-266">Press F5 to run the FixIt project.</span></span>
    2. <span data-ttu-id="7e90d-267">Em **Solution Explorer**, com o botão direito no projeto MyFixItCloudService e, em seguida, clique em **depurar** -- **iniciar uma nova instância**.</span><span class="sxs-lookup"><span data-stu-id="7e90d-267">In **Solution Explorer**, right-click the MyFixItCloudService project, and then click **Debug** -- **Start New Instance**.</span></span>

    <span data-ttu-id="7e90d-268">Usando o Visual Studio 2013 Express para Web:</span><span class="sxs-lookup"><span data-stu-id="7e90d-268">Using Visual Studio 2013 Express for Web:</span></span>

    1. <span data-ttu-id="7e90d-269">No Gerenciador de soluções, a solução FixIt e selecione **propriedades**.</span><span class="sxs-lookup"><span data-stu-id="7e90d-269">In Solution Explorer, right-click the FixIt solution and select **Properties**.</span></span>
    2. <span data-ttu-id="7e90d-270">Selecione **vários projetos de inicialização**...</span><span class="sxs-lookup"><span data-stu-id="7e90d-270">Select **Multiple Startup Projects**..</span></span>
    3. <span data-ttu-id="7e90d-271">No **ação** selecione da lista suspensa em MyFixIt e MyFixItCloudService, **iniciar**.</span><span class="sxs-lookup"><span data-stu-id="7e90d-271">In the **Action** dropdown list under MyFixIt and MyFixItCloudService, select **Start**.</span></span>
    4. <span data-ttu-id="7e90d-272">Clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="7e90d-272">Click **OK**.</span></span>
    5. <span data-ttu-id="7e90d-273">Pressione F5 para executar os dois projetos.</span><span class="sxs-lookup"><span data-stu-id="7e90d-273">Press F5 to run both projects.</span></span>

    <span data-ttu-id="7e90d-274">Quando você executar o projeto MyFixItCloudService, o Visual Studio inicia o emulador de computação do Azure.</span><span class="sxs-lookup"><span data-stu-id="7e90d-274">When you run the MyFixItCloudService project, Visual Studio starts the Azure compute emulator.</span></span> <span data-ttu-id="7e90d-275">Dependendo da configuração do firewall, você precisará permitir que o emulador através do firewall.</span><span class="sxs-lookup"><span data-stu-id="7e90d-275">Depending on your firewall configuration, you might need to allow the emulator through the firewall.</span></span>

<a id="deploybase"></a>
## <a name="how-to-deploy-the-base-app-to-azure-app-service-web-apps-by-using-the-windows-powershell-scripts"></a><span data-ttu-id="7e90d-276">Como implantar o aplicativo base para aplicativos de Web do serviço de aplicativo do Azure usando os scripts do Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="7e90d-276">How to deploy the base app to Azure App Service Web Apps by using the Windows PowerShell scripts</span></span>

<span data-ttu-id="7e90d-277">Para ilustrar o [automatizar tudo](automate-everything.md) padrão, o aplicativo corrigir é fornecido com scripts que configurar um ambiente no Azure e implantar o projeto para o novo ambiente.</span><span class="sxs-lookup"><span data-stu-id="7e90d-277">To illustrate the [Automate Everything](automate-everything.md) pattern, the Fix It app is supplied with scripts that set up an environment in Azure and deploy the project to the new environment.</span></span> <span data-ttu-id="7e90d-278">As instruções a seguir explicam como usar os scripts.</span><span class="sxs-lookup"><span data-stu-id="7e90d-278">The following instructions explain how to use the scripts.</span></span>

<span data-ttu-id="7e90d-279">Se você deseja executar no Azure sem o uso de filas, e você fez as alterações para executar localmente com filas, verifique se que você definir o valor de appSetting UseQueues para false antes de prosseguir com as instruções a seguir.</span><span class="sxs-lookup"><span data-stu-id="7e90d-279">If you want to run in Azure without using queues, and you made the changes to run locally with queues, make sure you set the UseQueues appSetting value back to false before proceeding with the following instructions.</span></span>

<span data-ttu-id="7e90d-280">Essas instruções presumem que você já tiver baixado e executar a solução corrigir localmente, e se você tem um Azure conta ou tem uma assinatura do Azure que você está autorizado a gerenciar.</span><span class="sxs-lookup"><span data-stu-id="7e90d-280">These instructions assume you have already downloaded and run the Fix It solution locally, and that you have an Azure account or have an Azure subscription that you are authorized to manage.</span></span>

1. <span data-ttu-id="7e90d-281">Instalar o **Azure PowerShell** console.</span><span class="sxs-lookup"><span data-stu-id="7e90d-281">Install the **Azure PowerShell** console.</span></span> <span data-ttu-id="7e90d-282">Para obter instruções, consulte [como instalar e configurar o Azure PowerShell](https://docs.microsoft.com/powershell/azure/overview?view=azurermps-4.3.1).</span><span class="sxs-lookup"><span data-stu-id="7e90d-282">For instructions, see [How to install and configure Azure PowerShell](https://docs.microsoft.com/powershell/azure/overview?view=azurermps-4.3.1).</span></span>

    <span data-ttu-id="7e90d-283">Esse console personalizado está configurado para trabalhar com sua assinatura do Azure.</span><span class="sxs-lookup"><span data-stu-id="7e90d-283">This customized console is configured to work with your Azure subscription.</span></span> <span data-ttu-id="7e90d-284">O módulo do Azure está instalado no *arquivos de programa* diretório e é importado automaticamente em todo o uso do console do PowerShell do Azure.</span><span class="sxs-lookup"><span data-stu-id="7e90d-284">The Azure module is installed in the *Program Files* directory and is automatically imported on every use of the Azure PowerShell console.</span></span>

    <span data-ttu-id="7e90d-285">Se você preferir trabalhar em um programa de host diferente, como o Windows PowerShell ISE, certifique-se de usar o [Import-Module](https://go.microsoft.com/fwlink/?LinkID=141553) cmdlet para importar o módulo do Azure ou usar um comando no módulo do Azure para disparar a importação automática do módulo.</span><span class="sxs-lookup"><span data-stu-id="7e90d-285">If you prefer to work in a different host program, such as Windows PowerShell ISE, be sure to use the [Import-Module](https://go.microsoft.com/fwlink/?LinkID=141553) cmdlet to import the Azure module or use a command in the Azure module to trigger automatic importing of the module.</span></span>
2. <span data-ttu-id="7e90d-286">Inicie o PowerShell do Azure com o **executar como administrador** opção.</span><span class="sxs-lookup"><span data-stu-id="7e90d-286">Start Azure PowerShell with the **Run as administrator** option.</span></span>
3. <span data-ttu-id="7e90d-287">Execute o [Set-ExecutionPolicy](https://go.microsoft.com/fwlink/p/?linkid=293941) cmdlet para definir a política de execução do PowerShell do Azure para `RemoteSigned`.</span><span class="sxs-lookup"><span data-stu-id="7e90d-287">Run the [Set-ExecutionPolicy](https://go.microsoft.com/fwlink/p/?linkid=293941) cmdlet to set the Azure PowerShell execution policy to `RemoteSigned`.</span></span> <span data-ttu-id="7e90d-288">Digite **Y** (para Sim) para concluir a alteração da política.</span><span class="sxs-lookup"><span data-stu-id="7e90d-288">Enter **Y** (for Yes) to complete the policy change.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample20.cmd)]

    <span data-ttu-id="7e90d-289">Essa configuração permite que você execute scripts locais que não são assinados digitalmente.</span><span class="sxs-lookup"><span data-stu-id="7e90d-289">This setting enables you to run local scripts that aren't digitally signed.</span></span> <span data-ttu-id="7e90d-290">(Você também pode definir a política de execução `Unrestricted`, que seria eliminar a necessidade para a etapa de desbloqueio, mas isso não é recomendado por motivos de segurança.)</span><span class="sxs-lookup"><span data-stu-id="7e90d-290">(You can also set the execution policy to `Unrestricted`, which would eliminate the need for the unblock step later, but this is not recommended for security reasons.)</span></span>
4. <span data-ttu-id="7e90d-291">Execute o `Add-AzureAccount` cmdlet para configurar o PowerShell com as credenciais de sua conta.</span><span class="sxs-lookup"><span data-stu-id="7e90d-291">Run the `Add-AzureAccount` cmdlet to set up PowerShell with credentials for your account.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample21.cmd)]

    <span data-ttu-id="7e90d-292">Essas credenciais expirarem após um período de tempo e você precisa executar novamente o `Add-AzureAccount` cmdlet.</span><span class="sxs-lookup"><span data-stu-id="7e90d-292">These credentials expire after a period of time and you have to re-run the `Add-AzureAccount` cmdlet.</span></span> <span data-ttu-id="7e90d-293">Como este livro eletrônico está sendo gravado, o limite de tempo antes de expirarem credenciais é 12 horas.</span><span class="sxs-lookup"><span data-stu-id="7e90d-293">As this e-book is being written, the time limit before credentials expire is 12 hours.</span></span>
5. <span data-ttu-id="7e90d-294">Se você tiver várias assinaturas, use o cmdlet Select-AzureSubscription para especificar a assinatura que você deseja criar o ambiente de teste.</span><span class="sxs-lookup"><span data-stu-id="7e90d-294">If you have multiple subscriptions, use the Select-AzureSubscription cmdlet to specify the subscription you want to create the test environment in.</span></span>
6. <span data-ttu-id="7e90d-295">Importar um certificado de gerenciamento para a mesma assinatura do Azure usando o `Get-AzurePublishSettingsFile` e `Import-AzurePublishSettingsFile` cmdlets.</span><span class="sxs-lookup"><span data-stu-id="7e90d-295">Import a management certificate for the same Azure subscription by using the `Get-AzurePublishSettingsFile` and `Import-AzurePublishSettingsFile` cmdlets.</span></span> <span data-ttu-id="7e90d-296">O primeiro desses cmdlets baixa um arquivo de certificado e, no segundo, você especificar o local do arquivo para importá-lo.</span><span class="sxs-lookup"><span data-stu-id="7e90d-296">The first of these cmdlets downloads a certificate file, and in the second one you specify the location of that file in order to import it.</span></span> > [!IMPORTANT]
 > <span data-ttu-id="7e90d-297">Manter o arquivo baixado em um local seguro ou excluí-lo quando você tiver concluído, porque ele contém um certificado que pode ser usado para gerenciar os serviços do Azure.</span><span class="sxs-lookup"><span data-stu-id="7e90d-297">Keep the downloaded file in a safe location or delete it when you're done with it, because it contains a certificate that can be used to manage your Azure services.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample22.cmd)]

    <span data-ttu-id="7e90d-298">O certificado é usado para uma chamada à API REST que detecta o endereço IP do computador de desenvolvimento para definir uma regra de firewall no servidor de banco de dados SQL.</span><span class="sxs-lookup"><span data-stu-id="7e90d-298">The certificate is used for a REST API call that detects the development machine's IP address in order to set a firewall rule on the SQL Database server.</span></span>
7. <span data-ttu-id="7e90d-299">Execute o [Set-Location](https://go.microsoft.com/fwlink/p/?linkid=293912) cmdlet (aliases são `cd`, `chdir`, e `sl`) para navegar até o diretório que contém os scripts.</span><span class="sxs-lookup"><span data-stu-id="7e90d-299">Run the [Set-Location](https://go.microsoft.com/fwlink/p/?linkid=293912) cmdlet (aliases are `cd`, `chdir`, and `sl`) to navigate to the directory that contains the scripts.</span></span> <span data-ttu-id="7e90d-300">(Eles estão localizados no *automação* na pasta solução corrigir.) Coloque o caminho entre aspas se qualquer um dos nomes de diretório contiver espaços.</span><span class="sxs-lookup"><span data-stu-id="7e90d-300">(They're located in the *Automation* folder in the Fix It solution folder.) Put the path in quotes if any of the directory names contain spaces.</span></span> <span data-ttu-id="7e90d-301">Por exemplo, para navegar até o `c:\Sample Apps\FixIt\Automation` diretório, você pode digitar o seguinte comando:</span><span class="sxs-lookup"><span data-stu-id="7e90d-301">For example, to navigate to the `c:\Sample Apps\FixIt\Automation` directory you could enter the following command:</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample23.cmd)]
8. <span data-ttu-id="7e90d-302">Para permitir que o Windows PowerShell para executar esses scripts, use o [Unblock-File](https://go.microsoft.com/fwlink/p/?linkid=294021) cmdlet.</span><span class="sxs-lookup"><span data-stu-id="7e90d-302">To allow Windows PowerShell to run these scripts, use the [Unblock-File](https://go.microsoft.com/fwlink/p/?linkid=294021) cmdlet.</span></span> <span data-ttu-id="7e90d-303">(Os scripts estão bloqueados porque eles foram baixados da Internet).</span><span class="sxs-lookup"><span data-stu-id="7e90d-303">(The scripts are blocked because they were downloaded from the Internet.)</span></span>

    > [!WARNING]
    > <span data-ttu-id="7e90d-304">Segurança - antes de executar `Unblock-File` em qualquer script ou arquivo executável, abra o arquivo no bloco de notas, examine os comandos e verificar se eles não contêm código mal-intencionado.</span><span class="sxs-lookup"><span data-stu-id="7e90d-304">Security - Before running `Unblock-File` on any script or executable file, open the file in Notepad, examine the commands, and verify that they do not contain any malicious code.</span></span>

    <span data-ttu-id="7e90d-305">Por exemplo, o comando a seguir executa o `Unblock-File` cmdlet em todos os scripts no diretório atual.</span><span class="sxs-lookup"><span data-stu-id="7e90d-305">For example, the following command runs the `Unblock-File` cmdlet on all scripts in the current directory.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample24.cmd)]
9. <span data-ttu-id="7e90d-306">Para criar o aplicativo web para a base (nenhuma fila de processamento) corrija-o aplicativo, execute o script de criação do ambiente.</span><span class="sxs-lookup"><span data-stu-id="7e90d-306">To create the web app for the base (no queues processing) Fix It app, run the environment creation script.</span></span>

    <span data-ttu-id="7e90d-307">Obrigatório `Name` parâmetro especifica o nome do banco de dados e também é usado para a conta de armazenamento que cria o script.</span><span class="sxs-lookup"><span data-stu-id="7e90d-307">The required `Name` parameter specifies the name of the database and is also used for the storage account that the script creates.</span></span> <span data-ttu-id="7e90d-308">O nome deve ser exclusivo dentro do domínio azurewebsites.net.</span><span class="sxs-lookup"><span data-stu-id="7e90d-308">The name must be globally unique within the azurewebsites.net domain.</span></span> <span data-ttu-id="7e90d-309">Se você especificar um nome que não é exclusivo, como Fixit ou teste (ou até mesmo como no exemplo, fixitdemo), o `New-AzureWebsite` cmdlet falhará com um erro interno que relata um conflito.</span><span class="sxs-lookup"><span data-stu-id="7e90d-309">If you specify a name that is not unique, like Fixit or Test (or even as in the example, fixitdemo), the `New-AzureWebsite` cmdlet fails with an Internal Error that reports a conflict.</span></span> <span data-ttu-id="7e90d-310">O script converte o nome em letras minúsculas para atender aos requisitos de nome para aplicativos web, contas de armazenamento e bancos de dados.</span><span class="sxs-lookup"><span data-stu-id="7e90d-310">The script converts the name to all lower-case to comply with name requirements for web apps, storage accounts, and databases.</span></span>

    <span data-ttu-id="7e90d-311">Obrigatório `SqlDatabasePassword` parâmetro especifica a senha para a conta de administrador que será criada para o banco de dados SQL.</span><span class="sxs-lookup"><span data-stu-id="7e90d-311">The required `SqlDatabasePassword` parameter specifies the password for the admin account that will be created for SQL Database.</span></span> <span data-ttu-id="7e90d-312">Não inclua caracteres XML especiais na senha (&amp; &lt; &gt; ;).</span><span class="sxs-lookup"><span data-stu-id="7e90d-312">Don't include special XML characters in the password (&amp; &lt; &gt; ;).</span></span> <span data-ttu-id="7e90d-313">Essa é uma limitação do modo como os scripts foram escritos, não uma limitação do Azure.</span><span class="sxs-lookup"><span data-stu-id="7e90d-313">This is a limitation of the way the scripts were written, not a limitation of Azure.</span></span>

    <span data-ttu-id="7e90d-314">Por exemplo, se você quiser criar um aplicativo web chamado "fixitdemo" e usar uma senha de administrador do SQL Server de "Passw0rd1", você poderia digite o seguinte comando:</span><span class="sxs-lookup"><span data-stu-id="7e90d-314">For example, if you want to create a web app named "fixitdemo" and use a SQL Server administrator password of "Passw0rd1", you could enter the following command:</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample25.cmd)]

    <span data-ttu-id="7e90d-315">O nome deve ser exclusivo no domínio azurewebsites.net e a senha deve atender aos requisitos de banco de dados SQL de complexidade de senha.</span><span class="sxs-lookup"><span data-stu-id="7e90d-315">The name must be unique in the azurewebsites.net domain, and the password must meet SQL Database requirements for password complexity.</span></span> <span data-ttu-id="7e90d-316">(O exemplo Passw0rd1 atende aos requisitos).</span><span class="sxs-lookup"><span data-stu-id="7e90d-316">(The example Passw0rd1 does meet the requirements.)</span></span>

    <span data-ttu-id="7e90d-317">Observe que o comando começa com ". \".</span><span class="sxs-lookup"><span data-stu-id="7e90d-317">Note that the command begins with ".\".</span></span> <span data-ttu-id="7e90d-318">Para ajudar a evitar a execução de scripts mal-intencionados, o Windows PowerShell requer que você forneça o caminho totalmente qualificado para o arquivo de script quando você executa um script.</span><span class="sxs-lookup"><span data-stu-id="7e90d-318">To help prevent malicious execution of scripts, Windows PowerShell requires that you provide the fully qualified path to the script file when you run a script.</span></span> <span data-ttu-id="7e90d-319">Você pode usar um ponto para indicar o diretório atual (".\") ou, forneça o caminho totalmente qualificado, como:</span><span class="sxs-lookup"><span data-stu-id="7e90d-319">You can use a dot to indicate the current directory (".\") or provide the fully qualified path, such as:</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample26.cmd)]

    <span data-ttu-id="7e90d-320">Para obter mais informações sobre o script, use o `Get-Help` cmdlet.</span><span class="sxs-lookup"><span data-stu-id="7e90d-320">For more information about the script, use the `Get-Help` cmdlet.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample27.cmd)]

    <span data-ttu-id="7e90d-321">Você pode usar o `Detailed`, `Full`, `Parameters`, e `Examples` parâmetros do cmdlet Get-Help para filtrar a Ajuda que é retornada.</span><span class="sxs-lookup"><span data-stu-id="7e90d-321">You can use the `Detailed`, `Full`, `Parameters`, and `Examples` parameters of the Get-Help cmdlet to filter the help that is returned.</span></span>

    <span data-ttu-id="7e90d-322">Se o script falha ou gera erros, como "New-AzureWebsite: chamar Set-AzureSubscription e Select-AzureSubscription primeiro", você pode não concluiu a configuração do Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="7e90d-322">If the script fails or generates errors, such as "New-AzureWebsite : Call Set-AzureSubscription and Select-AzureSubscription first," you might not have completed the configuration of Azure PowerShell.</span></span>

    <span data-ttu-id="7e90d-323">Depois que o script for concluído, você pode usar o Portal de gerenciamento para ver os recursos que foram criados, como mostra o [automatizar tudo](automate-everything.md) capítulo.</span><span class="sxs-lookup"><span data-stu-id="7e90d-323">After the script finishes, you can use the Azure Management Portal to see the resources that were created, as shown in the [Automate Everything](automate-everything.md) chapter.</span></span>
10. <span data-ttu-id="7e90d-324">Para implantar o projeto FixIt para o novo ambiente do Azure, use o *AzureWebsite.ps1* script.</span><span class="sxs-lookup"><span data-stu-id="7e90d-324">To deploy the FixIt project to the new Azure environment, use the *AzureWebsite.ps1* script.</span></span> <span data-ttu-id="7e90d-325">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="7e90d-325">For example:</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample28.cmd)]

    <span data-ttu-id="7e90d-326">Quando a implantação é feita, o navegador é aberto com corrigi-lo em execução no Azure.</span><span class="sxs-lookup"><span data-stu-id="7e90d-326">When deployment is done, the browser opens with Fix It running in Azure.</span></span>

<a id="troubleshooting"></a>
## <a name="troubleshooting-the-windows-powershell-scripts"></a><span data-ttu-id="7e90d-327">Solucionando problemas de scripts do Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="7e90d-327">Troubleshooting the Windows PowerShell scripts</span></span>

<span data-ttu-id="7e90d-328">Os erros mais comuns encontrados durante a execução desses scripts estão relacionados às permissões.</span><span class="sxs-lookup"><span data-stu-id="7e90d-328">The most common errors encountered when running these scripts are related to permissions.</span></span> <span data-ttu-id="7e90d-329">Verifique se `Add-AzureAccount` e `Import-AzurePublishSettingsFile` foram bem-sucedidas e usado para a mesma assinatura do Azure.</span><span class="sxs-lookup"><span data-stu-id="7e90d-329">Make sure that `Add-AzureAccount` and `Import-AzurePublishSettingsFile` were successful and that you used them for the same Azure subscription.</span></span> <span data-ttu-id="7e90d-330">Mesmo se `Add-AzureAccount` foi bem-sucedida você precisará executá-lo novamente.</span><span class="sxs-lookup"><span data-stu-id="7e90d-330">Even if `Add-AzureAccount` was successful you might have to run it again.</span></span> <span data-ttu-id="7e90d-331">As permissões adicionadas por `Add-AzureAccount` expirar em 12 horas.</span><span class="sxs-lookup"><span data-stu-id="7e90d-331">The permissions added by `Add-AzureAccount` expire in 12 hours.</span></span>

### <a name="object-reference-not-set-to-an-instance-of-an-object"></a><span data-ttu-id="7e90d-332">Referência de objeto não definida para uma instância de um objeto.</span><span class="sxs-lookup"><span data-stu-id="7e90d-332">Object reference not set to an instance of an object.</span></span>

<span data-ttu-id="7e90d-333">Se o script retorna erros, como "Referência de objeto não definida para uma instância de um objeto," significando que o Windows PowerShell não é possível localizar um objeto de processo (essa é uma exceção de referência nula), execute o `Add-AzureAccount` cmdlet e repita o script.</span><span class="sxs-lookup"><span data-stu-id="7e90d-333">If the script returns errors, such as "Object reference not set to an instance of an object," which means that Windows PowerShell can't find an object to process (this is a null reference exception), run the `Add-AzureAccount` cmdlet and try the script again.</span></span>

[!code-console[Main](the-fix-it-sample-application/samples/sample29.cmd)]

### <a name="internalerror-the-server-encountered-an-internal-error"></a><span data-ttu-id="7e90d-334">InternalError: O servidor encontrou um erro interno.</span><span class="sxs-lookup"><span data-stu-id="7e90d-334">InternalError: The server encountered an internal error.</span></span>

<span data-ttu-id="7e90d-335">O `New-AzureWebsite` cmdlet retorna um erro interno quando o nome não é exclusivo no domínio azurewebsites.net.</span><span class="sxs-lookup"><span data-stu-id="7e90d-335">The `New-AzureWebsite` cmdlet returns an internal error when the name is not unique in the azurewebsites.net domain.</span></span> <span data-ttu-id="7e90d-336">Para resolver o erro, use um valor diferente para o nome, o que é o parâmetro Name do *AzureWebsiteEnv.ps1 novo*.</span><span class="sxs-lookup"><span data-stu-id="7e90d-336">To resolve the error, use a different value for the name, which is in the Name parameter of *New-AzureWebsiteEnv.ps1*.</span></span>

[!code-console[Main](the-fix-it-sample-application/samples/sample30.cmd)]

### <a name="restarting-the-script"></a><span data-ttu-id="7e90d-337">Reiniciar o script</span><span class="sxs-lookup"><span data-stu-id="7e90d-337">Restarting the script</span></span>

<span data-ttu-id="7e90d-338">Se você precisa reiniciar o *AzureWebsiteEnv.ps1 novo* script porque ele falhou antes que ele impresso a mensagem "O Script for concluído", você talvez queira excluir recursos que o script criado antes que ele é interrompido.</span><span class="sxs-lookup"><span data-stu-id="7e90d-338">If you need to restart the *New-AzureWebsiteEnv.ps1* script because it failed before it printed the "Script is complete" message, you might want to delete resources that the script created before it stopped.</span></span> <span data-ttu-id="7e90d-339">Por exemplo, se o script já criado o aplicativo web ContosoFixItDemo e executar o script novamente com o mesmo nome, o script falhará porque o nome está em uso.</span><span class="sxs-lookup"><span data-stu-id="7e90d-339">For example, if the script already created the ContosoFixItDemo web app and you run the script again with the same name, the script will fail because the name is in use.</span></span>

<span data-ttu-id="7e90d-340">Para determinar quais recursos o script criado antes de interrompido, use os seguintes cmdlets:</span><span class="sxs-lookup"><span data-stu-id="7e90d-340">To determine which resources the script created before it stopped, use the following cmdlets:</span></span>

- `Get-AzureWebsite`
- `Get-AzureSqlDatabaseServer`
- <span data-ttu-id="7e90d-341">`Get-AzureSqlDatabase`: Para executar esse cmdlet, redirecione o nome do servidor de banco de dados para `Get-AzureSqlDatabase`:</span><span class="sxs-lookup"><span data-stu-id="7e90d-341">`Get-AzureSqlDatabase`: To run this cmdlet, pipe the database server name to `Get-AzureSqlDatabase`:</span></span>  
    `Get-AzureSqlDatabaseServer | Get-AzureSqlDatabase.`

<span data-ttu-id="7e90d-342">Para excluir esses recursos, use os comandos a seguir.</span><span class="sxs-lookup"><span data-stu-id="7e90d-342">To delete these resources, use the following commands.</span></span> <span data-ttu-id="7e90d-343">Observe que se você excluir o servidor de banco de dados, você excluir automaticamente os bancos de dados associados ao servidor.</span><span class="sxs-lookup"><span data-stu-id="7e90d-343">Note that if you delete the database server, you automatically delete the databases associated with the server.</span></span>

- `Get-AzureWebsite -Name <WebsiteName> | Remove-AzureWebsite`
- `Get-AzureSqlDatabase -Name <DatabaseName> -ServerName <DatabaseServerName> | Remove-SqlAzureDatabase`
- `Get-AzureSqlDatabaseServer | Remove-AzureSqlDatabaseServer`

<a id="deployqueues"></a>
## <a name="how-to-deploy-the-app-with-queue-processing-to-azure-app-service-web-apps-and-an-azure-cloud-service"></a><span data-ttu-id="7e90d-344">Como implantar o aplicativo com a fila de processamento para aplicativos de Web do serviço de aplicativo do Azure e um serviço de nuvem do Azure</span><span class="sxs-lookup"><span data-stu-id="7e90d-344">How to deploy the app with queue processing to Azure App Service Web Apps and an Azure Cloud Service</span></span>

<span data-ttu-id="7e90d-345">Para habilitar as filas, faça a seguinte alteração no arquivo MyFixIt\Web.config.</span><span class="sxs-lookup"><span data-stu-id="7e90d-345">To enable queues, make the following change in the MyFixIt\Web.config file.</span></span> <span data-ttu-id="7e90d-346">Em `appSettings`, altere o valor de `UseQueues` como "true":</span><span class="sxs-lookup"><span data-stu-id="7e90d-346">Under `appSettings`, change the value of `UseQueues` to "true":</span></span> 

[!code-xml[Main](the-fix-it-sample-application/samples/sample31.xml)]

<span data-ttu-id="7e90d-347">Implantar o aplicativo MVC a um aplicativo web no serviço de aplicativo do Azure, conforme descrito [anterior](#deploybase).</span><span class="sxs-lookup"><span data-stu-id="7e90d-347">Then deploy the MVC application to an web app in Azure App Service, as described [earlier](#deploybase).</span></span>

<span data-ttu-id="7e90d-348">Em seguida, crie um novo serviço de nuvem do Azure.</span><span class="sxs-lookup"><span data-stu-id="7e90d-348">Next, create a new Azure cloud service.</span></span> <span data-ttu-id="7e90d-349">Os scripts incluídos com o aplicativo corrigir não criar ou implantar o serviço de nuvem, você deve usar o portal do Azure para isso.</span><span class="sxs-lookup"><span data-stu-id="7e90d-349">The scripts included with the Fix It app do not create or deploy the cloud service, so you must use Azure portal for this.</span></span> <span data-ttu-id="7e90d-350">No portal, clique em **novo** -- **de computação** – **serviço de nuvem** -- **criação rápida**e, em seguida, insira uma URL e um local de centro de dados.</span><span class="sxs-lookup"><span data-stu-id="7e90d-350">In the portal, click **New** -- **Compute** – **Cloud Service** -- **Quick Create**, and then enter a URL and a data center location.</span></span> <span data-ttu-id="7e90d-351">Use o mesmo data center onde você implantou o aplicativo web.</span><span class="sxs-lookup"><span data-stu-id="7e90d-351">Use the same data center where you deployed the web app.</span></span>

![](the-fix-it-sample-application/_static/image1.png)

<span data-ttu-id="7e90d-352">Antes de implantar o serviço de nuvem, você precisa atualizar alguns dos arquivos de configuração.</span><span class="sxs-lookup"><span data-stu-id="7e90d-352">Before you can deploy the cloud service, you need to update some of the configuration files.</span></span>

<span data-ttu-id="7e90d-353">Em MyFixIt.WorkerRoler\app.config, em `connectionStrings`, substitua o valor da `appdb` cadeia de caracteres de conexão com a cadeia de caracteres de conexão real do banco de dados SQL.</span><span class="sxs-lookup"><span data-stu-id="7e90d-353">In MyFixIt.WorkerRoler\app.config, under `connectionStrings`, replace the value of the `appdb` connection string with the actual connection string for the SQL Database.</span></span> <span data-ttu-id="7e90d-354">Você pode obter a cadeia de caracteres de conexão do portal.</span><span class="sxs-lookup"><span data-stu-id="7e90d-354">You can get the connection string from the portal.</span></span> <span data-ttu-id="7e90d-355">No portal, clique em **bancos de dados SQL** - **appdb** - **cadeias de caracteres de conexão de banco de dados do modo de exibição SQL para ADO .net, ODBC, PHP e JDBC**.</span><span class="sxs-lookup"><span data-stu-id="7e90d-355">In the portal, click **SQL Databases** - **appdb** - **View SQL Database connection strings for ADO .Net, ODBC, PHP, and JDBC**.</span></span> <span data-ttu-id="7e90d-356">Copie a cadeia de caracteres de conexão ADO.NET e cole o valor no arquivo App. config.</span><span class="sxs-lookup"><span data-stu-id="7e90d-356">Copy the ADO.NET connection string and paste the value into the app.config file.</span></span> <span data-ttu-id="7e90d-357">Substitua "{sua\_senha\_aqui}" com a senha do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="7e90d-357">Replace "{your\_password\_here}" with your database password.</span></span> <span data-ttu-id="7e90d-358">(Supondo que os scripts são usados para implantar o aplicativo MVC, você especificou a senha do banco de dados no `SqlDatabasePassword` parâmetro do script.)</span><span class="sxs-lookup"><span data-stu-id="7e90d-358">(Assuming you used the scripts to deploy the MVC app, you specified the database password in the `SqlDatabasePassword` script parameter.)</span></span>

<span data-ttu-id="7e90d-359">O resultado deve ser semelhante ao seguinte:</span><span class="sxs-lookup"><span data-stu-id="7e90d-359">The result should look like the following:</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample32.xml)]

<span data-ttu-id="7e90d-360">No mesmo arquivo MyFixIt.WorkerRoler\app.config, em `appSettings`, substitua os dois valores de espaço reservado para a conta de armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="7e90d-360">In the same MyFixIt.WorkerRoler\app.config file, under `appSettings`, replace the two placeholder values for the Azure storage account.</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample33.xml?highlight=2-3)]

<span data-ttu-id="7e90d-361">Você pode obter a chave de acesso a partir do portal.</span><span class="sxs-lookup"><span data-stu-id="7e90d-361">You can get the access key from the portal.</span></span> <span data-ttu-id="7e90d-362">Consulte [como gerenciar contas de armazenamento](https://docs.microsoft.com/azure/storage/common/storage-create-storage-account).</span><span class="sxs-lookup"><span data-stu-id="7e90d-362">See [How To Manage Storage Accounts](https://docs.microsoft.com/azure/storage/common/storage-create-storage-account).</span></span>

<span data-ttu-id="7e90d-363">No MyFixItCloudService\ServiceConfiguration.Cloud.cscfg, substitua os mesmos dois valores de espaços reservados para a conta de armazenamento do Azure.</span><span class="sxs-lookup"><span data-stu-id="7e90d-363">In MyFixItCloudService\ServiceConfiguration.Cloud.cscfg, replace the same two placeholders values for the Azure storage account.</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample34.xml?highlight=3)]

<span data-ttu-id="7e90d-364">Agora você está pronto para implantar o serviço de nuvem.</span><span class="sxs-lookup"><span data-stu-id="7e90d-364">Now you are ready to deploy the cloud service.</span></span> <span data-ttu-id="7e90d-365">No Gerenciador de soluções, clique com botão direito no projeto MyFixItCloudService e selecione **publicar**.</span><span class="sxs-lookup"><span data-stu-id="7e90d-365">In Solution Explore, right-click the MyFixItCloudService project and select **Publish**.</span></span> <span data-ttu-id="7e90d-366">Para obter mais informações, consulte "[implantar o aplicativo no Azure](https://www.windowsazure.com/develop/net/tutorials/multi-tier-web-site/2-download-and-run/#deployAz)", que está na parte 2 de [este tutorial](https://code.msdn.microsoft.com/Windows-Azure-Multi-Tier-eadceb36).</span><span class="sxs-lookup"><span data-stu-id="7e90d-366">For more information, see "[Deploy the Application to Azure](https://www.windowsazure.com/develop/net/tutorials/multi-tier-web-site/2-download-and-run/#deployAz)", which is in part 2 of [this tutorial](https://code.msdn.microsoft.com/Windows-Azure-Multi-Tier-eadceb36).</span></span>

>[!div class="step-by-step"]
[<span data-ttu-id="7e90d-367">Anterior</span><span class="sxs-lookup"><span data-stu-id="7e90d-367">Previous</span></span>](more-patterns-and-guidance.md)
