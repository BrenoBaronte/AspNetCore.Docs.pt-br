---
uid: web-forms/overview/data-access/introduction/creating-a-business-logic-layer-cs
title: Criando uma camada de lógica de negócios (c#) | Microsoft Docs
author: rick-anderson
description: Neste tutorial, veremos como centralizar as regras de negócio em um negócio lógica BLL (camada) que serve como um intermediário para troca de dados entre t...
ms.author: aspnetcontent
manager: wpickett
ms.date: 03/31/2010
ms.topic: article
ms.assetid: 85554606-47cb-4e4f-9848-eed9da579056
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/introduction/creating-a-business-logic-layer-cs
msc.type: authoredcontent
ms.openlocfilehash: 6e73e9e68e4abb0d382baa7da925c167809e417a
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/06/2018
ms.locfileid: "30886934"
---
<a name="creating-a-business-logic-layer-c"></a><span data-ttu-id="1e0c6-103">Criando uma camada de lógica de negócios (c#)</span><span class="sxs-lookup"><span data-stu-id="1e0c6-103">Creating a Business Logic Layer (C#)</span></span>
====================
<span data-ttu-id="1e0c6-104">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="1e0c6-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="1e0c6-105">[Baixe o aplicativo de exemplo](http://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_2_CS.exe) ou [baixar PDF](creating-a-business-logic-layer-cs/_static/datatutorial02cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="1e0c6-105">[Download Sample App](http://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_2_CS.exe) or [Download PDF](creating-a-business-logic-layer-cs/_static/datatutorial02cs1.pdf)</span></span>

> <span data-ttu-id="1e0c6-106">Neste tutorial, veremos como centralizar as regras de negócio em um negócio lógica BLL (camada) que serve como um intermediário para troca de dados entre a camada de apresentação e a DAL.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-106">In this tutorial we'll see how to centralize your business rules into a Business Logic Layer (BLL) that serves as an intermediary for data exchange between the presentation layer and the DAL.</span></span>


## <a name="introduction"></a><span data-ttu-id="1e0c6-107">Introdução</span><span class="sxs-lookup"><span data-stu-id="1e0c6-107">Introduction</span></span>

<span data-ttu-id="1e0c6-108">A camada de acesso de dados (DAL) criado na [primeiro tutorial](creating-a-data-access-layer-cs.md) separa corretamente os dados de acessar a lógica da lógica de apresentação.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-108">The Data Access Layer (DAL) created in the [first tutorial](creating-a-data-access-layer-cs.md) cleanly separates the data access logic from the presentation logic.</span></span> <span data-ttu-id="1e0c6-109">No entanto, enquanto a DAL separa claramente os detalhes de acesso de dados da camada de apresentação, ele não impõe quaisquer regras de negócios que podem ser aplicadas.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-109">However, while the DAL cleanly separates the data access details from the presentation layer, it does not enforce any business rules that may apply.</span></span> <span data-ttu-id="1e0c6-110">Por exemplo, para nosso aplicativo podemos querer impedir o `CategoryID` ou `SupplierID` campos do `Products` tabela a ser modificada quando o `Discontinued` campo é definido como 1, ou podem ser impor regras de precedência, proibindo situações nas quais um funcionário é gerenciado por alguém que foi contratado depois deles.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-110">For example, for our application we may want to disallow the `CategoryID` or `SupplierID` fields of the `Products` table to be modified when the `Discontinued` field is set to 1, or we might want to enforce seniority rules, prohibiting situations in which an employee is managed by someone who was hired after them.</span></span> <span data-ttu-id="1e0c6-111">Outro cenário comum é talvez somente os usuários de autorização em uma função específica podem excluir produtos ou podem alterar o `UnitPrice` valor.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-111">Another common scenario is authorization perhaps only users in a particular role can delete products or can change the `UnitPrice` value.</span></span>

<span data-ttu-id="1e0c6-112">Neste tutorial, veremos como centralizar essas regras de negócio em um negócio lógica BLL (camada) que serve como um intermediário para troca de dados entre a camada de apresentação e a DAL.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-112">In this tutorial we'll see how to centralize these business rules into a Business Logic Layer (BLL) that serves as an intermediary for data exchange between the presentation layer and the DAL.</span></span> <span data-ttu-id="1e0c6-113">Em um aplicativo do mundo real, BLL deve ser implementada como um projeto de biblioteca de classes separado; No entanto, para esses tutoriais implementaremos BLL como uma série de classes em nosso `App_Code` pasta para simplificar a estrutura do projeto.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-113">In a real-world application, the BLL should be implemented as a separate Class Library project; however, for these tutorials we'll implement the BLL as a series of classes in our `App_Code` folder in order to simplify the project structure.</span></span> <span data-ttu-id="1e0c6-114">A Figura 1 ilustra as relações de arquitetura entre a camada de apresentação, BLL e DAL.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-114">Figure 1 illustrates the architectural relationships among the presentation layer, BLL, and DAL.</span></span>


![BLL separa a camada de apresentação da camada de acesso a dados e impõe regras de negócio](creating-a-business-logic-layer-cs/_static/image1.png)

<span data-ttu-id="1e0c6-116">**Figura 1**: BLL separa a camada de apresentação da camada de acesso a dados e impõe regras de negócio</span><span class="sxs-lookup"><span data-stu-id="1e0c6-116">**Figure 1**: The BLL Separates the Presentation Layer from the Data Access Layer and Imposes Business Rules</span></span>


## <a name="step-1-creating-the-bll-classes"></a><span data-ttu-id="1e0c6-117">Etapa 1: Criando Classes BLL</span><span class="sxs-lookup"><span data-stu-id="1e0c6-117">Step 1: Creating the BLL Classes</span></span>

<span data-ttu-id="1e0c6-118">Nosso BLL será ser composto de quatro classes, uma para cada TableAdapter no DAL; cada uma dessas classes BLL terá métodos para recuperar, inserindo, atualizando e excluindo do respectivo TableAdapter no DAL, aplicando as regras de negócio apropriado.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-118">Our BLL will be composed of four classes, one for each TableAdapter in the DAL; each of these BLL classes will have methods for retrieving, inserting, updating, and deleting from the respective TableAdapter in the DAL, applying the appropriate business rules.</span></span>

<span data-ttu-id="1e0c6-119">Para mais corretamente, separar as classes relacionadas a DAL e BLL, vamos criar duas subpastas no `App_Code` pasta `DAL` e `BLL`.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-119">To more cleanly separate the DAL- and BLL-related classes, let's create two subfolders in the `App_Code` folder, `DAL` and `BLL`.</span></span> <span data-ttu-id="1e0c6-120">Simplesmente clique duas vezes no `App_Code` pasta no Gerenciador de soluções e escolha a nova pasta.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-120">Simply right-click on the `App_Code` folder in the Solution Explorer and choose New Folder.</span></span> <span data-ttu-id="1e0c6-121">Depois de criar essas duas pastas, mover o conjunto de dados tipado criado no primeiro tutorial para o `DAL` subpasta.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-121">After creating these two folders, move the Typed DataSet created in the first tutorial into the `DAL` subfolder.</span></span>

<span data-ttu-id="1e0c6-122">Em seguida, crie os quatro arquivos de classe BLL no `BLL` subpasta.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-122">Next, create the four BLL class files in the `BLL` subfolder.</span></span> <span data-ttu-id="1e0c6-123">Para fazer isso, clique duas vezes no `BLL` subpasta, escolha Adicionar um novo Item e escolha o modelo de classe.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-123">To accomplish this, right-click on the `BLL` subfolder, choose Add a New Item, and choose the Class template.</span></span> <span data-ttu-id="1e0c6-124">Nome de quatro classes `ProductsBLL`, `CategoriesBLL`, `SuppliersBLL`, e `EmployeesBLL`.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-124">Name the four classes `ProductsBLL`, `CategoriesBLL`, `SuppliersBLL`, and `EmployeesBLL`.</span></span>


![Adicionar quatro novas Classes para a pasta App_Code](creating-a-business-logic-layer-cs/_static/image2.png)

<span data-ttu-id="1e0c6-126">**Figura 2**: adicionar quatro novas Classes para o `App_Code` pasta</span><span class="sxs-lookup"><span data-stu-id="1e0c6-126">**Figure 2**: Add Four New Classes to the `App_Code` Folder</span></span>


<span data-ttu-id="1e0c6-127">Em seguida, vamos adicionar métodos para cada uma das classes para incluir apenas os métodos definidos para os TableAdapters do primeiro tutorial.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-127">Next, let's add methods to each of the classes to simply wrap the methods defined for the TableAdapters from the first tutorial.</span></span> <span data-ttu-id="1e0c6-128">Agora, esses métodos apenas chamará diretamente a DAL; retornaremos posteriormente para adicionar qualquer lógica de negócios necessários.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-128">For now, these methods will just call directly into the DAL; we'll return later to add any needed business logic.</span></span>

> [!NOTE]
> <span data-ttu-id="1e0c6-129">Se você estiver usando o Visual Studio Standard Edition ou superior (ou seja, você está *não* usando o Visual Web Developer), opcionalmente, você pode criar suas classes visualmente usando o [Designer de classe](https://msdn.microsoft.com/library/default.asp?url=/library/dv_vstechart/html/clssdsgnr.asp).</span><span class="sxs-lookup"><span data-stu-id="1e0c6-129">If you are using Visual Studio Standard Edition or above (that is, you're *not* using Visual Web Developer), you can optionally design your classes visually using the [Class Designer](https://msdn.microsoft.com/library/default.asp?url=/library/dv_vstechart/html/clssdsgnr.asp).</span></span> <span data-ttu-id="1e0c6-130">Consulte o [Blog do Designer de classe](https://blogs.msdn.com/classdesigner/default.aspx) para obter mais informações sobre esse novo recurso no Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-130">Refer to the [Class Designer Blog](https://blogs.msdn.com/classdesigner/default.aspx) for more information on this new feature in Visual Studio.</span></span>


<span data-ttu-id="1e0c6-131">Para o `ProductsBLL` que precisamos adicionar um total de sete métodos de classe:</span><span class="sxs-lookup"><span data-stu-id="1e0c6-131">For the `ProductsBLL` class we need to add a total of seven methods:</span></span>

- <span data-ttu-id="1e0c6-132">`GetProducts()` Retorna todos os produtos</span><span class="sxs-lookup"><span data-stu-id="1e0c6-132">`GetProducts()` returns all products</span></span>
- <span data-ttu-id="1e0c6-133">`GetProductByProductID(productID)` Retorna o produto com a identificação de produto especificada</span><span class="sxs-lookup"><span data-stu-id="1e0c6-133">`GetProductByProductID(productID)` returns the product with the specified product ID</span></span>
- <span data-ttu-id="1e0c6-134">`GetProductsByCategoryID(categoryID)` Retorna todos os produtos na categoria especificada</span><span class="sxs-lookup"><span data-stu-id="1e0c6-134">`GetProductsByCategoryID(categoryID)` returns all products from the specified category</span></span>
- <span data-ttu-id="1e0c6-135">`GetProductsBySupplier(supplierID)` Retorna todos os produtos do fornecedor especificado</span><span class="sxs-lookup"><span data-stu-id="1e0c6-135">`GetProductsBySupplier(supplierID)` returns all products from the specified supplier</span></span>
- <span data-ttu-id="1e0c6-136">`AddProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued)` Insere um novo produto no banco de dados usando os valores passados-in; Retorna o `ProductID` valor do registro recém-inserido</span><span class="sxs-lookup"><span data-stu-id="1e0c6-136">`AddProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued)` inserts a new product into the database using the values passed-in; returns the `ProductID` value of the newly inserted record</span></span>
- <span data-ttu-id="1e0c6-137">`UpdateProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued, productID)` atualiza um produto existente no banco de dados usando os valores passados. Retorna `true` se exatamente uma linha foi atualizada, `false` contrário</span><span class="sxs-lookup"><span data-stu-id="1e0c6-137">`UpdateProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued, productID)` updates an existing product in the database using the passed-in values; returns `true` if precisely one row was updated, `false` otherwise</span></span>
- <span data-ttu-id="1e0c6-138">`DeleteProduct(productID)` Exclui o produto especificado do banco de dados</span><span class="sxs-lookup"><span data-stu-id="1e0c6-138">`DeleteProduct(productID)` deletes the specified product from the database</span></span>

<span data-ttu-id="1e0c6-139">ProductsBLL.cs</span><span class="sxs-lookup"><span data-stu-id="1e0c6-139">ProductsBLL.cs</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample1.cs)]

<span data-ttu-id="1e0c6-140">Os métodos que simplesmente retornam dados `GetProducts`, `GetProductByProductID`, `GetProductsByCategoryID`, e `GetProductBySuppliersID` são bem simples, como eles simplesmente chamam para baixo para a DAL.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-140">The methods that simply return data `GetProducts`, `GetProductByProductID`, `GetProductsByCategoryID`, and `GetProductBySuppliersID` are fairly straightforward as they simply call down into the DAL.</span></span> <span data-ttu-id="1e0c6-141">Embora em alguns cenários pode haver regras de negócios que precisam ser implementados nesse nível (por exemplo, regras de autorização com base no usuário conectado no momento ou a função à qual o usuário pertence), vamos simplesmente deixar esses métodos como-é.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-141">While in some scenarios there may be business rules that need to be implemented at this level (such as authorization rules based on the currently logged on user or the role to which the user belongs), we'll simply leave these methods as-is.</span></span> <span data-ttu-id="1e0c6-142">Para esses métodos, em seguida, BLL serve simplesmente como um proxy por meio do qual a camada de apresentação acessa os dados subjacentes de camada de acesso a dados.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-142">For these methods, then, the BLL serves merely as a proxy through which the presentation layer accesses the underlying data from the Data Access Layer.</span></span>

<span data-ttu-id="1e0c6-143">O `AddProduct` e `UpdateProduct` métodos tanto levar em como parâmetros de valores para os vários campos de produto e adicionar um novo produto ou atualizar uma existente, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-143">The `AddProduct` and `UpdateProduct` methods both take in as parameters the values for the various product fields and add a new product or update an existing one, respectively.</span></span> <span data-ttu-id="1e0c6-144">Já que muitas o `Product` colunas da tabela podem aceitar `NULL` valores (`CategoryID`, `SupplierID`, e `UnitPrice`, entre outros), os parâmetros de entrada `AddProduct` e `UpdateProduct` que são mapeados para esse uso de colunas [tipos anuláveis](https://msdn.microsoft.com/library/1t3y8s4s(v=vs.80).aspx).</span><span class="sxs-lookup"><span data-stu-id="1e0c6-144">Since many of the `Product` table's columns can accept `NULL` values (`CategoryID`, `SupplierID`, and `UnitPrice`, to name a few), those input parameters for `AddProduct` and `UpdateProduct` that map to such columns use [nullable types](https://msdn.microsoft.com/library/1t3y8s4s(v=vs.80).aspx).</span></span> <span data-ttu-id="1e0c6-145">Tipos anuláveis são novos para o .NET 2.0 e fornecer uma técnica para que indica se um tipo de valor deve, em vez disso, ser `null`.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-145">Nullable types are new to .NET 2.0 and provide a technique for indicating whether a value type should, instead, be `null`.</span></span> <span data-ttu-id="1e0c6-146">No c# pode sinalizar um tipo de valor como um tipo anulável adicionando `?` após o tipo (como `int? x;`).</span><span class="sxs-lookup"><span data-stu-id="1e0c6-146">In C# you can flag a value type as a nullable type by adding `?` after the type (like `int? x;`).</span></span> <span data-ttu-id="1e0c6-147">Consulte o [tipos anuláveis](https://msdn.microsoft.com/library/1t3y8s4s.aspx) seção o [guia de programação em c#](https://msdn.microsoft.com/library/67ef8sbd%28VS.80%29.aspx) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-147">Refer to the [Nullable Types](https://msdn.microsoft.com/library/1t3y8s4s.aspx) section in the [C# Programming Guide](https://msdn.microsoft.com/library/67ef8sbd%28VS.80%29.aspx) for more information.</span></span>

<span data-ttu-id="1e0c6-148">Todos os três métodos retornam um valor booliano que indica se uma linha foi inserida, atualizada ou excluída desde que a operação não pode resultar em uma linha afetada.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-148">All three methods return a Boolean value indicating whether a row was inserted, updated, or deleted since the operation may not result in an affected row.</span></span> <span data-ttu-id="1e0c6-149">Por exemplo, se o desenvolvedor de página chama `DeleteProduct` passando um `ProductID` para um produto inexistente, o `DELETE` instrução emitida para o banco de dados não terá nenhum efeito e, portanto, o `DeleteProduct` método retornará `false`.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-149">For example, if the page developer calls `DeleteProduct` passing in a `ProductID` for a non-existent product, the `DELETE` statement issued to the database will have no affect and therefore the `DeleteProduct` method will return `false`.</span></span>

<span data-ttu-id="1e0c6-150">Observe que ao adicionar um novo produto ou atualizando uma existente faremos em valores de campo do produto novos ou modificados como uma lista de escalares em vez de aceitar um `ProductsRow` instância.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-150">Note that when adding a new product or updating an existing one we take in the new or modified product's field values as a list of scalars as opposed to accepting a `ProductsRow` instance.</span></span> <span data-ttu-id="1e0c6-151">Essa abordagem foi escolhida porque a `ProductsRow` classe deriva ADO.NET `DataRow` classe, que não tem um construtor sem parâmetros padrão.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-151">This approach was chosen because the `ProductsRow` class derives from the ADO.NET `DataRow` class, which doesn't have a default parameterless constructor.</span></span> <span data-ttu-id="1e0c6-152">Para criar um novo `ProductsRow` instância, é necessário criar primeiro uma `ProductsDataTable` de instância e, em seguida, invocar seus `NewProductRow()` método (que fazemos em `AddProduct`).</span><span class="sxs-lookup"><span data-stu-id="1e0c6-152">In order to create a new `ProductsRow` instance, we must first create a `ProductsDataTable` instance and then invoke its `NewProductRow()` method (which we do in `AddProduct`).</span></span> <span data-ttu-id="1e0c6-153">Este empecilho rears seu cabeçalho quando desativamos para inserir e atualizar produtos usando o ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-153">This shortcoming rears its head when we turn to inserting and updating products using the ObjectDataSource.</span></span> <span data-ttu-id="1e0c6-154">Em resumo, o ObjectDataSource tentará criar uma instância dos parâmetros de entrada.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-154">In short, the ObjectDataSource will try to create an instance of the input parameters.</span></span> <span data-ttu-id="1e0c6-155">Se o método BLL espera um `ProductsRow` instância, ObjectDataSource tentará criá-lo, mas falhar devido à falta de um construtor sem parâmetros padrão.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-155">If the BLL method expects a `ProductsRow` instance, the ObjectDataSource will try to create one, but fail due to the lack of a default parameterless constructor.</span></span> <span data-ttu-id="1e0c6-156">Para obter mais informações sobre esse problema, consulte as seguintes duas postagens de fóruns do ASP.NET: [ObjectDataSources atualizando com conjuntos de dados fortemente definida](https://forums.asp.net/1098630/ShowPost.aspx), e [problema com ObjectDataSource e conjunto de dados fortemente definida](https://forums.asp.net/1048212/ShowPost.aspx).</span><span class="sxs-lookup"><span data-stu-id="1e0c6-156">For more information on this problem, refer to the following two ASP.NET Forums posts: [Updating ObjectDataSources with Strongly-Typed DataSets](https://forums.asp.net/1098630/ShowPost.aspx), and [Problem With ObjectDataSource and Strongly-Typed DataSet](https://forums.asp.net/1048212/ShowPost.aspx).</span></span>

<span data-ttu-id="1e0c6-157">Em seguida, em ambos os `AddProduct` e `UpdateProduct`, o código cria um `ProductsRow` de instância e o preenche com os valores passados apenas no.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-157">Next, in both `AddProduct` and `UpdateProduct`, the code creates a `ProductsRow` instance and populates it with the values just passed in.</span></span> <span data-ttu-id="1e0c6-158">Ao atribuir valores às colunas de dados de um DataRow podem ocorrer várias verificações de validação de nível de campo.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-158">When assigning values to DataColumns of a DataRow various field-level validation checks can occur.</span></span> <span data-ttu-id="1e0c6-159">Portanto, manualmente colocar os valores passados de volta em um DataRow ajuda a garantir a validade dos dados que está sendo passados para o método BLL.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-159">Therefore, manually putting the passed in values back into a DataRow helps ensure the validity of the data being passed to the BLL method.</span></span> <span data-ttu-id="1e0c6-160">Infelizmente as classes de DataRow fortemente tipado geradas pelo Visual Studio não usam tipos anuláveis.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-160">Unfortunately the strongly-typed DataRow classes generated by Visual Studio do not use nullable types.</span></span> <span data-ttu-id="1e0c6-161">Em vez disso, para indicar que uma coluna de dados específica em um DataRow deve corresponder a um `NULL` banco de dados valor, deve usar o `SetColumnNameNull()` método.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-161">Rather, to indicate that a particular DataColumn in a DataRow should correspond to a `NULL` database value we must use the `SetColumnNameNull()` method.</span></span>

<span data-ttu-id="1e0c6-162">Em `UpdateProduct` carregamos primeiro no produto para atualizar usando `GetProductByProductID(productID)`.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-162">In `UpdateProduct` we first load in the product to update using `GetProductByProductID(productID)`.</span></span> <span data-ttu-id="1e0c6-163">Embora isso possa parecer uma viagem desnecessária ao banco de dados, esse processamento extra comprove vale a pena em tutoriais futuros que exploram a simultaneidade otimista.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-163">While this may seem like an unnecessary trip to the database, this extra trip will prove worthwhile in future tutorials that explore optimistic concurrency.</span></span> <span data-ttu-id="1e0c6-164">Simultaneidade otimista é uma técnica para garantir que dois usuários que estão trabalhando simultaneamente nos mesmos dados acidentalmente não substitua as alterações uma da outra.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-164">Optimistic concurrency is a technique to ensure that two users who are simultaneously working on the same data don't accidentally overwrite one another's changes.</span></span> <span data-ttu-id="1e0c6-165">Captura de todo o registro também torna mais fácil criar métodos de atualização na BLL que modificam somente um subconjunto de colunas do DataRow.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-165">Grabbing the entire record also makes it easier to create update methods in the BLL that only modify a subset of the DataRow's columns.</span></span> <span data-ttu-id="1e0c6-166">Quando vamos explorar o `SuppliersBLL` veremos um exemplo de classe.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-166">When we explore the `SuppliersBLL` class we'll see such an example.</span></span>

<span data-ttu-id="1e0c6-167">Observe que, por fim, o `ProductsBLL` classe tem o [atributo DataObject](https://msdn.microsoft.com/library/system.componentmodel.dataobjectattribute.aspx) aplicada a ele (a `[System.ComponentModel.DataObject]` sintaxe antes da instrução de classe na parte superior do arquivo) e os métodos têm [ Atributos de DataObjectMethodAttribute](https://msdn.microsoft.com/library/system.componentmodel.dataobjectmethodattribute.aspx).</span><span class="sxs-lookup"><span data-stu-id="1e0c6-167">Finally, note that the `ProductsBLL` class has the [DataObject attribute](https://msdn.microsoft.com/library/system.componentmodel.dataobjectattribute.aspx) applied to it (the `[System.ComponentModel.DataObject]` syntax right before the class statement near the top of the file) and the methods have [DataObjectMethodAttribute attributes](https://msdn.microsoft.com/library/system.componentmodel.dataobjectmethodattribute.aspx).</span></span> <span data-ttu-id="1e0c6-168">O `DataObject` atributo marcar a classe como sendo um objeto adequado para associação a um [controle ObjectDataSource](https://msdn.microsoft.com/library/9a4kyhcx.aspx), enquanto o `DataObjectMethodAttribute` indica a finalidade do método.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-168">The `DataObject` attribute marks the class as being an object suitable for binding to an [ObjectDataSource control](https://msdn.microsoft.com/library/9a4kyhcx.aspx), whereas the `DataObjectMethodAttribute` indicates the purpose of the method.</span></span> <span data-ttu-id="1e0c6-169">Como veremos no futuro tutoriais, ObjectDataSource do ASP.NET 2.0 torna fácil declarativamente acessar dados de uma classe.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-169">As we'll see in future tutorials, ASP.NET 2.0's ObjectDataSource makes it easy to declaratively access data from a class.</span></span> <span data-ttu-id="1e0c6-170">Para ajudar a filtrar a lista de possíveis classes para associar ao Assistente do ObjectDataSource, por padrão, somente as classes marcadas como `DataObjects` são mostrados na lista suspensa do assistente.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-170">To help filter the list of possible classes to bind to in the ObjectDataSource's wizard, by default only those classes marked as `DataObjects` are shown in the wizard's drop-down list.</span></span> <span data-ttu-id="1e0c6-171">O `ProductsBLL` classe funcione tão bem sem esses atributos, mas adicioná-los torna mais fácil o trabalho com o Assistente do ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-171">The `ProductsBLL` class will work just as well without these attributes, but adding them makes it easier to work with in the ObjectDataSource's wizard.</span></span>

## <a name="adding-the-other-classes"></a><span data-ttu-id="1e0c6-172">Adicionando as outras Classes</span><span class="sxs-lookup"><span data-stu-id="1e0c6-172">Adding the Other Classes</span></span>

<span data-ttu-id="1e0c6-173">Com o `ProductsBLL` classe completa, ainda precisamos adicionar as classes para trabalhar com categorias, fornecedores e funcionários.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-173">With the `ProductsBLL` class complete, we still need to add the classes for working with categories, suppliers, and employees.</span></span> <span data-ttu-id="1e0c6-174">Reserve um tempo para criar as seguintes classes e métodos com os conceitos do exemplo acima:</span><span class="sxs-lookup"><span data-stu-id="1e0c6-174">Take a moment to create the following classes and methods using the concepts from the example above:</span></span>

- <span data-ttu-id="1e0c6-175">**CategoriesBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="1e0c6-175">**CategoriesBLL.cs**</span></span>

    - `GetCategories()`
    - `GetCategoryByCategoryID(categoryID)`
- <span data-ttu-id="1e0c6-176">**SuppliersBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="1e0c6-176">**SuppliersBLL.cs**</span></span>

    - `GetSuppliers()`
    - `GetSupplierBySupplierID(supplierID)`
    - `GetSuppliersByCountry(country)`
    - `UpdateSupplierAddress(supplierID, address, city, country)`
- <span data-ttu-id="1e0c6-177">**EmployeesBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="1e0c6-177">**EmployeesBLL.cs**</span></span>

    - `GetEmployees()`
    - `GetEmployeeByEmployeeID(employeeID)`
    - `GetEmployeesByManager(managerID)`

<span data-ttu-id="1e0c6-178">É o único método vale a pena observar o `SuppliersBLL` da classe `UpdateSupplierAddress` método.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-178">The one method worth noting is the `SuppliersBLL` class's `UpdateSupplierAddress` method.</span></span> <span data-ttu-id="1e0c6-179">Esse método fornece uma interface para atualizar apenas as informações de endereço do fornecedor.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-179">This method provides an interface for updating just the supplier's address information.</span></span> <span data-ttu-id="1e0c6-180">Internamente, esse método lê a `SupplierDataRow` objeto especificado `supplierID` (usando `GetSupplierBySupplierID`), define suas propriedades de endereço e, em seguida, chama para baixo o `SupplierDataTable`do `Update` método.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-180">Internally, this method reads in the `SupplierDataRow` object for the specified `supplierID` (using `GetSupplierBySupplierID`), sets its address-related properties, and then calls down into the `SupplierDataTable`'s `Update` method.</span></span> <span data-ttu-id="1e0c6-181">O `UpdateSupplierAddress` método segue:</span><span class="sxs-lookup"><span data-stu-id="1e0c6-181">The `UpdateSupplierAddress` method follows:</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample2.cs)]

<span data-ttu-id="1e0c6-182">Consulte o download deste artigo para minha implementação completa das classes BLL.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-182">Refer to this article's download for my complete implementation of the BLL classes.</span></span>

## <a name="step-2-accessing-the-typed-datasets-through-the-bll-classes"></a><span data-ttu-id="1e0c6-183">Etapa 2: Acessando os DataSets tipados pelas Classes BLL</span><span class="sxs-lookup"><span data-stu-id="1e0c6-183">Step 2: Accessing the Typed DataSets Through the BLL Classes</span></span>

<span data-ttu-id="1e0c6-184">No primeiro tutorial vimos exemplos de como trabalhar diretamente com o conjunto de dados tipado programaticamente, mas com a adição do nosso classes BLL, a camada de apresentação deve funcionar em relação a BLL em vez disso.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-184">In the first tutorial we saw examples of working directly with the Typed DataSet programmatically, but with the addition of our BLL classes, the presentation tier should work against the BLL instead.</span></span> <span data-ttu-id="1e0c6-185">No `AllProducts.aspx` exemplo do primeiro tutorial, o `ProductsTableAdapter` foi usado para associar a lista de produtos para um GridView, conforme mostrado no código a seguir:</span><span class="sxs-lookup"><span data-stu-id="1e0c6-185">In the `AllProducts.aspx` example from the first tutorial, the `ProductsTableAdapter` was used to bind the list of products to a GridView, as shown in the following code:</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample3.cs)]

<span data-ttu-id="1e0c6-186">Para usar o novo BLL classes, tudo o que precisa ser modificada é a primeira linha do código simplesmente substituir o `ProductsTableAdapter` do objeto com um `ProductBLL` objeto:</span><span class="sxs-lookup"><span data-stu-id="1e0c6-186">To use the new BLL classes, all that needs to be changed is the first line of code simply replace the `ProductsTableAdapter` object with a `ProductBLL` object:</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample4.cs)]

<span data-ttu-id="1e0c6-187">As classes BLL também podem ser acessadas declarativamente (como o conjunto de dados tipado) usando o ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-187">The BLL classes can also be accessed declaratively (as can the Typed DataSet) by using the ObjectDataSource.</span></span> <span data-ttu-id="1e0c6-188">Que discutiremos ObjectDataSource mais detalhadamente nos tutoriais a seguir.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-188">We'll be discussing the ObjectDataSource in greater detail in the following tutorials.</span></span>


<span data-ttu-id="1e0c6-189">[![A lista de produtos é exibida em um GridView](creating-a-business-logic-layer-cs/_static/image4.png)](creating-a-business-logic-layer-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="1e0c6-189">[![The List of Products is Displayed in a GridView](creating-a-business-logic-layer-cs/_static/image4.png)](creating-a-business-logic-layer-cs/_static/image3.png)</span></span>

<span data-ttu-id="1e0c6-190">**Figura 3**: A lista de produtos é exibida em um controle GridView ([clique para exibir a imagem em tamanho normal](creating-a-business-logic-layer-cs/_static/image5.png))</span><span class="sxs-lookup"><span data-stu-id="1e0c6-190">**Figure 3**: The List of Products is Displayed in a GridView ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image5.png))</span></span>


## <a name="step-3-adding-field-level-validation-to-the-datarow-classes"></a><span data-ttu-id="1e0c6-191">Etapa 3: Adicionando validação de nível de campo para as Classes de DataRow</span><span class="sxs-lookup"><span data-stu-id="1e0c6-191">Step 3: Adding Field-Level Validation to the DataRow Classes</span></span>

<span data-ttu-id="1e0c6-192">Validação de nível de campo são as verificações que pertence aos valores de propriedade dos objetos de negócios ao inserir ou atualizar.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-192">Field-level validation are checks that pertains to the property values of the business objects when inserting or updating.</span></span> <span data-ttu-id="1e0c6-193">Algumas regras de validação de nível de campo para os produtos incluem:</span><span class="sxs-lookup"><span data-stu-id="1e0c6-193">Some field-level validation rules for products include:</span></span>

- <span data-ttu-id="1e0c6-194">O `ProductName` campo deve ser 40 caracteres ou menos</span><span class="sxs-lookup"><span data-stu-id="1e0c6-194">The `ProductName` field must be 40 characters or less in length</span></span>
- <span data-ttu-id="1e0c6-195">O `QuantityPerUnit` campo deve ser 20 caracteres ou menos</span><span class="sxs-lookup"><span data-stu-id="1e0c6-195">The `QuantityPerUnit` field must be 20 characters or less in length</span></span>
- <span data-ttu-id="1e0c6-196">O `ProductID`, `ProductName`, e `Discontinued` campos são necessários, mas todos os outros campos são opcionais</span><span class="sxs-lookup"><span data-stu-id="1e0c6-196">The `ProductID`, `ProductName`, and `Discontinued` fields are required, but all other fields are optional</span></span>
- <span data-ttu-id="1e0c6-197">O `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, e `ReorderLevel` campos devem ser maior que ou igual a zero</span><span class="sxs-lookup"><span data-stu-id="1e0c6-197">The `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, and `ReorderLevel` fields must be greater than or equal to zero</span></span>

<span data-ttu-id="1e0c6-198">Essas regras podem e devem ser expressos no nível do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-198">These rules can and should be expressed at the database level.</span></span> <span data-ttu-id="1e0c6-199">O limite de caracteres no `ProductName` e `QuantityPerUnit` campos são capturados pelos tipos de dados das colunas no `Products` tabela (`nvarchar(40)` e `nvarchar(20)`, respectivamente).</span><span class="sxs-lookup"><span data-stu-id="1e0c6-199">The character limit on the `ProductName` and `QuantityPerUnit` fields are captured by the data types of those columns in the `Products` table (`nvarchar(40)` and `nvarchar(20)`, respectively).</span></span> <span data-ttu-id="1e0c6-200">Se os campos são obrigatórios e opcionais são expressos por se a coluna de tabela de banco de dados permite `NULL` s.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-200">Whether fields are required and optional are expressed by if the database table column allows `NULL` s.</span></span> <span data-ttu-id="1e0c6-201">Quatro [restrições de verificação](https://msdn.microsoft.com/library/ms188258.aspx) existe que certifique-se de que somente valores maiores que ou iguais a zero podem fazer no `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, ou `ReorderLevel` colunas.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-201">Four [check constraints](https://msdn.microsoft.com/library/ms188258.aspx) exist that ensure that only values greater than or equal to zero can make it into the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, or `ReorderLevel` columns.</span></span>

<span data-ttu-id="1e0c6-202">Além de aplicar essas regras no banco de dados que eles também devem ser impostos no nível do conjunto de dados.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-202">In addition to enforcing these rules at the database they should also be enforced at the DataSet level.</span></span> <span data-ttu-id="1e0c6-203">Na verdade, o tamanho do campo e se um valor é obrigatório ou opcional já são capturados para o conjunto de cada tabela de dados de colunas de dados.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-203">In fact, the field length and whether a value is required or optional are already captured for each DataTable's set of DataColumns.</span></span> <span data-ttu-id="1e0c6-204">Para ver a validação de nível de campo existente fornecida automaticamente, vá para o Designer de conjunto de dados, selecione uma das tabelas de dados um campo e, em seguida, vá para a janela de propriedades.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-204">To see the existing field-level validation automatically provided, go to the DataSet Designer, select a field from one of the DataTables and then go to the Properties window.</span></span> <span data-ttu-id="1e0c6-205">Como mostra a Figura 4, o `QuantityPerUnit` DataColumn no `ProductsDataTable` tem um comprimento máximo de 20 caracteres e permitir `NULL` valores.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-205">As Figure 4 shows, the `QuantityPerUnit` DataColumn in the `ProductsDataTable` has a maximum length of 20 characters and does allow `NULL` values.</span></span> <span data-ttu-id="1e0c6-206">Se tentar definir o `ProductsDataRow`do `QuantityPerUnit` propriedade para um valor de cadeia de caracteres mais de 20 caracteres um `ArgumentException` será lançada.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-206">If we attempt to set the `ProductsDataRow`'s `QuantityPerUnit` property to a string value longer than 20 characters an `ArgumentException` will be thrown.</span></span>


<span data-ttu-id="1e0c6-207">[![DataColumn fornece validação de nível de campo básica](creating-a-business-logic-layer-cs/_static/image7.png)](creating-a-business-logic-layer-cs/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="1e0c6-207">[![The DataColumn Provides Basic Field-Level Validation](creating-a-business-logic-layer-cs/_static/image7.png)](creating-a-business-logic-layer-cs/_static/image6.png)</span></span>

<span data-ttu-id="1e0c6-208">**Figura 4**: O DataColumn fornece nível de campo validação básica ([clique para exibir a imagem em tamanho normal](creating-a-business-logic-layer-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="1e0c6-208">**Figure 4**: The DataColumn Provides Basic Field-Level Validation ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image8.png))</span></span>


<span data-ttu-id="1e0c6-209">Infelizmente, não é possível especificamos verificações de limites, como o `UnitPrice` valor deve ser maior que ou igual a zero, usando a janela Propriedades.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-209">Unfortunately, we can't specify bounds checks, such as the `UnitPrice` value must be greater than or equal to zero, through the Properties window.</span></span> <span data-ttu-id="1e0c6-210">Para fornecer esse tipo de validação de nível de campo, precisamos criar um manipulador de eventos para o DataTable [ColumnChanging](https://msdn.microsoft.com/library/system.data.datatable.columnchanging%28VS.80%29.aspx) eventos.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-210">In order to provide this type of field-level validation we need to create an event handler for the DataTable's [ColumnChanging](https://msdn.microsoft.com/library/system.data.datatable.columnchanging%28VS.80%29.aspx) event.</span></span> <span data-ttu-id="1e0c6-211">Conforme mencionado no [tutorial anterior](creating-a-data-access-layer-cs.md), objetos de conjunto de dados, DataTables e DataRow criados pelo conjunto de dados tipado podem ser estendidos com o uso de classes parciais.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-211">As mentioned in the [preceding tutorial](creating-a-data-access-layer-cs.md), the DataSet, DataTables, and DataRow objects created by the Typed DataSet can be extended through the use of partial classes.</span></span> <span data-ttu-id="1e0c6-212">Usando essa técnica, podemos criar um `ColumnChanging` manipulador de eventos para o `ProductsDataTable` classe.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-212">Using this technique we can create a `ColumnChanging` event handler for the `ProductsDataTable` class.</span></span> <span data-ttu-id="1e0c6-213">Comece criando uma classe no `App_Code` pasta denominada `ProductsDataTable.ColumnChanging.cs`.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-213">Start by creating a class in the `App_Code` folder named `ProductsDataTable.ColumnChanging.cs`.</span></span>


<span data-ttu-id="1e0c6-214">[![Adicionar uma nova classe para a pasta App_Code](creating-a-business-logic-layer-cs/_static/image10.png)](creating-a-business-logic-layer-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="1e0c6-214">[![Add a New Class to the App_Code Folder](creating-a-business-logic-layer-cs/_static/image10.png)](creating-a-business-logic-layer-cs/_static/image9.png)</span></span>

<span data-ttu-id="1e0c6-215">**Figura 5**: adicionar uma nova classe para o `App_Code` pasta ([clique para exibir a imagem em tamanho normal](creating-a-business-logic-layer-cs/_static/image11.png))</span><span class="sxs-lookup"><span data-stu-id="1e0c6-215">**Figure 5**: Add a New Class to the `App_Code` Folder ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image11.png))</span></span>


<span data-ttu-id="1e0c6-216">Em seguida, crie um manipulador de eventos para o `ColumnChanging` evento que garante que o `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, e `ReorderLevel` valores de coluna (se não `NULL`) é maior ou igual a zero.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-216">Next, create an event handler for the `ColumnChanging` event that ensures that the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, and `ReorderLevel` column values (if not `NULL`) are greater than or equal to zero.</span></span> <span data-ttu-id="1e0c6-217">Se qualquer coluna desse tipo está fora do intervalo, gerar um `ArgumentException`.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-217">If any such column is out of range, throw an `ArgumentException`.</span></span>

<span data-ttu-id="1e0c6-218">ProductsDataTable.ColumnChanging.cs</span><span class="sxs-lookup"><span data-stu-id="1e0c6-218">ProductsDataTable.ColumnChanging.cs</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample5.cs)]

## <a name="step-4-adding-custom-business-rules-to-the-blls-classes"></a><span data-ttu-id="1e0c6-219">Etapa 4: Adicionando regras de negócio personalizadas para Classes do BLL</span><span class="sxs-lookup"><span data-stu-id="1e0c6-219">Step 4: Adding Custom Business Rules to the BLL's Classes</span></span>

<span data-ttu-id="1e0c6-220">Além de validação de nível de campo, pode haver regras de negócios personalizada de alto nível que envolvem entidades diferentes ou conceitos não pode ser expressados no nível de coluna única, como:</span><span class="sxs-lookup"><span data-stu-id="1e0c6-220">In addition to field-level validation, there may be high-level custom business rules that involve different entities or concepts not expressible at the single column level, such as:</span></span>

- <span data-ttu-id="1e0c6-221">Se um produto foi descontinuado, seu `UnitPrice` não pode ser atualizado</span><span class="sxs-lookup"><span data-stu-id="1e0c6-221">If a product is discontinued, its `UnitPrice` cannot be updated</span></span>
- <span data-ttu-id="1e0c6-222">País de um funcionário de residência deve ser o mesmo país do gerente de residência</span><span class="sxs-lookup"><span data-stu-id="1e0c6-222">An employee's country of residence must be the same as their manager's country of residence</span></span>
- <span data-ttu-id="1e0c6-223">Um produto não pode ser descontinuado se é o único produto fornecido pelo fornecedor</span><span class="sxs-lookup"><span data-stu-id="1e0c6-223">A product cannot be discontinued if it is the only product provided by the supplier</span></span>

<span data-ttu-id="1e0c6-224">As classes BLL devem conter verificações para garantir a conformidade com as regras de negócio do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-224">The BLL classes should contain checks to ensure adherence to the application's business rules.</span></span> <span data-ttu-id="1e0c6-225">Essas verificações podem ser adicionadas diretamente para os métodos aos quais eles se aplicam.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-225">These checks can be added directly to the methods to which they apply.</span></span>

<span data-ttu-id="1e0c6-226">Imagine que nossas regras de negócios determinarem que um produto não puderam ser marcado Descontinuado se fosse o único produto de um fornecedor específico.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-226">Imagine that our business rules dictate that a product could not be marked discontinued if it was the only product from a given supplier.</span></span> <span data-ttu-id="1e0c6-227">Ou seja, se produto *X* foi o único produto adquirimos de fornecedor *Y*, não foi possível marcar *X* como descontinuada; se, no entanto, fornecedor *Y*fornecidos nos com três produtos, *um*, *B*, e *C*, podemos pode marcar qualquer e todos esses como descontinuado.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-227">That is, if product *X* was the only product we purchased from supplier *Y*, we could not mark *X* as discontinued; if, however, supplier *Y* supplied us with three products, *A*, *B*, and *C*, then we could mark any and all of these as discontinued.</span></span> <span data-ttu-id="1e0c6-228">Uma regra de negócio ímpar, mas as regras de negócio e senso sempre não estiverem alinhados!</span><span class="sxs-lookup"><span data-stu-id="1e0c6-228">An odd business rule, but business rules and common sense aren't always aligned!</span></span>

<span data-ttu-id="1e0c6-229">Para impor essa regra de negócio no `UpdateProducts` método começamos verificando se `Discontinued` foi definida como `true` e, portanto, devemos chamar `GetProductsBySupplierID` para determinar quantos produtos adquirimos de fornecedor deste produto.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-229">To enforce this business rule in the `UpdateProducts` method we'd start by checking if `Discontinued` was set to `true` and, if so, we'd call `GetProductsBySupplierID` to determine how many products we purchased from this product's supplier.</span></span> <span data-ttu-id="1e0c6-230">Se apenas um produto é comprado esse fornecedor, lançamos uma `ApplicationException`.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-230">If only one product is purchased from this supplier, we throw an `ApplicationException`.</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample6.cs)]

## <a name="responding-to-validation-errors-in-the-presentation-tier"></a><span data-ttu-id="1e0c6-231">Respondendo a erros de validação na camada de apresentação</span><span class="sxs-lookup"><span data-stu-id="1e0c6-231">Responding to Validation Errors in the Presentation Tier</span></span>

<span data-ttu-id="1e0c6-232">Ao chamar BLL da camada de apresentação, pode decidir se deseja tentar manipular as exceções que podem ser geradas ou permitir que eles vão para o ASP.NET (que irá gerar o `HttpApplication`do `Error` evento).</span><span class="sxs-lookup"><span data-stu-id="1e0c6-232">When calling the BLL from the presentation tier we can decide whether to attempt to handle any exceptions that might be raised or let them bubble up to ASP.NET (which will raise the `HttpApplication`'s `Error` event).</span></span> <span data-ttu-id="1e0c6-233">Para manipular uma exceção ao trabalhar programaticamente com BLL, podemos usar um [try... catch](https://msdn.microsoft.com/library/0yd65esw.aspx) bloco, como mostra o exemplo a seguir:</span><span class="sxs-lookup"><span data-stu-id="1e0c6-233">To handle an exception when working with the BLL programmatically, we can use a [try...catch](https://msdn.microsoft.com/library/0yd65esw.aspx) block, as the following example shows:</span></span>


[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample7.cs)]

<span data-ttu-id="1e0c6-234">Como veremos em tutoriais futuros, tratamento de exceções do BLL quando usando dados de um controle da Web para inserir, atualizar, ou exclusão de dados pode ser manipulada diretamente de um manipulador de eventos em vez de encapsular o código em `try...catch` blocos.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-234">As we'll see in future tutorials, handling exceptions that bubble up from the BLL when using a data Web control for inserting, updating, or deleting data can be handled directly in an event handler as opposed to having to wrap code in `try...catch` blocks.</span></span>

## <a name="summary"></a><span data-ttu-id="1e0c6-235">Resumo</span><span class="sxs-lookup"><span data-stu-id="1e0c6-235">Summary</span></span>

<span data-ttu-id="1e0c6-236">Um aplicativo bem projetado é elaborado em camadas distintas, cada uma delas encapsula uma função específica.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-236">A well architected application is crafted into distinct layers, each of which encapsulates a particular role.</span></span> <span data-ttu-id="1e0c6-237">No primeiro tutorial esta série de artigos, criamos uma camada de acesso a dados usando conjuntos de dados digitados; Neste tutorial que criamos uma camada de lógica de negócios como uma série de classes em nosso aplicativo `App_Code` pasta que chamam nosso DAL.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-237">In the first tutorial of this article series we created a Data Access Layer using Typed DataSets; in this tutorial we built a Business Logic Layer as a series of classes in our application's `App_Code` folder that call down into our DAL.</span></span> <span data-ttu-id="1e0c6-238">BLL implementa a lógica de nível de campo e o nível de negócios para nosso aplicativo.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-238">The BLL implements the field-level and business-level logic for our application.</span></span> <span data-ttu-id="1e0c6-239">Além de criar um BLL separado, como fizemos neste tutorial, outra opção é estender métodos os TableAdapters com o uso de classes parciais.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-239">In addition to creating a separate BLL, as we did in this tutorial, another option is to extend the TableAdapters' methods through the use of partial classes.</span></span> <span data-ttu-id="1e0c6-240">No entanto, usar esta técnica não permite a substituir os métodos existentes nem-separar nosso DAL e nossa BLL como perfeitamente a abordagem tomadas neste artigo.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-240">However, using this technique does not allow us to override existing methods nor does it separate our DAL and our BLL as cleanly as the approach we've taken in this article.</span></span>

<span data-ttu-id="1e0c6-241">Com a DAL e BLL completa, estamos prontos para iniciar em nossa camada de apresentação.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-241">With the DAL and BLL complete, we're ready to start on our presentation layer.</span></span> <span data-ttu-id="1e0c6-242">No [tutorial próxima](master-pages-and-site-navigation-cs.md) Vamos tomar um breve desvio de tópicos de acesso de dados e definir um layout de página consistente para uso em toda os tutoriais.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-242">In the [next tutorial](master-pages-and-site-navigation-cs.md) we'll take a brief detour from data access topics and define a consistent page layout for use throughout the tutorials.</span></span>

<span data-ttu-id="1e0c6-243">Boa programação!</span><span class="sxs-lookup"><span data-stu-id="1e0c6-243">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="1e0c6-244">Sobre o autor</span><span class="sxs-lookup"><span data-stu-id="1e0c6-244">About the Author</span></span>

<span data-ttu-id="1e0c6-245">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor de sete livros sobre ASP/ASP.NET e fundador da [4GuysFromRolla. com](http://www.4guysfromrolla.com), trabalha com tecnologias Microsoft Web desde 1998.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-245">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="1e0c6-246">Scott funciona como um consultor independente, instrutor e gravador.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-246">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="1e0c6-247">Seu livro mais recente é [ *Sams ensinar por conta própria ASP.NET 2.0 nas 24 horas*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="1e0c6-247">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="1e0c6-248">Ele pode ser contatado em [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) ou por meio de seu blog, que pode ser encontrado em [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="1e0c6-248">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="1e0c6-249">Agradecimentos especiais a</span><span class="sxs-lookup"><span data-stu-id="1e0c6-249">Special Thanks To</span></span>

<span data-ttu-id="1e0c6-250">Esta série de tutoriais foi revisado por vários revisores úteis.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-250">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="1e0c6-251">Revisores levar para este tutorial foram Liz Shulok, Dennis Patterson, Carlos Santos e Giesenow Hilton.</span><span class="sxs-lookup"><span data-stu-id="1e0c6-251">Lead reviewers for this tutorial were Liz Shulok, Dennis Patterson, Carlos Santos, and Hilton Giesenow.</span></span> <span data-ttu-id="1e0c6-252">Interessado em examinar meu artigos futuros do MSDN?</span><span class="sxs-lookup"><span data-stu-id="1e0c6-252">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="1e0c6-253">Nesse caso, me enviar uma linha no [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="1e0c6-253">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="1e0c6-254">[Anterior](creating-a-data-access-layer-cs.md)
> [Próximo](master-pages-and-site-navigation-cs.md)</span><span class="sxs-lookup"><span data-stu-id="1e0c6-254">[Previous](creating-a-data-access-layer-cs.md)
[Next](master-pages-and-site-navigation-cs.md)</span></span>
