---
uid: web-forms/overview/data-access/editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb
title: Tratamento de exceções de nível BLL e DAL em uma página ASP.NET (VB) | Microsoft Docs
author: rick-anderson
description: Neste tutorial, veremos como exibir uma mensagem de erro informativa e amigável se uma exceção ocorrer durante uma inserção, atualização ou operação de exclusão de...
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/17/2006
ms.topic: article
ms.assetid: 129d4338-1315-4f40-89b5-2b84b807707d
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb
msc.type: authoredcontent
ms.openlocfilehash: b76554b6e8c00dbe3b33de8158b925d7314afb72
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/06/2018
ms.locfileid: "30886830"
---
<a name="handling-bll--and-dal-level-exceptions-in-an-aspnet-page-vb"></a><span data-ttu-id="0c1b7-103">Tratamento de exceções de nível BLL e DAL em uma página ASP.NET (VB)</span><span class="sxs-lookup"><span data-stu-id="0c1b7-103">Handling BLL- and DAL-Level Exceptions in an ASP.NET Page (VB)</span></span>
====================
<span data-ttu-id="0c1b7-104">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="0c1b7-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="0c1b7-105">[Baixe o aplicativo de exemplo](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_18_VB.exe) ou [baixar PDF](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/datatutorial18vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="0c1b7-105">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_18_VB.exe) or [Download PDF](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/datatutorial18vb1.pdf)</span></span>

> <span data-ttu-id="0c1b7-106">Neste tutorial, veremos como exibir uma mensagem de erro informativa e amigável se uma exceção ocorrer durante uma inserção, atualização ou operação de exclusão de um controle da Web de dados do ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-106">In this tutorial we will see how to display a friendly, informative error message should an exception occur during an insert, update, or delete operation of an ASP.NET data Web control.</span></span>


## <a name="introduction"></a><span data-ttu-id="0c1b7-107">Introdução</span><span class="sxs-lookup"><span data-stu-id="0c1b7-107">Introduction</span></span>

<span data-ttu-id="0c1b7-108">Trabalhando com dados de um aplicativo web do ASP.NET usando uma arquitetura de aplicativo em camadas envolve três etapas gerais a seguir:</span><span class="sxs-lookup"><span data-stu-id="0c1b7-108">Working with data from an ASP.NET web application using a tiered application architecture involves the following three general steps:</span></span>

1. <span data-ttu-id="0c1b7-109">Determine qual método de camada de lógica de negócios precisa ser chamado e o parâmetro de valores para passá-la.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-109">Determine what method of the Business Logic Layer needs to be invoked and what parameter values to pass it.</span></span> <span data-ttu-id="0c1b7-110">Os valores de parâmetro podem ser codificado, por meio de programação atribuído ou entradas inseridas pelo usuário.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-110">The parameter values can be hard coded, programmatically-assigned, or inputs entered by the user.</span></span>
2. <span data-ttu-id="0c1b7-111">Invoque o método.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-111">Invoke the method.</span></span>
3. <span data-ttu-id="0c1b7-112">Processe os resultados.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-112">Process the results.</span></span> <span data-ttu-id="0c1b7-113">Ao chamar um método BLL que retorna os dados, isso pode envolver a associação dos dados a um controle da Web de dados.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-113">When calling a BLL method that returns data, this may involve binding the data to a data Web control.</span></span> <span data-ttu-id="0c1b7-114">Para métodos BLL que modificam dados, isso pode incluir a executar alguma ação com base em um valor de retorno ou tratar normalmente qualquer exceção que ocorreu na etapa 2.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-114">For BLL methods that modify data, this may include performing some action based on a return value or gracefully handling any exception that arose in Step 2.</span></span>

<span data-ttu-id="0c1b7-115">Como vimos no [tutorial anterior](examining-the-events-associated-with-inserting-updating-and-deleting-vb.md), ObjectDataSource e os dados de controles da Web fornecem pontos de extensibilidade para as etapas 1 e 3.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-115">As we saw in the [previous tutorial](examining-the-events-associated-with-inserting-updating-and-deleting-vb.md), both the ObjectDataSource and the data Web controls provide extensibility points for Steps 1 and 3.</span></span> <span data-ttu-id="0c1b7-116">GridView, por exemplo, dispara seu `RowUpdating` evento antes de atribuir seus valores de campo para sua ObjectDataSource `UpdateParameters` coleção; seu `RowUpdated` evento é gerado após o ObjectDataSource concluiu a operação.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-116">The GridView, for example, fires its `RowUpdating` event prior to assigning its field values to its ObjectDataSource's `UpdateParameters` collection; its `RowUpdated` event is raised after the ObjectDataSource has completed the operation.</span></span>

<span data-ttu-id="0c1b7-117">Já examinamos os eventos acionam durante a etapa 1 e viu como eles podem ser usados para personalizar os parâmetros de entrada ou cancelar a operação.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-117">We've already examined the events that fire during Step 1 and have seen how they can be used to customize the input parameters or cancel the operation.</span></span> <span data-ttu-id="0c1b7-118">Neste tutorial voltaremos nossa atenção aos eventos que acionam após a conclusão da operação.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-118">In this tutorial we'll turn our attention to the events that fire after the operation has completed.</span></span> <span data-ttu-id="0c1b7-119">Com esses manipuladores de evento de pós-nível que possível, entre outras coisas, determinar se ocorreu uma exceção durante a operação e tratar normalmente, exibindo uma mensagem de erro amigável, informativo na tela, em vez de padrão é a padrão do ASP.NET página de exceção.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-119">With these post-level event handlers we can, among other things, determine if an exception occurred during the operation and handle it gracefully, displaying a friendly, informative error message on the screen rather than defaulting to the standard ASP.NET exception page.</span></span>

<span data-ttu-id="0c1b7-120">Para ilustrar a trabalhar com esses eventos pós-níveis, vamos criar uma página que lista os produtos em um GridView editável.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-120">To illustrate working with these post-level events, let's create a page that lists the products in an editable GridView.</span></span> <span data-ttu-id="0c1b7-121">Quando a atualização de um produto, se uma exceção é gerada nosso ASP.NET página será exibida uma mensagem curta acima GridView explicando o que ocorreu um problema.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-121">When updating a product, if an exception is raised our ASP.NET page will display a short message above the GridView explaining that a problem has occurred.</span></span> <span data-ttu-id="0c1b7-122">Vamos começar!</span><span class="sxs-lookup"><span data-stu-id="0c1b7-122">Let's get started!</span></span>

## <a name="step-1-creating-an-editable-gridview-of-products"></a><span data-ttu-id="0c1b7-123">Etapa 1: Criando um GridView editável de produtos</span><span class="sxs-lookup"><span data-stu-id="0c1b7-123">Step 1: Creating an Editable GridView of Products</span></span>

<span data-ttu-id="0c1b7-124">No tutorial anterior, criamos um GridView editável com apenas dois campos, `ProductName` e `UnitPrice`.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-124">In the previous tutorial we created an editable GridView with just two fields, `ProductName` and `UnitPrice`.</span></span> <span data-ttu-id="0c1b7-125">Isso é necessário criar uma sobrecarga adicional para o `ProductsBLL` da classe `UpdateProduct` método, que só aceita três parâmetros de entrada (nome do produto, preço unitário e ID) contrário como um parâmetro para cada campo de produto.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-125">This required creating an additional overload for the `ProductsBLL` class's `UpdateProduct` method, one that only accepted three input parameters (the product's name, unit price, and ID) as opposed a parameter for each product field.</span></span> <span data-ttu-id="0c1b7-126">Para este tutorial, vamos praticar essa técnica novamente, criando um GridView editável que exibe o nome do produto, quantidade por unidade, o preço unitário e unidades em estoque, mas permite apenas o nome, o preço unitário e a unidades em estoque a ser editado.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-126">For this tutorial, let's practice this technique again, creating an editable GridView that displays the product's name, quantity per unit, unit price, and units in stock, but only allows the name, unit price, and units in stock to be edited.</span></span>

<span data-ttu-id="0c1b7-127">Para acomodar esse cenário, precisaremos outra sobrecarga do `UpdateProduct` método, que aceita quatro parâmetros: o nome do produto, preço unitário, unidades em estoque e ID.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-127">To accommodate this scenario we'll need another overload of the `UpdateProduct` method, one that accepts four parameters: the product's name, unit price, units in stock, and ID.</span></span> <span data-ttu-id="0c1b7-128">Adicione o seguinte método para o `ProductsBLL` classe:</span><span class="sxs-lookup"><span data-stu-id="0c1b7-128">Add the following method to the `ProductsBLL` class:</span></span>


[!code-vb[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/samples/sample1.vb)]

<span data-ttu-id="0c1b7-129">Com esse método completo, estamos prontos para criar a página do ASP.NET que permite editar estes quatro campos de determinado produto.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-129">With this method complete, we're ready to create the ASP.NET page that allows for editing these four particular product fields.</span></span> <span data-ttu-id="0c1b7-130">Abra o `ErrorHandling.aspx` página o `EditInsertDelete` pasta e adicionar um controle GridView à página por meio do Designer.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-130">Open the `ErrorHandling.aspx` page in the `EditInsertDelete` folder and add a GridView to the page through the Designer.</span></span> <span data-ttu-id="0c1b7-131">Associar GridView para um novo ObjectDataSource, mapeamento de `Select()` método para o `ProductsBLL` da classe `GetProducts()` método e o `Update()` método para o `UpdateProduct` sobrecarga que acabou de criar.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-131">Bind the GridView to a new ObjectDataSource, mapping the `Select()` method to the `ProductsBLL` class's `GetProducts()` method and the `Update()` method to the `UpdateProduct` overload just created.</span></span>


<span data-ttu-id="0c1b7-132">[![Use a sobrecarga de método UpdateProduct que aceita quatro parâmetros de entrada](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image2.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="0c1b7-132">[![Use the UpdateProduct Method Overload That Accepts Four Input Parameters](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image2.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image1.png)</span></span>

<span data-ttu-id="0c1b7-133">**Figura 1**: Use o `UpdateProduct` método sobrecarga que aceita quatro parâmetros de entrada ([clique para exibir a imagem em tamanho normal](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="0c1b7-133">**Figure 1**: Use the `UpdateProduct` Method Overload That Accepts Four Input Parameters ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image3.png))</span></span>


<span data-ttu-id="0c1b7-134">Isso criará um ObjectDataSource com um `UpdateParameters` coleção com quatro parâmetros e um GridView com um campo para cada um dos campos de produto.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-134">This will create an ObjectDataSource with an `UpdateParameters` collection with four parameters and a GridView with a field for each of the product fields.</span></span> <span data-ttu-id="0c1b7-135">Marcação declarativa do ObjectDataSource atribui o `OldValuesParameterFormatString` o valor da propriedade `original_{0}`, que fará com que uma exceção porque nossa classe BLL não espera um parâmetro de entrada denominado `original_productID` ser passado.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-135">The ObjectDataSource's declarative markup assigns the `OldValuesParameterFormatString` property the value `original_{0}`, which will cause an exception since our BLL class's don't expect an input parameter named `original_productID` to be passed in.</span></span> <span data-ttu-id="0c1b7-136">Não se esqueça de remover essa configuração completamente da sintaxe declarativa (ou defini-lo como o valor padrão, `{0}`).</span><span class="sxs-lookup"><span data-stu-id="0c1b7-136">Don't forget to remove this setting altogether from the declarative syntax (or set it to the default value, `{0}`).</span></span>

<span data-ttu-id="0c1b7-137">Em seguida, diminuir o GridView para incluir somente o `ProductName`, `QuantityPerUnit`, `UnitPrice`, e `UnitsInStock` BoundFields.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-137">Next, pare down the GridView to include only the `ProductName`, `QuantityPerUnit`, `UnitPrice`, and `UnitsInStock` BoundFields.</span></span> <span data-ttu-id="0c1b7-138">Também fique à vontade para aplicar qualquer formatação de nível de campo necessário (como alterar a `HeaderText` propriedades).</span><span class="sxs-lookup"><span data-stu-id="0c1b7-138">Also feel free to apply any field-level formatting you deem necessary (such as changing the `HeaderText` properties).</span></span>

<span data-ttu-id="0c1b7-139">No tutorial anterior analisamos como formatar o `UnitPrice` BoundField como uma moeda no modo somente leitura e o modo de edição.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-139">In the previous tutorial we looked at how to format the `UnitPrice` BoundField as a currency both in read-only mode and edit mode.</span></span> <span data-ttu-id="0c1b7-140">Vamos fazer a mesma aqui.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-140">Let's do the same here.</span></span> <span data-ttu-id="0c1b7-141">Lembre-se de que isso necessário definir o BoundField `DataFormatString` propriedade `{0:c}`, sua `HtmlEncode` propriedade `false`e sua `ApplyFormatInEditMode` para `true`, conforme mostrado na Figura 2.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-141">Recall that this required setting the BoundField's `DataFormatString` property to `{0:c}`, its `HtmlEncode` property to `false`, and its `ApplyFormatInEditMode` to `true`, as shown in Figure 2.</span></span>


<span data-ttu-id="0c1b7-142">[![Configurar o UnitPrice BoundField à exibição como uma moeda](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image5.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="0c1b7-142">[![Configure the UnitPrice BoundField to Display as a Currency](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image5.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image4.png)</span></span>

<span data-ttu-id="0c1b7-143">**Figura 2**: configurar o `UnitPrice` BoundField à exibição como uma moeda ([clique para exibir a imagem em tamanho normal](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="0c1b7-143">**Figure 2**: Configure the `UnitPrice` BoundField to Display as a Currency ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image6.png))</span></span>


<span data-ttu-id="0c1b7-144">Formatação de `UnitPrice` como uma moeda na interface de edição requer a criação de um manipulador de eventos do GridView `RowUpdating` evento que analisa a cadeia de caracteres de formato de moeda em um `decimal` valor.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-144">Formatting the `UnitPrice` as a currency in the editing interface requires creating an event handler for the GridView's `RowUpdating` event that parses the currency-formatted string into a `decimal` value.</span></span> <span data-ttu-id="0c1b7-145">Lembre-se de que o `RowUpdating` manipulador de eventos do último tutorial também são verificados para garantir que o usuário fornecido um `UnitPrice` valor.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-145">Recall that the `RowUpdating` event handler from the last tutorial also checked to ensure that the user provided a `UnitPrice` value.</span></span> <span data-ttu-id="0c1b7-146">No entanto, para este tutorial vamos permitir que o usuário omitir o preço.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-146">However, for this tutorial let's allow the user to omit the price.</span></span>


[!code-vb[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/samples/sample2.vb)]

<span data-ttu-id="0c1b7-147">Nosso GridView inclui um `QuantityPerUnit` BoundField, mas esse BoundField deve ser apenas para fins de exibição e não deve ser editado pelo usuário.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-147">Our GridView includes a `QuantityPerUnit` BoundField, but this BoundField should be only for display purposes and should not be editable by the user.</span></span> <span data-ttu-id="0c1b7-148">Para organizar isso, basta definir 'BoundFields `ReadOnly` propriedade `true`.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-148">To arrange this, simply set the BoundFields' `ReadOnly` property to `true`.</span></span>


<span data-ttu-id="0c1b7-149">[![Verifique o QuantityPerUnit BoundField somente leitura](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image8.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="0c1b7-149">[![Make the QuantityPerUnit BoundField Read-Only](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image8.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image7.png)</span></span>

<span data-ttu-id="0c1b7-150">**Figura 3**: tornar o `QuantityPerUnit` BoundField somente leitura ([clique para exibir a imagem em tamanho normal](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="0c1b7-150">**Figure 3**: Make the `QuantityPerUnit` BoundField Read-Only ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image9.png))</span></span>


<span data-ttu-id="0c1b7-151">Finalmente, marque a caixa de seleção Habilitar edição de marcas inteligentes do GridView.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-151">Finally, check the Enable Editing checkbox from the GridView's smart tag.</span></span> <span data-ttu-id="0c1b7-152">Após concluir essas etapas de `ErrorHandling.aspx` Designer da página deve ser semelhante à Figura 4.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-152">After completing these steps the `ErrorHandling.aspx` page's Designer should look similar to Figure 4.</span></span>


<span data-ttu-id="0c1b7-153">[![Remova todos deixando apenas o necessário BoundFields e verifique a habilitar edição de caixa de seleção](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image11.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="0c1b7-153">[![Remove All But the Needed BoundFields and Check the Enable Editing Checkbox](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image11.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image10.png)</span></span>

<span data-ttu-id="0c1b7-154">**Figura 4**: Remover tudo, exceto o necessário BoundFields e verifique se a edição de caixa de seleção Habilitar ([clique para exibir a imagem em tamanho normal](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="0c1b7-154">**Figure 4**: Remove All But the Needed BoundFields and Check the Enable Editing Checkbox ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image12.png))</span></span>


<span data-ttu-id="0c1b7-155">Neste ponto, temos uma lista de todos os produtos `ProductName`, `QuantityPerUnit`, `UnitPrice`, e `UnitsInStock` campos; no entanto, somente o `ProductName`, `UnitPrice`, e `UnitsInStock` campos podem ser editados.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-155">At this point we have a list of all of the products' `ProductName`, `QuantityPerUnit`, `UnitPrice`, and `UnitsInStock` fields; however, only the `ProductName`, `UnitPrice`, and `UnitsInStock` fields can be edited.</span></span>


<span data-ttu-id="0c1b7-156">[![Os usuários agora podem facilmente editar os nomes dos produtos, preços e unidades em estoque campos](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image14.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="0c1b7-156">[![Users Can Now Easily Edit Products' Names, Prices, and Units In Stock Fields](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image14.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image13.png)</span></span>

<span data-ttu-id="0c1b7-157">**Figura 5**: nomes de usuários pode agora facilmente editar produtos, preços e campos de unidades em estoque ([clique para exibir a imagem em tamanho normal](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="0c1b7-157">**Figure 5**: Users Can Now Easily Edit Products' Names, Prices, and Units In Stock Fields ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image15.png))</span></span>


## <a name="step-2-gracefully-handling-dal-level-exceptions"></a><span data-ttu-id="0c1b7-158">Etapa 2: Normalmente tratamento de exceções de nível de DAL</span><span class="sxs-lookup"><span data-stu-id="0c1b7-158">Step 2: Gracefully Handling DAL-Level Exceptions</span></span>

<span data-ttu-id="0c1b7-159">Embora nosso GridView editável muito funcione quando os usuários inserir valores válidos para o nome do produto editado, preço e unidades em estoque, inserir valores inválidos resulta em uma exceção.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-159">While our editable GridView works wonderfully when users enter legal values for the edited product's name, price, and units in stock, entering illegal values results in an exception.</span></span> <span data-ttu-id="0c1b7-160">Por exemplo, omitindo o `ProductName` valor faz com que um [NoNullAllowedException](https://msdn.microsoft.com/library/default.asp?url=/library/cpref/html/frlrfsystemdatanonullallowedexceptionclasstopic.asp) seja lançada desde o `ProductName` propriedade no `ProdcutsRow` classe tem seu `AllowDBNull` propriedade definida como `false`; se a banco de dados está inoperante, um `SqlException` será lançada pelo TableAdapter ao tentar se conectar ao banco de dados.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-160">For example, omitting the `ProductName` value causes a [NoNullAllowedException](https://msdn.microsoft.com/library/default.asp?url=/library/cpref/html/frlrfsystemdatanonullallowedexceptionclasstopic.asp) to be thrown since the `ProductName` property in the `ProdcutsRow` class has its `AllowDBNull` property set to `false`; if the database is down, a `SqlException` will be thrown by the TableAdapter when attempting to connect to the database.</span></span> <span data-ttu-id="0c1b7-161">Sem realizar nenhuma ação, essas exceções bolhas backup da camada de acesso a dados para a camada de lógica de negócios, em seguida, para a página do ASP.NET e, finalmente, no tempo de execução do ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-161">Without taking any action, these exceptions bubble up from the Data Access Layer to the Business Logic Layer, then to the ASP.NET page, and finally to the ASP.NET runtime.</span></span>

<span data-ttu-id="0c1b7-162">Dependendo de como seu aplicativo web é configurado e se você está visitando o aplicativo de `localhost`, uma exceção não tratada pode resultar em uma página de erro genérico de servidor, um relatório de erro detalhada ou uma página da web fácil de usar.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-162">Depending on how your web application is configured and whether or not you're visiting the application from `localhost`, an unhandled exception can result in either a generic server-error page, a detailed error report, or a user-friendly web page.</span></span> <span data-ttu-id="0c1b7-163">Consulte [Web tratamento de erros do aplicativo no ASP.NET](http://www.15seconds.com/issue/030102.htm) e [elemento customErrors](https://msdn.microsoft.com/library/h0hfz6fc(VS.80).aspx) para obter mais informações sobre como o tempo de execução do ASP.NET responde a uma exceção não tratada.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-163">See [Web Application Error Handling in ASP.NET](http://www.15seconds.com/issue/030102.htm) and the [customErrors Element](https://msdn.microsoft.com/library/h0hfz6fc(VS.80).aspx) for more information on how the ASP.NET runtime responds to an uncaught exception.</span></span>

<span data-ttu-id="0c1b7-164">A Figura 6 mostra a tela encontrada ao tentar atualizar um produto sem especificar o `ProductName` valor.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-164">Figure 6 shows the screen encountered when attempting to update a product without specifying the `ProductName` value.</span></span> <span data-ttu-id="0c1b7-165">Esse é o padrão de relatório de erro detalhadas exibido quando recebidas por meio de `localhost`.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-165">This is the default detailed error report displayed when coming through `localhost`.</span></span>


<span data-ttu-id="0c1b7-166">[![Omitindo nomes exibirão detalhes da exceção do produto](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image17.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="0c1b7-166">[![Omitting the Product's Name Will Display Exception Details](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image17.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image16.png)</span></span>

<span data-ttu-id="0c1b7-167">**Figura 6**: omissão nomes irá exibir detalhes do produto da exceção ([clique para exibir a imagem em tamanho normal](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="0c1b7-167">**Figure 6**: Omitting the Product's Name Will Display Exception Details ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image18.png))</span></span>


<span data-ttu-id="0c1b7-168">Embora esses detalhes da exceção sejam úteis ao testar um aplicativo, apresentar um usuário final com tela caso ocorra uma exceção é o ideal.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-168">While such exception details are helpful when testing an application, presenting an end user with such a screen in the face of an exception is less than ideal.</span></span> <span data-ttu-id="0c1b7-169">Um usuário final provavelmente não sabe o que um `NoNullAllowedException` é ou por que ele foi causado.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-169">An end user likely doesn't know what a `NoNullAllowedException` is or why it was caused.</span></span> <span data-ttu-id="0c1b7-170">Uma abordagem melhor é apresentar ao usuário uma mensagem mais amigável explicando que ocorreram problemas ao tentar atualizar o produto.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-170">A better approach is to present the user with a more user-friendly message explaining that there were problems attempting to update the product.</span></span>

<span data-ttu-id="0c1b7-171">Se ocorrer uma exceção ao executar a operação, os eventos pós-níveis em ObjectDataSource e o controle da Web de dados fornecem um meio para detectá-lo e cancelar a exceção de ser propagado para o tempo de execução do ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-171">If an exception occurs when performing the operation, the post-level events in both the ObjectDataSource and the data Web control provide a means to detect it and cancel the exception from bubbling up to the ASP.NET runtime.</span></span> <span data-ttu-id="0c1b7-172">Para nosso exemplo, vamos criar um manipulador de eventos do GridView `RowUpdated` evento que determina se uma exceção foi disparado e, nesse caso, exibe os detalhes da exceção em um controle de rótulo.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-172">For our example, let's create an event handler for the GridView's `RowUpdated` event that determines if an exception has fired and, if so, displays the exception details in a Label Web control.</span></span>

<span data-ttu-id="0c1b7-173">Comece adicionando um rótulo para a página do ASP.NET, definindo seu `ID` propriedade `ExceptionDetails` e limpar seu `Text` propriedade.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-173">Start by adding a Label to the ASP.NET page, setting its `ID` property to `ExceptionDetails` and clearing out its `Text` property.</span></span> <span data-ttu-id="0c1b7-174">Para chamar a atenção do usuário para essa mensagem, defina seu `CssClass` propriedade `Warning`, que é uma classe CSS que adicionamos ao `Styles.css` arquivo no tutorial anterior.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-174">In order to draw the user's eye to this message, set its `CssClass` property to `Warning`, which is a CSS class we added to the `Styles.css` file in the previous tutorial.</span></span> <span data-ttu-id="0c1b7-175">Lembre-se de que essa classe CSS faz com que o texto do rótulo a ser exibido em uma fonte vermelha, itálico, negrito, extra grande.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-175">Recall that this CSS class causes the Label's text to be displayed in a red, italic, bold, extra large font.</span></span>


<span data-ttu-id="0c1b7-176">[![Adicionar um controle de Web de rótulo para a página](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image20.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="0c1b7-176">[![Add a Label Web Control to the Page](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image20.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image19.png)</span></span>

<span data-ttu-id="0c1b7-177">**Figura 7**: adicionar um controle de Web de rótulo para a página ([clique para exibir a imagem em tamanho normal](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="0c1b7-177">**Figure 7**: Add a Label Web Control to the Page ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image21.png))</span></span>


<span data-ttu-id="0c1b7-178">Como queremos que este controle de rótulo Web fique visível apenas imediatamente após uma exceção, defina seu `Visible` propriedade como false no `Page_Load` manipulador de eventos:</span><span class="sxs-lookup"><span data-stu-id="0c1b7-178">Since we want this Label Web control to be visible only immediately after an exception has occurred, set its `Visible` property to false in the `Page_Load` event handler:</span></span>


[!code-vb[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/samples/sample3.vb)]

<span data-ttu-id="0c1b7-179">Com esse código, na primeira visita de página e postagens subsequentes a `ExceptionDetails` controle terá seu `Visible` propriedade definida como `false`.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-179">With this code, on the first page visit and subsequent postbacks the `ExceptionDetails` control will have its `Visible` property set to `false`.</span></span> <span data-ttu-id="0c1b7-180">No caso de uma exceção de nível de DAL ou BLL, que podemos detectar o GridView `RowUpdated` manipulador de eventos, vamos definir a `ExceptionDetails` do controle `Visible` propriedade como true.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-180">In the face of a DAL- or BLL-level exception, which we can detect in the GridView's `RowUpdated` event handler, we will set the `ExceptionDetails` control's `Visible` property to true.</span></span> <span data-ttu-id="0c1b7-181">Como manipuladores de eventos de controle de Web ocorrerem após o `Page_Load` manipulador de eventos do ciclo de vida da página, o rótulo será exibido.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-181">Since Web control event handlers occur after the `Page_Load` event handler in the page lifecycle, the Label will be shown.</span></span> <span data-ttu-id="0c1b7-182">No entanto, durante o próximo postback, o `Page_Load` manipulador de eventos será revertido a `Visible` propriedade `false`, ocultá-lo novamente do modo de exibição.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-182">However, on the next postback, the `Page_Load` event handler will revert the `Visible` property back to `false`, hiding it from view again.</span></span>

> [!NOTE]
> <span data-ttu-id="0c1b7-183">Como alternativa, foi possível remover a necessidade de configuração o `ExceptionDetails` do controle `Visible` propriedade `Page_Load` atribuindo seu `Visible` propriedade `false` na sintaxe declarativa e desativar seu estado de exibição (Configurando seu `EnableViewState` propriedade `false`).</span><span class="sxs-lookup"><span data-stu-id="0c1b7-183">Alternatively, we could remove the necessity for setting the `ExceptionDetails` control's `Visible` property in `Page_Load` by assigning its `Visible` property `false` in the declarative syntax and disabling its view state (setting its `EnableViewState` property to `false`).</span></span> <span data-ttu-id="0c1b7-184">Vamos usar essa abordagem alternativa em um tutorial futuras.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-184">We'll use this alternative approach in a future tutorial.</span></span>


<span data-ttu-id="0c1b7-185">Com o controle de rótulo adicionado, nossa próxima etapa é criar o manipulador de eventos para o GridView `RowUpdated` eventos.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-185">With the Label control added, our next step is to create the event handler for the GridView's `RowUpdated` event.</span></span> <span data-ttu-id="0c1b7-186">Seleciona o GridView no Designer, vá para a janela de propriedades e clique no ícone de raio, listando os eventos do GridView.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-186">Select the GridView in the Designer, go to the Properties window, and click the lightning bolt icon, listing the GridView's events.</span></span> <span data-ttu-id="0c1b7-187">Já deve haver uma entrada para o GridView `RowUpdating` evento, que é criado um manipulador de eventos para esse evento anteriormente neste tutorial.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-187">There should already be an entry there for the GridView's `RowUpdating` event, as we created an event handler for this event earlier in this tutorial.</span></span> <span data-ttu-id="0c1b7-188">Criar um manipulador de eventos para o `RowUpdated` evento bem.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-188">Create an event handler for the `RowUpdated` event as well.</span></span>


![Criar um manipulador de eventos para eventos de RowUpdated do GridView](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image22.png)

<span data-ttu-id="0c1b7-190">**Figura 8**: criar um manipulador de eventos do GridView `RowUpdated` evento</span><span class="sxs-lookup"><span data-stu-id="0c1b7-190">**Figure 8**: Create an Event Handler for the GridView's `RowUpdated` Event</span></span>


> [!NOTE]
> <span data-ttu-id="0c1b7-191">Você também pode criar o manipulador de eventos por meio de listas suspensas na parte superior do arquivo de classe code-behind.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-191">You can also create the event handler through the drop-down lists at the top of the code-behind class file.</span></span> <span data-ttu-id="0c1b7-192">Selecione GridView na lista suspensa à esquerda e o `RowUpdated` evento à direita.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-192">Select the GridView from the drop-down list on the left and the `RowUpdated` event from the one on the right.</span></span>


<span data-ttu-id="0c1b7-193">Criar este manipulador de eventos, você adicionará o código a seguir para a classe de code-behind da página ASP.NET:</span><span class="sxs-lookup"><span data-stu-id="0c1b7-193">Creating this event handler will add the following code to the ASP.NET page's code-behind class:</span></span>


[!code-vb[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/samples/sample4.vb)]

<span data-ttu-id="0c1b7-194">Segundo parâmetro de entrada do manipulador de eventos é um objeto do tipo [GridViewUpdatedEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewupdatedeventargs.aspx), que tem três propriedades de interesse para tratamento de exceções:</span><span class="sxs-lookup"><span data-stu-id="0c1b7-194">This event handler's second input parameter is an object of type [GridViewUpdatedEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewupdatedeventargs.aspx), which has three properties of interest for handling exceptions:</span></span>

- <span data-ttu-id="0c1b7-195">`Exception` uma referência para a exceção lançada; Se nenhuma exceção tiver sido lançada, essa propriedade tem um valor de `null`</span><span class="sxs-lookup"><span data-stu-id="0c1b7-195">`Exception` a reference to the thrown exception; if no exception has been thrown, this property will have a value of `null`</span></span>
- <span data-ttu-id="0c1b7-196">`ExceptionHandled` um valor booliano que indica se a exceção foi tratada no `RowUpdated` manipulador de eventos; se `false` (padrão), a exceção é lançada novamente o percolating até o tempo de execução do ASP.NET</span><span class="sxs-lookup"><span data-stu-id="0c1b7-196">`ExceptionHandled` a Boolean value that indicates whether or not the exception was handled in the `RowUpdated` event handler; if `false` (the default), the exception is re-thrown, percolating up to the ASP.NET runtime</span></span>
- <span data-ttu-id="0c1b7-197">`KeepInEditMode` Se definido como `true` a linha GridView editada permanece no modo de edição; se `false` (padrão), a linha GridView reverte para o modo somente leitura</span><span class="sxs-lookup"><span data-stu-id="0c1b7-197">`KeepInEditMode` if set to `true` the edited GridView row remains in edit mode; if `false` (the default), the GridView row reverts back to its read-only mode</span></span>

<span data-ttu-id="0c1b7-198">Nosso código, em seguida, verifique se `Exception` não é `null`, que significa que uma exceção foi gerada ao executar a operação.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-198">Our code, then, should check to see if `Exception` is not `null`, meaning that an exception was raised while performing the operation.</span></span> <span data-ttu-id="0c1b7-199">Se esse for o caso, desejamos:</span><span class="sxs-lookup"><span data-stu-id="0c1b7-199">If this is the case, we want to:</span></span>

- <span data-ttu-id="0c1b7-200">Exiba uma mensagem amigável no `ExceptionDetails` rótulo</span><span class="sxs-lookup"><span data-stu-id="0c1b7-200">Display a user-friendly message in the `ExceptionDetails` Label</span></span>
- <span data-ttu-id="0c1b7-201">Indicar que a exceção foi tratada</span><span class="sxs-lookup"><span data-stu-id="0c1b7-201">Indicate that the exception was handled</span></span>
- <span data-ttu-id="0c1b7-202">Manter a linha GridView no modo de edição</span><span class="sxs-lookup"><span data-stu-id="0c1b7-202">Keep the GridView row in edit mode</span></span>

<span data-ttu-id="0c1b7-203">O código a seguir realiza esses objetivos:</span><span class="sxs-lookup"><span data-stu-id="0c1b7-203">This following code accomplishes these objectives:</span></span>


[!code-vb[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/samples/sample5.vb)]

<span data-ttu-id="0c1b7-204">Começa a este manipulador de eventos para verificar se `e.Exception` é `null`.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-204">This event handler begins by checking to see if `e.Exception` is `null`.</span></span> <span data-ttu-id="0c1b7-205">Se não estiver, o `ExceptionDetails` do rótulo `Visible` está definida como `true` e sua `Text` propriedade como "Houve um problema ao atualizar o produto."</span><span class="sxs-lookup"><span data-stu-id="0c1b7-205">If it's not, the `ExceptionDetails` Label's `Visible` property is set to `true` and its `Text` property to "There was a problem updating the product."</span></span> <span data-ttu-id="0c1b7-206">Os detalhes da exceção real que foi lançada residem no `e.Exception` do objeto `InnerException` propriedade.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-206">The details of the actual exception that was thrown reside in the `e.Exception` object's `InnerException` property.</span></span> <span data-ttu-id="0c1b7-207">A exceção interna é examinada e, caso se trate de um determinado tipo, uma mensagem adicional, útil é anexada ao `ExceptionDetails` do rótulo `Text` propriedade.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-207">This inner exception is examined and, if it is of a particular type, an additional, helpful message is appended to the `ExceptionDetails` Label's `Text` property.</span></span> <span data-ttu-id="0c1b7-208">Por fim, o `ExceptionHandled` e `KeepInEditMode` propriedades são definidas como `true`.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-208">Lastly, the `ExceptionHandled` and `KeepInEditMode` properties are both set to `true`.</span></span>

<span data-ttu-id="0c1b7-209">A Figura 9 mostra uma captura de tela desta página ao omitir o nome do produto; A Figura 10 mostra os resultados ao inserir um ilegal `UnitPrice` valor (-50).</span><span class="sxs-lookup"><span data-stu-id="0c1b7-209">Figure 9 shows a screen shot of this page when omitting the name of the product; Figure 10 shows the results when entering an illegal `UnitPrice` value (-50).</span></span>


<span data-ttu-id="0c1b7-210">[![O ProductName BoundField deve conter um valor](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image24.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="0c1b7-210">[![The ProductName BoundField Must Contain a Value](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image24.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image23.png)</span></span>

<span data-ttu-id="0c1b7-211">**Figura 9**: O `ProductName` BoundField deve conter um valor ([clique para exibir a imagem em tamanho normal](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image25.png))</span><span class="sxs-lookup"><span data-stu-id="0c1b7-211">**Figure 9**: The `ProductName` BoundField Must Contain a Value ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image25.png))</span></span>


<span data-ttu-id="0c1b7-212">[![Valores negativos de UnitPrice não são permitido](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image27.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="0c1b7-212">[![Negative UnitPrice Values are Not Allowed](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image27.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image26.png)</span></span>

<span data-ttu-id="0c1b7-213">**Figura 10**: negativo `UnitPrice` os valores não são permitido ([clique para exibir a imagem em tamanho normal](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image28.png))</span><span class="sxs-lookup"><span data-stu-id="0c1b7-213">**Figure 10**: Negative `UnitPrice` Values are Not Allowed ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image28.png))</span></span>


<span data-ttu-id="0c1b7-214">Definindo o `e.ExceptionHandled` propriedade `true`, o `RowUpdated` manipulador de eventos indicou que tratou a exceção.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-214">By setting the `e.ExceptionHandled` property to `true`, the `RowUpdated` event handler has indicated that it has handled the exception.</span></span> <span data-ttu-id="0c1b7-215">Portanto, a exceção não se propaga até o tempo de execução do ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-215">Therefore, the exception won't propagate up to the ASP.NET runtime.</span></span>

> [!NOTE]
> <span data-ttu-id="0c1b7-216">Figuras 9 e 10 mostram uma forma amigável para lidar com exceções geradas devido a entrada de usuário inválido.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-216">Figures 9 and 10 show a graceful way to handle exceptions raised due to invalid user input.</span></span> <span data-ttu-id="0c1b7-217">Idealmente, no entanto, esse de entrada inválido será nunca alcance a camada de lógica de negócios em primeiro lugar, como a página ASP.NET deve garantir que entradas do usuário são válidas antes de chamar o `ProductsBLL` da classe `UpdateProduct` método.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-217">Ideally, though, such invalid input will never reach the Business Logic Layer in the first place, as the ASP.NET page should ensure that the user's inputs are valid before invoking the `ProductsBLL` class's `UpdateProduct` method.</span></span> <span data-ttu-id="0c1b7-218">Em nosso tutorial Avançar que veremos como adicionar controles de validação para as interfaces de edição e inserção para garantir que os dados enviados para a camada de lógica comercial está em conformidade com as regras de negócio.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-218">In our next tutorial we'll see how to add validation controls to the editing and inserting interfaces to ensure that the data submitted to the Business Logic Layer conforms to the business rules.</span></span> <span data-ttu-id="0c1b7-219">Os controles de validação não somente impedirá que a chamada do `UpdateProduct` método até que os dados fornecidos pelo usuário é válidos, mas também fornecem uma experiência de usuário mais informativa para identificar problemas de entrada de dados.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-219">The validation controls not only prevent the invocation of the `UpdateProduct` method until the user-supplied data is valid, but also provide a more informative user experience for identifying data entry problems.</span></span>


## <a name="step-3-gracefully-handling-bll-level-exceptions"></a><span data-ttu-id="0c1b7-220">Etapa 3: Normalmente tratamento de exceções de nível BLL</span><span class="sxs-lookup"><span data-stu-id="0c1b7-220">Step 3: Gracefully Handling BLL-Level Exceptions</span></span>

<span data-ttu-id="0c1b7-221">Ao inserir, atualizar ou excluir os dados, a camada de acesso a dados pode gerar uma exceção caso ocorra um erro de dados.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-221">When inserting, updating, or deleting data, the Data Access Layer may throw an exception in the face of a data-related error.</span></span> <span data-ttu-id="0c1b7-222">O banco de dados pode estar offline, uma coluna de tabela de banco de dados necessários pode não ter tido um valor especificado ou uma restrição de nível de tabela pode foram violada.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-222">The database may be offline, a required database table column might not have had a value specified, or a table-level constraint may have been violated.</span></span> <span data-ttu-id="0c1b7-223">Além de exceções estritamente relacionadas a dados, a camada de lógica comercial pode usar exceções para indicar quando as regras de negócio foram violadas.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-223">In addition to strictly data-related exceptions, the Business Logic Layer can use exceptions to indicate when business rules have been violated.</span></span> <span data-ttu-id="0c1b7-224">No [criando uma camada de lógica de negócios](../introduction/creating-a-business-logic-layer-vb.md) tutorial, por exemplo, adicionamos uma verificação de regra de negócios ao valor original `UpdateProduct` sobrecarga.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-224">In the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-vb.md) tutorial, for example, we added a business rule check to the original `UpdateProduct` overload.</span></span> <span data-ttu-id="0c1b7-225">Especificamente, se o usuário foi marcar um produto descontinuado, é necessário que ele não seja o único fornecido pelo seu fornecedor.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-225">Specifically, if the user was marking a product as discontinued, we required that the product not be the only one provided by its supplier.</span></span> <span data-ttu-id="0c1b7-226">Se essa condição foi violada, um `ApplicationException` foi lançada.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-226">If this condition was violated, an `ApplicationException` was thrown.</span></span>

<span data-ttu-id="0c1b7-227">Para o `UpdateProduct` sobrecarga criada neste tutorial, vamos adicionar uma regra de negócio que proíbe o `UnitPrice` campo de ser definida para um novo valor que é mais de duas vezes o original `UnitPrice` valor.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-227">For the `UpdateProduct` overload created in this tutorial, let's add a business rule that prohibits the `UnitPrice` field from being set to a new value that's more than twice the original `UnitPrice` value.</span></span> <span data-ttu-id="0c1b7-228">Para fazer isso, ajustar o `UpdateProduct` sobrecarga para que ele executa essa verificação e gera um `ApplicationException` se a regra for violada.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-228">To accomplish this, adjust the `UpdateProduct` overload so that it performs this check and throws an `ApplicationException` if the rule is violated.</span></span> <span data-ttu-id="0c1b7-229">O método de atualização a seguir:</span><span class="sxs-lookup"><span data-stu-id="0c1b7-229">The updated method follows:</span></span>


[!code-vb[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/samples/sample6.vb)]

<span data-ttu-id="0c1b7-230">Com essa alteração, qualquer atualização de preço é mais de duas vezes o preço existente fará com que um `ApplicationException` seja gerada.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-230">With this change, any price update that is more than twice the existing price will cause an `ApplicationException` to be thrown.</span></span> <span data-ttu-id="0c1b7-231">Assim como a exceção gerada da DAL, gerado nesse BLL `ApplicationException` podem ser detectados e tratados no GridView `RowUpdated` manipulador de eventos.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-231">Just like the exception raised from the DAL, this BLL-raised `ApplicationException` can be detected and handled in the GridView's `RowUpdated` event handler.</span></span> <span data-ttu-id="0c1b7-232">Na verdade, o `RowUpdated` código do manipulador de eventos, como escrito, corretamente detectará essa exceção e exibir o `ApplicationException`do `Message` o valor da propriedade.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-232">In fact, the `RowUpdated` event handler's code, as written, will correctly detect this exception and display the `ApplicationException`'s `Message` property value.</span></span> <span data-ttu-id="0c1b7-233">A Figura 11 mostra uma quando um usuário tenta atualizar o preço de Chai a r $50,00, que é mais do que o dobro seu preço atual de US $19,95 de captura de tela.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-233">Figure 11 shows a screen shot when a user attempts to update the price of Chai to $50.00, which is more than double its current price of $19.95.</span></span>


<span data-ttu-id="0c1b7-234">[![As regras de negócio não permitir aumento de preço mais de duas vezes preço do produto](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image30.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="0c1b7-234">[![The Business Rules Disallow Price Increases That More Than Double a Product's Price](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image30.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image29.png)</span></span>

<span data-ttu-id="0c1b7-235">**Figura 11**: aumentos de preço não permitir que mais de duas vezes o preço de um produto de regras de negócios ([clique para exibir a imagem em tamanho normal](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image31.png))</span><span class="sxs-lookup"><span data-stu-id="0c1b7-235">**Figure 11**: The Business Rules Disallow Price Increases That More Than Double a Product's Price ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb/_static/image31.png))</span></span>


> [!NOTE]
> <span data-ttu-id="0c1b7-236">Idealmente nossas regras de lógica de negócios fosse refatoradas do `UpdateProduct` sobrecargas de método e, em um método comum.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-236">Ideally our business logic rules would be refactored out of the `UpdateProduct` method overloads and into a common method.</span></span> <span data-ttu-id="0c1b7-237">Isso é deixado como um exercício para o leitor.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-237">This is left as an exercise for the reader.</span></span>


## <a name="summary"></a><span data-ttu-id="0c1b7-238">Resumo</span><span class="sxs-lookup"><span data-stu-id="0c1b7-238">Summary</span></span>

<span data-ttu-id="0c1b7-239">Durante a inserção, atualização e exclusão de operações, o controle de dados Web e ObjectDataSource envolvidos disparar eventos de pré e pós-níveis que a operação real de delimitador.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-239">During inserting, updating, and deleting operations, both the data Web control and the ObjectDataSource involved fire pre- and post-level events that bookend the actual operation.</span></span> <span data-ttu-id="0c1b7-240">Como vimos neste tutorial e o anterior, ao trabalhar com um GridView editável a GridView `RowUpdating` evento ser acionado, seguido do ObjectDataSource `Updating` evento, no ponto em que o comando de atualização é feito a ObjectDataSource objeto subjacente.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-240">As we saw in this tutorial and the preceding one, when working with an editable GridView the GridView's `RowUpdating` event fires, followed by the ObjectDataSource's `Updating` event, at which point the update command is made to the ObjectDataSource's underlying object.</span></span> <span data-ttu-id="0c1b7-241">Depois que a operação for concluída, o ObjectDataSource `Updated` evento ser acionado, seguido do GridView `RowUpdated` eventos.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-241">After the operation has completed, the ObjectDataSource's `Updated` event fires, followed by the GridView's `RowUpdated` event.</span></span>

<span data-ttu-id="0c1b7-242">Podemos criar manipuladores de eventos para os eventos de níveis previamente para personalizar os parâmetros de entrada ou para os eventos pós-níveis para inspecionar e responder aos resultados da operação.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-242">We can create event handlers for the pre-level events in order to customize the input parameters or for the post-level events in order to inspect and respond to the operation's results.</span></span> <span data-ttu-id="0c1b7-243">Manipuladores de evento de pós-nível são mais comumente usados para detectar se ocorreu uma exceção durante a operação.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-243">Post-level event handlers are most commonly used to detect whether an exception occurred during the operation.</span></span> <span data-ttu-id="0c1b7-244">Caso ocorra uma exceção, esses manipuladores de evento de pós-nível opcionalmente podem lidar com a exceção por conta própria.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-244">In the face of an exception, these post-level event handlers can optionally handle the exception on their own.</span></span> <span data-ttu-id="0c1b7-245">Neste tutorial, vimos como lidar com tal exceção exibindo uma mensagem de erro amigável.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-245">In this tutorial we saw how to handle such an exception by displaying a friendly error message.</span></span>

<span data-ttu-id="0c1b7-246">No tutorial de Avançar, veremos como diminuir a probabilidade de exceções decorrentes de problemas de formatação de dados (como inserir um negativo `UnitPrice`).</span><span class="sxs-lookup"><span data-stu-id="0c1b7-246">In the next tutorial we'll see how to lessen the likelihood of exceptions arising from data formatting issues (such as entering a negative `UnitPrice`).</span></span> <span data-ttu-id="0c1b7-247">Especificamente, vamos examinar como adicionar controles de validação para as interfaces de edição e inserção.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-247">Specifically, we'll look at how to add validation controls to the editing and inserting interfaces.</span></span>

<span data-ttu-id="0c1b7-248">Boa programação!</span><span class="sxs-lookup"><span data-stu-id="0c1b7-248">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="0c1b7-249">Sobre o autor</span><span class="sxs-lookup"><span data-stu-id="0c1b7-249">About the Author</span></span>

<span data-ttu-id="0c1b7-250">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor de sete livros sobre ASP/ASP.NET e fundador da [4GuysFromRolla. com](http://www.4guysfromrolla.com), trabalha com tecnologias Microsoft Web desde 1998.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-250">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="0c1b7-251">Scott funciona como um consultor independente, instrutor e gravador.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-251">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="0c1b7-252">Seu livro mais recente é [ *Sams ensinar por conta própria ASP.NET 2.0 nas 24 horas*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="0c1b7-252">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="0c1b7-253">Ele pode ser contatado em [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) ou por meio de seu blog, que pode ser encontrado em [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="0c1b7-253">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="0c1b7-254">Agradecimentos especiais a</span><span class="sxs-lookup"><span data-stu-id="0c1b7-254">Special Thanks To</span></span>

<span data-ttu-id="0c1b7-255">Esta série de tutoriais foi revisado por vários revisores úteis.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-255">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="0c1b7-256">Revisor levar para este tutorial foi Liz Shulok.</span><span class="sxs-lookup"><span data-stu-id="0c1b7-256">Lead reviewer for this tutorial was Liz Shulok.</span></span> <span data-ttu-id="0c1b7-257">Interessado em examinar meu artigos futuros do MSDN?</span><span class="sxs-lookup"><span data-stu-id="0c1b7-257">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="0c1b7-258">Nesse caso, me enviar uma linha no [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="0c1b7-258">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="0c1b7-259">[Anterior](examining-the-events-associated-with-inserting-updating-and-deleting-vb.md)
> [Próximo](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb.md)</span><span class="sxs-lookup"><span data-stu-id="0c1b7-259">[Previous](examining-the-events-associated-with-inserting-updating-and-deleting-vb.md)
[Next](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb.md)</span></span>
