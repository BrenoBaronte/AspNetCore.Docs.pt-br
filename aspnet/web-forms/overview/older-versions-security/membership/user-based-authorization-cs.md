---
uid: web-forms/overview/older-versions-security/membership/user-based-authorization-cs
title: Autorização baseada em usuário (c#) | Microsoft Docs
author: rick-anderson
description: Neste tutorial examinaremos limitando o acesso a páginas e restringindo a funcionalidade de nível de página por meio de uma variedade de técnicas.
ms.author: aspnetcontent
manager: wpickett
ms.date: 01/18/2008
ms.topic: article
ms.assetid: 3c815a9e-2296-4b9b-b945-776d54989daa
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-security/membership/user-based-authorization-cs
msc.type: authoredcontent
ms.openlocfilehash: 9a0d476ffaf1f176c21b245520fa943f66e8c0d5
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/10/2018
ms.locfileid: "30891913"
---
<a name="user-based-authorization-c"></a><span data-ttu-id="d6a4b-103">Autorização baseada em usuário (c#)</span><span class="sxs-lookup"><span data-stu-id="d6a4b-103">User-Based Authorization (C#)</span></span>
====================
<span data-ttu-id="d6a4b-104">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="d6a4b-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="d6a4b-105">[Baixar o código](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_07_CS.zip) ou [baixar PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial07_UserAuth_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="d6a4b-105">[Download Code](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_07_CS.zip) or [Download PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial07_UserAuth_cs.pdf)</span></span>

> <span data-ttu-id="d6a4b-106">Neste tutorial examinaremos limitando o acesso a páginas e restringindo a funcionalidade de nível de página por meio de uma variedade de técnicas.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-106">In this tutorial we will look at limiting access to pages and restricting page-level functionality through a variety of techniques.</span></span>


## <a name="introduction"></a><span data-ttu-id="d6a4b-107">Introdução</span><span class="sxs-lookup"><span data-stu-id="d6a4b-107">Introduction</span></span>

<span data-ttu-id="d6a4b-108">A maioria dos aplicativos web que oferecem as contas de usuário fazer isso em parte para restringir determinados visitantes de acessar certas páginas no site.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-108">Most web applications that offer user accounts do so in part to restrict certain visitors from accessing certain pages within the site.</span></span> <span data-ttu-id="d6a4b-109">Em sites messageboard mais online, por exemplo, todos os usuários - anônimos e autenticados - sejam capazes de visualizar postagens do messageboard, mas somente os usuários autenticados podem visitar a página da web para criar uma nova postagem.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-109">In most online messageboard sites, for example, all users - anonymous and authenticated - are able to view the messageboard's posts, but only authenticated users can visit the web page to create a new post.</span></span> <span data-ttu-id="d6a4b-110">E pode haver páginas administrativas que são acessíveis apenas a um usuário específico (ou um conjunto específico de usuários).</span><span class="sxs-lookup"><span data-stu-id="d6a4b-110">And there may be administrative pages that are only accessible to a particular user (or a particular set of users).</span></span> <span data-ttu-id="d6a4b-111">Além disso, a funcionalidade de nível de página pode diferir em uma base por usuário.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-111">Moreover, page-level functionality can differ on a user-by-user basis.</span></span> <span data-ttu-id="d6a4b-112">Ao exibir uma lista de mensagens, os usuários autenticados são mostrados uma interface para a classificação de cada postagem, enquanto esta interface não está disponível para visitantes anônimos.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-112">When viewing a list of posts, authenticated users are shown an interface for rating each post, whereas this interface is not available to anonymous visitors.</span></span>

<span data-ttu-id="d6a4b-113">ASP.NET facilita definir regras de autorização baseada em usuário.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-113">ASP.NET makes it easy to define user-based authorization rules.</span></span> <span data-ttu-id="d6a4b-114">Com apenas um pouco de marcação em `Web.config`, páginas da web específicas ou diretórios inteiros podem ser bloqueados para que eles são acessíveis apenas a um subconjunto especificado de usuários.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-114">With just a bit of markup in `Web.config`, specific web pages or entire directories can be locked down so that they are only accessible to a specified subset of users.</span></span> <span data-ttu-id="d6a4b-115">Funcionalidade de nível de página pode ser ativada ou desativados com base no usuário conectado no momento por meio de forma programática e declarativa.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-115">Page-level functionality can be turned on or off based on the currently logged in user through programmatic and declarative means.</span></span>

<span data-ttu-id="d6a4b-116">Neste tutorial examinaremos limitando o acesso a páginas e restringindo a funcionalidade de nível de página por meio de uma variedade de técnicas.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-116">In this tutorial we will look at limiting access to pages and restricting page-level functionality through a variety of techniques.</span></span> <span data-ttu-id="d6a4b-117">Vamos começar!</span><span class="sxs-lookup"><span data-stu-id="d6a4b-117">Let's get started!</span></span>

## <a name="a-look-at-the-url-authorization-workflow"></a><span data-ttu-id="d6a4b-118">Examinar o fluxo de trabalho de autorização de URL</span><span class="sxs-lookup"><span data-stu-id="d6a4b-118">A Look at the URL Authorization Workflow</span></span>

<span data-ttu-id="d6a4b-119">Como discutido o [ *uma visão geral de formulários de autenticação* ](../introduction/an-overview-of-forms-authentication-cs.md) tutorial, quando o tempo de execução do ASP.NET processa uma solicitação para um recurso do ASP.NET a solicitação eleva um número de eventos durante o ciclo de vida.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-119">As discussed in the [*An Overview of Forms Authentication*](../introduction/an-overview-of-forms-authentication-cs.md) tutorial, when the ASP.NET runtime processes a request for an ASP.NET resource the request raises a number of events during its lifecycle.</span></span> <span data-ttu-id="d6a4b-120">*Módulos HTTP* são classes gerenciadas, cujo código é executado em resposta a um evento específico no ciclo de vida de solicitação.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-120">*HTTP Modules* are managed classes whose code is executed in response to a particular event in the request lifecycle.</span></span> <span data-ttu-id="d6a4b-121">ASP.NET vem com um número de módulos HTTP que realizar tarefas essenciais em segundo plano.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-121">ASP.NET ships with a number of HTTP Modules that perform essential tasks behind the scenes.</span></span>

<span data-ttu-id="d6a4b-122">É um módulo tais HTTP [ `FormsAuthenticationModule` ](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx).</span><span class="sxs-lookup"><span data-stu-id="d6a4b-122">One such HTTP Module is [`FormsAuthenticationModule`](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx).</span></span> <span data-ttu-id="d6a4b-123">Conforme discutido em tutoriais anteriores, a principal função do `FormsAuthenticationModule` é determinar a identidade da solicitação atual.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-123">As discussed in previous tutorials, the primary function of the `FormsAuthenticationModule` is to determine the identity of the current request.</span></span> <span data-ttu-id="d6a4b-124">Isso é feito ao inspecionar o tíquete de autenticação de formulários, que está localizado em um cookie ou incorporado a URL.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-124">This is accomplished by inspecting the forms authentication ticket, which is either located in a cookie or embedded within the URL.</span></span> <span data-ttu-id="d6a4b-125">Essa identificação ocorre durante o [ `AuthenticateRequest` evento](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx).</span><span class="sxs-lookup"><span data-stu-id="d6a4b-125">This identification takes place during the [`AuthenticateRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx).</span></span>

<span data-ttu-id="d6a4b-126">Outro módulo HTTP importante é o [ `UrlAuthorizationModule` ](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx), que é gerado em resposta ao [ `AuthorizeRequest` evento](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx) (que ocorre após o `AuthenticateRequest` evento).</span><span class="sxs-lookup"><span data-stu-id="d6a4b-126">Another important HTTP Module is the [`UrlAuthorizationModule`](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx), which is raised in response to the [`AuthorizeRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx) (which happens after the `AuthenticateRequest` event).</span></span> <span data-ttu-id="d6a4b-127">O `UrlAuthorizationModule` examina a marcação de configuração em `Web.config` para determinar se a identidade atual tem autoridade para visitar a página especificada.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-127">The `UrlAuthorizationModule` examines configuration markup in `Web.config` to determine whether the current identity has authority to visit the specified page.</span></span> <span data-ttu-id="d6a4b-128">Esse processo é conhecido como *autorização de URL*.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-128">This process is referred to as *URL authorization*.</span></span>

<span data-ttu-id="d6a4b-129">Vamos examinar a sintaxe para as regras de autorização de URL na etapa 1, mas primeiro vamos examinar o que o `UrlAuthorizationModule` dependendo se a solicitação está autorizada ou não.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-129">We'll examine the syntax for the URL authorization rules in Step 1, but first let's look at what the `UrlAuthorizationModule` does depending on whether the request is authorized or not.</span></span> <span data-ttu-id="d6a4b-130">Se o `UrlAuthorizationModule` determina que a solicitação for autorizada, e em seguida, ele não faz nada e continua a solicitação por meio de seu ciclo de vida.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-130">If the `UrlAuthorizationModule` determines that the request is authorized, then it does nothing, and the request continues through its lifecycle.</span></span> <span data-ttu-id="d6a4b-131">No entanto, se a solicitação for *não* autorizado, o `UrlAuthorizationModule` anula o ciclo de vida e instrui o `Response` objeto para retornar um [HTTP 401 não autorizado](http://www.checkupdown.com/status/E401.html) status.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-131">However, if the request is *not* authorized, then the `UrlAuthorizationModule` aborts the lifecycle and instructs the `Response` object to return an [HTTP 401 Unauthorized](http://www.checkupdown.com/status/E401.html) status.</span></span> <span data-ttu-id="d6a4b-132">Ao usar a autenticação de formulários esse status HTTP 401 nunca é retornada ao cliente, porque se o `FormsAuthenticationModule` detecta um é de status do HTTP 401 modifica um [redirecionamento HTTP 302](http://www.checkupdown.com/status/E302.html) a página de logon.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-132">When using forms authentication this HTTP 401 status is never returned to the client because if the `FormsAuthenticationModule` detects an HTTP 401 status is modifies it to an [HTTP 302 Redirect](http://www.checkupdown.com/status/E302.html) to the login page.</span></span>

<span data-ttu-id="d6a4b-133">A Figura 1 ilustra o fluxo de trabalho do pipeline do ASP.NET, o `FormsAuthenticationModule`e o `UrlAuthorizationModule` quando chega uma solicitação não autorizada.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-133">Figure 1 illustrates the workflow of the ASP.NET pipeline, the `FormsAuthenticationModule`, and the `UrlAuthorizationModule` when an unauthorized request arrives.</span></span> <span data-ttu-id="d6a4b-134">Em particular, a Figura 1 mostra uma solicitação por um visitante anônimo para `ProtectedPage.aspx`, que é uma página que nega o acesso a usuários anônimos.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-134">In particular, Figure 1 shows a request by an anonymous visitor for `ProtectedPage.aspx`, which is a page that denies access to anonymous users.</span></span> <span data-ttu-id="d6a4b-135">Como o visitante é anônimo, a `UrlAuthorizationModule` anula a solicitação e retorna um status HTTP 401 não autorizado.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-135">Since the visitor is anonymous, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="d6a4b-136">O `FormsAuthenticationModule` converte o status 401 em um redirecionamento 302 para página de logon.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-136">The `FormsAuthenticationModule` then converts the 401 status into a 302 Redirect to login page.</span></span> <span data-ttu-id="d6a4b-137">Depois que o usuário é autenticado por meio da página de logon, ele é redirecionado para `ProtectedPage.aspx`.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-137">After the user is authenticated via the login page, he is redirected to `ProtectedPage.aspx`.</span></span> <span data-ttu-id="d6a4b-138">Neste momento o `FormsAuthenticationModule` identifica o usuário com base em seu tíquete de autenticação.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-138">This time the `FormsAuthenticationModule` identifies the user based on his authentication ticket.</span></span> <span data-ttu-id="d6a4b-139">Agora que o visitante é autenticado, o `UrlAuthorizationModule` permite o acesso à página.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-139">Now that the visitor is authenticated, the `UrlAuthorizationModule` permits access to the page.</span></span>


<span data-ttu-id="d6a4b-140">[![A autenticação de formulários e o fluxo de trabalho de autorização de URL](user-based-authorization-cs/_static/image2.png)](user-based-authorization-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="d6a4b-140">[![The Forms Authentication and URL Authorization Workflow](user-based-authorization-cs/_static/image2.png)](user-based-authorization-cs/_static/image1.png)</span></span>

<span data-ttu-id="d6a4b-141">**Figura 1**: A autenticação de formulários e fluxo de trabalho de autorização de URL ([clique para exibir a imagem em tamanho normal](user-based-authorization-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="d6a4b-141">**Figure 1**: The Forms Authentication and URL Authorization Workflow  ([Click to view full-size image](user-based-authorization-cs/_static/image3.png))</span></span>


<span data-ttu-id="d6a4b-142">A Figura 1 mostra a interação que ocorre quando um visitante anônimo tenta acessar um recurso que não está disponível para usuários anônimos.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-142">Figure 1 depicts the interaction that occurs when an anonymous visitor attempts to access a resource that is not available to anonymous users.</span></span> <span data-ttu-id="d6a4b-143">Nesse caso, o visitante anônimo é redirecionado para a página de logon com a página que tentou visitar especificado na querystring.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-143">In such a case, the anonymous visitor is redirected to the login page with the page she attempted to visit specified in the querystring.</span></span> <span data-ttu-id="d6a4b-144">Depois que o usuário faz logon com êxito, ela será automaticamente redirecionada para o recurso que ela foi inicialmente tentando exibir.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-144">Once the user has successfully logged on, she will be automatically redirected back to the resource she was initially attempting to view.</span></span>

<span data-ttu-id="d6a4b-145">Quando a solicitação não autorizada é feita por um usuário anônimo, esse fluxo de trabalho é simples e fácil para o visitante entender o que aconteceu e por quê.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-145">When the unauthorized request is made by an anonymous user, this workflow is straightforward and is easy for the visitor to understand what has happened and why.</span></span> <span data-ttu-id="d6a4b-146">Mas tenha em mente que o `FormsAuthenticationModule` redirecionará *qualquer* não autorizado de usuário para a página de logon, mesmo se a solicitação é feita por um usuário autenticado.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-146">But keep in mind that the `FormsAuthenticationModule` will redirect *any* unauthorized user to the login page, even if the request is made by an authenticated user.</span></span> <span data-ttu-id="d6a4b-147">Isso pode resultar em uma experiência de usuário confuso, se um usuário autenticado tenta visita uma página para que ela não tem autoridade.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-147">This can result in a confusing user experience if an authenticated user attempts to visit a page for which she lacks authority.</span></span>

<span data-ttu-id="d6a4b-148">Imagine que nosso site teve suas regras de autorização de URL configuradas, de modo que a página ASP.NET `OnlyTito.aspx` era acessível apenas Tito.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-148">Imagine that our website had its URL authorization rules configured such that the ASP.NET page `OnlyTito.aspx` was accessibly only to Tito.</span></span> <span data-ttu-id="d6a4b-149">Agora, imagine que Sam visita o site, logon e, em seguida, tenta visite `OnlyTito.aspx`.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-149">Now, imagine that Sam visits the site, logs on, and then attempts to visit `OnlyTito.aspx`.</span></span> <span data-ttu-id="d6a4b-150">O `UrlAuthorizationModule` irá interromper o ciclo de vida de solicitação e retornar um status HTTP 401 não autorizado, que o `FormsAuthenticationModule` detectará e, em seguida, redirecione Sam para a página de logon.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-150">The `UrlAuthorizationModule` will halt the request lifecycle and return an HTTP 401 Unauthorized status, which the `FormsAuthenticationModule` will detect and then redirect Sam to the login page.</span></span> <span data-ttu-id="d6a4b-151">Desde que o Sam já registrou em, no entanto, ela deve estar imaginando por que ela foi enviada para a página de logon.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-151">Since Sam has already logged in, though, she may wonder why she has been sent back to the login page.</span></span> <span data-ttu-id="d6a4b-152">Ela pode motivo que suas credenciais de logon foram perdidas alguma forma, ou que ele entrou credenciais inválidas.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-152">She might reason that her login credentials were lost somehow, or that she entered invalid credentials.</span></span> <span data-ttu-id="d6a4b-153">Se Sam reiniciará as credenciais na página de logon será conectada (novamente) e redirecionada para `OnlyTito.aspx`.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-153">If Sam reenters her credentials from the login page she will be logged on (again) and redirected to `OnlyTito.aspx`.</span></span> <span data-ttu-id="d6a4b-154">O `UrlAuthorizationModule` detectará que Sam não visite essa página, e ela será retornada para a página de logon.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-154">The `UrlAuthorizationModule` will detect that Sam cannot visit this page and she will be returned to the login page.</span></span>

<span data-ttu-id="d6a4b-155">A Figura 2 representa o fluxo de trabalho confuso.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-155">Figure 2 depicts this confusing workflow.</span></span>


<span data-ttu-id="d6a4b-156">[![O fluxo de trabalho padrão pode resultar em um ciclo confuso](user-based-authorization-cs/_static/image5.png)](user-based-authorization-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="d6a4b-156">[![The Default Workflow Can Lead to a Confusing Cycle](user-based-authorization-cs/_static/image5.png)](user-based-authorization-cs/_static/image4.png)</span></span>

<span data-ttu-id="d6a4b-157">**Figura 2**: O padrão fluxo de trabalho pode levar a um ciclo confuso ([clique para exibir a imagem em tamanho normal](user-based-authorization-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="d6a4b-157">**Figure 2**: The Default Workflow Can Lead to a Confusing Cycle  ([Click to view full-size image](user-based-authorization-cs/_static/image6.png))</span></span>


<span data-ttu-id="d6a4b-158">O fluxo de trabalho ilustrado na Figura 2 pode rapidamente befuddle até mesmo o maioria dos computador experientes visitante.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-158">The workflow illustrated in Figure 2 can quickly befuddle even the most computer savvy visitor.</span></span> <span data-ttu-id="d6a4b-159">Examinaremos maneiras de evitar que isso confuso ciclo na etapa 2.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-159">We will look at ways to prevent this confusing cycle in Step 2.</span></span>

> [!NOTE]
> <span data-ttu-id="d6a4b-160">O ASP.NET usa dois mecanismos para determinar se o usuário atual pode acessar uma página da web específico: autorização de URL e a autorização do arquivo.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-160">ASP.NET uses two mechanisms to determine whether the current user can access a particular web page: URL authorization and file authorization.</span></span> <span data-ttu-id="d6a4b-161">Autorização do arquivo é implementada pelo [ `FileAuthorizationModule` ](https://msdn.microsoft.com/library/system.web.security.fileauthorizationmodule.aspx), que determina a autoridade consultando as ACLs de arquivo (s) solicitado.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-161">File authorization is implemented by the [`FileAuthorizationModule`](https://msdn.microsoft.com/library/system.web.security.fileauthorizationmodule.aspx), which determines authority by consulting the requested file(s) ACLs.</span></span> <span data-ttu-id="d6a4b-162">Autorização do arquivo é mais comumente usada com autenticação do Windows porque as ACLs são permissões que se aplicam a contas do Windows.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-162">File authorization is most commonly used with Windows authentication because ACLs are permissions that apply to Windows accounts.</span></span> <span data-ttu-id="d6a4b-163">Ao usar a autenticação de formulários, todas as solicitações de nível de sistema de arquivo e sistema operacional são executadas pela mesma conta do Windows, independentemente do usuário visitar o site.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-163">When using forms authentication, all operating system- and file system-level requests are executed by the same Windows account, regardless of the user visiting the site.</span></span> <span data-ttu-id="d6a4b-164">Desde que esta série tutorial concentra-se na autenticação de formulários, não abordaremos autorização do arquivo.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-164">Since this tutorial series focuses on forms authentication, we will not be discussing file authorization.</span></span>


### <a name="the-scope-of-url-authorization"></a><span data-ttu-id="d6a4b-165">O escopo de autorização de URL</span><span class="sxs-lookup"><span data-stu-id="d6a4b-165">The Scope of URL Authorization</span></span>

<span data-ttu-id="d6a4b-166">O `UrlAuthorizationModule` é código gerenciado que faz parte do tempo de execução do ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-166">The `UrlAuthorizationModule` is managed code that is part of the ASP.NET runtime.</span></span> <span data-ttu-id="d6a4b-167">Antes da versão 7 da Microsoft [serviços de informações da Internet (IIS)](https://www.iis.net/) servidor web, houve uma barreira distinta entre o pipeline HTTP do IIS e o pipeline do ASP.NET runtime.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-167">Prior to version 7 of Microsoft's [Internet Information Services (IIS)](https://www.iis.net/) web server, there was a distinct barrier between IIS's HTTP pipeline and the ASP.NET runtime's pipeline.</span></span> <span data-ttu-id="d6a4b-168">Em outras palavras, no IIS 6 e versões anteriores, ASP. Do NET `UrlAuthorizationModule` executa somente quando uma solicitação é delegada do IIS para o tempo de execução do ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-168">In short, in IIS 6 and earlier, ASP.NET's `UrlAuthorizationModule` only executes when a request is delegated from IIS to the ASP.NET runtime.</span></span> <span data-ttu-id="d6a4b-169">Por padrão, o IIS processa o conteúdo estático em si – como páginas HTML e CSS, JavaScript e arquivos de imagem - e só encaminha solicitações para o tempo de execução do ASP.NET quando uma página com uma extensão de `.aspx`, `.asmx`, ou `.ashx` é solicitado.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-169">By default, IIS processes static content itself - like HTML pages and CSS, JavaScript, and image files - and only hands off requests to the ASP.NET runtime when a page with an extension of `.aspx`, `.asmx`, or `.ashx` is requested.</span></span>

<span data-ttu-id="d6a4b-170">IIS 7, no entanto, permite integrado do IIS e ASP.NET pipelines.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-170">IIS 7, however, allows for integrated IIS and ASP.NET pipelines.</span></span> <span data-ttu-id="d6a4b-171">Com algumas definições de configuração, você pode configurar o IIS 7 para invocar o `UrlAuthorizationModule` para *todos os* solicitações, o que significa que as regras de autorização de URL podem ser definidas para arquivos de qualquer tipo.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-171">With a few configuration settings you can setup IIS 7 to invoke the `UrlAuthorizationModule` for *all* requests, meaning that URL authorization rules can be defined for files of any type.</span></span> <span data-ttu-id="d6a4b-172">Além disso, o IIS 7 inclui seu próprio mecanismo de autorização de URL.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-172">Additionally, IIS 7 includes its own URL authorization engine.</span></span> <span data-ttu-id="d6a4b-173">Para obter mais informações sobre a integração do ASP.NET e a funcionalidade de autorização de URL nativo do IIS 7, consulte [Noções básicas de autorização de URL de IIS7](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization).</span><span class="sxs-lookup"><span data-stu-id="d6a4b-173">For more information on ASP.NET integration and IIS 7's native URL authorization functionality, see [Understanding IIS7 URL Authorization](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization).</span></span> <span data-ttu-id="d6a4b-174">Para uma visão mais detalhada de integração do ASP.NET e IIS 7, obtenha uma cópia do livro de Shahram Khosravi, *Professional IIS 7 e ASP.NET integrado programação* (ISBN: 0470152539 978).</span><span class="sxs-lookup"><span data-stu-id="d6a4b-174">For a more in-depth look at ASP.NET and IIS 7 integration, pick up a copy of Shahram Khosravi's book, *Professional IIS 7 and ASP.NET Integrated Programming* (ISBN: 978-0470152539).</span></span>

<span data-ttu-id="d6a4b-175">Resumindo, em versões anteriores do IIS 7, regras de autorização de URL são aplicadas apenas a recursos controlados pelo tempo de execução do ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-175">In a nutshell, in versions prior to IIS 7, URL authorization rules are only applied to resources handled by the ASP.NET runtime.</span></span> <span data-ttu-id="d6a4b-176">Mas, com o IIS 7, é possível usar o recurso de autorização de URL nativo do IIS ou integrar ASP. Do NET `UrlAuthorizationModule` no pipeline HTTP do IIS, estendendo assim essa funcionalidade para todas as solicitações.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-176">But with IIS 7 it is possible to use IIS's native URL authorization feature or to integrate ASP.NET's `UrlAuthorizationModule` into IIS's HTTP pipeline, thereby extending this functionality to all requests.</span></span>

> [!NOTE]
> <span data-ttu-id="d6a4b-177">Há algumas diferenças sutis, porém importantes, como ASP. Do NET `UrlAuthorizationModule` e o recurso de autorização de URL do IIS 7 processar as regras de autorização.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-177">There are some subtle yet important differences in how ASP.NET's `UrlAuthorizationModule` and IIS 7's URL authorization feature process the authorization rules.</span></span> <span data-ttu-id="d6a4b-178">Este tutorial não examina a funcionalidade de autorização de URL do IIS 7 ou as diferenças em como ele analisa as regras de autorização em comparação comparadas o `UrlAuthorizationModule`.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-178">This tutorial does not examine IIS 7's URL authorization functionality or the differences in how it parses authorization rules compared to the `UrlAuthorizationModule`.</span></span> <span data-ttu-id="d6a4b-179">Para obter mais informações sobre esses tópicos, consulte a documentação do IIS 7 no MSDN ou na [www.iis.net](https://www.iis.net/).</span><span class="sxs-lookup"><span data-stu-id="d6a4b-179">For more information on these topics, refer to the IIS 7 documentation on MSDN or at [www.iis.net](https://www.iis.net/).</span></span>


## <a name="step-1-defining-url-authorization-rules-inwebconfig"></a><span data-ttu-id="d6a4b-180">Etapa 1: Definir regras de autorização de URL no`Web.config`</span><span class="sxs-lookup"><span data-stu-id="d6a4b-180">Step 1: Defining URL Authorization Rules in`Web.config`</span></span>

<span data-ttu-id="d6a4b-181">O `UrlAuthorizationModule` determina se é necessário conceder ou negar acesso a um recurso solicitado para uma identidade específica com base nas regras de autorização de URL definidas na configuração do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-181">The `UrlAuthorizationModule` determines whether to grant or deny access to a requested resource for a particular identity based on the URL authorization rules defined in the application's configuration.</span></span> <span data-ttu-id="d6a4b-182">As regras de autorização são detalhadas no [ `<authorization>` elemento](https://msdn.microsoft.com/library/8d82143t.aspx) na forma de `<allow>` e `<deny>` elementos filho.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-182">The authorization rules are spelled out in the [`<authorization>` element](https://msdn.microsoft.com/library/8d82143t.aspx) in the form of `<allow>` and `<deny>` child elements.</span></span> <span data-ttu-id="d6a4b-183">Cada `<allow>` e `<deny>` elemento filho pode especificar:</span><span class="sxs-lookup"><span data-stu-id="d6a4b-183">Each `<allow>` and `<deny>` child element can specify:</span></span>

- <span data-ttu-id="d6a4b-184">Um usuário específico</span><span class="sxs-lookup"><span data-stu-id="d6a4b-184">A particular user</span></span>
- <span data-ttu-id="d6a4b-185">Uma lista delimitada por vírgulas de usuários</span><span class="sxs-lookup"><span data-stu-id="d6a4b-185">A comma-delimited list of users</span></span>
- <span data-ttu-id="d6a4b-186">Todos os usuários anônimos, indicados por um ponto de interrogação (?)</span><span class="sxs-lookup"><span data-stu-id="d6a4b-186">All anonymous users, denoted by a question mark (?)</span></span>
- <span data-ttu-id="d6a4b-187">Todos os usuários, indicados por um asterisco (\*)</span><span class="sxs-lookup"><span data-stu-id="d6a4b-187">All users, denoted by an asterisk (\*)</span></span>

<span data-ttu-id="d6a4b-188">A marcação a seguir ilustra como usar as regras de autorização de URL para permitir que os usuários Tito e Scott e recusar todos os outros:</span><span class="sxs-lookup"><span data-stu-id="d6a4b-188">The following markup illustrates how to use the URL authorization rules to allow users Tito and Scott and deny all others:</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample1.xml)]

<span data-ttu-id="d6a4b-189">O `<allow>` elemento define quais usuários têm permissão - Tito e Scott - enquanto o `<deny>` elemento instrui que *todos os* usuários serão negados.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-189">The `<allow>` element defines what users are permitted - Tito and Scott - while the `<deny>` element instructs that *all* users are denied.</span></span>

> [!NOTE]
> <span data-ttu-id="d6a4b-190">O `<allow>` e `<deny>` elementos também podem especificar regras de autorização para funções.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-190">The `<allow>` and `<deny>` elements can also specify authorization rules for roles.</span></span> <span data-ttu-id="d6a4b-191">Vamos examinar a autorização baseada em função em um tutorial futuras.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-191">We will examine role-based authorization in a future tutorial.</span></span>


<span data-ttu-id="d6a4b-192">A configuração a seguir concede acesso a qualquer pessoa que não seja o Sam (incluindo visitantes anônimos):</span><span class="sxs-lookup"><span data-stu-id="d6a4b-192">The following setting grants access to anyone other than Sam (including anonymous visitors):</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample2.xml)]

<span data-ttu-id="d6a4b-193">Para permitir que somente usuários autenticados, use a configuração a seguir, que nega o acesso a todos os usuários anônimos:</span><span class="sxs-lookup"><span data-stu-id="d6a4b-193">To allow only authenticated users, use the following configuration, which denies access to all anonymous users:</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample3.xml)]

<span data-ttu-id="d6a4b-194">As regras de autorização são definidas dentro de `<system.web>` elemento no `Web.config` e se aplicam a todos os recursos do ASP.NET no aplicativo web.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-194">The authorization rules are defined within the `<system.web>` element in `Web.config` and apply to all of the ASP.NET resources in the web application.</span></span> <span data-ttu-id="d6a4b-195">Muitas vezes, um aplicativo tem diferentes regras de autorização para seções diferentes.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-195">Oftentimes, an application has different authorization rules for different sections.</span></span> <span data-ttu-id="d6a4b-196">Por exemplo, em um site de comércio eletrônico, todos os visitantes podem examinar os produtos, consulte as análises do produto, o catálogo de pesquisa e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-196">For example, at an eCommerce site, all visitors may peruse the products, see product reviews, search the catalog, and so on.</span></span> <span data-ttu-id="d6a4b-197">No entanto, somente usuários autenticados podem alcançar o check-out ou as páginas para gerenciar um histórico de envio.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-197">However, only authenticated users may reach the checkout or the pages to manage one's shipping history.</span></span> <span data-ttu-id="d6a4b-198">Além disso, pode haver partes do site que são acessíveis apenas pelos selecionar usuários, como os administradores de sites.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-198">Moreover, there may be portions of the site that are only accessible by select users, such as site administrators.</span></span>

<span data-ttu-id="d6a4b-199">ASP.NET facilita definir regras de autorização diferentes para diferentes arquivos e pastas no site.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-199">ASP.NET makes it easy to define different authorization rules for different files and folders in the site.</span></span> <span data-ttu-id="d6a4b-200">As regras de autorização especificadas na pasta raiz `Web.config` arquivo se aplicam a todos os recursos do ASP.NET no site.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-200">The authorization rules specified in the root folder's `Web.config` file apply to all ASP.NET resources in the site.</span></span> <span data-ttu-id="d6a4b-201">No entanto, essas configurações de autorização padrão podem ser substituídas para uma pasta específica, adicionando um `Web.config` com um `<authorization>` seção.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-201">However, these default authorization settings can be overridden for a particular folder by adding a `Web.config` with an `<authorization>` section.</span></span>

<span data-ttu-id="d6a4b-202">Vamos atualizar nosso site para que somente usuários autenticados podem visitar páginas ASP.NET o `Membership` pasta.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-202">Let's update our website so that only authenticated users can visit the ASP.NET pages in the `Membership` folder.</span></span> <span data-ttu-id="d6a4b-203">Para fazer isso, precisamos adicionar um `Web.config` o arquivo para o `Membership` pasta e definir suas configurações de autorização para negar a usuários anônimos.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-203">To accomplish this we need to add a `Web.config` file to the `Membership` folder and set its authorization settings to deny anonymous users.</span></span> <span data-ttu-id="d6a4b-204">Clique com botão direito do `Membership` pasta no Gerenciador de soluções, escolha o menu Adicionar Novo Item de menu de contexto e adicionar um novo arquivo de configuração da Web denominado `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-204">Right-click the `Membership` folder in the Solution Explorer, choose the Add New Item menu from the context menu, and add a new Web Configuration File named `Web.config`.</span></span>


<span data-ttu-id="d6a4b-205">[![Adicionar um arquivo Web. config na pasta de associação](user-based-authorization-cs/_static/image8.png)](user-based-authorization-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="d6a4b-205">[![Add a Web.config File to the Membership Folder](user-based-authorization-cs/_static/image8.png)](user-based-authorization-cs/_static/image7.png)</span></span>

<span data-ttu-id="d6a4b-206">**Figura 3**: adicionar um `Web.config` o arquivo para o `Membership` pasta ([clique para exibir a imagem em tamanho normal](user-based-authorization-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="d6a4b-206">**Figure 3**: Add a `Web.config` File to the `Membership` Folder  ([Click to view full-size image](user-based-authorization-cs/_static/image9.png))</span></span>


<span data-ttu-id="d6a4b-207">O projeto agora deve conter dois `Web.config` arquivos: um no diretório raiz e outro no `Membership` pasta.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-207">At this point your project should contain two `Web.config` files: one in the root directory and one in the `Membership` folder.</span></span>


<span data-ttu-id="d6a4b-208">[![Seu aplicativo agora deve conter dois arquivos Web. config](user-based-authorization-cs/_static/image11.png)](user-based-authorization-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="d6a4b-208">[![Your Application Should Now Contain Two Web.config Files](user-based-authorization-cs/_static/image11.png)](user-based-authorization-cs/_static/image10.png)</span></span>

<span data-ttu-id="d6a4b-209">**Figura 4**: seu aplicativo deve agora contém duas `Web.config` arquivos ([clique para exibir a imagem em tamanho normal](user-based-authorization-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="d6a4b-209">**Figure 4**: Your Application Should Now Contain Two `Web.config` Files  ([Click to view full-size image](user-based-authorization-cs/_static/image12.png))</span></span>


<span data-ttu-id="d6a4b-210">Atualizar o arquivo de configuração no `Membership` pasta para que ele impede o acesso a usuários anônimos.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-210">Update the configuration file in the `Membership` folder so that it prohibits access to anonymous users.</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample4.xml)]

<span data-ttu-id="d6a4b-211">Isso é tudo que é necessário para que ele!</span><span class="sxs-lookup"><span data-stu-id="d6a4b-211">That's all there is to it!</span></span>

<span data-ttu-id="d6a4b-212">Para testar essa alteração, visite a home page em um navegador e verifique se que você estiver desconectado. Como o comportamento padrão de um aplicativo ASP.NET é permitir que todos os visitantes, e como podemos não faça as modificações de autorização para do diretório raiz `Web.config` arquivo, somos capazes de visitar os arquivos no diretório raiz como um visitante anônimo.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-212">To test out this change, visit the homepage in a browser and make sure you are logged out. Since the default behavior of an ASP.NET application is to allow all visitors, and since we didn't make any authorization modifications to the root directory's `Web.config` file, we are able to visit the files in the root directory as an anonymous visitor.</span></span>

<span data-ttu-id="d6a4b-213">Clique no link criar contas de usuário encontrado na coluna esquerda.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-213">Click on the Creating User Accounts link found in the left column.</span></span> <span data-ttu-id="d6a4b-214">Isso o levará para a `~/Membership/CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-214">This will take you to the `~/Membership/CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="d6a4b-215">Desde o `Web.config` arquivo o `Membership` pasta define as regras de autorização para proibir o acesso anônimo, o `UrlAuthorizationModule` anula a solicitação e retorna um status HTTP 401 não autorizado.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-215">Since the `Web.config` file in the `Membership` folder defines authorization rules to prohibit anonymous access, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="d6a4b-216">O `FormsAuthenticationModule` modifica isso para um status 302 do redirecionamento, enviar a página de logon.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-216">The `FormsAuthenticationModule` modifies this to a 302 Redirect status, sending us to the login page.</span></span> <span data-ttu-id="d6a4b-217">Observe que a página é está tentando acessar (`CreatingUserAccounts.aspx`) é passada para a página de logon por meio de `ReturnUrl` parâmetro querystring.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-217">Note that the page we were attempting to access (`CreatingUserAccounts.aspx`) is passed to the login page via the `ReturnUrl` querystring parameter.</span></span>


<span data-ttu-id="d6a4b-218">[![Desde o URL de autorização regras proibir o acesso anônimo, podemos são redirecionados para a página de logon](user-based-authorization-cs/_static/image14.png)](user-based-authorization-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="d6a4b-218">[![Since the URL Authorization Rules Prohibit Anonymous Access, We are Redirected to the Login Page](user-based-authorization-cs/_static/image14.png)](user-based-authorization-cs/_static/image13.png)</span></span>

<span data-ttu-id="d6a4b-219">**Figura 5**: desde que a autorização de URL regras proibir o acesso anônimo, são redirecionados para a página de logon ([clique para exibir a imagem em tamanho normal](user-based-authorization-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="d6a4b-219">**Figure 5**: Since the URL Authorization Rules Prohibit Anonymous Access, We are Redirected to the Login Page  ([Click to view full-size image](user-based-authorization-cs/_static/image15.png))</span></span>


<span data-ttu-id="d6a4b-220">Após fazer logon com êxito, são redirecionados para a `CreatingUserAccounts.aspx` página.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-220">Upon successfully logging in, we are redirected to the `CreatingUserAccounts.aspx` page.</span></span> <span data-ttu-id="d6a4b-221">Neste momento o `UrlAuthorizationModule` permite o acesso para a página porque não estamos mais anônimos.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-221">This time the `UrlAuthorizationModule` permits access to the page because we are no longer anonymous.</span></span>

### <a name="applying-url-authorization-rules-to-a-specific-location"></a><span data-ttu-id="d6a4b-222">Aplicar regras de autorização de URL para um local específico</span><span class="sxs-lookup"><span data-stu-id="d6a4b-222">Applying URL Authorization Rules to a Specific Location</span></span>

<span data-ttu-id="d6a4b-223">As configurações de autorização definidas no `<system.web>` seção `Web.config` se aplicam a todos os recursos do ASP.NET no diretório e seus subdiretórios (até que seja substituído por outro `Web.config` arquivo).</span><span class="sxs-lookup"><span data-stu-id="d6a4b-223">The authorization settings defined in the `<system.web>` section of `Web.config` apply to all of the ASP.NET resources in that directory and its subdirectories (until otherwise overridden by another `Web.config` file).</span></span> <span data-ttu-id="d6a4b-224">Em alguns casos, porém, devemos todos os recursos do ASP.NET em um diretório especificado para ter uma configuração específica de autorização, exceto uma ou duas páginas específicas.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-224">In some cases, though, we may want all ASP.NET resources in a given directory to have a particular authorization configuration except for one or two specific pages.</span></span> <span data-ttu-id="d6a4b-225">Isso pode ser feito adicionando uma `<location>` elemento `Web.config`apontá-lo para o arquivo cujas regras de autorização são diferentes e definindo suas regras de autorização exclusiva nele.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-225">This can be achieved by adding a `<location>` element in `Web.config`, pointing it to the file whose authorization rules differ, and defining its unique authorization rules therein.</span></span>

<span data-ttu-id="d6a4b-226">Para ilustrar o uso de `<location>` elemento para substituir as definições de configuração para um recurso específico, vamos personalizar as configurações de autorização para que somente Tito pode visitar `CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-226">To illustrate using the `<location>` element to override the configuration settings for a specific resource, let's customize the authorization settings so that only Tito can visit `CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="d6a4b-227">Para fazer isso, adicione um `<location>` elemento para o `Membership` da pasta `Web.config` de arquivos e atualizar sua marcação para que ele se parece com o seguinte:</span><span class="sxs-lookup"><span data-stu-id="d6a4b-227">To accomplish this, add a `<location>` element to the `Membership` folder's `Web.config` file and update its markup so that it looks like the following:</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample5.xml)]

<span data-ttu-id="d6a4b-228">O `<authorization>` elemento `<system.web>` define as regras de autorização de URL padrão para recursos ASP.NET no `Membership` pasta e suas subpastas.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-228">The `<authorization>` element in `<system.web>` defines the default URL authorization rules for ASP.NET resources in the `Membership` folder and its subfolders.</span></span> <span data-ttu-id="d6a4b-229">O `<location>` elemento nos permite substituir essas regras para um recurso específico.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-229">The `<location>` element allows us to override these rules for a particular resource.</span></span> <span data-ttu-id="d6a4b-230">Na marcação acima de `<location>` referências de elementos de `CreatingUserAccounts.aspx` página e especifica sua autorização regras para permitir Tito, mas negar todas as outras pessoas.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-230">In the above markup the `<location>` element references the `CreatingUserAccounts.aspx` page and specifies its authorization rules such as to allow Tito, but deny everyone else.</span></span>

<span data-ttu-id="d6a4b-231">Para testar essa alteração de autorização, inicie visitando o site como um usuário anônimo.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-231">To test out this authorization change, start by visiting the website as an anonymous user.</span></span> <span data-ttu-id="d6a4b-232">Se você tentar visitar qualquer página no `Membership` pasta, tais como `UserBasedAuthorization.aspx`, o `UrlAuthorizationModule` negará a solicitação e você será redirecionado à página de logon.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-232">If you attempt to visit any page in the `Membership` folder, such as `UserBasedAuthorization.aspx`, the `UrlAuthorizationModule` will deny the request and you will be redirected to the login page.</span></span> <span data-ttu-id="d6a4b-233">Depois de fazer logon como, digamos, Scott, você pode visitar qualquer página de `Membership` pasta *exceto* para `CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-233">After logging in as, say, Scott, you can visit any page in the `Membership` folder *except* for `CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="d6a4b-234">Tentando visite `CreatingUserAccounts.aspx` logon como qualquer pessoa, mas Tito resultará em uma tentativa de acesso não autorizado, redirecionando você volta para a página de logon.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-234">Attempting to visit `CreatingUserAccounts.aspx` logged on as anyone but Tito will result in an unauthorized access attempt, redirecting you back to the login page.</span></span>

> [!NOTE]
> <span data-ttu-id="d6a4b-235">O `<location>` elemento deve aparecer fora da configuração `<system.web>` elemento.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-235">The `<location>` element must appear outside of the configuration's `<system.web>` element.</span></span> <span data-ttu-id="d6a4b-236">Você precisa usar um separado `<location>` elemento para cada recurso cujas configurações de autorização que você deseja substituir.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-236">You need to use a separate `<location>` element for each resource whose authorization settings you want to override.</span></span>


### <a name="a-look-at-how-theurlauthorizationmoduleuses-the-authorization-rules-to-grant-or-deny-access"></a><span data-ttu-id="d6a4b-237">Uma olhada em como o`UrlAuthorizationModule`usa as regras de autorização para conceder ou negar acesso</span><span class="sxs-lookup"><span data-stu-id="d6a4b-237">A Look at How the`UrlAuthorizationModule`Uses the Authorization Rules to Grant or Deny Access</span></span>

<span data-ttu-id="d6a4b-238">O `UrlAuthorizationModule` determina se autorizar uma identidade específica de uma URL específica, analisando a autorização de URL regras para um de cada vez, começando da primeira e trabalhar sua forma para baixo.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-238">The `UrlAuthorizationModule` determines whether to authorize a particular identity for a particular URL by analyzing the URL authorization rules one at a time, starting from the first one and working its way down.</span></span> <span data-ttu-id="d6a4b-239">Assim que uma correspondência for encontrada, o usuário é concedido ou negado o acesso, dependendo se a correspondência foi encontrada em um `<allow>` ou `<deny>` elemento.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-239">As soon as a match is found, the user is granted or denied access, depending on if the match was found in an `<allow>` or `<deny>` element.</span></span> <span data-ttu-id="d6a4b-240"><strong>Se nenhuma correspondência for encontrada, é concedido acesso ao usuário.</strong></span><span class="sxs-lookup"><span data-stu-id="d6a4b-240"><strong>If no match is found, the user is granted access.</strong></span></span> <span data-ttu-id="d6a4b-241">Consequentemente, se você quiser restringir o acesso, é essencial que você use um `<deny>` como o último elemento na configuração de autorização de URL.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-241">Consequently, if you want to restrict access, it is imperative that you use a `<deny>` element as the last element in the URL authorization configuration.</span></span> <span data-ttu-id="d6a4b-242"><strong>Se você omitir um</strong><strong>`<deny>`</strong><strong>elemento, todos os usuários terão acesso.</strong></span><span class="sxs-lookup"><span data-stu-id="d6a4b-242"><strong>If you omit a</strong><strong>`<deny>`</strong><strong>element, all users will be granted access.</strong></span></span>

<span data-ttu-id="d6a4b-243">Para entender melhor o processo usado pelo `UrlAuthorizationModule` para determinar a autoridade, considere o exemplo observamos anteriormente nessa etapa de regras de autorização de URL.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-243">To better understand the process used by the `UrlAuthorizationModule` to determine authority, consider the example URL authorization rules we looked at earlier in this step.</span></span> <span data-ttu-id="d6a4b-244">A primeira regra é um `<allow>` elemento que permite o acesso a Tito e Scott.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-244">The first rule is an `<allow>` element that allows access to Tito and Scott.</span></span> <span data-ttu-id="d6a4b-245">As regras de segundo é um `<deny>` elemento que nega o acesso a todos os usuários.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-245">The second rules is a `<deny>` element that denies access to everyone.</span></span> <span data-ttu-id="d6a4b-246">Se um usuário anônimo acessa, o `UrlAuthorizationModule` começa por solicitar, é anônimo Scott ou Tito?</span><span class="sxs-lookup"><span data-stu-id="d6a4b-246">If an anonymous user visits, the `UrlAuthorizationModule` starts by asking, Is anonymous either Scott or Tito?</span></span> <span data-ttu-id="d6a4b-247">A resposta, obviamente, é não, portanto ele prossegue para a segunda regra.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-247">The answer, obviously, is No, so it proceeds to the second rule.</span></span> <span data-ttu-id="d6a4b-248">É anônimo no conjunto de todas as pessoas?</span><span class="sxs-lookup"><span data-stu-id="d6a4b-248">Is anonymous in the set of everybody?</span></span> <span data-ttu-id="d6a4b-249">Desde que a resposta Sim, aqui está o `<deny>` regra é colocada em vigor e o visitante é redirecionado para a página de logon.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-249">Since the answer here is Yes, the `<deny>` rule is put in effect and the visitor is redirected to the login page.</span></span> <span data-ttu-id="d6a4b-250">Da mesma forma, se está visitando Jisun, o `UrlAuthorizationModule` começa perguntando é Jisun Scott ou Tito?</span><span class="sxs-lookup"><span data-stu-id="d6a4b-250">Similarly, if Jisun is visiting, the `UrlAuthorizationModule` starts by asking, Is Jisun either Scott or Tito?</span></span> <span data-ttu-id="d6a4b-251">Desde que ela não for, o `UrlAuthorizationModule` continua para a segunda pergunta, Jisun está no conjunto de todas as pessoas?</span><span class="sxs-lookup"><span data-stu-id="d6a4b-251">Since she is not, the `UrlAuthorizationModule` proceeds to the second question, Is Jisun in the set of everybody?</span></span> <span data-ttu-id="d6a4b-252">Ela é, portanto ela, também terá o acesso negada.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-252">She is, so she, too, is denied access.</span></span> <span data-ttu-id="d6a4b-253">Por fim, se Tito visita, a primeira pergunta representado pelo `UrlAuthorizationModule` é uma resposta afirmativa, portanto, Tito tem acesso.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-253">Finally, if Tito visits, the first question posed by the `UrlAuthorizationModule` is an affirmative answer, so Tito is granted access.</span></span>

<span data-ttu-id="d6a4b-254">Desde o `UrlAuthorizationModule` processos de regras de autorização de cima para baixo, parando em qualquer correspondência, é importante para que as regras mais específicas vir antes dos menos específicos.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-254">Since the `UrlAuthorizationModule` processes the authorization rules from the top down, stopping at any match, it is important to have the more specific rules come before the less specific ones.</span></span> <span data-ttu-id="d6a4b-255">Ou seja, para definir regras de autorização que proíbam Jisun e os usuários anônimos, mas permitir que todos os outros usuários autenticados, você deve iniciar com a regra mais específica - o Jisun afetar um - e vá para as regras menos específicas - as permitindo que todos os outros os usuários autenticados, mas negar a todos os usuários anônimos.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-255">That is, to define authorization rules that forbid Jisun and anonymous users, but allow all other authenticated users, you would start with the most specific rule - the one impacting Jisun - and then proceed to the less specific rules - those allowing all other authenticated users, but denying all anonymous users.</span></span> <span data-ttu-id="d6a4b-256">As regras de autorização de URL a seguir implementa esta diretiva Negar primeiro Jisun e, em seguida, negando qualquer usuário anônimo.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-256">The following URL authorization rules implements this policy by first denying Jisun, and then denying any anonymous user.</span></span> <span data-ttu-id="d6a4b-257">Qualquer usuário autenticado que não seja Jisun será concedido acesso porque nenhuma delas `<deny>` instruções fará a correspondência.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-257">Any authenticated user other than Jisun will be granted access because neither of these `<deny>` statements will match.</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample6.xml)]

## <a name="step-2-fixing-the-workflow-for-unauthorized-authenticated-users"></a><span data-ttu-id="d6a4b-258">Etapa 2: Corrigir o fluxo de trabalho para que os usuários não autorizados, autenticados</span><span class="sxs-lookup"><span data-stu-id="d6a4b-258">Step 2: Fixing the Workflow for Unauthorized, Authenticated Users</span></span>

<span data-ttu-id="d6a4b-259">Conforme abordado anteriormente neste tutorial na examinar a seção do fluxo de trabalho de autorização de URL, a qualquer momento uma solicitação não autorizada ocorre, o `UrlAuthorizationModule` anula a solicitação e retorna um status HTTP 401 não autorizado.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-259">As we discussed earlier in this tutorial in the A Look at the URL Authorization Workflow section, anytime an unauthorized request transpires, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="d6a4b-260">Esse status 401 é modificado o `FormsAuthenticationModule` em um 302 redirecionamento status que envia o usuário para a página de logon.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-260">This 401 status is modified by the `FormsAuthenticationModule` into a 302 Redirect status that sends the user to the login page.</span></span> <span data-ttu-id="d6a4b-261">Este fluxo de trabalho ocorre em qualquer solicitação não autorizada, mesmo se o usuário é autenticado.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-261">This workflow occurs on any unauthorized request, even if the user is authenticated.</span></span>

<span data-ttu-id="d6a4b-262">Retornar um usuário autenticado para a página de logon é provavelmente confundidos porque eles já fez no sistema.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-262">Returning an authenticated user to the login page is likely to confuse them since they have already logged into the system.</span></span> <span data-ttu-id="d6a4b-263">Com um pouco de trabalho, podemos melhorar o fluxo de trabalho redirecionando os usuários autenticados que fazem solicitações não autorizadas em uma página que explica o que eles tentaram acessar uma página restrita.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-263">With a little bit of work we can improve this workflow by redirecting authenticated users who make unauthorized requests to a page that explains that they have attempted to access a restricted page.</span></span>

<span data-ttu-id="d6a4b-264">Comece criando uma nova página ASP.NET na pasta raiz do aplicativo da web do denominada `UnauthorizedAccess.aspx`; não se esqueça de associar a essa página com o `Site.master` página mestra.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-264">Start by creating a new ASP.NET page in the web application's root folder named `UnauthorizedAccess.aspx`; don't forget to associate this page with the `Site.master` master page.</span></span> <span data-ttu-id="d6a4b-265">Depois de criar essa página, remova o controle de conteúdo que faz referência a `LoginContent` ContentPlaceHolder para que a página mestra conteúdo padrão do será exibida.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-265">After creating this page, remove the Content control that references the `LoginContent` ContentPlaceHolder so that the master page's default content will be displayed.</span></span> <span data-ttu-id="d6a4b-266">Em seguida, adicione uma mensagem que explica a situação, isto é que o usuário tentou acessar um recurso protegido.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-266">Next, add a message that explains the situation, namely that the user attempted to access a protected resource.</span></span> <span data-ttu-id="d6a4b-267">Depois de adicionar a mensagem, o `UnauthorizedAccess.aspx` declarativo da página deve ser semelhante à seguinte:</span><span class="sxs-lookup"><span data-stu-id="d6a4b-267">After adding such a message, the `UnauthorizedAccess.aspx` page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample7.aspx)]

<span data-ttu-id="d6a4b-268">Agora, precisamos alterar o fluxo de trabalho para que se uma solicitação não autorizada é executada por um usuário autenticado que elas são enviadas para o `UnauthorizedAccess.aspx` página em vez da página de logon.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-268">We now need to alter the workflow so that if an unauthorized request is performed by an authenticated user they are sent to the `UnauthorizedAccess.aspx` page instead of the login page.</span></span> <span data-ttu-id="d6a4b-269">A lógica que redireciona solicitações não autorizadas a página de logon é inserida dentro de um método privado a `FormsAuthenticationModule` classe, portanto, não é possível personalizar esse comportamento.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-269">The logic that redirects unauthorized requests to the login page is buried within a private method of the `FormsAuthenticationModule` class, so we cannot customize this behavior.</span></span> <span data-ttu-id="d6a4b-270">O que podemos fazer, no entanto, é adicionar nossa própria lógica para a página de logon que redireciona o usuário para `UnauthorizedAccess.aspx`, se necessário.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-270">What we can do, however, is add our own logic to the login page that redirects the user to `UnauthorizedAccess.aspx`, if needed.</span></span>

<span data-ttu-id="d6a4b-271">Quando o `FormsAuthenticationModule` redireciona um visitante não autorizado a página de logon, ele adiciona a URL solicitada, não autorizada para querystring com o nome `ReturnUrl`.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-271">When the `FormsAuthenticationModule` redirects an unauthorized visitor to the login page it appends the requested, unauthorized URL to the querystring with the name `ReturnUrl`.</span></span> <span data-ttu-id="d6a4b-272">Por exemplo, se um usuário não autorizado tentou visitar `OnlyTito.aspx`, o `FormsAuthenticationModule` seria redirecioná-los para `Login.aspx?ReturnUrl=OnlyTito.aspx`.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-272">For example, if an unauthorized user attempted to visit `OnlyTito.aspx`, the `FormsAuthenticationModule` would redirect them to `Login.aspx?ReturnUrl=OnlyTito.aspx`.</span></span> <span data-ttu-id="d6a4b-273">Portanto, se a página de logon é alcançada por um usuário autenticado com uma querystring que inclui o `ReturnUrl` parâmetro, em seguida, podemos saber que esse usuário não autenticado apenas tentou visitar uma página que não está autorizada a exibir.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-273">Therefore, if the login page is reached by an authenticated user with a querystring that includes the `ReturnUrl` parameter, then we know that this unauthenticated user just attempted to visit a page she is not authorized to view.</span></span> <span data-ttu-id="d6a4b-274">Nesse caso, queremos redirecionar para `UnauthorizedAccess.aspx`.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-274">In such a case, we want to redirect her to `UnauthorizedAccess.aspx`.</span></span>

<span data-ttu-id="d6a4b-275">Para fazer isso, adicione o seguinte código para a página de logon `Page_Load` manipulador de eventos:</span><span class="sxs-lookup"><span data-stu-id="d6a4b-275">To accomplish this, add the following code to the login page's `Page_Load` event handler:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample8.cs)]

<span data-ttu-id="d6a4b-276">O código acima redireciona autenticados, não autorizados aos usuários o `UnauthorizedAccess.aspx` página.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-276">The above code redirects authenticated, unauthorized users to the `UnauthorizedAccess.aspx` page.</span></span> <span data-ttu-id="d6a4b-277">Para ver essa lógica em ação, visite o site como um visitante anônimo e clique no link criar contas de usuário na coluna esquerda.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-277">To see this logic in action, visit the site as an anonymous visitor and click on the Creating User Accounts link in the left column.</span></span> <span data-ttu-id="d6a4b-278">Isso o levará para a `~/Membership/CreatingUserAccounts.aspx` página, que, na etapa 1 são configurados apenas para permitir o acesso a Tito.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-278">This will take you to the `~/Membership/CreatingUserAccounts.aspx` page, which in Step 1 we configured to only permit access to Tito.</span></span> <span data-ttu-id="d6a4b-279">Desde que os usuários anônimos são proibidos, o `FormsAuthenticationModule` redireciona nos de volta para a página de logon.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-279">Since anonymous users are prohibited, the `FormsAuthenticationModule` redirects us back to the login page.</span></span>

<span data-ttu-id="d6a4b-280">Agora estamos anônimos, portanto `Request.IsAuthenticated` retorna `false` e não são redirecionados para `UnauthorizedAccess.aspx`.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-280">At this point we are anonymous, so `Request.IsAuthenticated` returns `false` and we are not redirected to `UnauthorizedAccess.aspx`.</span></span> <span data-ttu-id="d6a4b-281">Em vez disso, a página de logon é exibida.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-281">Instead, the login page is displayed.</span></span> <span data-ttu-id="d6a4b-282">Faça logon como um usuário diferente Tito como Bruce.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-282">Log in as a user other than Tito, such as Bruce.</span></span> <span data-ttu-id="d6a4b-283">Depois de inserir as credenciais apropriadas, o logon página redireciona nos de volta ao `~/Membership/CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-283">After entering the appropriate credentials, the login page redirects us back to `~/Membership/CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="d6a4b-284">No entanto, como essa página só está acessível para Tito, vamos são não autorizados para exibi-lo e retorna imediatamente para a página de logon.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-284">However, since this page is only accessible to Tito, we are unauthorized to view it and are promptly returned to the login page.</span></span> <span data-ttu-id="d6a4b-285">Neste momento, no entanto, `Request.IsAuthenticated` retorna `true` (e o `ReturnUrl` parâmetro querystring existe), portanto, podemos são redirecionados para o `UnauthorizedAccess.aspx` página.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-285">This time, however, `Request.IsAuthenticated` returns `true` (and the `ReturnUrl` querystring parameter exists), so we are redirected to the `UnauthorizedAccess.aspx` page.</span></span>


<span data-ttu-id="d6a4b-286">[![Autenticado, os usuários não autorizados são redirecionados para UnauthorizedAccess.aspx](user-based-authorization-cs/_static/image17.png)](user-based-authorization-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="d6a4b-286">[![Authenticated, Unauthorized Users are Redirected to UnauthorizedAccess.aspx](user-based-authorization-cs/_static/image17.png)](user-based-authorization-cs/_static/image16.png)</span></span>

<span data-ttu-id="d6a4b-287">**Figura 6**: autenticado, os usuários não autorizados são redirecionados para `UnauthorizedAccess.aspx` ([clique para exibir a imagem em tamanho normal](user-based-authorization-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="d6a4b-287">**Figure 6**: Authenticated, Unauthorized Users are Redirected to `UnauthorizedAccess.aspx` ([Click to view full-size image](user-based-authorization-cs/_static/image18.png))</span></span>


<span data-ttu-id="d6a4b-288">Este fluxo de trabalho personalizado apresenta uma experiência de usuário mais adequado e simples por circuito pequeno o ciclo ilustrado na Figura 2.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-288">This customized workflow presents a more sensible and straightforward user experience by short circuiting the cycle depicted in Figure 2.</span></span>

## <a name="step-3-limiting-functionality-based-on-the-currently-logged-in-user"></a><span data-ttu-id="d6a4b-289">Etapa 3: Limitar funcionalidade com base no usuário conectado no momento</span><span class="sxs-lookup"><span data-stu-id="d6a4b-289">Step 3: Limiting Functionality Based on the Currently Logged In User</span></span>

<span data-ttu-id="d6a4b-290">Autorização de URL facilita especificar regras de autorização grosso.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-290">URL authorization makes it easy to specify coarse authorization rules.</span></span> <span data-ttu-id="d6a4b-291">Como vimos na etapa 1, com a autorização de URL é pode sutilmente quais identidades são permitidas e quais têm permissão para exibir uma página específica ou todas as páginas em uma pasta.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-291">As we saw in Step 1, with URL authorization we can succinctly state what identities are permitted and which ones are denied from viewing a particular page or all pages in a folder.</span></span> <span data-ttu-id="d6a4b-292">Em determinados cenários, no entanto, podemos querer que todos os usuários a visitar uma página, mas limitar a funcionalidade da página com base no usuário visitando.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-292">In certain scenarios, however, we may want to allow all users to visit a page, but limit the page's functionality based on the user visiting it.</span></span>

<span data-ttu-id="d6a4b-293">Considere o caso de um site de comércio eletrônico que permite que os visitantes autenticados examinar seus produtos.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-293">Consider the case of an eCommerce website that allows authenticated visitors to review their products.</span></span> <span data-ttu-id="d6a4b-294">Quando um usuário anônimo acessa a página do produto, eles seriam veja apenas as informações de produto e não seriam fornecidos a oportunidade de deixar uma revisão.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-294">When an anonymous user visits a product's page, they would see just the product information and would not be given the opportunity to leave a review.</span></span> <span data-ttu-id="d6a4b-295">No entanto, um usuário autenticado visitando a mesma página veria a interface de revisão.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-295">However, an authenticated user visiting the same page would see the reviewing interface.</span></span> <span data-ttu-id="d6a4b-296">Se o usuário autenticado ainda não tiver revisado para este produto, a interface permitisse ao enviar uma revisão; Caso contrário, ele seria mostrá-los a análise enviados anteriormente.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-296">If the authenticated user had not yet reviewed this product, the interface would enable them to submit a review; otherwise it would show them their previously-submitted review.</span></span> <span data-ttu-id="d6a4b-297">Para dar um passo para esse cenário ainda mais, a página pode mostrar informações adicionais e oferecem recursos estendidos para os usuários que trabalham para a empresa de comércio eletrônico.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-297">To take this scenario a step further, the product page might show additional information and offer extended features for those users that work for the eCommerce company.</span></span> <span data-ttu-id="d6a4b-298">Por exemplo, a página pode listar o inventário em estoque e incluem opções para editar o preço do produto e a descrição quando visitado por um funcionário.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-298">For example, the product page might list the inventory in stock and include options to edit the product's price and description when visited by an employee.</span></span>

<span data-ttu-id="d6a4b-299">Essas regras de autorização refinadas podem ser implementadas declarativamente ou por meio de programação (ou por meio de uma combinação dos dois).</span><span class="sxs-lookup"><span data-stu-id="d6a4b-299">Such fine grain authorization rules can be implemented either declaratively or programmatically (or through some combination of the two).</span></span> <span data-ttu-id="d6a4b-300">Na próxima seção, veremos como implementar a autorização refinadas por meio do controle LoginView.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-300">In the next section we will see how to implement fine grain authorization via the LoginView control.</span></span> <span data-ttu-id="d6a4b-301">Depois disso, iremos explorar as técnicas de programação.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-301">Following that, we will explore programmatic techniques.</span></span> <span data-ttu-id="d6a4b-302">Antes que podemos ver a aplicação de regras de autorização refinadas, no entanto, primeiro precisamos criar uma página cuja funcionalidade depende do usuário visitando.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-302">Before we can look at applying fine grain authorization rules, however, we first need to create a page whose functionality depends on the user visiting it.</span></span>

<span data-ttu-id="d6a4b-303">Vamos criar uma página que lista os arquivos em um diretório específico dentro de um controle GridView.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-303">Let's create a page that lists the files in a particular directory within a GridView.</span></span> <span data-ttu-id="d6a4b-304">Junto com cada nome de arquivo, tamanho e outras informações de listagem, GridView inclui duas colunas de botões de link: um modo de exibição e exclua intitulada, denominado.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-304">Along with listing each file's name, size, and other information, the GridView will include two columns of LinkButtons: one titled View and one titled Delete.</span></span> <span data-ttu-id="d6a4b-305">Se o modo de exibição LinkButton é clicado, o conteúdo do arquivo selecionado será exibido; Se você clicar no botão Excluir LinkButton, o arquivo será excluído.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-305">If the View LinkButton is clicked, the contents of the selected file will be displayed; if the Delete LinkButton is clicked, the file will be deleted.</span></span> <span data-ttu-id="d6a4b-306">Vamos criar inicialmente nessa página, de modo que sua funcionalidade de exibição e delete está disponível para todos os usuários.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-306">Let's initially create this page such that its view and delete functionality is available to all users.</span></span> <span data-ttu-id="d6a4b-307">No usando as seções de controle LoginView e limitar funcionalidade por meio de programação, veremos como habilitar ou desabilitar esses recursos com base no usuário visitar a página.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-307">In the Using the LoginView Control and Programmatically Limiting Functionality sections we will see how to enable or disable these features based on the user visiting the page.</span></span>

> [!NOTE]
> <span data-ttu-id="d6a4b-308">A página do ASP.NET que está prestes a criar usa um controle GridView para exibir uma lista de arquivos.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-308">The ASP.NET page we are about to build uses a GridView control to display a list of files.</span></span> <span data-ttu-id="d6a4b-309">Desde que este tutorial série se concentra em formulários de autenticação, autorização, contas de usuário e funções, não desejo gastar muito tempo discutindo o funcionamento interno do controle GridView.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-309">Since this tutorial series focuses on forms authentication, authorization, user accounts, and roles, I do not want to spend too much time discussing the inner workings of the GridView control.</span></span> <span data-ttu-id="d6a4b-310">Enquanto este tutorial fornece instruções passo a passo específicas para a configuração nesta página, ele não entre em detalhes sobre por que certas escolhas feitas ou o que tem propriedades específicas do efeito na saída renderizada.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-310">While this tutorial provides specific step-by-step instructions for setting up this page, it does not delve into the details of why certain choices were made, or what effect particular properties have on the rendered output.</span></span> <span data-ttu-id="d6a4b-311">Para obter um exame completo do controle GridView, consulte Meus *[trabalhando com dados no ASP.NET 2.0](../../data-access/index.md)* série de tutoriais.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-311">For a thorough examination of the GridView control, consult my *[Working with Data in ASP.NET 2.0](../../data-access/index.md)* tutorial series.</span></span>


<span data-ttu-id="d6a4b-312">Comece abrindo o `UserBasedAuthorization.aspx` arquivo o `Membership` pasta e adicionando um controle GridView para a página chamada `FilesGrid`.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-312">Start by opening the `UserBasedAuthorization.aspx` file in the `Membership` folder and adding a GridView control to the page named `FilesGrid`.</span></span> <span data-ttu-id="d6a4b-313">Marca inteligente do GridView, clique no link de editar colunas para abrir a caixa de diálogo de campos.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-313">From the GridView's Smart Tag, click the Edit Columns link to launch the Fields dialog box.</span></span> <span data-ttu-id="d6a4b-314">Aqui, desmarque a caixa de campos de geração automática de seleção no canto inferior esquerdo.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-314">From here, uncheck the Auto-generate fields checkbox in the lower left corner.</span></span> <span data-ttu-id="d6a4b-315">Em seguida, adicione um botão de seleção, um botão de exclusão e dois BoundFields do canto superior esquerdo (os botões de seleção e Delete podem ser encontrados no tipo CommandField).</span><span class="sxs-lookup"><span data-stu-id="d6a4b-315">Next, add a Select button, a Delete button, and two BoundFields from the upper left corner (the Select and Delete buttons can be found under the CommandField type).</span></span> <span data-ttu-id="d6a4b-316">Definir o botão de seleção `SelectText` propriedade para exibição e o BoundField primeiro `HeaderText` e `DataField` propriedades de nome.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-316">Set the Select button's `SelectText` property to View and the first BoundField's `HeaderText` and `DataField` properties to Name.</span></span> <span data-ttu-id="d6a4b-317">Definir o BoundField segundo `HeaderText` propriedade para o tamanho em Bytes, seu `DataField` propriedade de comprimento, seu `DataFormatString` propriedade {0: n0} e sua `HtmlEncode` a propriedade como False.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-317">Set the second BoundField's `HeaderText` property to Size in Bytes, its `DataField` property to Length, its `DataFormatString` property to {0:N0} and its `HtmlEncode` property to False.</span></span>

<span data-ttu-id="d6a4b-318">Depois de configurar as colunas do GridView, clique em Okey para fechar a caixa de diálogo de campos.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-318">After configuring the GridView's columns, click OK to close the Fields dialog box.</span></span> <span data-ttu-id="d6a4b-319">Na janela Propriedades, defina o GridView `DataKeyNames` propriedade `FullName`.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-319">From the Properties window, set the GridView's `DataKeyNames` property to `FullName`.</span></span> <span data-ttu-id="d6a4b-320">Neste ponto declarativo do GridView deve parecer com o seguinte:</span><span class="sxs-lookup"><span data-stu-id="d6a4b-320">At this point the GridView's declarative markup should look like the following:</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample9.aspx)]

<span data-ttu-id="d6a4b-321">Com a marcação do GridView criada, estamos prontos para escrever o código que irá recuperar os arquivos em um diretório específico e associá-las a GridView.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-321">With the GridView's markup created, we're ready to write the code that will retrieve the files in a particular directory and bind them to the GridView.</span></span> <span data-ttu-id="d6a4b-322">Adicione o seguinte código para a página `Page_Load` manipulador de eventos:</span><span class="sxs-lookup"><span data-stu-id="d6a4b-322">Add the following code to the page's `Page_Load` event handler:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample10.cs)]

<span data-ttu-id="d6a4b-323">O código acima usa o [ `DirectoryInfo` classe](https://msdn.microsoft.com/library/system.io.directoryinfo.aspx) para obter uma lista dos arquivos na pasta raiz do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-323">The above code uses the [`DirectoryInfo` class](https://msdn.microsoft.com/library/system.io.directoryinfo.aspx) to obtain a list of the files in the application's root folder.</span></span> <span data-ttu-id="d6a4b-324">O [ `GetFiles()` método](https://msdn.microsoft.com/library/system.io.directoryinfo.getfiles.aspx) retorna todos os arquivos no diretório como uma matriz de [ `FileInfo` objetos](https://msdn.microsoft.com/library/system.io.fileinfo.aspx), que é associado a GridView.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-324">The [`GetFiles()` method](https://msdn.microsoft.com/library/system.io.directoryinfo.getfiles.aspx) returns all of the files in the directory as an array of [`FileInfo` objects](https://msdn.microsoft.com/library/system.io.fileinfo.aspx), which is then bound to the GridView.</span></span> <span data-ttu-id="d6a4b-325">O `FileInfo` objeto tem uma variedade de propriedades, como `Name`, `Length`, e `IsReadOnly`, entre outros.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-325">The `FileInfo` object has an assortment of properties, such as `Name`, `Length`, and `IsReadOnly`, among others.</span></span> <span data-ttu-id="d6a4b-326">Como você pode ver na sua marcação declarativa, GridView exibe apenas o `Name` e `Length` propriedades.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-326">As you can see from its declarative markup, the GridView displays just the `Name` and `Length` properties.</span></span>

> [!NOTE]
> <span data-ttu-id="d6a4b-327">O `DirectoryInfo` e `FileInfo` classes são encontradas no [ `System.IO` namespace](https://msdn.microsoft.com/library/system.io.aspx).</span><span class="sxs-lookup"><span data-stu-id="d6a4b-327">The `DirectoryInfo` and `FileInfo` classes are found in the [`System.IO` namespace](https://msdn.microsoft.com/library/system.io.aspx).</span></span> <span data-ttu-id="d6a4b-328">Portanto, você vai precisar iniciar esses nomes de classe com seus nomes de namespace ou ter o namespace importado para o arquivo de classe (via `using System.IO`).</span><span class="sxs-lookup"><span data-stu-id="d6a4b-328">Therefore, you will either need to preface these class names with their namespace names or have the namespace imported into the class file (via `using System.IO`).</span></span>


<span data-ttu-id="d6a4b-329">Aproveite a visitar a página através de um navegador.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-329">Take a moment to visit this page through a browser.</span></span> <span data-ttu-id="d6a4b-330">Ele exibirá a lista de arquivos que reside no diretório raiz do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-330">It will display the list of files residing in the application's root directory.</span></span> <span data-ttu-id="d6a4b-331">Clicar em qualquer um dos botões de link excluir ou exibição fará com que um postback, mas nenhuma ação ocorrerá porque temos ainda para criar os manipuladores de eventos necessários.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-331">Clicking any of the View or Delete LinkButtons will cause a postback, but no action will occur because we've yet to create the necessary event handlers.</span></span>


<span data-ttu-id="d6a4b-332">[![GridView lista os arquivos no diretório raiz do aplicativo Web](user-based-authorization-cs/_static/image20.png)](user-based-authorization-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="d6a4b-332">[![The GridView Lists the Files in the Web Application's Root Directory](user-based-authorization-cs/_static/image20.png)](user-based-authorization-cs/_static/image19.png)</span></span>

<span data-ttu-id="d6a4b-333">**Figura 7**: GridView lista os arquivos no diretório raiz do aplicativo Web ([clique para exibir a imagem em tamanho normal](user-based-authorization-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="d6a4b-333">**Figure 7**: The GridView Lists the Files in the Web Application's Root Directory  ([Click to view full-size image](user-based-authorization-cs/_static/image21.png))</span></span>


<span data-ttu-id="d6a4b-334">Precisamos de uma forma de exibir o conteúdo do arquivo selecionado.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-334">We need a means to display the contents of the selected file.</span></span> <span data-ttu-id="d6a4b-335">Retorne ao Visual Studio e adicionar uma caixa de texto denominada `FileContents` acima GridView.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-335">Return to Visual Studio and add a TextBox named `FileContents` above the GridView.</span></span> <span data-ttu-id="d6a4b-336">Definir seu `TextMode` propriedade `MultiLine` e sua `Columns` e `Rows` propriedades 95% e 10, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-336">Set its `TextMode` property to `MultiLine` and its `Columns` and `Rows` properties to 95% and 10, respectively.</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample11.aspx)]

<span data-ttu-id="d6a4b-337">Em seguida, crie um manipulador de eventos do GridView [ `SelectedIndexChanged` evento](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.selectedindexchanged.aspx) e adicione o seguinte código:</span><span class="sxs-lookup"><span data-stu-id="d6a4b-337">Next, create an event handler for the GridView's [`SelectedIndexChanged` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.selectedindexchanged.aspx) and add the following code:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample12.cs)]

<span data-ttu-id="d6a4b-338">Esse código usa o GridView `SelectedValue` propriedade para determinar o nome de arquivo completo do arquivo selecionado.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-338">This code uses the GridView's `SelectedValue` property to determine the full file name of the selected file.</span></span> <span data-ttu-id="d6a4b-339">Internamente, o `DataKeys` coleção é referenciada para obter o `SelectedValue`, portanto, é fundamental que você defina o GridView `DataKeyNames` propriedade com nome, conforme descrito anteriormente nesta etapa.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-339">Internally, the `DataKeys` collection is referenced in order to obtain the `SelectedValue`, so it is imperative that you set the GridView's `DataKeyNames` property to Name, as described earlier in this step.</span></span> <span data-ttu-id="d6a4b-340">O [ `File` classe](https://msdn.microsoft.com/library/system.io.file.aspx) é usado para ler o conteúdo do arquivo selecionado em uma cadeia de caracteres, que é então atribuído ao `FileContents` da caixa de texto `Text` propriedade, portanto, exibindo o conteúdo do arquivo selecionado na página.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-340">The [`File` class](https://msdn.microsoft.com/library/system.io.file.aspx) is used to read the selected file's contents into a string, which is then assigned to the `FileContents` TextBox's `Text` property, thereby displaying the contents of the selected file on the page.</span></span>


<span data-ttu-id="d6a4b-341">[![Conteúdo do arquivo selecionados é exibido na caixa de texto](user-based-authorization-cs/_static/image23.png)](user-based-authorization-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="d6a4b-341">[![The Selected File's Contents are Displayed in the TextBox](user-based-authorization-cs/_static/image23.png)](user-based-authorization-cs/_static/image22.png)</span></span>

<span data-ttu-id="d6a4b-342">**Figura 8**: do conteúdo do arquivo selecionado o é exibido na caixa de texto ([clique para exibir a imagem em tamanho normal](user-based-authorization-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="d6a4b-342">**Figure 8**: The Selected File's Contents are Displayed in the TextBox  ([Click to view full-size image](user-based-authorization-cs/_static/image24.png))</span></span>


> [!NOTE]
> <span data-ttu-id="d6a4b-343">Se você exibir o conteúdo de um arquivo que contém a marcação HTML e, em seguida, tenta exibir ou excluir um arquivo, você receberá um `HttpRequestValidationException` erro.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-343">If you view the contents of a file that contains HTML markup, and then attempt to view or delete a file, you will receive an `HttpRequestValidationException` error.</span></span> <span data-ttu-id="d6a4b-344">Isso ocorre porque, em um postback conteúdo da caixa de texto é enviado ao servidor web.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-344">This occurs because on postback the TextBox's contents are sent back to the web server.</span></span> <span data-ttu-id="d6a4b-345">Por padrão, o ASP.NET gera uma `HttpRequestValidationException` erro sempre que o conteúdo de postback potencialmente perigoso, como marcação HTML, é detectado.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-345">By default, ASP.NET raises an `HttpRequestValidationException` error whenever potentially dangerous postback content, such as HTML markup, is detected.</span></span> <span data-ttu-id="d6a4b-346">Para desabilitar esse erro ocorra, desative a validação de solicitação para a página adicionando `ValidateRequest="false"` para o `@Page` diretiva.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-346">To disable this error from occurring, turn off request validation for the page by adding `ValidateRequest="false"` to the `@Page` directive.</span></span> <span data-ttu-id="d6a4b-347">Para obter mais informações sobre os benefícios de validação de solicitação como bem como que precauções você deve tomar quando desabilitá-lo, leia [validação de solicitação - impedindo ataques de Script](https://asp.net/learn/whitepapers/request-validation/).</span><span class="sxs-lookup"><span data-stu-id="d6a4b-347">For more information on the benefits of request validation as well as what precautions you should take when disabling it, read [Request Validation - Preventing Script Attacks](https://asp.net/learn/whitepapers/request-validation/).</span></span>


<span data-ttu-id="d6a4b-348">Finalmente, adicione um manipulador de eventos com o seguinte código para o GridView [ `RowDeleting` evento](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowdeleting.aspx):</span><span class="sxs-lookup"><span data-stu-id="d6a4b-348">Finally, add an event handler with the following code for the GridView's [`RowDeleting` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowdeleting.aspx):</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample13.cs)]

<span data-ttu-id="d6a4b-349">O código simplesmente exibe o nome completo do arquivo para excluir o `FileContents` TextBox *sem* realmente excluir o arquivo.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-349">The code simply displays the full name of the file to delete in the `FileContents` TextBox *without* actually deleting the file.</span></span>


<span data-ttu-id="d6a4b-350">[![Clique no botão de exclusão não realmente excluir o arquivo](user-based-authorization-cs/_static/image26.png)](user-based-authorization-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="d6a4b-350">[![Clicking the Delete Button Does Not Actually Delete the File](user-based-authorization-cs/_static/image26.png)](user-based-authorization-cs/_static/image25.png)</span></span>

<span data-ttu-id="d6a4b-351">**Figura 9**: clicar a excluir botão não, na verdade, exclui o arquivo ([clique para exibir a imagem em tamanho normal](user-based-authorization-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="d6a4b-351">**Figure 9**: Clicking the Delete Button Does Not Actually Delete the File  ([Click to view full-size image](user-based-authorization-cs/_static/image27.png))</span></span>


<span data-ttu-id="d6a4b-352">Na etapa 1, configuramos as regras de autorização de URL para proibir que usuários anônimos exibindo as páginas de `Membership` pasta.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-352">In Step 1 we configured the URL authorization rules to prohibit anonymous users from viewing the pages in the `Membership` folder.</span></span> <span data-ttu-id="d6a4b-353">Para exibir melhor autenticação refinados, vamos permitir que usuários anônimos, visite o `UserBasedAuthorization.aspx` página, mas com funcionalidade limitada.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-353">In order to better exhibit fine grain authentication, let's allow anonymous users to visit the `UserBasedAuthorization.aspx` page, but with limited functionality.</span></span> <span data-ttu-id="d6a4b-354">Para abrir essa página para ser acessado por todos os usuários, adicione o seguinte `<location>` elemento para o `Web.config` arquivo o `Membership` pasta:</span><span class="sxs-lookup"><span data-stu-id="d6a4b-354">To open this page up to be accessed by all users, add the following `<location>` element to the `Web.config` file in the `Membership` folder:</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample14.xml)]

<span data-ttu-id="d6a4b-355">Depois de adicionar isso `<location>` elemento, testar as novas regras de autorização de URL ao fazer logoff do site.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-355">After adding this `<location>` element, test the new URL authorization rules by logging out of the site.</span></span> <span data-ttu-id="d6a4b-356">Como um usuário anônimo você tem permissão para visitar o `UserBasedAuthorization.aspx` página.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-356">As an anonymous user you should be permitted to visit the `UserBasedAuthorization.aspx` page.</span></span>

<span data-ttu-id="d6a4b-357">Atualmente, qualquer usuário autenticado ou anônimo pode visitar o `UserBasedAuthorization.aspx` página e exibir ou excluir arquivos.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-357">Currently, any authenticated or anonymous user can visit the `UserBasedAuthorization.aspx` page and view or delete files.</span></span> <span data-ttu-id="d6a4b-358">Vamos torná-lo para que somente usuários autenticados podem exibir o conteúdo de um arquivo e Tito só pode excluir um arquivo.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-358">Let's make it so that only authenticated users can view contents of a file and only Tito can delete a file.</span></span> <span data-ttu-id="d6a4b-359">Essas regras de autorização granulares podem ser aplicadas declarativamente, programaticamente ou por meio de uma combinação de ambos os métodos.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-359">Such fine grain authorization rules can be applied declaratively, programmatically, or through a combination of both methods.</span></span> <span data-ttu-id="d6a4b-360">Vamos usar a abordagem declarativa para limitar quem pode exibir o conteúdo de um arquivo. usaremos a abordagem programática para limitar quem pode excluir um arquivo.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-360">Let's use the declarative approach to limit who can view the contents of a file; we'll use the programmatic approach to limit who can delete a file.</span></span>

### <a name="using-the-loginview-control"></a><span data-ttu-id="d6a4b-361">Usando o controle LoginView</span><span class="sxs-lookup"><span data-stu-id="d6a4b-361">Using the LoginView Control</span></span>

<span data-ttu-id="d6a4b-362">Como vimos nos tutoriais anteriores, o controle LoginView é útil para exibir as interfaces diferentes para usuários anônimos e autenticados e oferece uma maneira fácil para ocultar a funcionalidade que não está acessível a usuários anônimos.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-362">As we've seen in past tutorials, the LoginView control is useful for displaying different interfaces for authenticated and anonymous users, and offers an easy way to hide functionality that is not accessible to anonymous users.</span></span> <span data-ttu-id="d6a4b-363">Desde que os usuários anônimos não é possível exibir ou excluir arquivos, precisamos apenas Mostrar o `FileContents` caixa de texto quando a página for visitada por um usuário autenticado.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-363">Since anonymous users cannot view or delete files, we only need to show the `FileContents` TextBox when the page is visited by an authenticated user.</span></span> <span data-ttu-id="d6a4b-364">Para fazer isso, adicione um controle LoginView à página, nomeie-o `LoginViewForFileContentsTextBox`e mover o `FileContents` declarativo da caixa de texto do controle LoginView `LoggedInTemplate`.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-364">To achieve this, add a LoginView control to the page, name it `LoginViewForFileContentsTextBox`, and move the `FileContents` TextBox's declarative markup into the LoginView control's `LoggedInTemplate`.</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample15.aspx)]

<span data-ttu-id="d6a4b-365">Os controles da Web em modelos do LoginView não são diretamente acessíveis pela classe code-behind.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-365">The Web controls in the LoginView's templates are no longer directly accessible from the code-behind class.</span></span> <span data-ttu-id="d6a4b-366">Por exemplo, o `FilesGrid` do GridView `SelectedIndexChanged` e `RowDeleting` manipuladores de eventos atualmente fazem referência a `FileContents` como o controle de caixa de texto com o código:</span><span class="sxs-lookup"><span data-stu-id="d6a4b-366">For example, the `FilesGrid` GridView's `SelectedIndexChanged` and `RowDeleting` event handlers currently reference the `FileContents` TextBox control with code like:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample16.cs)]

<span data-ttu-id="d6a4b-367">No entanto, esse código não é válido.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-367">However, this code is no longer valid.</span></span> <span data-ttu-id="d6a4b-368">Movendo o `FileContents` caixa de texto para o `LoggedInTemplate` a caixa de texto não pode ser acessada diretamente.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-368">By moving the `FileContents` TextBox into the `LoggedInTemplate` the TextBox cannot be directly accessed.</span></span> <span data-ttu-id="d6a4b-369">Em vez disso, é necessário usar o `FindControl("controlId")` método para referenciar programaticamente o controle.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-369">Instead, we must use the `FindControl("controlId")` method to programmatically reference the control.</span></span> <span data-ttu-id="d6a4b-370">Atualização de `FilesGrid` manipuladores de eventos para fazer referência a caixa de texto da seguinte forma:</span><span class="sxs-lookup"><span data-stu-id="d6a4b-370">Update the `FilesGrid` event handlers to reference the TextBox like so:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample17.cs)]

<span data-ttu-id="d6a4b-371">Depois de mover a caixa de texto para o LoginView `LoggedInTemplate` e atualizar o código da página de referência usando a caixa de texto de `FindControl("controlId")` padrão, visite a página como um usuário anônimo.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-371">After moving the TextBox to the LoginView's `LoggedInTemplate` and updating the page's code to reference the TextBox using the `FindControl("controlId")` pattern, visit the page as an anonymous user.</span></span> <span data-ttu-id="d6a4b-372">Como mostra a Figura 10, o `FileContents` não é exibida a caixa de texto.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-372">As Figure 10 shows, the `FileContents` TextBox is not displayed.</span></span> <span data-ttu-id="d6a4b-373">No entanto, o modo de exibição LinkButton ainda será exibido.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-373">However, the View LinkButton is still displayed.</span></span>


<span data-ttu-id="d6a4b-374">[![O controle LoginView processa somente a caixa de texto FileContents para usuários autenticados](user-based-authorization-cs/_static/image29.png)](user-based-authorization-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="d6a4b-374">[![The LoginView Control Only Renders the FileContents TextBox for Authenticated Users](user-based-authorization-cs/_static/image29.png)](user-based-authorization-cs/_static/image28.png)</span></span>

<span data-ttu-id="d6a4b-375">**Figura 10**: O LoginView controle só processa o `FileContents` TextBox para usuários autenticados ([clique para exibir a imagem em tamanho normal](user-based-authorization-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="d6a4b-375">**Figure 10**: The LoginView Control Only Renders the `FileContents` TextBox for Authenticated Users  ([Click to view full-size image](user-based-authorization-cs/_static/image30.png))</span></span>


<span data-ttu-id="d6a4b-376">Uma maneira para ocultar o botão de modo de exibição para usuários anônimos é converta o campo de GridView em um TemplateField.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-376">One way to hide the View button for anonymous users is to convert the GridView field into a TemplateField.</span></span> <span data-ttu-id="d6a4b-377">Isso irá gerar um modelo que contém a marcação declarativa para LinkButton o modo de exibição.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-377">This will generate a template that contains the declarative markup for the View LinkButton.</span></span> <span data-ttu-id="d6a4b-378">Em seguida, podemos adicionar um controle LoginView para o TemplateField e colocar LinkButton dentro do LoginView `LoggedInTemplate`e, portanto, ocultando botão modo de exibição de visitantes anônimos.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-378">We can then add a LoginView control to the TemplateField and place the LinkButton within the LoginView's `LoggedInTemplate`, thereby hiding the View button from anonymous visitors.</span></span> <span data-ttu-id="d6a4b-379">Para fazer isso, clique no link Editar colunas do GridView de marca inteligente para iniciar a caixa de diálogo de campos.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-379">To accomplish this, click on the Edit Columns link from the GridView's Smart Tag to launch the Fields dialog box.</span></span> <span data-ttu-id="d6a4b-380">Em seguida, selecione o botão de seleção na lista no canto inferior esquerdo e, em seguida, clique em converter este campo em um TemplateField link.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-380">Next, select the Select button from the list in the lower left corner and then click the Convert this field to a TemplateField link.</span></span> <span data-ttu-id="d6a4b-381">Isso irá modificar declarativo do campo de:</span><span class="sxs-lookup"><span data-stu-id="d6a4b-381">Doing so will modify the field's declarative markup from:</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample18.aspx)]

 <span data-ttu-id="d6a4b-382">Para:</span><span class="sxs-lookup"><span data-stu-id="d6a4b-382">To:</span></span> 

[!code-aspx[Main](user-based-authorization-cs/samples/sample19.aspx)]

<span data-ttu-id="d6a4b-383">Neste ponto, podemos adicionar um LoginView para o TemplateField.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-383">At this point, we can add a LoginView to the TemplateField.</span></span> <span data-ttu-id="d6a4b-384">A seguinte marcação exibe LinkButton o modo de exibição somente para usuários autenticados.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-384">The following markup displays the View LinkButton only for authenticated users.</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample20.aspx)]

<span data-ttu-id="d6a4b-385">Como mostra a Figura 11, o resultado final não é que muito como a exibição da coluna ainda será exibida, embora os botões de link de exibição dentro da coluna estão ocultos.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-385">As Figure 11 shows, the end result is not that pretty as the View column is still displayed even though the View LinkButtons within the column are hidden.</span></span> <span data-ttu-id="d6a4b-386">Examinaremos como ocultar a coluna inteira de GridView (e não apenas o LinkButton) na próxima seção.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-386">We will look at how to hide the entire GridView column (and not just the LinkButton) in the next section.</span></span>


<span data-ttu-id="d6a4b-387">[![O controle LoginView oculta os botões de link de exibição para visitantes anônimos](user-based-authorization-cs/_static/image32.png)](user-based-authorization-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="d6a4b-387">[![The LoginView Control Hides the View LinkButtons for Anonymous Visitors](user-based-authorization-cs/_static/image32.png)](user-based-authorization-cs/_static/image31.png)</span></span>

<span data-ttu-id="d6a4b-388">**Figura 11**: O controle LoginView oculta os botões de link de exibição para visitantes anônimos ([clique para exibir a imagem em tamanho normal](user-based-authorization-cs/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="d6a4b-388">**Figure 11**: The LoginView Control Hides the View LinkButtons for Anonymous Visitors  ([Click to view full-size image](user-based-authorization-cs/_static/image33.png))</span></span>


### <a name="programmatically-limiting-functionality"></a><span data-ttu-id="d6a4b-389">Funcionalidade de limitação programaticamente</span><span class="sxs-lookup"><span data-stu-id="d6a4b-389">Programmatically Limiting Functionality</span></span>

<span data-ttu-id="d6a4b-390">Em algumas circunstâncias, técnicas declarativas são insuficientes para limitar a funcionalidade a uma página.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-390">In some circumstances, declarative techniques are insufficient for limiting functionality to a page.</span></span> <span data-ttu-id="d6a4b-391">Por exemplo, a disponibilidade de alguns recursos de página pode ser dependente critérios além se o usuário visitar a página é autenticado ou anônimo.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-391">For example, the availability of certain page functionality may be dependent on criteria beyond whether the user visiting the page is anonymous or authenticated.</span></span> <span data-ttu-id="d6a4b-392">Nesses casos, os vários elementos de interface do usuário podem ser exibidos ou ocultados por meio de programação.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-392">In such cases, the various user interface elements can be displayed or hidden through programmatic means.</span></span>

<span data-ttu-id="d6a4b-393">Para limitar a funcionalidade por meio de programação, é necessário executar duas tarefas:</span><span class="sxs-lookup"><span data-stu-id="d6a4b-393">In order to limit the functionality programmatically, we need to perform two tasks:</span></span>

1. <span data-ttu-id="d6a4b-394">Determinar se o usuário visitar a página pode acessar a funcionalidade e</span><span class="sxs-lookup"><span data-stu-id="d6a4b-394">Determine whether the user visiting the page can access the functionality, and</span></span>
2. <span data-ttu-id="d6a4b-395">Modificar programaticamente a interface do usuário com base em se o usuário tem acesso à funcionalidade em questão.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-395">Programmatically modify the user interface based on whether the user has access to the functionality in question.</span></span>

<span data-ttu-id="d6a4b-396">Para demonstrar o aplicativo dessas duas tarefas, vamos apenas permitir Tito excluir arquivos de GridView.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-396">To demonstrate the application of these two tasks, let's only allow Tito to delete files from the GridView.</span></span> <span data-ttu-id="d6a4b-397">A primeira tarefa, em seguida, é determinar se ele é Tito visitar a página.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-397">Our first task, then, is to determine whether it is Tito visiting the page.</span></span> <span data-ttu-id="d6a4b-398">Depois que tiver sido determinado, precisamos (Mostrar ou ocultar) coluna de exclusão do GridView.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-398">Once that has been determined, we need to hide (or show) the GridView's Delete column.</span></span> <span data-ttu-id="d6a4b-399">As colunas do GridView são acessíveis por meio de seu `Columns` propriedade; uma coluna é renderizada apenas se seu `Visible` está definida como `true` (o padrão).</span><span class="sxs-lookup"><span data-stu-id="d6a4b-399">The GridView's columns are accessible through its `Columns` property; a column is only rendered if its `Visible` property is set to `true` (the default).</span></span>

<span data-ttu-id="d6a4b-400">Adicione o seguinte código para o `Page_Load` manipulador de eventos antes de associar os dados a GridView:</span><span class="sxs-lookup"><span data-stu-id="d6a4b-400">Add the following code to the `Page_Load` event handler prior to binding the data to the GridView:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample21.cs)]

<span data-ttu-id="d6a4b-401">Conforme abordado no [ *uma visão geral de formulários de autenticação* ](../introduction/an-overview-of-forms-authentication-cs.md) tutorial, `User.Identity.Name` retorna o nome da identidade.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-401">As we discussed in the [*An Overview of Forms Authentication*](../introduction/an-overview-of-forms-authentication-cs.md) tutorial, `User.Identity.Name` returns the identity's name.</span></span> <span data-ttu-id="d6a4b-402">Isso corresponde ao nome de usuário inserido no controle de logon.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-402">This corresponds to the username entered in the Login control.</span></span> <span data-ttu-id="d6a4b-403">Se é Tito visitar a página, segunda coluna do GridView `Visible` está definida como `true`; caso contrário, ele é definido como `false`.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-403">If it is Tito visiting the page, the GridView's second column's `Visible` property is set to `true`; otherwise, it is set to `false`.</span></span> <span data-ttu-id="d6a4b-404">O resultado é que, quando alguém que não seja Tito visitar a página, outro usuário autenticado ou um usuário anônimo, a coluna de exclusão não é renderizada (veja a Figura 12); No entanto, quando Tito visita a página, a coluna de exclusão está presente (consulte a Figura 13).</span><span class="sxs-lookup"><span data-stu-id="d6a4b-404">The net result is that when someone other than Tito visits the page, either another authenticated user or an anonymous user, the Delete column is not rendered (see Figure 12); however, when Tito visits the page, the Delete column is present (see Figure 13).</span></span>


<span data-ttu-id="d6a4b-405">[![Excluir coluna não é processado quando visitado por alguém diferente de Tito (como Bruce)](user-based-authorization-cs/_static/image35.png)](user-based-authorization-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="d6a4b-405">[![The Delete Column is Not Rendered When Visited By Someone Other Than Tito (Such as Bruce)](user-based-authorization-cs/_static/image35.png)](user-based-authorization-cs/_static/image34.png)</span></span>

<span data-ttu-id="d6a4b-406">**Figura 12**: A excluir a coluna não é processado quando visitado por alguém diferente de Tito (como Bruce) ([clique para exibir a imagem em tamanho normal](user-based-authorization-cs/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="d6a4b-406">**Figure 12**: The Delete Column is Not Rendered When Visited By Someone Other Than Tito (Such as Bruce)  ([Click to view full-size image](user-based-authorization-cs/_static/image36.png))</span></span>


<span data-ttu-id="d6a4b-407">[![Excluir coluna é renderizada para Tito](user-based-authorization-cs/_static/image38.png)](user-based-authorization-cs/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="d6a4b-407">[![The Delete Column is Rendered for Tito](user-based-authorization-cs/_static/image38.png)](user-based-authorization-cs/_static/image37.png)</span></span>

<span data-ttu-id="d6a4b-408">**Figura 13**: A excluir a coluna é renderizada para Tito ([clique para exibir a imagem em tamanho normal](user-based-authorization-cs/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="d6a4b-408">**Figure 13**: The Delete Column is Rendered for Tito  ([Click to view full-size image](user-based-authorization-cs/_static/image39.png))</span></span>


## <a name="step-4-applying-authorization-rules-to-classes-and-methods"></a><span data-ttu-id="d6a4b-409">Etapa 4: Aplicar regras de autorização para Classes e métodos</span><span class="sxs-lookup"><span data-stu-id="d6a4b-409">Step 4: Applying Authorization Rules to Classes and Methods</span></span>

<span data-ttu-id="d6a4b-410">Na etapa 3, não permitida a usuários anônimos exibam o conteúdo do arquivo e proibidos todos os usuários, mas Tito de exclusão de arquivos.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-410">In Step 3 we disallowed anonymous users from viewing a file's contents and prohibited all users but Tito from deleting files.</span></span> <span data-ttu-id="d6a4b-411">Isso foi feito, ocultando os elementos da interface de usuário associada aos visitantes não autorizados por meio de técnicas programáticas e declarativas.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-411">This was accomplished by hiding the associated user interface elements for unauthorized visitors through declarative and programmatic techniques.</span></span> <span data-ttu-id="d6a4b-412">Para nosso exemplo simple, ocultar corretamente os elementos de interface do usuário foi simples, mas e quanto mais complexos sites onde pode haver diferentes maneiras de executar a mesma funcionalidade?</span><span class="sxs-lookup"><span data-stu-id="d6a4b-412">For our simple example, properly hiding the user interface elements was straightforward, but what about more complex sites where there may be many different ways to perform the same functionality?</span></span> <span data-ttu-id="d6a4b-413">Limitar essa funcionalidade para usuários não autorizados, o que acontece se esquecemos ocultar ou desativar todos os elementos de interface do usuário aplicável?</span><span class="sxs-lookup"><span data-stu-id="d6a4b-413">In limiting that functionality to unauthorized users, what happens if we forget to hide or disable all of the applicable user interface elements?</span></span>

<span data-ttu-id="d6a4b-414">É uma maneira fácil de garantir que uma determinada parte da funcionalidade não pode ser acessada por um usuário não autorizado decorar dessa classe ou método com o [ `PrincipalPermission` atributo](https://msdn.microsoft.com/library/system.security.permissions.principalpermissionattribute.aspx).</span><span class="sxs-lookup"><span data-stu-id="d6a4b-414">An easy way to ensure that a particular piece of functionality cannot be accessed by an unauthorized user is to decorate that class or method with the [`PrincipalPermission` attribute](https://msdn.microsoft.com/library/system.security.permissions.principalpermissionattribute.aspx).</span></span> <span data-ttu-id="d6a4b-415">Quando o tempo de execução .NET usa uma classe ou executa um de seus métodos, ele verifica para garantir que o contexto de segurança atual tem permissão para usar a classe ou o método execute.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-415">When the .NET runtime uses a class or executes one of its methods, it checks to ensure that the current security context has permission to use the class or execute the method.</span></span> <span data-ttu-id="d6a4b-416">O `PrincipalPermission` atributo fornece um mecanismo pelo qual podemos definir essas regras.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-416">The `PrincipalPermission` attribute provides a mechanism through which we can define these rules.</span></span>

<span data-ttu-id="d6a4b-417">Vamos demonstrar o uso de `PrincipalPermission` atributo o GridView `SelectedIndexChanged` e `RowDeleting` manipuladores de eventos para proibir a execução por usuários anônimos e que não seja Tito, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-417">Let's demonstrate using the `PrincipalPermission` attribute on the GridView's `SelectedIndexChanged` and `RowDeleting` event handlers to prohibit execution by anonymous users and users other than Tito, respectively.</span></span> <span data-ttu-id="d6a4b-418">Tudo que precisamos fazer é adicionar o atributo apropriado sobre cada definição de função:</span><span class="sxs-lookup"><span data-stu-id="d6a4b-418">All we need to do is add the appropriate attribute atop each function definition:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample22.cs)]

<span data-ttu-id="d6a4b-419">O atributo para o `SelectedIndexChanged` impõe de manipulador de eventos que somente usuários autenticados pode executar o manipulador de eventos, enquanto que o atributo de `RowDeleting` a execução Tito limita o manipulador de eventos.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-419">The attribute for the `SelectedIndexChanged` event handler dictates that only authenticated users can execute the event handler, where as the attribute on the `RowDeleting` event handler limits the execution to Tito.</span></span>

<span data-ttu-id="d6a4b-420">Se, de alguma forma, um usuário diferente Tito tenta executar o `RowDeleting` manipulador de eventos ou de um usuário autenticado não tenta executar o `SelectedIndexChanged` manipulador de eventos, o tempo de execução .NET irá gerar um `SecurityException`.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-420">If, somehow, a user other than Tito attempts to execute the `RowDeleting` event handler or a non-authenticated user attempts to execute the `SelectedIndexChanged` event handler, the .NET runtime will raise a `SecurityException`.</span></span>


<span data-ttu-id="d6a4b-421">[![Se o contexto de segurança não está autorizado a executar o método, um SecurityException é gerada](user-based-authorization-cs/_static/image41.png)](user-based-authorization-cs/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="d6a4b-421">[![If the Security Context is not Authorized to Execute the Method, a SecurityException is Thrown](user-based-authorization-cs/_static/image41.png)](user-based-authorization-cs/_static/image40.png)</span></span>

<span data-ttu-id="d6a4b-422">**Figura 14**: se o contexto de segurança não está autorizado a executar o método, uma `SecurityException` é gerada ([clique para exibir a imagem em tamanho normal](user-based-authorization-cs/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="d6a4b-422">**Figure 14**: If the Security Context is not Authorized to Execute the Method, a `SecurityException` is Thrown  ([Click to view full-size image](user-based-authorization-cs/_static/image42.png))</span></span>


> [!NOTE]
> <span data-ttu-id="d6a4b-423">Para permitir que vários contextos de segurança acessar uma classe ou método, decorar a classe ou método com um `PrincipalPermission` atributo para cada contexto de segurança.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-423">To allow multiple security contexts to access a class or method, decorate the class or method with a `PrincipalPermission` attribute for each security context.</span></span> <span data-ttu-id="d6a4b-424">Ou seja, para permitir Tito e Bruce executar o `RowDeleting` manipulador de eventos, adicione *duas* `PrincipalPermission` atributos:</span><span class="sxs-lookup"><span data-stu-id="d6a4b-424">That is, to allow both Tito and Bruce to execute the `RowDeleting` event handler, add *two* `PrincipalPermission` attributes:</span></span>


[!code-csharp[Main](user-based-authorization-cs/samples/sample23.cs)]

<span data-ttu-id="d6a4b-425">Além de páginas ASP.NET, muitos aplicativos também têm uma arquitetura que inclui várias camadas, como camadas de acesso de dados e lógica de negócios.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-425">In addition to ASP.NET pages, many applications also have an architecture that includes various layers, such as Business Logic and Data Access Layers.</span></span> <span data-ttu-id="d6a4b-426">Essas camadas são normalmente implementadas como bibliotecas de classes e oferecem classes e métodos para executar a funcionalidade de relacionadas a dados e lógica de negócios.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-426">These layers are typically implemented as Class Libraries and offer classes and methods for performing business logic- and data-related functionality.</span></span> <span data-ttu-id="d6a4b-427">O `PrincipalPermission` atributo é útil para aplicar regras de autorização a essas camadas.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-427">The `PrincipalPermission` attribute is useful for applying authorization rules to these layers.</span></span>

<span data-ttu-id="d6a4b-428">Para obter mais informações sobre como usar o `PrincipalPermission` atributo para definir regras de autorização em classes e métodos, consulte [Scott Guthrie](https://weblogs.asp.net/scottgu/)da entrada de blog [adicionando regras de autorização para os negócios e dados camadas usando `PrincipalPermissionAttributes` ](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx).</span><span class="sxs-lookup"><span data-stu-id="d6a4b-428">For more information on using the `PrincipalPermission` attribute to define authorization rules on classes and methods, refer to [Scott Guthrie](https://weblogs.asp.net/scottgu/)'s blog entry [Adding Authorization Rules to Business and Data Layers Using `PrincipalPermissionAttributes`](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx).</span></span>

## <a name="summary"></a><span data-ttu-id="d6a4b-429">Resumo</span><span class="sxs-lookup"><span data-stu-id="d6a4b-429">Summary</span></span>

<span data-ttu-id="d6a4b-430">Neste tutorial vimos como aplicar as regras de autorização baseada em usuário.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-430">In this tutorial we looked at how to apply user-based authorization rules.</span></span> <span data-ttu-id="d6a4b-431">Começamos examinando ASP. Estrutura de autorização de URL do NET.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-431">We started with a look at ASP.NET's URL authorization framework.</span></span> <span data-ttu-id="d6a4b-432">Em cada solicitação, o mecanismo do ASP.NET `UrlAuthorizationModule` inspeciona as regras de autorização de URL definidas na configuração do aplicativo para determinar se a identidade está autorizada a acessar o recurso solicitado.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-432">On each request, the ASP.NET engine's `UrlAuthorizationModule` inspects the URL authorization rules defined in the application's configuration to determine whether the identity is authorized to access the requested resource.</span></span> <span data-ttu-id="d6a4b-433">Em resumo, a autorização da URL torna fácil especificar regras de autorização para uma página específica ou para todas as páginas em um diretório específico.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-433">In short, URL authorization makes it easy to specify authorization rules for a specific page or for all pages in a particular directory.</span></span>

<span data-ttu-id="d6a4b-434">A estrutura de autorização de URL aplica as regras de autorização em uma base de página por página.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-434">The URL authorization framework applies authorization rules on a page-by-page basis.</span></span> <span data-ttu-id="d6a4b-435">Com a autorização de URL, ou a identidade do solicitante está autorizada a acessar um recurso específico ou não.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-435">With URL authorization, either the requesting identity is authorized to access a particular resource or not.</span></span> <span data-ttu-id="d6a4b-436">Muitos cenários, no entanto, chamar para regras de autorização mais granulares.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-436">Many scenarios, however, call for more fine grain authorization rules.</span></span> <span data-ttu-id="d6a4b-437">Em vez de definir quem pode acessar uma página, podemos talvez seja necessário para permitir que alguém acessar uma página, mas mostrar dados diferentes ou oferecer funcionalidade diferente dependendo do usuário visitar a página.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-437">Rather than defining who is permitted to access a page, we may need to let everyone access a page, but to show different data or offer different functionality depending on the user visiting the page.</span></span> <span data-ttu-id="d6a4b-438">Autorização em nível de página geralmente envolve ocultando elementos de interface do usuário específico para impedir que usuários não autorizados acessem funcionalidade proibida.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-438">Page-level authorization usually involves hiding specific user interface elements in order to prevent unauthorized users from accessing prohibited functionality.</span></span> <span data-ttu-id="d6a4b-439">Além disso, é possível usar atributos para restringir o acesso a classes e a execução de seus métodos para determinados usuários.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-439">Additionally, it is possible to use attributes to restrict access to classes and execution of its methods for certain users.</span></span>

<span data-ttu-id="d6a4b-440">Boa programação!</span><span class="sxs-lookup"><span data-stu-id="d6a4b-440">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="d6a4b-441">Leitura adicional</span><span class="sxs-lookup"><span data-stu-id="d6a4b-441">Further Reading</span></span>

<span data-ttu-id="d6a4b-442">Para obter mais informações sobre os tópicos abordados neste tutorial, consulte os seguintes recursos:</span><span class="sxs-lookup"><span data-stu-id="d6a4b-442">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="d6a4b-443">Adicionando regras de autorização para os negócios e camadas de dados usando `PrincipalPermissionAttributes`</span><span class="sxs-lookup"><span data-stu-id="d6a4b-443">Adding Authorization Rules to Business and Data Layers Using `PrincipalPermissionAttributes`</span></span>](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)
- [<span data-ttu-id="d6a4b-444">Autorização de ASP.NET</span><span class="sxs-lookup"><span data-stu-id="d6a4b-444">ASP.NET Authorization</span></span>](https://msdn.microsoft.com/library/wce3kxhd.aspx)
- [<span data-ttu-id="d6a4b-445">Alterações entre IIS6 e segurança do IIS7</span><span class="sxs-lookup"><span data-stu-id="d6a4b-445">Changes Between IIS6 and IIS7 Security</span></span>](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/Changes-between-IIS6-and-IIS7-Security)
- [<span data-ttu-id="d6a4b-446">Configurando arquivos específicos e subpastas</span><span class="sxs-lookup"><span data-stu-id="d6a4b-446">Configuring Specific Files and Subdirectories</span></span>](https://msdn.microsoft.com/library/6hbkh9s7.aspx)
- [<span data-ttu-id="d6a4b-447">Limitar a funcionalidade de modificação de dados com base no usuário</span><span class="sxs-lookup"><span data-stu-id="d6a4b-447">Limiting Data Modification Functionality Based on the User</span></span>](../../data-access/editing-inserting-and-deleting-data/limiting-data-modification-functionality-based-on-the-user-cs.md)
- [<span data-ttu-id="d6a4b-448">Início rápido do controle LoginView</span><span class="sxs-lookup"><span data-stu-id="d6a4b-448">LoginView Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/loginview.aspx)
- [<span data-ttu-id="d6a4b-449">Noções básicas de autorização de URL de IIS7</span><span class="sxs-lookup"><span data-stu-id="d6a4b-449">Understanding IIS7 URL Authorization</span></span>](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization)
- [<span data-ttu-id="d6a4b-450">`UrlAuthorizationModule` Documentação técnica</span><span class="sxs-lookup"><span data-stu-id="d6a4b-450">`UrlAuthorizationModule` Technical Documentation</span></span>](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx)
- [<span data-ttu-id="d6a4b-451">Trabalhando com dados no ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="d6a4b-451">Working with Data in ASP.NET 2.0</span></span>](../../data-access/index.md)

### <a name="about-the-author"></a><span data-ttu-id="d6a4b-452">Sobre o autor</span><span class="sxs-lookup"><span data-stu-id="d6a4b-452">About the Author</span></span>

<span data-ttu-id="d6a4b-453">Scott Mitchell, autor de vários livros sobre ASP/ASP.NET e fundador da 4GuysFromRolla. com, trabalha com tecnologias Microsoft Web desde 1998.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-453">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="d6a4b-454">Scott funciona como um consultor independente, instrutor e gravador.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-454">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="d6a4b-455">Seu livro mais recente é  *[Sams ensinar por conta própria ASP.NET 2.0 nas 24 horas](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-455">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="d6a4b-456">Scott pode ser contatado pelo [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com) ou em seu blog [ http://ScottOnWriting.NET ](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="d6a4b-456">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="d6a4b-457">Agradecimentos especiais a</span><span class="sxs-lookup"><span data-stu-id="d6a4b-457">Special Thanks To</span></span>

<span data-ttu-id="d6a4b-458">Esta série de tutoriais foi revisado por vários revisores úteis.</span><span class="sxs-lookup"><span data-stu-id="d6a4b-458">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="d6a4b-459">Interessado em examinar meu artigos futuros do MSDN?</span><span class="sxs-lookup"><span data-stu-id="d6a4b-459">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="d6a4b-460">Nesse caso, me enviar uma linha no [ mitchell@4GuysFromRolla.com ](mailto:mitchell@4GuysFromRolla.com).</span><span class="sxs-lookup"><span data-stu-id="d6a4b-460">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="d6a4b-461">[Anterior](validating-user-credentials-against-the-membership-user-store-cs.md)
> [Próximo](storing-additional-user-information-cs.md)</span><span class="sxs-lookup"><span data-stu-id="d6a4b-461">[Previous](validating-user-credentials-against-the-membership-user-store-cs.md)
[Next](storing-additional-user-information-cs.md)</span></span>
