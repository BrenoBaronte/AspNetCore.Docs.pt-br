---
uid: mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
title: Habilitar automatizada de teste de unidade | Microsoft Docs
author: microsoft
description: Etapa 12 mostra como desenvolver um conjunto de testes de unidade automatizados que verifique nossa funcionalidade NerdDinner e que fornece a confiança para fazer alterações...
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/27/2010
ms.topic: article
ms.assetid: a19ff2ce-3f7e-4358-9a51-a1403da9c63e
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
msc.type: authoredcontent
ms.openlocfilehash: fede08be7e06327c6d04fa5d36f7dd818d79b380
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/06/2018
ms.locfileid: "30875624"
---
<a name="enable-automated-unit-testing"></a><span data-ttu-id="6a549-103">Habilitar o teste de unidade automatizado</span><span class="sxs-lookup"><span data-stu-id="6a549-103">Enable Automated Unit Testing</span></span>
====================
<span data-ttu-id="6a549-104">por [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="6a549-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="6a549-105">Baixar PDF</span><span class="sxs-lookup"><span data-stu-id="6a549-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="6a549-106">Esta é a etapa 12 do livremente [aplicativo "NerdDinner"](introducing-the-nerddinner-tutorial.md) que aborda-por meio de como criar um pequeno, mas concluir, o aplicativo web usando o ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="6a549-106">This is step 12 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="6a549-107">Etapa 12 mostra como desenvolver um conjunto de testes de unidade automatizados que verifique nossa funcionalidade NerdDinner e que fornece a confiança para fazer alterações e aprimoramentos para o aplicativo no futuro.</span><span class="sxs-lookup"><span data-stu-id="6a549-107">Step 12 shows how to develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>
> 
> <span data-ttu-id="6a549-108">Se você estiver usando o ASP.NET MVC 3, recomendamos que você siga o [obtendo iniciado com MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) ou [repositório de música MVC](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutoriais.</span><span class="sxs-lookup"><span data-stu-id="6a549-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>


## <a name="nerddinner-step-12-unit-testing"></a><span data-ttu-id="6a549-109">NerdDinner etapa 12: Teste de unidade</span><span class="sxs-lookup"><span data-stu-id="6a549-109">NerdDinner Step 12: Unit Testing</span></span>

<span data-ttu-id="6a549-110">Vamos desenvolver um conjunto de testes de unidade automatizados que verifique nossa funcionalidade NerdDinner e que fornece a confiança para fazer alterações e aprimoramentos para o aplicativo no futuro.</span><span class="sxs-lookup"><span data-stu-id="6a549-110">Let's develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>

### <a name="why-unit-test"></a><span data-ttu-id="6a549-111">Por que a unidade de teste?</span><span class="sxs-lookup"><span data-stu-id="6a549-111">Why Unit Test?</span></span>

<span data-ttu-id="6a549-112">Na unidade em um dia de trabalho tiver flash repentino de inspirei sobre um aplicativo que você está trabalhando.</span><span class="sxs-lookup"><span data-stu-id="6a549-112">On the drive into work one morning you have a sudden flash of inspiration about an application you are working on.</span></span> <span data-ttu-id="6a549-113">Você percebe que há uma alteração que você pode implementar que tornam o aplicativo significativamente melhor.</span><span class="sxs-lookup"><span data-stu-id="6a549-113">You realize there is a change you can implement that will make the application dramatically better.</span></span> <span data-ttu-id="6a549-114">Pode ser uma refatoração que limpa o código, adiciona um novo recurso ou corrige um bug.</span><span class="sxs-lookup"><span data-stu-id="6a549-114">It might be a refactoring that cleans up the code, adds a new feature, or fixes a bug.</span></span>

<span data-ttu-id="6a549-115">A pergunta que confronts você quando você chegar ao seu computador é: "como seguro é tornar essa melhoria?"</span><span class="sxs-lookup"><span data-stu-id="6a549-115">The question that confronts you when you arrive at your computer is – "how safe is it to make this improvement?"</span></span> <span data-ttu-id="6a549-116">Se a alteração tem efeitos colaterais ou quebras de algo?</span><span class="sxs-lookup"><span data-stu-id="6a549-116">What if making the change has side effects or breaks something?</span></span> <span data-ttu-id="6a549-117">A alteração pode ser simples e só levar alguns minutos para implementar, mas e se levar horas para testar manualmente todos os cenários de aplicativo?</span><span class="sxs-lookup"><span data-stu-id="6a549-117">The change might be simple and only take a few minutes to implement, but what if it takes hours to manually test out all of the application scenarios?</span></span> <span data-ttu-id="6a549-118">E se você se esquecer de aborda um cenário e um aplicativo danificado entra em produção?</span><span class="sxs-lookup"><span data-stu-id="6a549-118">What if you forget to cover a scenario and a broken application goes into production?</span></span> <span data-ttu-id="6a549-119">Está fazendo essa melhoria realmente valha a pena?</span><span class="sxs-lookup"><span data-stu-id="6a549-119">Is making this improvement really worth all the effort?</span></span>

<span data-ttu-id="6a549-120">Testes de unidade automatizados podem fornecer uma rede de segurança que permite aprimorar continuamente seus aplicativos e evitar sendo medo do código que você está trabalhando.</span><span class="sxs-lookup"><span data-stu-id="6a549-120">Automated unit tests can provide a safety net that enables you to continually enhance your applications, and avoid being afraid of the code you are working on.</span></span> <span data-ttu-id="6a549-121">Tendo automatizada testes que verifiquem rapidamente a funcionalidade permite que você com confiança – o código e ajudá-lo a fazer melhorias pode caso contrário, não ter sensação confortável fazendo.</span><span class="sxs-lookup"><span data-stu-id="6a549-121">Having automated tests that quickly verify functionality enables you to code with confidence – and empower you to make improvements you might otherwise not have felt comfortable doing.</span></span> <span data-ttu-id="6a549-122">Eles também ajudam a criar soluções que são mais passível de manutenção e têm um tempo de vida mais - que leva a uma maior retorno sobre o investimento.</span><span class="sxs-lookup"><span data-stu-id="6a549-122">They also help create solutions that are more maintainable and have a longer lifetime - which leads to a much higher return on investment.</span></span>

<span data-ttu-id="6a549-123">A estrutura do ASP.NET MVC torna fácil e natural para a funcionalidade do aplicativo de teste de unidade.</span><span class="sxs-lookup"><span data-stu-id="6a549-123">The ASP.NET MVC Framework makes it easy and natural to unit test application functionality.</span></span> <span data-ttu-id="6a549-124">Ele também permite que um fluxo de trabalho de teste controlado por TDD (desenvolvimento) que permite o desenvolvimento baseado em teste primeiro.</span><span class="sxs-lookup"><span data-stu-id="6a549-124">It also enables a Test Driven Development (TDD) workflow that enables test-first based development.</span></span>

### <a name="nerddinnertests-project"></a><span data-ttu-id="6a549-125">NerdDinner.Tests Project</span><span class="sxs-lookup"><span data-stu-id="6a549-125">NerdDinner.Tests Project</span></span>

<span data-ttu-id="6a549-126">Quando criamos o nosso aplicativo NerdDinner no início deste tutorial, vamos solicitados com uma caixa de diálogo perguntando se quiséssemos criar um projeto de teste de unidade para ir junto com o projeto de aplicativo:</span><span class="sxs-lookup"><span data-stu-id="6a549-126">When we created our NerdDinner application at the beginning of this tutorial, we were prompted with a dialog asking whether we wanted to create a unit test project to go along with the application project:</span></span>

![](enable-automated-unit-testing/_static/image1.png)

<span data-ttu-id="6a549-127">Mantivemos "Sim, crie um projeto de teste de unidade" botão de opção selecionado – que resultou em um projeto de "NerdDinner.Tests" que está sendo adicionado à nossa solução:</span><span class="sxs-lookup"><span data-stu-id="6a549-127">We kept the "Yes, create a unit test project" radio button selected – which resulted in a "NerdDinner.Tests" project being added to our solution:</span></span>

![](enable-automated-unit-testing/_static/image2.png)

<span data-ttu-id="6a549-128">O projeto NerdDinner.Tests referencia o assembly de projeto de aplicativo NerdDinner e permite adicionar facilmente testes automatizados que verificar a funcionalidade do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="6a549-128">The NerdDinner.Tests project references the NerdDinner application project assembly, and enables us to easily add automated tests to it that verify the application functionality.</span></span>

### <a name="creating-unit-tests-for-our-dinner-model-class"></a><span data-ttu-id="6a549-129">Criando testes de unidade para nossa classe de modelo refeição</span><span class="sxs-lookup"><span data-stu-id="6a549-129">Creating Unit Tests for our Dinner Model Class</span></span>

<span data-ttu-id="6a549-130">Vamos adicionar alguns testes ao nosso projeto NerdDinner.Tests que verifique se a classe refeição criadas quando criamos nossa camada de modelo.</span><span class="sxs-lookup"><span data-stu-id="6a549-130">Let's add some tests to our NerdDinner.Tests project that verify the Dinner class we created when we built our model layer.</span></span>

<span data-ttu-id="6a549-131">Vamos começar criando uma nova pasta em nosso projeto de teste chamado "Modelos" onde podemos colocar nossos testes relacionados ao modelo.</span><span class="sxs-lookup"><span data-stu-id="6a549-131">We'll start by creating a new folder within our test project called "Models" where we'll place our model-related tests.</span></span> <span data-ttu-id="6a549-132">Vamos, em seguida, clique com botão direito na pasta e escolha o **Add -&gt;novo teste** comando de menu.</span><span class="sxs-lookup"><span data-stu-id="6a549-132">We'll then right-click on the folder and choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="6a549-133">Isso abrirá a caixa de diálogo "Adicionar novo teste".</span><span class="sxs-lookup"><span data-stu-id="6a549-133">This will bring up the "Add New Test" dialog.</span></span>

<span data-ttu-id="6a549-134">Vamos escolher criar um teste de unidade"" e nomeie-a como "DinnerTest.cs":</span><span class="sxs-lookup"><span data-stu-id="6a549-134">We'll choose to create a "Unit Test" and name it "DinnerTest.cs":</span></span>

![](enable-automated-unit-testing/_static/image3.png)

<span data-ttu-id="6a549-135">Quando, clique no botão "okey" Visual Studio irá adicionar (e abrir) um arquivo DinnerTest.cs ao projeto:</span><span class="sxs-lookup"><span data-stu-id="6a549-135">When we click the "ok" button Visual Studio will add (and open) a DinnerTest.cs file to the project:</span></span>

![](enable-automated-unit-testing/_static/image4.png)

<span data-ttu-id="6a549-136">O modelo de teste de unidade de Visual Studio padrão tem uma série de códigos de placa clichê dentro dele que localizar um pouco confuso.</span><span class="sxs-lookup"><span data-stu-id="6a549-136">The default Visual Studio unit test template has a bunch of boiler-plate code within it that I find a little messy.</span></span> <span data-ttu-id="6a549-137">Vamos limpá-la para conter apenas o código a seguir:</span><span class="sxs-lookup"><span data-stu-id="6a549-137">Let's clean it up to just contain the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample1.cs)]

<span data-ttu-id="6a549-138">O atributo [TestClass] na classe DinnerTest acima identifica como uma classe que contém testes, bem como a inicialização de teste opcional e código de desmontagem.</span><span class="sxs-lookup"><span data-stu-id="6a549-138">The [TestClass] attribute on the DinnerTest class above identifies it as a class that will contain tests, as well as optional test initialization and teardown code.</span></span> <span data-ttu-id="6a549-139">Podemos definir testes dentro dele com a adição de métodos públicos que têm um atributo [TestMethod] neles.</span><span class="sxs-lookup"><span data-stu-id="6a549-139">We can define tests within it by adding public methods that have a [TestMethod] attribute on them.</span></span>

<span data-ttu-id="6a549-140">Abaixo estão o primeiro dos dois testes, adicionaremos que exercitam nossa classe refeição.</span><span class="sxs-lookup"><span data-stu-id="6a549-140">Below are the first of two tests we'll add that exercise our Dinner class.</span></span> <span data-ttu-id="6a549-141">O primeiro teste verifica se o nosso refeição é inválida se uma refeição novo é criada sem todas as propriedades que estão sendo definidas corretamente.</span><span class="sxs-lookup"><span data-stu-id="6a549-141">The first test verifies that our Dinner is invalid if a new Dinner is created without all properties being set correctly.</span></span> <span data-ttu-id="6a549-142">O segundo teste verifica se o nosso refeição é válida quando uma refeição tem todas as propriedades definidas com valores válidos:</span><span class="sxs-lookup"><span data-stu-id="6a549-142">The second test verifies that our Dinner is valid when a Dinner has all properties set with valid values:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample2.cs)]

<span data-ttu-id="6a549-143">Você observará acima que nossos nomes de teste são muito explícitas (e um pouco detalhado).</span><span class="sxs-lookup"><span data-stu-id="6a549-143">You'll notice above that our test names are very explicit (and somewhat verbose).</span></span> <span data-ttu-id="6a549-144">Estamos fazendo isso porque estamos pode acabar criando centenas ou milhares de testes de pequena e queremos facilitar a determinar rapidamente a intenção e o comportamento de cada um deles (especialmente quando estamos procurando em uma lista de falhas em um executor de teste).</span><span class="sxs-lookup"><span data-stu-id="6a549-144">We are doing this because we might end up creating hundreds or thousands of small tests, and we want to make it easy to quickly determine the intent and behavior of each of them (especially when we are looking through a list of failures in a test runner).</span></span> <span data-ttu-id="6a549-145">Os nomes de teste devem ser chamados após a funcionalidade que estão sendo testado.</span><span class="sxs-lookup"><span data-stu-id="6a549-145">The test names should be named after the functionality they are testing.</span></span> <span data-ttu-id="6a549-146">Acima estamos usando um "substantivo\_devem\_verbo" padrão de nomenclatura.</span><span class="sxs-lookup"><span data-stu-id="6a549-146">Above we are using a "Noun\_Should\_Verb" naming pattern.</span></span>

<span data-ttu-id="6a549-147">Podemos estruturação os testes usando o teste padrão – o que significa "Arrange, Act, Assert" "AAA":</span><span class="sxs-lookup"><span data-stu-id="6a549-147">We are structuring the tests using the "AAA" testing pattern – which stands for "Arrange, Act, Assert":</span></span>

- <span data-ttu-id="6a549-148">Organizar: Configurar a unidade que está sendo testada</span><span class="sxs-lookup"><span data-stu-id="6a549-148">Arrange: Setup the unit being tested</span></span>
- <span data-ttu-id="6a549-149">ACT: Utilizar a unidade de teste e capturar resultados</span><span class="sxs-lookup"><span data-stu-id="6a549-149">Act: Exercise the unit under test and capture results</span></span>
- <span data-ttu-id="6a549-150">Assert: Verificar o comportamento</span><span class="sxs-lookup"><span data-stu-id="6a549-150">Assert: Verify the behavior</span></span>

<span data-ttu-id="6a549-151">Quando escrevemos testes que desejamos para evitar que os testes individuais fazer muito.</span><span class="sxs-lookup"><span data-stu-id="6a549-151">When we write tests we want to avoid having the individual tests do too much.</span></span> <span data-ttu-id="6a549-152">Em vez disso, cada teste deve verificar somente um único conceito (que torna muito mais fácil de identificar a causa de falhas).</span><span class="sxs-lookup"><span data-stu-id="6a549-152">Instead each test should verify only a single concept (which will make it much easier to pinpoint the cause of failures).</span></span> <span data-ttu-id="6a549-153">Uma boa diretriz é tentar ter apenas uma única instrução para cada teste de asserção.</span><span class="sxs-lookup"><span data-stu-id="6a549-153">A good guideline is to try and only have a single assert statement for each test.</span></span> <span data-ttu-id="6a549-154">Se você tiver mais de uma instrução em um método de teste de asserção, certifique-se de que eles são todos os que está sendo usados para testar o mesmo conceito.</span><span class="sxs-lookup"><span data-stu-id="6a549-154">If you have more than one assert statement in a test method, make sure they are all being used to test the same concept.</span></span> <span data-ttu-id="6a549-155">Em caso de dúvida, verifique outro teste.</span><span class="sxs-lookup"><span data-stu-id="6a549-155">When in doubt, make another test.</span></span>

### <a name="running-tests"></a><span data-ttu-id="6a549-156">Executando testes</span><span class="sxs-lookup"><span data-stu-id="6a549-156">Running Tests</span></span>

<span data-ttu-id="6a549-157">Visual Studio 2008 Professional (e edições superiores) incluem um executor de testes internos que pode ser usado para executar projetos do Visual Studio de teste de unidade dentro do IDE.</span><span class="sxs-lookup"><span data-stu-id="6a549-157">Visual Studio 2008 Professional (and higher editions) includes a built-in test runner that can be used to run Visual Studio Unit Test projects within the IDE.</span></span> <span data-ttu-id="6a549-158">Podemos selecionar a **teste -&gt;execução&gt;todos os testes na solução** menu comando (ou tipo Ctrl R, A) para executar todos os testes de unidade.</span><span class="sxs-lookup"><span data-stu-id="6a549-158">We can select the **Test-&gt;Run-&gt;All Tests in Solution** menu command (or type Ctrl R, A) to run all of our unit tests.</span></span> <span data-ttu-id="6a549-159">Ou como alternativa, pode posicionar nosso cursor dentro de um método de teste ou classe de teste específicos e usar o **teste -&gt;execução&gt;testes no contexto atual** comando de menu (ou tipo Ctrl R, T) para executar um subconjunto dos testes de unidade.</span><span class="sxs-lookup"><span data-stu-id="6a549-159">Or alternatively we can position our cursor within a specific test class or test method and use the **Test-&gt;Run-&gt;Tests in Current Context** menu command (or type Ctrl R, T) to run a subset of the unit tests.</span></span>

<span data-ttu-id="6a549-160">Vamos posicionar nosso cursor dentro da classe DinnerTest e digite "Ctrl R, T" para executar os dois testes que acabamos de definir.</span><span class="sxs-lookup"><span data-stu-id="6a549-160">Let's position our cursor within the DinnerTest class and type "Ctrl R, T" to run the two tests we just defined.</span></span> <span data-ttu-id="6a549-161">Quando fazemos isso uma janela "Resultados de teste" serão exibido dentro do Visual Studio e você verá os resultados de nosso teste listados nele:</span><span class="sxs-lookup"><span data-stu-id="6a549-161">When we do this a "Test Results" window will appear within Visual Studio and we'll see the results of our test run listed within it:</span></span>

![](enable-automated-unit-testing/_static/image5.png)

<span data-ttu-id="6a549-162">*Observação: A janela de resultados de teste do VS não mostra a coluna de nome de classe por padrão. Você pode adicionar isso clicando duas vezes dentro da janela de resultados de teste e usando o comando de menu Adicionar/remover colunas.*</span><span class="sxs-lookup"><span data-stu-id="6a549-162">*Note: The VS test results window does not show the Class Name column by default. You can add this by right-clicking within the Test Results window and using the Add/Remove Columns menu command.*</span></span>

<span data-ttu-id="6a549-163">Nossos dois testes levaram apenas uma fração de segundo para executar – e como você pode ver ambos passados.</span><span class="sxs-lookup"><span data-stu-id="6a549-163">Our two tests took only a fraction of a second to run – and as you can see they both passed.</span></span> <span data-ttu-id="6a549-164">Agora podemos ir e aumentá-las com a criação de testes extras que verifique se a validação de regra específica, bem como para cobrem os dois métodos auxiliares - IsUserHost() e IsUserRegisterd() – que adicionamos à classe refeição.</span><span class="sxs-lookup"><span data-stu-id="6a549-164">We can now go on and augment them by creating additional tests that verify specific rule validations, as well as cover the two helper methods - IsUserHost() and IsUserRegisterd() – that we added to the Dinner class.</span></span> <span data-ttu-id="6a549-165">Ter todos esses testes em vigor para a classe refeição tornará muito mais fácil e segura adicionar novas regras de negócio e validações no futuro a ela.</span><span class="sxs-lookup"><span data-stu-id="6a549-165">Having all these tests in place for the Dinner class will make it much easier and safer to add new business rules and validations to it in the future.</span></span> <span data-ttu-id="6a549-166">Podemos adicionar nossa nova lógica de regra a uma refeição e, em seguida, em segundos, verifique se que ela não foi quebrada qualquer um dos nossos funcionalidade lógica anterior.</span><span class="sxs-lookup"><span data-stu-id="6a549-166">We can add our new rule logic to Dinner, and then within seconds verify that it hasn't broken any of our previous logic functionality.</span></span>

<span data-ttu-id="6a549-167">Observe como usar um nome de teste descritivo facilita a compreender rapidamente o que cada teste é verificar.</span><span class="sxs-lookup"><span data-stu-id="6a549-167">Notice how using a descriptive test name makes it easy to quickly understand what each test is verifying.</span></span> <span data-ttu-id="6a549-168">É recomendável usar o **ferramentas -&gt;opções** comando de menu, abrindo o teste ferramentas -&gt;tela de configuração de execução de teste e verificação de "clicando duas vezes em um resultado de teste de unidade com falha ou inconclusivo exibe caixa de seleção do ponto de falha no teste".</span><span class="sxs-lookup"><span data-stu-id="6a549-168">I recommend using the **Tools-&gt;Options** menu command, opening the Test Tools-&gt;Test Execution configuration screen, and checking the "Double-clicking a failed or inconclusive unit test result displays the point of failure in the test" checkbox.</span></span> <span data-ttu-id="6a549-169">Isso permitirá que você clique duas vezes em uma falha na janela de resultados de teste e pular imediatamente para a falha de declaração.</span><span class="sxs-lookup"><span data-stu-id="6a549-169">This will allow you to double-click on a failure in the test results window and jump immediately to the assert failure.</span></span>

### <a name="creating-dinnerscontroller-unit-tests"></a><span data-ttu-id="6a549-170">Criar testes de unidade DinnersController</span><span class="sxs-lookup"><span data-stu-id="6a549-170">Creating DinnersController Unit Tests</span></span>

<span data-ttu-id="6a549-171">Agora vamos criar alguns testes de unidade que verifique a nossa funcionalidade DinnersController.</span><span class="sxs-lookup"><span data-stu-id="6a549-171">Let's now create some unit tests that verify our DinnersController functionality.</span></span> <span data-ttu-id="6a549-172">Vamos começar clicando na pasta "Controladores" em nosso projeto de teste e, em seguida, escolha o **Add -&gt;novo teste** comando de menu.</span><span class="sxs-lookup"><span data-stu-id="6a549-172">We'll start by right-clicking on the "Controllers" folder within our Test project and then choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="6a549-173">Vamos criar um teste de unidade"" e nomeie-a como "DinnersControllerTest.cs".</span><span class="sxs-lookup"><span data-stu-id="6a549-173">We'll create a "Unit Test" and name it "DinnersControllerTest.cs".</span></span>

<span data-ttu-id="6a549-174">Vamos criar dois métodos de teste que verifique se o método de ação Details() sobre o DinnersController.</span><span class="sxs-lookup"><span data-stu-id="6a549-174">We'll create two test methods that verify the Details() action method on the DinnersController.</span></span> <span data-ttu-id="6a549-175">O primeiro verificará se uma exibição é retornada quando uma refeição existente é solicitada.</span><span class="sxs-lookup"><span data-stu-id="6a549-175">The first will verify that a View is returned when an existing Dinner is requested.</span></span> <span data-ttu-id="6a549-176">O segundo verificará se um modo de exibição de "NotFound" é retornado quando é solicitada uma refeição inexistente:</span><span class="sxs-lookup"><span data-stu-id="6a549-176">The second will verify that a "NotFound" view is returned when a non-existent Dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample3.cs)]

<span data-ttu-id="6a549-177">O código acima compila limpo.</span><span class="sxs-lookup"><span data-stu-id="6a549-177">The above code compiles clean.</span></span> <span data-ttu-id="6a549-178">Quando executamos os testes, no entanto, ambas falharem:</span><span class="sxs-lookup"><span data-stu-id="6a549-178">When we run the tests, though, they both fail:</span></span>

![](enable-automated-unit-testing/_static/image6.png)

<span data-ttu-id="6a549-179">Se observarmos as mensagens de erro, veremos que o motivo da falharam de testes foi porque nossa classe DinnersRepository não pôde se conectar a um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="6a549-179">If we look at the error messages, we'll see that the reason the tests failed was because our DinnersRepository class was unable to connect to a database.</span></span> <span data-ttu-id="6a549-180">Nosso aplicativo NerdDinner está usando uma cadeia de conexão para um arquivo local do SQL Server Express que reside sob o \App\_diretório de dados do projeto de aplicativo NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="6a549-180">Our NerdDinner application is using a connection-string to a local SQL Server Express file which lives under the \App\_Data directory of the NerdDinner application project.</span></span> <span data-ttu-id="6a549-181">Como nosso projeto NerdDinner.Tests compila e executa-o em um diretório diferente, em seguida, o projeto de aplicativo, o local do caminho relativo da nossa cadeia de conexão está incorreto.</span><span class="sxs-lookup"><span data-stu-id="6a549-181">Because our NerdDinner.Tests project compiles and runs in a different directory then the application project, the relative path location of our connection-string is incorrect.</span></span>

<span data-ttu-id="6a549-182">Estamos *foi* corrigir esse problema, copie o arquivo de banco de dados SQL Express ao nosso projeto de teste e, em seguida, adicionar uma cadeia de conexão de teste apropriado para ele no App. config de nosso projeto de teste.</span><span class="sxs-lookup"><span data-stu-id="6a549-182">We *could* fix this by copying the SQL Express database file to our test project, and then add an appropriate test connection-string to it in the App.config of our test project.</span></span> <span data-ttu-id="6a549-183">Isso teria os testes acima desbloqueado e em execução.</span><span class="sxs-lookup"><span data-stu-id="6a549-183">This would get the above tests unblocked and running.</span></span>

<span data-ttu-id="6a549-184">Código usando um banco de dados real, o teste de unidade, traz inúmeros desafios.</span><span class="sxs-lookup"><span data-stu-id="6a549-184">Unit testing code using a real database, though, brings with it a number of challenges.</span></span> <span data-ttu-id="6a549-185">Especificamente:</span><span class="sxs-lookup"><span data-stu-id="6a549-185">Specifically:</span></span>

- <span data-ttu-id="6a549-186">Ela reduz significativamente o tempo de execução de testes de unidade.</span><span class="sxs-lookup"><span data-stu-id="6a549-186">It significantly slows down the execution time of unit tests.</span></span> <span data-ttu-id="6a549-187">Quanto mais tempo que leva para executar testes, menor será a probabilidade são executá-los com frequência.</span><span class="sxs-lookup"><span data-stu-id="6a549-187">The longer it takes to run tests, the less likely you are to execute them frequently.</span></span> <span data-ttu-id="6a549-188">Idealmente, você deseja os testes de unidade para poder ser executado em segundos – e tê-lo algo você como naturalmente como compilar o projeto.</span><span class="sxs-lookup"><span data-stu-id="6a549-188">Ideally you want your unit tests to be able to be run in seconds – and have it be something you do as naturally as compiling the project.</span></span>
- <span data-ttu-id="6a549-189">Ele complica a instalação e lógica de limpeza em testes.</span><span class="sxs-lookup"><span data-stu-id="6a549-189">It complicates the setup and cleanup logic within tests.</span></span> <span data-ttu-id="6a549-190">Você deseja que cada teste de unidade ser isolado e independente de outras pessoas (com sem efeitos colaterais ou dependências).</span><span class="sxs-lookup"><span data-stu-id="6a549-190">You want each unit test to be isolated and independent of others (with no side effects or dependencies).</span></span> <span data-ttu-id="6a549-191">Ao trabalhar em um banco de dados real, que você precisa estar atento ao estado e redefini-lo entre testes.</span><span class="sxs-lookup"><span data-stu-id="6a549-191">When working against a real database you have to be mindful of state and reset it between tests.</span></span>

<span data-ttu-id="6a549-192">Vamos examinar um padrão de design chamado "injeção de dependência" que pode nos ajudar a resolver esses problemas e evitar a necessidade de usar um banco de dados real com nossos testes.</span><span class="sxs-lookup"><span data-stu-id="6a549-192">Let's look at a design pattern called "dependency injection" that can help us work around these issues and avoid the need to use a real database with our tests.</span></span>

### <a name="dependency-injection"></a><span data-ttu-id="6a549-193">Injeção de dependência</span><span class="sxs-lookup"><span data-stu-id="6a549-193">Dependency Injection</span></span>

<span data-ttu-id="6a549-194">Agora DinnersController é "acoplado" para a classe DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="6a549-194">Right now DinnersController is tightly "coupled" to the DinnerRepository class.</span></span> <span data-ttu-id="6a549-195">"Acoplamento" refere-se a uma situação em que uma classe explicitamente depende de outra classe para funcionar:</span><span class="sxs-lookup"><span data-stu-id="6a549-195">"Coupling" refers to a situation where a class explicitly relies on another class in order to work:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample4.cs)]

<span data-ttu-id="6a549-196">Como a classe DinnerRepository requer acesso a um banco de dados, a dependência firmemente acoplada a classe DinnersController tem nas extremidades DinnerRepository a necessidade de ter um banco de dados para que os métodos de ação DinnersController a ser testada.</span><span class="sxs-lookup"><span data-stu-id="6a549-196">Because the DinnerRepository class requires access to a database, the tightly coupled dependency the DinnersController class has on the DinnerRepository ends up requiring us to have a database in order for the DinnersController action methods to be tested.</span></span>

<span data-ttu-id="6a549-197">Podemos contornar isso empregando um padrão de design chamado "injeção de dependência –" que é uma abordagem onde dependências (como repositório classes que fornecem acesso a dados) não são mais implicitamente são criadas dentro de classes que usá-los.</span><span class="sxs-lookup"><span data-stu-id="6a549-197">We can get around this by employing a design pattern called "dependency injection" – which is an approach where dependencies (like repository classes that provide data access) are no longer implicitly created within classes that use them.</span></span> <span data-ttu-id="6a549-198">Em vez disso, as dependências podem ser passadas explicitamente para a classe que usa-los usando os argumentos de construtor.</span><span class="sxs-lookup"><span data-stu-id="6a549-198">Instead, dependencies can be explicitly passed to the class that uses them using constructor arguments.</span></span> <span data-ttu-id="6a549-199">Se as dependências são definidas usando as interfaces, em seguida, temos a flexibilidade para passar em implementações de dependência "falso" para cenários de teste de unidade.</span><span class="sxs-lookup"><span data-stu-id="6a549-199">If the dependencies are defined using interfaces, we then have the flexibility to pass in "fake" dependency implementations for unit test scenarios.</span></span> <span data-ttu-id="6a549-200">Isso nos permite criar implementações de dependência específicas de teste que realmente não exigem acesso a um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="6a549-200">This enables us to create test-specific dependency implementations that do not actually require access to a database.</span></span>

<span data-ttu-id="6a549-201">Para ver isso em ação, vamos implementar injeção de dependência com nosso DinnersController.</span><span class="sxs-lookup"><span data-stu-id="6a549-201">To see this in action, let's implement dependency injection with our DinnersController.</span></span>

#### <a name="extracting-an-idinnerrepository-interface"></a><span data-ttu-id="6a549-202">Extraindo uma interface IDinnerRepository</span><span class="sxs-lookup"><span data-stu-id="6a549-202">Extracting an IDinnerRepository interface</span></span>

<span data-ttu-id="6a549-203">A primeira etapa será criar uma nova interface IDinnerRepository que encapsula o contrato de repositório que nosso controladores necessárias para recuperar e atualizar jantares.</span><span class="sxs-lookup"><span data-stu-id="6a549-203">Our first step will be to create a new IDinnerRepository interface that encapsulates the repository contract our controllers require to retrieve and update Dinners.</span></span>

<span data-ttu-id="6a549-204">Podemos definir essa interface de contrato manualmente clicando duas vezes na pasta \Models e, em seguida, escolhendo o **Add -&gt;Novo Item** comando de menu e criar uma nova interface chamada IDinnerRepository.cs.</span><span class="sxs-lookup"><span data-stu-id="6a549-204">We can define this interface contract manually by right-clicking on the \Models folder, and then choosing the **Add-&gt;New Item** menu command and creating a new interface named IDinnerRepository.cs.</span></span>

<span data-ttu-id="6a549-205">Também podemos usar a refatoração automaticamente ferramentas integrado ao Visual Studio Professional (e edições superiores) para extração e criar uma interface para nós de nossa classe DinnerRepository existente.</span><span class="sxs-lookup"><span data-stu-id="6a549-205">Alternatively we can use the refactoring tools built-into Visual Studio Professional (and higher editions) to automatically extract and create an interface for us from our existing DinnerRepository class.</span></span> <span data-ttu-id="6a549-206">Para extrair essa interface usando o VS, simplesmente posicione o cursor no editor de texto na classe DinnerRepository e, em seguida, clique com botão direito e escolha o **refatorar -&gt;extrair Interface** comando de menu:</span><span class="sxs-lookup"><span data-stu-id="6a549-206">To extract this interface using VS, simply position the cursor in the text editor on the DinnerRepository class, and then right-click and choose the **Refactor-&gt;Extract Interface** menu command:</span></span>

![](enable-automated-unit-testing/_static/image7.png)

<span data-ttu-id="6a549-207">Isso iniciará a caixa de diálogo "Extrair Interface" e nos solicitar o nome da interface para criar.</span><span class="sxs-lookup"><span data-stu-id="6a549-207">This will launch the "Extract Interface" dialog and prompt us for the name of the interface to create.</span></span> <span data-ttu-id="6a549-208">Ele será o padrão para IDinnerRepository e selecionar automaticamente todos os métodos públicos da classe DinnerRepository existente para adicionar à interface:</span><span class="sxs-lookup"><span data-stu-id="6a549-208">It will default to IDinnerRepository and automatically select all public methods on the existing DinnerRepository class to add to the interface:</span></span>

![](enable-automated-unit-testing/_static/image8.png)

<span data-ttu-id="6a549-209">Quando é clicar no botão "okey", o Visual Studio adicionará uma nova interface IDinnerRepository para nosso aplicativo:</span><span class="sxs-lookup"><span data-stu-id="6a549-209">When we click the "ok" button, Visual Studio will add a new IDinnerRepository interface to our application:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample5.cs)]

<span data-ttu-id="6a549-210">E nossa classe DinnerRepository existente será atualizado para que ele implementa a interface:</span><span class="sxs-lookup"><span data-stu-id="6a549-210">And our existing DinnerRepository class will be updated so that it implements the interface:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample6.cs)]

#### <a name="updating-dinnerscontroller-to-support-constructor-injection"></a><span data-ttu-id="6a549-211">Atualizando DinnersController para dar suporte a injeção de construtor</span><span class="sxs-lookup"><span data-stu-id="6a549-211">Updating DinnersController to support constructor injection</span></span>

<span data-ttu-id="6a549-212">Agora vamos atualizar a classe DinnersController para usar a nova interface.</span><span class="sxs-lookup"><span data-stu-id="6a549-212">We'll now update the DinnersController class to use the new interface.</span></span>

<span data-ttu-id="6a549-213">No momento DinnersController é inserido no código, de modo que seu campo "dinnerRepository" é sempre uma classe DinnerRepository:</span><span class="sxs-lookup"><span data-stu-id="6a549-213">Currently DinnersController is hard-coded such that its "dinnerRepository" field is always a DinnerRepository class:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample7.cs)]

<span data-ttu-id="6a549-214">Vamos alterá-lo para que o campo "dinnerRepository" é do tipo IDinnerRepository em vez de DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="6a549-214">We'll change it so that the "dinnerRepository" field is of type IDinnerRepository instead of DinnerRepository.</span></span> <span data-ttu-id="6a549-215">Em seguida, adicionaremos dois construtores DinnersController públicas.</span><span class="sxs-lookup"><span data-stu-id="6a549-215">We'll then add two public DinnersController constructors.</span></span> <span data-ttu-id="6a549-216">Um dos construtores permite que um IDinnerRepository a ser passado como um argumento.</span><span class="sxs-lookup"><span data-stu-id="6a549-216">One of the constructors allows an IDinnerRepository to be passed as an argument.</span></span> <span data-ttu-id="6a549-217">A outra é um construtor padrão que usa nossa implementação DinnerRepository existente:</span><span class="sxs-lookup"><span data-stu-id="6a549-217">The other is a default constructor that uses our existing DinnerRepository implementation:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample8.cs)]

<span data-ttu-id="6a549-218">Como o ASP.NET MVC por padrão cria classes do controlador usando construtores padrão, nosso DinnersController em tempo de execução continuará a usar a classe DinnerRepository para executar o acesso a dados.</span><span class="sxs-lookup"><span data-stu-id="6a549-218">Because ASP.NET MVC by default creates controller classes using default constructors, our DinnersController at runtime will continue to use the DinnerRepository class to perform data access.</span></span>

<span data-ttu-id="6a549-219">Agora podemos atualizar nossos testes de unidade, no entanto, para passar por uma implementação do repositório de refeição "falso" usando o construtor de parâmetro.</span><span class="sxs-lookup"><span data-stu-id="6a549-219">We can now update our unit tests, though, to pass in a "fake" dinner repository implementation using the parameter constructor.</span></span> <span data-ttu-id="6a549-220">Esse repositório refeição "falso" não requer acesso a um banco de dados real e em vez disso, usará dados de exemplo na memória.</span><span class="sxs-lookup"><span data-stu-id="6a549-220">This "fake" dinner repository will not require access to a real database, and instead will use in-memory sample data.</span></span>

#### <a name="creating-the-fakedinnerrepository-class"></a><span data-ttu-id="6a549-221">Criando a classe FakeDinnerRepository</span><span class="sxs-lookup"><span data-stu-id="6a549-221">Creating the FakeDinnerRepository class</span></span>

<span data-ttu-id="6a549-222">Vamos criar uma classe FakeDinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="6a549-222">Let's create a FakeDinnerRepository class.</span></span>

<span data-ttu-id="6a549-223">Vamos começar criando um diretório "Fakes" em nosso projeto NerdDinner.Tests e, em seguida, adicione uma nova classe de FakeDinnerRepository a ele (com o botão direito na pasta e escolha **Add -&gt;nova classe**):</span><span class="sxs-lookup"><span data-stu-id="6a549-223">We'll begin by creating a "Fakes" directory within our NerdDinner.Tests project and then add a new FakeDinnerRepository class to it (right-click on the folder and choose **Add-&gt;New Class**):</span></span>

![](enable-automated-unit-testing/_static/image9.png)

<span data-ttu-id="6a549-224">Vamos atualizar o código de forma que a classe FakeDinnerRepository implementa a interface IDinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="6a549-224">We'll update the code so that the FakeDinnerRepository class implements the IDinnerRepository interface.</span></span> <span data-ttu-id="6a549-225">Podemos, em seguida, clique com botão direito nela e escolha o comando de menu de contexto "Implementar interface IDinnerRepository":</span><span class="sxs-lookup"><span data-stu-id="6a549-225">We can then right-click on it and choose the "Implement interface IDinnerRepository" context menu command:</span></span>

![](enable-automated-unit-testing/_static/image10.png)

<span data-ttu-id="6a549-226">Isso fará com que o Visual Studio adicionar todos os membros de interface IDinnerRepository automaticamente a nossa classe FakeDinnerRepository com implementações padrão de "stub":</span><span class="sxs-lookup"><span data-stu-id="6a549-226">This will cause Visual Studio to automatically add all of the IDinnerRepository interface members to our FakeDinnerRepository class with default "stub out" implementations:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample9.cs)]

<span data-ttu-id="6a549-227">Em seguida, podemos atualizar a implementação do FakeDinnerRepository trabalham com uma lista de memória&lt;refeição&gt; coleção passados a ele como um argumento de construtor:</span><span class="sxs-lookup"><span data-stu-id="6a549-227">We can then update the FakeDinnerRepository implementation to work off of an in-memory List&lt;Dinner&gt; collection passed to it as a constructor argument:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample10.cs)]

<span data-ttu-id="6a549-228">Agora temos uma implementação IDinnerRepository falsa que não requer um banco de dados e, em vez disso, pode ser executado fora de uma lista de memória de objetos de uma refeição.</span><span class="sxs-lookup"><span data-stu-id="6a549-228">We now have a fake IDinnerRepository implementation that does not require a database, and can instead work off an in-memory list of Dinner objects.</span></span>

#### <a name="using-the-fakedinnerrepository-with-unit-tests"></a><span data-ttu-id="6a549-229">Usando o FakeDinnerRepository com testes de unidade</span><span class="sxs-lookup"><span data-stu-id="6a549-229">Using the FakeDinnerRepository with Unit Tests</span></span>

<span data-ttu-id="6a549-230">Vamos voltar para os testes de unidade DinnersController que falharam anteriormente porque o banco de dados não estava disponível.</span><span class="sxs-lookup"><span data-stu-id="6a549-230">Let's return to the DinnersController unit tests that failed earlier because the database wasn't available.</span></span> <span data-ttu-id="6a549-231">Podemos atualizar os métodos de teste para usar um FakeDinnerRepository preenchido com dados de uma refeição do exemplo na memória para o DinnersController usando o código a seguir:</span><span class="sxs-lookup"><span data-stu-id="6a549-231">We can update the test methods to use a FakeDinnerRepository populated with sample in-memory Dinner data to the DinnersController using the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample11.cs)]

<span data-ttu-id="6a549-232">E agora durante a execução desses testes ambos passam:</span><span class="sxs-lookup"><span data-stu-id="6a549-232">And now when we run these tests they both pass:</span></span>

![](enable-automated-unit-testing/_static/image11.png)

<span data-ttu-id="6a549-233">O melhor de tudo, eles ocupam apenas uma fração de segundo para executar e não exigem qualquer lógica de instalação/limpeza complicadas.</span><span class="sxs-lookup"><span data-stu-id="6a549-233">Best of all, they take only a fraction of a second to run, and do not require any complicated setup/cleanup logic.</span></span> <span data-ttu-id="6a549-234">Podemos agora teste de unidade todo nosso código de método de ação DinnersController (incluindo listagem, paginação, detalhes, criar, atualizar e excluir) sem jamais precisar se conectar a um banco de dados real.</span><span class="sxs-lookup"><span data-stu-id="6a549-234">We can now unit test all of our DinnersController action method code (including listing, paging, details, create, update and delete) without ever needing to connect to a real database.</span></span>

| <span data-ttu-id="6a549-235">**Lado tópico: Estruturas de injeção de dependência**</span><span class="sxs-lookup"><span data-stu-id="6a549-235">**Side Topic: Dependency Injection Frameworks**</span></span> |
| --- |
| <span data-ttu-id="6a549-236">Executar a injeção de dependência manual (como estamos acima) funciona bem, mas se tornar mais difícil de manter como o número de dependências e aumenta a componentes em um aplicativo.</span><span class="sxs-lookup"><span data-stu-id="6a549-236">Performing manual dependency injection (like we are above) works fine, but does become harder to maintain as the number of dependencies and components in an application increases.</span></span> <span data-ttu-id="6a549-237">Existem várias estruturas de injeção de dependência para .NET que pode ajudar a fornecer mais flexibilidade de gerenciamento de dependência.</span><span class="sxs-lookup"><span data-stu-id="6a549-237">Several dependency injection frameworks exist for .NET that can help provide even more dependency management flexibility.</span></span> <span data-ttu-id="6a549-238">Essas estruturas, também chamadas de contêineres de "Inversão de controle" (IoC), fornecem mecanismos que permitem que um nível adicional de suporte de configuração para especificar e passar as dependências para objetos em tempo de execução (geralmente usando injeção de construtor ).</span><span class="sxs-lookup"><span data-stu-id="6a549-238">These frameworks, also sometimes called "Inversion of Control" (IoC) containers, provide mechanisms that enable an additional level of configuration support for specifying and passing dependencies to objects at runtime (most often using constructor injection).</span></span> <span data-ttu-id="6a549-239">Alguns da injeção de dependência de sistemas operacionais mais populares / estruturas IOC no .NET incluem: AutoFac, Ninject, Spring.NET, StructureMap e Windsor.</span><span class="sxs-lookup"><span data-stu-id="6a549-239">Some of the more popular OSS Dependency Injection / IOC frameworks in .NET include: AutoFac, Ninject, Spring.NET, StructureMap, and Windsor.</span></span> <span data-ttu-id="6a549-240">ASP.NET MVC expõe APIs que permitem aos desenvolvedores participar a resolução e a instanciação de controladores e que permite que a injeção de dependência de extensibilidade / estruturas IoC corretamente seja integrado no processo.</span><span class="sxs-lookup"><span data-stu-id="6a549-240">ASP.NET MVC exposes extensibility APIs that enable developers to participate in the resolution and instantiation of controllers, and which enables Dependency Injection / IoC frameworks to be cleanly integrated within this process.</span></span> <span data-ttu-id="6a549-241">Usando uma estrutura DI/IOC também permitiria a remover o construtor padrão de nosso DinnersController – o que seria remover completamente o acoplamento entre ele e o DinnerRepositorys.</span><span class="sxs-lookup"><span data-stu-id="6a549-241">Using a DI/IOC framework would also enable us to remove the default constructor from our DinnersController – which would completely remove the coupling between it and the DinnerRepositorys.</span></span> <span data-ttu-id="6a549-242">Nós não irá usar uma injeção de dependência / estrutura IOC com nosso aplicativo NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="6a549-242">We won't be using a dependency injection / IOC framework with our NerdDinner application.</span></span> <span data-ttu-id="6a549-243">Mas isso é algo que é possível considerar no futuro se os recursos e a base de código NerdDinner cresceram.</span><span class="sxs-lookup"><span data-stu-id="6a549-243">But it is something we could consider for the future if the NerdDinner code-base and capabilities grew.</span></span> |

### <a name="creating-edit-action-unit-tests"></a><span data-ttu-id="6a549-244">Criar testes de unidade de ação de edição</span><span class="sxs-lookup"><span data-stu-id="6a549-244">Creating Edit Action Unit Tests</span></span>

<span data-ttu-id="6a549-245">Agora vamos criar alguns testes de unidade para verificam a funcionalidade de edição do DinnersController.</span><span class="sxs-lookup"><span data-stu-id="6a549-245">Let's now create some unit tests that verify the Edit functionality of the DinnersController.</span></span> <span data-ttu-id="6a549-246">Vamos começar Testando a versão de HTTP GET do nosso Editar ação:</span><span class="sxs-lookup"><span data-stu-id="6a549-246">We'll start by testing the HTTP-GET version of our Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample12.cs)]

<span data-ttu-id="6a549-247">Vamos criar um teste que verifica se uma exibição com o apoio de um objeto DinnerFormViewModel é renderizada quando for solicitada uma refeição válida:</span><span class="sxs-lookup"><span data-stu-id="6a549-247">We'll create a test that verifies that a View backed by a DinnerFormViewModel object is rendered back when a valid dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample13.cs)]

<span data-ttu-id="6a549-248">Durante a execução de teste, no entanto, descobriremos que falha porque uma exceção de referência nula é gerada quando o método de edição acessa a propriedade User.Identity.Name ao executar a verificação de Dinner.IsHostedBy().</span><span class="sxs-lookup"><span data-stu-id="6a549-248">When we run the test, though, we'll find that it fails because a null reference exception is thrown when the Edit method accesses the User.Identity.Name property to perform the Dinner.IsHostedBy() check.</span></span>

<span data-ttu-id="6a549-249">O objeto de usuário na classe base do controlador encapsula os detalhes sobre o usuário que fez logon e é populado pelo ASP.NET MVC quando ele cria o controlador em tempo de execução.</span><span class="sxs-lookup"><span data-stu-id="6a549-249">The User object on the Controller base class encapsulates details about the logged-in user, and is populated by ASP.NET MVC when it creates the controller at runtime.</span></span> <span data-ttu-id="6a549-250">Como estamos testando DinnersController fora de um ambiente de servidor web, o objeto de usuário não está definido (portanto, a exceção de referência nula).</span><span class="sxs-lookup"><span data-stu-id="6a549-250">Because we are testing the DinnersController outside of a web-server environment, the User object isn't set (hence the null reference exception).</span></span>

### <a name="mocking-the-useridentityname-property"></a><span data-ttu-id="6a549-251">Simulação a propriedade User.Identity.Name</span><span class="sxs-lookup"><span data-stu-id="6a549-251">Mocking the User.Identity.Name property</span></span>

<span data-ttu-id="6a549-252">Estruturas fictícias facilitar os testes, permitindo a criação dinamicamente falsas versões dos objetos dependentes que dão suporte a nossos testes.</span><span class="sxs-lookup"><span data-stu-id="6a549-252">Mocking frameworks make testing easier by enabling us to dynamically create fake versions of dependent objects that support our tests.</span></span> <span data-ttu-id="6a549-253">Por exemplo, podemos usar uma estrutura fictícia em nosso teste da ação de edição para criar dinamicamente um objeto de usuário que nosso DinnersController pode usar para pesquisar um nome de usuário simulada.</span><span class="sxs-lookup"><span data-stu-id="6a549-253">For example, we can use a mocking framework in our Edit action test to dynamically create a User object that our DinnersController can use to lookup a simulated username.</span></span> <span data-ttu-id="6a549-254">Isso evitará uma referência nula de ser lançada quando executamos nosso teste.</span><span class="sxs-lookup"><span data-stu-id="6a549-254">This will avoid a null reference from being thrown when we run our test.</span></span>

<span data-ttu-id="6a549-255">Há muitos .NET que podem ser usadas com o ASP.NET MVC estruturas fictícias (você pode ver uma lista deles: [ http://www.mockframeworks.com/ ](http://www.mockframeworks.com/)).</span><span class="sxs-lookup"><span data-stu-id="6a549-255">There are many .NET mocking frameworks that can be used with ASP.NET MVC (you can see a list of them here: [http://www.mockframeworks.com/](http://www.mockframeworks.com/)).</span></span> <span data-ttu-id="6a549-256">Para testar o nosso aplicativo NerdDinner, usaremos um código-fonte aberto fictícias framework chamado "Moq", que pode ser baixado gratuitamente do [ http://www.mockframeworks.com/moq ](http://www.mockframeworks.com/moq).</span><span class="sxs-lookup"><span data-stu-id="6a549-256">For testing our NerdDinner application we'll use an open source mocking framework called "Moq", which can be downloaded for free from [http://www.mockframeworks.com/moq](http://www.mockframeworks.com/moq).</span></span>

<span data-ttu-id="6a549-257">Após o download, vamos adicionar uma referência em nosso projeto NerdDinner.Tests ao assembly Moq.dll:</span><span class="sxs-lookup"><span data-stu-id="6a549-257">Once downloaded, we'll add a reference in our NerdDinner.Tests project to the Moq.dll assembly:</span></span>

![](enable-automated-unit-testing/_static/image12.png)

<span data-ttu-id="6a549-258">Em seguida, adicionaremos um método auxiliar de "CreateDinnersControllerAs(username)" à nossa classe de teste que aceita um nome de usuário como um parâmetro e que, em seguida, a propriedade User.Identity.Name na instância DinnersController "mocks":</span><span class="sxs-lookup"><span data-stu-id="6a549-258">We'll then add a "CreateDinnersControllerAs(username)" helper method to our test class that takes a username as a parameter, and which then "mocks" the User.Identity.Name property on the DinnersController instance:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample14.cs)]

<span data-ttu-id="6a549-259">Acima estamos usando Moq para criar um objeto de simulação que simula a um objeto de ControllerContext (que é que o ASP.NET MVC passa para classes do controlador para expor os objetos de tempo de execução como usuário, a solicitação, a resposta e a sessão).</span><span class="sxs-lookup"><span data-stu-id="6a549-259">Above we are using Moq to create a Mock object that fakes a ControllerContext object (which is what ASP.NET MVC passes to Controller classes to expose runtime objects like User, Request, Response, and Session).</span></span> <span data-ttu-id="6a549-260">Estamos ligando o método "SetupGet" na simulação para indicar que a propriedade HttpContext.User.Identity.Name em ControllerContext deve retornar a cadeia de caracteres de nome de usuário que são passados para o método auxiliar.</span><span class="sxs-lookup"><span data-stu-id="6a549-260">We are calling the "SetupGet" method on the Mock to indicate that the HttpContext.User.Identity.Name property on ControllerContext should return the username string we passed to the helper method.</span></span>

<span data-ttu-id="6a549-261">É possível simular qualquer número de métodos e propriedades de ControllerContext.</span><span class="sxs-lookup"><span data-stu-id="6a549-261">We can mock any number of ControllerContext properties and methods.</span></span> <span data-ttu-id="6a549-262">Para ilustrar isso também ter adicionado uma chamada SetupGet() para a propriedade Request.IsAuthenticated (que, na verdade, não é necessária para os testes abaixo – mas que ajuda a ilustrar como você pode simular propriedades de solicitação).</span><span class="sxs-lookup"><span data-stu-id="6a549-262">To illustrate this I've also added a SetupGet() call for the Request.IsAuthenticated property (which isn't actually needed for the tests below – but which helps illustrate how you can mock Request properties).</span></span> <span data-ttu-id="6a549-263">Quando terminar de nós atribuímos uma instância de simulação ControllerContext ao DinnersController nosso método auxiliar retorna.</span><span class="sxs-lookup"><span data-stu-id="6a549-263">When we are done we assign an instance of the ControllerContext mock to the DinnersController our helper method returns.</span></span>

<span data-ttu-id="6a549-264">Agora podemos escrever testes de unidade que usam esse método auxiliar para testar cenários de edição que envolvem usuários diferentes:</span><span class="sxs-lookup"><span data-stu-id="6a549-264">We can now write unit tests that use this helper method to test Edit scenarios involving different users:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample15.cs)]

<span data-ttu-id="6a549-265">E agora ao executar os testes que passam:</span><span class="sxs-lookup"><span data-stu-id="6a549-265">And now when we run the tests they pass:</span></span>

![](enable-automated-unit-testing/_static/image13.png)

### <a name="testing-updatemodel-scenarios"></a><span data-ttu-id="6a549-266">Cenários de teste UpdateModel()</span><span class="sxs-lookup"><span data-stu-id="6a549-266">Testing UpdateModel() scenarios</span></span>

<span data-ttu-id="6a549-267">Criamos testes que abrangem a versão HTTP GET da ação de edição.</span><span class="sxs-lookup"><span data-stu-id="6a549-267">We've created tests that cover the HTTP-GET version of the Edit action.</span></span> <span data-ttu-id="6a549-268">Agora vamos criar alguns testes que verificam a versão HTTP POST da ação de edição:</span><span class="sxs-lookup"><span data-stu-id="6a549-268">Let's now create some tests that verify the HTTP-POST version of the Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample16.cs)]

<span data-ttu-id="6a549-269">O cenário de teste novos interessante para nosso suporte com esse método de ação é o uso do método auxiliar UpdateModel() na classe base do controlador.</span><span class="sxs-lookup"><span data-stu-id="6a549-269">The interesting new testing scenario for us to support with this action method is its usage of the UpdateModel() helper method on the Controller base class.</span></span> <span data-ttu-id="6a549-270">Estamos usando esse método auxiliar para associar valores de postagem de formulário para a instância de objeto refeição.</span><span class="sxs-lookup"><span data-stu-id="6a549-270">We are using this helper method to bind form-post values to our Dinner object instance.</span></span>

<span data-ttu-id="6a549-271">Abaixo estão dois testes que demonstra como podermos fornecer formulário postado valores para o método auxiliar UpdateModel() usar.</span><span class="sxs-lookup"><span data-stu-id="6a549-271">Below are two tests that demonstrates how we can supply form posted values for the UpdateModel() helper method to use.</span></span> <span data-ttu-id="6a549-272">Vamos fazer isso criando e populando um objeto FormCollection e, em seguida, atribuí-la à propriedade "ValueProvider" no controlador.</span><span class="sxs-lookup"><span data-stu-id="6a549-272">We'll do this by creating and populating a FormCollection object, and then assign it to the "ValueProvider" property on the Controller.</span></span>

<span data-ttu-id="6a549-273">O primeiro teste verifica em uma gravação com êxito o navegador é redirecionado para a ação de detalhes.</span><span class="sxs-lookup"><span data-stu-id="6a549-273">The first test verifies that on a successful save the browser is redirected to the details action.</span></span> <span data-ttu-id="6a549-274">O segundo teste verifica quando uma entrada inválida é lançada a ação exibe novamente a exibição de edição novamente com uma mensagem de erro.</span><span class="sxs-lookup"><span data-stu-id="6a549-274">The second test verifies that when invalid input is posted the action redisplays the edit view again with an error message.</span></span>


[!code-csharp[Main](enable-automated-unit-testing/samples/sample17.cs)]

### <a name="testing-wrap-up"></a><span data-ttu-id="6a549-275">Teste de encerramento</span><span class="sxs-lookup"><span data-stu-id="6a549-275">Testing Wrap-Up</span></span>

<span data-ttu-id="6a549-276">Falamos sobre os conceitos básicos envolvidos em classes de controlador de teste de unidade.</span><span class="sxs-lookup"><span data-stu-id="6a549-276">We've covered the core concepts involved in unit testing controller classes.</span></span> <span data-ttu-id="6a549-277">Podemos usar essas técnicas para criar facilmente centenas de testes simples que verificam o comportamento de nosso aplicativo.</span><span class="sxs-lookup"><span data-stu-id="6a549-277">We can use these techniques to easily create hundreds of simple tests that verify the behavior of our application.</span></span>

<span data-ttu-id="6a549-278">Como o nosso controlador e os testes de modelo não exigem um banco de dados real, eles são extremamente rápido e fácil de ser executada.</span><span class="sxs-lookup"><span data-stu-id="6a549-278">Because our controller and model tests do not require a real database, they are extremely fast and easy to run.</span></span> <span data-ttu-id="6a549-279">Poderemos executar centenas de testes automatizados em segundos, e imediatamente obter feedback se uma alteração que são feitas rompeu algo.</span><span class="sxs-lookup"><span data-stu-id="6a549-279">We'll be able to execute hundreds of automated tests in seconds, and immediately get feedback as to whether a change we made broke something.</span></span> <span data-ttu-id="6a549-280">Isso ajuda a fornecer a confiança para melhorar, refatorar e refinar o nosso aplicativo continuamente.</span><span class="sxs-lookup"><span data-stu-id="6a549-280">This will help provide us the confidence to continually improve, refactor, and refine our application.</span></span>

<span data-ttu-id="6a549-281">Abordamos teste como o último tópico neste capítulo – mas não como o teste é algo que você deve fazer ao final de um processo de desenvolvimento!</span><span class="sxs-lookup"><span data-stu-id="6a549-281">We covered testing as the last topic in this chapter – but not because testing is something you should do at the end of a development process!</span></span> <span data-ttu-id="6a549-282">Ao contrário, você deve escrever testes automatizados mais cedo possível no processo de desenvolvimento.</span><span class="sxs-lookup"><span data-stu-id="6a549-282">On the contrary, you should write automated tests as early as possible in your development process.</span></span> <span data-ttu-id="6a549-283">Fazer permite que você obtenha comentários imediatos à medida que desenvolve, ajuda você a ponderação pensar sobre cenários de caso de uso do aplicativo e orienta você para projetar seu aplicativo com limpa dispondo em camadas e acoplamento em mente.</span><span class="sxs-lookup"><span data-stu-id="6a549-283">Doing so enables you to get immediate feedback as you develop, helps you think thoughtfully about your application's use case scenarios, and guides you to design your application with clean layering and coupling in mind.</span></span>

<span data-ttu-id="6a549-284">Um capítulo posterior no catálogo de discutir desenvolvimento controlado por testes (TDD) e como usá-lo com o ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="6a549-284">A later chapter in the book will discuss Test Driven Development (TDD), and how to use it with ASP.NET MVC.</span></span> <span data-ttu-id="6a549-285">TDD é uma prática de codificação iterativa onde você primeiro escrever os testes que satisfazem o código resultante.</span><span class="sxs-lookup"><span data-stu-id="6a549-285">TDD is an iterative coding practice where you first write the tests that your resulting code will satisfy.</span></span> <span data-ttu-id="6a549-286">Com TDD começar cada recurso, criando um teste que verifica a funcionalidade que você está prestes a implementar.</span><span class="sxs-lookup"><span data-stu-id="6a549-286">With TDD you begin each feature by creating a test that verifies the functionality you are about to implement.</span></span> <span data-ttu-id="6a549-287">Gravar a unidade de teste primeiro ajuda a garantir que você compreenda claramente o recurso e como ele deve para funcionar.</span><span class="sxs-lookup"><span data-stu-id="6a549-287">Writing the unit test first helps ensure that you clearly understand the feature and how it is supposed to work.</span></span> <span data-ttu-id="6a549-288">Somente depois que o teste é gravado (e verificar se ele falhar) você e implementar a funcionalidade real que verifica o teste.</span><span class="sxs-lookup"><span data-stu-id="6a549-288">Only after the test is written (and you have verified that it fails) do you then implement the actual functionality the test verifies.</span></span> <span data-ttu-id="6a549-289">Porque você já tenha tempo pensando sobre o caso de uso de como o recurso deve para funcionar, você terá uma melhor compreensão dos requisitos e a melhor maneira de implementá-los.</span><span class="sxs-lookup"><span data-stu-id="6a549-289">Because you've already spent time thinking about the use case of how the feature is supposed to work, you will have a better understanding of the requirements and how best to implement them.</span></span> <span data-ttu-id="6a549-290">Quando você terminar com a implementação, você pode executar novamente o teste – e obter feedback imediato e se o recurso funciona corretamente.</span><span class="sxs-lookup"><span data-stu-id="6a549-290">When you are done with the implementation you can re-run the test – and get immediate feedback as to whether the feature works correctly.</span></span> <span data-ttu-id="6a549-291">Abordaremos TDD mais no capítulo 10.</span><span class="sxs-lookup"><span data-stu-id="6a549-291">We'll cover TDD more in Chapter 10.</span></span>

### <a name="next-step"></a><span data-ttu-id="6a549-292">Próxima etapa</span><span class="sxs-lookup"><span data-stu-id="6a549-292">Next Step</span></span>

<span data-ttu-id="6a549-293">Alguns conclusão final comentários.</span><span class="sxs-lookup"><span data-stu-id="6a549-293">Some final wrap up comments.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="6a549-294">[Anterior](use-ajax-to-implement-mapping-scenarios.md)
> [Próximo](nerddinner-wrap-up.md)</span><span class="sxs-lookup"><span data-stu-id="6a549-294">[Previous](use-ajax-to-implement-mapping-scenarios.md)
[Next](nerddinner-wrap-up.md)</span></span>
