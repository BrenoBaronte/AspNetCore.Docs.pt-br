---
uid: mvc/overview/getting-started/getting-started-with-ef-using-mvc/implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application
title: "Implementando a herança com o Entity Framework 6 em um aplicativo ASP.NET MVC 5 (11 de 12) | Microsoft Docs"
author: tdykstra
description: O aplicativo web de exemplo Contoso University demonstra como criar aplicativos ASP.NET MVC 5 usando o Entity Framework 6 Code First e o Visual Studio...
ms.author: aspnetcontent
manager: wpickett
ms.date: 11/07/2014
ms.topic: article
ms.assetid: 08834147-77ec-454a-bb7a-d931d2a40dab
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/getting-started/getting-started-with-ef-using-mvc/implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application
msc.type: authoredcontent
ms.openlocfilehash: e6ee3f9c055a15b13c27f94675006b9a7e804f1b
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/10/2017
---
<a name="implementing-inheritance-with-the-entity-framework-6-in-an-aspnet-mvc-5-application-11-of-12"></a><span data-ttu-id="261b4-103">Implementando a herança com o Entity Framework 6 em um aplicativo ASP.NET MVC 5 (11 de 12)</span><span class="sxs-lookup"><span data-stu-id="261b4-103">Implementing Inheritance with the Entity Framework 6 in an ASP.NET MVC 5 Application (11 of 12)</span></span>
====================
<span data-ttu-id="261b4-104">Por [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="261b4-104">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

<span data-ttu-id="261b4-105">[Baixe o projeto concluído](http://code.msdn.microsoft.com/ASPNET-MVC-Application-b01a9fe8) ou [baixar PDF](http://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20Entity%20Framework%206%20Code%20First%20using%20MVC%205.pdf)</span><span class="sxs-lookup"><span data-stu-id="261b4-105">[Download Completed Project](http://code.msdn.microsoft.com/ASPNET-MVC-Application-b01a9fe8) or [Download PDF](http://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20Entity%20Framework%206%20Code%20First%20using%20MVC%205.pdf)</span></span>

> <span data-ttu-id="261b4-106">O aplicativo web de exemplo Contoso University demonstra como criar aplicativos ASP.NET MVC 5 usando o Entity Framework 6 Code First e o Visual Studio 2013.</span><span class="sxs-lookup"><span data-stu-id="261b4-106">The Contoso University sample web application demonstrates how to create ASP.NET MVC 5 applications using the Entity Framework 6 Code First and Visual Studio 2013.</span></span> <span data-ttu-id="261b4-107">Para obter informações sobre a série de tutoriais, consulte [primeiro tutorial na série](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="261b4-107">For information about the tutorial series, see [the first tutorial in the series](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span></span>


<span data-ttu-id="261b4-108">No tutorial anterior é tratada exceções de simultaneidade.</span><span class="sxs-lookup"><span data-stu-id="261b4-108">In the previous tutorial you handled concurrency exceptions.</span></span> <span data-ttu-id="261b4-109">Este tutorial mostra como implementar a herança no modelo de dados.</span><span class="sxs-lookup"><span data-stu-id="261b4-109">This tutorial will show you how to implement inheritance in the data model.</span></span>

<span data-ttu-id="261b4-110">Em programação orientada a objeto, você pode usar [herança](http://en.wikipedia.org/wiki/Inheritance_(object-oriented_programming)) para facilitar a [reutilização de código](http://en.wikipedia.org/wiki/Code_reuse).</span><span class="sxs-lookup"><span data-stu-id="261b4-110">In object-oriented programming, you can use [inheritance](http://en.wikipedia.org/wiki/Inheritance_(object-oriented_programming)) to facilitate [code reuse](http://en.wikipedia.org/wiki/Code_reuse).</span></span> <span data-ttu-id="261b4-111">Neste tutorial, você alterará a `Instructor` e `Student` classes para que eles derivam de um `Person` classe que contém propriedades, como base `LastName` que são comuns a professores e alunos.</span><span class="sxs-lookup"><span data-stu-id="261b4-111">In this tutorial, you'll change the `Instructor` and `Student` classes so that they derive from a `Person` base class which contains properties such as `LastName` that are common to both instructors and students.</span></span> <span data-ttu-id="261b4-112">Você não adicionar ou alterar todas as páginas da web, mas você alterará a parte do código e essas alterações serão refletidas automaticamente no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="261b4-112">You won't add or change any web pages, but you'll change some of the code and those changes will be automatically reflected in the database.</span></span>

## <a name="options-for-mapping-inheritance-to-database-tables"></a><span data-ttu-id="261b4-113">Opções para o mapeamento de herança para as tabelas de banco de dados</span><span class="sxs-lookup"><span data-stu-id="261b4-113">Options for mapping inheritance to database tables</span></span>

<span data-ttu-id="261b4-114">O `Instructor` e `Student` classes de `School` modelo de dados tem várias propriedades que são idênticas:</span><span class="sxs-lookup"><span data-stu-id="261b4-114">The `Instructor` and `Student` classes in the `School` data model have several properties that are identical:</span></span>

![Student_and_Instructor_classes](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image1.png)

<span data-ttu-id="261b4-116">Suponha que você deseja eliminar o código de redundância para as propriedades que são compartilhadas pelo `Instructor` e `Student` entidades.</span><span class="sxs-lookup"><span data-stu-id="261b4-116">Suppose you want to eliminate the redundant code for the properties that are shared by the `Instructor` and `Student` entities.</span></span> <span data-ttu-id="261b4-117">Ou você quiser escrever um serviço que pode formatar nomes sem cuidar se o nome da origem do instrutor ou um aluno.</span><span class="sxs-lookup"><span data-stu-id="261b4-117">Or you want to write a service that can format names without caring whether the name came from an instructor or a student.</span></span> <span data-ttu-id="261b4-118">Você pode criar um `Person` classe que contém somente as propriedades compartilhadas base, em seguida, verifique o `Instructor` e `Student` entidades herdam da classe base, conforme mostrado na ilustração a seguir:</span><span class="sxs-lookup"><span data-stu-id="261b4-118">You could create a `Person` base class which contains only those shared properties, then make the `Instructor` and `Student` entities inherit from that base class, as shown in the following illustration:</span></span>

![Student_and_Instructor_classes_deriving_from_Person_class](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image2.png)

<span data-ttu-id="261b4-120">Há várias maneiras que essa estrutura de herança poderia ser representada no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="261b4-120">There are several ways this inheritance structure could be represented in the database.</span></span> <span data-ttu-id="261b4-121">Você pode ter um `Person` tabela que inclui informações sobre os alunos e instrutores em uma única tabela.</span><span class="sxs-lookup"><span data-stu-id="261b4-121">You could have a `Person` table that includes information about both students and instructors in a single table.</span></span> <span data-ttu-id="261b4-122">Algumas das colunas podem aplicar somente a instrutores (`HireDate`), alguns somente para os alunos (`EnrollmentDate`), alguns para ambos os (`LastName`, `FirstName`).</span><span class="sxs-lookup"><span data-stu-id="261b4-122">Some of the columns could apply only to instructors (`HireDate`), some only to students (`EnrollmentDate`), some to both (`LastName`, `FirstName`).</span></span> <span data-ttu-id="261b4-123">Normalmente, você teria um *discriminador* coluna para indicar que tipo de cada linha representa.</span><span class="sxs-lookup"><span data-stu-id="261b4-123">Typically, you'd have a *discriminator* column to indicate which type each row represents.</span></span> <span data-ttu-id="261b4-124">Por exemplo, coluna discriminadora pode ter "Instrutor" para "Aluno" e instrutores para estudantes.</span><span class="sxs-lookup"><span data-stu-id="261b4-124">For example, the discriminator column might have "Instructor" for instructors and "Student" for students.</span></span>

![Tabela por hierarchy_example](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image3.png)

<span data-ttu-id="261b4-126">Esse padrão de geração de uma estrutura de herança de entidade de uma tabela de banco de dados único é chamado *tabela por hierarquia* herança (TPH).</span><span class="sxs-lookup"><span data-stu-id="261b4-126">This pattern of generating an entity inheritance structure from a single database table is called *table-per-hierarchy* (TPH) inheritance.</span></span>

<span data-ttu-id="261b4-127">Uma alternativa é fazer com que o banco de dados pareça mais com a estrutura de herança.</span><span class="sxs-lookup"><span data-stu-id="261b4-127">An alternative is to make the database look more like the inheritance structure.</span></span> <span data-ttu-id="261b4-128">Por exemplo, você pode ter apenas os campos de nome no `Person` de tabela e ter separado `Instructor` e `Student` tabelas com os campos de data.</span><span class="sxs-lookup"><span data-stu-id="261b4-128">For example, you could have only the name fields in the `Person` table and have separate `Instructor` and `Student` tables with the date fields.</span></span>

![Tabela por type_inheritance](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image4.png)

<span data-ttu-id="261b4-130">Esse padrão de criação de uma tabela de banco de dados para cada classe de entidade é chamado *tabela por tipo* herança (TPT).</span><span class="sxs-lookup"><span data-stu-id="261b4-130">This pattern of making a database table for each entity class is called *table per type* (TPT) inheritance.</span></span>

<span data-ttu-id="261b4-131">Outra opção é mapear todos os tipos de não-abstrato para tabelas individuais.</span><span class="sxs-lookup"><span data-stu-id="261b4-131">Yet another option is to map all non-abstract types to individual tables.</span></span> <span data-ttu-id="261b4-132">Todas as propriedades de uma classe, incluindo propriedades herdadas, mapeiam para colunas da tabela correspondente.</span><span class="sxs-lookup"><span data-stu-id="261b4-132">All properties of a class, including inherited properties, map to columns of the corresponding table.</span></span> <span data-ttu-id="261b4-133">Esse padrão é chamado de herança de classe de tabela por concreto TPC ().</span><span class="sxs-lookup"><span data-stu-id="261b4-133">This pattern is called Table-per-Concrete Class (TPC) inheritance.</span></span> <span data-ttu-id="261b4-134">Se você tiver implementado herança TPC para o `Person`, `Student`, e `Instructor` classes como mostrado anteriormente, o `Student` e `Instructor` tabelas seria não diferentes depois de implementar a herança do que antes.</span><span class="sxs-lookup"><span data-stu-id="261b4-134">If you implemented TPC inheritance for the `Person`, `Student`, and `Instructor` classes as shown earlier, the `Student` and `Instructor` tables would look no different after implementing inheritance than they did before.</span></span>

<span data-ttu-id="261b4-135">TPC e padrões de herança TPH geralmente oferecem um desempenho melhor no Entity Framework de padrões de herança TPT, como padrões TPT podem resultar em consultas de junção complexas.</span><span class="sxs-lookup"><span data-stu-id="261b4-135">TPC and TPH inheritance patterns generally deliver better performance in the Entity Framework than TPT inheritance patterns, because TPT patterns can result in complex join queries.</span></span>

<span data-ttu-id="261b4-136">Este tutorial demonstra como implementar a herança TPH.</span><span class="sxs-lookup"><span data-stu-id="261b4-136">This tutorial demonstrates how to implement TPH inheritance.</span></span> <span data-ttu-id="261b4-137">TPH é o padrão de herança no Entity Framework, portanto, tudo o que você precisa fazer é criar um `Person` classe, altere o `Instructor` e `Student` classes derivar `Person`, adicione a nova classe para o `DbContext`e criar um migração.</span><span class="sxs-lookup"><span data-stu-id="261b4-137">TPH is the default inheritance pattern in the Entity Framework, so all you have to do is create a `Person` class, change the `Instructor` and `Student` classes to derive from `Person`, add the new class to the `DbContext`, and create a migration.</span></span> <span data-ttu-id="261b4-138">(Para obter informações sobre como implementar os padrões de herança, consulte [mapeando a herança de tabela por tipo (TPT)](https://msdn.microsoft.com/en-us/data/jj591617#2.5) e [mapeando a herança de classe de tabela por concreto (TPC)](https://msdn.microsoft.com/en-us/data/jj591617#2.6) no MSDN Documentação de estrutura de entidade.)</span><span class="sxs-lookup"><span data-stu-id="261b4-138">(For information about how to implement the other inheritance patterns, see [Mapping the Table-Per-Type (TPT) Inheritance](https://msdn.microsoft.com/en-us/data/jj591617#2.5) and [Mapping the Table-Per-Concrete Class (TPC) Inheritance](https://msdn.microsoft.com/en-us/data/jj591617#2.6) in the MSDN Entity Framework documentation.)</span></span>

## <a name="create-the-person-class"></a><span data-ttu-id="261b4-139">Criar a classe pessoa</span><span class="sxs-lookup"><span data-stu-id="261b4-139">Create the Person class</span></span>

<span data-ttu-id="261b4-140">No *modelos* pasta, criar *Person.cs* e substitua o código de modelo com o código a seguir:</span><span class="sxs-lookup"><span data-stu-id="261b4-140">In the *Models* folder, create *Person.cs* and replace the template code with the following code:</span></span>

[!code-csharp[Main](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample1.cs)]

## <a name="make-student-and-instructor-classes-inherit-from-person"></a><span data-ttu-id="261b4-141">Verifique o aluno e do instrutor classes herdam a pessoa</span><span class="sxs-lookup"><span data-stu-id="261b4-141">Make Student and Instructor classes inherit from Person</span></span>

<span data-ttu-id="261b4-142">Em *Instructor.cs*, derivar o `Instructor` classe o `Person` classe e remover os campos de chave e nome.</span><span class="sxs-lookup"><span data-stu-id="261b4-142">In *Instructor.cs*, derive the `Instructor` class from the `Person` class and remove the key and name fields.</span></span> <span data-ttu-id="261b4-143">O código será semelhante o exemplo a seguir:</span><span class="sxs-lookup"><span data-stu-id="261b4-143">The code will look like the following example:</span></span>

[!code-csharp[Main](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample2.cs)]

<span data-ttu-id="261b4-144">Fazer alterações semelhantes para *Student.cs*.</span><span class="sxs-lookup"><span data-stu-id="261b4-144">Make similar changes to *Student.cs*.</span></span> <span data-ttu-id="261b4-145">O `Student` classe se parecerá com o exemplo a seguir:</span><span class="sxs-lookup"><span data-stu-id="261b4-145">The `Student` class will look like the following example:</span></span>

[!code-csharp[Main](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample3.cs)]

## <a name="add-the-person-entity-type-to-the-model"></a><span data-ttu-id="261b4-146">Adicione o tipo de entidade de pessoa para o modelo</span><span class="sxs-lookup"><span data-stu-id="261b4-146">Add the Person Entity Type to the Model</span></span>

<span data-ttu-id="261b4-147">Em *SchoolContext.cs*, adicione um `DbSet` propriedade para o `Person` tipo de entidade:</span><span class="sxs-lookup"><span data-stu-id="261b4-147">In *SchoolContext.cs*, add a `DbSet` property for the `Person` entity type:</span></span>

[!code-csharp[Main](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample4.cs)]

<span data-ttu-id="261b4-148">Isso é tudo o que o Entity Framework precisa para configurar a herança de tabela por hierarquia.</span><span class="sxs-lookup"><span data-stu-id="261b4-148">This is all that the Entity Framework needs in order to configure table-per-hierarchy inheritance.</span></span> <span data-ttu-id="261b4-149">Como você verá, quando o banco de dados é atualizado, ele terá um `Person` tabela em vez do `Student` e `Instructor` tabelas.</span><span class="sxs-lookup"><span data-stu-id="261b4-149">As you'll see, when the database is updated, it will have a `Person` table in place of the `Student` and `Instructor` tables.</span></span>

## <a name="create-and-update-a-migrations-file"></a><span data-ttu-id="261b4-150">Criar e atualizar um arquivo de migrações</span><span class="sxs-lookup"><span data-stu-id="261b4-150">Create and Update a Migrations File</span></span>

<span data-ttu-id="261b4-151">No pacote Manager Console (PMC), digite o seguinte comando:</span><span class="sxs-lookup"><span data-stu-id="261b4-151">In the Package Manager Console (PMC), enter the following command:</span></span>

`Add-Migration Inheritance`

<span data-ttu-id="261b4-152">Execute o `Update-Database` do PMC.</span><span class="sxs-lookup"><span data-stu-id="261b4-152">Run the `Update-Database` command in the PMC.</span></span> <span data-ttu-id="261b4-153">O comando falhará neste momento porque temos os dados existentes que migrações não sabe como tratar.</span><span class="sxs-lookup"><span data-stu-id="261b4-153">The command will fail at this point because we have existing data that migrations doesn't know how to handle.</span></span> <span data-ttu-id="261b4-154">Você receberá uma mensagem de erro semelhante à seguinte:</span><span class="sxs-lookup"><span data-stu-id="261b4-154">You get an error message like the following one:</span></span>

> <span data-ttu-id="261b4-155">*Não foi possível descartar o objeto ' dbo. Instrutor ' porque ele é referenciado por uma restrição FOREIGN KEY.*</span><span class="sxs-lookup"><span data-stu-id="261b4-155">*Could not drop object 'dbo.Instructor' because it is referenced by a FOREIGN KEY constraint.*</span></span>


<span data-ttu-id="261b4-156">Abra *migrações\&lt; carimbo de hora&gt;\_Inheritance.cs* e substitua o `Up` método com o código a seguir:</span><span class="sxs-lookup"><span data-stu-id="261b4-156">Open *Migrations\&lt;timestamp&gt;\_Inheritance.cs* and replace the `Up` method with the following code:</span></span>

[!code-csharp[Main](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample5.cs)]

<span data-ttu-id="261b4-157">Esse código cuida das seguintes tarefas de atualização de banco de dados:</span><span class="sxs-lookup"><span data-stu-id="261b4-157">This code takes care of the following database update tasks:</span></span>

- <span data-ttu-id="261b4-158">Remove as restrições de chave estrangeira e índices que apontam para a tabela de alunos.</span><span class="sxs-lookup"><span data-stu-id="261b4-158">Removes foreign key constraints and indexes that point to the Student table.</span></span>
- <span data-ttu-id="261b4-159">Renomeia a tabela instrutor como pessoa e faz as alterações necessárias para ele armazenar dados de aluno:</span><span class="sxs-lookup"><span data-stu-id="261b4-159">Renames the Instructor table as Person and makes changes needed for it to store Student data:</span></span>

    - <span data-ttu-id="261b4-160">Adiciona EnrollmentDate anulável para estudantes.</span><span class="sxs-lookup"><span data-stu-id="261b4-160">Adds nullable EnrollmentDate for students.</span></span>
    - <span data-ttu-id="261b4-161">Adiciona a coluna discriminadora para indicar se uma linha é para um aluno ou instrutor.</span><span class="sxs-lookup"><span data-stu-id="261b4-161">Adds Discriminator column to indicate whether a row is for a student or an instructor.</span></span>
    - <span data-ttu-id="261b4-162">Torna HireDate anulável como linhas de aluno não têm datas de contratação.</span><span class="sxs-lookup"><span data-stu-id="261b4-162">Makes HireDate nullable since student rows won't have hire dates.</span></span>
    - <span data-ttu-id="261b4-163">Adiciona um campo temporário que será usado para atualizar chaves estrangeiras que apontam para os alunos.</span><span class="sxs-lookup"><span data-stu-id="261b4-163">Adds a temporary field that will be used to update foreign keys that point to students.</span></span> <span data-ttu-id="261b4-164">Quando você copia os alunos para a tabela pessoa que receberão novos valores de chave primária.</span><span class="sxs-lookup"><span data-stu-id="261b4-164">When you copy students into the Person table they'll get new primary key values.</span></span>
- <span data-ttu-id="261b4-165">Copia os dados da tabela de estudante na tabela Person.</span><span class="sxs-lookup"><span data-stu-id="261b4-165">Copies data from the Student table into the Person table.</span></span> <span data-ttu-id="261b4-166">Isso faz com que os alunos novos valores de chave primária foi atribuído.</span><span class="sxs-lookup"><span data-stu-id="261b4-166">This causes students to get assigned new primary key values.</span></span>
- <span data-ttu-id="261b4-167">Correções de valores de chave estrangeira que apontam para os alunos.</span><span class="sxs-lookup"><span data-stu-id="261b4-167">Fixes foreign key values that point to students.</span></span>
- <span data-ttu-id="261b4-168">Recria índices, agora apontá-los para a tabela Person e restrições de chave estrangeira.</span><span class="sxs-lookup"><span data-stu-id="261b4-168">Re-creates foreign key constraints and indexes, now pointing them to the Person table.</span></span>

<span data-ttu-id="261b4-169">(Se você tiver usado o GUID, em vez de inteiro como o tipo de chave primário, os valores de chave primária do aluno não precisam alterar e várias dessas etapas foi foi omitidas).</span><span class="sxs-lookup"><span data-stu-id="261b4-169">(If you had used GUID instead of integer as the primary key type, the student primary key values wouldn't have to change, and several of these steps could have been omitted.)</span></span>

<span data-ttu-id="261b4-170">Execute o `update-database` comando novamente.</span><span class="sxs-lookup"><span data-stu-id="261b4-170">Run the `update-database` command again.</span></span>

<span data-ttu-id="261b4-171">(Em um sistema de produção faça as alterações correspondentes para o método de busca no caso de você teve de usá-la para voltar para a versão anterior do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="261b4-171">(In a production system you would make corresponding changes to the Down method in case you ever had to use that to go back to the previous database version.</span></span> <span data-ttu-id="261b4-172">Neste tutorial você não irá usar o método de busca.)</span><span class="sxs-lookup"><span data-stu-id="261b4-172">For this tutorial you won't be using the Down method.)</span></span>

> [!NOTE]
> <span data-ttu-id="261b4-173">É possível obter outros erros durante a migração de dados e fazer alterações de esquema.</span><span class="sxs-lookup"><span data-stu-id="261b4-173">It's possible to get other errors when migrating data and making schema changes.</span></span> <span data-ttu-id="261b4-174">Se você obtiver erros de migração não é possível resolver, você pode continuar com o tutorial, alterando a cadeia de conexão do *Web. config* de arquivos ou por excluir o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="261b4-174">If you get migration errors you can't resolve, you can continue with the tutorial by changing the connection string in the *Web.config* file or by deleting the database.</span></span> <span data-ttu-id="261b4-175">A abordagem mais simples é renomear o banco de dados no *Web. config* arquivo.</span><span class="sxs-lookup"><span data-stu-id="261b4-175">The simplest approach is to rename the database in the *Web.config* file.</span></span> <span data-ttu-id="261b4-176">Por exemplo, altere o nome do banco de dados para ContosoUniversity2 conforme mostrado no exemplo a seguir:</span><span class="sxs-lookup"><span data-stu-id="261b4-176">For example, change the database name to ContosoUniversity2 as shown in the following example:</span></span>
> 
> [!code-xml[Main](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample6.xml?highlight=2)]
> 
> <span data-ttu-id="261b4-177">Com um novo banco de dados, não há nenhum dado para migrar e o `update-database` comando é muito mais probabilidade de ser concluído sem erros.</span><span class="sxs-lookup"><span data-stu-id="261b4-177">With a new database, there is no data to migrate, and the `update-database` command is much more likely to complete without errors.</span></span> <span data-ttu-id="261b4-178">Para obter instruções sobre como excluir o banco de dados, consulte [como descartar um banco de dados do Visual Studio 2012](http://romiller.com/2013/05/17/how-to-drop-a-database-from-visual-studio-2012/).</span><span class="sxs-lookup"><span data-stu-id="261b4-178">For instructions on how to delete the database, see [How to Drop a Database from Visual Studio 2012](http://romiller.com/2013/05/17/how-to-drop-a-database-from-visual-studio-2012/).</span></span> <span data-ttu-id="261b4-179">Se você usar essa abordagem para continuar com o tutorial, ignore a etapa da implantação no final deste tutorial ou implantar um novo site e o banco de dados.</span><span class="sxs-lookup"><span data-stu-id="261b4-179">If you take this approach in order to continue with the tutorial, skip the deployment step at the end of this tutorial or deploy to a new site and database.</span></span> <span data-ttu-id="261b4-180">Se você implantar uma atualização no mesmo site que você tenha sido Implantando já, EF receberá o mesmo erro existe quando ele é automaticamente executado migrações.</span><span class="sxs-lookup"><span data-stu-id="261b4-180">If you deploy an update to the same site you've been deploying to already, EF will get the same error there when it runs migrations automatically.</span></span> <span data-ttu-id="261b4-181">Se você quiser solucionar o erro migrações, o melhor recurso é um dos fóruns do Entity Framework ou StackOverflow.com.</span><span class="sxs-lookup"><span data-stu-id="261b4-181">If you want to troubleshoot a migrations error, the best resource is one of the Entity Framework forums or StackOverflow.com.</span></span>


## <a name="testing"></a><span data-ttu-id="261b4-182">Testes</span><span class="sxs-lookup"><span data-stu-id="261b4-182">Testing</span></span>

<span data-ttu-id="261b4-183">Executar o site e tente várias páginas.</span><span class="sxs-lookup"><span data-stu-id="261b4-183">Run the site and try various pages.</span></span> <span data-ttu-id="261b4-184">Tudo funciona da mesma forma que antes.</span><span class="sxs-lookup"><span data-stu-id="261b4-184">Everything works the same as it did before.</span></span>

<span data-ttu-id="261b4-185">Em **Gerenciador de servidores,** expanda **dados Connections\SchoolContext** e, em seguida, **tabelas**, e você verá que o **aluno** e **Instrutor** tabelas foram substituídas por um **pessoa** tabela.</span><span class="sxs-lookup"><span data-stu-id="261b4-185">In **Server Explorer,** expand **Data Connections\SchoolContext** and then **Tables**, and you see that the **Student** and **Instructor** tables have been replaced by a **Person** table.</span></span> <span data-ttu-id="261b4-186">Expanda o **pessoa** tabela e ver que tem todas as colunas que existiam no **aluno** e **instrutor** tabelas.</span><span class="sxs-lookup"><span data-stu-id="261b4-186">Expand the **Person** table and you see that it has all of the columns that used to be in the **Student** and **Instructor** tables.</span></span>

![Server_Explorer_showing_Person_table](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image5.png)

<span data-ttu-id="261b4-188">Clique com botão direito a tabela Person e, em seguida, clique em **Mostrar dados da tabela** para ver a coluna discriminadora.</span><span class="sxs-lookup"><span data-stu-id="261b4-188">Right-click the Person table, and then click **Show Table Data** to see the discriminator column.</span></span>

![](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image6.png)

<span data-ttu-id="261b4-189">O diagrama a seguir ilustra a estrutura do novo banco de dados de escola:</span><span class="sxs-lookup"><span data-stu-id="261b4-189">The following diagram illustrates the structure of the new School database:</span></span>

![School_database_diagram](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image7.png)

## <a name="deploy-to-azure"></a><span data-ttu-id="261b4-191">Implantar no Azure</span><span class="sxs-lookup"><span data-stu-id="261b4-191">Deploy to Azure</span></span>

<span data-ttu-id="261b4-192">Esta seção requer que você concluiu o opcional **implantar o aplicativo no Azure** seção [parte 3, classificação, filtragem e paginação](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application.md) da série neste tutorial.</span><span class="sxs-lookup"><span data-stu-id="261b4-192">This section requires you to have completed the optional **Deploying the app to Azure** section in [Part 3, Sorting, Filtering, and Paging](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application.md) of this tutorial series.</span></span> <span data-ttu-id="261b4-193">Se você tiver erros de migrações resolvido excluindo o banco de dados em seu projeto local, ignore esta etapa; ou crie um novo site e o banco de dados e implantar para o novo ambiente.</span><span class="sxs-lookup"><span data-stu-id="261b4-193">If you had migrations errors that you resolved by deleting the database in your local project, skip this step; or create a new site and database, and deploy to the new environment.</span></span>

1. <span data-ttu-id="261b4-194">No Visual Studio, clique com botão direito no projeto no **Solution Explorer** e selecione **publicar** no menu de contexto.</span><span class="sxs-lookup"><span data-stu-id="261b4-194">In Visual Studio, right-click the project in **Solution Explorer** and select **Publish** from the context menu.</span></span>  
  
    ![Publicar no menu de contexto do projeto](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image8.png)
2. <span data-ttu-id="261b4-196">Clique em **Publicar**.</span><span class="sxs-lookup"><span data-stu-id="261b4-196">Click **Publish**.</span></span>  
  
    ![publicar](implementing-inheritance-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image9.png)  
  
 <span data-ttu-id="261b4-198">O aplicativo Web será aberto no navegador padrão.</span><span class="sxs-lookup"><span data-stu-id="261b4-198">The Web app will open in your default browser.</span></span>
3. <span data-ttu-id="261b4-199">Testar o aplicativo para verificar se ela está funcionando.</span><span class="sxs-lookup"><span data-stu-id="261b4-199">Test the application to verify it's working.</span></span>

    <span data-ttu-id="261b4-200">Na primeira vez que você executa uma página que acessa o banco de dados, o Entity Framework executa todas as migrações `Up` métodos necessários para colocar o banco de dados atualizado com o modelo de dados atual.</span><span class="sxs-lookup"><span data-stu-id="261b4-200">The first time you run a page that accesses the database, the Entity Framework runs all of the migrations `Up` methods required to bring the database up to date with the current data model.</span></span>

## <a name="summary"></a><span data-ttu-id="261b4-201">Resumo</span><span class="sxs-lookup"><span data-stu-id="261b4-201">Summary</span></span>

<span data-ttu-id="261b4-202">Você implementou a herança de tabela por hierarquia para o `Person`, `Student`, e `Instructor` classes.</span><span class="sxs-lookup"><span data-stu-id="261b4-202">You've implemented table-per-hierarchy inheritance for the `Person`, `Student`, and `Instructor` classes.</span></span> <span data-ttu-id="261b4-203">Para obter mais informações sobre essa e outras estruturas de herança, consulte [padrão de herança TPT](https://msdn.microsoft.com/en-us/data/jj618293) e [padrão de herança TPH](https://msdn.microsoft.com/en-us/data/jj618292) no MSDN.</span><span class="sxs-lookup"><span data-stu-id="261b4-203">For more information about this and other inheritance structures, see [TPT Inheritance Pattern](https://msdn.microsoft.com/en-us/data/jj618293) and [TPH Inheritance Pattern](https://msdn.microsoft.com/en-us/data/jj618292) on MSDN.</span></span> <span data-ttu-id="261b4-204">O seguinte tutorial, você verá como manipular uma variedade de cenários relativamente avançados do Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="261b4-204">In the next tutorial you'll see how to handle a variety of relatively advanced Entity Framework scenarios.</span></span>

<span data-ttu-id="261b4-205">Links para outros recursos do Entity Framework podem ser encontradas no [acesso a dados ASP.NET - recomendado recursos](../../../../whitepapers/aspnet-data-access-content-map.md).</span><span class="sxs-lookup"><span data-stu-id="261b4-205">Links to other Entity Framework resources can be found in the [ASP.NET Data Access - Recommended Resources](../../../../whitepapers/aspnet-data-access-content-map.md).</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="261b4-206">[Anterior](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application.md)
[Próximo](advanced-entity-framework-scenarios-for-an-mvc-web-application.md)</span><span class="sxs-lookup"><span data-stu-id="261b4-206">[Previous](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application.md)
[Next](advanced-entity-framework-scenarios-for-an-mvc-web-application.md)</span></span>
