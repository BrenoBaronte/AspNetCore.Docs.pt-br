---
uid: identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project
title: "Adicionar projeto de formulários do ASP.NET Identity para uma Web vazio ou já existente | Microsoft Docs"
author: raquelsa
description: "Este tutorial mostra como adicionar a identidade do ASP.NET (o novo sistema de associação do ASP.NET) para um aplicativo ASP.NET. Quando você cria uma nova Web Forms ou MVC..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 10/23/2013
ms.topic: article
ms.assetid: 1cbc0ed2-5bd6-4b62-8d34-4c193dcd8b25
ms.technology: 
ms.prod: .net-framework
msc.legacyurl: /identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project
msc.type: authoredcontent
ms.openlocfilehash: f5783287a26174ddf65bb0eae34c347831d02c47
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/10/2017
---
<a name="adding-aspnet-identity-to-an-empty-or-existing-web-forms-project"></a><span data-ttu-id="c48fe-104">Projeto de formulários de identidade do ASP.NET adicionando um Web vazio ou existente</span><span class="sxs-lookup"><span data-stu-id="c48fe-104">Adding ASP.NET Identity to an Empty or Existing Web Forms Project</span></span>
====================
<span data-ttu-id="c48fe-105">por [Raquel Soares De Almeida](https://github.com/raquelsa)</span><span class="sxs-lookup"><span data-stu-id="c48fe-105">by [Raquel Soares De Almeida](https://github.com/raquelsa)</span></span>

> <span data-ttu-id="c48fe-106">Este tutorial mostra como adicionar [ASP.NET Identity](introduction-to-aspnet-identity.md) (o novo sistema de associação do ASP.NET) para um aplicativo ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="c48fe-106">This tutorial shows you how to add [ASP.NET Identity](introduction-to-aspnet-identity.md) (the new membership system for ASP.NET) to an ASP.NET application.</span></span>
> 
> <span data-ttu-id="c48fe-107">Quando você cria um novo projeto MVC ou de Web Forms no Visual Studio 2013 RTM com contas individuais, Visual Studio instalará todos os pacotes necessários e adicionar todas as classes necessárias para você.</span><span class="sxs-lookup"><span data-stu-id="c48fe-107">When you create a new Web Forms or MVC project in Visual Studio 2013 RTM with Individual Accounts, Visual Studio will install all the required packages and add all necessary classes for you.</span></span> <span data-ttu-id="c48fe-108">Este tutorial ilustra as etapas para adicionar suporte a identidade do ASP.NET para o projeto Web Forms existente ou um novo projeto vazio.</span><span class="sxs-lookup"><span data-stu-id="c48fe-108">This tutorial will illustrate the steps to add ASP.NET Identity support to your existing Web Forms project or a new empty project.</span></span> <span data-ttu-id="c48fe-109">Vou descrever todos os pacotes do NuGet que é necessário instalar, de classes que você precisa adicionar.</span><span class="sxs-lookup"><span data-stu-id="c48fe-109">I will outline all the NuGet packages you need to install, and classes you need to add.</span></span> <span data-ttu-id="c48fe-110">Entrarei em formulários da Web de exemplo para registrar novos usuários e fazer logon ao realce todas as APIs de ponto de entrada principal para autenticação e gerenciamento de usuário.</span><span class="sxs-lookup"><span data-stu-id="c48fe-110">I will go over sample Web Forms for registering new users and logging in while highlighting all main entry point APIs for user management and authentication.</span></span> <span data-ttu-id="c48fe-111">Este exemplo usará a implementação do padrão de identidade do ASP.NET para o armazenamento de dados SQL que é criado no Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="c48fe-111">This sample will use the ASP.NET Identity default implementation for SQL data storage which is built on Entity Framework.</span></span> <span data-ttu-id="c48fe-112">Neste tutorial, vamos usar LocalDB para o banco de dados SQL.</span><span class="sxs-lookup"><span data-stu-id="c48fe-112">This tutorial, we will use LocalDB for the SQL database.</span></span>
> 
> <span data-ttu-id="c48fe-113">Este tutorial foi escrito por Raquel Soares De Almeida e Rick Anderson ( [ @RickAndMSFT ](https://twitter.com/#!/RickAndMSFT) ).</span><span class="sxs-lookup"><span data-stu-id="c48fe-113">This tutorial was written by Raquel Soares De Almeida and Rick Anderson ( [@RickAndMSFT](https://twitter.com/#!/RickAndMSFT) ).</span></span>


## <a name="getting-started-aspnet-identity"></a><span data-ttu-id="c48fe-114">Introdução a identidade do ASP.NET</span><span class="sxs-lookup"><span data-stu-id="c48fe-114">Getting Started ASP.NET Identity</span></span>

1. <span data-ttu-id="c48fe-115">Comece instalando e executando [Visual Studio Express 2013 para Web](https://go.microsoft.com/fwlink/?LinkId=299058) ou [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span><span class="sxs-lookup"><span data-stu-id="c48fe-115">Start by installing and running [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) or [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span></span>
2. <span data-ttu-id="c48fe-116">Clique em **novo projeto** desde o início página, ou você pode usar o menu e selecione **arquivo**e, em seguida, **novo projeto**.</span><span class="sxs-lookup"><span data-stu-id="c48fe-116">Click **New Project** from the Start page, or you can use the menu and select **File**, and then **New Project**.</span></span>
3. <span data-ttu-id="c48fe-117">Selecione **Visual C# i** n painel esquerdo, em seguida, **Web** e, em seguida, selecione **aplicativo Web ASP.NET**.</span><span class="sxs-lookup"><span data-stu-id="c48fe-117">Select **Visual C# i** n the left pane, then **Web** and then select **ASP.NET Web Application**.</span></span> <span data-ttu-id="c48fe-118">Nomeie o projeto "WebFormsIdentity" e, em seguida, clique em **Okey**.</span><span class="sxs-lookup"><span data-stu-id="c48fe-118">Name your project "WebFormsIdentity" and then click **OK**.</span></span>   
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image1.png)
4. <span data-ttu-id="c48fe-119">No **novo projeto ASP.NET** caixa de diálogo, selecione o **vazio** modelo.</span><span class="sxs-lookup"><span data-stu-id="c48fe-119">In the **New ASP.NET Project** dialog, select the **Empty** template.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image2.png)  
  
 <span data-ttu-id="c48fe-120">Observe o **alterar autenticação** botão será desabilitado e não há suporte de autenticação é fornecida nesse modelo.</span><span class="sxs-lookup"><span data-stu-id="c48fe-120">Notice the **Change Authentication** button is disabled and no authentication support is provided in this template.</span></span> <span data-ttu-id="c48fe-121">Os modelos de Web Forms, MVC e API da Web permitem que você selecione o método de autenticação.</span><span class="sxs-lookup"><span data-stu-id="c48fe-121">The Web Forms, MVC and Web API templates allow you to select the authentication approach.</span></span> <span data-ttu-id="c48fe-122">Para obter mais informações, consulte [visão geral de autenticação](../../../visual-studio/overview/2013/creating-web-projects-in-visual-studio.md#auth) .</span><span class="sxs-lookup"><span data-stu-id="c48fe-122">For more information, see [Overview of Authentication](../../../visual-studio/overview/2013/creating-web-projects-in-visual-studio.md#auth) .</span></span>

## <a name="adding-identity-packages-to-your-app"></a><span data-ttu-id="c48fe-123">Adicionando pacotes de identidade para seu aplicativo</span><span class="sxs-lookup"><span data-stu-id="c48fe-123">Adding Identity Packages to your App</span></span>

<span data-ttu-id="c48fe-124">No Gerenciador de soluções, clique com o botão direito e selecione **gerenciar pacotes NuGet**.</span><span class="sxs-lookup"><span data-stu-id="c48fe-124">In Solution Explorer, right-click your project and select **Manage NuGet Packages**.</span></span> <span data-ttu-id="c48fe-125">Na caixa de diálogo de pesquisa texto, digite "*Identity.E*".</span><span class="sxs-lookup"><span data-stu-id="c48fe-125">In the search text box dialog, type "*Identity.E*".</span></span> <span data-ttu-id="c48fe-126">Clique em instalar para este pacote.</span><span class="sxs-lookup"><span data-stu-id="c48fe-126">Click install for this package.</span></span>   
  
![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image3.png)  
  
<span data-ttu-id="c48fe-127">Observe que este pacote irá instalar os pacotes de dependência: EntityFramework e Microsoft ASP.NET Identity Core.</span><span class="sxs-lookup"><span data-stu-id="c48fe-127">Note that this package will install the dependency packages: EntityFramework and Microsoft ASP.NET Identity Core.</span></span>

## <a name="adding-web-forms-to-register-users"></a><span data-ttu-id="c48fe-128">Adição de Web Forms para registrar usuários</span><span class="sxs-lookup"><span data-stu-id="c48fe-128">Adding Web Forms to Register Users</span></span>

1. <span data-ttu-id="c48fe-129">Em **Solution Explorer**, clique com o botão direito e clique em **adicionar**e, em seguida, **formulário da Web**.</span><span class="sxs-lookup"><span data-stu-id="c48fe-129">In **Solution Explorer**, right-click your project and click **Add**, and then **Web Form**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image4.png)
2. <span data-ttu-id="c48fe-130">No **especificar nome para o Item** caixa de diálogo, o nome do novo formulário da web **registrar**e, em seguida, clique em **Okey**</span><span class="sxs-lookup"><span data-stu-id="c48fe-130">In the **Specify Name for Item** dialog box, name the new web form **Register**, and then click **OK**</span></span>
3. <span data-ttu-id="c48fe-131">Substitua a marcação em gerado *Register* arquivo com o código a seguir.</span><span class="sxs-lookup"><span data-stu-id="c48fe-131">Replace the markup in the generated *Register.aspx* file with the code below.</span></span> <span data-ttu-id="c48fe-132">As alterações de código são realçadas.</span><span class="sxs-lookup"><span data-stu-id="c48fe-132">The code changes are highlighted.</span></span>   

    [!code-aspx[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample1.aspx?highlight=9,12-40)]

    > [!NOTE]
    > <span data-ttu-id="c48fe-133">Isso é apenas uma versão simplificada do *Register* arquivo criado quando você cria um novo projeto ASP.NET Web Forms.</span><span class="sxs-lookup"><span data-stu-id="c48fe-133">This is just a simplified version of the *Register.aspx* file that is created when you create a new ASP.NET Web Forms project.</span></span> <span data-ttu-id="c48fe-134">A marcação acima adiciona campos do formulário e um botão para registrar um novo usuário.</span><span class="sxs-lookup"><span data-stu-id="c48fe-134">The markup above adds form fields and a button to register a new user.</span></span>
4. <span data-ttu-id="c48fe-135">Abra o *Register.aspx.cs* de arquivo e substituir o conteúdo do arquivo com o código a seguir:</span><span class="sxs-lookup"><span data-stu-id="c48fe-135">Open the *Register.aspx.cs* file and replace the contents of the file with the following code:</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample2.cs)]

    > [!NOTE] 
    > 
    > 1. <span data-ttu-id="c48fe-136">O código acima é uma versão simplificada do *Register.aspx.cs* arquivo criado quando você cria um novo projeto ASP.NET Web Forms.</span><span class="sxs-lookup"><span data-stu-id="c48fe-136">The code above is a simplified version of the *Register.aspx.cs* file that is created when you create a new ASP.NET Web Forms project.</span></span>
    > 2. <span data-ttu-id="c48fe-137">O *IdentityUser* classe é a implementação EntityFramework padrão a *IUser* interface.</span><span class="sxs-lookup"><span data-stu-id="c48fe-137">The *IdentityUser* class is the default EntityFramework implementation of the *IUser* interface.</span></span> <span data-ttu-id="c48fe-138">*IUser* interface é a interface mínima para um usuário no ASP.NET Identity Core.</span><span class="sxs-lookup"><span data-stu-id="c48fe-138">*IUser* interface is the minimal interface for a user on ASP.NET Identity Core.</span></span>
    > 3. <span data-ttu-id="c48fe-139">O *UserStore* classe é a implementação de EntityFramework padrão de um repositório do usuário.</span><span class="sxs-lookup"><span data-stu-id="c48fe-139">The *UserStore* class is the default EntityFramework implementation of a user store.</span></span> <span data-ttu-id="c48fe-140">Essa classe implementa interfaces mínimas do ASP.NET Identity Core: *IUserStore*, *IUserLoginStore*, *IUserClaimStore* e *IUserRoleStore* .</span><span class="sxs-lookup"><span data-stu-id="c48fe-140">This class implements the ASP.NET Identity Core's minimal interfaces: *IUserStore*, *IUserLoginStore*, *IUserClaimStore* and *IUserRoleStore*.</span></span>
    > 4. <span data-ttu-id="c48fe-141">O *UserManager* APIs que salvará automaticamente as alterações relacionadas ao usuário expõe o *UserStore*.</span><span class="sxs-lookup"><span data-stu-id="c48fe-141">The *UserManager* class exposes user related APIs which will automatically save changes to the *UserStore*.</span></span>
    > 5. <span data-ttu-id="c48fe-142">O *IdentityResult* classe representa o resultado de uma operação de identidade.</span><span class="sxs-lookup"><span data-stu-id="c48fe-142">The *IdentityResult* class represents the result of an identity operation.</span></span>
5. <span data-ttu-id="c48fe-143">Em **Solution Explorer**, clique com o botão direito e clique em **adicionar**, **adicionar pasta ASP.NET** e **aplicativo\_dados**.</span><span class="sxs-lookup"><span data-stu-id="c48fe-143">In **Solution Explorer**, right-click your project and click **Add**, **Add ASP.NET Folder** and then **App\_Data**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image5.png)
6. <span data-ttu-id="c48fe-144">Abra o *Web. config* de arquivos e adicionar uma entrada de cadeia de caracteres de conexão para o banco de dados que usaremos para armazenar informações do usuário.</span><span class="sxs-lookup"><span data-stu-id="c48fe-144">Open the *Web.config* file and add a connection string entry for the database we will use to store user information.</span></span> <span data-ttu-id="c48fe-145">O banco de dados será criado no tempo de execução por EntityFramework para as entidades de identidade.</span><span class="sxs-lookup"><span data-stu-id="c48fe-145">The database will be created at runtime by EntityFramework for the Identity entities.</span></span> <span data-ttu-id="c48fe-146">A cadeia de caracteres de conexão é semelhante a um criado quando você cria um novo projeto de formulários da Web.</span><span class="sxs-lookup"><span data-stu-id="c48fe-146">The connection string is similar to one created for you when you create a new Web Forms project.</span></span> <span data-ttu-id="c48fe-147">O código realçado mostra a marcação, você deve adicionar:</span><span class="sxs-lookup"><span data-stu-id="c48fe-147">The highlighted code shows the markup you should add:</span></span>

    [!code-xml[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample3.xml?highlight=11-14)]
    
    > [!NOTE] 
    > <span data-ttu-id="c48fe-148">Para o Visual Studio 2015 ou superior, substitua `(localdb)\v11.0` com `(localdb)\MSSQLLocalDB` em sua cadeia de conexão.</span><span class="sxs-lookup"><span data-stu-id="c48fe-148">For Visual Studio 2015 or higher, replace `(localdb)\v11.0` with `(localdb)\MSSQLLocalDB` in your connection string.</span></span>
    
7. <span data-ttu-id="c48fe-149">Clique com botão direito arquivo *Register* no seu projeto e selecione **definir como página inicial**.</span><span class="sxs-lookup"><span data-stu-id="c48fe-149">Right click file *Register.aspx* in your project and select **Set as Start Page**.</span></span> <span data-ttu-id="c48fe-150">Pressione Ctrl + F5 para compilar e executar o aplicativo web.</span><span class="sxs-lookup"><span data-stu-id="c48fe-150">Press Ctrl + F5 to build and run the web application.</span></span> <span data-ttu-id="c48fe-151">Digite um novo nome de usuário e senha e, em seguida, clique em **registrar**.</span><span class="sxs-lookup"><span data-stu-id="c48fe-151">Enter a new user name and password and then click on **Register**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image6.png)  

    > [!NOTE]
    > <span data-ttu-id="c48fe-152">Identidade do ASP.NET tem suporte para validação e neste exemplo, você pode verificar o comportamento padrão de usuário e senha validadores que vêm do pacote principal de identidade.</span><span class="sxs-lookup"><span data-stu-id="c48fe-152">ASP.NET Identity has support for validation and in this sample you can verify the default behavior on User and Password validators that come from the Identity Core package.</span></span> <span data-ttu-id="c48fe-153">O validador de padrão para o usuário (`UserValidator`) tem uma propriedade `AllowOnlyAlphanumericUserNames` que tem o valor padrão definido como `true`.</span><span class="sxs-lookup"><span data-stu-id="c48fe-153">The default validator for User (`UserValidator`) has a property `AllowOnlyAlphanumericUserNames` that has default value set to `true`.</span></span> <span data-ttu-id="c48fe-154">O validador de padrão para a senha (`MinimumLengthValidator`) garante que a senha tem pelo menos 6 caracteres.</span><span class="sxs-lookup"><span data-stu-id="c48fe-154">The default validator for Password (`MinimumLengthValidator`) ensures that password has at least 6 characters.</span></span> <span data-ttu-id="c48fe-155">Esses validadores são propriedades em `UserManager` que pode ser substituído se você deseja ter a validação personalizada,</span><span class="sxs-lookup"><span data-stu-id="c48fe-155">These validators are properties on `UserManager` that can be overridden if you want to have custom validation,</span></span>

## <a name="verifying-the-localdb-identity-database-and-tables-generated-by-entity-framework"></a><span data-ttu-id="c48fe-156">Verificando a identidade de LocalDb banco de dados e tabelas geradas pelo Entity Framework</span><span class="sxs-lookup"><span data-stu-id="c48fe-156">Verifying the LocalDb Identity Database and Tables Generated by Entity Framework</span></span>

1. <span data-ttu-id="c48fe-157">No **exibição** menu, clique em **Server Explorer**.</span><span class="sxs-lookup"><span data-stu-id="c48fe-157">In the **View** menu, click **Server Explorer**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image7.png)
2. <span data-ttu-id="c48fe-158">Expanda **DefaultConnection (WebFormsIdentity)**, expanda **tabelas**, clique com botão direito **AspNetUsers** e clique em **Mostrar dados da tabela**.</span><span class="sxs-lookup"><span data-stu-id="c48fe-158">Expand **DefaultConnection (WebFormsIdentity)**, expand **Tables**, right click **AspNetUsers** and click **Show Table Data**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image8.png)  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image9.png)

## <a name="configuring-the-application-for-owin-authentication"></a><span data-ttu-id="c48fe-159">Configurando o aplicativo para autenticação OWIN</span><span class="sxs-lookup"><span data-stu-id="c48fe-159">Configuring the application for OWIN authentication</span></span>

<span data-ttu-id="c48fe-160">Neste ponto, apenas adicionamos suporte para a criação de usuários.</span><span class="sxs-lookup"><span data-stu-id="c48fe-160">At this point we have only added support for creating users.</span></span> <span data-ttu-id="c48fe-161">Agora, vamos demonstrar como é possível adicionar autenticação de logon de um usuário.</span><span class="sxs-lookup"><span data-stu-id="c48fe-161">Now, we are going to demonstrate how we can add authentication to login a user.</span></span> <span data-ttu-id="c48fe-162">Identidade do ASP.NET usa a autenticação do Microsoft OWIN middleware para autenticação de formulários.</span><span class="sxs-lookup"><span data-stu-id="c48fe-162">ASP.NET Identity uses Microsoft OWIN Authentication middleware for forms authentication.</span></span> <span data-ttu-id="c48fe-163">A autenticação de Cookie OWIN é um cookie e declarações de mecanismo de autenticação com base que pode ser usado por qualquer estrutura hospedada em [OWIN](https://msdn.microsoft.com/en-us/magazine/dn451439.aspx) ou IIS.</span><span class="sxs-lookup"><span data-stu-id="c48fe-163">The OWIN Cookie Authentication is a cookie and claims based authentication mechanism that can be used by any framework hosted on [OWIN](https://msdn.microsoft.com/en-us/magazine/dn451439.aspx) or IIS.</span></span> <span data-ttu-id="c48fe-164">Com esse modelo, os mesmos pacotes de autenticação podem ser usados em várias estruturas, incluindo ASP.NET MVC e formulários da Web.</span><span class="sxs-lookup"><span data-stu-id="c48fe-164">With this model, the same authentication packages can be used across multiple frameworks including ASP.NET MVC and Web Forms.</span></span> <span data-ttu-id="c48fe-165">Para obter mais informações sobre o projeto Katana e a execução de middleware em um consulte independente de host [guia de Introdução ao projeto Katana](https://msdn.microsoft.com/en-us/magazine/dn451439.aspx).</span><span class="sxs-lookup"><span data-stu-id="c48fe-165">For more information on project Katana and how to run middleware in a host agnostic see [Getting Started with the Katana Project](https://msdn.microsoft.com/en-us/magazine/dn451439.aspx).</span></span>

## <a name="installing-authentication-packages-to-your-application"></a><span data-ttu-id="c48fe-166">Instalando os pacotes de autenticação para seu aplicativo</span><span class="sxs-lookup"><span data-stu-id="c48fe-166">Installing authentication packages to your application</span></span>

1. <span data-ttu-id="c48fe-167">No Gerenciador de soluções, clique com o botão direito e selecione **gerenciar pacotes NuGet**.</span><span class="sxs-lookup"><span data-stu-id="c48fe-167">In Solution Explorer, right-click your project and select **Manage NuGet Packages**.</span></span> <span data-ttu-id="c48fe-168">Na caixa de diálogo de pesquisa texto, digite "*Identity.Owin*".</span><span class="sxs-lookup"><span data-stu-id="c48fe-168">In the search text box dialog, type "*Identity.Owin*".</span></span> <span data-ttu-id="c48fe-169">Clique em instalar para este pacote.</span><span class="sxs-lookup"><span data-stu-id="c48fe-169">Click install for this package.</span></span>   
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image10.png)
2. <span data-ttu-id="c48fe-170">Pesquise pacote ***systemweb*** e instalá-lo.</span><span class="sxs-lookup"><span data-stu-id="c48fe-170">Search for package ***Microsoft.Owin.Host.SystemWeb*** and install it.</span></span>   

    > [!NOTE]
    > <span data-ttu-id="c48fe-171">O **Microsoft.Aspnet.Identity.Owin** pacote contém um conjunto de classes de extensão OWIN para gerenciar e configurar o middleware de autenticação OWIN a ser consumidos por pacotes de ASP.NET Identity Core.</span><span class="sxs-lookup"><span data-stu-id="c48fe-171">The **Microsoft.Aspnet.Identity.Owin** package contains a set of OWIN extension classes to manage and configure OWIN authentication middleware to be consumed by ASP.NET Identity Core packages.</span></span>  
    > <span data-ttu-id="c48fe-172">O **systemweb** pacote contém um servidor OWIN que permite que aplicativos baseados no OWIN para executar em IIS usando o pipeline de solicitação do ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="c48fe-172">The **Microsoft.Owin.Host.SystemWeb** package contains an OWIN server that enables OWIN-based applications to run on IIS using the ASP.NET request pipeline.</span></span> <span data-ttu-id="c48fe-173">Para obter mais informações, consulte [Middleware OWIN no IIS integrado pipeline](../../../aspnet/overview/owin-and-katana/owin-middleware-in-the-iis-integrated-pipeline.md).</span><span class="sxs-lookup"><span data-stu-id="c48fe-173">For more information see [OWIN Middleware in the IIS integrated pipeline](../../../aspnet/overview/owin-and-katana/owin-middleware-in-the-iis-integrated-pipeline.md).</span></span>

## <a name="adding-owin-startup-and-authentication-configuration-classes"></a><span data-ttu-id="c48fe-174">Adicionando Classes de configuração de autenticação e de inicialização OWIN</span><span class="sxs-lookup"><span data-stu-id="c48fe-174">Adding OWIN Startup and Authentication Configuration Classes</span></span>

1. <span data-ttu-id="c48fe-175">Em **Solution Explorer**, clique com o botão direito, clique em **adicionar**e, em seguida, **Adicionar Novo Item**.</span><span class="sxs-lookup"><span data-stu-id="c48fe-175">In **Solution Explorer**, right-click your project, click **Add**, and then **Add New Item**.</span></span> <span data-ttu-id="c48fe-176">Na caixa de diálogo de pesquisa texto, digite "*owin*".</span><span class="sxs-lookup"><span data-stu-id="c48fe-176">In the search text box dialog, type "*owin*".</span></span> <span data-ttu-id="c48fe-177">Nomeie a classe "*inicialização*" e clique em **adicionar**.</span><span class="sxs-lookup"><span data-stu-id="c48fe-177">Name the class "*Startup*" and click **Add**.</span></span>   
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image11.png)
2. <span data-ttu-id="c48fe-178">No arquivo Startup.cs, adicione o código realçado abaixo para configurar a autenticação de cookie do OWIN.</span><span class="sxs-lookup"><span data-stu-id="c48fe-178">In the Startup.cs file, add the highlighted code shown below to configure OWIN cookie authentication.</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample4.cs?highlight=1,3,15-19)]

    > [!NOTE]
    > <span data-ttu-id="c48fe-179">Essa classe contém o `OwinStartup` atributo para especificar a classe de inicialização OWIN.</span><span class="sxs-lookup"><span data-stu-id="c48fe-179">This class contains the `OwinStartup` attribute for specifying the OWIN startup class.</span></span> <span data-ttu-id="c48fe-180">Cada aplicativo OWIN tem uma classe de inicialização em que você especificar componentes para o pipeline do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="c48fe-180">Every OWIN application has a startup class where you specify components for the application pipeline.</span></span> <span data-ttu-id="c48fe-181">Consulte [detecção de classe de inicialização OWIN](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) para obter mais informações sobre esse modelo.</span><span class="sxs-lookup"><span data-stu-id="c48fe-181">See [OWIN Startup Class Detection](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) for more info on this model.</span></span>

## <a name="adding-web-forms-for-registering-and-logging-in-users"></a><span data-ttu-id="c48fe-182">Adicionando formulários da Web para registrar e login de usuários</span><span class="sxs-lookup"><span data-stu-id="c48fe-182">Adding Web Forms for Registering and Logging in Users</span></span>

1. <span data-ttu-id="c48fe-183">Abra o *Register.cs* de arquivo e adicione o seguinte código que registrará o usuário quando o registro terá êxito.</span><span class="sxs-lookup"><span data-stu-id="c48fe-183">Open the *Register.cs* file and add the following code which will log in the user when registration succeeds.</span></span> <span data-ttu-id="c48fe-184">As alterações estão destacadas abaixo.</span><span class="sxs-lookup"><span data-stu-id="c48fe-184">The changes are highlighted below.</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample5.cs)]

    > [!NOTE] 
    > 
    > - <span data-ttu-id="c48fe-185">Como identidade do ASP.NET e autenticação de Cookie OWIN são sistema baseada em declarações, o framework requer o desenvolvedor do aplicativo gerar um [ClaimsIdentity](https://msdn.microsoft.com/en-us/library/microsoft.identitymodel.claims.claimsidentity.aspx) para o usuário.</span><span class="sxs-lookup"><span data-stu-id="c48fe-185">Since ASP.NET Identity and OWIN Cookie Authentication are claims based system, the framework requires the app developer to generate a [ClaimsIdentity](https://msdn.microsoft.com/en-us/library/microsoft.identitymodel.claims.claimsidentity.aspx) for the user.</span></span> <span data-ttu-id="c48fe-186">ClaimsIdentity tem informações sobre todas as declarações para o usuário, como as funções que o usuário pertence.</span><span class="sxs-lookup"><span data-stu-id="c48fe-186">ClaimsIdentity has information about all the claims for the user such as what Roles the user belongs to.</span></span> <span data-ttu-id="c48fe-187">Você também pode adicionar mais declarações para o usuário neste estágio.</span><span class="sxs-lookup"><span data-stu-id="c48fe-187">You can also add more claims for the user at this stage.</span></span>
    > - <span data-ttu-id="c48fe-188">Você pode entrar o usuário usando o AuthenticationManager do OWIN e chamar `SignIn` e passando o ClaimsIdentity como mostrado acima.</span><span class="sxs-lookup"><span data-stu-id="c48fe-188">You can sign in the user by using the AuthenticationManager from OWIN and calling `SignIn` and passing in the ClaimsIdentity as shown above.</span></span> <span data-ttu-id="c48fe-189">Esse código será entre o usuário e gerar um cookie também.</span><span class="sxs-lookup"><span data-stu-id="c48fe-189">This code will sign in the user and generate a cookie as well.</span></span> <span data-ttu-id="c48fe-190">Esta chamada é análoga a [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthentication.setauthcookie.aspx) usado pelo [FormsAuthentication](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthenticationmodule.aspx) módulo.</span><span class="sxs-lookup"><span data-stu-id="c48fe-190">This call is analogous to [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthentication.setauthcookie.aspx) used by the [FormsAuthentication](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
2. <span data-ttu-id="c48fe-191">Em **Solution Explorer**, clique o projeto, clique **adicionar**e, em seguida, **formulário da Web**.</span><span class="sxs-lookup"><span data-stu-id="c48fe-191">In **Solution Explorer**, right-click your project click **Add**, and then **Web Form**.</span></span> <span data-ttu-id="c48fe-192">Nomeie o formulário da web **logon**.</span><span class="sxs-lookup"><span data-stu-id="c48fe-192">Name the web form **Login**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image12.png)
3. <span data-ttu-id="c48fe-193">Substitua o conteúdo do *Login.aspx* arquivo com o código a seguir:</span><span class="sxs-lookup"><span data-stu-id="c48fe-193">Replace the contents of the *Login.aspx* file with the following code:</span></span>  

    [!code-aspx[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample6.aspx)]
4. <span data-ttu-id="c48fe-194">Substitua o conteúdo do *Login.aspx.cs* arquivo com o seguinte:</span><span class="sxs-lookup"><span data-stu-id="c48fe-194">Replace the contents of the *Login.aspx.cs* file with the following:</span></span>  

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample7.cs)]

    > [!NOTE] 
    > 
    > - <span data-ttu-id="c48fe-195">O `Page_Load` agora verifica o status do usuário atual e executará uma ação com base em seu `Context.User.Identity.IsAuthenticated` status.</span><span class="sxs-lookup"><span data-stu-id="c48fe-195">The `Page_Load` now checks for the status of current user and takes action based on its `Context.User.Identity.IsAuthenticated` status.</span></span>  
    >     <span data-ttu-id="c48fe-196">**Exibir o log em nome de usuário** : O Microsoft ASP.NET Identity Framework adicionou os métodos de extensão em [IIdentity](https://msdn.microsoft.com/en-us/library/system.security.principal.iidentity.aspx) que permite que você obtenha o `UserName` e `UserId` para o Usuário conectado.</span><span class="sxs-lookup"><span data-stu-id="c48fe-196">**Display Logged in User Name** : The Microsoft ASP.NET Identity Framework has added extension methods on [System.Security.Principal.IIdentity](https://msdn.microsoft.com/en-us/library/system.security.principal.iidentity.aspx) that allows you to get the `UserName` and `UserId`  for the logged in User.</span></span> <span data-ttu-id="c48fe-197">Esses métodos de extensão são definidos no `Microsoft.AspNet.Identity.Core` assembly.</span><span class="sxs-lookup"><span data-stu-id="c48fe-197">These extension methods are defined in the `Microsoft.AspNet.Identity.Core` assembly.</span></span> <span data-ttu-id="c48fe-198">Esses métodos de extensão são a substituição de [HttpContext.User.Identity.Name](https://msdn.microsoft.com/en-us/library/system.web.httpcontext.user.aspx) .</span><span class="sxs-lookup"><span data-stu-id="c48fe-198">These extension methods are the replacement for [HttpContext.User.Identity.Name](https://msdn.microsoft.com/en-us/library/system.web.httpcontext.user.aspx) .</span></span>
    > - <span data-ttu-id="c48fe-199">Método de entrada:</span><span class="sxs-lookup"><span data-stu-id="c48fe-199">SignIn method:</span></span>   
    >     <span data-ttu-id="c48fe-200">`This`método substitui anterior `CreateUser_Click` método neste exemplo e agora conecta o usuário depois de criar com êxito o usuário.</span><span class="sxs-lookup"><span data-stu-id="c48fe-200">`This` method replaces the previous `CreateUser_Click` method in this sample and now signs in the user after successfully creating the user.</span></span>   
    >  <span data-ttu-id="c48fe-201">O Microsoft OWIN Framework adicionou os métodos de extensão em `System.Web.HttpContext` que permite que você obtenha uma referência a um `IOwinContext`.</span><span class="sxs-lookup"><span data-stu-id="c48fe-201">The Microsoft OWIN Framework has added extension methods on `System.Web.HttpContext` that allows you to get a reference to an `IOwinContext`.</span></span> <span data-ttu-id="c48fe-202">Esses métodos de extensão são definidos no `Microsoft.Owin.Host.SystemWeb` assembly.</span><span class="sxs-lookup"><span data-stu-id="c48fe-202">These extension methods are defined in `Microsoft.Owin.Host.SystemWeb` assembly.</span></span> <span data-ttu-id="c48fe-203">O `OwinContext` classe expõe um `IAuthenticationManager` propriedade que representa a funcionalidade de middleware de autenticação disponível na solicitação atual.</span><span class="sxs-lookup"><span data-stu-id="c48fe-203">The `OwinContext` class exposes an `IAuthenticationManager` property that represents the Authentication middleware functionality available on the current request.</span></span>  
    >  <span data-ttu-id="c48fe-204">Você pode entrar o usuário usando o `AuthenticationManager` do OWIN e chamar `SignIn` e passando o `ClaimsIdentity` como mostrado acima.</span><span class="sxs-lookup"><span data-stu-id="c48fe-204">You can sign in the user by using the `AuthenticationManager` from OWIN and calling `SignIn`  and passing in the `ClaimsIdentity`  as shown above.</span></span>   
    >  <span data-ttu-id="c48fe-205">Como identidade do ASP.NET e autenticação de Cookie OWIN são sistema baseado em declarações, o framework requer o aplicativo para gerar um `ClaimsIdentity` para o usuário.</span><span class="sxs-lookup"><span data-stu-id="c48fe-205">Because ASP.NET Identity and OWIN Cookie Authentication are claims-based system, the framework requires the app to generate a `ClaimsIdentity` for the user.</span></span>   
    >  <span data-ttu-id="c48fe-206">O `ClaimsIdentity` tem informações sobre todas as declarações para o usuário, como as funções que o usuário pertence.</span><span class="sxs-lookup"><span data-stu-id="c48fe-206">The `ClaimsIdentity` has information about all the claims for the user, such as what roles the user belongs to.</span></span> <span data-ttu-id="c48fe-207">Você também pode adicionar mais declarações para o usuário neste estágio</span><span class="sxs-lookup"><span data-stu-id="c48fe-207">You can also add more claims for the user at this stage</span></span>  
    >  <span data-ttu-id="c48fe-208">Esse código será entre o usuário e gerar um cookie também.</span><span class="sxs-lookup"><span data-stu-id="c48fe-208">This code will sign in the user and generate a cookie as well.</span></span> <span data-ttu-id="c48fe-209">Esta chamada é análoga a [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthentication.setauthcookie.aspx) usado pelo [FormsAuthentication](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthenticationmodule.aspx) módulo.</span><span class="sxs-lookup"><span data-stu-id="c48fe-209">This call is analogous to [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthentication.setauthcookie.aspx) used by the [FormsAuthentication](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
    > - <span data-ttu-id="c48fe-210">`SignOut`método:</span><span class="sxs-lookup"><span data-stu-id="c48fe-210">`SignOut` method:</span></span>   
    >  <span data-ttu-id="c48fe-211">Obtém uma referência para o `AuthenticationManager` do OWIN e chamadas `SignOut`.</span><span class="sxs-lookup"><span data-stu-id="c48fe-211">Gets a reference to the `AuthenticationManager` from OWIN and calls `SignOut`.</span></span> <span data-ttu-id="c48fe-212">Isso equivale a [FormsAuthentication.SignOut](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthentication.signout.aspx) método usado pelo [FormsAuthentication](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthenticationmodule.aspx) módulo.</span><span class="sxs-lookup"><span data-stu-id="c48fe-212">This is analogous to [FormsAuthentication.SignOut](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthentication.signout.aspx) method used by the [FormsAuthentication](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
5. <span data-ttu-id="c48fe-213">Pressione **Ctrl + F5** para compilar e executar o aplicativo web.</span><span class="sxs-lookup"><span data-stu-id="c48fe-213">Press **Ctrl + F5** to build and run the web application.</span></span> <span data-ttu-id="c48fe-214">Digite um novo nome de usuário e senha e, em seguida, clique em **registrar**.</span><span class="sxs-lookup"><span data-stu-id="c48fe-214">Enter a new user name and password and then click on **Register**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image13.png)  
 <span data-ttu-id="c48fe-215">Observação: neste ponto, o novo usuário é criado e conectado.</span><span class="sxs-lookup"><span data-stu-id="c48fe-215">Note: At this point, the new user is created and logged in.</span></span>
6. <span data-ttu-id="c48fe-216">Clique em **logoff** botão. Você será redirecionado para o formulário de login.</span><span class="sxs-lookup"><span data-stu-id="c48fe-216">Click on **Log out** button.You will be redirected to the Log in form.</span></span>
7. <span data-ttu-id="c48fe-217">Insira um nome de usuário inválido ou a senha e clique **login** botão.</span><span class="sxs-lookup"><span data-stu-id="c48fe-217">Enter an invalid user name or password and Click on **Log in** button.</span></span>   
 <span data-ttu-id="c48fe-218">O `UserManager.Find` método retornará null e a mensagem de erro: " *nome inválido de usuário ou senha* " será exibida.</span><span class="sxs-lookup"><span data-stu-id="c48fe-218">The `UserManager.Find`  method will return null and the error message: " *Invalid user name or password* " will be displayed.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image14.png)
