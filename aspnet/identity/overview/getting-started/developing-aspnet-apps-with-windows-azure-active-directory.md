---
uid: identity/overview/getting-started/developing-aspnet-apps-with-windows-azure-active-directory
title: Desenvolvimento de aplicativos ASP.NET com o Active Directory do Azure | Microsoft Docs
author: Rick-Anderson
description: "Ferramentas do Microsoft ASP.NET para Active Directory do Azure simplifica a habilitar a autenticação para aplicativos web hospedados no Azure. Você pode usar o Azure Autenti..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 08/14/2014
ms.topic: article
ms.assetid: 457d7eaf-ee76-4ceb-9082-c7c1721435ad
ms.technology: 
ms.prod: .net-framework
msc.legacyurl: /identity/overview/getting-started/developing-aspnet-apps-with-windows-azure-active-directory
msc.type: authoredcontent
ms.openlocfilehash: 1ef0468d5f5c17480b23ac88983f30fe6f4979c0
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 01/24/2018
---
<a name="developing-aspnet-apps-with-azure-active-directory"></a><span data-ttu-id="95f11-104">Desenvolvimento de aplicativos ASP.NET com o Active Directory do Azure</span><span class="sxs-lookup"><span data-stu-id="95f11-104">Developing ASP.NET Apps with Azure Active Directory</span></span>
====================
<span data-ttu-id="95f11-105">Por [Rick Anderson](https://github.com/Rick-Anderson)</span><span class="sxs-lookup"><span data-stu-id="95f11-105">by [Rick Anderson](https://github.com/Rick-Anderson)</span></span>

> <span data-ttu-id="95f11-106">Microsoft ASP.NET ferramentas para Active Directory do Azure torna simples para habilitar a autenticação para aplicativos web hospedados no [Azure](https://www.windowsazure.com/home/features/web-sites/).</span><span class="sxs-lookup"><span data-stu-id="95f11-106">Microsoft ASP.NET tools for Azure Active Directory makes it simple to enable authentication for web applications hosted on [Azure](https://www.windowsazure.com/home/features/web-sites/).</span></span> <span data-ttu-id="95f11-107">Você pode usar a autenticação do Azure para autenticar usuários do Office 365 da sua organização, as contas corporativas sincronizadas do Active Directory local ou os usuários criados no seu próprio domínio personalizado do Active Directory do Azure.</span><span class="sxs-lookup"><span data-stu-id="95f11-107">You can use Azure Authentication to authenticate Office 365 users from your organization, corporate accounts synced from your on-premise Active Directory or users created in your own custom Azure Active Directory domain.</span></span> <span data-ttu-id="95f11-108">Habilitar a autenticação do Windows Azure configura seu aplicativo para autenticar usuários usando uma única [Active Directory do Azure](https://docs.microsoft.com/azure/active-directory/) locatário.</span><span class="sxs-lookup"><span data-stu-id="95f11-108">Enabling Windows Azure Authentication configures your application to authenticate users using a single [Azure Active Directory](https://docs.microsoft.com/azure/active-directory/) tenant.</span></span>
> 
>  <span data-ttu-id="95f11-109">Este tutorial foi escrito de Rick Anderson[@RickAndMSFT](https://twitter.com/#!/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="95f11-109">This tutorial was written by Rick Anderson [@RickAndMSFT](https://twitter.com/#!/RickAndMSFT)</span></span>


<span data-ttu-id="95f11-110">Este tutorial mostra como criar um aplicativo ASP.NET que está configurado para logon com [Active Directory do Azure](https://msdn.microsoft.com/library/azure/mt168838.aspx) (AD do Azure).</span><span class="sxs-lookup"><span data-stu-id="95f11-110">This tutorial will show you how to create an ASP.NET application that is configured for sign-on with [Azure Active Directory](https://msdn.microsoft.com/library/azure/mt168838.aspx) (Azure AD).</span></span> <span data-ttu-id="95f11-111">Você também aprenderá como chamar a API do Graph para obter informações sobre o usuário conectado no momento e como implantar o aplicativo no Azure.</span><span class="sxs-lookup"><span data-stu-id="95f11-111">You will also learn how to call the Graph API to get information about the currently signed-in user and how to deploy the application to Azure.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="95f11-112">Pré-requisitos</span><span class="sxs-lookup"><span data-stu-id="95f11-112">Prerequisites</span></span>

1. <span data-ttu-id="95f11-113">[O Visual Studio Express 2013 para Web](https://www.microsoft.com/visualstudio/eng/2013-downloads#d-2013-express) ou [Visual Studio 2013](https://www.microsoft.com/visualstudio/eng/2013-downloads).</span><span class="sxs-lookup"><span data-stu-id="95f11-113">[Visual Studio Express 2013 for Web](https://www.microsoft.com/visualstudio/eng/2013-downloads#d-2013-express) or [Visual Studio 2013](https://www.microsoft.com/visualstudio/eng/2013-downloads).</span></span>
2. <span data-ttu-id="95f11-114">[Visual Studio 2013 Update 4](https://www.microsoft.com/download/details.aspx?id=44921) -Update 3 ou posterior é necessário.</span><span class="sxs-lookup"><span data-stu-id="95f11-114">[Visual Studio 2013 Update 4](https://www.microsoft.com/download/details.aspx?id=44921) - Update 3 or higher is required.</span></span>
3. <span data-ttu-id="95f11-115">Uma conta do Azure.</span><span class="sxs-lookup"><span data-stu-id="95f11-115">An Azure account.</span></span> <span data-ttu-id="95f11-116">[Clique aqui](https://azure.microsoft.com/pricing/free-trial/) para uma avaliação gratuita, se você ainda não tiver uma conta.</span><span class="sxs-lookup"><span data-stu-id="95f11-116">[Click here](https://azure.microsoft.com/pricing/free-trial/) for a free trial if you do not already have an account.</span></span>

## <a name="add-a-global-administrator-to-your-active-directory"></a><span data-ttu-id="95f11-117">Adicionar um Administrador Global no Active Directory</span><span class="sxs-lookup"><span data-stu-id="95f11-117">Add a Global Administrator to your Active Directory</span></span>

1. <span data-ttu-id="95f11-118">Entrar para o [Portal de gerenciamento do Azure](https://manage.windowsazure.com/).</span><span class="sxs-lookup"><span data-stu-id="95f11-118">Sign in to the [Azure Management Portal](https://manage.windowsazure.com/).</span></span>
2. <span data-ttu-id="95f11-119">Todas as contas do Azure contêm um **diretório padrão** - clique nela, clique o **usuários** guia na parte superior da página (consulte a imagem abaixo).</span><span class="sxs-lookup"><span data-stu-id="95f11-119">All Azure accounts contain a **Default Directory** -- click on it, then click the **Users** tab at the top of the page (see image below).</span></span>
3. <span data-ttu-id="95f11-120">Clique em Adicionar usuário.</span><span class="sxs-lookup"><span data-stu-id="95f11-120">Click Add User.</span></span>  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image1.png)
4. <span data-ttu-id="95f11-121">Criar um novo usuário com o **Administrador Global** função.</span><span class="sxs-lookup"><span data-stu-id="95f11-121">Create a new user with the **Global Administrator** role.</span></span> <span data-ttu-id="95f11-122">Clique em **usuários** no menu superior e, em seguida, clique o **adicionar usuário** botão na barra de comandos.</span><span class="sxs-lookup"><span data-stu-id="95f11-122">Click **Users** from the top menu, and then click the **Add User** button on the command bar.</span></span>
5. <span data-ttu-id="95f11-123">No **adicionar usuário** caixa de diálogo, digite um nome para o novo usuário e, em seguida, clique na seta à direita.</span><span class="sxs-lookup"><span data-stu-id="95f11-123">In the **Add User** dialog, enter a name for the new user and then click the right arrow.</span></span>  
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image2.png)
6. <span data-ttu-id="95f11-124">Insira o nome de usuário e defina a função para **Administrador Global**.</span><span class="sxs-lookup"><span data-stu-id="95f11-124">Enter the user name and set the role to **Global Administrator**.</span></span> <span data-ttu-id="95f11-125">Os administradores globais exigem um endereço de email alternativo para fins de recuperação de senha.</span><span class="sxs-lookup"><span data-stu-id="95f11-125">Global administrators require an alternate email address for password recovery purposes.</span></span> <span data-ttu-id="95f11-126">Após terminar, clique na seta à direita.</span><span class="sxs-lookup"><span data-stu-id="95f11-126">After you're finished, click the right arrow.</span></span>  
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image3.png)
7. <span data-ttu-id="95f11-127">Na próxima página da caixa de diálogo, clique em **criar**.</span><span class="sxs-lookup"><span data-stu-id="95f11-127">On the next page of the dialog, click **Create**.</span></span> <span data-ttu-id="95f11-128">Uma senha temporária será criada para o novo usuário e exibida na caixa de diálogo.</span><span class="sxs-lookup"><span data-stu-id="95f11-128">A temporary password will be created for the new user and displayed in the dialog.</span></span>   
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image4.png)  
  
 <span data-ttu-id="95f11-129">Salvar a senha, será necessário alterar a senha após o primeiro logon.</span><span class="sxs-lookup"><span data-stu-id="95f11-129">Save the password, you will be required to change the password after the first log in.</span></span> <span data-ttu-id="95f11-130">A imagem a seguir mostra a nova conta de administrador.</span><span class="sxs-lookup"><span data-stu-id="95f11-130">The following image shows the new admin account.</span></span> <span data-ttu-id="95f11-131">Você deve usar o Active Directory do Azure para fazer logon em seu aplicativo, não a conta da Microsoft também mostrado nesta página.</span><span class="sxs-lookup"><span data-stu-id="95f11-131">You must use the Azure Active Directory to log into your app, not the Microsoft account also shown on this page.</span></span>  
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image5.png)

## <a name="create-an-aspnet-application"></a><span data-ttu-id="95f11-132">Criar um aplicativo ASP.NET</span><span class="sxs-lookup"><span data-stu-id="95f11-132">Create an ASP.NET Application</span></span>

<span data-ttu-id="95f11-133">Use as etapas a seguir [Visual Studio Express 2013 para Web](https://www.microsoft.com/download/details.aspx?id=40747)e requer [Visual Studio 2013 atualização 3](https://www.microsoft.com/download/details.aspx?id=43721).</span><span class="sxs-lookup"><span data-stu-id="95f11-133">The following steps use [Visual Studio Express 2013 for Web](https://www.microsoft.com/download/details.aspx?id=40747), and requires [Visual Studio 2013 Update 3](https://www.microsoft.com/download/details.aspx?id=43721).</span></span>

1. <span data-ttu-id="95f11-134">No Visual Studio, clique em **arquivo** e **novo projeto**.</span><span class="sxs-lookup"><span data-stu-id="95f11-134">In Visual Studio, click **File** and then **New Project**.</span></span> <span data-ttu-id="95f11-135">Sobre o **novo projeto** caixa de diálogo, selecione Visual C# Web do projeto no menu à esquerda e clique em **Okey**.</span><span class="sxs-lookup"><span data-stu-id="95f11-135">On the **New Project** dialog, select the Visual C# Web project from the left menu and click **OK**.</span></span> <span data-ttu-id="95f11-136">Você também deseja desmarcar o **adicionar Application Insights ao projeto** se você não quiser a funcionalidade para seu aplicativo.</span><span class="sxs-lookup"><span data-stu-id="95f11-136">You may also want to uncheck the **Add Application Insights to Project** if you don't want the functionality for your application.</span></span>
2. <span data-ttu-id="95f11-137">No **novo projeto ASP.NET** caixa de diálogo, selecione **MVC**e, em seguida, clique em **alterar autenticação**.</span><span class="sxs-lookup"><span data-stu-id="95f11-137">In the **New ASP.NET Project** dialog, select **MVC**, and then click **Change Authentication**.</span></span>   
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image6.png)
3. <span data-ttu-id="95f11-138">Sobre o **alterar autenticação** caixa de diálogo, selecione **contas organizacionais**.</span><span class="sxs-lookup"><span data-stu-id="95f11-138">On the **Change Authentication** dialog, select **Organizational Accounts**.</span></span> <span data-ttu-id="95f11-139">Essas opções podem ser usadas para registrar automaticamente o aplicativo no AD do Azure, bem como configurar automaticamente seu aplicativo para integrar com o AD do Azure.</span><span class="sxs-lookup"><span data-stu-id="95f11-139">These options can be used to automatically register your application with Azure AD as well as automatically configure your application to integrate with Azure AD.</span></span> <span data-ttu-id="95f11-140">Você não precisa usar o **alterar autenticação** caixa de diálogo para registrar e configurar seu aplicativo, mas ele torna muito mais fácil.</span><span class="sxs-lookup"><span data-stu-id="95f11-140">You don't have to use the **Change Authentication** dialog to register and configure your application, but it makes it much easier.</span></span> <span data-ttu-id="95f11-141">Se você estiver usando o Visual Studio 2012, por exemplo, você pode manualmente registrar o aplicativo no Portal de gerenciamento do Azure e atualize sua configuração para integrar com o Azure AD.</span><span class="sxs-lookup"><span data-stu-id="95f11-141">If you are using Visual Studio 2012 for example, you can still manually register the application in the Azure Management Portal and update its configuration to integrate with Azure AD.</span></span>  
 <span data-ttu-id="95f11-142">No menu suspenso, selecione **nuvem - única organização** e **logon único, ler dados do diretório**.</span><span class="sxs-lookup"><span data-stu-id="95f11-142">In the drop-down menus, select **Cloud - Single Organization** and **Single Sign On, Read directory data**.</span></span> <span data-ttu-id="95f11-143">Digite o domínio do seu diretório do AD do Azure, por exemplo (nas imagens abaixo) *aricka0yahoo.onmicrosoft.com*e, em seguida, clique em **Okey**.</span><span class="sxs-lookup"><span data-stu-id="95f11-143">Enter the domain for your Azure AD directory, for example (in the images below) *aricka0yahoo.onmicrosoft.com*, and then click **OK**.</span></span> <span data-ttu-id="95f11-144">Você pode obter o nome de domínio da guia domínios para o diretório padrão no portal do azure (consulte a próxima imagem para baixo).</span><span class="sxs-lookup"><span data-stu-id="95f11-144">You can get the domain name from the Domains tab for the Default Directory on the azure portal (see the next image down).</span></span>   
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image7.png)  
  
 <span data-ttu-id="95f11-145">A imagem a seguir mostra o nome de domínio do portal do Azure.</span><span class="sxs-lookup"><span data-stu-id="95f11-145">The following image shows the domain name from the Azure portal.</span></span>  
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image8.png)  

    > [!NOTE]
    > <span data-ttu-id="95f11-146">Opcionalmente, você pode configurar o URI de ID do aplicativo que será registrado no AD do Azure clicando em **mais opções**.</span><span class="sxs-lookup"><span data-stu-id="95f11-146">You can optionally configure the Application ID URI that will be registered in Azure AD by clicking **More Options**.</span></span> <span data-ttu-id="95f11-147">O URI de ID do aplicativo é o identificador exclusivo para um aplicativo, que é registrado no Azure AD e usado pelo aplicativo para se identificar ao se comunicar com o Azure AD.</span><span class="sxs-lookup"><span data-stu-id="95f11-147">The App ID URI is the unique identifier for an application, which is registered in Azure AD and used by the application to identify itself when communicating with Azure AD.</span></span> <span data-ttu-id="95f11-148">Para obter mais informações sobre o URI de ID do aplicativo e outras propriedades de aplicativos registrados, consulte [neste tópico](https://msdn.microsoft.com/library/azure/dn499820.aspx#BKMK_Registering).</span><span class="sxs-lookup"><span data-stu-id="95f11-148">For more information about the App ID URI and other properties of registered applications, see [this topic](https://msdn.microsoft.com/library/azure/dn499820.aspx#BKMK_Registering).</span></span> <span data-ttu-id="95f11-149">Ao clicar na caixa de seleção abaixo do campo de URI de ID de aplicativo, também é possível substituir um registro existente no AD do Azure que usa o mesmo URI de ID do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="95f11-149">By clicking the checkbox below the App ID URI field, you can also choose to overwrite an existing registration in Azure AD that uses the same App ID URI.</span></span>
4. <span data-ttu-id="95f11-150">Depois de clicar em **Okey**, aparecerá uma caixa de diálogo de entrada, e você precisará entrar usando uma conta de Administrador Global (não a conta da Microsoft associada à sua assinatura).</span><span class="sxs-lookup"><span data-stu-id="95f11-150">After clicking **OK**, a sign-in dialog will appear, and you'll need to sign in using a Global Administrator account (not the Microsoft account associated with your subscription).</span></span> <span data-ttu-id="95f11-151">Se você criou uma nova conta de administrador anteriormente, você precisará alterar a senha e entrar novamente usando a nova senha.</span><span class="sxs-lookup"><span data-stu-id="95f11-151">If you created a new Administrator account earlier, you'll be required to change the password and then sign in again using the new password.</span></span>   
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image9.png)
5. <span data-ttu-id="95f11-152">Depois que você foi autenticado com êxito, o **novo projeto ASP.NET** caixa de diálogo mostrará a opção de autenticação (**organizacional** ) e o diretório onde o novo aplicativo será registrado (*aricka0yahoo.onmicrosoft.com* na imagem abaixo).</span><span class="sxs-lookup"><span data-stu-id="95f11-152">After you've successfully authenticated, the **New ASP.NET Project** dialog will show your authentication choice (**Organizational** ) and the directory where the new application will be registered (*aricka0yahoo.onmicrosoft.com* in the image below).</span></span> <span data-ttu-id="95f11-153">Seguir essas informações, selecione a caixa de seleção **Host na nuvem**.</span><span class="sxs-lookup"><span data-stu-id="95f11-153">Below this information, select the checkbox labeled **Host in the cloud**.</span></span> <span data-ttu-id="95f11-154">Se essa caixa de seleção estiver marcada, o projeto será configurado como um aplicativo web do Azure e será habilitado para publicação fácil mais tarde.</span><span class="sxs-lookup"><span data-stu-id="95f11-154">If this checkbox is selected, the project will be provisioned as an Azure web app and will be enabled for easy publishing later.</span></span> <span data-ttu-id="95f11-155">Clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="95f11-155">Click **OK**.</span></span>   
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image10.png)
6. <span data-ttu-id="95f11-156">O **configurar site do Azure** caixa de diálogo aparecerá, usando um nome de site gerado automaticamente e região.</span><span class="sxs-lookup"><span data-stu-id="95f11-156">The **Configure Azure Website** dialog will appear, using an auto-generated site name and region.</span></span> <span data-ttu-id="95f11-157">Observe também a conta que você está conectado no momento na caixa de diálogo.</span><span class="sxs-lookup"><span data-stu-id="95f11-157">Also note the account you're currently signed into in the dialog.</span></span> <span data-ttu-id="95f11-158">Você deseja certificar-se de que essa conta é a sua assinatura do Azure está anexada, normalmente uma conta da Microsoft.</span><span class="sxs-lookup"><span data-stu-id="95f11-158">You want to make sure that this account is the one that your Azure subscription is attached to, typically a Microsoft account.</span></span>

    > [!NOTE]
    > <span data-ttu-id="95f11-159">Este projeto requer um banco de dados.</span><span class="sxs-lookup"><span data-stu-id="95f11-159">This project requires a database.</span></span> <span data-ttu-id="95f11-160">Você precisa selecionar um dos bancos de dados existentes ou criar um novo.</span><span class="sxs-lookup"><span data-stu-id="95f11-160">You need to select one of your existing databases, or create a new one.</span></span> <span data-ttu-id="95f11-161">Um banco de dados é necessário porque o projeto já utiliza um arquivo de banco de dados local para armazenar uma pequena quantidade de dados de configuração de autenticação.</span><span class="sxs-lookup"><span data-stu-id="95f11-161">A database is required because the project already uses a local database file to store a small amount of authentication configuration data.</span></span> <span data-ttu-id="95f11-162">Quando você implanta o aplicativo em um site do Azure, este banco de dados não é empacotado com a implantação, portanto você precisa escolher um que seja acessível na nuvem.</span><span class="sxs-lookup"><span data-stu-id="95f11-162">When you deploy the application to an Azure Website, this database isn't packaged with the deployment, so you need to choose one that's accessible in the cloud.</span></span> <span data-ttu-id="95f11-163">Clique em **OK**.</span><span class="sxs-lookup"><span data-stu-id="95f11-163">Click **OK**.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image11.png)
7. <span data-ttu-id="95f11-164">O projeto será criado e suas opções de autenticação e opções de aplicativo da web serão automaticamente configuradas com o projeto.</span><span class="sxs-lookup"><span data-stu-id="95f11-164">The project will be created, and your authentication options and web app options will be automatically configured with the project.</span></span> <span data-ttu-id="95f11-165">Depois que esse processo for concluído, execute o projeto localmente pressionando **^ F5**.</span><span class="sxs-lookup"><span data-stu-id="95f11-165">Once this process has completed, run the project locally by pressing **^F5**.</span></span> <span data-ttu-id="95f11-166">Você precisará entrar usando sua conta organizacional.</span><span class="sxs-lookup"><span data-stu-id="95f11-166">You will be required to sign in using your organizational account.</span></span> <span data-ttu-id="95f11-167">Forneça o nome de usuário e a senha para a conta que você criou anteriormente e clique em **entrar**.</span><span class="sxs-lookup"><span data-stu-id="95f11-167">Provide the username and password for the account you created earlier and click **Sign in**.</span></span>   
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image12.png)
8. <span data-ttu-id="95f11-168">Após a conexão bem-sucedida, o site ASP.NET mostrará que você foi autenticado, exibindo o nome de usuário no canto superior direito da página.</span><span class="sxs-lookup"><span data-stu-id="95f11-168">After successful sign in, the ASP.NET site will show that you've authenticated by displaying the username in the top right corner of the page.</span></span>  
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image13.png)  
  
 <span data-ttu-id="95f11-169">Se você obtiver o erro:</span><span class="sxs-lookup"><span data-stu-id="95f11-169">If you get the error:</span></span>  
 <span data-ttu-id="95f11-170">Valor não pode ser nulo ou vazio.</span><span class="sxs-lookup"><span data-stu-id="95f11-170">Value cannot be null or empty.</span></span> <span data-ttu-id="95f11-171">Nome do parâmetro: linkText</span><span class="sxs-lookup"><span data-stu-id="95f11-171">Parameter name: linkText</span></span>   
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image14.png)  
  
 <span data-ttu-id="95f11-172">Consulte o [depurar](#dbg) seção no final do tutorial.</span><span class="sxs-lookup"><span data-stu-id="95f11-172">see the [debug](#dbg) section at the end of the tutorial.</span></span>

## <a name="basics-of-the-graph-api"></a><span data-ttu-id="95f11-173">Noções básicas sobre a API do Graph</span><span class="sxs-lookup"><span data-stu-id="95f11-173">Basics of the Graph API</span></span>

<span data-ttu-id="95f11-174">[A API do Graph](https://msdn.microsoft.com/library/azure/hh974476.aspx) é a interface de programação usada para realizar CRUD e outras operações em objetos em seu diretório do AD do Azure.</span><span class="sxs-lookup"><span data-stu-id="95f11-174">[The Graph API](https://msdn.microsoft.com/library/azure/hh974476.aspx) is the programmatic interface used to perform CRUD and other operations on objects in your Azure AD directory.</span></span> <span data-ttu-id="95f11-175">Se você selecionar uma opção de conta organizacional para autenticação ao criar um novo projeto no Visual Studio 2013, o aplicativo já será configurado para chamar a API do Graph.</span><span class="sxs-lookup"><span data-stu-id="95f11-175">If you select an Organizational Account option for authentication when creating a new project in Visual Studio 2013, your application will already be configured to call the Graph API.</span></span> <span data-ttu-id="95f11-176">Esta seção brevemente mostra como funciona a API do Graph.</span><span class="sxs-lookup"><span data-stu-id="95f11-176">This section briefly shows you how the Graph API works.</span></span>

1. <span data-ttu-id="95f11-177">Em seu aplicativo em execução, clique no nome do usuário conectado na parte superior direita da página.</span><span class="sxs-lookup"><span data-stu-id="95f11-177">In your running application, click on the name of the signed-in user at the top right of the page.</span></span> <span data-ttu-id="95f11-178">Isso levará para a página de perfil de usuário, que é uma ação no controlador de início.</span><span class="sxs-lookup"><span data-stu-id="95f11-178">This will take you to the User Profile page, which is an action on the Home Controller.</span></span> <span data-ttu-id="95f11-179">Você observará que a tabela contém informações de usuário sobre a conta de administrador que você criou anteriormente.</span><span class="sxs-lookup"><span data-stu-id="95f11-179">You'll notice that the table contains user information about the administrator account you created earlier.</span></span> <span data-ttu-id="95f11-180">Essas informações são armazenadas em seu diretório, e a API do Graph é chamada para recuperar essas informações quando a página for carregada.</span><span class="sxs-lookup"><span data-stu-id="95f11-180">This information is stored in your directory, and the Graph API is called to retrieve this information when the page loads.</span></span>   
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image15.png)
2. <span data-ttu-id="95f11-181">Volte para o Visual Studio e expanda o **controladores** pasta e, em seguida, abra o **HomeController** arquivo.</span><span class="sxs-lookup"><span data-stu-id="95f11-181">Go back to Visual Studio and expand the **Controllers** folder and then open the **HomeController.cs** file.</span></span> <span data-ttu-id="95f11-182">Você verá um **UserProfile()** que contém o código para recuperar um token e, em seguida, chame a API do Graph.</span><span class="sxs-lookup"><span data-stu-id="95f11-182">You'll see a **UserProfile()** action that contains code to retrieve a token and then call the Graph API.</span></span> <span data-ttu-id="95f11-183">Esse código é duplicado abaixo:</span><span class="sxs-lookup"><span data-stu-id="95f11-183">This code is duplicated below:</span></span> 

    [!code-csharp[Main](developing-aspnet-apps-with-windows-azure-active-directory/samples/sample1.cs?highlight=22)]

    <span data-ttu-id="95f11-184">Para chamar a API do Graph, primeiro você precisa recuperar um token.</span><span class="sxs-lookup"><span data-stu-id="95f11-184">To call the Graph API, you first need to retrieve a token.</span></span> <span data-ttu-id="95f11-185">Quando o token é recuperado, seu valor de cadeia de caracteres deve ser anexado no cabeçalho de autorização para todas as solicitações subsequentes para a API do Graph.</span><span class="sxs-lookup"><span data-stu-id="95f11-185">When the token is retrieved, its string value must be appended in the Authorization header for all subsequent requests to the Graph API.</span></span> <span data-ttu-id="95f11-186">A maioria do código acima trata os detalhes de autenticação no AD do Azure para obter um token, usando o token para fazer uma chamada à API do Graph e, em seguida, transformar a resposta para que ele pode ser apresentado no modo de exibição.</span><span class="sxs-lookup"><span data-stu-id="95f11-186">Most of the code above handles the details of authenticating to Azure AD to get a token, using the token to make a call to the Graph API, and then transforming the response so that it can be presented in the View.</span></span>

    <span data-ttu-id="95f11-187">A parte mais relevante para discussão é a seguinte linha realçada: `UserProfile profile = JsonConvert.DeserializeObject<UserProfile>(responseString);`.</span><span class="sxs-lookup"><span data-stu-id="95f11-187">The most relevant portion for discussion is the following highlighted line: `UserProfile profile = JsonConvert.DeserializeObject<UserProfile>(responseString);`.</span></span> <span data-ttu-id="95f11-188">Essa linha representa o nome do usuário que tiver sido desserializado da resposta JSON e é apresentado no modo de exibição.</span><span class="sxs-lookup"><span data-stu-id="95f11-188">This line represents the name of the user, which has been deserialized from the JSON response and is presented in the View.</span></span>

    <span data-ttu-id="95f11-189">Você pode chamar a API do Graph usando HttpClient e manipular os dados brutos por conta própria, mas uma maneira mais fácil é usar o [gráfico biblioteca de cliente que está disponível por meio do NuGet](http://www.nuget.org/packages/Microsoft.Azure.ActiveDirectory.GraphClient/).</span><span class="sxs-lookup"><span data-stu-id="95f11-189">You can call the Graph API using HttpClient and handle the raw data yourself, but an easier way is to use the [Graph Client Library which is available via NuGet](http://www.nuget.org/packages/Microsoft.Azure.ActiveDirectory.GraphClient/).</span></span> <span data-ttu-id="95f11-190">A biblioteca de cliente trata as solicitações HTTP brutas e a transformação dos dados retornados para você e torna muito mais fácil trabalhar com a API do Graph em um ambiente de .NET.</span><span class="sxs-lookup"><span data-stu-id="95f11-190">The Client Library handles the raw HTTP requests and the transformation of the returned data for you, and makes it much easier to work with the Graph API in a .NET environment.</span></span> <span data-ttu-id="95f11-191">Consulte os exemplos de código relacionados do API do Graph em [GitHub.](https://github.com/AzureADSamples)</span><span class="sxs-lookup"><span data-stu-id="95f11-191">See the related Graph API code samples on [GitHub.](https://github.com/AzureADSamples)</span></span>

## <a name="deploy-the-application-to-azure"></a><span data-ttu-id="95f11-192">Implantar o aplicativo no Azure</span><span class="sxs-lookup"><span data-stu-id="95f11-192">Deploy the Application to Azure</span></span>

<span data-ttu-id="95f11-193">As etapas a seguir mostram como implantar o aplicativo no Azure.</span><span class="sxs-lookup"><span data-stu-id="95f11-193">The following steps will show you how to deploy the application to Azure.</span></span> <span data-ttu-id="95f11-194">Nas etapas anteriores, você conectado seu novo projeto com um aplicativo web no Azure, para que esteja pronto para ser publicado em apenas algumas etapas.</span><span class="sxs-lookup"><span data-stu-id="95f11-194">In the earlier steps, you connected your new project with a web app on Azure, so it's ready to be published in just a few steps.</span></span>

1. <span data-ttu-id="95f11-195">No Visual Studio, clique com botão direito no projeto e selecione **publicar**.</span><span class="sxs-lookup"><span data-stu-id="95f11-195">In Visual Studio, right-click on the project and select **Publish**.</span></span> <span data-ttu-id="95f11-196">O **Publicar Web** caixa de diálogo aparecerá com cada configuração já configurada.</span><span class="sxs-lookup"><span data-stu-id="95f11-196">The **Publish Web** dialog will appear with each setting already configured.</span></span> <span data-ttu-id="95f11-197">Clique no **próximo** botão para ir para o **configurações** página.</span><span class="sxs-lookup"><span data-stu-id="95f11-197">Click on the **Next** button to go to the **Settings** page.</span></span> <span data-ttu-id="95f11-198">Você pode ser solicitado a autenticar; Verifique se que você se autenticar usando sua conta de assinatura do Azure (normalmente uma conta da Microsoft) e não a conta institucional que você criou anteriormente.</span><span class="sxs-lookup"><span data-stu-id="95f11-198">You may be prompted to authenticate; make sure you authenticate using your Azure subscription account (typically a Microsoft account) and not the organizational account you created earlier.</span></span>  
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image16.png)
2. <span data-ttu-id="95f11-199">Verifique o **habilitar a autenticação organizacional** opção.</span><span class="sxs-lookup"><span data-stu-id="95f11-199">Check the **Enable Organizational Authentication** option.</span></span> <span data-ttu-id="95f11-200">No **domínio** campo, digite o domínio do seu diretório.</span><span class="sxs-lookup"><span data-stu-id="95f11-200">In the **Domain** field, enter the domain for your directory.</span></span> <span data-ttu-id="95f11-201">Do **nível de acesso** lista suspensa, selecione **logon único, ler dados do diretório**.</span><span class="sxs-lookup"><span data-stu-id="95f11-201">From the **Access Level** drop-down, select **Single Sign On, Read directory data**.</span></span> <span data-ttu-id="95f11-202">Você observará que o banco de dados anterior usado já está preenchido no **bancos de dados** seção.</span><span class="sxs-lookup"><span data-stu-id="95f11-202">You'll notice that the previous database you used is already populated in the **Databases** section.</span></span> <span data-ttu-id="95f11-203">Clique em **Publicar**.</span><span class="sxs-lookup"><span data-stu-id="95f11-203">Click **Publish**.</span></span>  
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image17.png)
3. <span data-ttu-id="95f11-204">Visual Studio iniciará a implantação de seu site, e, em seguida, uma nova janela do navegador será exibida.</span><span class="sxs-lookup"><span data-stu-id="95f11-204">Visual Studio will begin deploying your website, and then a new browser window will appear.</span></span> <span data-ttu-id="95f11-205">Você precisará autenticar novamente o seu diretório.</span><span class="sxs-lookup"><span data-stu-id="95f11-205">You may be prompted to authenticate to your directory once again.</span></span> <span data-ttu-id="95f11-206">Depois de autenticado, você será redirecionado ao seu site recém-publicado no Azure.</span><span class="sxs-lookup"><span data-stu-id="95f11-206">Once you've authenticated, you'll be redirected to your newly published website on Azure.</span></span>  
  
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image18.png)

<a id="dbg"></a>
## <a name="debugging-the-app"></a><span data-ttu-id="95f11-207">Depurar o aplicativo</span><span class="sxs-lookup"><span data-stu-id="95f11-207">Debugging the app</span></span>

<span data-ttu-id="95f11-208">Se você receber o seguinte erro:</span><span class="sxs-lookup"><span data-stu-id="95f11-208">If you get the following error:</span></span>   
 <span data-ttu-id="95f11-209">Valor não pode ser nulo ou vazio.</span><span class="sxs-lookup"><span data-stu-id="95f11-209">Value cannot be null or empty.</span></span> <span data-ttu-id="95f11-210">Nome do parâmetro: linkText</span><span class="sxs-lookup"><span data-stu-id="95f11-210">Parameter name: linkText</span></span>   
   
![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image19.png)  
  

<span data-ttu-id="95f11-211">Substitua o código no *exibições \ compartilhadas\\loginpartial. cshtml* arquivo com o seguinte:</span><span class="sxs-lookup"><span data-stu-id="95f11-211">Replace the code in the *Views\Shared\\_LoginPartial.cshtml* file with the following:</span></span>

[!code-cshtml[Main](developing-aspnet-apps-with-windows-azure-active-directory/samples/sample2.cshtml?highlight=1-8,15-16)]

<span data-ttu-id="95f11-212">Depois de executar o aplicativo, se o usuário conectado mostra "Usuário nulo", saia e entre novamente com a conta do Active Directory que você criou anteriormente.</span><span class="sxs-lookup"><span data-stu-id="95f11-212">After running the app, if the logged in user shows "Null User", sign out, and sign back in with the Active Directory account you created earlier.</span></span>

<span data-ttu-id="95f11-213">Um excelente tutorial a seguir é de Rick Rainey [mergulho profundo: sites do Azure e a autenticação organizacional usando o Azure AD](http://rickrainey.com/2014/08/19/deep-dive-azure-websites-and-organizational-authentication-using-azure-ad/).</span><span class="sxs-lookup"><span data-stu-id="95f11-213">An excellent tutorial to follow is Rick Rainey's [Deep Dive: Azure Websites and Organizational Authentication using Azure AD](http://rickrainey.com/2014/08/19/deep-dive-azure-websites-and-organizational-authentication-using-azure-ad/).</span></span>

## <a name="more-information"></a><span data-ttu-id="95f11-214">Mais informações</span><span class="sxs-lookup"><span data-stu-id="95f11-214">More Information</span></span>

- [<span data-ttu-id="95f11-215">Mergulho profundo: Sites do Azure e a autenticação organizacional usando o Azure AD</span><span class="sxs-lookup"><span data-stu-id="95f11-215">Deep Dive: Azure Websites and Organizational Authentication using Azure AD</span></span>](http://rickrainey.com/2014/08/19/deep-dive-azure-websites-and-organizational-authentication-using-azure-ad/)
- [<span data-ttu-id="95f11-216">Visão geral da API do Azure AD Graph</span><span class="sxs-lookup"><span data-stu-id="95f11-216">Azure AD Graph API Overview</span></span>](https://msdn.microsoft.com/library/azure/hh974476.aspx)
- [<span data-ttu-id="95f11-217">Cenários de autenticação no AD do Azure</span><span class="sxs-lookup"><span data-stu-id="95f11-217">Authentication Scenarios in Azure AD</span></span>](https://msdn.microsoft.com/library/azure/dn499820.aspx)
- [<span data-ttu-id="95f11-218">Exemplos de código do AD do Azure no GitHub</span><span class="sxs-lookup"><span data-stu-id="95f11-218">Azure AD Code Samples on GitHub</span></span>](https://github.com/AzureADSamples)
