---
uid: web-forms/overview/data-access/database-driven-site-maps/building-a-custom-database-driven-site-map-provider-cs
title: "Criação de um provedor de mapa de Site personalizado para banco de dados (c#) | Microsoft Docs"
author: rick-anderson
description: "O provedor de mapa de site padrão no ASP.NET 2.0 recupera seus dados de um arquivo XML estático. Enquanto o provedor com base em XML é adequado para muitos pequeno e médio Taman..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 06/26/2007
ms.topic: article
ms.assetid: 04b7591d-106f-4f05-87e9-d416cb65a8a6
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/database-driven-site-maps/building-a-custom-database-driven-site-map-provider-cs
msc.type: authoredcontent
ms.openlocfilehash: f09d8d24cea43e80e66b0d8ce50911fcb978c85e
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 11/10/2017
---
<a name="building-a-custom-database-driven-site-map-provider-c"></a><span data-ttu-id="3f9e2-104">Criação de um provedor de mapa de Site personalizado para banco de dados (c#)</span><span class="sxs-lookup"><span data-stu-id="3f9e2-104">Building a Custom Database-Driven Site Map Provider (C#)</span></span>
====================
<span data-ttu-id="3f9e2-105">por [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="3f9e2-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="3f9e2-106">[Baixar o código](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_62_CS.zip) ou [baixar PDF](building-a-custom-database-driven-site-map-provider-cs/_static/datatutorial62cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="3f9e2-106">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_62_CS.zip) or [Download PDF](building-a-custom-database-driven-site-map-provider-cs/_static/datatutorial62cs1.pdf)</span></span>

> <span data-ttu-id="3f9e2-107">O provedor de mapa de site padrão no ASP.NET 2.0 recupera seus dados de um arquivo XML estático.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-107">The default site map provider in ASP.NET 2.0 retrieves its data from a static XML file.</span></span> <span data-ttu-id="3f9e2-108">Enquanto o provedor de XML é adequado para vários sites da Web de pequenos e médio porte, aplicativos Web maiores exigem um mapa de site mais dinâmico.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-108">While the XML-based provider is suitable to many small and medium-sized Web sites, larger Web applications require a more dynamic site map.</span></span> <span data-ttu-id="3f9e2-109">Neste tutorial, criaremos um provedor de mapa de site personalizado que recupera os dados da camada de lógica de negócios, que por sua vez recupera dados do banco de dados.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-109">In this tutorial we'll build a custom site map provider that retrieves its data from the Business Logic Layer, which in turn retrieves data from the database.</span></span>


## <a name="introduction"></a><span data-ttu-id="3f9e2-110">Introdução</span><span class="sxs-lookup"><span data-stu-id="3f9e2-110">Introduction</span></span>

<span data-ttu-id="3f9e2-111">O ASP.NET 2.0 recurso de mapa de site de s permite que um desenvolvedor de página Definir um mapa do site da web aplicativo s em algum meio persistente, como em um arquivo XML.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-111">ASP.NET 2.0 s site map feature enables a page developer to define a web application s site map in some persistent medium, such as in an XML file.</span></span> <span data-ttu-id="3f9e2-112">Quando definido, os dados de mapa de site podem ser acessados por meio de programação com o [ `SiteMap` classe](https://msdn.microsoft.com/en-us/library/system.web.sitemap.aspx) no [ `System.Web` namespace](https://msdn.microsoft.com/en-us/library/system.web.aspx) ou por meio de uma variedade de navegação na Web controles, como o Controles SiteMapPath, Menu e TreeView.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-112">Once defined, the site map data can be accessed programmatically through the [`SiteMap` class](https://msdn.microsoft.com/en-us/library/system.web.sitemap.aspx) in the [`System.Web` namespace](https://msdn.microsoft.com/en-us/library/system.web.aspx) or through a variety of navigation Web controls, such as the SiteMapPath, Menu, and TreeView controls.</span></span> <span data-ttu-id="3f9e2-113">O sistema de mapa de site usa o [modelo de provedor](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx) para que podem ser criadas e conectadas a um aplicativo web implementações de serialização de mapa de site diferente.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-113">The site map system uses the [provider model](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx) so that different site map serialization implementations can be created and plugged into a web application.</span></span> <span data-ttu-id="3f9e2-114">O provedor de mapa de site padrão que é fornecido com o ASP.NET 2.0 mantém a estrutura de mapa de site em um arquivo XML.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-114">The default site map provider that ships with ASP.NET 2.0 persists site map structure in an XML file.</span></span> <span data-ttu-id="3f9e2-115">Volta o [páginas mestras e navegação de Site](../introduction/master-pages-and-site-navigation-cs.md) tutorial criamos um arquivo chamado `Web.sitemap` que contidos nessa estrutura e ter atualizando seu XML com cada nova seção tutorial.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-115">Back in the [Master Pages and Site Navigation](../introduction/master-pages-and-site-navigation-cs.md) tutorial we created a file named `Web.sitemap` that contained this structure and have been updating its XML with each new tutorial section.</span></span>

<span data-ttu-id="3f9e2-116">O provedor de mapa de site baseado em XML padrão funciona bem se a estrutura de s do mapa de site é relativamente estática, por exemplo, para esses tutoriais.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-116">The default XML-based site map provider works well if the site map s structure is fairly static, such as for these tutorials.</span></span> <span data-ttu-id="3f9e2-117">Em muitos cenários, no entanto, é necessário um mapa de site mais dinâmico.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-117">In many scenarios, however, a more dynamic site map is needed.</span></span> <span data-ttu-id="3f9e2-118">Considere o mapa do site mostrado na Figura 1, onde cada categoria e produto são exibidos como seções na estrutura do site.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-118">Consider the site map shown in Figure 1, where each category and product appear as sections in the website s structure.</span></span> <span data-ttu-id="3f9e2-119">Com esse mapa de site, visite a página da web correspondente para o nó raiz pode listar todas as categorias, enquanto visita uma página da web de determinada categoria s lista os produtos dessa categoria e exibir uma página da web de determinado produto s mostra que o produto detalhes s.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-119">With this site map, visiting the web page corresponding to the root node might list all of the categories, whereas visiting a particular category s web page would list that category s products and viewing a particular product s web page would show that product s details.</span></span>


<span data-ttu-id="3f9e2-120">[![As categorias e a composição de produtos a estrutura de mapa s do Site](building-a-custom-database-driven-site-map-provider-cs/_static/image1.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="3f9e2-120">[![The Categories and Products Makeup the Site Map s Structure](building-a-custom-database-driven-site-map-provider-cs/_static/image1.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image1.png)</span></span>

<span data-ttu-id="3f9e2-121">**Figura 1**: as categorias e o mapa do Site de s estrutura de composição de produtos ([clique para exibir a imagem em tamanho normal](building-a-custom-database-driven-site-map-provider-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="3f9e2-121">**Figure 1**: The Categories and Products Makeup the Site Map s Structure ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image2.png))</span></span>


<span data-ttu-id="3f9e2-122">Enquanto essa estrutura baseadas em produtos e categoria pode ser embutida no `Web.sitemap` arquivo, o arquivo precisa ser atualizada sempre que uma categoria ou produto foi adicionado, removido ou renomeado.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-122">While this category- and product-based structure could be hard-coded into the `Web.sitemap` file, the file would need to be updated each time a category or product was added, removed, or renamed.</span></span> <span data-ttu-id="3f9e2-123">Consequentemente, a manutenção de mapa de site seria bastante simplificada se sua estrutura foi recuperada do banco de dados ou, de preferência, da camada de lógica de negócios a s da arquitetura do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-123">Consequently, the site map maintenance would be greatly simplified if its structure was retrieved from the database or, ideally, from the Business Logic Layer of the application s architecture.</span></span> <span data-ttu-id="3f9e2-124">Dessa forma, como categorias e produtos foram adicionadas, renomeado ou excluído, o mapa de site atualizará automaticamente para refletir essas alterações.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-124">That way, as products and categories were added, renamed, or deleted, the site map would automatically update to reflect these changes.</span></span>

<span data-ttu-id="3f9e2-125">Como a serialização de mapa de site do ASP.NET 2.0 s é criada sobre o modelo de provedor, podemos criar nosso próprio provedor de mapa de site personalizado que obtém seus dados de um repositório de dados alternativos, como o banco de dados ou a arquitetura.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-125">Since ASP.NET 2.0 s site map serialization is built atop the provider model, we can create our own custom site map provider that grabs its data from an alternate data store, such as the database or architecture.</span></span> <span data-ttu-id="3f9e2-126">Neste tutorial, criaremos um provedor personalizado que recupera os dados do BLL.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-126">In this tutorial we'll build a custom provider that retrieves its data from the BLL.</span></span> <span data-ttu-id="3f9e2-127">Permitir que o s começar!</span><span class="sxs-lookup"><span data-stu-id="3f9e2-127">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="3f9e2-128">O provedor de mapa de site personalizado criado neste tutorial está acoplado para o modelo de dados e a arquitetura de s do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-128">The custom site map provider created in this tutorial is tightly coupled to the application s architecture and data model.</span></span> <span data-ttu-id="3f9e2-129">Jeff Prosise s [armazenar mapas de Site no SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) e [o provedor de mapa de Site do SQL que você estava esperando](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx) artigos examinar um método generalizado para armazenar dados de mapa de site no SQL Server.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-129">Jeff Prosise s [Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) and [The SQL Site Map Provider You ve Been Waiting For](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx) articles examine a generalized approach to storing site map data in SQL Server.</span></span>


## <a name="step-1-creating-the-custom-site-map-provider-web-pages"></a><span data-ttu-id="3f9e2-130">Etapa 1: Criar as páginas da Web de provedor de mapa de Site personalizado</span><span class="sxs-lookup"><span data-stu-id="3f9e2-130">Step 1: Creating the Custom Site Map Provider Web Pages</span></span>

<span data-ttu-id="3f9e2-131">Antes de começar a criação de um provedor de mapa de site personalizado, permitem s primeiro adicionar as páginas ASP.NET que vamos precisar para este tutorial.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-131">Before we start creating a custom site map provider, let s first add the ASP.NET pages we'll need for this tutorial.</span></span> <span data-ttu-id="3f9e2-132">Comece adicionando uma nova pasta chamada `SiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-132">Start by adding a new folder named `SiteMapProvider`.</span></span> <span data-ttu-id="3f9e2-133">Em seguida, adicione as seguintes páginas do ASP.NET para a pasta, certificando-se de associar cada página com o `Site.master` página mestre:</span><span class="sxs-lookup"><span data-stu-id="3f9e2-133">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `ProductsByCategory.aspx`
- `ProductDetails.aspx`

<span data-ttu-id="3f9e2-134">Também adicionar uma `CustomProviders` subpasta para o `App_Code` pasta.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-134">Also add a `CustomProviders` subfolder to the `App_Code` folder.</span></span>


![Adicionar as páginas ASP.NET para os tutoriais de relacionadas ao provedor de mapa de Site](building-a-custom-database-driven-site-map-provider-cs/_static/image2.gif)

<span data-ttu-id="3f9e2-136">**Figura 2**: adicionar as páginas ASP.NET para o Site relacionadas ao provedor tutoriais do mapa</span><span class="sxs-lookup"><span data-stu-id="3f9e2-136">**Figure 2**: Add the ASP.NET Pages for the Site Map Provider-Related Tutorials</span></span>


<span data-ttu-id="3f9e2-137">Como há apenas um tutorial para essa seção, podemos don precisa `Default.aspx` para listar os tutoriais de seção s.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-137">Since there is only one tutorial for this section, we don t need `Default.aspx` to list the section s tutorials.</span></span> <span data-ttu-id="3f9e2-138">Em vez disso, `Default.aspx` exibirá as categorias em um controle GridView.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-138">Instead, `Default.aspx` will display the categories in a GridView control.</span></span> <span data-ttu-id="3f9e2-139">Que abordaremos isso na etapa 2.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-139">We'll tackle this in Step 2.</span></span>

<span data-ttu-id="3f9e2-140">Em seguida, atualize `Web.sitemap` para incluir uma referência para o `Default.aspx` página.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-140">Next, update `Web.sitemap` to include a reference to the `Default.aspx` page.</span></span> <span data-ttu-id="3f9e2-141">Especificamente, adicione a seguinte marcação após o cache `<siteMapNode>`:</span><span class="sxs-lookup"><span data-stu-id="3f9e2-141">Specifically, add the following markup after the Caching `<siteMapNode>`:</span></span>


[!code-xml[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample1.xml)]

<span data-ttu-id="3f9e2-142">Após a atualização `Web.sitemap`, reserve um tempo para exibir o site de tutoriais através de um navegador.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-142">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="3f9e2-143">No menu à esquerda agora inclui um item para o tutorial do provedor de mapa de site único.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-143">The menu on the left now includes an item for the sole site map provider tutorial.</span></span>


![O mapa do Site agora inclui uma entrada para o Tutorial de provedor de mapa de Site](building-a-custom-database-driven-site-map-provider-cs/_static/image3.gif)

<span data-ttu-id="3f9e2-145">**Figura 3**: O mapa de Site agora inclui uma entrada para o Tutorial de provedor de mapa de Site</span><span class="sxs-lookup"><span data-stu-id="3f9e2-145">**Figure 3**: The Site Map Now Includes an Entry for the Site Map Provider Tutorial</span></span>


<span data-ttu-id="3f9e2-146">Este tutorial principal foco é ilustrar criando um provedor de mapa de site personalizado e configurar o aplicativo web para usar esse provedor.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-146">This tutorial s main focus is to illustrate creating a custom site map provider and configuring a web application to use that provider.</span></span> <span data-ttu-id="3f9e2-147">Em particular, criaremos um provedor que retorna um mapa de site que inclui um nó raiz com um nó para cada categoria e produto, conforme mostrado na Figura 1.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-147">In particular, we'll build a provider that returns a site map that includes a root node along with a node for each category and product, as depicted in Figure 1.</span></span> <span data-ttu-id="3f9e2-148">Em geral, cada nó no mapa do site pode especificar uma URL.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-148">In general, each node in the site map may specify a URL.</span></span> <span data-ttu-id="3f9e2-149">Para o mapa de site, a URL raiz do nó s será `~/SiteMapProvider/Default.aspx`, que lista todas as categorias no banco de dados.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-149">For our site map, the root node s URL will be `~/SiteMapProvider/Default.aspx`, which will list all of the categories in the database.</span></span> <span data-ttu-id="3f9e2-150">Cada nó de categoria no mapa do site terá uma URL que aponta para `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID`, que listará todos os produtos do *categoryID*.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-150">Each category node in the site map will have a URL that points to `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID`, which will list all of the products in the specified *categoryID*.</span></span> <span data-ttu-id="3f9e2-151">Por fim, cada nó de mapa de site do produto apontará para `~/SiteMapProvider/ProductDetails.aspx?ProductID=productID`, que exibirá os detalhes de produto específico s.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-151">Finally, each product site map node will point to `~/SiteMapProvider/ProductDetails.aspx?ProductID=productID`, which will display the specific product s details.</span></span>

<span data-ttu-id="3f9e2-152">Para iniciar, precisamos criar o `Default.aspx`, `ProductsByCategory.aspx`, e `ProductDetails.aspx` páginas.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-152">To start we need to create the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages.</span></span> <span data-ttu-id="3f9e2-153">Essas páginas são concluídas nas etapas 2, 3 e 4, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-153">These pages are completed in Steps 2, 3, and 4, respectively.</span></span> <span data-ttu-id="3f9e2-154">Como o foco deste tutorial é os provedores de mapa de site, e como últimos tutoriais sobre como criar esses tipos de várias páginas mestre/detalhes relatórios, que será corra por meio das etapas 2 a 4.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-154">Since the thrust of this tutorial is on site map providers, and since past tutorials have covered creating these sorts of multi-page master/detail reports, we will hurry through Steps 2 through 4.</span></span> <span data-ttu-id="3f9e2-155">Se você precisar de um atualizador sobre como criar relatórios de detalhes/mestre que abrangem várias páginas, consulte novamente o [filtragem de mestre/detalhes em duas páginas](../masterdetail/master-detail-filtering-across-two-pages-cs.md) tutorial.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-155">If you need a refresher on creating master/detail reports that span multiple pages, refer back to the [Master/Detail Filtering Across Two Pages](../masterdetail/master-detail-filtering-across-two-pages-cs.md) tutorial.</span></span>

## <a name="step-2-displaying-a-list-of-categories"></a><span data-ttu-id="3f9e2-156">Etapa 2: Exibindo uma lista de categorias</span><span class="sxs-lookup"><span data-stu-id="3f9e2-156">Step 2: Displaying a List of Categories</span></span>

<span data-ttu-id="3f9e2-157">Abra o `Default.aspx` página o `SiteMapProvider` pasta e arraste um controle GridView da caixa de ferramentas para o Designer, definindo seu `ID` para `Categories`.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-157">Open the `Default.aspx` page in the `SiteMapProvider` folder and drag a GridView from the Toolbox onto the Designer, setting its `ID` to `Categories`.</span></span> <span data-ttu-id="3f9e2-158">De GridView s marca inteligente, associá-lo a um novo ObjectDataSource denominado `CategoriesDataSource` e configurá-lo para que ele recupere seus dados usando o `CategoriesBLL` classe s `GetCategories` método.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-158">From the GridView s smart tag, bind it to a new ObjectDataSource named `CategoriesDataSource` and configure it so that it retrieves its data using the `CategoriesBLL` class s `GetCategories` method.</span></span> <span data-ttu-id="3f9e2-159">Como esse GridView apenas exibe as categorias e não fornece capacidades de modificação de dados, definir as listas suspensas na atualização, inserção e excluir guias como (nenhum).</span><span class="sxs-lookup"><span data-stu-id="3f9e2-159">Since this GridView just displays the categories and does not provide data modification capabilities, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>


<span data-ttu-id="3f9e2-160">[![Configurar o ObjectDataSource para retornar as categorias usando o método GetCategories](building-a-custom-database-driven-site-map-provider-cs/_static/image4.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="3f9e2-160">[![Configure the ObjectDataSource to Return Categories Using the GetCategories Method](building-a-custom-database-driven-site-map-provider-cs/_static/image4.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image3.png)</span></span>

<span data-ttu-id="3f9e2-161">**Figura 4**: configurar o ObjectDataSource para retornar categorias usando o `GetCategories` método ([clique para exibir a imagem em tamanho normal](building-a-custom-database-driven-site-map-provider-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="3f9e2-161">**Figure 4**: Configure the ObjectDataSource to Return Categories Using the `GetCategories` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image4.png))</span></span>


<span data-ttu-id="3f9e2-162">[![Definir as listas suspensas na atualização, inserção e excluir guias como (nenhum)](building-a-custom-database-driven-site-map-provider-cs/_static/image5.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="3f9e2-162">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](building-a-custom-database-driven-site-map-provider-cs/_static/image5.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image5.png)</span></span>

<span data-ttu-id="3f9e2-163">**Figura 5**: definir a lista suspensa na atualização, inserir e excluir guias como (nenhum) ([clique para exibir a imagem em tamanho normal](building-a-custom-database-driven-site-map-provider-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="3f9e2-163">**Figure 5**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image6.png))</span></span>


<span data-ttu-id="3f9e2-164">Depois de concluir o Assistente Configurar fonte de dados, o Visual Studio irá adicionar um BoundField para `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, e `BrochurePath`.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-164">After completing the Configure Data Source wizard, Visual Studio will add a BoundField for `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, and `BrochurePath`.</span></span> <span data-ttu-id="3f9e2-165">Editar o GridView para que ele contém apenas o `CategoryName` e `Description` BoundFields e atualizar o `CategoryName` BoundField s `HeaderText` propriedade à categoria.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-165">Edit the GridView so that it only contains the `CategoryName` and `Description` BoundFields and update the `CategoryName` BoundField s `HeaderText` property to Category .</span></span>

<span data-ttu-id="3f9e2-166">Em seguida, adicione um HyperLinkField e posicione-o assim que o campo mais à esquerda.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-166">Next, add a HyperLinkField and position it so that it s the left-most field.</span></span> <span data-ttu-id="3f9e2-167">Definir o `DataNavigateUrlFields` propriedade `CategoryID` e o `DataNavigateUrlFormatString` propriedade `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID={0}`.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-167">Set the `DataNavigateUrlFields` property to `CategoryID` and the `DataNavigateUrlFormatString` property to `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID={0}`.</span></span> <span data-ttu-id="3f9e2-168">Definir o `Text` propriedade para exibir os produtos.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-168">Set the `Text` property to View Products .</span></span>


![Adicionar um HyperLinkField a GridView categorias](building-a-custom-database-driven-site-map-provider-cs/_static/image6.gif)

<span data-ttu-id="3f9e2-170">**Figura 6**: adicionar um HyperLinkField para o `Categories` GridView</span><span class="sxs-lookup"><span data-stu-id="3f9e2-170">**Figure 6**: Add a HyperLinkField to the `Categories` GridView</span></span>


<span data-ttu-id="3f9e2-171">Depois de criar o ObjectDataSource e personalizar os campos de s GridView, a marcação declarativa dois controles será a seguinte aparência:</span><span class="sxs-lookup"><span data-stu-id="3f9e2-171">After creating the ObjectDataSource and customizing the GridView s fields, the two controls declarative markup will look like the following:</span></span>


[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample2.aspx)]

<span data-ttu-id="3f9e2-172">A Figura 7 mostra `Default.aspx` quando visualizada através de um navegador.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-172">Figure 7 shows `Default.aspx` when viewed through a browser.</span></span> <span data-ttu-id="3f9e2-173">Clique em uma categoria s exibir produtos link leva você à `ProductsByCategory.aspx?CategoryID=categoryID`, que vamos criar na etapa 3.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-173">Clicking a category s View Products link takes you to `ProductsByCategory.aspx?CategoryID=categoryID`, which we will build in Step 3.</span></span>


<span data-ttu-id="3f9e2-174">[![Cada categoria é listado junto com um Link de produtos do modo de exibição](building-a-custom-database-driven-site-map-provider-cs/_static/image7.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="3f9e2-174">[![Each Category is Listed Along with a View Products Link](building-a-custom-database-driven-site-map-provider-cs/_static/image7.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image7.png)</span></span>

<span data-ttu-id="3f9e2-175">**Figura 7**: cada categoria é listado junto com um Link de produtos do modo de exibição ([clique para exibir a imagem em tamanho normal](building-a-custom-database-driven-site-map-provider-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="3f9e2-175">**Figure 7**: Each Category is Listed Along with a View Products Link ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image8.png))</span></span>


## <a name="step-3-listing-the-selected-category-s-products"></a><span data-ttu-id="3f9e2-176">Etapa 3: Lista os produtos a categoria selecionada</span><span class="sxs-lookup"><span data-stu-id="3f9e2-176">Step 3: Listing the Selected Category s Products</span></span>

<span data-ttu-id="3f9e2-177">Abra o `ProductsByCategory.aspx` página e adicione um GridView, nomeando- `ProductsByCategory`.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-177">Open the `ProductsByCategory.aspx` page and add a GridView, naming it `ProductsByCategory`.</span></span> <span data-ttu-id="3f9e2-178">Na marca inteligente, de associar o GridView para um novo ObjectDataSource denominado `ProductsByCategoryDataSource`.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-178">From its smart tag, bind the GridView to a new ObjectDataSource named `ProductsByCategoryDataSource`.</span></span> <span data-ttu-id="3f9e2-179">Configurar o ObjectDataSource para usar o `ProductsBLL` classe s `GetProductsByCategoryID(categoryID)` método e o conjunto de listas suspensas como (nenhum) nas guias UPDATE, INSERT e DELETE.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-179">Configure the ObjectDataSource to use the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method and set the drop-down lists to (None) in the UPDATE, INSERT, and DELETE tabs.</span></span>


<span data-ttu-id="3f9e2-180">[![Use o método de GetProductsByCategoryID(categoryID) ProductsBLL classe s](building-a-custom-database-driven-site-map-provider-cs/_static/image8.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="3f9e2-180">[![Use the ProductsBLL Class s GetProductsByCategoryID(categoryID) Method](building-a-custom-database-driven-site-map-provider-cs/_static/image8.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image9.png)</span></span>

<span data-ttu-id="3f9e2-181">**Figura 8**: Use o `ProductsBLL` classe s `GetProductsByCategoryID(categoryID)` método ([clique para exibir a imagem em tamanho normal](building-a-custom-database-driven-site-map-provider-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="3f9e2-181">**Figure 8**: Use the `ProductsBLL` Class s `GetProductsByCategoryID(categoryID)` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image10.png))</span></span>


<span data-ttu-id="3f9e2-182">Solicita que a etapa final no Assistente para configurar a fonte de dados para uma fonte de parâmetro para *categoryID*.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-182">The final step in the Configure Data Source wizard prompts for a parameter source for *categoryID*.</span></span> <span data-ttu-id="3f9e2-183">Como essas informações são passadas por meio do campo querystring `CategoryID`, selecione QueryString na lista suspensa e digite CategoryID na caixa de texto QueryStringField, conforme mostrado na Figura 9.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-183">Since this information is passed through the querystring field `CategoryID`, select QueryString from the drop-down list and enter CategoryID in the QueryStringField textbox as shown in Figure 9.</span></span> <span data-ttu-id="3f9e2-184">Clique em Concluir para concluir o assistente.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-184">Click Finish to complete the wizard.</span></span>


<span data-ttu-id="3f9e2-185">[![Use o campo de Querystring CategoryID para o parâmetro categoryID](building-a-custom-database-driven-site-map-provider-cs/_static/image9.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="3f9e2-185">[![Use the CategoryID Querystring Field for the categoryID Parameter](building-a-custom-database-driven-site-map-provider-cs/_static/image9.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image11.png)</span></span>

<span data-ttu-id="3f9e2-186">**Figura 9**: Use o `CategoryID` Querystring Field para o *categoryID* parâmetro ([clique para exibir a imagem em tamanho normal](building-a-custom-database-driven-site-map-provider-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="3f9e2-186">**Figure 9**: Use the `CategoryID` Querystring Field for the *categoryID* Parameter ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image12.png))</span></span>


<span data-ttu-id="3f9e2-187">Depois de concluir o assistente, o Visual Studio adicionará BoundFields correspondente e um CheckBoxField GridView para os campos de dados de produto.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-187">After completing the wizard, Visual Studio will add corresponding BoundFields and a CheckBoxField to the GridView for the product data fields.</span></span> <span data-ttu-id="3f9e2-188">Remover tudo, exceto o `ProductName`, `UnitPrice`, e `SupplierName` BoundFields.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-188">Remove all but the `ProductName`, `UnitPrice`, and `SupplierName` BoundFields.</span></span> <span data-ttu-id="3f9e2-189">Personalizar esses três BoundFields `HeaderText` propriedades para ler o produto, preço e fornecedor, respectivamente.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-189">Customize these three BoundFields `HeaderText` properties to read Product, Price, and Supplier, respectively.</span></span> <span data-ttu-id="3f9e2-190">Formato de `UnitPrice` BoundField como uma moeda.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-190">Format the `UnitPrice` BoundField as a currency.</span></span>

<span data-ttu-id="3f9e2-191">Em seguida, adicione um HyperLinkField e mova-o para a posição mais à esquerda.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-191">Next, add a HyperLinkField and move it to the left-most position.</span></span> <span data-ttu-id="3f9e2-192">Definir seu `Text` propriedade para exibir detalhes, seu `DataNavigateUrlFields` propriedade `ProductID`e sua `DataNavigateUrlFormatString` propriedade para `~/SiteMapProvider/ProductDetails.aspx?ProductID={0}`.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-192">Set its `Text` property to View Details, its `DataNavigateUrlFields` property to `ProductID`, and its `DataNavigateUrlFormatString` property to `~/SiteMapProvider/ProductDetails.aspx?ProductID={0}`.</span></span>


![Adicionar um HyperLinkField de detalhes de exibição que aponta para ProductDetails.aspx](building-a-custom-database-driven-site-map-provider-cs/_static/image10.gif)

<span data-ttu-id="3f9e2-194">**Figura 10**: adicionar um modo de exibição de detalhes HyperLinkField que aponta para`ProductDetails.aspx`</span><span class="sxs-lookup"><span data-stu-id="3f9e2-194">**Figure 10**: Add a View Details HyperLinkField that Points to `ProductDetails.aspx`</span></span>


<span data-ttu-id="3f9e2-195">Depois de fazer essas personalizações, o GridView e ObjectDataSource s declarativo deve se parecer com o seguinte:</span><span class="sxs-lookup"><span data-stu-id="3f9e2-195">After making these customizations, the GridView and ObjectDataSource s declarative markup should resemble the following:</span></span>


[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample3.aspx)]

<span data-ttu-id="3f9e2-196">Retornar à exibição `Default.aspx` por meio de um navegador e clique em Exibir produtos de link para bebidas.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-196">Return to viewing `Default.aspx` through a browser and click on the View Products link for Beverages.</span></span> <span data-ttu-id="3f9e2-197">Isso o levará para `ProductsByCategory.aspx?CategoryID=1`, exibindo os nomes, os preços e os fornecedores dos produtos no banco de dados Northwind que pertencem à categoria de bebidas (consulte a Figura 11).</span><span class="sxs-lookup"><span data-stu-id="3f9e2-197">This will take you to `ProductsByCategory.aspx?CategoryID=1`, displaying the names, prices, and suppliers of the products in the Northwind database that belong to the Beverages category (see Figure 11).</span></span> <span data-ttu-id="3f9e2-198">Fique à vontade para aumentar ainda mais a esta página para incluir um link para retornar os usuários para a página de listagem de categoria (`Default.aspx`) e um controle DetailsView ou FormView que exibe o nome da categoria selecionada s e a descrição.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-198">Feel free to further enhance this page to include a link to return users to the category listing page (`Default.aspx`) and a DetailsView or FormView control that displays the selected category s name and description.</span></span>


<span data-ttu-id="3f9e2-199">[![Os nomes de bebidas, preços e fornecedores são exibidos](building-a-custom-database-driven-site-map-provider-cs/_static/image11.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="3f9e2-199">[![The Beverages Names, Prices, and Suppliers are Displayed](building-a-custom-database-driven-site-map-provider-cs/_static/image11.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image13.png)</span></span>

<span data-ttu-id="3f9e2-200">**Figura 11**: os nomes de bebidas, preços e fornecedores são exibidos ([clique para exibir a imagem em tamanho normal](building-a-custom-database-driven-site-map-provider-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="3f9e2-200">**Figure 11**: The Beverages Names, Prices, and Suppliers are Displayed ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image14.png))</span></span>


## <a name="step-4-showing-a-product-s-details"></a><span data-ttu-id="3f9e2-201">Etapa 4: Mostrando uma s os detalhes do produto</span><span class="sxs-lookup"><span data-stu-id="3f9e2-201">Step 4: Showing a Product s Details</span></span>

<span data-ttu-id="3f9e2-202">A página final, `ProductDetails.aspx`, exibe os detalhes de produtos selecionados.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-202">The final page, `ProductDetails.aspx`, displays the selected products details.</span></span> <span data-ttu-id="3f9e2-203">Abra `ProductDetails.aspx` e arraste um DetailsView da caixa de ferramentas para o Designer.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-203">Open `ProductDetails.aspx` and drag a DetailsView from the Toolbox onto the Designer.</span></span> <span data-ttu-id="3f9e2-204">Definir o s DetailsView `ID` propriedade `ProductInfo` e limpar seu `Height` e `Width` valores de propriedade.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-204">Set the DetailsView s `ID` property to `ProductInfo` and clear out its `Height` and `Width` property values.</span></span> <span data-ttu-id="3f9e2-205">De marca inteligente, associar DetailsView para um novo ObjectDataSource denominado `ProductDataSource`, configurando ObjectDataSource para efetuar o pull de seus dados a partir de `ProductsBLL` classe s `GetProductByProductID(productID)` método.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-205">From its smart tag, bind the DetailsView to a new ObjectDataSource named `ProductDataSource`, configuring the ObjectDataSource to pull its data from the `ProductsBLL` class s `GetProductByProductID(productID)` method.</span></span> <span data-ttu-id="3f9e2-206">Assim como acontece com as páginas da web anterior criado nas etapas 2 e 3, defina as listas suspensas na atualização, inserção e excluir guias como (nenhum).</span><span class="sxs-lookup"><span data-stu-id="3f9e2-206">As with the previous web pages created in Steps 2 and 3, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>


<span data-ttu-id="3f9e2-207">[![Configurar o ObjectDataSource para usar o método GetProductByProductID(productID)](building-a-custom-database-driven-site-map-provider-cs/_static/image12.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="3f9e2-207">[![Configure the ObjectDataSource to Use the GetProductByProductID(productID) Method](building-a-custom-database-driven-site-map-provider-cs/_static/image12.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image15.png)</span></span>

<span data-ttu-id="3f9e2-208">**Figura 12**: configurar o ObjectDataSource para usar o `GetProductByProductID(productID)` método ([clique para exibir a imagem em tamanho normal](building-a-custom-database-driven-site-map-provider-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="3f9e2-208">**Figure 12**: Configure the ObjectDataSource to Use the `GetProductByProductID(productID)` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image16.png))</span></span>


<span data-ttu-id="3f9e2-209">Solicita que a última etapa do Assistente para configurar a fonte de dados da fonte de *productID* parâmetro.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-209">The last step of the Configure Data Source wizard prompts for the source of the *productID* parameter.</span></span> <span data-ttu-id="3f9e2-210">Como esses dados vem por meio do campo querystring `ProductID`, defina a lista suspensa QueryString e textbox QueryStringField ProductID.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-210">Since this data comes through the querystring field `ProductID`, set the drop-down list to QueryString and the QueryStringField textbox to ProductID.</span></span> <span data-ttu-id="3f9e2-211">Por fim, clique no botão Concluir para concluir o assistente.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-211">Finally, click the Finish button to complete the wizard.</span></span>


<span data-ttu-id="3f9e2-212">[![Configurar o parâmetro para extrair o valor do campo de Querystring ProductID productID](building-a-custom-database-driven-site-map-provider-cs/_static/image13.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="3f9e2-212">[![Configure the productID Parameter to Pull its Value from the ProductID Querystring Field](building-a-custom-database-driven-site-map-provider-cs/_static/image13.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image17.png)</span></span>

<span data-ttu-id="3f9e2-213">**Figura 13**: configurar o *productID* parâmetro para extrair o valor da `ProductID` Querystring Field ([clique para exibir a imagem em tamanho normal](building-a-custom-database-driven-site-map-provider-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="3f9e2-213">**Figure 13**: Configure the *productID* Parameter to Pull its Value from the `ProductID` Querystring Field ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image18.png))</span></span>


<span data-ttu-id="3f9e2-214">Depois de concluir o Assistente Configurar fonte de dados, o Visual Studio criará BoundFields correspondente e um CheckBoxField em DetailsView para os campos de dados de produto.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-214">After completing the Configure Data Source wizard, Visual Studio will create corresponding BoundFields and a CheckBoxField in the DetailsView for the product data fields.</span></span> <span data-ttu-id="3f9e2-215">Remover o `ProductID`, `SupplierID`, e `CategoryID` BoundFields e configurar os campos restantes como desejar.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-215">Remove the `ProductID`, `SupplierID`, and `CategoryID` BoundFields and configure the remaining fields as you see fit.</span></span> <span data-ttu-id="3f9e2-216">Depois de uma série de configurações estéticos, meu DetailsView e ObjectDataSource s declarativo pesquisados semelhante ao seguinte:</span><span class="sxs-lookup"><span data-stu-id="3f9e2-216">After a handful of aesthetic configurations, my DetailsView and ObjectDataSource s declarative markup looked like the following:</span></span>


[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample4.aspx)]

<span data-ttu-id="3f9e2-217">Para testar essa página, retorne ao `Default.aspx` e clique em Exibir produtos para a categoria de bebidas.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-217">To test this page, return to `Default.aspx` and click on View Products for the Beverages category.</span></span> <span data-ttu-id="3f9e2-218">Na lista de produtos de bebidas, clique no link Exibir detalhes para Chai chá.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-218">From the listing of beverage products, click on the View Details link for Chai Tea.</span></span> <span data-ttu-id="3f9e2-219">Isso o levará para `ProductDetails.aspx?ProductID=1`, que mostra um s Chai chá detalhes (consulte a Figura 14).</span><span class="sxs-lookup"><span data-stu-id="3f9e2-219">This will take you to `ProductDetails.aspx?ProductID=1`, which shows a Chai Tea s details (see Figure 14).</span></span>


<span data-ttu-id="3f9e2-220">[![Chai chá s fornecedor, categoria, preço e outras informações é exibido](building-a-custom-database-driven-site-map-provider-cs/_static/image14.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="3f9e2-220">[![Chai Tea s Supplier, Category, Price, and Other Information is Displayed](building-a-custom-database-driven-site-map-provider-cs/_static/image14.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image19.png)</span></span>

<span data-ttu-id="3f9e2-221">**Figura 14**: Chai chá s fornecedor, categoria, preço e outras informações é exibido ([clique para exibir a imagem em tamanho normal](building-a-custom-database-driven-site-map-provider-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="3f9e2-221">**Figure 14**: Chai Tea s Supplier, Category, Price, and Other Information is Displayed ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image20.png))</span></span>


## <a name="step-5-understanding-the-inner-workings-of-a-site-map-provider"></a><span data-ttu-id="3f9e2-222">Etapa 5: Noções básicas sobre o funcionamento interno de um provedor de mapa de Site</span><span class="sxs-lookup"><span data-stu-id="3f9e2-222">Step 5: Understanding the Inner Workings of a Site Map Provider</span></span>

<span data-ttu-id="3f9e2-223">O mapa do site é representado na memória de servidor s web como uma coleção de `SiteMapNode` instâncias que formam uma hierarquia.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-223">The site map is represented in the web server s memory as a collection of `SiteMapNode` instances that form a hierarchy.</span></span> <span data-ttu-id="3f9e2-224">Deve haver exatamente uma raiz, todos os nós raiz não devem ter exatamente um nó pai e todos os nós podem ter um número arbitrário de filhos.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-224">There must be exactly one root, all non-root nodes must have exactly one parent node, and all nodes may have an arbitrary number of children.</span></span> <span data-ttu-id="3f9e2-225">Cada `SiteMapNode` objeto representa uma seção na estrutura de site s; essas seções normalmente têm uma página da web correspondente.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-225">Each `SiteMapNode` object represents a section in the website s structure; these sections commonly have a corresponding web page.</span></span> <span data-ttu-id="3f9e2-226">Consequentemente, o [ `SiteMapNode` classe](https://msdn.microsoft.com/en-us/library/system.web.sitemapnode.aspx) tem propriedades como `Title`, `Url`, e `Description`, que fornecem informações para a seção de `SiteMapNode` representa.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-226">Consequently, the [`SiteMapNode` class](https://msdn.microsoft.com/en-us/library/system.web.sitemapnode.aspx) has properties like `Title`, `Url`, and `Description`, which provide information for the section the `SiteMapNode` represents.</span></span> <span data-ttu-id="3f9e2-227">Também há um `Key` propriedade que identifica exclusivamente cada `SiteMapNode` na hierarquia, bem como as propriedades usadas para estabelecer essa hierarquia `ChildNodes`, `ParentNode`, `NextSibling`, `PreviousSibling`e assim por diante.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-227">There is also a `Key` property that uniquely identifies each `SiteMapNode` in the hierarchy, as well as properties used to establish this hierarchy `ChildNodes`, `ParentNode`, `NextSibling`, `PreviousSibling`, and so forth.</span></span>

<span data-ttu-id="3f9e2-228">Figura 15 mostra a estrutura de mapa de site geral da Figura 1, mas com os detalhes de implementação elaborados em mais detalhes.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-228">Figure 15 shows the general site map structure from Figure 1, but with the implementation details sketched out in finer detail.</span></span>


<span data-ttu-id="3f9e2-229">[![Cada SiteMapNode tem propriedades como título, Url, chave e assim por diante](building-a-custom-database-driven-site-map-provider-cs/_static/image16.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image15.gif)</span><span class="sxs-lookup"><span data-stu-id="3f9e2-229">[![Each SiteMapNode has Properties Like Title, Url, Key, and So On](building-a-custom-database-driven-site-map-provider-cs/_static/image16.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image15.gif)</span></span>

<span data-ttu-id="3f9e2-230">**Figura 15**: cada `SiteMapNode` tem propriedades como `Title`, `Url`, `Key`, e assim por diante ([clique para exibir a imagem em tamanho normal](building-a-custom-database-driven-site-map-provider-cs/_static/image17.gif))</span><span class="sxs-lookup"><span data-stu-id="3f9e2-230">**Figure 15**: Each `SiteMapNode` has Properties Like `Title`, `Url`, `Key`, and So On ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image17.gif))</span></span>


<span data-ttu-id="3f9e2-231">O mapa do site é acessível por meio de [ `SiteMap` classe](https://msdn.microsoft.com/en-us/library/system.web.sitemap.aspx) no [ `System.Web` namespace](https://msdn.microsoft.com/en-us/library/system.web.aspx).</span><span class="sxs-lookup"><span data-stu-id="3f9e2-231">The site map is accessible through the [`SiteMap` class](https://msdn.microsoft.com/en-us/library/system.web.sitemap.aspx) in the [`System.Web` namespace](https://msdn.microsoft.com/en-us/library/system.web.aspx).</span></span> <span data-ttu-id="3f9e2-232">Essa classe s `RootNode` propriedade retorna a raiz do mapa s site `SiteMapNode` instância; `CurrentNode` retorna o `SiteMapNode` cujo `Url` propriedade corresponde à URL da página solicitada no momento.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-232">This class s `RootNode` property returns the site map s root `SiteMapNode` instance; `CurrentNode` returns the `SiteMapNode` whose `Url` property matches the URL of the currently requested page.</span></span> <span data-ttu-id="3f9e2-233">Essa classe é usada internamente por controles da Web do ASP.NET 2.0 s navegação.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-233">This class is used internally by ASP.NET 2.0 s navigation Web controls.</span></span>

<span data-ttu-id="3f9e2-234">Quando o `SiteMap` propriedades de classe s são acessadas, ele deve serializar a estrutura do mapa do site de alguma mídia persistente na memória.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-234">When the `SiteMap` class s properties are accessed, it must serialize the site map structure from some persistent medium into memory.</span></span> <span data-ttu-id="3f9e2-235">No entanto, a lógica de serialização de mapa de site não é difícil codificado no `SiteMap` classe.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-235">However, the site map serialization logic is not hard coded into the `SiteMap` class.</span></span> <span data-ttu-id="3f9e2-236">Em vez disso, em tempo de execução de `SiteMap` classe determina qual mapa de site *provedor* a ser usado para serialização.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-236">Instead, at runtime the `SiteMap` class determines which site map *provider* to use for serialization.</span></span> <span data-ttu-id="3f9e2-237">Por padrão, o [ `XmlSiteMapProvider` classe](https://msdn.microsoft.com/en-us/library/system.web.xmlsitemapprovider.aspx) for usado, que lê a estrutura de mapa s do site de um arquivo XML formatado corretamente.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-237">By default, the [`XmlSiteMapProvider` class](https://msdn.microsoft.com/en-us/library/system.web.xmlsitemapprovider.aspx) is used, which reads the site map s structure from a properly-formatted XML file.</span></span> <span data-ttu-id="3f9e2-238">No entanto, com um pouco de trabalho podemos criar nosso próprio provedor de mapa de site personalizado.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-238">However, with a little bit of work we can create our own custom site map provider.</span></span>

<span data-ttu-id="3f9e2-239">Todos os provedores de mapa de site devem ser derivados de [ `SiteMapProvider` classe](https://msdn.microsoft.com/en-us/library/system.web.sitemapprovider.aspx), que inclui os métodos essenciais e propriedades necessárias para o site mapear provedores, mas omite muitos dos detalhes de implementação.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-239">All site map providers must be derived from the [`SiteMapProvider` class](https://msdn.microsoft.com/en-us/library/system.web.sitemapprovider.aspx), which includes the essential methods and properties needed for site map providers, but omits many of the implementation details.</span></span> <span data-ttu-id="3f9e2-240">A segunda classe [ `StaticSiteMapProvider` ](https://msdn.microsoft.com/en-us/library/system.web.staticsitemapprovider.aspx), estende o `SiteMapProvider` classe e contém uma implementação mais robusta do que a funcionalidade necessária.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-240">A second class, [`StaticSiteMapProvider`](https://msdn.microsoft.com/en-us/library/system.web.staticsitemapprovider.aspx), extends the `SiteMapProvider` class and contains a more robust implementation of the needed functionality.</span></span> <span data-ttu-id="3f9e2-241">Internamente, o `StaticSiteMapProvider` armazena o `SiteMapNode` instâncias do site do mapa em uma `Hashtable` e fornece métodos como `AddNode(child, parent)`, `RemoveNode(siteMapNode),` e `Clear()` que adicionar e remover `SiteMapNode` s para interno `Hashtable`.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-241">Internally, the `StaticSiteMapProvider` stores the `SiteMapNode` instances of the site map in a `Hashtable` and provides methods like `AddNode(child, parent)`, `RemoveNode(siteMapNode),` and `Clear()` that add and remove `SiteMapNode` s to the internal `Hashtable`.</span></span> <span data-ttu-id="3f9e2-242">`XmlSiteMapProvider`é derivado de `StaticSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-242">`XmlSiteMapProvider` is derived from `StaticSiteMapProvider`.</span></span>

<span data-ttu-id="3f9e2-243">Quando criar um provedor de mapa de site personalizado que estende `StaticSiteMapProvider`, há dois métodos abstratos que devem ser substituídos: [ `BuildSiteMap` ](https://msdn.microsoft.com/en-us/library/system.web.staticsitemapprovider.buildsitemap.aspx) e [ `GetRootNodeCore` ](https://msdn.microsoft.com/en-us/library/system.web.sitemapprovider.getrootnodecore.aspx).</span><span class="sxs-lookup"><span data-stu-id="3f9e2-243">When creating a custom site map provider that extends `StaticSiteMapProvider`, there are two abstract methods that must be overridden: [`BuildSiteMap`](https://msdn.microsoft.com/en-us/library/system.web.staticsitemapprovider.buildsitemap.aspx) and [`GetRootNodeCore`](https://msdn.microsoft.com/en-us/library/system.web.sitemapprovider.getrootnodecore.aspx).</span></span> <span data-ttu-id="3f9e2-244">`BuildSiteMap`, como o nome sugere, é responsável por carregar a estrutura de mapa de site do armazenamento persistente e construi-la na memória.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-244">`BuildSiteMap`, as its name implies, is responsible for loading the site map structure from persistent storage and constructing it in memory.</span></span> <span data-ttu-id="3f9e2-245">`GetRootNodeCore`Retorna o nó raiz no mapa do site.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-245">`GetRootNodeCore` returns the root node in the site map.</span></span>

<span data-ttu-id="3f9e2-246">Antes de uma web aplicativo pode usar um provedor de mapa de site que ele deve ser registrado na configuração de s do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-246">Before a web application can use a site map provider it must be registered in the application s configuration.</span></span> <span data-ttu-id="3f9e2-247">Por padrão, o `XmlSiteMapProvider` classe está registrada usando o nome `AspNetXmlSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-247">By default, the `XmlSiteMapProvider` class is registered using the name `AspNetXmlSiteMapProvider`.</span></span> <span data-ttu-id="3f9e2-248">Para registrar provedores de mapa de site adicionais, adicione a seguinte marcação para `Web.config`:</span><span class="sxs-lookup"><span data-stu-id="3f9e2-248">To register additional site map providers, add the following markup to `Web.config`:</span></span>


[!code-xml[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample5.xml)]

<span data-ttu-id="3f9e2-249">O *nome* valor atribui um nome legível para o provedor ao *tipo* Especifica o nome de tipo totalmente qualificado do provedor de mapa do site.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-249">The *name* value assigns a human-readable name to the provider while *type* specifies the fully-qualified type name of the site map provider.</span></span> <span data-ttu-id="3f9e2-250">Vamos explorar concretos valores para o *nome* e *tipo* valores na etapa 7, após nós ve criado nosso provedor de mapa de site personalizado.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-250">We'll explore concrete values for the *name* and *type* values in Step 7, after we ve created our custom site map provider.</span></span>

<span data-ttu-id="3f9e2-251">A classe de provedor de mapa de site é criada na primeira vez que ele é acessado a partir de `SiteMap` classe e permanece na memória para o tempo de vida do aplicativo web.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-251">The site map provider class is instantiated the first time it is accessed from the `SiteMap` class and remains in memory for the lifetime of the web application.</span></span> <span data-ttu-id="3f9e2-252">Como há apenas uma instância do provedor de mapa do site que pode ser invocado vários simultâneas de visitantes do site, é necessário que os métodos do provedor s ser *thread-safe*.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-252">Since there is only one instance of the site map provider that may be invoked from multiple, concurrent web site visitors, it is imperative that the provider s methods be *thread-safe*.</span></span>

<span data-ttu-id="3f9e2-253">Por motivos de escalabilidade, de desempenho e ele importante que o site na memória em cache mapear estrutura e retornar isso em cache estrutura em vez de recriá-la sempre que o `BuildSiteMap` método é invocado.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-253">For performance and scalability reasons, it s important that we cache the in-memory site map structure and return this cached structure rather than recreating it every time the `BuildSiteMap` method is invoked.</span></span> <span data-ttu-id="3f9e2-254">`BuildSiteMap`pode ser chamado várias vezes por solicitação de página por usuário, dependendo dos controles de navegação em uso na página e a profundidade da estrutura de mapa do site.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-254">`BuildSiteMap` may be called several times per page request per user, depending on the navigation controls in use on the page and the depth of the site map structure.</span></span> <span data-ttu-id="3f9e2-255">Em qualquer caso, se a estrutura de mapa de site em cache não `BuildSiteMap` , em seguida, cada vez que ele é invocado seria necessário recuperar novamente as informações de categoria e produto da arquitetura (que pode resultar em uma consulta no banco de dados).</span><span class="sxs-lookup"><span data-stu-id="3f9e2-255">In any case, if we do not cache the site map structure in `BuildSiteMap` then each time it is invoked we would need to re-retrieve the product and category information from the architecture (which would result in a query to the database).</span></span> <span data-ttu-id="3f9e2-256">Conforme abordado nos tutoriais de cache anteriores, dados armazenados em cache podem se tornar obsoletos.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-256">As we discussed in the previous caching tutorials, cached data can become stale.</span></span> <span data-ttu-id="3f9e2-257">Para combater isso, podemos usar o tempo - ou com base em dependência expirações de cache SQL.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-257">To combat this, we can use either time- or SQL cache dependency-based expiries.</span></span>

> [!NOTE]
> <span data-ttu-id="3f9e2-258">Um provedor de mapa de site pode, opcionalmente, substituir o [ `Initialize` método](https://msdn.microsoft.com/en-us/library/system.web.sitemapprovider.initialize.aspx).</span><span class="sxs-lookup"><span data-stu-id="3f9e2-258">A site map provider may optionally override the [`Initialize` method](https://msdn.microsoft.com/en-us/library/system.web.sitemapprovider.initialize.aspx).</span></span> <span data-ttu-id="3f9e2-259">`Initialize`é invocado quando o provedor de mapa de site é criado pela primeira vez e é passado qualquer atributos personalizados atribuídos para o provedor no `Web.config` no `<add>` elemento como: `<add name="name" type="type" customAttribute="value" />`.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-259">`Initialize` is invoked when the site map provider is first instantiated and is passed any custom attributes assigned to the provider in `Web.config` in the `<add>` element like: `<add name="name" type="type" customAttribute="value" />`.</span></span> <span data-ttu-id="3f9e2-260">É útil se você quiser permitir que um desenvolvedor de página especificar várias configurações de relacionadas ao provedor do site mapa sem a necessidade de modificar o código do provedor s.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-260">It is useful if you want to allow a page developer to specify various site map provider-related settings without having to modify the provider s code.</span></span> <span data-ttu-id="3f9e2-261">Por exemplo, se nós foram lendo os dados de categoria e produtos diretamente do banco de dados em vez de por meio da arquitetura, podemos d provavelmente deseja permitem que o desenvolvedor de página especifique a cadeia de caracteres de conexão de banco de dados por meio de `Web.config` em vez de usar um codificado valor no código de provedor s.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-261">For example, if we were reading the category and products data directly from the database as opposed to through the architecture, we d likely want to let the page developer specify the database connection string through `Web.config` rather than using a hard coded value in the provider s code.</span></span> <span data-ttu-id="3f9e2-262">O provedor de mapa de site personalizado, criaremos na etapa 6 não substituir isso `Initialize` método.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-262">The custom site map provider we'll build in Step 6 does not override this `Initialize` method.</span></span> <span data-ttu-id="3f9e2-263">Para obter um exemplo de como usar o `Initialize` método, consulte [Jeff Prosise](http://www.wintellect.com/Weblogs/CategoryView,category,Jeff%20Prosise.aspx) s [armazenar mapas de Site no SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) artigo.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-263">For an example of using the `Initialize` method, refer to [Jeff Prosise](http://www.wintellect.com/Weblogs/CategoryView,category,Jeff%20Prosise.aspx) s [Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) article.</span></span>


## <a name="step-6-creating-the-custom-site-map-provider"></a><span data-ttu-id="3f9e2-264">Etapa 6: Criando o provedor de mapa de Site personalizado</span><span class="sxs-lookup"><span data-stu-id="3f9e2-264">Step 6: Creating the Custom Site Map Provider</span></span>

<span data-ttu-id="3f9e2-265">Para criar um provedor de mapa de site personalizado que cria o mapa do site de categorias de produtos no banco de dados Northwind, é preciso criar uma classe que estende o `StaticSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-265">To create a custom site map provider that builds the site map from the categories and products in the Northwind database, we need to create a class that extends `StaticSiteMapProvider`.</span></span> <span data-ttu-id="3f9e2-266">Na etapa 1, solicitado para adicionar um `CustomProviders` pasta o `App_Code` pasta - adicionar uma nova classe para essa pasta denominada `NorthwindSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-266">In Step 1 I asked you to add a `CustomProviders` folder in the `App_Code` folder - add a new class to this folder named `NorthwindSiteMapProvider`.</span></span> <span data-ttu-id="3f9e2-267">Adicione o seguinte código à classe `NorthwindSiteMapProvider`:</span><span class="sxs-lookup"><span data-stu-id="3f9e2-267">Add the following code to the `NorthwindSiteMapProvider` class:</span></span>


[!code-csharp[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample6.cs)]

<span data-ttu-id="3f9e2-268">Permitem s recomece explorar essa classe s `BuildSiteMap` método, que começa com um [ `lock` instrução](https://msdn.microsoft.com/en-us/library/c5kehkcz.aspx).</span><span class="sxs-lookup"><span data-stu-id="3f9e2-268">Let s start with exploring this class s `BuildSiteMap` method, which starts with a [`lock` statement](https://msdn.microsoft.com/en-us/library/c5kehkcz.aspx).</span></span> <span data-ttu-id="3f9e2-269">O `lock` instrução permite apenas um thread por vez para inserir, assim, serializar o acesso ao seu código e impedindo que dois threads simultâneos passo a passo dos pés de s uma da outra.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-269">The `lock` statement only allows one thread at a time to enter, thereby serializing access to its code and preventing two concurrent threads from stepping on one another s toes.</span></span>

<span data-ttu-id="3f9e2-270">O nível de classe `SiteMapNode` variável `root` é usado para armazenar a estrutura de mapa de site.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-270">The class-level `SiteMapNode` variable `root` is used to cache the site map structure.</span></span> <span data-ttu-id="3f9e2-271">Quando o mapa do site é criado pela primeira vez, ou pela primeira vez depois que os dados subjacentes tem sido modificados, `root` será `null` e a estrutura de mapa do site será construída.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-271">When the site map is constructed for the first time, or for the first time after the underlying data has been modified, `root` will be `null` and the site map structure will be constructed.</span></span> <span data-ttu-id="3f9e2-272">O nó raiz do site mapa s é atribuído a `root` durante a construção de processo para que na próxima vez que esse método é chamado, `root` não será `null`.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-272">The site map s root node is assigned to `root` during the construction process so that the next time this method is called, `root` will not be `null`.</span></span> <span data-ttu-id="3f9e2-273">Consequentemente, desde que `root` não é `null` a estrutura de mapa do site será retornada ao chamador sem ter que recriá-lo.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-273">Consequently, so long as `root` is not `null` the site map structure will be returned to the caller without having to recreate it.</span></span>

<span data-ttu-id="3f9e2-274">Se for raiz `null`, a estrutura de mapa de site é criada a partir de informações de produto e categoria.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-274">If root is `null`, the site map structure is created from the product and category information.</span></span> <span data-ttu-id="3f9e2-275">O mapa do site é criado por meio da criação de `SiteMapNode` instâncias e, em seguida, cria a hierarquia por meio de chamadas para o `StaticSiteMapProvider` classe s `AddNode` método.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-275">The site map is built by creating the `SiteMapNode` instances and then forming the hierarchy through calls to the `StaticSiteMapProvider` class s `AddNode` method.</span></span> <span data-ttu-id="3f9e2-276">`AddNode`executa o sistema de controle interno, armazenando as diversas `SiteMapNode` instâncias em um `Hashtable`.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-276">`AddNode` performs the internal bookkeeping, storing the assorted `SiteMapNode` instances in a `Hashtable`.</span></span> <span data-ttu-id="3f9e2-277">Antes de começar a construção de hierarquia, começamos chamando o `Clear` método, que limpa os elementos de interno `Hashtable`.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-277">Before we start constructing the hierarchy, we start by calling the `Clear` method, which clears out the elements from the internal `Hashtable`.</span></span> <span data-ttu-id="3f9e2-278">Em seguida, o `ProductsBLL` classe s `GetProducts` método e resultante `ProductsDataTable` são armazenados em variáveis locais.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-278">Next, the `ProductsBLL` class s `GetProducts` method and the resulting `ProductsDataTable` are stored in local variables.</span></span>

<span data-ttu-id="3f9e2-279">A construção de mapa s site começa criando o nó raiz e atribuí-lo para `root`.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-279">The site map s construction begins by creating the root node and assigning it to `root`.</span></span> <span data-ttu-id="3f9e2-280">A sobrecarga do [ `SiteMapNode` construtor s](https://msdn.microsoft.com/en-us/library/system.web.sitemapnode.sitemapnode.aspx) usado aqui e em todo este `BuildSiteMap` é passado as seguintes informações:</span><span class="sxs-lookup"><span data-stu-id="3f9e2-280">The overload of the [`SiteMapNode` s constructor](https://msdn.microsoft.com/en-us/library/system.web.sitemapnode.sitemapnode.aspx) used here and throughout this `BuildSiteMap` is passed the following information:</span></span>

- <span data-ttu-id="3f9e2-281">Uma referência para o provedor de mapa de site (`this`).</span><span class="sxs-lookup"><span data-stu-id="3f9e2-281">A reference to the site map provider (`this`).</span></span>
- <span data-ttu-id="3f9e2-282">O `SiteMapNode` s `Key`.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-282">The `SiteMapNode` s `Key`.</span></span> <span data-ttu-id="3f9e2-283">Isso necessário valor deve ser exclusivo para cada `SiteMapNode`.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-283">This required value must be unique for each `SiteMapNode`.</span></span>
- <span data-ttu-id="3f9e2-284">O `SiteMapNode` s `Url`.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-284">The `SiteMapNode` s `Url`.</span></span> <span data-ttu-id="3f9e2-285">`Url`é opcional, mas, se fornecido, cada `SiteMapNode` s `Url` valor deve ser exclusivo.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-285">`Url` is optional, but if provided, each `SiteMapNode` s `Url` value must be unique.</span></span>
- <span data-ttu-id="3f9e2-286">O `SiteMapNode` s `Title`, que é necessário.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-286">The `SiteMapNode` s `Title`, which is required.</span></span>

<span data-ttu-id="3f9e2-287">O `AddNode(root)` chamada de método adiciona o `SiteMapNode` `root` para o mapa do site como a raiz.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-287">The `AddNode(root)` method call adds the `SiteMapNode` `root` to the site map as the root.</span></span> <span data-ttu-id="3f9e2-288">Em seguida, cada `ProductRow` no `ProductsDataTable` é enumerado.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-288">Next, each `ProductRow` in the `ProductsDataTable` is enumerated.</span></span> <span data-ttu-id="3f9e2-289">Se já existe um `SiteMapNode` para a categoria de produto s atual, ele é referenciado.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-289">If there already exists a `SiteMapNode` for the current product s category, it is referenced.</span></span> <span data-ttu-id="3f9e2-290">Caso contrário, um novo `SiteMapNode` para a categoria é criada e adicionada como um filho do `SiteMapNode``root` por meio de `AddNode(categoryNode, root)` chamada de método.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-290">Otherwise, a new `SiteMapNode` for the category is created and added as a child of the `SiteMapNode``root` through the `AddNode(categoryNode, root)` method call.</span></span> <span data-ttu-id="3f9e2-291">Após a categoria apropriada `SiteMapNode` nó foi encontrado ou criado, um `SiteMapNode` é criado para o produto atual e adicionado como um filho da categoria `SiteMapNode` via `AddNode(productNode, categoryNode)`.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-291">After the appropriate category `SiteMapNode` node has been found or created, a `SiteMapNode` is created for the current product and added as a child of the category `SiteMapNode` via `AddNode(productNode, categoryNode)`.</span></span> <span data-ttu-id="3f9e2-292">Observe que a categoria `SiteMapNode` s `Url` é o valor da propriedade `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID` enquanto o produto `SiteMapNode` s `Url` atribuído a propriedade `~/SiteMapNode/ProductDetails.aspx?ProductID=productID`.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-292">Note that the category `SiteMapNode` s `Url` property value is `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID` while the product `SiteMapNode` s `Url` property is assigned `~/SiteMapNode/ProductDetails.aspx?ProductID=productID`.</span></span>

> [!NOTE]
> <span data-ttu-id="3f9e2-293">Os produtos que têm um banco de dados `NULL` valor para seus `CategoryID` são agrupadas em uma categoria `SiteMapNode` cujo `Title` propriedade está definida como None e cujo `Url` está definida como uma cadeia de caracteres vazia.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-293">Those products that have a database `NULL` value for their `CategoryID` are grouped under a category `SiteMapNode` whose `Title` property is set to None and whose `Url` property is set to an empty string.</span></span> <span data-ttu-id="3f9e2-294">Decidi definir `Url` para uma cadeia de caracteres vazia, desde o `ProductBLL` classe s `GetProductsByCategory(categoryID)` método atualmente não tem a capacidade de retornar apenas os produtos com um `NULL` `CategoryID` valor.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-294">I decided to set `Url` to an empty string since the `ProductBLL` class s `GetProductsByCategory(categoryID)` method currently lacks the capability to return just those products with a `NULL` `CategoryID` value.</span></span> <span data-ttu-id="3f9e2-295">Além disso, gostaria de demonstrar como os controles de navegação renderizam um `SiteMapNode` que não tem um valor para o seu `Url` propriedade.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-295">Also, I wanted to demonstrate how the navigation controls render a `SiteMapNode` that lacks a value for its `Url` property.</span></span> <span data-ttu-id="3f9e2-296">Você deve estender esse tutorial para que nenhuma `SiteMapNode` s `Url` propriedade aponta para `ProductsByCategory.aspx`, ainda exibe somente os produtos com `NULL` `CategoryID` valores.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-296">I encourage you to extend this tutorial so that the None `SiteMapNode` s `Url` property points to `ProductsByCategory.aspx`, yet only displays the products with `NULL` `CategoryID` values.</span></span>


<span data-ttu-id="3f9e2-297">Depois de construir o mapa do site, um objeto arbitrário é adicionado ao cache de dados usando uma dependência de cache SQL no `Categories` e `Products` tabelas por meio de um `AggregateCacheDependency` objeto.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-297">After constructing the site map, an arbitrary object is added to the data cache using a SQL cache dependency on the `Categories` and `Products` tables through an `AggregateCacheDependency` object.</span></span> <span data-ttu-id="3f9e2-298">Podemos explorou o uso de dependências de cache SQL no tutorial anterior, *dependências de Cache de SQL usando*.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-298">We explored using SQL cache dependencies in the preceding tutorial, *Using SQL Cache Dependencies*.</span></span> <span data-ttu-id="3f9e2-299">O provedor de mapa de site personalizado, no entanto, usa uma sobrecarga do cache de dados s `Insert` método que possamos ve ainda para explorar.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-299">The custom site map provider, however, uses an overload of the data cache s `Insert` method that we ve yet to explore.</span></span> <span data-ttu-id="3f9e2-300">Essa sobrecarga aceita como seu parâmetro de entrada final um delegado que é chamado quando o objeto é removido do cache.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-300">This overload accepts as its final input parameter a delegate that is called when the object is removed from the cache.</span></span> <span data-ttu-id="3f9e2-301">Especificamente, podemos passar em uma nova [ `CacheItemRemovedCallback` delegar](https://msdn.microsoft.com/en-us/library/system.web.caching.cacheitemremovedcallback.aspx) que aponta para o `OnSiteMapChanged` método definido mais para baixo o `NorthwindSiteMapProvider` classe.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-301">Specifically, we pass in a new [`CacheItemRemovedCallback` delegate](https://msdn.microsoft.com/en-us/library/system.web.caching.cacheitemremovedcallback.aspx) that points to the `OnSiteMapChanged` method defined further down in the `NorthwindSiteMapProvider` class.</span></span>

> [!NOTE]
> <span data-ttu-id="3f9e2-302">A representação na memória do mapa do site é armazenado em cache através da variável de nível de classe `root`.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-302">The in-memory representation of the site map is cached through the class-level variable `root`.</span></span> <span data-ttu-id="3f9e2-303">Como há apenas uma instância da classe do provedor de mapa de site personalizado e desde que essa instância é compartilhada entre todos os threads no aplicativo web, essa variável de classe serve como um cache.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-303">Since there is only one instance of the custom site map provider class and since that instance is shared among all threads in the web application, this class variable serves as a cache.</span></span> <span data-ttu-id="3f9e2-304">O `BuildSiteMap` método também usa o cache de dados, mas apenas como um meio para receber uma notificação quando a base de dados em banco de dados de `Categories` ou `Products` de tabelas de alterações.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-304">The `BuildSiteMap` method also uses the data cache, but only as a means to receive notification when the underlying database data in the `Categories` or `Products` tables changes.</span></span> <span data-ttu-id="3f9e2-305">Observe que o valor colocar no cache de dados é apenas a data e hora atuais.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-305">Note that the value put into the data cache is just the current date and time.</span></span> <span data-ttu-id="3f9e2-306">Os dados de mapa de site real são *não* colocados no cache de dados.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-306">The actual site map data is *not* put in the data cache.</span></span>


<span data-ttu-id="3f9e2-307">O `BuildSiteMap` método é concluído, retornando o nó raiz do mapa do site.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-307">The `BuildSiteMap` method completes by returning the root node of the site map.</span></span>

<span data-ttu-id="3f9e2-308">Os métodos restantes são bastante simples.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-308">The remaining methods are fairly straightforward.</span></span> <span data-ttu-id="3f9e2-309">`GetRootNodeCore`é responsável por retornar o nó raiz.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-309">`GetRootNodeCore` is responsible for returning the root node.</span></span> <span data-ttu-id="3f9e2-310">Como `BuildSiteMap` retorna a raiz, `GetRootNodeCore` simplesmente retorna `BuildSiteMap` s valor de retorno.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-310">Since `BuildSiteMap` returns the root, `GetRootNodeCore` simply returns `BuildSiteMap` s return value.</span></span> <span data-ttu-id="3f9e2-311">O `OnSiteMapChanged` método conjuntos `root` para `null` quando o item de cache é removido.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-311">The `OnSiteMapChanged` method sets `root` back to `null` when the cache item is removed.</span></span> <span data-ttu-id="3f9e2-312">Com raiz definido novamente como `null`, na próxima vez `BuildSiteMap` é chamado, a estrutura de mapa de site será reconstruída.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-312">With root set back to `null`, the next time `BuildSiteMap` is invoked, the site map structure will be rebuilt.</span></span> <span data-ttu-id="3f9e2-313">Por fim, o `CachedDate` propriedade retorna o valor de data e hora armazenado no cache de dados, se esse valor existe.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-313">Lastly, the `CachedDate` property returns the date and time value stored in the data cache, if such a value exists.</span></span> <span data-ttu-id="3f9e2-314">Essa propriedade pode ser usada por um desenvolvedor de página para determinar quando os dados de mapa do site foi última armazenado em cache.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-314">This property can be used by a page developer to determine when the site map data was last cached.</span></span>

## <a name="step-7-registering-thenorthwindsitemapprovider"></a><span data-ttu-id="3f9e2-315">Etapa 7: Registrar o`NorthwindSiteMapProvider`</span><span class="sxs-lookup"><span data-stu-id="3f9e2-315">Step 7: Registering the`NorthwindSiteMapProvider`</span></span>

<span data-ttu-id="3f9e2-316">Para que nosso aplicativo web para usar o `NorthwindSiteMapProvider` provedor de mapa de site criado na etapa 6, é preciso registrá-lo no `<siteMap>` seção `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-316">In order for our web application to use the `NorthwindSiteMapProvider` site map provider created in Step 6, we need to register it in the `<siteMap>` section of `Web.config`.</span></span> <span data-ttu-id="3f9e2-317">Especificamente, adicione a seguinte marcação dentro de `<system.web>` elemento `Web.config`:</span><span class="sxs-lookup"><span data-stu-id="3f9e2-317">Specifically, add the following markup within the `<system.web>` element in `Web.config`:</span></span>


[!code-xml[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample7.xml)]

<span data-ttu-id="3f9e2-318">Essa marcação faz duas coisas: primeiro, ele indica que o interno `AspNetXmlSiteMapProvider` é o provedor de mapa de site padrão; em segundo lugar, ele registra o provedor de mapa de site personalizado criado na etapa 6 com o nome amigável a humanos Northwind.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-318">This markup does two things: first, it indicates that the built-in `AspNetXmlSiteMapProvider` is the default site map provider; second, it registers the custom site map provider created in Step 6 with the human-friendly name Northwind .</span></span>

> [!NOTE]
> <span data-ttu-id="3f9e2-319">Para provedores de mapa de site, localizados em aplicativo s `App_Code` pasta, o valor de `type` é simplesmente o nome da classe.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-319">For site map providers located in the application s `App_Code` folder, the value of the `type` attribute is simply the class name.</span></span> <span data-ttu-id="3f9e2-320">Como alternativa, o provedor de mapa de site personalizado pode ter sido criado em um projeto de biblioteca de classes separado com o assembly compilado colocado em aplicativo s web `/Bin` directory.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-320">Alternatively, the custom site map provider could have been created in a separate Class Library project with the compiled assembly placed in the web application s `/Bin` directory.</span></span> <span data-ttu-id="3f9e2-321">Nesse caso, o `type` seria o valor do atributo *Namespace*. *Nome da classe*, *AssemblyName* .</span><span class="sxs-lookup"><span data-stu-id="3f9e2-321">In that case, the `type` attribute value would be *Namespace*.*ClassName*, *AssemblyName* .</span></span>


<span data-ttu-id="3f9e2-322">Após a atualização `Web.config`, reserve um tempo para exibir qualquer página de tutoriais em um navegador.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-322">After updating `Web.config`, take a moment to view any page from the tutorials in a browser.</span></span> <span data-ttu-id="3f9e2-323">Observe que a interface de navegação à esquerda ainda mostra as seções e tutoriais definido em `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-323">Note that the navigation interface on the left still shows the sections and tutorials defined in `Web.sitemap`.</span></span> <span data-ttu-id="3f9e2-324">Isso ocorre porque foi deixado `AspNetXmlSiteMapProvider` como o provedor padrão.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-324">This is because we left `AspNetXmlSiteMapProvider` as the default provider.</span></span> <span data-ttu-id="3f9e2-325">Para criar um elemento de interface do usuário de navegação que usa o `NorthwindSiteMapProvider`, precisaremos para especificar explicitamente que o provedor de mapa de site do Northwind deve ser usado.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-325">In order to create a navigation user interface element that uses the `NorthwindSiteMapProvider`, we'll need to explicitly specify that the Northwind site map provider should be used.</span></span> <span data-ttu-id="3f9e2-326">Veremos como fazer isso na etapa 8.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-326">We'll see how to accomplish this in Step 8.</span></span>

## <a name="step-8-displaying-site-map-information-using-the-custom-site-map-provider"></a><span data-ttu-id="3f9e2-327">Etapa 8: Exibindo informações de mapa de Site usando o provedor de mapa de Site personalizado</span><span class="sxs-lookup"><span data-stu-id="3f9e2-327">Step 8: Displaying Site Map Information Using the Custom Site Map Provider</span></span>

<span data-ttu-id="3f9e2-328">Com um site personalizado, o provedor de mapa criado e registrado em `Web.config`, podemos re pronto para adicionar controles de navegação para o `Default.aspx`, `ProductsByCategory.aspx`, e `ProductDetails.aspx` páginas o `SiteMapProvider` pasta.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-328">With the custom site map provider created and registered in `Web.config`, we re ready to add navigation controls to the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages in the `SiteMapProvider` folder.</span></span> <span data-ttu-id="3f9e2-329">Comece abrindo o `Default.aspx` página e arraste um `SiteMapPath` da caixa de ferramentas para o Designer.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-329">Start by opening the `Default.aspx` page and drag a `SiteMapPath` from the Toolbox onto the Designer.</span></span> <span data-ttu-id="3f9e2-330">O controle SiteMapPath está localizado na seção de navegação da caixa de ferramentas.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-330">The SiteMapPath control is located in the Navigation section of the Toolbox.</span></span>


<span data-ttu-id="3f9e2-331">[![Adicionar um SiteMapPath como Default. aspx](building-a-custom-database-driven-site-map-provider-cs/_static/image19.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image18.gif)</span><span class="sxs-lookup"><span data-stu-id="3f9e2-331">[![Add a SiteMapPath to Default.aspx](building-a-custom-database-driven-site-map-provider-cs/_static/image19.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image18.gif)</span></span>

<span data-ttu-id="3f9e2-332">**Figura 16**: adicionar um SiteMapPath para `Default.aspx` ([clique para exibir a imagem em tamanho normal](building-a-custom-database-driven-site-map-provider-cs/_static/image20.gif))</span><span class="sxs-lookup"><span data-stu-id="3f9e2-332">**Figure 16**: Add a SiteMapPath to `Default.aspx` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image20.gif))</span></span>


<span data-ttu-id="3f9e2-333">O controle SiteMapPath exibe uma trilha de navegação, que indica o local de s de página atual no mapa do site.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-333">The SiteMapPath control displays a breadcrumb, indicating the current page s location within the site map.</span></span> <span data-ttu-id="3f9e2-334">Adicionamos um SiteMapPath à parte superior da página mestra novamente o *páginas mestras e navegação de Site* tutorial.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-334">We added a SiteMapPath to the top of the master page back in the *Master Pages and Site Navigation* tutorial.</span></span>

<span data-ttu-id="3f9e2-335">Dedicar um tempo para exibir esta página por meio de um navegador.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-335">Take a moment to view this page through a browser.</span></span> <span data-ttu-id="3f9e2-336">O SiteMapPath adicionado na Figura 16 usa o provedor de mapa de site padrão, extraindo seus dados de `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-336">The SiteMapPath added in Figure 16 uses the default site map provider, pulling its data from `Web.sitemap`.</span></span> <span data-ttu-id="3f9e2-337">Portanto, a navegação estrutural mostra início &gt; Personalizando o mapa do Site, como navegação estrutural no canto superior direito.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-337">Therefore, the breadcrumb shows Home &gt; Customizing the Site Map, just like the breadcrumb in the upper-right corner.</span></span>


<span data-ttu-id="3f9e2-338">[![A navegação de trilha usa o provedor de mapa de Site padrão](building-a-custom-database-driven-site-map-provider-cs/_static/image22.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image21.gif)</span><span class="sxs-lookup"><span data-stu-id="3f9e2-338">[![The Breadcrumb Uses the Default Site Map Provider](building-a-custom-database-driven-site-map-provider-cs/_static/image22.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image21.gif)</span></span>

<span data-ttu-id="3f9e2-339">**Figura 17**: navegação estrutural usa o provedor de mapa de Site padrão ([clique para exibir a imagem em tamanho normal](building-a-custom-database-driven-site-map-provider-cs/_static/image23.gif))</span><span class="sxs-lookup"><span data-stu-id="3f9e2-339">**Figure 17**: The Breadcrumb Uses the Default Site Map Provider ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image23.gif))</span></span>


<span data-ttu-id="3f9e2-340">Para que o SiteMapPath adicionado na Figura 16 usar o provedor de mapa de site personalizado criado na etapa 6, defina seu [ `SiteMapProvider` propriedade](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.sitemappath.sitemapprovider.aspx) Northwind, o nome que é atribuído para o `NorthwindSiteMapProvider` em `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-340">To have the SiteMapPath added in Figure 16 use the custom site map provider we created in Step 6, set its [`SiteMapProvider` property](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.sitemappath.sitemapprovider.aspx) to Northwind, the name we assigned to the `NorthwindSiteMapProvider` in `Web.config`.</span></span> <span data-ttu-id="3f9e2-341">Infelizmente, o Designer continua a usar o provedor de mapa de site padrão, mas se você visitar a página por meio de um navegador depois de fazer essa alteração de propriedade você verá que a navegação de trilha agora usa o provedor de mapa de site personalizado.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-341">Unfortunately, the Designer continues to use the default site map provider, but if you visit the page through a browser after making this property change you'll see that the breadcrumb now uses the custom site map provider.</span></span>


<span data-ttu-id="3f9e2-342">[![A navegação de trilha agora usa o NorthwindSiteMapProvider de provedor de mapa de Site personalizado](building-a-custom-database-driven-site-map-provider-cs/_static/image25.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image24.gif)</span><span class="sxs-lookup"><span data-stu-id="3f9e2-342">[![The Breadcrumb Now Uses the Custom Site Map Provider NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-cs/_static/image25.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image24.gif)</span></span>

<span data-ttu-id="3f9e2-343">**Figura 18**: navegação estrutural agora usa o provedor de mapa de Site personalizado `NorthwindSiteMapProvider` ([clique para exibir a imagem em tamanho normal](building-a-custom-database-driven-site-map-provider-cs/_static/image26.gif))</span><span class="sxs-lookup"><span data-stu-id="3f9e2-343">**Figure 18**: The Breadcrumb Now Uses the Custom Site Map Provider `NorthwindSiteMapProvider` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image26.gif))</span></span>


<span data-ttu-id="3f9e2-344">O controle SiteMapPath exibe uma interface de usuário mais funcional no `ProductsByCategory.aspx` e `ProductDetails.aspx` páginas.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-344">The SiteMapPath control displays a more functional user interface in the `ProductsByCategory.aspx` and `ProductDetails.aspx` pages.</span></span> <span data-ttu-id="3f9e2-345">Adicionar um SiteMapPath essas páginas, definindo o `SiteMapProvider` propriedade no para a Northwind.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-345">Add a SiteMapPath to these pages, setting the `SiteMapProvider` property in both to Northwind.</span></span> <span data-ttu-id="3f9e2-346">De `Default.aspx` clique no link Exibir produtos para bebidas e, em seguida, no link Exibir detalhes para Chai chá.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-346">From `Default.aspx` click on the View Products link for Beverages, and then on the View Details link for Chai Tea.</span></span> <span data-ttu-id="3f9e2-347">Como mostra a Figura 19, navegação estrutural inclui a seção de mapa de site atual (Chai chá) e seus ancestrais: bebidas e todas as categorias.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-347">As Figure 19 shows, the breadcrumb includes the current site map section ( Chai Tea ) and its ancestors: Beverages and All Categories .</span></span>


<span data-ttu-id="3f9e2-348">[![A navegação de trilha agora usa o NorthwindSiteMapProvider de provedor de mapa de Site personalizado](building-a-custom-database-driven-site-map-provider-cs/_static/image27.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="3f9e2-348">[![The Breadcrumb Now Uses the Custom Site Map Provider NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-cs/_static/image27.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image21.png)</span></span>

<span data-ttu-id="3f9e2-349">**Figura 19**: navegação estrutural agora usa o provedor de mapa de Site personalizado `NorthwindSiteMapProvider` ([clique para exibir a imagem em tamanho normal](building-a-custom-database-driven-site-map-provider-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="3f9e2-349">**Figure 19**: The Breadcrumb Now Uses the Custom Site Map Provider `NorthwindSiteMapProvider` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image22.png))</span></span>


<span data-ttu-id="3f9e2-350">Outros elementos de interface do usuário de navegação podem ser usados além SiteMapPath, como os controles de Menu e TreeView.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-350">Other navigation user interface elements can be used in addition to the SiteMapPath, such as the Menu and TreeView controls.</span></span> <span data-ttu-id="3f9e2-351">O `Default.aspx`, `ProductsByCategory.aspx`, e `ProductDetails.aspx` páginas de download para este tutorial incluem controles de Menu (consulte a Figura 20).</span><span class="sxs-lookup"><span data-stu-id="3f9e2-351">The `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages in the download for this tutorial, for example, all include Menu controls (see Figure 20).</span></span> <span data-ttu-id="3f9e2-352">Consulte [examinando o ASP.NET 2.0 s recursos de navegação do Site](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx) e [usando controles de navegação do Site](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/navigation/sitenavcontrols.aspx) seção o [início rápido do ASP.NET 2.0](https://quickstarts.asp.net/QuickStartv20/aspnet/) para uma análise mais detalhada a controles de navegação e sistema de mapa de site no ASP.NET 2.0.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-352">See [Examining ASP.NET 2.0 s Site Navigation Features](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx) and the [Using Site Navigation Controls](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/navigation/sitenavcontrols.aspx) section of the [ASP.NET 2.0 QuickStarts](https://quickstarts.asp.net/QuickStartv20/aspnet/) for a more in-depth look at the navigation controls and site map system in ASP.NET 2.0.</span></span>


<span data-ttu-id="3f9e2-353">[![O controle de Menu lista cada uma das categorias e produtos](building-a-custom-database-driven-site-map-provider-cs/_static/image29.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image28.gif)</span><span class="sxs-lookup"><span data-stu-id="3f9e2-353">[![The Menu Control Lists Each of the Categories and Products](building-a-custom-database-driven-site-map-provider-cs/_static/image29.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image28.gif)</span></span>

<span data-ttu-id="3f9e2-354">**Figura 20**: O Menu controle lista cada uma das categorias de produtos ([clique para exibir a imagem em tamanho normal](building-a-custom-database-driven-site-map-provider-cs/_static/image30.gif))</span><span class="sxs-lookup"><span data-stu-id="3f9e2-354">**Figure 20**: The Menu Control Lists Each of the Categories and Products ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image30.gif))</span></span>


<span data-ttu-id="3f9e2-355">Como mencionado anteriormente neste tutorial, a estrutura de mapa de site pode ser acessada por meio de programação com o `SiteMap` classe.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-355">As mentioned earlier in this tutorial, the site map structure can be accessed programmatically through the `SiteMap` class.</span></span> <span data-ttu-id="3f9e2-356">O código a seguir retorna a raiz `SiteMapNode` do provedor padrão:</span><span class="sxs-lookup"><span data-stu-id="3f9e2-356">The following code returns the root `SiteMapNode` of the default provider:</span></span>


[!code-csharp[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample8.cs)]

<span data-ttu-id="3f9e2-357">Como o `AspNetXmlSiteMapProvider` é o provedor padrão para o nosso aplicativo, o código acima retornaria o nó raiz definido no `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-357">Since the `AspNetXmlSiteMapProvider` is the default provider for our application, the above code would return the root node defined in `Web.sitemap`.</span></span> <span data-ttu-id="3f9e2-358">Para fazer referência a um provedor de mapa de site diferente do padrão, use o `SiteMap` classe s [ `Providers` propriedade](https://msdn.microsoft.com/en-us/library/system.web.sitemap.providers.aspx) da seguinte forma:</span><span class="sxs-lookup"><span data-stu-id="3f9e2-358">To reference a site map provider other than the default, use the `SiteMap` class s [`Providers` property](https://msdn.microsoft.com/en-us/library/system.web.sitemap.providers.aspx) like so:</span></span>


[!code-csharp[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample9.cs)]

<span data-ttu-id="3f9e2-359">Onde *nome* é o nome do provedor de mapa do site personalizado (Northwind, para nosso aplicativo web).</span><span class="sxs-lookup"><span data-stu-id="3f9e2-359">Where *name* is the name of the custom site map provider ( Northwind, for our web application).</span></span>

<span data-ttu-id="3f9e2-360">Para acessar um membro específico para um provedor de mapa de site, use `SiteMap.Providers["name"]` para recuperar a instância do provedor e, em seguida, converta-o para o tipo apropriado.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-360">To access a member specific to a site map provider, use `SiteMap.Providers["name"]` to retrieve the provider instance and then cast it to the appropriate type.</span></span> <span data-ttu-id="3f9e2-361">Por exemplo, para exibir o `NorthwindSiteMapProvider` s `CachedDate` propriedade em uma página ASP.NET, use o seguinte código:</span><span class="sxs-lookup"><span data-stu-id="3f9e2-361">For example, to display the `NorthwindSiteMapProvider` s `CachedDate` property in an ASP.NET page, use the following code:</span></span>


[!code-csharp[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample10.cs)]

> [!NOTE]
> <span data-ttu-id="3f9e2-362">Certifique-se de testar o recurso de dependência de cache SQL.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-362">Be sure to test out the SQL cache dependency feature.</span></span> <span data-ttu-id="3f9e2-363">Depois de visitar o `Default.aspx`, `ProductsByCategory.aspx`, e `ProductDetails.aspx` páginas, vá para um dos tutoriais de edição, inserção e exclusão de seção e edite o nome de uma categoria ou produto.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-363">After visiting the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages, go to one of the tutorials in the Editing, Inserting, and Deleting section and edit the name of a category or product.</span></span> <span data-ttu-id="3f9e2-364">Retornar a uma das páginas no `SiteMapProvider` pasta.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-364">Then return to one of the pages in the `SiteMapProvider` folder.</span></span> <span data-ttu-id="3f9e2-365">Supondo que já passou tempo suficiente para o mecanismo de sondagem alterar o banco de dados subjacente, o mapa do site deve ser atualizado para mostrar o novo nome do produto ou categoria.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-365">Assuming enough time has passed for the polling mechanism to note the change to the underlying database, the site map should be updated to show the new product or category name.</span></span>


## <a name="summary"></a><span data-ttu-id="3f9e2-366">Resumo</span><span class="sxs-lookup"><span data-stu-id="3f9e2-366">Summary</span></span>

<span data-ttu-id="3f9e2-367">ASP.NET 2.0 inclui recursos de mapa de site de s um `SiteMap` classe, um número de navegação interno Web controla e persistente de um provedor de mapa de site padrão que espera as informações de mapa de site para um arquivo XML.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-367">ASP.NET 2.0 s site map features includes a `SiteMap` class, a number of built-in navigation Web controls, and a default site map provider that expects the site map information persisted to an XML file.</span></span> <span data-ttu-id="3f9e2-368">Para usar as informações de mapa de site de outra origem, como de um banco de dados, a arquitetura do aplicativo s ou um serviço Web remoto, precisamos criar um provedor de mapa de site personalizado.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-368">In order to use site map information from some other source such as from a database, the application s architecture, or a remote Web service we need to create a custom site map provider.</span></span> <span data-ttu-id="3f9e2-369">Isso envolve a criação de uma classe derivada, direta ou indiretamente, do `SiteMapProvider` classe.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-369">This involves creating a class that derives, directly or indirectly, from the `SiteMapProvider` class.</span></span>

<span data-ttu-id="3f9e2-370">Neste tutorial, vimos como criar um provedor de mapa de site personalizado que acordo o mapa do site com as informações de produto e categoria cortadas da arquitetura do aplicativo.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-370">In this tutorial we saw how to create a custom site map provider that based the site map on the product and category information culled from the application architecture.</span></span> <span data-ttu-id="3f9e2-371">Nosso provedor estendido a `StaticSiteMapProvider` classe e exigia a criação de um `BuildSiteMap` método que recuperou os dados, construída a hierarquia de mapa do site e em cache a estrutura resultante em uma variável de nível de classe.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-371">Our provider extended the `StaticSiteMapProvider` class and entailed creating a `BuildSiteMap` method that retrieved the data, constructed the site map hierarchy, and cached the resulting structure in a class-level variable.</span></span> <span data-ttu-id="3f9e2-372">Usamos uma dependência de cache SQL com uma função de retorno de chamada para invalidar o cache quando da estrutura subjacente `Categories` ou `Products` dados são modificados.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-372">We used a SQL cache dependency with a callback function to invalidate the cached structure when the underlying `Categories` or `Products` data is modified.</span></span>

<span data-ttu-id="3f9e2-373">Boa programação!</span><span class="sxs-lookup"><span data-stu-id="3f9e2-373">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="3f9e2-374">Leitura adicional</span><span class="sxs-lookup"><span data-stu-id="3f9e2-374">Further Reading</span></span>

<span data-ttu-id="3f9e2-375">Para obter mais informações sobre os tópicos abordados neste tutorial, consulte os seguintes recursos:</span><span class="sxs-lookup"><span data-stu-id="3f9e2-375">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- <span data-ttu-id="3f9e2-376">[Armazenamento de mapas de Site no SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) e [o provedor de mapa de Site do SQL que você estava esperando](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx)</span><span class="sxs-lookup"><span data-stu-id="3f9e2-376">[Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) and [The SQL Site Map Provider You ve Been Waiting For](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx)</span></span>
- [<span data-ttu-id="3f9e2-377">Modelo de provedor s uma olhada em ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="3f9e2-377">A Look at ASP.NET 2.0 s Provider Model</span></span>](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx)
- [<span data-ttu-id="3f9e2-378">O Kit de ferramentas do provedor</span><span class="sxs-lookup"><span data-stu-id="3f9e2-378">The Provider Toolkit</span></span>](https://msdn.microsoft.com/en-us/asp.net/aa336558.aspx)
- [<span data-ttu-id="3f9e2-379">Examinando o ASP.NET 2.0 s recursos de navegação de Site</span><span class="sxs-lookup"><span data-stu-id="3f9e2-379">Examining ASP.NET 2.0 s Site Navigation Features</span></span>](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx)

## <a name="about-the-author"></a><span data-ttu-id="3f9e2-380">Sobre o autor</span><span class="sxs-lookup"><span data-stu-id="3f9e2-380">About the Author</span></span>

<span data-ttu-id="3f9e2-381">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor de sete livros sobre ASP/ASP.NET e fundador da [4GuysFromRolla. com](http://www.4guysfromrolla.com), trabalha com tecnologias Microsoft Web desde 1998.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-381">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="3f9e2-382">Scott funciona como um consultor independente, instrutor e gravador.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-382">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="3f9e2-383">Seu livro mais recente é [ *Sams ensinar por conta própria ASP.NET 2.0 nas 24 horas*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="3f9e2-383">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="3f9e2-384">Ele pode ser contatado em [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) ou por meio de seu blog, que pode ser encontrado em [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="3f9e2-384">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="3f9e2-385">Agradecimentos especiais a</span><span class="sxs-lookup"><span data-stu-id="3f9e2-385">Special Thanks To</span></span>

<span data-ttu-id="3f9e2-386">Esta série de tutoriais foi revisado por vários revisores úteis.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-386">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="3f9e2-387">Revisores levar para este tutorial foram Dave Gardner, Zack Jones, Teresa Murphy e Bernadette Leigh.</span><span class="sxs-lookup"><span data-stu-id="3f9e2-387">Lead reviewers for this tutorial were Dave Gardner, Zack Jones, Teresa Murphy, and Bernadette Leigh.</span></span> <span data-ttu-id="3f9e2-388">Interessado em examinar meu artigos futuros do MSDN?</span><span class="sxs-lookup"><span data-stu-id="3f9e2-388">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="3f9e2-389">Nesse caso, me enviar uma linha no [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="3f9e2-389">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

>[!div class="step-by-step"]
[<span data-ttu-id="3f9e2-390">Avançar</span><span class="sxs-lookup"><span data-stu-id="3f9e2-390">Next</span></span>](building-a-custom-database-driven-site-map-provider-vb.md)
